<html><head></head><body><div hidden="" by-polymer-bundler=""><script>Polymer.IronCheckedElementBehaviorImpl={properties:{checked:{type:Boolean,value:!1,reflectToAttribute:!0,notify:!0,observer:'_checkedChanged'},toggles:{type:Boolean,value:!0,reflectToAttribute:!0},value:{type:String,value:'on',observer:'_valueChanged'}},observers:['_requiredChanged(required)'],created:function(){this._hasIronCheckedElementBehavior=!0},_getValidity:function(){return this.disabled||!this.required||this.checked},_requiredChanged:function(){this.required?this.setAttribute('aria-required','true'):this.removeAttribute('aria-required')},_checkedChanged:function(){this.active=this.checked,this.fire('iron-change')},_valueChanged:function(){(this.value===void 0||null===this.value)&&(this.value='on')}},Polymer.IronCheckedElementBehavior=[Polymer.IronFormElementBehavior,Polymer.IronValidatableBehavior,Polymer.IronCheckedElementBehaviorImpl];</script><script>Polymer.PaperCheckedElementBehaviorImpl={_checkedChanged:function(){Polymer.IronCheckedElementBehaviorImpl._checkedChanged.call(this),this.hasRipple()&&(this.checked?this._ripple.setAttribute('checked',''):this._ripple.removeAttribute('checked'))},_buttonStateChanged:function(){Polymer.PaperRippleBehavior._buttonStateChanged.call(this);this.disabled||this.isAttached&&(this.checked=this.active)}},Polymer.PaperCheckedElementBehavior=[Polymer.PaperInkyFocusBehavior,Polymer.IronCheckedElementBehavior,Polymer.PaperCheckedElementBehaviorImpl];</script><dom-module id="paper-checkbox" assetpath="../bower_components/paper-checkbox/"><template strip-whitespace=""><style>:host{display:inline-block;white-space:nowrap;cursor:pointer;--calculated-paper-checkbox-size:var(--paper-checkbox-size, 18px);--calculated-paper-checkbox-ink-size:var(--paper-checkbox-ink-size, -1px);@apply --paper-font-common-base;line-height:0;-webkit-tap-highlight-color:transparent;}:host([hidden]){display:none !important;}:host(:focus){outline:none;}.hidden{display:none;}#checkboxContainer{display:inline-block;position:relative;width:var(--calculated-paper-checkbox-size);height:var(--calculated-paper-checkbox-size);min-width:var(--calculated-paper-checkbox-size);margin:var(--paper-checkbox-margin, initial);vertical-align:var(--paper-checkbox-vertical-align, middle);background-color:var(--paper-checkbox-unchecked-background-color, transparent);}#ink{position:absolute;top:calc(0px - (var(--calculated-paper-checkbox-ink-size) - var(--calculated-paper-checkbox-size)) / 2);left:calc(0px - (var(--calculated-paper-checkbox-ink-size) - var(--calculated-paper-checkbox-size)) / 2);width:var(--calculated-paper-checkbox-ink-size);height:var(--calculated-paper-checkbox-ink-size);color:var(--paper-checkbox-unchecked-ink-color, var(--primary-text-color));opacity:0.6;pointer-events:none;}:host-context([dir="rtl"]) #ink{right:calc(0px - (var(--calculated-paper-checkbox-ink-size) - var(--calculated-paper-checkbox-size)) / 2);left:auto;}#ink[checked]{color:var(--paper-checkbox-checked-ink-color, var(--primary-color));}#checkbox{position:relative;box-sizing:border-box;height:100%;border:solid 2px;border-color:var(--paper-checkbox-unchecked-color, var(--primary-text-color));border-radius:2px;pointer-events:none;-webkit-transition:background-color 140ms, border-color 140ms;transition:background-color 140ms, border-color 140ms;}#checkbox.checked #checkmark{-webkit-animation:checkmark-expand 140ms ease-out forwards;animation:checkmark-expand 140ms ease-out forwards;}@-webkit-keyframes checkmark-expand{0%{-webkit-transform:scale(0, 0) rotate(45deg);}100%{-webkit-transform:scale(1, 1) rotate(45deg);}}@keyframes checkmark-expand{0%{transform:scale(0, 0) rotate(45deg);}100%{transform:scale(1, 1) rotate(45deg);}}#checkbox.checked{background-color:var(--paper-checkbox-checked-color, var(--primary-color));border-color:var(--paper-checkbox-checked-color, var(--primary-color));}#checkmark{position:absolute;width:36%;height:70%;border-style:solid;border-top:none;border-left:none;border-right-width:calc(2/15 * var(--calculated-paper-checkbox-size));border-bottom-width:calc(2/15 * var(--calculated-paper-checkbox-size));border-color:var(--paper-checkbox-checkmark-color, white);-webkit-transform-origin:97% 86%;transform-origin:97% 86%;box-sizing:content-box;}:host-context([dir="rtl"]) #checkmark{-webkit-transform-origin:50% 14%;transform-origin:50% 14%;}#checkboxLabel{position:relative;display:inline-block;vertical-align:middle;padding-left:var(--paper-checkbox-label-spacing, 8px);white-space:normal;line-height:normal;color:var(--paper-checkbox-label-color, var(--primary-text-color));@apply --paper-checkbox-label;}:host([checked]) #checkboxLabel{color:var(--paper-checkbox-label-checked-color, var(--paper-checkbox-label-color, var(--primary-text-color)));@apply --paper-checkbox-label-checked;}:host-context([dir="rtl"]) #checkboxLabel{padding-right:var(--paper-checkbox-label-spacing, 8px);padding-left:0;}#checkboxLabel[hidden]{display:none;}:host([disabled]) #checkbox{opacity:0.5;border-color:var(--paper-checkbox-unchecked-color, var(--primary-text-color));}:host([disabled][checked]) #checkbox{background-color:var(--paper-checkbox-unchecked-color, var(--primary-text-color));opacity:0.5;}:host([disabled]) #checkboxLabel{opacity:0.65;}#checkbox.invalid:not(.checked){border-color:var(--paper-checkbox-error-color, var(--error-color));}</style><div id="checkboxContainer"><div id="checkbox" class$="[[_computeCheckboxClass(checked, invalid)]]"><div id="checkmark" class$="[[_computeCheckmarkClass(checked)]]"></div></div></div><div id="checkboxLabel"><slot></slot></div></template><script>Polymer({is:'paper-checkbox',behaviors:[Polymer.PaperCheckedElementBehavior],hostAttributes:{role:'checkbox',"aria-checked":!1,tabindex:0},properties:{ariaActiveAttribute:{type:String,value:'aria-checked'}},attached:function(){Polymer.RenderStatus.afterNextRender(this,function(){var a=this.getComputedStyleValue('--calculated-paper-checkbox-ink-size').trim();if('-1px'===a){var b=this.getComputedStyleValue('--calculated-paper-checkbox-size').trim(),c=b.match(/[A-Za-z]+$/)[0]||'px',d=parseFloat(b),e=8/3*d;'px'===c&&(e=Math.floor(e),e%2!==d%2&&e++),this.updateStyles({"--paper-checkbox-ink-size":e+c})}})},_computeCheckboxClass:function(a,b){var c='';return a&&(c+='checked '),b&&(c+='invalid'),c},_computeCheckmarkClass:function(a){return a?'':'hidden'},_createRipple:function(){return this._rippleContainer=this.$.checkboxContainer,Polymer.PaperInkyFocusBehaviorImpl._createRipple.call(this)}});</script></dom-module><dom-module id="paper-radio-button" assetpath="../bower_components/paper-radio-button/"><template strip-whitespace=""><style>:host{display:inline-block;line-height:0;white-space:nowrap;cursor:pointer;@apply --paper-font-common-base;--calculated-paper-radio-button-size:var(--paper-radio-button-size, 16px);--calculated-paper-radio-button-ink-size:var(--paper-radio-button-ink-size, -1px);}:host(:focus){outline:none;}#radioContainer{@apply --layout-inline;@apply --layout-center-center;position:relative;width:var(--calculated-paper-radio-button-size);height:var(--calculated-paper-radio-button-size);vertical-align:middle;@apply --paper-radio-button-radio-container;}#ink{position:absolute;top:50%;left:50%;right:auto;width:var(--calculated-paper-radio-button-ink-size);height:var(--calculated-paper-radio-button-ink-size);color:var(--paper-radio-button-unchecked-ink-color, var(--primary-text-color));opacity:0.6;pointer-events:none;-webkit-transform:translate(-50%, -50%);transform:translate(-50%, -50%);}#ink[checked]{color:var(--paper-radio-button-checked-ink-color, var(--primary-color));}#offRadio, #onRadio{position:absolute;box-sizing:border-box;top:0;left:0;width:100%;height:100%;border-radius:50%;}#offRadio{border:2px solid var(--paper-radio-button-unchecked-color, var(--primary-text-color));background-color:var(--paper-radio-button-unchecked-background-color, transparent);transition:border-color 0.28s;}#onRadio{background-color:var(--paper-radio-button-checked-color, var(--primary-color));-webkit-transform:scale(0);transform:scale(0);transition:-webkit-transform ease 0.28s;transition:transform ease 0.28s;will-change:transform;}:host([checked]) #offRadio{border-color:var(--paper-radio-button-checked-color, var(--primary-color));}:host([checked]) #onRadio{-webkit-transform:scale(0.5);transform:scale(0.5);}#radioLabel{line-height:normal;position:relative;display:inline-block;vertical-align:middle;margin-left:var(--paper-radio-button-label-spacing, 10px);white-space:normal;color:var(--paper-radio-button-label-color, var(--primary-text-color));@apply --paper-radio-button-label;}:host([checked]) #radioLabel{@apply --paper-radio-button-label-checked;}:host-context([dir="rtl"]) #radioLabel{margin-left:0;margin-right:var(--paper-radio-button-label-spacing, 10px);}#radioLabel[hidden]{display:none;}:host([disabled]) #offRadio{border-color:var(--paper-radio-button-unchecked-color, var(--primary-text-color));opacity:0.5;}:host([disabled][checked]) #onRadio{background-color:var(--paper-radio-button-unchecked-color, var(--primary-text-color));opacity:0.5;}:host([disabled]) #radioLabel{opacity:0.65;}</style><div id="radioContainer"><div id="offRadio"></div><div id="onRadio"></div></div><div id="radioLabel"><slot></slot></div></template><script>Polymer({is:'paper-radio-button',behaviors:[Polymer.PaperCheckedElementBehavior],hostAttributes:{role:'radio',"aria-checked":!1,tabindex:0},properties:{ariaActiveAttribute:{type:String,value:'aria-checked'}},ready:function(){this._rippleContainer=this.$.radioContainer},attached:function(){Polymer.RenderStatus.afterNextRender(this,function(){var a=this.getComputedStyleValue('--calculated-paper-radio-button-ink-size').trim();if('-1px'===a){var b=parseFloat(this.getComputedStyleValue('--calculated-paper-radio-button-size').trim()),c=Math.floor(3*b);c%2!==b%2&&c++,this.updateStyles({"--paper-radio-button-ink-size":c+'px'})}})}});</script></dom-module><dom-module id="paper-radio-group" assetpath="../bower_components/paper-radio-group/"><template><style>:host{display:inline-block;}:host ::slotted(*){padding:var(--paper-radio-group-item-padding, 12px);}</style><slot></slot></template></dom-module><script>Polymer({is:'paper-radio-group',behaviors:[Polymer.IronMenubarBehavior],hostAttributes:{role:'radiogroup',tabindex:0},properties:{attrForSelected:{type:String,value:'name'},selectedAttribute:{type:String,value:'checked'},selectable:{type:String,value:'paper-radio-button'},allowEmptySelection:{type:Boolean,value:!1}},select:function(a){var b=this._valueToItem(a);if(!(b&&b.hasAttribute('disabled'))){if(this.selected){var c=this._valueToItem(this.selected);if(this.selected==a)if(this.allowEmptySelection)a='';else return void(c&&(c.checked=!0));c&&(c.checked=!1)}Polymer.IronSelectableBehavior.select.apply(this,[a]),this.fire('paper-radio-group-changed')}},_activateFocusedItem:function(){this._itemActivate(this._valueForItem(this.focusedItem),this.focusedItem)},_onUpKey:function(a){this._focusPrevious(),a.preventDefault(),this._activateFocusedItem()},_onDownKey:function(a){this._focusNext(),a.preventDefault(),this._activateFocusedItem()},_onLeftKey:function(){Polymer.IronMenubarBehaviorImpl._onLeftKey.apply(this,arguments),this._activateFocusedItem()},_onRightKey:function(){Polymer.IronMenubarBehaviorImpl._onRightKey.apply(this,arguments),this._activateFocusedItem()}});</script><script>Polymer.IronRangeBehavior={properties:{value:{type:Number,value:0,notify:!0,reflectToAttribute:!0},min:{type:Number,value:0,notify:!0},max:{type:Number,value:100,notify:!0},step:{type:Number,value:1,notify:!0},ratio:{type:Number,value:0,readOnly:!0,notify:!0}},observers:['_update(value, min, max, step)'],_calcRatio:function(a){return(this._clampValue(a)-this.min)/(this.max-this.min)},_clampValue:function(a){return Math.min(this.max,Math.max(this.min,this._calcStep(a)))},_calcStep:function(a){if(a=parseFloat(a),!this.step)return a;var b=Math.round((a-this.min)/this.step);return 1>this.step?b/(1/this.step)+this.min:b*this.step+this.min},_validateValue:function(){var a=this._clampValue(this.value);return this.value=this.oldValue=isNaN(a)?this.oldValue:a,this.value!==a},_update:function(){this._validateValue(),this._setRatio(100*this._calcRatio(this.value))}};</script><dom-module id="paper-progress" assetpath="../bower_components/paper-progress/"><template><style>:host{display:block;width:200px;position:relative;overflow:hidden;}:host([hidden]), [hidden]{display:none !important;}#progressContainer{@apply --paper-progress-container;position:relative;}#progressContainer,
      /* the stripe for the indeterminate animation*/
      .indeterminate::after{height:var(--paper-progress-height, 4px);}#primaryProgress,
      #secondaryProgress,
      .indeterminate::after{@apply --layout-fit;}#progressContainer,
      .indeterminate::after{background:var(--paper-progress-container-color, var(--google-grey-300));}:host(.transiting) #primaryProgress,
      :host(.transiting) #secondaryProgress{-webkit-transition-property:-webkit-transform;transition-property:transform;-webkit-transition-duration:var(--paper-progress-transition-duration, 0.08s);transition-duration:var(--paper-progress-transition-duration, 0.08s);-webkit-transition-timing-function:var(--paper-progress-transition-timing-function, ease);transition-timing-function:var(--paper-progress-transition-timing-function, ease);-webkit-transition-delay:var(--paper-progress-transition-delay, 0s);transition-delay:var(--paper-progress-transition-delay, 0s);}#primaryProgress,
      #secondaryProgress{@apply --layout-fit;-webkit-transform-origin:left center;transform-origin:left center;-webkit-transform:scaleX(0);transform:scaleX(0);will-change:transform;}#primaryProgress{background:var(--paper-progress-active-color, var(--google-green-500));}#secondaryProgress{background:var(--paper-progress-secondary-color, var(--google-green-100));}:host([disabled]) #primaryProgress{background:var(--paper-progress-disabled-active-color, var(--google-grey-500));}:host([disabled]) #secondaryProgress{background:var(--paper-progress-disabled-secondary-color, var(--google-grey-300));}:host(:not([disabled])) #primaryProgress.indeterminate{-webkit-transform-origin:right center;transform-origin:right center;-webkit-animation:indeterminate-bar var(--paper-progress-indeterminate-cycle-duration, 2s) linear infinite;animation:indeterminate-bar var(--paper-progress-indeterminate-cycle-duration, 2s) linear infinite;}:host(:not([disabled])) #primaryProgress.indeterminate::after{content:"";-webkit-transform-origin:center center;transform-origin:center center;-webkit-animation:indeterminate-splitter var(--paper-progress-indeterminate-cycle-duration, 2s) linear infinite;animation:indeterminate-splitter var(--paper-progress-indeterminate-cycle-duration, 2s) linear infinite;}@-webkit-keyframes indeterminate-bar{0%{-webkit-transform:scaleX(1) translateX(-100%);}50%{-webkit-transform:scaleX(1) translateX(0%);}75%{-webkit-transform:scaleX(1) translateX(0%);-webkit-animation-timing-function:cubic-bezier(.28,.62,.37,.91);}100%{-webkit-transform:scaleX(0) translateX(0%);}}@-webkit-keyframes indeterminate-splitter{0%{-webkit-transform:scaleX(.75) translateX(-125%);}30%{-webkit-transform:scaleX(.75) translateX(-125%);-webkit-animation-timing-function:cubic-bezier(.42,0,.6,.8);}90%{-webkit-transform:scaleX(.75) translateX(125%);}100%{-webkit-transform:scaleX(.75) translateX(125%);}}@keyframes indeterminate-bar{0%{transform:scaleX(1) translateX(-100%);}50%{transform:scaleX(1) translateX(0%);}75%{transform:scaleX(1) translateX(0%);animation-timing-function:cubic-bezier(.28,.62,.37,.91);}100%{transform:scaleX(0) translateX(0%);}}@keyframes indeterminate-splitter{0%{transform:scaleX(.75) translateX(-125%);}30%{transform:scaleX(.75) translateX(-125%);animation-timing-function:cubic-bezier(.42,0,.6,.8);}90%{transform:scaleX(.75) translateX(125%);}100%{transform:scaleX(.75) translateX(125%);}}</style><div id="progressContainer"><div id="secondaryProgress" hidden$="[[_hideSecondaryProgress(secondaryRatio)]]"></div><div id="primaryProgress"></div></div></template></dom-module><script>Polymer({is:'paper-progress',behaviors:[Polymer.IronRangeBehavior],properties:{secondaryProgress:{type:Number,value:0},secondaryRatio:{type:Number,value:0,readOnly:!0},indeterminate:{type:Boolean,value:!1,observer:'_toggleIndeterminate'},disabled:{type:Boolean,value:!1,reflectToAttribute:!0,observer:'_disabledChanged'}},observers:['_progressChanged(secondaryProgress, value, min, max, indeterminate)'],hostAttributes:{role:'progressbar'},_toggleIndeterminate:function(a){this.toggleClass('indeterminate',a,this.$.primaryProgress)},_transformProgress:function(a,b){a.style.transform=a.style.webkitTransform='scaleX('+b/100+')'},_mainRatioChanged:function(a){this._transformProgress(this.$.primaryProgress,a)},_progressChanged:function(a,b,c,d,e){a=this._clampValue(a),b=this._clampValue(b);var f=100*this._calcRatio(a),g=100*this._calcRatio(b);this._setSecondaryRatio(f),this._transformProgress(this.$.secondaryProgress,f),this._transformProgress(this.$.primaryProgress,g),this.secondaryProgress=a,e?this.removeAttribute('aria-valuenow'):this.setAttribute('aria-valuenow',b),this.setAttribute('aria-valuemin',c),this.setAttribute('aria-valuemax',d)},_disabledChanged:function(a){this.setAttribute('aria-disabled',a?'true':'false')},_hideSecondaryProgress:function(a){return 0===a}});</script><dom-module id="paper-slider" assetpath="../bower_components/paper-slider/"><template strip-whitespace=""><style>:host{@apply --layout;@apply --layout-justified;@apply --layout-center;width:200px;cursor:default;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);--paper-progress-active-color:var(--paper-slider-active-color, var(--google-blue-700));--paper-progress-secondary-color:var(--paper-slider-secondary-color, var(--google-blue-300));--paper-progress-disabled-active-color:var(--paper-slider-disabled-active-color, var(--paper-grey-400));--paper-progress-disabled-secondary-color:var(--paper-slider-disabled-secondary-color, var(--paper-grey-400));--calculated-paper-slider-height:var(--paper-slider-height, 2px);}:host(:focus){outline:none;}:dir(rtl) #sliderContainer{-webkit-transform:scaleX(-1);transform:scaleX(-1);}:host([dir="rtl"]) #sliderContainer{-webkit-transform:scaleX(-1);transform:scaleX(-1);}:host([dir="ltr"]) #sliderContainer{-webkit-transform:scaleX(1);transform:scaleX(1);}#sliderContainer{position:relative;width:100%;height:calc(30px + var(--calculated-paper-slider-height));margin-left:calc(15px + var(--calculated-paper-slider-height)/2);margin-right:calc(15px + var(--calculated-paper-slider-height)/2);}#sliderContainer:focus{outline:0;}#sliderContainer.editable{margin-top:12px;margin-bottom:12px;}.bar-container{position:absolute;top:0;bottom:0;left:0;right:0;overflow:hidden;}.ring > .bar-container{left:calc(5px + var(--calculated-paper-slider-height)/2);transition:left 0.18s ease;}.ring.expand.dragging > .bar-container{transition:none;}.ring.expand:not(.pin) > .bar-container{left:calc(8px + var(--calculated-paper-slider-height)/2);}#sliderBar{padding:15px 0;width:100%;background-color:var(--paper-slider-bar-color, transparent);--paper-progress-container-color:var(--paper-slider-container-color, var(--paper-grey-400));--paper-progress-height:var(--calculated-paper-slider-height);}.slider-markers{position:absolute;top:calc(14px + var(--paper-slider-height,2px)/2);height:var(--calculated-paper-slider-height);left:0;right:-1px;box-sizing:border-box;pointer-events:none;@apply --layout-horizontal;}.slider-marker{@apply --layout-flex;}.slider-markers::after,
      .slider-marker::after{content:"";display:block;margin-left:-1px;width:2px;height:var(--calculated-paper-slider-height);border-radius:50%;background-color:var(--paper-slider-markers-color, #000);}.slider-knob{position:absolute;left:0;top:0;margin-left:calc(-15px - var(--calculated-paper-slider-height)/2);width:calc(30px + var(--calculated-paper-slider-height));height:calc(30px + var(--calculated-paper-slider-height));}.transiting > .slider-knob{transition:left 0.08s ease;}.slider-knob:focus{outline:none;}.slider-knob.dragging{transition:none;}.snaps > .slider-knob.dragging{transition:-webkit-transform 0.08s ease;transition:transform 0.08s ease;}.slider-knob-inner{margin:10px;width:calc(100% - 20px);height:calc(100% - 20px);background-color:var(--paper-slider-knob-color, var(--google-blue-700));border:2px solid var(--paper-slider-knob-color, var(--google-blue-700));border-radius:50%;-moz-box-sizing:border-box;box-sizing:border-box;transition-property:-webkit-transform, background-color, border;transition-property:transform, background-color, border;transition-duration:0.18s;transition-timing-function:ease;}.expand:not(.pin) > .slider-knob > .slider-knob-inner{-webkit-transform:scale(1.5);transform:scale(1.5);}.ring > .slider-knob > .slider-knob-inner{background-color:var(--paper-slider-knob-start-color, transparent);border:2px solid var(--paper-slider-knob-start-border-color, var(--paper-grey-400));}.slider-knob-inner::before{background-color:var(--paper-slider-pin-color, var(--google-blue-700));}.pin > .slider-knob > .slider-knob-inner::before{content:"";position:absolute;top:0;left:50%;margin-left:-13px;width:26px;height:26px;border-radius:50% 50% 50% 0;-webkit-transform:rotate(-45deg) scale(0) translate(0);transform:rotate(-45deg) scale(0) translate(0);}.slider-knob-inner::before,
      .slider-knob-inner::after{transition:-webkit-transform .18s ease, background-color .18s ease;transition:transform .18s ease, background-color .18s ease;}.pin.ring > .slider-knob > .slider-knob-inner::before{background-color:var(--paper-slider-pin-start-color, var(--paper-grey-400));}.pin.expand > .slider-knob > .slider-knob-inner::before{-webkit-transform:rotate(-45deg) scale(1) translate(17px, -17px);transform:rotate(-45deg) scale(1) translate(17px, -17px);}.pin > .slider-knob > .slider-knob-inner::after{content:attr(value);position:absolute;top:0;left:50%;margin-left:-16px;width:32px;height:26px;text-align:center;color:var(--paper-slider-font-color, #fff);font-size:10px;-webkit-transform:scale(0) translate(0);transform:scale(0) translate(0);}.pin.expand > .slider-knob > .slider-knob-inner::after{-webkit-transform:scale(1) translate(0, -17px);transform:scale(1) translate(0, -17px);}.slider-input{width:50px;overflow:hidden;--paper-input-container-input:{text-align:center;@apply --paper-slider-input-container-input;};@apply --paper-slider-input;}#sliderContainer.disabled{pointer-events:none;}.disabled > .slider-knob > .slider-knob-inner{background-color:var(--paper-slider-disabled-knob-color, var(--paper-grey-400));border:2px solid var(--paper-slider-disabled-knob-color, var(--paper-grey-400));-webkit-transform:scale3d(0.75, 0.75, 1);transform:scale3d(0.75, 0.75, 1);}.disabled.ring > .slider-knob > .slider-knob-inner{background-color:var(--paper-slider-knob-start-color, transparent);border:2px solid var(--paper-slider-knob-start-border-color, var(--paper-grey-400));}paper-ripple{color:var(--paper-slider-knob-color, var(--google-blue-700));}</style><div id="sliderContainer" class$="[[_getClassNames(disabled, pin, snaps, immediateValue, min, expand, dragging, transiting, editable)]]"><div class="bar-container"><paper-progress disabled$="[[disabled]]" id="sliderBar" aria-hidden="true" min="[[min]]" max="[[max]]" step="[[step]]" value="[[immediateValue]]" secondary-progress="[[secondaryProgress]]" on-down="_bardown" on-up="_resetKnob" on-track="_onTrack"></paper-progress></div><template is="dom-if" if="[[snaps]]"><div class="slider-markers"><template is="dom-repeat" items="[[markers]]"><div class="slider-marker"></div></template></div></template><div id="sliderKnob" class="slider-knob" on-down="_knobdown" on-up="_resetKnob" on-track="_onTrack" on-transitionend="_knobTransitionEnd"><div class="slider-knob-inner" value$="[[immediateValue]]"></div></div></div><template is="dom-if" if="[[editable]]"><paper-input id="input" type="number" step="[[step]]" min="[[min]]" max="[[max]]" class="slider-input" disabled$="[[disabled]]" value="[[immediateValue]]" on-change="_changeValue" on-keydown="_inputKeyDown" no-label-float=""></paper-input></template></template><script>Polymer({is:'paper-slider',behaviors:[Polymer.IronA11yKeysBehavior,Polymer.IronFormElementBehavior,Polymer.PaperInkyFocusBehavior,Polymer.IronRangeBehavior],properties:{snaps:{type:Boolean,value:!1,notify:!0},pin:{type:Boolean,value:!1,notify:!0},secondaryProgress:{type:Number,value:0,notify:!0,observer:'_secondaryProgressChanged'},editable:{type:Boolean,value:!1},immediateValue:{type:Number,value:0,readOnly:!0,notify:!0},maxMarkers:{type:Number,value:0,notify:!0},expand:{type:Boolean,value:!1,readOnly:!0},dragging:{type:Boolean,value:!1,readOnly:!0,notify:!0},transiting:{type:Boolean,value:!1,readOnly:!0},markers:{type:Array,readOnly:!0,value:function(){return[]}}},observers:['_updateKnob(value, min, max, snaps, step)','_valueChanged(value)','_immediateValueChanged(immediateValue)','_updateMarkers(maxMarkers, min, max, snaps)'],hostAttributes:{role:'slider',tabindex:0},keyBindings:{left:'_leftKey',right:'_rightKey',"down pagedown home":'_decrementKey',"up pageup end":'_incrementKey'},increment:function(){this.value=this._clampValue(this.value+this.step)},decrement:function(){this.value=this._clampValue(this.value-this.step)},_updateKnob:function(a,b,c){this.setAttribute('aria-valuemin',b),this.setAttribute('aria-valuemax',c),this.setAttribute('aria-valuenow',a),this._positionKnob(100*this._calcRatio(a))},_valueChanged:function(){this.fire('value-change',{composed:!0})},_immediateValueChanged:function(){this.dragging?this.fire('immediate-value-change',{composed:!0}):this.value=this.immediateValue},_secondaryProgressChanged:function(){this.secondaryProgress=this._clampValue(this.secondaryProgress)},_expandKnob:function(){this._setExpand(!0)},_resetKnob:function(){this.cancelDebouncer('expandKnob'),this._setExpand(!1)},_positionKnob:function(a){this._setImmediateValue(this._calcStep(this._calcKnobPosition(a))),this._setRatio(100*this._calcRatio(this.immediateValue)),this.$.sliderKnob.style.left=this.ratio+'%',this.dragging&&(this._knobstartx=this.ratio*this._w/100,this.translate3d(0,0,0,this.$.sliderKnob))},_calcKnobPosition:function(a){return(this.max-this.min)*a/100+this.min},_onTrack:function(a){switch(a.stopPropagation(),a.detail.state){case'start':this._trackStart(a);break;case'track':this._trackX(a);break;case'end':this._trackEnd();}},_trackStart:function(){this._setTransiting(!1),this._w=this.$.sliderBar.offsetWidth,this._x=this.ratio*this._w/100,this._startx=this._x,this._knobstartx=this._startx,this._minx=-this._startx,this._maxx=this._w-this._startx,this.$.sliderKnob.classList.add('dragging'),this._setDragging(!0)},_trackX:function(a){this.dragging||this._trackStart(a);var b=this._isRTL?-1:1,c=Math.min(this._maxx,Math.max(this._minx,a.detail.dx*b));this._x=this._startx+c;var d=this._calcStep(this._calcKnobPosition(100*(this._x/this._w)));this._setImmediateValue(d);var e=this._calcRatio(this.immediateValue)*this._w-this._knobstartx;this.translate3d(e+'px',0,0,this.$.sliderKnob)},_trackEnd:function(){var a=this.$.sliderKnob.style;this.$.sliderKnob.classList.remove('dragging'),this._setDragging(!1),this._resetKnob(),this.value=this.immediateValue,a.transform=a.webkitTransform='',this.fire('change',{composed:!0})},_knobdown:function(a){this._expandKnob(),a.preventDefault(),this.focus()},_bardown:function(a){this._w=this.$.sliderBar.offsetWidth;var b=this.$.sliderBar.getBoundingClientRect(),c=100*((a.detail.x-b.left)/this._w);this._isRTL&&(c=100-c);var d=this.ratio;this._setTransiting(!0),this._positionKnob(c),this.debounce('expandKnob',this._expandKnob,60),d===this.ratio&&this._setTransiting(!1),this.async(function(){this.fire('change',{composed:!0})}),a.preventDefault(),this.focus()},_knobTransitionEnd:function(a){a.target===this.$.sliderKnob&&this._setTransiting(!1)},_updateMarkers:function(a,b,c,d){d||this._setMarkers([]);var e=Math.round((c-b)/this.step);e>a&&(e=a),(0>e||!isFinite(e))&&(e=0),this._setMarkers(Array(e))},_mergeClasses:function(a){return Object.keys(a).filter(function(b){return a[b]}).join(' ')},_getClassNames:function(){return this._mergeClasses({disabled:this.disabled,pin:this.pin,snaps:this.snaps,ring:this.immediateValue<=this.min,expand:this.expand,dragging:this.dragging,transiting:this.transiting,editable:this.editable})},get _isRTL(){return void 0===this.__isRTL&&(this.__isRTL='rtl'===window.getComputedStyle(this).direction),this.__isRTL},_leftKey:function(a){this._isRTL?this._incrementKey(a):this._decrementKey(a)},_rightKey:function(a){this._isRTL?this._decrementKey(a):this._incrementKey(a)},_incrementKey:function(a){this.disabled||('end'===a.detail.key?this.value=this.max:this.increment(),this.fire('change'),a.preventDefault())},_decrementKey:function(a){this.disabled||('home'===a.detail.key?this.value=this.min:this.decrement(),this.fire('change'),a.preventDefault())},_changeValue:function(a){this.value=a.target.value,this.fire('change',{composed:!0})},_inputKeyDown:function(a){a.stopPropagation()},_createRipple:function(){return this._rippleContainer=this.$.sliderKnob,Polymer.PaperInkyFocusBehaviorImpl._createRipple.call(this)},_focusedChanged:function(a){a&&this.ensureRipple(),this.hasRipple()&&(this._ripple.style.display=a?'':'none',this._ripple.holdDown=a)}});</script></dom-module><script>(function(e,t){"object"===("undefined"===typeof exports?"undefined":babelHelpers.typeof(exports))&&"undefined"!==typeof module?t(exports):"function"===typeof define&&define.amd?define(["exports"],t):t(e.THREE={})})(this,function(e){function t(){}function o(e,t){this.x=e||0,this.y=t||0}function i(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function s(e,t,r,a){this._x=e||0,this._y=t||0,this._z=r||0,this._w=void 0===a?1:a}function _(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0}function y(){this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function r(t,a,i,n,s,e,l,p,d,c){Object.defineProperty(this,"id",{value:S++}),this.uuid=yn.generateUUID(),this.name="",this.image=void 0===t?r.DEFAULT_IMAGE:t,this.mipmaps=[],this.mapping=void 0===a?r.DEFAULT_MAPPING:a,this.wrapS=void 0===i?1001:i,this.wrapT=void 0===n?1001:n,this.magFilter=void 0===s?1006:s,this.minFilter=void 0===e?1008:e,this.anisotropy=void 0===d?1:d,this.format=void 0===l?1023:l,this.type=void 0===p?1009:p,this.offset=new o(0,0),this.repeat=new o(1,1),this.center=new o(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new y,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0===c?3E3:c,this.version=0,this.onUpdate=null}function j(e,t,r,a){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0===a?1:a}function M(e,t,a){this.uuid=yn.generateUUID(),this.width=e,this.height=t,this.scissor=new j(0,0,e,t),this.scissorTest=!1,this.viewport=new j(0,0,e,t),a=a||{},void 0===a.minFilter&&(a.minFilter=1006),this.texture=new r(void 0,void 0,a.wrapS,a.wrapT,a.magFilter,a.minFilter,a.format,a.type,a.anisotropy,a.encoding),this.depthBuffer=!(void 0!==a.depthBuffer)||a.depthBuffer,this.stencilBuffer=!(void 0!==a.stencilBuffer)||a.stencilBuffer,this.depthTexture=void 0===a.depthTexture?null:a.depthTexture}function n(e,t,r){M.call(this,e,t,r),this.activeMipMapLevel=this.activeCubeFace=0}function l(o,i,s,l,p,e,d,u,g,f,m,t){r.call(this,null,e,d,u,g,f,l,p,m,t),this.image={data:o,width:i,height:s},this.magFilter=void 0===g?1003:g,this.minFilter=void 0===f?1003:f,this.flipY=this.generateMipmaps=!1,this.unpackAlignment=1}function p(t,a,o,i,n,e,s,l,p,d){t=void 0===t?[]:t,r.call(this,t,void 0===a?301:a,o,i,n,e,s,l,p,d),this.flipY=!1}function d(t,r,a){var o=t[0];if(0>=o||0<o)return t;var i=r*a,e=Ne[i];if(void 0===e&&(e=new Float32Array(i),Ne[i]=e),0!==r)for(o.toArray(e,0),o=1,i=0;o!==r;++o)i+=a,t[o].toArray(e,i);return e}function m(e,t){var r=He[t];void 0===r&&(r=new Int32Array(t),He[t]=r);for(var a=0;a!==t;++a)r[a]=e.allocTextureUnit();return r}function c(e,t){e.uniform1f(this.addr,t)}function u(e,t){e.uniform1i(this.addr,t)}function g(e,t){void 0===t.x?e.uniform2fv(this.addr,t):e.uniform2f(this.addr,t.x,t.y)}function f(e,t){void 0===t.x?void 0===t.r?e.uniform3fv(this.addr,t):e.uniform3f(this.addr,t.r,t.g,t.b):e.uniform3f(this.addr,t.x,t.y,t.z)}function h(e,t){void 0===t.x?e.uniform4fv(this.addr,t):e.uniform4f(this.addr,t.x,t.y,t.z,t.w)}function x(e,t){e.uniformMatrix2fv(this.addr,!1,t.elements||t)}function v(e,t){void 0===t.elements?e.uniformMatrix3fv(this.addr,!1,t):(Le.set(t.elements),e.uniformMatrix3fv(this.addr,!1,Le))}function b(e,t){void 0===t.elements?e.uniformMatrix4fv(this.addr,!1,t):(Je.set(t.elements),e.uniformMatrix4fv(this.addr,!1,Je))}function A(e,t,r){var a=r.allocTextureUnit();e.uniform1i(this.addr,a),r.setTexture2D(t||xn,a)}function w(e,t,r){var a=r.allocTextureUnit();e.uniform1i(this.addr,a),r.setTextureCube(t||Me,a)}function R(e,t){e.uniform2iv(this.addr,t)}function C(e,t){e.uniform3iv(this.addr,t)}function P(e,t){e.uniform4iv(this.addr,t)}function I(e){return 5126===e?c:35664===e?g:35665===e?f:35666===e?h:35674===e?x:35675===e?v:35676===e?b:35678===e||36198===e?A:35680===e?w:5124===e||35670===e?u:35667===e||35671===e?R:35668===e||35672===e?C:35669===e||35673===e?P:void 0}function F(e,t){e.uniform1fv(this.addr,t)}function z(e,t){e.uniform1iv(this.addr,t)}function O(e,t){e.uniform2fv(this.addr,d(t,this.size,2))}function k(e,t){e.uniform3fv(this.addr,d(t,this.size,3))}function X(e,t){e.uniform4fv(this.addr,d(t,this.size,4))}function Y(e,t){e.uniformMatrix2fv(this.addr,!1,d(t,this.size,4))}function q(e,t){e.uniformMatrix3fv(this.addr,!1,d(t,this.size,9))}function Q(e,t){e.uniformMatrix4fv(this.addr,!1,d(t,this.size,16))}function $(t,r,a){var o=r.length,i=m(a,o);for(t.uniform1iv(this.addr,i),t=0;t!==o;++t)a.setTexture2D(r[t]||xn,i[t])}function _e(t,r,a){var o=r.length,i=m(a,o);for(t.uniform1iv(this.addr,i),t=0;t!==o;++t)a.setTextureCube(r[t]||Me,i[t])}function Se(e){return 5126===e?F:35664===e?O:35665===e?k:35666===e?X:35674===e?Y:35675===e?q:35676===e?Q:35678===e?$:35680===e?_e:5124===e||35670===e?z:35667===e||35671===e?R:35668===e||35672===e?C:35669===e||35673===e?P:void 0}function a(e,t,r){this.id=e,this.addr=r,this.setValue=I(t.type)}function Pe(e,t,r){this.id=e,this.addr=r,this.size=t.size,this.setValue=Se(t.type)}function Ie(e){this.id=e,this.seq=[],this.map={}}function Re(r,o,i){this.seq=[],this.map={},this.renderer=i,i=r.getProgramParameter(o,r.ACTIVE_UNIFORMS);for(var s=0;s<i;++s){var l=r.getActiveUniform(o,s),e=r.getUniformLocation(o,l.name),p=this,d=l.name,c=d.length;for(Ke.lastIndex=0;;){var u=Ke.exec(d),m=Ke.lastIndex,t=u[1],n=u[3];if("]"===u[2]&&(t|=0),void 0===n||"["===n&&m+2===c){d=p,l=void 0===n?new a(t,l,e):new Pe(t,l,e),d.seq.push(l),d.map[l.id]=l;break}else n=p.map[t],void 0===n&&(n=new Ie(t),t=p,p=n,t.seq.push(p),t.map[p.id]=p),p=n}}}function Oe(e,t,r){return void 0===t&&void 0===r?this.set(e):this.setRGB(e,t,r)}function G(t,a,o,i,n,e,s,l,p){r.call(this,t,a,o,i,n,e,s,l,p),this.needsUpdate=!0}function Qe(o,a,i,c,p){function e(e,t){return e.renderOrder===t.renderOrder?e.z===t.z?t.id-e.id:t.z-e.z:e.renderOrder-t.renderOrder}var d=new _,u=new s,b=new _,E,f,g,h,T,m,t,n,v,r,S,l,w,x,L,A,y,R,C,N,U,D;this.render=function(s,_,F){if(0!==s.length){if(void 0===U){var z=new Float32Array([-0.5,-0.5,0,0,0.5,-0.5,1,0,0.5,0.5,1,1,-0.5,0.5,0,1]),M=new Uint16Array([0,1,2,0,2,3]);C=a.createBuffer(),N=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,C),a.bufferData(a.ARRAY_BUFFER,z,a.STATIC_DRAW),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,N),a.bufferData(a.ELEMENT_ARRAY_BUFFER,M,a.STATIC_DRAW),z=a.createProgram(),M=a.createShader(a.VERTEX_SHADER);var B=a.createShader(a.FRAGMENT_SHADER);a.shaderSource(M,["precision "+p.precision+" float;","#define SHADER_NAME SpriteMaterial\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 center;\nuniform vec2 scale;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float fogDepth;\nvoid main() {\n\tvUV = uvOffset + uv * uvScale;\n\tvec2 alignedPosition = ( position - center ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tvec4 mvPosition;\n\tmvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\tfogDepth = - mvPosition.z;\n}"].join("\n")),a.shaderSource(B,["precision "+p.precision+" float;","#define SHADER_NAME SpriteMaterial\nuniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvarying float fogDepth;\nvoid main() {\n\tvec4 texture = texture2D( map, vUV );\n\tgl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\n\tif ( gl_FragColor.a < alphaTest ) discard;\n\tif ( fogType > 0 ) {\n\t\tfloat fogFactor = 0.0;\n\t\tif ( fogType == 1 ) {\n\t\t\tfogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t\t} else {\n\t\t\tconst float LOG2 = 1.442695;\n\t\t\tfogFactor = exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 );\n\t\t\tfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n\t\t}\n\t\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n\t}\n}"].join("\n")),a.compileShader(M),a.compileShader(B),a.attachShader(z,M),a.attachShader(z,B),a.linkProgram(z),U=z,y=a.getAttribLocation(U,"position"),R=a.getAttribLocation(U,"uv"),E=a.getUniformLocation(U,"uvOffset"),f=a.getUniformLocation(U,"uvScale"),g=a.getUniformLocation(U,"rotation"),h=a.getUniformLocation(U,"center"),T=a.getUniformLocation(U,"scale"),m=a.getUniformLocation(U,"color"),t=a.getUniformLocation(U,"map"),n=a.getUniformLocation(U,"opacity"),v=a.getUniformLocation(U,"modelViewMatrix"),r=a.getUniformLocation(U,"projectionMatrix"),S=a.getUniformLocation(U,"fogType"),l=a.getUniformLocation(U,"fogDensity"),w=a.getUniformLocation(U,"fogNear"),x=a.getUniformLocation(U,"fogFar"),L=a.getUniformLocation(U,"fogColor"),a.getUniformLocation(U,"fogDepth"),A=a.getUniformLocation(U,"alphaTest"),z=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),z.width=8,z.height=8,M=z.getContext("2d"),M.fillStyle="white",M.fillRect(0,0,8,8),D=new G(z)}i.useProgram(U),i.initAttributes(),i.enableAttribute(y),i.enableAttribute(R),i.disableUnusedAttributes(),i.disable(a.CULL_FACE),i.enable(a.BLEND),a.bindBuffer(a.ARRAY_BUFFER,C),a.vertexAttribPointer(y,2,a.FLOAT,!1,16,0),a.vertexAttribPointer(R,2,a.FLOAT,!1,16,8),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,N),a.uniformMatrix4fv(r,!1,F.projectionMatrix.elements),i.activeTexture(a.TEXTURE0),a.uniform1i(t,0),M=z=0,(B=_.fog)?(a.uniform3f(L,B.color.r,B.color.g,B.color.b),B.isFog?(a.uniform1f(w,B.near),a.uniform1f(x,B.far),a.uniform1i(S,1),M=z=1):B.isFogExp2&&(a.uniform1f(l,B.density),a.uniform1i(S,2),M=z=2)):(a.uniform1i(S,0),M=z=0);for(var P=0,O=s.length;P<O;P++)B=s[P],B.modelViewMatrix.multiplyMatrices(F.matrixWorldInverse,B.matrixWorld),B.z=-B.modelViewMatrix.elements[14];s.sort(e);for(var H=[],I=[],P=0,O=s.length;P<O;P++){B=s[P];var V=B.material;if(!1!==V.visible){B.onBeforeRender(o,_,F,void 0,V,void 0),a.uniform1f(A,V.alphaTest),a.uniformMatrix4fv(v,!1,B.modelViewMatrix.elements),B.matrixWorld.decompose(d,u,b),H[0]=b.x,H[1]=b.y,I[0]=B.center.x-.5,I[1]=B.center.y-.5;var k=0;_.fog&&V.fog&&(k=M),z!==k&&(a.uniform1i(S,k),z=k),null===V.map?(a.uniform2f(E,0,0),a.uniform2f(f,1,1)):(a.uniform2f(E,V.map.offset.x,V.map.offset.y),a.uniform2f(f,V.map.repeat.x,V.map.repeat.y)),a.uniform1f(n,V.opacity),a.uniform3f(m,V.color.r,V.color.g,V.color.b),a.uniform1f(g,V.rotation),a.uniform2fv(h,I),a.uniform2fv(T,H),i.setBlending(V.blending,V.blendEquation,V.blendSrc,V.blendDst,V.blendEquationAlpha,V.blendSrcAlpha,V.blendDstAlpha,V.premultipliedAlpha),i.buffers.depth.setTest(V.depthTest),i.buffers.depth.setMask(V.depthWrite),i.buffers.color.setMask(V.colorWrite),c.setTexture2D(V.map||D,0),a.drawElements(a.TRIANGLES,6,a.UNSIGNED_SHORT,0),B.onAfterRender(o,_,F,void 0,V,void 0)}}i.enable(a.CULL_FACE),i.reset()}}}function et(){Object.defineProperty(this,"id",{value:bn++}),this.uuid=yn.generateUUID(),this.name="",this.type="Material",this.lights=this.fog=!0,this.blending=1,this.side=0,this.flatShading=!1,this.vertexColors=0,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null,this.depthFunc=3,this.depthWrite=this.depthTest=!0,this.clippingPlanes=null,this.clipShadows=this.clipIntersection=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetUnits=this.polygonOffsetFactor=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this.userData={},this.needsUpdate=!0}function tt(e){et.call(this),this.type="MeshDepthMaterial",this.depthPacking=3200,this.morphTargets=this.skinning=!1,this.displacementMap=this.alphaMap=this.map=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.lights=this.fog=!1,this.setValues(e)}function rt(e){et.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new _,this.nearDistance=1,this.farDistance=1E3,this.morphTargets=this.skinning=!1,this.displacementMap=this.alphaMap=this.map=null,this.displacementScale=1,this.displacementBias=0,this.lights=this.fog=!1,this.setValues(e)}function at(e,t){this.min=void 0===e?new _(Infinity,Infinity,Infinity):e,this.max=void 0===t?new _(-Infinity,-Infinity,-Infinity):t}function ot(e,t){this.center=void 0===e?new _:e,this.radius=void 0===t?0:t}function it(e,t){this.normal=void 0===e?new _(1,0,0):e,this.constant=void 0===t?0:t}function nt(t,r,a,o,i,e){this.planes=[void 0===t?new it:t,void 0===r?new it:r,void 0===a?new it:a,void 0===o?new it:o,void 0===i?new it:i,void 0===e?new it:e]}function st(s,a,p){function u(a,o,i,l,e,p){var c=a.geometry,u=t,g=a.customDepthMaterial;return i&&(u=n,g=a.customDistanceMaterial),g?u=g:(g=!1,o.morphTargets&&(c&&c.isBufferGeometry?g=c.morphAttributes&&c.morphAttributes.position&&0<c.morphAttributes.position.length:c&&c.isGeometry&&(g=c.morphTargets&&0<c.morphTargets.length)),a.isSkinnedMesh&&!1===o.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",a),a=a.isSkinnedMesh&&o.skinning,c=0,g&&(c|=1),a&&(c|=2),u=u[c]),s.localClippingEnabled&&!0===o.clipShadows&&0!==o.clippingPlanes.length&&(c=u.uuid,g=o.uuid,a=v[c],void 0===a&&(a={},v[c]=a),c=a[g],void 0===c&&(c=u.clone(),a[g]=c),u=c),u.visible=o.visible,u.wireframe=o.wireframe,u.side=null==o.shadowSide?r[o.side]:o.shadowSide,u.clipShadows=o.clipShadows,u.clippingPlanes=o.clippingPlanes,u.clipIntersection=o.clipIntersection,u.wireframeLinewidth=o.wireframeLinewidth,u.linewidth=o.linewidth,i&&u.isMeshDistanceMaterial&&(u.referencePosition.copy(l),u.nearDistance=e,u.farDistance=p),u}function b(t,o,i,p){var d;if(!1!==t.visible){if(t.layers.test(o.layers)&&(t.isMesh||t.isLine||t.isPoints)&&t.castShadow&&(!t.frustumCulled||e.intersectsObject(t))){t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld);var c=a.update(t),n=t.material;if(Array.isArray(n))for(var m=c.groups,r=0,g=m.length,l;r<g;r++)l=m[r],(d=n[l.materialIndex])&&d.visible&&(d=u(t,d,p,T,i.near,i.far),s.renderBufferDirect(i,null,c,d,t,l));else n.visible&&(d=u(t,n,p,T,i.near,i.far),s.renderBufferDirect(i,null,c,d,t,null))}for(t=t.children,c=0,n=t.length;c<n;c++)b(t[c],o,i,p)}}var e=new nt,f=new i,g=new o,h=new o(p,p),E=new _,T=new _,t=[,,,,],n=[,,,,],v={},r={0:1,1:0,2:2},m=[new _(1,0,0),new _(-1,0,0),new _(0,0,1),new _(0,0,-1),new _(0,1,0),new _(0,-1,0)],l=[new _(0,1,0),new _(0,1,0),new _(0,1,0),new _(0,1,0),new _(0,0,1),new _(0,0,-1)],S=[new j,new j,new j,new j,new j,new j];for(p=0;4!==p;++p){var d=0!==(1&p),c=0!==(2&p),x=new tt({depthPacking:3201,morphTargets:d,skinning:c});t[p]=x,d=new rt({morphTargets:d,skinning:c}),n[p]=d}var w=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(t,a,o){if(!1!==w.enabled&&(!1!==w.autoUpdate||!1!==w.needsUpdate)&&0!==t.length){var i=s.state;i.disable(s.context.BLEND),i.buffers.color.setClear(1,1,1,1),i.buffers.depth.setTest(!0),i.setScissorTest(!1);for(var n=0,r=t.length,d,c;n<r;n++){c=t[n],d=c.shadow;var y=c&&c.isPointLight;if(void 0===d)console.warn("THREE.WebGLShadowMap:",c,"has no shadow.");else{var u=d.camera;if(g.copy(d.mapSize),g.min(h),y){var p=g.x,x=g.y;S[0].set(2*p,x,p,x),S[1].set(0,x,p,x),S[2].set(3*p,x,p,x),S[3].set(p,x,p,x),S[4].set(3*p,0,p,x),S[5].set(p,0,p,x),g.x*=4,g.y*=2}for(null===d.map&&(d.map=new M(g.x,g.y,{minFilter:1003,magFilter:1003,format:1023}),d.map.texture.name=c.name+".shadowMap",u.updateProjectionMatrix()),d.isSpotLightShadow&&d.update(c),p=d.map,x=d.matrix,T.setFromMatrixPosition(c.matrixWorld),u.position.copy(T),y?(d=6,x.makeTranslation(-T.x,-T.y,-T.z)):(d=1,E.setFromMatrixPosition(c.target.matrixWorld),u.lookAt(E),u.updateMatrixWorld(),x.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),x.multiply(u.projectionMatrix),x.multiply(u.matrixWorldInverse)),s.setRenderTarget(p),s.clear(),c=0;c<d;c++)y&&(E.copy(u.position),E.add(m[c]),u.up.copy(l[c]),u.lookAt(E),u.updateMatrixWorld(),i.viewport(S[c])),f.multiplyMatrices(u.projectionMatrix,u.matrixWorldInverse),e.setFromMatrix(f),b(a,o,u,y)}}w.needsUpdate=!1}}}function Te(t){var r={};return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r[e.uuid]},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);var a=r[e.uuid];a&&(t.deleteBuffer(a.buffer),delete r[e.uuid])},update:function(a,o){a.isInterleavedBufferAttribute&&(a=a.data);var i=r[a.uuid];if(void 0===i){var i=a.uuid,e=a.array,n=a.dynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW,s=t.createBuffer();t.bindBuffer(o,s),t.bufferData(o,e,n),a.onUploadCallback(),o=t.FLOAT,e instanceof Float32Array?o=t.FLOAT:e instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):e instanceof Uint16Array?o=t.UNSIGNED_SHORT:e instanceof Int16Array?o=t.SHORT:e instanceof Uint32Array?o=t.UNSIGNED_INT:e instanceof Int32Array?o=t.INT:e instanceof Int8Array?o=t.BYTE:e instanceof Uint8Array&&(o=t.UNSIGNED_BYTE),r[i]={buffer:s,type:o,bytesPerElement:e.BYTES_PER_ELEMENT,version:a.version}}else i.version<a.version&&(e=a,s=e.array,n=e.updateRange,t.bindBuffer(o,i.buffer),!1===e.dynamic?t.bufferData(o,s,t.STATIC_DRAW):-1===n.count?t.bufferSubData(o,0,s):0===n.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(t.bufferSubData(o,n.offset*s.BYTES_PER_ELEMENT,s.subarray(n.offset,n.offset+n.count)),n.count=-1),i.version=a.version)}}}function lt(e,t,r,a){this._x=e||0,this._y=t||0,this._z=r||0,this._order=a||lt.DefaultOrder}function pt(){this.mask=1}function dt(){Object.defineProperty(this,"id",{value:En++}),this.uuid=yn.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=dt.DefaultUp.clone();var e=new _,t=new lt,r=new s,o=new _(1,1,1);t.onChange(function(){r.setFromEuler(t,!1)}),r.onChange(function(){t.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:e},rotation:{enumerable:!0,value:t},quaternion:{enumerable:!0,value:r},scale:{enumerable:!0,value:o},modelViewMatrix:{value:new i},normalMatrix:{value:new y}}),this.matrix=new i,this.matrixWorld=new i,this.matrixAutoUpdate=dt.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new pt,this.visible=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function ct(){dt.call(this),this.type="Camera",this.matrixWorldInverse=new i,this.projectionMatrix=new i}function mt(t,r,a,o,i,e){ct.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=r,this.top=a,this.bottom=o,this.near=void 0===i?.1:i,this.far=void 0===e?2E3:e,this.updateProjectionMatrix()}function ut(t,r,a,o,i,e){this.a=t,this.b=r,this.c=a,this.normal=o&&o.isVector3?o:new _,this.vertexNormals=Array.isArray(o)?o:[],this.color=i&&i.isColor?i:new Oe,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0===e?0:e}function gt(){Object.defineProperty(this,"id",{value:Tn+=2}),this.uuid=yn.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingSphere=this.boundingBox=null,this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.verticesNeedUpdate=this.elementsNeedUpdate=!1}function ft(e,t,r){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.uuid=yn.generateUUID(),this.name="",this.array=e,this.itemSize=t,this.count=void 0===e?0:e.length/t,this.normalized=!0===r,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.onUploadCallback=function(){},this.version=0}function L(e,t,r){ft.call(this,new Int8Array(e),t,r)}function ht(e,t,r){ft.call(this,new Uint8Array(e),t,r)}function yt(e,t,r){ft.call(this,new Uint8ClampedArray(e),t,r)}function xt(e,t,r){ft.call(this,new Int16Array(e),t,r)}function vt(e,t,r){ft.call(this,new Uint16Array(e),t,r)}function _t(e,t,r){ft.call(this,new Int32Array(e),t,r)}function bt(e,t,r){ft.call(this,new Uint32Array(e),t,r)}function Et(e,t,r){ft.call(this,new Float32Array(e),t,r)}function D(e,t,r){ft.call(this,new Float64Array(e),t,r)}function Tt(){this.indices=[],this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingSphere=this.boundingBox=null,this.groupsNeedUpdate=this.uvsNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.verticesNeedUpdate=!1}function Ue(e){if(0===e.length)return-Infinity;for(var t=e[0],r=1,a=e.length;r<a;++r)e[r]>t&&(t=e[r]);return t}function St(){Object.defineProperty(this,"id",{value:Sn+=2}),this.uuid=yn.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingSphere=this.boundingBox=null,this.drawRange={start:0,count:Infinity}}function Mt(t,r,o,i,n,s){gt.call(this),this.type="BoxGeometry",this.parameters={width:t,height:r,depth:o,widthSegments:i,heightSegments:n,depthSegments:s},this.fromBufferGeometry(new At(t,r,o,i,n,s)),this.mergeVertices()}function At(o,i,s,l,p,u){function y(r,a,o,i,s,e,p,d,l,c,f){var b=e/l,T=p/c,y=e/2,u=p/2;p=l+1;var S=e=0,M=new _,w,A;for(A=0;A<c+1;A++){var R=A*T-u;for(w=0;w<p;w++)M[r]=(w*b-y)*i,M[a]=R*s,M[o]=d/2,E.push(M.x,M.y,M.z),M[r]=0,M[a]=0,M[o]=0<d?1:-1,m.push(M.x,M.y,M.z),t.push(w/l),t.push(1-A/c),e+=1}for(A=0;A<c;A++)for(w=0;w<l;w++)r=n+w+p*(A+1),a=n+(w+1)+p*(A+1),o=n+(w+1)+p*A,h.push(n+w+p*A,r,o),h.push(r,a,o),S+=6;x.addGroup(v,S,f),v+=S,n+=e}St.call(this),this.type="BoxBufferGeometry",this.parameters={width:o,height:i,depth:s,widthSegments:l,heightSegments:p,depthSegments:u};var x=this;o=o||1,i=i||1,s=s||1,l=hn(l)||1,p=hn(p)||1,u=hn(u)||1;var h=[],E=[],m=[],t=[],n=0,v=0;y("z","y","x",-1,-1,s,i,o,u,p,0),y("z","y","x",1,-1,s,i,-o,u,p,1),y("x","z","y",1,1,o,s,i,l,u,2),y("x","z","y",1,-1,o,s,-i,l,u,3),y("x","y","z",1,-1,o,i,s,l,p,4),y("x","y","z",-1,-1,o,i,-s,l,p,5),this.setIndex(h),this.addAttribute("position",new Et(E,3)),this.addAttribute("normal",new Et(m,3)),this.addAttribute("uv",new Et(t,2))}function wt(e,t,r,o){gt.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:o},this.fromBufferGeometry(new Rt(e,t,r,o)),this.mergeVertices()}function Rt(o,i,s,p){St.call(this),this.type="PlaneBufferGeometry",this.parameters={width:o,height:i,widthSegments:s,heightSegments:p},o=o||1,i=i||1;var u=o/2,e=i/2;s=hn(s)||1,p=hn(p)||1;var f=s+1,g=p+1,h=o/s,y=i/p,m=[],t=[],n=[],x=[];for(o=0;o<g;o++){var r=o*y-e;for(i=0;i<f;i++)t.push(i*h-u,-r,0),n.push(0,0,1),x.push(i/s),x.push(1-o/p)}for(o=0;o<p;o++)for(i=0;i<s;i++)u=i+f*(o+1),e=i+1+f*(o+1),g=i+1+f*o,m.push(i+f*o,u,g),m.push(u,e,g);this.setIndex(m),this.addAttribute("position",new Et(t,3)),this.addAttribute("normal",new Et(n,3)),this.addAttribute("uv",new Et(x,2))}function Lt(e){et.call(this),this.type="MeshBasicMaterial",this.color=new Oe(16777215),this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.envMap=this.alphaMap=this.specularMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.lights=this.morphTargets=this.skinning=!1,this.setValues(e)}function Ct(e){et.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.morphNormals=this.morphTargets=this.skinning=this.clipping=this.lights=this.fog=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function Pt(e,t){this.origin=void 0===e?new _:e,this.direction=void 0===t?new _:t}function It(e,t){this.start=void 0===e?new _:e,this.end=void 0===t?new _:t}function Nt(e,t,r){this.a=void 0===e?new _:e,this.b=void 0===t?new _:t,this.c=void 0===r?new _:r}function Ut(e,t){dt.call(this),this.type="Mesh",this.geometry=void 0===e?new St:e,this.material=void 0===t?new Lt({color:16777215*Math.random()}):t,this.drawMode=0,this.updateMorphTargets()}function Dt(t,r,a,o){function i(e,t){r.buffers.color.setClear(e.r,e.g,e.b,t,o)}var e=new Oe(0),n=0,s,l,p;return{getClearColor:function(){return e},setClearColor:function(t,r){e.set(t),n=void 0===r?1:r,i(e,n)},getClearAlpha:function(){return n},setClearAlpha:function(t){n=t,i(e,n)},render:function(o,c,d,m){c=c.background,null===c?i(e,n):c&&c.isColor&&(i(c,1),m=!0),(t.autoClear||m)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),c&&c.isCubeTexture?(void 0===p&&(p=new Ut(new At(1,1,1),new Ct({uniforms:U.cube.uniforms,vertexShader:U.cube.vertexShader,fragmentShader:U.cube.fragmentShader,side:1,depthTest:!0,depthWrite:!1,fog:!1})),p.geometry.removeAttribute("normal"),p.geometry.removeAttribute("uv"),p.onBeforeRender=function(e,t,r){this.matrixWorld.copyPosition(r.matrixWorld)},a.update(p.geometry)),p.material.uniforms.tCube.value=c,o.push(p,p.geometry,p.material,0,null)):c&&c.isTexture&&(void 0===s&&(s=new mt(-1,1,1,-1,0,1),l=new Ut(new Rt(2,2),new Lt({depthTest:!1,depthWrite:!1,fog:!1})),a.update(l.geometry)),l.material.map=c,t.renderBufferDirect(s,null,l.geometry,l.material,l,null))}}}function Bt(e,t){return e.renderOrder===t.renderOrder?e.program&&t.program&&e.program!==t.program?e.program.id-t.program.id:e.material.id===t.material.id?e.z===t.z?e.id-t.id:e.z-t.z:e.material.id-t.material.id:e.renderOrder-t.renderOrder}function Ft(e,t){return e.renderOrder===t.renderOrder?e.z===t.z?e.id-t.id:t.z-e.z:e.renderOrder-t.renderOrder}function zt(){var t=[],r=0,a=[],o=[];return{opaque:a,transparent:o,init:function(){r=0,a.length=0,o.length=0},push:function(i,n,s,l,p){var d=t[r];void 0===d?(d={id:i.id,object:i,geometry:n,material:s,program:s.program,renderOrder:i.renderOrder,z:l,group:p},t[r]=d):(d.id=i.id,d.object=i,d.geometry=n,d.material=s,d.program=s.program,d.renderOrder=i.renderOrder,d.z=l,d.group=p),(!0===s.transparent?o:a).push(d),r++},sort:function(){1<a.length&&a.sort(Bt),1<o.length&&o.sort(Ft)}}}function Gt(){var e={};return{get:function(t,r){return t=t.id+","+r.id,r=e[t],void 0===r&&(r=new zt,e[t]=r),r},dispose:function(){e={}}}}function Ot(e,t){return fn(t[1])-fn(e[1])}function Ht(r){var a={},o=new Float32Array(8);return{update:function(i,s,e,l){var p=i.morphTargetInfluences,d=p.length;if(i=a[s.id],void 0===i){i=[];for(var c=0;c<d;c++)i[c]=[c,0];a[s.id]=i}var m=e.morphTargets&&s.morphAttributes.position;for(e=e.morphNormals&&s.morphAttributes.normal,c=0;c<d;c++){var t=i[c];0!==t[1]&&(m&&s.removeAttribute("morphTarget"+c),e&&s.removeAttribute("morphNormal"+c))}for(c=0;c<d;c++)t=i[c],t[0]=c,t[1]=p[c];for(i.sort(Ot),c=0;8>c;c++){if((t=i[c])&&(p=t[0],t=t[1])){m&&s.addAttribute("morphTarget"+c,m[p]),e&&s.addAttribute("morphNormal"+c,e[p]),o[c]=t;continue}o[c]=0}l.getUniforms().setValue(r,"morphTargetInfluences",o)}}}function Vt(t,r,a){var o,i,e;this.setMode=function(e){o=e},this.setIndex=function(t){i=t.type,e=t.bytesPerElement},this.render=function(r,n){t.drawElements(o,n,i,r*e),a.calls++,a.vertices+=n,o===t.TRIANGLES?a.faces+=n/3:o===t.POINTS&&(a.points+=n)},this.renderInstances=function(n,s,l){var p=r.get("ANGLE_instanced_arrays");null===p?console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays."):(p.drawElementsInstancedANGLE(o,l,i,s*e,n.maxInstancedCount),a.calls++,a.vertices+=l*n.maxInstancedCount,o===t.TRIANGLES?a.faces+=n.maxInstancedCount*l/3:o===t.POINTS&&(a.points+=n.maxInstancedCount*l))}}function kt(t,r,a){var o;this.setMode=function(e){o=e},this.render=function(e,r){t.drawArrays(o,e,r),a.calls++,a.vertices+=r,o===t.TRIANGLES?a.faces+=r/3:o===t.POINTS&&(a.points+=r)},this.renderInstances=function(i,e,n){var s=r.get("ANGLE_instanced_arrays");if(null===s)console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{var l=i.attributes.position;l.isInterleavedBufferAttribute?(n=l.data.count,s.drawArraysInstancedANGLE(o,0,n,i.maxInstancedCount)):s.drawArraysInstancedANGLE(o,e,n,i.maxInstancedCount),a.calls++,a.vertices+=n*i.maxInstancedCount,o===t.TRIANGLES?a.faces+=i.maxInstancedCount*n/3:o===t.POINTS&&(a.points+=i.maxInstancedCount*n)}}}function Wt(o,i,t){function r(e){e=e.target;var a=n[e.id];for(var o in null!==a.index&&i.remove(a.index),a.attributes)i.remove(a.attributes[o]);e.removeEventListener("dispose",r),delete n[e.id],(o=s[e.id])&&(i.remove(o),delete s[e.id]),(o=s[a.id])&&(i.remove(o),delete s[a.id]),t.geometries--}var n={},s={};return{get:function(e,a){var o=n[a.id];return o?o:(a.addEventListener("dispose",r),a.isBufferGeometry?o=a:a.isGeometry&&(void 0===a._bufferGeometry&&(a._bufferGeometry=new St().setFromObject(e)),o=a._bufferGeometry),n[a.id]=o,t.geometries++,o)},update:function(t){var r=t.index,a=t.attributes;for(var e in null!==r&&i.update(r,o.ELEMENT_ARRAY_BUFFER),a)i.update(a[e],o.ARRAY_BUFFER);for(e in t=t.morphAttributes,t)for(var r=t[e],a=0,n=r.length;a<n;a++)i.update(r[a],o.ARRAY_BUFFER)},getWireframeAttribute:function(a){var l=s[a.id];if(l)return l;l=[];var p=a.index,e=a.attributes;if(null!==p)for(var d=p.array,t=0,n=d.length,c;t<n;t+=3)c=d[t+0],e=d[t+1],p=d[t+2],l.push(c,e,e,p,p,c);else for(d=e.position.array,t=0,n=d.length/3-1;t<n;t+=3)c=t+0,e=t+1,p=t+2,l.push(c,e,e,p,p,c);return l=new(65535<Ue(l)?bt:vt)(l,1),i.update(l,o.ELEMENT_ARRAY_BUFFER),s[a.id]=l}}}function jt(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];switch(t.type){case"DirectionalLight":var r={direction:new _,color:new Oe,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new o};break;case"SpotLight":r={position:new _,direction:new _,color:new Oe,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new o};break;case"PointLight":r={position:new _,color:new Oe,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new o,shadowCameraNear:1,shadowCameraFar:1E3};break;case"HemisphereLight":r={direction:new _,skyColor:new Oe,groundColor:new Oe};break;case"RectAreaLight":r={color:new Oe,position:new _,halfWidth:new _,halfHeight:new _};}return e[t.id]=r}}}function Xt(){var o=new jt,a={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},s=new _,c=new i,d=new i;return{setup:function(e,i,g){for(var f=0,m=0,t=0,n=0,h=0,r=0,l=0,u=0,p=g.matrixWorldInverse,x=0,v=e.length,_,b;x<v;x++){b=e[x],_=b.color;var y=b.intensity,E=b.distance,T=b.shadow&&b.shadow.map?b.shadow.map.texture:null;b.isAmbientLight?(f+=_.r*y,m+=_.g*y,t+=_.b*y):b.isDirectionalLight?(g=o.get(b),g.color.copy(b.color).multiplyScalar(b.intensity),g.direction.setFromMatrixPosition(b.matrixWorld),s.setFromMatrixPosition(b.target.matrixWorld),g.direction.sub(s),g.direction.transformDirection(p),(g.shadow=b.castShadow)&&(_=b.shadow,g.shadowBias=_.bias,g.shadowRadius=_.radius,g.shadowMapSize=_.mapSize),a.directionalShadowMap[n]=T,a.directionalShadowMatrix[n]=b.shadow.matrix,a.directional[n]=g,n++):b.isSpotLight?(g=o.get(b),g.position.setFromMatrixPosition(b.matrixWorld),g.position.applyMatrix4(p),g.color.copy(_).multiplyScalar(y),g.distance=E,g.direction.setFromMatrixPosition(b.matrixWorld),s.setFromMatrixPosition(b.target.matrixWorld),g.direction.sub(s),g.direction.transformDirection(p),g.coneCos=gn(b.angle),g.penumbraCos=gn(b.angle*(1-b.penumbra)),g.decay=0===b.distance?0:b.decay,(g.shadow=b.castShadow)&&(_=b.shadow,g.shadowBias=_.bias,g.shadowRadius=_.radius,g.shadowMapSize=_.mapSize),a.spotShadowMap[r]=T,a.spotShadowMatrix[r]=b.shadow.matrix,a.spot[r]=g,r++):b.isRectAreaLight?(g=o.get(b),g.color.copy(_).multiplyScalar(y),g.position.setFromMatrixPosition(b.matrixWorld),g.position.applyMatrix4(p),d.identity(),c.copy(b.matrixWorld),c.premultiply(p),d.extractRotation(c),g.halfWidth.set(.5*b.width,0,0),g.halfHeight.set(0,.5*b.height,0),g.halfWidth.applyMatrix4(d),g.halfHeight.applyMatrix4(d),a.rectArea[l]=g,l++):b.isPointLight?(g=o.get(b),g.position.setFromMatrixPosition(b.matrixWorld),g.position.applyMatrix4(p),g.color.copy(b.color).multiplyScalar(b.intensity),g.distance=b.distance,g.decay=0===b.distance?0:b.decay,(g.shadow=b.castShadow)&&(_=b.shadow,g.shadowBias=_.bias,g.shadowRadius=_.radius,g.shadowMapSize=_.mapSize,g.shadowCameraNear=_.camera.near,g.shadowCameraFar=_.camera.far),a.pointShadowMap[h]=T,a.pointShadowMatrix[h]=b.shadow.matrix,a.point[h]=g,h++):b.isHemisphereLight&&(g=o.get(b),g.direction.setFromMatrixPosition(b.matrixWorld),g.direction.transformDirection(p),g.direction.normalize(),g.skyColor.copy(b.color).multiplyScalar(y),g.groundColor.copy(b.groundColor).multiplyScalar(y),a.hemi[u]=g,u++)}a.ambient[0]=f,a.ambient[1]=m,a.ambient[2]=t,a.directional.length=n,a.spot.length=r,a.rectArea.length=l,a.point.length=h,a.hemi.length=u,a.hash=n+","+h+","+r+","+l+","+u+","+i.length},state:a}}function Yt(t,r){var a={};return{update:function(o){var i=r.frame,e=o.geometry,n=t.get(o,e);return a[n.id]!==i&&(e.isGeometry&&n.updateFromObject(o),t.update(n),a[n.id]=i),n},dispose:function(){a={}}}}function qt(e){e=e.split("\n");for(var t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}function Zt(e,t,r){var a=e.createShader(t);return e.shaderSource(a,r),e.compileShader(a),!1===e.getShaderParameter(a,e.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==e.getShaderInfoLog(a)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",t===e.VERTEX_SHADER?"vertex":"fragment",e.getShaderInfoLog(a),qt(r)),a}function Ve(e){switch(e){case 3E3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw Error("unsupported encoding: "+e);}}function We(e,t){return t=Ve(t),"vec4 "+e+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"}function Jt(e,t){return t=Ve(t),"vec4 "+e+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function Qt(e,t){switch(t){case 1:t="Linear";break;case 2:t="Reinhard";break;case 3:t="Uncharted2";break;case 4:t="OptimizedCineon";break;default:throw Error("unsupported toneMapping: "+t);}return"vec3 "+e+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function Kt(e,t,r){return e=e||{},[e.derivatives||t.envMapCubeUV||t.bumpMap||t.normalMap||t.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&r.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&r.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&r.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(er).join("\n")}function $t(e){var t=[],r;for(r in e){var a=e[r];!1!==a&&t.push("#define "+r+" "+a)}return t.join("\n")}function er(e){return""!==e}function tr(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights)}function Xe(e){return e.replace(/^[ \t]*#include +<([\w\d.]+)>/gm,function(e,t){if(e=Aa[t],void 0===e)throw Error("Can not resolve #include <"+t+">");return Xe(e)})}function rr(e){return e.replace(/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(t,r,a,o){for(t="",r=parseInt(r);r<parseInt(a);r++)t+=o.replace(/\[ i \]/g,"[ "+r+" ]");return t})}function Ye(o,a,i,s,c,y){var _=o.context,g=s.defines,E=c.vertexShader,T=c.fragmentShader,m="SHADOWMAP_TYPE_BASIC";1===y.shadowMapType?m="SHADOWMAP_TYPE_PCF":2===y.shadowMapType&&(m="SHADOWMAP_TYPE_PCF_SOFT");var S="ENVMAP_TYPE_CUBE",M="ENVMAP_MODE_REFLECTION",v="ENVMAP_BLENDING_MULTIPLY";if(y.envMap){switch(s.envMap.mapping){case 301:case 302:S="ENVMAP_TYPE_CUBE";break;case 306:case 307:S="ENVMAP_TYPE_CUBE_UV";break;case 303:case 304:S="ENVMAP_TYPE_EQUIREC";break;case 305:S="ENVMAP_TYPE_SPHERE";}switch(s.envMap.mapping){case 302:case 304:M="ENVMAP_MODE_REFRACTION";}switch(s.combine){case 0:v="ENVMAP_BLENDING_MULTIPLY";break;case 1:v="ENVMAP_BLENDING_MIX";break;case 2:v="ENVMAP_BLENDING_ADD";}}var r=0<o.gammaFactor?o.gammaFactor:1,l=Kt(s.extensions,y,a),u=$t(g),p=_.createProgram();s.isRawShaderMaterial?(g=[u].filter(er).join("\n"),0<g.length&&(g+="\n"),a=[l,u].filter(er).join("\n"),0<a.length&&(a+="\n")):(g=["precision "+y.precision+" float;","precision "+y.precision+" int;","#define SHADER_NAME "+c.name,u,y.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+r,"#define MAX_BONES "+y.maxBones,y.useFog&&y.fog?"#define USE_FOG":"",y.useFog&&y.fogExp?"#define FOG_EXP2":"",y.map?"#define USE_MAP":"",y.envMap?"#define USE_ENVMAP":"",y.envMap?"#define "+M:"",y.lightMap?"#define USE_LIGHTMAP":"",y.aoMap?"#define USE_AOMAP":"",y.emissiveMap?"#define USE_EMISSIVEMAP":"",y.bumpMap?"#define USE_BUMPMAP":"",y.normalMap?"#define USE_NORMALMAP":"",y.displacementMap&&y.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",y.specularMap?"#define USE_SPECULARMAP":"",y.roughnessMap?"#define USE_ROUGHNESSMAP":"",y.metalnessMap?"#define USE_METALNESSMAP":"",y.alphaMap?"#define USE_ALPHAMAP":"",y.vertexColors?"#define USE_COLOR":"",y.flatShading?"#define FLAT_SHADED":"",y.skinning?"#define USE_SKINNING":"",y.useVertexTexture?"#define BONE_TEXTURE":"",y.morphTargets?"#define USE_MORPHTARGETS":"",y.morphNormals&&!1===y.flatShading?"#define USE_MORPHNORMALS":"",y.doubleSided?"#define DOUBLE_SIDED":"",y.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+y.numClippingPlanes,y.shadowMapEnabled?"#define USE_SHADOWMAP":"",y.shadowMapEnabled?"#define "+m:"",y.sizeAttenuation?"#define USE_SIZEATTENUATION":"",y.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",y.logarithmicDepthBuffer&&a.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(er).join("\n"),a=[l,"precision "+y.precision+" float;","precision "+y.precision+" int;","#define SHADER_NAME "+c.name,u,y.alphaTest?"#define ALPHATEST "+y.alphaTest:"","#define GAMMA_FACTOR "+r,y.useFog&&y.fog?"#define USE_FOG":"",y.useFog&&y.fogExp?"#define FOG_EXP2":"",y.map?"#define USE_MAP":"",y.envMap?"#define USE_ENVMAP":"",y.envMap?"#define "+S:"",y.envMap?"#define "+M:"",y.envMap?"#define "+v:"",y.lightMap?"#define USE_LIGHTMAP":"",y.aoMap?"#define USE_AOMAP":"",y.emissiveMap?"#define USE_EMISSIVEMAP":"",y.bumpMap?"#define USE_BUMPMAP":"",y.normalMap?"#define USE_NORMALMAP":"",y.specularMap?"#define USE_SPECULARMAP":"",y.roughnessMap?"#define USE_ROUGHNESSMAP":"",y.metalnessMap?"#define USE_METALNESSMAP":"",y.alphaMap?"#define USE_ALPHAMAP":"",y.vertexColors?"#define USE_COLOR":"",y.gradientMap?"#define USE_GRADIENTMAP":"",y.flatShading?"#define FLAT_SHADED":"",y.doubleSided?"#define DOUBLE_SIDED":"",y.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+y.numClippingPlanes,"#define UNION_CLIPPING_PLANES "+(y.numClippingPlanes-y.numClipIntersection),y.shadowMapEnabled?"#define USE_SHADOWMAP":"",y.shadowMapEnabled?"#define "+m:"",y.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",y.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",y.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",y.logarithmicDepthBuffer&&a.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",y.envMap&&a.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",0===y.toneMapping?"":"#define TONE_MAPPING",0===y.toneMapping?"":Aa.tonemapping_pars_fragment,0===y.toneMapping?"":Qt("toneMapping",y.toneMapping),y.dithering?"#define DITHERING":"",y.outputEncoding||y.mapEncoding||y.envMapEncoding||y.emissiveMapEncoding?Aa.encodings_pars_fragment:"",y.mapEncoding?We("mapTexelToLinear",y.mapEncoding):"",y.envMapEncoding?We("envMapTexelToLinear",y.envMapEncoding):"",y.emissiveMapEncoding?We("emissiveMapTexelToLinear",y.emissiveMapEncoding):"",y.outputEncoding?Jt("linearToOutputTexel",y.outputEncoding):"",y.depthPacking?"#define DEPTH_PACKING "+s.depthPacking:"","\n"].filter(er).join("\n")),E=Xe(E),E=tr(E,y),T=Xe(T),T=tr(T,y),s.isShaderMaterial||(E=rr(E),T=rr(T)),T=a+T,E=Zt(_,_.VERTEX_SHADER,g+E),T=Zt(_,_.FRAGMENT_SHADER,T),_.attachShader(p,E),_.attachShader(p,T),void 0===s.index0AttributeName?!0===y.morphTargets&&_.bindAttribLocation(p,0,"position"):_.bindAttribLocation(p,0,s.index0AttributeName),_.linkProgram(p),y=_.getProgramInfoLog(p).trim(),c=_.getShaderInfoLog(E).trim(),m=_.getShaderInfoLog(T).trim(),M=S=!0,!1===_.getProgramParameter(p,_.LINK_STATUS)?(S=!1,console.error("THREE.WebGLProgram: shader error: ",_.getError(),"gl.VALIDATE_STATUS",_.getProgramParameter(p,_.VALIDATE_STATUS),"gl.getProgramInfoLog",y,c,m)):""===y?(""===c||""===m)&&(M=!1):console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",y),M&&(this.diagnostics={runnable:S,material:s,programLog:y,vertexShader:{log:c,prefix:g},fragmentShader:{log:m,prefix:a}}),_.deleteShader(E),_.deleteShader(T);var x;this.getUniforms=function(){return void 0===x&&(x=new Re(_,p,o)),x};var w;return this.getAttributes=function(){if(void 0===w){for(var e={},t=_.getProgramParameter(p,_.ACTIVE_ATTRIBUTES),r=0,a;r<t;r++)a=_.getActiveAttrib(p,r).name,e[a]=_.getAttribLocation(p,a);w=e}return w},this.destroy=function(){_.deleteProgram(p),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.id=Mn++,this.code=i,this.usedTimes=1,this.program=p,this.vertexShader=E,this.fragmentShader=T,this}function ar(o,r,a){function i(e,t){if(e)e.isTexture?r=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),r=e.texture.encoding);else var r=3E3;return 3E3===r&&t&&(r=3007),r}var n=[],s={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow"},t=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];this.getParameters=function(p,d,e,c,u,g,f){var r=s[p.type];if(f.isSkinnedMesh){var y=f.skeleton.bones;if(a.floatVertexTextures)y=1024;else{var x=un(hn((a.maxVertexUniforms-20)/4),y.length);x<y.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+y.length+" bones. This GPU supports "+x+"."),y=0):y=x}}else y=0;x=a.precision,null!==p.precision&&(x=a.getMaxPrecision(p.precision),x!==p.precision&&console.warn("THREE.WebGLProgram.getParameters:",p.precision,"not supported, using",x,"instead."));var _=o.getRenderTarget();return{shaderID:r,precision:x,supportsVertexTextures:a.vertexTextures,outputEncoding:i(_?_.texture:null,o.gammaOutput),map:!!p.map,mapEncoding:i(p.map,o.gammaInput),envMap:!!p.envMap,envMapMode:p.envMap&&p.envMap.mapping,envMapEncoding:i(p.envMap,o.gammaInput),envMapCubeUV:!!p.envMap&&(306===p.envMap.mapping||307===p.envMap.mapping),lightMap:!!p.lightMap,aoMap:!!p.aoMap,emissiveMap:!!p.emissiveMap,emissiveMapEncoding:i(p.emissiveMap,o.gammaInput),bumpMap:!!p.bumpMap,normalMap:!!p.normalMap,displacementMap:!!p.displacementMap,roughnessMap:!!p.roughnessMap,metalnessMap:!!p.metalnessMap,specularMap:!!p.specularMap,alphaMap:!!p.alphaMap,gradientMap:!!p.gradientMap,combine:p.combine,vertexColors:p.vertexColors,fog:!!c,useFog:p.fog,fogExp:c&&c.isFogExp2,flatShading:p.flatShading,sizeAttenuation:p.sizeAttenuation,logarithmicDepthBuffer:a.logarithmicDepthBuffer,skinning:p.skinning&&0<y,maxBones:y,useVertexTexture:a.floatVertexTextures,morphTargets:p.morphTargets,morphNormals:p.morphNormals,maxMorphTargets:o.maxMorphTargets,maxMorphNormals:o.maxMorphNormals,numDirLights:d.directional.length,numPointLights:d.point.length,numSpotLights:d.spot.length,numRectAreaLights:d.rectArea.length,numHemiLights:d.hemi.length,numClippingPlanes:u,numClipIntersection:g,dithering:p.dithering,shadowMapEnabled:o.shadowMap.enabled&&f.receiveShadow&&0<e.length,shadowMapType:o.shadowMap.type,toneMapping:o.toneMapping,physicallyCorrectLights:o.physicallyCorrectLights,premultipliedAlpha:p.premultipliedAlpha,alphaTest:p.alphaTest,doubleSided:2===p.side,flipSided:1===p.side,depthPacking:void 0!==p.depthPacking&&p.depthPacking}},this.getProgramCode=function(r,a){var i=[];if(a.shaderID?i.push(a.shaderID):(i.push(r.fragmentShader),i.push(r.vertexShader)),void 0!==r.defines)for(var n in r.defines)i.push(n),i.push(r.defines[n]);for(n=0;n<t.length;n++)i.push(a[t[n]]);return i.push(r.onBeforeCompile.toString()),i.push(o.gammaOutput),i.join()},this.acquireProgram=function(e,a,i,s){for(var l=0,p=n.length,d,c;l<p;l++)if(c=n[l],c.code===s){d=c,++d.usedTimes;break}return void 0===d&&(d=new Ye(o,r,s,e,a,i),n.push(d)),d},this.releaseProgram=function(e){if(0===--e.usedTimes){var t=n.indexOf(e);n[t]=n[n.length-1],n.pop(),e.destroy()}},this.programs=n}function or(o,a,i,s,d,_,E,e){function c(e,t){if(e.width>t||e.height>t){t/=mn(e.width,e.height);var r=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return r.width=hn(e.width*t),r.height=hn(e.height*t),r.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,r.width,r.height),console.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+r.width+"x"+r.height,e),r}return e}function g(e){return yn.isPowerOfTwo(e.width)&&yn.isPowerOfTwo(e.height)}function m(e,t){return e.generateMipmaps&&t&&1003!==e.minFilter&&1006!==e.minFilter}function t(e){return 1003===e||1004===e||1005===e?o.NEAREST:o.LINEAR}function f(e){e=e.target,e.removeEventListener("dispose",f);a:{var t=s.get(e);if(e.image&&t.__image__webglTextureCube)o.deleteTexture(t.__image__webglTextureCube);else{if(void 0===t.__webglInit)break a;o.deleteTexture(t.__webglTexture)}s.remove(e)}e.isVideoTexture&&delete p[e.id],E.textures--}function y(t){t=t.target,t.removeEventListener("dispose",y);var r=s.get(t),a=s.get(t.texture);if(t){if(void 0!==a.__webglTexture&&o.deleteTexture(a.__webglTexture),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLRenderTargetCube)for(a=0;6>a;a++)o.deleteFramebuffer(r.__webglFramebuffer[a]),r.__webglDepthbuffer&&o.deleteRenderbuffer(r.__webglDepthbuffer[a]);else o.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&o.deleteRenderbuffer(r.__webglDepthbuffer);s.remove(t.texture),s.remove(t)}E.textures--}function r(t,a){var n=s.get(t);if(t.isVideoTexture){var r=t.id,h=e.frame;p[r]!==h&&(p[r]=h,t.update())}if(0<t.version&&n.__version!==t.version)if(r=t.image,void 0===r)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",t);else if(!1===r.complete)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",t);else{void 0===n.__webglInit&&(n.__webglInit=!0,t.addEventListener("dispose",f),n.__webglTexture=o.createTexture(),E.textures++),i.activeTexture(o.TEXTURE0+a),i.bindTexture(o.TEXTURE_2D,n.__webglTexture),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t.flipY),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),o.pixelStorei(o.UNPACK_ALIGNMENT,t.unpackAlignment);var b=c(t.image,d.maxTextureSize);(1001!==t.wrapS||1001!==t.wrapT||1003!==t.minFilter&&1006!==t.minFilter)&&!1===g(b)&&(a=b,a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof ImageBitmap?(r=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),r.width=yn.floorPowerOfTwo(a.width),r.height=yn.floorPowerOfTwo(a.height),r.getContext("2d").drawImage(a,0,0,r.width,r.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+a.width+"x"+a.height+"). Resized to "+r.width+"x"+r.height,a),b=r):b=a),a=g(b),r=_.convert(t.format),h=_.convert(t.type),v(o.TEXTURE_2D,t,a);var T=t.mipmaps;if(t.isDepthTexture){if(T=o.DEPTH_COMPONENT,1015===t.type){if(!u)throw Error("Float Depth Texture only supported in WebGL2.0");T=o.DEPTH_COMPONENT32F}else u&&(T=o.DEPTH_COMPONENT16);1026===t.format&&T===o.DEPTH_COMPONENT&&1012!==t.type&&1014!==t.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),t.type=1012,h=_.convert(t.type)),1027===t.format&&(T=o.DEPTH_STENCIL,1020!==t.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),t.type=1020,h=_.convert(t.type))),i.texImage2D(o.TEXTURE_2D,0,T,b.width,b.height,0,r,h,null)}else if(t.isDataTexture){if(0<T.length&&a){for(var y=0,S=T.length;y<S;y++)b=T[y],i.texImage2D(o.TEXTURE_2D,y,r,b.width,b.height,0,r,h,b.data);t.generateMipmaps=!1}else i.texImage2D(o.TEXTURE_2D,0,r,b.width,b.height,0,r,h,b.data);}else if(t.isCompressedTexture)for(y=0,S=T.length;y<S;y++)b=T[y],1023!==t.format&&1022!==t.format?-1<i.getCompressedTextureFormats().indexOf(r)?i.compressedTexImage2D(o.TEXTURE_2D,y,r,b.width,b.height,0,b.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(o.TEXTURE_2D,y,r,b.width,b.height,0,r,h,b.data);else if(0<T.length&&a){for(y=0,S=T.length;y<S;y++)b=T[y],i.texImage2D(o.TEXTURE_2D,y,r,r,h,b);t.generateMipmaps=!1}else i.texImage2D(o.TEXTURE_2D,0,r,r,h,b);return m(t,a)&&o.generateMipmap(o.TEXTURE_2D),n.__version=t.version,void(t.onUpdate&&t.onUpdate(t))}i.activeTexture(o.TEXTURE0+a),i.bindTexture(o.TEXTURE_2D,n.__webglTexture)}function v(e,r,i){i?(o.texParameteri(e,o.TEXTURE_WRAP_S,_.convert(r.wrapS)),o.texParameteri(e,o.TEXTURE_WRAP_T,_.convert(r.wrapT)),o.texParameteri(e,o.TEXTURE_MAG_FILTER,_.convert(r.magFilter)),o.texParameteri(e,o.TEXTURE_MIN_FILTER,_.convert(r.minFilter))):(o.texParameteri(e,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(e,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),1001===r.wrapS&&1001===r.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",r),o.texParameteri(e,o.TEXTURE_MAG_FILTER,t(r.magFilter)),o.texParameteri(e,o.TEXTURE_MIN_FILTER,t(r.minFilter)),1003!==r.minFilter&&1006!==r.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",r)),(i=a.get("EXT_texture_filter_anisotropic"))&&(1015!==r.type||null!==a.get("OES_texture_float_linear"))&&(1016!==r.type||null!==a.get("OES_texture_half_float_linear"))&&(1<r.anisotropy||s.get(r).__currentAnisotropy)&&(o.texParameterf(e,i.TEXTURE_MAX_ANISOTROPY_EXT,un(r.anisotropy,d.getMaxAnisotropy())),s.get(r).__currentAnisotropy=r.anisotropy)}function l(t,r,e,a){var n=_.convert(r.texture.format),l=_.convert(r.texture.type);i.texImage2D(a,0,n,r.width,r.height,0,n,l,null),o.bindFramebuffer(o.FRAMEBUFFER,t),o.framebufferTexture2D(o.FRAMEBUFFER,e,a,s.get(r.texture).__webglTexture,0),o.bindFramebuffer(o.FRAMEBUFFER,null)}function n(e,t){o.bindRenderbuffer(o.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_COMPONENT16,t.width,t.height),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_STENCIL,t.width,t.height),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,e)):o.renderbufferStorage(o.RENDERBUFFER,o.RGBA4,t.width,t.height),o.bindRenderbuffer(o.RENDERBUFFER,null)}var u="undefined"!==typeof WebGL2RenderingContext&&o instanceof WebGL2RenderingContext,p={};this.setTexture2D=r,this.setTextureCube=function(e,t){var a=s.get(e);if(6===e.image.length)if(0<e.version&&a.__version!==e.version){a.__image__webglTextureCube||(e.addEventListener("dispose",f),a.__image__webglTextureCube=o.createTexture(),E.textures++),i.activeTexture(o.TEXTURE0+t),i.bindTexture(o.TEXTURE_CUBE_MAP,a.__image__webglTextureCube),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,e.flipY),t=e&&e.isCompressedTexture;for(var n=e.image[0]&&e.image[0].isDataTexture,l=[],r=0;6>r;r++)l[r]=t||n?n?e.image[r].image:e.image[r]:c(e.image[r],d.maxCubemapSize);var u=g(l[0]),p=_.convert(e.format),h=_.convert(e.type);for(v(o.TEXTURE_CUBE_MAP,e,u),r=0;6>r;r++)if(t)for(var y=l[r].mipmaps,b=0,T=y.length,S;b<T;b++)S=y[b],1023!==e.format&&1022!==e.format?-1<i.getCompressedTextureFormats().indexOf(p)?i.compressedTexImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+r,b,p,S.width,S.height,0,S.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+r,b,p,S.width,S.height,0,p,h,S.data);else n?i.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,p,l[r].width,l[r].height,0,p,h,l[r].data):i.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,p,p,h,l[r]);m(e,u)&&o.generateMipmap(o.TEXTURE_CUBE_MAP),a.__version=e.version,e.onUpdate&&e.onUpdate(e)}else i.activeTexture(o.TEXTURE0+t),i.bindTexture(o.TEXTURE_CUBE_MAP,a.__image__webglTextureCube)},this.setTextureCubeDynamic=function(t,r){i.activeTexture(o.TEXTURE0+r),i.bindTexture(o.TEXTURE_CUBE_MAP,s.get(t).__webglTexture)},this.setupRenderTarget=function(t){var a=s.get(t),e=s.get(t.texture);t.addEventListener("dispose",y),e.__webglTexture=o.createTexture(),E.textures++;var p=!0===t.isWebGLRenderTargetCube,d=g(t);if(p){a.__webglFramebuffer=[];for(var c=0;6>c;c++)a.__webglFramebuffer[c]=o.createFramebuffer()}else a.__webglFramebuffer=o.createFramebuffer();if(p){for(i.bindTexture(o.TEXTURE_CUBE_MAP,e.__webglTexture),v(o.TEXTURE_CUBE_MAP,t.texture,d),c=0;6>c;c++)l(a.__webglFramebuffer[c],t,o.COLOR_ATTACHMENT0,o.TEXTURE_CUBE_MAP_POSITIVE_X+c);m(t.texture,d)&&o.generateMipmap(o.TEXTURE_CUBE_MAP),i.bindTexture(o.TEXTURE_CUBE_MAP,null)}else i.bindTexture(o.TEXTURE_2D,e.__webglTexture),v(o.TEXTURE_2D,t.texture,d),l(a.__webglFramebuffer,t,o.COLOR_ATTACHMENT0,o.TEXTURE_2D),m(t.texture,d)&&o.generateMipmap(o.TEXTURE_2D),i.bindTexture(o.TEXTURE_2D,null);if(t.depthBuffer){if(a=s.get(t),e=!0===t.isWebGLRenderTargetCube,t.depthTexture){if(e)throw Error("target.depthTexture not supported in Cube render targets");if(t&&t.isWebGLRenderTargetCube)throw Error("Depth Texture with cube render targets is not supported");if(o.bindFramebuffer(o.FRAMEBUFFER,a.__webglFramebuffer),!t.depthTexture||!t.depthTexture.isDepthTexture)throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");if(s.get(t.depthTexture).__webglTexture&&t.depthTexture.image.width===t.width&&t.depthTexture.image.height===t.height||(t.depthTexture.image.width=t.width,t.depthTexture.image.height=t.height,t.depthTexture.needsUpdate=!0),r(t.depthTexture,0),a=s.get(t.depthTexture).__webglTexture,1026===t.depthTexture.format)o.framebufferTexture2D(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.TEXTURE_2D,a,0);else if(1027===t.depthTexture.format)o.framebufferTexture2D(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.TEXTURE_2D,a,0);else throw Error("Unknown depthTexture format")}else if(e)for(a.__webglDepthbuffer=[],e=0;6>e;e++)o.bindFramebuffer(o.FRAMEBUFFER,a.__webglFramebuffer[e]),a.__webglDepthbuffer[e]=o.createRenderbuffer(),n(a.__webglDepthbuffer[e],t);else o.bindFramebuffer(o.FRAMEBUFFER,a.__webglFramebuffer),a.__webglDepthbuffer=o.createRenderbuffer(),n(a.__webglDepthbuffer,t);o.bindFramebuffer(o.FRAMEBUFFER,null)}},this.updateRenderTargetMipmap=function(t){var r=t.texture,e=g(t);m(r,e)&&(t=t.isWebGLRenderTargetCube?o.TEXTURE_CUBE_MAP:o.TEXTURE_2D,r=s.get(r).__webglTexture,i.bindTexture(t,r),o.generateMipmap(t),i.bindTexture(t,null))}}function ir(){var e={};return{get:function(t){t=t.uuid;var r=e[t];return void 0===r&&(r={},e[t]=r),r},remove:function(t){delete e[t.uuid]},dispose:function(){e={}}}}function nr(r,a,o){function i(t,a,o){var i=new Uint8Array(4),e=r.createTexture();for(r.bindTexture(t,e),r.texParameteri(t,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(t,r.TEXTURE_MAG_FILTER,r.NEAREST),t=0;t<o;t++)r.texImage2D(a+t,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,i);return e}function s(e){!0!==x[e]&&(r.enable(e),x[e]=!0)}function _(e){!1!==x[e]&&(r.disable(e),x[e]=!1)}function T(e,a,i,l,p,d,c,n){0===e?_(r.BLEND):s(r.BLEND),5===e?(p=p||a,d=d||i,c=c||l,(a!==R||p!==D)&&(r.blendEquationSeparate(o.convert(a),o.convert(p)),R=a,D=p),(i!==C||l!==B||d!==E||c!==Q)&&(r.blendFuncSeparate(o.convert(i),o.convert(l),o.convert(d),o.convert(c)),C=i,B=l,E=d,Q=c)):((e!==y||n!==G)&&(2===e?n?(r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD),r.blendFuncSeparate(r.ONE,r.ONE,r.ONE,r.ONE)):(r.blendEquation(r.FUNC_ADD),r.blendFunc(r.SRC_ALPHA,r.ONE)):3===e?n?(r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD),r.blendFuncSeparate(r.ZERO,r.ZERO,r.ONE_MINUS_SRC_COLOR,r.ONE_MINUS_SRC_ALPHA)):(r.blendEquation(r.FUNC_ADD),r.blendFunc(r.ZERO,r.ONE_MINUS_SRC_COLOR)):4===e?n?(r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD),r.blendFuncSeparate(r.ZERO,r.SRC_COLOR,r.ZERO,r.SRC_ALPHA)):(r.blendEquation(r.FUNC_ADD),r.blendFunc(r.ZERO,r.SRC_COLOR)):n?(r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD),r.blendFuncSeparate(r.ONE,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA)):(r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD),r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA))),Q=E=D=B=C=R=null),y=e,G=n}function w(e){Y!==e&&(e?r.frontFace(r.CW):r.frontFace(r.CCW),Y=e)}function d(e){0===e?_(r.CULL_FACE):(s(r.CULL_FACE),e!==K&&(1===e?r.cullFace(r.BACK):2===e?r.cullFace(r.FRONT):r.cullFace(r.FRONT_AND_BACK))),K=e}function F(e,t,a){e?(s(r.POLYGON_OFFSET_FILL),M!==t||P!==a)&&(r.polygonOffset(t,a),M=t,P=a):_(r.POLYGON_OFFSET_FILL)}function V(e){void 0===e&&(e=r.TEXTURE0+J-1),S!==e&&(r.activeTexture(e),S=e)}var W=new function(){var t=!1,a=new j,o=null,i=new j(0,0,0,0);return{setMask:function(e){o===e||t||(r.colorMask(e,e,e,e),o=e)},setLocked:function(e){t=e},setClear:function(e,t,o,n,s){!0===s&&(e*=n,t*=n,o*=n),a.set(e,t,o,n),!1===i.equals(a)&&(r.clearColor(e,t,o,n),i.copy(a))},reset:function(){t=!1,o=null,i.set(-1,0,0,0)}}},Z=new function(){var e=!1,t=null,a=null,o=null;return{setTest:function(e){e?s(r.DEPTH_TEST):_(r.DEPTH_TEST)},setMask:function(a){t===a||e||(r.depthMask(a),t=a)},setFunc:function(e){a!==e&&(e?0===e?r.depthFunc(r.NEVER):1===e?r.depthFunc(r.ALWAYS):2===e?r.depthFunc(r.LESS):3===e?r.depthFunc(r.LEQUAL):4===e?r.depthFunc(r.EQUAL):5===e?r.depthFunc(r.GEQUAL):6===e?r.depthFunc(r.GREATER):7===e?r.depthFunc(r.NOTEQUAL):r.depthFunc(r.LEQUAL):r.depthFunc(r.LEQUAL),a=e)},setLocked:function(t){e=t},setClear:function(e){o!==e&&(r.clearDepth(e),o=e)},reset:function(){e=!1,o=a=t=null}}},c=new function(){var e=!1,a=null,o=null,i=null,l=null,p=null,u=null,m=null,n=null;return{setTest:function(e){e?s(r.STENCIL_TEST):_(r.STENCIL_TEST)},setMask:function(t){a===t||e||(r.stencilMask(t),a=t)},setFunc:function(t,a,n){(o!==t||i!==a||l!==n)&&(r.stencilFunc(t,a,n),o=t,i=a,l=n)},setOp:function(e,t,a){(p!==e||u!==t||m!==a)&&(r.stencilOp(e,t,a),p=e,u=t,m=a)},setLocked:function(t){e=t},setClear:function(e){n!==e&&(r.clearStencil(e),n=e)},reset:function(){e=!1,n=m=u=p=l=i=o=a=null}}},b=r.getParameter(r.MAX_VERTEX_ATTRIBS),q=new Uint8Array(b),u=new Uint8Array(b),p=new Uint8Array(b),x={},z=null,A=null,y=null,R=null,C=null,B=null,D=null,E=null,Q=null,G=!1,Y=null,K=null,H=null,M=null,P=null,J=r.getParameter(r.MAX_COMBINED_TEXTURE_IMAGE_UNITS),b=parseFloat(/^WebGL\ ([0-9])/.exec(r.getParameter(r.VERSION))[1]),O=1<=parseFloat(b),S=null,L={},N=new j,U=new j,I={};return I[r.TEXTURE_2D]=i(r.TEXTURE_2D,r.TEXTURE_2D,1),I[r.TEXTURE_CUBE_MAP]=i(r.TEXTURE_CUBE_MAP,r.TEXTURE_CUBE_MAP_POSITIVE_X,6),W.setClear(0,0,0,1),Z.setClear(1),c.setClear(0),s(r.DEPTH_TEST),Z.setFunc(3),w(!1),d(1),s(r.CULL_FACE),s(r.BLEND),T(1),{buffers:{color:W,depth:Z,stencil:c},initAttributes:function(){for(var e=0,t=q.length;e<t;e++)q[e]=0},enableAttribute:function(e){q[e]=1,0===u[e]&&(r.enableVertexAttribArray(e),u[e]=1),0!==p[e]&&(a.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(e,0),p[e]=0)},enableAttributeAndDivisor:function(e,t){q[e]=1,0===u[e]&&(r.enableVertexAttribArray(e),u[e]=1),p[e]!==t&&(a.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(e,t),p[e]=t)},disableUnusedAttributes:function(){for(var e=0,t=u.length;e!==t;++e)u[e]!==q[e]&&(r.disableVertexAttribArray(e),u[e]=0)},enable:s,disable:_,getCompressedTextureFormats:function(){if(null===z&&(z=[],a.get("WEBGL_compressed_texture_pvrtc")||a.get("WEBGL_compressed_texture_s3tc")||a.get("WEBGL_compressed_texture_etc1")||a.get("WEBGL_compressed_texture_astc")))for(var e=r.getParameter(r.COMPRESSED_TEXTURE_FORMATS),t=0;t<e.length;t++)z.push(e[t]);return z},useProgram:function(e){return A!==e&&(r.useProgram(e),A=e,!0)},setBlending:T,setMaterial:function(e,t){2===e.side?_(r.CULL_FACE):s(r.CULL_FACE);var a=1===e.side;t&&(a=!a),w(a),!0===e.transparent?T(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha):T(0),Z.setFunc(e.depthFunc),Z.setTest(e.depthTest),Z.setMask(e.depthWrite),W.setMask(e.colorWrite),F(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:w,setCullFace:d,setLineWidth:function(e){e!==H&&(O&&r.lineWidth(e),H=e)},setPolygonOffset:F,setScissorTest:function(e){e?s(r.SCISSOR_TEST):_(r.SCISSOR_TEST)},activeTexture:V,bindTexture:function(e,t){null===S&&V();var a=L[S];void 0===a&&(a={type:void 0,texture:void 0},L[S]=a),(a.type!==e||a.texture!==t)&&(r.bindTexture(e,t||I[e]),a.type=e,a.texture=t)},compressedTexImage2D:function(){try{r.compressedTexImage2D.apply(r,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{r.texImage2D.apply(r,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(e){!1===N.equals(e)&&(r.scissor(e.x,e.y,e.z,e.w),N.copy(e))},viewport:function(e){!1===U.equals(e)&&(r.viewport(e.x,e.y,e.z,e.w),U.copy(e))},reset:function(){for(var e=0;e<u.length;e++)1===u[e]&&(r.disableVertexAttribArray(e),u[e]=0);x={},S=z=null,L={},K=Y=y=A=null,W.reset(),Z.reset(),c.reset()}}}function sr(r,a,o){function i(e){if("highp"===e){if(0<r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.HIGH_FLOAT).precision&&0<r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT).precision)return"highp";e="mediump"}return"mediump"===e&&0<r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.MEDIUM_FLOAT).precision&&0<r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.MEDIUM_FLOAT).precision?"mediump":"lowp"}var s=void 0===o.precision?"highp":o.precision,u=i(s),y;u!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",u,"instead."),s=u),o=!0===o.logarithmicDepthBuffer;var u=r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS),e=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS),x=r.getParameter(r.MAX_TEXTURE_SIZE),_=r.getParameter(r.MAX_CUBE_MAP_TEXTURE_SIZE),b=r.getParameter(r.MAX_VERTEX_ATTRIBS),E=r.getParameter(r.MAX_VERTEX_UNIFORM_VECTORS),T=r.getParameter(r.MAX_VARYING_VECTORS),S=r.getParameter(r.MAX_FRAGMENT_UNIFORM_VECTORS),M=0<e,A=!!a.get("OES_texture_float");return{getMaxAnisotropy:function(){if(void 0!==y)return y;var e=a.get("EXT_texture_filter_anisotropic");return y=null===e?0:r.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT)},getMaxPrecision:i,precision:s,logarithmicDepthBuffer:o,maxTextures:u,maxVertexTextures:e,maxTextureSize:x,maxCubemapSize:_,maxAttributes:b,maxVertexUniforms:E,maxVaryings:T,maxFragmentUniforms:S,vertexTextures:M,floatFragmentTextures:A,floatVertexTextures:M&&A}}function lr(e,t,r,a){ct.call(this),this.type="PerspectiveCamera",this.fov=void 0===e?50:e,this.zoom=1,this.near=void 0===r?.1:r,this.far=void 0===a?2E3:a,this.focus=10,this.aspect=void 0===t?1:t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function pr(e){lr.call(this),this.cameras=e||[]}function dr(r){function a(){if(null!==s&&s.isPresenting){var a=s.getEyeParameters("left"),i=a.renderWidth,a=a.renderHeight;t=r.getPixelRatio(),c=r.getSize(),r.setDrawingBufferSize(2*i,a,1)}else o.enabled&&r.setDrawingBufferSize(c.width,c.height,t)}var o=this,s=null,l=null,e=null;"undefined"!==typeof window&&"VRFrameData"in window&&(l=new window.VRFrameData);var p=new i,d=new lr;d.bounds=new j(0,0,.5,1),d.layers.enable(1);var u=new lr;u.bounds=new j(.5,0,.5,1),u.layers.enable(2);var g=new pr([d,u]);g.layers.enable(1),g.layers.enable(2);var c,t;"undefined"!==typeof window&&window.addEventListener("vrdisplaypresentchange",a,!1),this.enabled=!1,this.getDevice=function(){return s},this.setDevice=function(e){void 0!==e&&(s=e)},this.setPoseTarget=function(t){void 0!==t&&(e=t)},this.getCamera=function(t){if(null===s)return t;s.depthNear=t.near,s.depthFar=t.far,s.getFrameData(l);var r=l.pose,a=null===e?t:e;return(null===r.position?a.position.set(0,0,0):a.position.fromArray(r.position),null!==r.orientation&&a.quaternion.fromArray(r.orientation),a.updateMatrixWorld(),!1===s.isPresenting)?t:(d.near=t.near,u.near=t.near,d.far=t.far,u.far=t.far,g.matrixWorld.copy(t.matrixWorld),g.matrixWorldInverse.copy(t.matrixWorldInverse),d.matrixWorldInverse.fromArray(l.leftViewMatrix),u.matrixWorldInverse.fromArray(l.rightViewMatrix),t=a.parent,null!==t&&(p.getInverse(t.matrixWorld),d.matrixWorldInverse.multiply(p),u.matrixWorldInverse.multiply(p)),d.matrixWorld.getInverse(d.matrixWorldInverse),u.matrixWorld.getInverse(u.matrixWorldInverse),d.projectionMatrix.fromArray(l.leftProjectionMatrix),u.projectionMatrix.fromArray(l.rightProjectionMatrix),g.projectionMatrix.copy(d.projectionMatrix),t=s.getLayers(),t.length&&(t=t[0],null!==t.leftBounds&&4===t.leftBounds.length&&d.bounds.fromArray(t.leftBounds),null!==t.rightBounds&&4===t.rightBounds.length&&u.bounds.fromArray(t.rightBounds)),g)},this.submitFrame=function(){s&&s.isPresenting&&s.submitFrame()},this.dispose=function(){"undefined"!==typeof window&&window.removeEventListener("vrdisplaypresentchange",a)}}function ae(e){var t={};return{get:function(r){if(void 0!==t[r])return t[r];switch(r){case"WEBGL_depth_texture":var a=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":a=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":a=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":a=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":a=e.getExtension("WEBGL_compressed_texture_etc1");break;default:a=e.getExtension(r);}return null===a&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),t[r]=a}}}function cr(){function r(){u.value!==i&&(u.value=i,u.needsUpdate=0<s),t.numPlanes=s,t.numIntersection=0}function o(r,a,o,i){var e=null===r?0:r.length,s=null;if(0!==e){if(s=u.value,!0!==i||null===s)for(i=o+4*e,a=a.matrixWorldInverse,l.getNormalMatrix(a),(null===s||s.length<i)&&(s=new Float32Array(i)),i=0;i!==e;++i,o+=4)n.copy(r[i]).applyMatrix4(a,l),n.normal.toArray(s,o),s[o+3]=n.constant;u.value=s,u.needsUpdate=!0}return t.numPlanes=e,s}var t=this,i=null,s=0,e=!1,a=!1,n=new it,l=new y,u={value:null,needsUpdate:!1};this.uniform=u,this.numIntersection=this.numPlanes=0,this.init=function(t,r,a){var n=0!==t.length||r||0!==s||e;return e=r,i=o(t,a,0),s=t.length,n},this.beginShadows=function(){a=!0,o(null)},this.endShadows=function(){a=!1,r()},this.setState=function(d,c,m,g,l,h){if(!e||null===d||0===d.length||a&&!m)a?o(null):r();else{m=a?0:s;var p=4*m,n=l.clippingState||null;for(u.value=n,n=o(d,g,p,h),d=0;d!==p;++d)n[d]=i[d];l.clippingState=n,this.numIntersection=c?this.numPlanes:0,this.numPlanes+=m}}}function mr(e,t){return{convert:function(r){if(1E3===r)return e.REPEAT;if(1001===r)return e.CLAMP_TO_EDGE;if(1002===r)return e.MIRRORED_REPEAT;if(1003===r)return e.NEAREST;if(1004===r)return e.NEAREST_MIPMAP_NEAREST;if(1005===r)return e.NEAREST_MIPMAP_LINEAR;if(1006===r)return e.LINEAR;if(1007===r)return e.LINEAR_MIPMAP_NEAREST;if(1008===r)return e.LINEAR_MIPMAP_LINEAR;if(1009===r)return e.UNSIGNED_BYTE;if(1017===r)return e.UNSIGNED_SHORT_4_4_4_4;if(1018===r)return e.UNSIGNED_SHORT_5_5_5_1;if(1019===r)return e.UNSIGNED_SHORT_5_6_5;if(1010===r)return e.BYTE;if(1011===r)return e.SHORT;if(1012===r)return e.UNSIGNED_SHORT;if(1013===r)return e.INT;if(1014===r)return e.UNSIGNED_INT;if(1015===r)return e.FLOAT;if(1016===r){var a=t.get("OES_texture_half_float");if(null!==a)return a.HALF_FLOAT_OES}if(1021===r)return e.ALPHA;if(1022===r)return e.RGB;if(1023===r)return e.RGBA;if(1024===r)return e.LUMINANCE;if(1025===r)return e.LUMINANCE_ALPHA;if(1026===r)return e.DEPTH_COMPONENT;if(1027===r)return e.DEPTH_STENCIL;if(100===r)return e.FUNC_ADD;if(101===r)return e.FUNC_SUBTRACT;if(102===r)return e.FUNC_REVERSE_SUBTRACT;if(200===r)return e.ZERO;if(201===r)return e.ONE;if(202===r)return e.SRC_COLOR;if(203===r)return e.ONE_MINUS_SRC_COLOR;if(204===r)return e.SRC_ALPHA;if(205===r)return e.ONE_MINUS_SRC_ALPHA;if(206===r)return e.DST_ALPHA;if(207===r)return e.ONE_MINUS_DST_ALPHA;if(208===r)return e.DST_COLOR;if(209===r)return e.ONE_MINUS_DST_COLOR;if(210===r)return e.SRC_ALPHA_SATURATE;if((33776===r||33777===r||33778===r||33779===r)&&(a=t.get("WEBGL_compressed_texture_s3tc"),null!==a)){if(33776===r)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===r)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===r)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===r)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((35840===r||35841===r||35842===r||35843===r)&&(a=t.get("WEBGL_compressed_texture_pvrtc"),null!==a)){if(35840===r)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===r)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===r)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===r)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===r&&(a=t.get("WEBGL_compressed_texture_etc1"),null!==a))return a.COMPRESSED_RGB_ETC1_WEBGL;if((37808===r||37809===r||37810===r||37811===r||37812===r||37813===r||37814===r||37815===r||37816===r||37817===r||37818===r||37819===r||37820===r||37821===r)&&(a=t.get("WEBGL_compressed_texture_astc"),null!==a))return r;if((103===r||104===r)&&(a=t.get("EXT_blend_minmax"),null!==a)){if(103===r)return a.MIN_EXT;if(104===r)return a.MAX_EXT}return 1020===r&&(a=t.get("WEBGL_depth_texture"),null!==a)?a.UNSIGNED_INT_24_8_WEBGL:0}}}function Ze(r){function a(){F=new ae(_e),F.get("WEBGL_depth_texture"),F.get("OES_texture_float"),F.get("OES_texture_float_linear"),F.get("OES_texture_half_float"),F.get("OES_texture_half_float_linear"),F.get("OES_standard_derivatives"),F.get("OES_element_index_uint"),F.get("ANGLE_instanced_arrays"),Be=new mr(_e,F),be=new sr(_e,F,r),Z=new nr(_e,F,Be),Z.scissor(W.copy(de).multiplyScalar(le)),Z.viewport(ie.copy(pe).multiplyScalar(le)),Ee=new ir,T=new or(_e,F,Z,Ee,be,Be,xe,ve),Se=new Te(_e),Me=new Wt(_e,Se,xe),Ae=new Yt(Me,ve),Ie=new Ht(_e),Le=new ar(G,F,be),we=new Xt,Ce=new Gt,Pe=new Dt(G,Z,Me,w),Ne=new kt(_e,F,ve),Ue=new Vt(_e,F,ve),De=new Qe(G,_e,Z,T,be),G.info.programs=Le.programs,G.context=_e,G.capabilities=be,G.extensions=F,G.properties=Ee,G.renderLists=Ce,G.state=Z}function o(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),Y=!0}function s(){console.log("THREE.WebGLRenderer: Context Restored."),Y=!1,a()}function p(t){t=t.target,t.removeEventListener("dispose",p),e(t),Ee.remove(t)}function e(e){var t=Ee.get(e).program;e.program=void 0,void 0!==t&&Le.releaseProgram(t)}function d(e,t,r){e.render(function(e){G.renderBufferImmediate(e,t,r)})}function c(e){null!==Oe&&Oe(e),(e=Fe.getDevice())&&e.isPresenting?e.requestAnimationFrame(c):window.requestAnimationFrame(c)}function S(t,r,a){if(!1!==t.visible){if(t.layers.test(r.layers))if(t.isLight)te.push(t),t.castShadow&&D.push(t);else if(t.isSprite)t.frustumCulled&&!me.intersectsSprite(t)||re.push(t);else if(t.isImmediateRenderObject)a&&ye.setFromMatrixPosition(t.matrixWorld).applyMatrix4(he),E.push(t,null,t.material,ye.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.update(),!t.frustumCulled||me.intersectsObject(t))){a&&ye.setFromMatrixPosition(t.matrixWorld).applyMatrix4(he);var o=Ae.update(t),i=t.material;if(Array.isArray(i))for(var e=o.groups,s=0,l=e.length;s<l;s++){var p=e[s],d=i[p.materialIndex];d&&d.visible&&E.push(t,o,d,ye.z,p)}else i.visible&&E.push(t,o,i,ye.z,null)}for(t=t.children,s=0,l=t.length;s<l;s++)S(t[s],r,a)}}function g(t,a,o,i){for(var s=0,e=t.length;s<e;s++){var p=t[s],d=p.object,c=p.geometry,u=void 0===i?p.material:i,p=p.group;if(o.isArrayCamera){N=o;for(var g=o.cameras,n=0,l=g.length,h;n<l;n++)if(h=g[n],d.layers.test(h.layers)){var r=h.bounds;Z.viewport(ie.set(r.x*I,r.y*se,r.z*I,r.w*se).multiplyScalar(le)),f(d,a,h,c,u,p)}}else N=null,f(d,a,o,c,u,p)}}function f(t,r,a,o,i,e){if(t.onBeforeRender(G,r,a,o,i,e),t.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){var n=t.isMesh&&0>t.matrixWorld.determinant();Z.setMaterial(i,n),n=$(a,r.fog,i,t),P="",d(t,n,i)}else G.renderBufferDirect(a,r.fog,o,i,t,e);t.onAfterRender(G,r,a,o,i,e)}function O(t,r,a){var o=Ee.get(t);a=Le.getParameters(t,we.state,D,r,ue.numPlanes,ue.numIntersection,a);var i=Le.getProgramCode(t,a),n=o.program,s=!0;if(void 0===n)t.addEventListener("dispose",p);else if(n.code!==i)e(t);else{if(void 0!==a.shaderID)return;s=!1}if(s&&(a.shaderID?(n=U[a.shaderID],o.shader={name:t.type,uniforms:K.clone(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader}):o.shader={name:t.type,uniforms:t.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader},t.onBeforeCompile(o.shader),n=Le.acquireProgram(t,o.shader,a,i),o.program=n,t.program=n),a=n.getAttributes(),t.morphTargets)for(i=t.numSupportedMorphTargets=0;i<G.maxMorphTargets;i++)0<=a["morphTarget"+i]&&t.numSupportedMorphTargets++;if(t.morphNormals)for(i=t.numSupportedMorphNormals=0;i<G.maxMorphNormals;i++)0<=a["morphNormal"+i]&&t.numSupportedMorphNormals++;a=o.shader.uniforms,(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(o.numClippingPlanes=ue.numPlanes,o.numIntersection=ue.numIntersection,a.clippingPlanes=ue.uniform),o.fog=r,o.lightsHash=we.state.hash,t.lights&&(a.ambientLightColor.value=we.state.ambient,a.directionalLights.value=we.state.directional,a.spotLights.value=we.state.spot,a.rectAreaLights.value=we.state.rectArea,a.pointLights.value=we.state.point,a.hemisphereLights.value=we.state.hemi,a.directionalShadowMap.value=we.state.directionalShadowMap,a.directionalShadowMatrix.value=we.state.directionalShadowMatrix,a.spotShadowMap.value=we.state.spotShadowMap,a.spotShadowMatrix.value=we.state.spotShadowMatrix,a.pointShadowMap.value=we.state.pointShadowMap,a.pointShadowMatrix.value=we.state.pointShadowMatrix),t=o.program.getUniforms(),t=Re.seqWithValue(t.seq,a),o.uniformsList=t}function $(o,a,i,s){V=0;var p=Ee.get(i);ge&&(fe||o!==L)&&ue.setState(i.clippingPlanes,i.clipIntersection,i.clipShadows,o,p,o===L&&i.id===M),!1===i.needsUpdate&&(void 0===p.program?i.needsUpdate=!0:i.fog&&p.fog!==a?i.needsUpdate=!0:i.lights&&p.lightsHash!==we.state.hash?i.needsUpdate=!0:void 0===p.numClippingPlanes||p.numClippingPlanes===ue.numPlanes&&p.numIntersection===ue.numIntersection||(i.needsUpdate=!0)),i.needsUpdate&&(O(i,a,s),i.needsUpdate=!1);var e=!1,d=!1,c=!1,u=p.program,g=u.getUniforms(),m=p.shader.uniforms;if(Z.useProgram(u.program)&&(c=d=e=!0),i.id!==M&&(M=i.id,d=!0),(e||o!==L)&&(g.setValue(_e,"projectionMatrix",o.projectionMatrix),be.logarithmicDepthBuffer&&g.setValue(_e,"logDepthBufFC",2/(cn(o.far+1)/dn)),L!==(N||o)&&(L=N||o,c=d=!0),(i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshStandardMaterial||i.envMap)&&(e=g.map.cameraPosition,void 0!==e&&e.setValue(_e,ye.setFromMatrixPosition(o.matrixWorld))),(i.isMeshPhongMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.skinning)&&g.setValue(_e,"viewMatrix",o.matrixWorldInverse)),i.skinning&&(g.setOptional(_e,s,"bindMatrix"),g.setOptional(_e,s,"bindMatrixInverse"),o=s.skeleton))if(e=o.bones,be.floatVertexTextures){if(void 0===o.boneTexture){var e=pn(4*e.length),e=yn.ceilPowerOfTwo(e),e=mn(e,4),t=new Float32Array(4*(e*e));t.set(o.boneMatrices);var f=new l(t,e,e,1023,1015);o.boneMatrices=t,o.boneTexture=f,o.boneTextureSize=e}g.setValue(_e,"boneTexture",o.boneTexture),g.setValue(_e,"boneTextureSize",o.boneTextureSize)}else g.setOptional(_e,o,"boneMatrices");return d&&(g.setValue(_e,"toneMappingExposure",G.toneMappingExposure),g.setValue(_e,"toneMappingWhitePoint",G.toneMappingWhitePoint),i.lights&&(d=c,m.ambientLightColor.needsUpdate=d,m.directionalLights.needsUpdate=d,m.pointLights.needsUpdate=d,m.spotLights.needsUpdate=d,m.rectAreaLights.needsUpdate=d,m.hemisphereLights.needsUpdate=d),a&&i.fog&&(m.fogColor.value=a.color,a.isFog?(m.fogNear.value=a.near,m.fogFar.value=a.far):a.isFogExp2&&(m.fogDensity.value=a.density)),i.isMeshBasicMaterial?n(m,i):i.isMeshLambertMaterial?(n(m,i),i.emissiveMap&&(m.emissiveMap.value=i.emissiveMap)):i.isMeshPhongMaterial?(n(m,i),i.isMeshToonMaterial?(ee(m,i),i.gradientMap&&(m.gradientMap.value=i.gradientMap)):ee(m,i)):i.isMeshStandardMaterial?(n(m,i),i.isMeshPhysicalMaterial&&(m.clearCoat.value=i.clearCoat,m.clearCoatRoughness.value=i.clearCoatRoughness),m.roughness.value=i.roughness,m.metalness.value=i.metalness,i.roughnessMap&&(m.roughnessMap.value=i.roughnessMap),i.metalnessMap&&(m.metalnessMap.value=i.metalnessMap),i.emissiveMap&&(m.emissiveMap.value=i.emissiveMap),i.bumpMap&&(m.bumpMap.value=i.bumpMap,m.bumpScale.value=i.bumpScale),i.normalMap&&(m.normalMap.value=i.normalMap,m.normalScale.value.copy(i.normalScale)),i.displacementMap&&(m.displacementMap.value=i.displacementMap,m.displacementScale.value=i.displacementScale,m.displacementBias.value=i.displacementBias),i.envMap&&(m.envMapIntensity.value=i.envMapIntensity)):i.isMeshDepthMaterial?(n(m,i),i.displacementMap&&(m.displacementMap.value=i.displacementMap,m.displacementScale.value=i.displacementScale,m.displacementBias.value=i.displacementBias)):i.isMeshDistanceMaterial?(n(m,i),i.displacementMap&&(m.displacementMap.value=i.displacementMap,m.displacementScale.value=i.displacementScale,m.displacementBias.value=i.displacementBias),m.referencePosition.value.copy(i.referencePosition),m.nearDistance.value=i.nearDistance,m.farDistance.value=i.farDistance):i.isMeshNormalMaterial?(n(m,i),i.bumpMap&&(m.bumpMap.value=i.bumpMap,m.bumpScale.value=i.bumpScale),i.normalMap&&(m.normalMap.value=i.normalMap,m.normalScale.value.copy(i.normalScale)),i.displacementMap&&(m.displacementMap.value=i.displacementMap,m.displacementScale.value=i.displacementScale,m.displacementBias.value=i.displacementBias)):i.isLineBasicMaterial?(m.diffuse.value=i.color,m.opacity.value=i.opacity,i.isLineDashedMaterial&&(m.dashSize.value=i.dashSize,m.totalSize.value=i.dashSize+i.gapSize,m.scale.value=i.scale)):i.isPointsMaterial?(m.diffuse.value=i.color,m.opacity.value=i.opacity,m.size.value=i.size*le,m.scale.value=.5*se,m.map.value=i.map,null!==i.map&&(!0===i.map.matrixAutoUpdate&&(a=i.map.offset,d=i.map.repeat,c=i.map.center,i.map.matrix.setUvTransform(a.x,a.y,d.x,d.y,i.map.rotation,c.x,c.y)),m.uvTransform.value.copy(i.map.matrix))):i.isShadowMaterial&&(m.color.value=i.color,m.opacity.value=i.opacity),void 0!==m.ltc_1&&(m.ltc_1.value=_n.LTC_1),void 0!==m.ltc_2&&(m.ltc_2.value=_n.LTC_2),Re.upload(_e,p.uniformsList,m,G)),g.setValue(_e,"modelViewMatrix",s.modelViewMatrix),g.setValue(_e,"normalMatrix",s.normalMatrix),g.setValue(_e,"modelMatrix",s.matrixWorld),u}function n(t,r){if(t.opacity.value=r.opacity,r.color&&(t.diffuse.value=r.color),r.emissive&&t.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(t.map.value=r.map),r.alphaMap&&(t.alphaMap.value=r.alphaMap),r.specularMap&&(t.specularMap.value=r.specularMap),r.envMap&&(t.envMap.value=r.envMap,t.flipEnvMap.value=r.envMap&&r.envMap.isCubeTexture?-1:1,t.reflectivity.value=r.reflectivity,t.refractionRatio.value=r.refractionRatio),r.lightMap&&(t.lightMap.value=r.lightMap,t.lightMapIntensity.value=r.lightMapIntensity),r.aoMap&&(t.aoMap.value=r.aoMap,t.aoMapIntensity.value=r.aoMapIntensity),r.map)var a=r.map;else r.specularMap?a=r.specularMap:r.displacementMap?a=r.displacementMap:r.normalMap?a=r.normalMap:r.bumpMap?a=r.bumpMap:r.roughnessMap?a=r.roughnessMap:r.metalnessMap?a=r.metalnessMap:r.alphaMap?a=r.alphaMap:r.emissiveMap&&(a=r.emissiveMap);if(void 0!==a){if(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate){r=a.offset;var o=a.repeat,i=a.center;a.matrix.setUvTransform(r.x,r.y,o.x,o.y,a.rotation,i.x,i.y)}t.uvTransform.value.copy(a.matrix)}}function ee(e,t){e.specular.value=t.specular,e.shininess.value=mn(t.shininess,1E-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}console.log("THREE.WebGLRenderer","90dev"),r=r||{};var t=void 0===r.canvas?document.createElementNS("http://www.w3.org/1999/xhtml","canvas"):r.canvas,m=void 0===r.context?null:r.context,u=void 0!==r.alpha&&r.alpha,h=!(void 0!==r.depth)||r.depth,v=!(void 0!==r.stencil)||r.stencil,b=void 0!==r.antialias&&r.antialias,w=!(void 0!==r.premultipliedAlpha)||r.premultipliedAlpha,k=void 0!==r.preserveDrawingBuffer&&r.preserveDrawingBuffer,q=void 0===r.powerPreference?"default":r.powerPreference,te=[],D=[],E=null,re=[];this.domElement=t,this.context=null,this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.physicallyCorrectLights=this.gammaOutput=this.gammaInput=!1,this.toneMappingWhitePoint=this.toneMappingExposure=this.toneMapping=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var G=this,Y=!1,oe=null,J=null,M=-1,P="",L=null,N=null,ie=new j,W=new j,ne=null,V=0,I=t.width,se=t.height,le=1,pe=new j(0,0,I,se),de=new j(0,0,I,se),ce=!1,me=new nt,ue=new cr,ge=!1,fe=!1,he=new i,ye=new _,xe={geometries:0,textures:0},ve={frame:0,calls:0,vertices:0,faces:0,points:0};this.info={render:ve,memory:xe,programs:null,autoReset:!0,reset:function(){ve.frame++,ve.calls=0,ve.vertices=0,ve.faces=0,ve.points=0}};try{u={alpha:u,depth:h,stencil:v,antialias:b,premultipliedAlpha:w,preserveDrawingBuffer:k,powerPreference:q},t.addEventListener("webglcontextlost",o,!1),t.addEventListener("webglcontextrestored",s,!1);var _e=m||t.getContext("webgl",u)||t.getContext("experimental-webgl",u);if(null===_e){if(null!==t.getContext("webgl"))throw Error("Error creating WebGL context with your selected attributes.");throw Error("Error creating WebGL context.")}void 0===_e.getShaderPrecisionFormat&&(_e.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){console.error("THREE.WebGLRenderer: "+e.message)}var F,be,Z,Ee,T,Se,Me,Ae,we,Le,Ce,Pe,Ie,Ne,Ue,De,Be;a();var Fe=new dr(G);this.vr=Fe;var ze=new st(G,Ae,be.maxTextureSize);this.shadowMap=ze,this.getContext=function(){return _e},this.getContextAttributes=function(){return _e.getContextAttributes()},this.forceContextLoss=function(){var e=F.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=F.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return le},this.setPixelRatio=function(e){void 0!==e&&(le=e,this.setSize(I,se,!1))},this.getSize=function(){return{width:I,height:se}},this.setSize=function(e,r,a){var o=Fe.getDevice();o&&o.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(I=e,se=r,t.width=e*le,t.height=r*le,!1!==a&&(t.style.width=e+"px",t.style.height=r+"px"),this.setViewport(0,0,e,r))},this.getDrawingBufferSize=function(){return{width:I*le,height:se*le}},this.setDrawingBufferSize=function(e,r,a){I=e,se=r,le=a,t.width=e*a,t.height=r*a,this.setViewport(0,0,e,r)},this.getCurrentViewport=function(){return ie},this.setViewport=function(e,t,r,a){pe.set(e,se-t-a,r,a),Z.viewport(ie.copy(pe).multiplyScalar(le))},this.setScissor=function(e,t,r,a){de.set(e,se-t-a,r,a),Z.scissor(W.copy(de).multiplyScalar(le))},this.setScissorTest=function(e){Z.setScissorTest(ce=e)},this.getClearColor=function(){return Pe.getClearColor()},this.setClearColor=function(){Pe.setClearColor.apply(Pe,arguments)},this.getClearAlpha=function(){return Pe.getClearAlpha()},this.setClearAlpha=function(){Pe.setClearAlpha.apply(Pe,arguments)},this.clear=function(e,t,r){var a=0;(void 0===e||e)&&(a|=_e.COLOR_BUFFER_BIT),(void 0===t||t)&&(a|=_e.DEPTH_BUFFER_BIT),(void 0===r||r)&&(a|=_e.STENCIL_BUFFER_BIT),_e.clear(a)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(e,t,r,a){this.setRenderTarget(e),this.clear(t,r,a)},this.dispose=function(){t.removeEventListener("webglcontextlost",o,!1),t.removeEventListener("webglcontextrestored",s,!1),Ce.dispose(),Ee.dispose(),Ae.dispose(),Fe.dispose()},this.renderBufferImmediate=function(t,r,a){Z.initAttributes();var o=Ee.get(t);if(t.hasPositions&&!o.position&&(o.position=_e.createBuffer()),t.hasNormals&&!o.normal&&(o.normal=_e.createBuffer()),t.hasUvs&&!o.uv&&(o.uv=_e.createBuffer()),t.hasColors&&!o.color&&(o.color=_e.createBuffer()),r=r.getAttributes(),t.hasPositions&&(_e.bindBuffer(_e.ARRAY_BUFFER,o.position),_e.bufferData(_e.ARRAY_BUFFER,t.positionArray,_e.DYNAMIC_DRAW),Z.enableAttribute(r.position),_e.vertexAttribPointer(r.position,3,_e.FLOAT,!1,0,0)),t.hasNormals){if(_e.bindBuffer(_e.ARRAY_BUFFER,o.normal),!a.isMeshPhongMaterial&&!a.isMeshStandardMaterial&&!a.isMeshNormalMaterial&&!0===a.flatShading)for(var i=0,e=3*t.count;i<e;i+=9){var n=t.normalArray,s=(n[i+0]+n[i+3]+n[i+6])/3,l=(n[i+1]+n[i+4]+n[i+7])/3,p=(n[i+2]+n[i+5]+n[i+8])/3;n[i+0]=s,n[i+1]=l,n[i+2]=p,n[i+3]=s,n[i+4]=l,n[i+5]=p,n[i+6]=s,n[i+7]=l,n[i+8]=p}_e.bufferData(_e.ARRAY_BUFFER,t.normalArray,_e.DYNAMIC_DRAW),Z.enableAttribute(r.normal),_e.vertexAttribPointer(r.normal,3,_e.FLOAT,!1,0,0)}t.hasUvs&&a.map&&(_e.bindBuffer(_e.ARRAY_BUFFER,o.uv),_e.bufferData(_e.ARRAY_BUFFER,t.uvArray,_e.DYNAMIC_DRAW),Z.enableAttribute(r.uv),_e.vertexAttribPointer(r.uv,2,_e.FLOAT,!1,0,0)),t.hasColors&&0!==a.vertexColors&&(_e.bindBuffer(_e.ARRAY_BUFFER,o.color),_e.bufferData(_e.ARRAY_BUFFER,t.colorArray,_e.DYNAMIC_DRAW),Z.enableAttribute(r.color),_e.vertexAttribPointer(r.color,3,_e.FLOAT,!1,0,0)),Z.disableUnusedAttributes(),_e.drawArrays(_e.TRIANGLES,0,t.count),t.count=0},this.renderBufferDirect=function(o,a,i,s,d,e){var c=d.isMesh&&0>d.matrixWorld.determinant();Z.setMaterial(s,c);var g=$(o,a,s,d);o=i.id+"_"+g.id+"_"+(!0===s.wireframe);var f=!1;o!==P&&(P=o,f=!0),d.morphTargetInfluences&&(Ie.update(d,i,s,g),f=!0);var c=i.index,h=i.attributes.position;if(a=1,!0===s.wireframe&&(c=Me.getWireframeAttribute(i),a=2),o=Ne,null!==c){var m=Se.get(c);o=Ue,o.setIndex(m)}if(f){if(f=void 0,i&&i.isInstancedBufferGeometry&&null===F.get("ANGLE_instanced_arrays"))console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{void 0===f&&(f=0),Z.initAttributes();var n=i.attributes,g=g.getAttributes(),t=s.defaultAttributeValues;for(E in g){var l=g[E];if(0<=l){var r=n[E];if(void 0!==r){var v=r.normalized,p=r.itemSize,u=Se.get(r);if(void 0!==u){var _=u.buffer,y=u.type,u=u.bytesPerElement;if(r.isInterleavedBufferAttribute){var x=r.data,b=x.stride,r=r.offset;x&&x.isInstancedInterleavedBuffer?(Z.enableAttributeAndDivisor(l,x.meshPerAttribute),void 0===i.maxInstancedCount&&(i.maxInstancedCount=x.meshPerAttribute*x.count)):Z.enableAttribute(l),_e.bindBuffer(_e.ARRAY_BUFFER,_),_e.vertexAttribPointer(l,p,y,v,b*u,(f*b+r)*u)}else r.isInstancedBufferAttribute?(Z.enableAttributeAndDivisor(l,r.meshPerAttribute),void 0===i.maxInstancedCount&&(i.maxInstancedCount=r.meshPerAttribute*r.count)):Z.enableAttribute(l),_e.bindBuffer(_e.ARRAY_BUFFER,_),_e.vertexAttribPointer(l,p,y,v,0,f*p*u)}}else if(void 0!==t&&(v=t[E],void 0!==v))switch(v.length){case 2:_e.vertexAttrib2fv(l,v);break;case 3:_e.vertexAttrib3fv(l,v);break;case 4:_e.vertexAttrib4fv(l,v);break;default:_e.vertexAttrib1fv(l,v);}}}Z.disableUnusedAttributes()}null!==c&&_e.bindBuffer(_e.ELEMENT_ARRAY_BUFFER,m.buffer)}m=Infinity,null===c?void 0!==h&&(m=h.count):m=c.count,c=i.drawRange.start*a,h=null===e?0:e.start*a;var E=mn(c,h);if(e=mn(0,un(m,c+i.drawRange.count*a,h+(null===e?Infinity:e.count*a))-1-E+1),0!==e){if(!d.isMesh)d.isLine?(s=s.linewidth,void 0===s&&(s=1),Z.setLineWidth(s*(null===oe?le:1)),d.isLineSegments?o.setMode(_e.LINES):d.isLineLoop?o.setMode(_e.LINE_LOOP):o.setMode(_e.LINE_STRIP)):d.isPoints&&o.setMode(_e.POINTS);else if(!0===s.wireframe)Z.setLineWidth(s.wireframeLinewidth*(null===oe?le:1)),o.setMode(_e.LINES);else switch(d.drawMode){case 0:o.setMode(_e.TRIANGLES);break;case 1:o.setMode(_e.TRIANGLE_STRIP);break;case 2:o.setMode(_e.TRIANGLE_FAN);}i&&i.isInstancedBufferGeometry?0<i.maxInstancedCount&&o.renderInstances(i,E,e):o.render(E,e)}},this.compile=function(e,t){te.length=0,D.length=0,e.traverse(function(e){e.isLight&&(te.push(e),e.castShadow&&D.push(e))}),we.setup(te,D,t),e.traverse(function(t){if(t.material)if(Array.isArray(t.material))for(var r=0;r<t.material.length;r++)O(t.material[r],e.fog,t);else O(t.material,e.fog,t)})};var Ge=!1,Oe=null;this.animate=function(e){Oe=e,Ge||((e=Fe.getDevice())&&e.isPresenting?e.requestAnimationFrame(c):window.requestAnimationFrame(c),Ge=!0)},this.render=function(t,r,a,o){if(!r||!r.isCamera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else if(!Y){P="",M=-1,L=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===r.parent&&r.updateMatrixWorld(),Fe.enabled&&(r=Fe.getCamera(r)),t.onBeforeRender(G,t,r,a),he.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),me.setFromMatrix(he),te.length=0,D.length=0,re.length=0,fe=this.localClippingEnabled,ge=ue.init(this.clippingPlanes,fe,r),E=Ce.get(t,r),E.init(),S(t,r,G.sortObjects),!0===G.sortObjects&&E.sort(),ge&&ue.beginShadows(),ze.render(D,t,r),we.setup(te,D,r),ge&&ue.endShadows(),this.info.autoReset&&this.info.reset(),void 0===a&&(a=null),this.setRenderTarget(a),Pe.render(E,t,r,o),o=E.opaque;var i=E.transparent;if(t.overrideMaterial){var e=t.overrideMaterial;o.length&&g(o,t,r,e),i.length&&g(i,t,r,e)}else o.length&&g(o,t,r),i.length&&g(i,t,r);De.render(re,t,r),a&&T.updateRenderTargetMipmap(a),Z.buffers.depth.setTest(!0),Z.buffers.depth.setMask(!0),Z.buffers.color.setMask(!0),Z.setPolygonOffset(!1),t.onAfterRender(G,t,r),Fe.enabled&&Fe.submitFrame(),E=null}},this.setFaceCulling=function(e,t){Z.setCullFace(e),Z.setFlipSided(0===t)},this.allocTextureUnit=function(){var e=V;return e>=be.maxTextures&&console.warn("THREE.WebGLRenderer: Trying to use "+e+" texture units while this GPU supports only "+be.maxTextures),V+=1,e},this.setTexture2D=function(){var e=!1;return function(t,r){t&&t.isWebGLRenderTarget&&(e||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),T.setTexture2D(t,r)}}(),this.setTexture=function(){var e=!1;return function(t,r){e||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),e=!0),T.setTexture2D(t,r)}}(),this.setTextureCube=function(){var e=!1;return function(t,r){t&&t.isWebGLRenderTargetCube&&(e||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?T.setTextureCube(t,r):T.setTextureCubeDynamic(t,r)}}(),this.getRenderTarget=function(){return oe},this.setRenderTarget=function(e){(oe=e)&&void 0===Ee.get(e).__webglFramebuffer&&T.setupRenderTarget(e);var t=null,r=!1;e?(t=Ee.get(e).__webglFramebuffer,e.isWebGLRenderTargetCube&&(t=t[e.activeCubeFace],r=!0),ie.copy(e.viewport),W.copy(e.scissor),ne=e.scissorTest):(ie.copy(pe).multiplyScalar(le),W.copy(de).multiplyScalar(le),ne=ce),J!==t&&(_e.bindFramebuffer(_e.FRAMEBUFFER,t),J=t),Z.viewport(ie),Z.scissor(W),Z.setScissorTest(ne),r&&(r=Ee.get(e.texture),_e.framebufferTexture2D(_e.FRAMEBUFFER,_e.COLOR_ATTACHMENT0,_e.TEXTURE_CUBE_MAP_POSITIVE_X+e.activeCubeFace,r.__webglTexture,e.activeMipMapLevel))},this.readRenderTargetPixels=function(t,r,a,o,i,e){if(t&&t.isWebGLRenderTarget){var s=Ee.get(t).__webglFramebuffer;if(s){var l=!1;s!==J&&(_e.bindFramebuffer(_e.FRAMEBUFFER,s),l=!0);try{var p=t.texture,d=p.format,c=p.type;1023!==d&&Be.convert(d)!==_e.getParameter(_e.IMPLEMENTATION_COLOR_READ_FORMAT)?console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format."):1009===c||Be.convert(c)===_e.getParameter(_e.IMPLEMENTATION_COLOR_READ_TYPE)||1015===c&&(F.get("OES_texture_float")||F.get("WEBGL_color_buffer_float"))||1016===c&&F.get("EXT_color_buffer_half_float")?_e.checkFramebufferStatus(_e.FRAMEBUFFER)===_e.FRAMEBUFFER_COMPLETE?0<=r&&r<=t.width-o&&0<=a&&a<=t.height-i&&_e.readPixels(r,a,o,i,Be.convert(d),Be.convert(c),e):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."):console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.")}finally{l&&_e.bindFramebuffer(_e.FRAMEBUFFER,J)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(t,r,a){var o=r.image.width,i=r.image.height,e=Be.convert(r.format);this.setTexture2D(r,0),_e.copyTexImage2D(_e.TEXTURE_2D,a||0,e,t.x,t.y,o,i,0)}}function be(e,t){this.name="",this.color=new Oe(e),this.density=void 0===t?2.5E-4:t}function ur(e,t,r){this.name="",this.color=new Oe(e),this.near=void 0===t?1:t,this.far=void 0===r?1E3:r}function gr(){dt.call(this),this.type="Scene",this.overrideMaterial=this.fog=this.background=null,this.autoUpdate=!0}function fr(e){et.call(this),this.type="SpriteMaterial",this.color=new Oe(16777215),this.map=null,this.rotation=0,this.lights=this.fog=!1,this.setValues(e)}function hr(e){dt.call(this),this.type="Sprite",this.material=void 0===e?new fr:e,this.center=new o(.5,.5)}function yr(){dt.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function xr(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else for(console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[],e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new i)}function vr(){dt.call(this),this.type="Bone"}function _r(e,t){Ut.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new i,this.bindMatrixInverse=new i,e=this.initBones(),e=new xr(e),this.bind(e,this.matrixWorld),this.normalizeSkinWeights()}function br(e){et.call(this),this.type="LineBasicMaterial",this.color=new Oe(16777215),this.linewidth=1,this.linejoin=this.linecap="round",this.lights=!1,this.setValues(e)}function Er(e,t,r){return 1===r?(console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new Tr(e,t)):void(dt.call(this),this.type="Line",this.geometry=void 0===e?new St:e,this.material=void 0===t?new br({color:16777215*Math.random()}):t)}function Tr(e,t){Er.call(this,e,t),this.type="LineSegments"}function Sr(e,t){Er.call(this,e,t),this.type="LineLoop"}function Mr(e){et.call(this),this.type="PointsMaterial",this.color=new Oe(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.lights=!1,this.setValues(e)}function Ar(e,t){dt.call(this),this.type="Points",this.geometry=void 0===e?new St:e,this.material=void 0===t?new Mr({color:16777215*Math.random()}):t}function wr(){dt.call(this),this.type="Group"}function Rr(t,a,o,i,n,e,s,l,p){r.call(this,t,a,o,i,n,e,s,l,p),this.generateMipmaps=!1}function Lr(o,a,i,s,l,e,p,d,u,g,m,t){r.call(this,null,e,p,d,u,g,s,l,m,t),this.image={width:a,height:i},this.mipmaps=o,this.generateMipmaps=this.flipY=!1}function Cr(t,o,i,n,s,e,l,p,d,c){if(c=void 0===c?1026:c,1026!==c&&1027!==c)throw Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&1026===c&&(i=1012),void 0===i&&1027===c&&(i=1020),r.call(this,null,n,s,e,l,p,c,i,d),this.image={width:t,height:o},this.magFilter=void 0===l?1003:l,this.minFilter=void 0===p?1003:p,this.generateMipmaps=this.flipY=!1}function Pr(o){St.call(this),this.type="WireframeGeometry";var a=[],i=[0,0],s={},p=["a","b","c"],u,c,d;if(o&&o.isGeometry){var e=o.faces,g=0;for(c=e.length;g<c;g++){var m=e[g];for(u=0;3>u;u++){var t=m[p[u]],n=m[p[(u+1)%3]];i[0]=un(t,n),i[1]=mn(t,n),t=i[0]+","+i[1],void 0===s[t]&&(s[t]={index1:i[0],index2:i[1]})}}for(t in s)g=s[t],p=o.vertices[g.index1],a.push(p.x,p.y,p.z),p=o.vertices[g.index2],a.push(p.x,p.y,p.z)}else if(o&&o.isBufferGeometry){var p=new _;if(null!==o.index){e=o.attributes.position,m=o.index;var l=o.groups;for(0===l.length&&(l=[{start:0,count:m.count,materialIndex:0}]),o=0,d=l.length;o<d;++o)for(g=l[o],u=g.start,c=g.count,g=u,c=u+c;g<c;g+=3)for(u=0;3>u;u++)t=m.getX(g+u),n=m.getX(g+(u+1)%3),i[0]=un(t,n),i[1]=mn(t,n),t=i[0]+","+i[1],void 0===s[t]&&(s[t]={index1:i[0],index2:i[1]});for(t in s)g=s[t],p.fromBufferAttribute(e,g.index1),a.push(p.x,p.y,p.z),p.fromBufferAttribute(e,g.index2),a.push(p.x,p.y,p.z)}else for(e=o.attributes.position,g=0,c=e.count/3;g<c;g++)for(u=0;3>u;u++)s=3*g+u,p.fromBufferAttribute(e,s),a.push(p.x,p.y,p.z),s=3*g+(u+1)%3,p.fromBufferAttribute(e,s),a.push(p.x,p.y,p.z)}this.addAttribute("position",new Et(a,3))}function Ir(e,t,r){gt.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:r},this.fromBufferGeometry(new Nr(e,t,r)),this.mergeVertices()}function Nr(o,i,s){St.call(this),this.type="ParametricBufferGeometry",this.parameters={func:o,slices:i,stacks:s};var p=[],d=[],e=[],f=[],g=new _,h=new _,y=new _,m=new _,t=new _,n=i+1,x,l;for(x=0;x<=s;x++){var r=x/s;for(l=0;l<=i;l++){var u=l/i,h=o(u,r,h);d.push(h.x,h.y,h.z),0<=u-1E-5?(y=o(u-1E-5,r,y),m.subVectors(h,y)):(y=o(u+1E-5,r,y),m.subVectors(y,h)),0<=r-1E-5?(y=o(u,r-1E-5,y),t.subVectors(h,y)):(y=o(u,r+1E-5,y),t.subVectors(y,h)),g.crossVectors(m,t).normalize(),e.push(g.x,g.y,g.z),f.push(u,r)}}for(x=0;x<s;x++)for(l=0;l<i;l++)o=x*n+l+1,g=(x+1)*n+l+1,h=(x+1)*n+l,p.push(x*n+l,o,h),p.push(o,g,h);this.setIndex(p),this.addAttribute("position",new Et(d,3)),this.addAttribute("normal",new Et(e,3)),this.addAttribute("uv",new Et(f,2))}function Ur(e,t,r,o){gt.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:o},this.fromBufferGeometry(new Dr(e,t,r,o)),this.mergeVertices()}function Dr(t,r,i,n){function s(e){m.push(e.x,e.y,e.z)}function e(e,r){e*=3,r.x=t[e+0],r.y=t[e+1],r.z=t[e+2]}function p(e,t,r,a){0>a&&1===e.x&&(u[t]=e.x-1),0===r.x&&0===r.z&&(u[t]=a/2/ln+.5)}St.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:r,radius:i,detail:n},i=i||1,n=n||0;var m=[],u=[];(function(t){for(var a=new _,o=new _,i=new _,n=0;n<r.length;n+=3){e(r[n+0],a),e(r[n+1],o),e(r[n+2],i);var p=a,l=i,d=sn(2,t),c=[],u,g;for(g=0;g<=d;g++){c[g]=[];var m=p.clone().lerp(l,g/d),f=o.clone().lerp(l,g/d),h=d-g;for(u=0;u<=h;u++)c[g][u]=0===u&&g===d?m:m.clone().lerp(f,u/h)}for(g=0;g<d;g++)for(u=0;u<2*(d-g)-1;u++)p=hn(u/2),0===u%2?(s(c[g][p+1]),s(c[g+1][p]),s(c[g][p])):(s(c[g][p+1]),s(c[g+1][p+1]),s(c[g+1][p]))}})(n),function(e){for(var t=new _,r=0;r<m.length;r+=3)t.x=m[r+0],t.y=m[r+1],t.z=m[r+2],t.normalize().multiplyScalar(e),m[r+0]=t.x,m[r+1]=t.y,m[r+2]=t.z}(i),function(){for(var t=new _,r=0;r<m.length;r+=3)t.x=m[r+0],t.y=m[r+1],t.z=m[r+2],u.push(nn(t.z,-t.x)/2/ln+.5,1-(nn(-t.y,pn(t.x*t.x+t.z*t.z))/ln+.5));for(var t=new _,r=new _,a=new _,i=new _,n=new o,e=new o,s=new o,l=0,d=0;l<m.length;l+=9,d+=6){t.set(m[l+0],m[l+1],m[l+2]),r.set(m[l+3],m[l+4],m[l+5]),a.set(m[l+6],m[l+7],m[l+8]),n.set(u[d+0],u[d+1]),e.set(u[d+2],u[d+3]),s.set(u[d+4],u[d+5]),i.copy(t).add(r).add(a).divideScalar(3);var c=nn(i.z,-i.x);p(n,d+0,t,c),p(e,d+2,r,c),p(s,d+4,a,c)}for(t=0;t<u.length;t+=6)r=u[t+0],a=u[t+2],i=u[t+4],n=un(r,a,i),.9<mn(r,a,i)&&.1>n&&(.2>r&&(u[t+0]+=1),.2>a&&(u[t+2]+=1),.2>i&&(u[t+4]+=1))}(),this.addAttribute("position",new Et(m,3)),this.addAttribute("normal",new Et(m.slice(),3)),this.addAttribute("uv",new Et(u,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}function Br(e,t){gt.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Fr(e,t)),this.mergeVertices()}function Fr(e,t){Dr.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function zr(e,t){gt.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Gr(e,t)),this.mergeVertices()}function Gr(e,t){Dr.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Or(e,t){gt.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Hr(e,t)),this.mergeVertices()}function Hr(e,t){var r=(1+2.23606797749979)/2;Dr.call(this,[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Vr(e,t){gt.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new kr(e,t)),this.mergeVertices()}function kr(e,t){var r=(1+2.23606797749979)/2,o=1/r;Dr.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-o,-r,0,-o,r,0,o,-r,0,o,r,-o,-r,0,-o,r,0,o,-r,0,o,r,0,-r,0,-o,r,0,-o,-r,0,o,r,0,o],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Wr(t,r,o,i,n,s){gt.call(this),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:r,radius:o,radialSegments:i,closed:n},void 0!==s&&console.warn("THREE.TubeGeometry: taper has been removed."),t=new jr(t,r,o,i,n),this.tangents=t.tangents,this.normals=t.normals,this.binormals=t.binormals,this.fromBufferGeometry(t),this.mergeVertices()}function jr(i,s,p,y,x){function v(a){T=i.getPointAt(a/s,T);var e=E.normals[a];for(a=E.binormals[a],M=0;M<=y;M++){var o=2*(M/y*ln),l=on(o),o=-gn(o);h.x=o*e.x+l*a.x,h.y=o*e.y+l*a.y,h.z=o*e.z+l*a.z,h.normalize(),r.push(h.x,h.y,h.z),g.x=T.x+p*h.x,g.y=T.y+p*h.y,g.z=T.z+p*h.z,t.push(g.x,g.y,g.z)}}St.call(this),this.type="TubeBufferGeometry",this.parameters={path:i,tubularSegments:s,radius:p,radialSegments:y,closed:x},s=s||64,p=p||1,y=y||8,x=x||!1;var E=i.computeFrenetFrames(s,x);this.tangents=E.tangents,this.normals=E.normals,this.binormals=E.binormals;var g=new _,h=new _,f=new o,T=new _,t=[],r=[],m=[],u=[],S,M;for(S=0;S<s;S++)v(S);for(v(!1===x?s:0),S=0;S<=s;S++)for(M=0;M<=y;M++)f.x=S/s,f.y=M/y,m.push(f.x,f.y);(function(){for(M=1;M<=s;M++)for(S=1;S<=y;S++){var t=(y+1)*M+(S-1),r=(y+1)*M+S,a=(y+1)*(M-1)+S;u.push((y+1)*(M-1)+(S-1),t,a),u.push(t,r,a)}})(),this.setIndex(u),this.addAttribute("position",new Et(t,3)),this.addAttribute("normal",new Et(r,3)),this.addAttribute("uv",new Et(m,2))}function Xr(t,r,o,i,n,s,l){gt.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:r,tubularSegments:o,radialSegments:i,p:n,q:s},void 0!==l&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new Yr(t,r,o,i,n,s)),this.mergeVertices()}function Yr(o,i,s,p,v,E){function T(t,r,a,o,i){var e=on(t);r=a/r*t,a=gn(r),i.x=.5*(o*(2+a))*gn(t),i.y=.5*(o*(2+a)*e),i.z=.5*(o*on(r))}St.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:o,tube:i,tubularSegments:s,radialSegments:p,p:v,q:E},o=o||1,i=i||.4,s=hn(s)||64,p=hn(p)||8,v=v||2,E=E||3;var g=[],h=[],S=[],m=[],t=new _,l=new _,r=new _,M=new _,u=new _,w=new _,x=new _,L;for(L=0;L<=s;++L){var n=2*(L/s*v*ln);for(T(n,v,E,o,r),T(n+.01,v,E,o,M),w.subVectors(M,r),x.addVectors(M,r),u.crossVectors(w,x),x.crossVectors(u,w),u.normalize(),x.normalize(),n=0;n<=p;++n){var A=2*(n/p*ln),y=-i*gn(A),A=i*on(A);t.x=r.x+(y*x.x+A*u.x),t.y=r.y+(y*x.y+A*u.y),t.z=r.z+(y*x.z+A*u.z),h.push(t.x,t.y,t.z),l.subVectors(t,r).normalize(),S.push(l.x,l.y,l.z),m.push(L/s),m.push(n/p)}}for(n=1;n<=s;n++)for(L=1;L<=p;L++)o=(p+1)*n+(L-1),i=(p+1)*n+L,v=(p+1)*(n-1)+L,g.push((p+1)*(n-1)+(L-1),o,v),g.push(o,i,v);this.setIndex(g),this.addAttribute("position",new Et(h,3)),this.addAttribute("normal",new Et(S,3)),this.addAttribute("uv",new Et(m,2))}function qr(t,r,o,i,n){gt.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:r,radialSegments:o,tubularSegments:i,arc:n},this.fromBufferGeometry(new Zr(t,r,o,i,n)),this.mergeVertices()}function Zr(o,i,s,p,y){St.call(this),this.type="TorusBufferGeometry",this.parameters={radius:o,tube:i,radialSegments:s,tubularSegments:p,arc:y},o=o||1,i=i||.4,s=hn(s)||8,p=hn(p)||6,y=y||2*ln;var x=[],f=[],g=[],h=[],v=new _,m=new _,t=new _,n,l;for(n=0;n<=s;n++)for(l=0;l<=p;l++){var r=l/p*y,E=2*(n/s*ln);m.x=(o+i*gn(E))*gn(r),m.y=(o+i*gn(E))*on(r),m.z=i*on(E),f.push(m.x,m.y,m.z),v.x=o*gn(r),v.y=o*on(r),t.subVectors(m,v).normalize(),g.push(t.x,t.y,t.z),h.push(l/p),h.push(n/s)}for(n=1;n<=s;n++)for(l=1;l<=p;l++)o=(p+1)*(n-1)+l-1,i=(p+1)*(n-1)+l,y=(p+1)*n+l,x.push((p+1)*n+l-1,o,y),x.push(o,i,y);this.setIndex(x),this.addAttribute("position",new Et(f,3)),this.addAttribute("normal",new Et(g,3)),this.addAttribute("uv",new Et(h,2))}function Jr(t,r,a,o,i){for(var e=0,n=r,s=a-o,l;n<a;n+=o)e+=(t[s]-t[n])*(t[n+1]+t[s+1]),s=n;if(i===0<e)for(i=r;i<a;i+=o)l=fa(i,t[i],t[i+1],l);else for(i=a-o;i>=r;i-=o)l=fa(i,t[i],t[i+1],l);return l&&na(l,l.next)&&(xa(l),l=l.next),l}function $e(e,t){if(!e)return e;t||(t=e);do{var r=!1;if(e.steiner||!na(e,e.next)&&0!==ia(e.prev,e,e.next))e=e.next;else{if(xa(e),e=t=e.prev,e===e.next)break;r=!0}}while(r||e!==t);return t}function Qr(o,a,i,s,d,e,c){if(o){if(!c&&e){var u=o,f=u;do null===f.z&&(f.z=ea(f.x,f.y,s,d,e)),f.prevZ=f.prev,f=f.nextZ=f.next;while(f!==u);f.prevZ.nextZ=null,f.prevZ=null;var u=f,h=1,r,m,y,n;do{f=u;var l=u=null;for(m=0;f;){m++;var v=f;for(r=y=0;r<h&&(y++,v=v.nextZ,v);r++);for(n=h;0<y||0<n&&v;)0!==y&&(0===n||!v||f.z<=v.z)?(r=f,f=f.nextZ,y--):(r=v,v=v.nextZ,n--),l?l.nextZ=r:u=r,r.prevZ=l,l=r;f=v}l.nextZ=null,h*=2}while(1<m)}for(u=o;o.prev!==o.next;){if(f=o.prev,v=o.next,e)a:{l=o,n=s;var _=d,b=e;if(m=l.prev,y=l,h=l.next,0<=ia(m,y,h))l=!1;else{var x=m.x>y.x?m.x>h.x?m.x:h.x:y.x>h.x?y.x:h.x,E=m.y>y.y?m.y>h.y?m.y:h.y:y.y>h.y?y.y:h.y;for(r=ea(m.x<y.x?m.x<h.x?m.x:h.x:y.x<h.x?y.x:h.x,m.y<y.y?m.y<h.y?m.y:h.y:y.y<h.y?y.y:h.y,n,_,b),n=ea(x,E,n,_,b),_=l.nextZ;_&&_.z<=n;){if(_!==l.prev&&_!==l.next&&aa(m.x,m.y,y.x,y.y,h.x,h.y,_.x,_.y)&&0<=ia(_.prev,_,_.next)){l=!1;break a}_=_.nextZ}for(_=l.prevZ;_&&_.z>=r;){if(_!==l.prev&&_!==l.next&&aa(m.x,m.y,y.x,y.y,h.x,h.y,_.x,_.y)&&0<=ia(_.prev,_,_.next)){l=!1;break a}_=_.prevZ}l=!0}}else a:if(l=o,m=l.prev,y=l,h=l.next,0<=ia(m,y,h))l=!1;else{for(r=l.next.next;r!==l.prev;){if(aa(m.x,m.y,y.x,y.y,h.x,h.y,r.x,r.y)&&0<=ia(r.prev,r,r.next)){l=!1;break a}r=r.next}l=!0}if(l)a.push(f.i/i),a.push(o.i/i),a.push(v.i/i),xa(o),u=o=v.next;else if(o=v,o===u){if(!c)Qr($e(o),a,i,s,d,e,1);else if(1===c){c=a,u=i,f=o;do v=f.prev,l=f.next.next,!na(v,l)&&sa(v,f,f.next,l)&&la(v,l)&&la(l,v)&&(c.push(v.i/u),c.push(f.i/u),c.push(l.i/u),xa(f),xa(f.next),f=o=l),f=f.next;while(f!==o);o=f,Qr(o,a,i,s,d,e,2)}else if(2===c)a:{c=o;do{for(u=c.next.next;u!==c.prev;){if(f=c.i!==u.i){if(f=c,v=u,l=f.next.i!==v.i&&f.prev.i!==v.i){b:{l=f;do{if(l.i!==f.i&&l.next.i!==f.i&&l.i!==v.i&&l.next.i!==v.i&&sa(l,l.next,f,v)){l=!0;break b}l=l.next}while(l!==f);l=!1}l=!l}if(l=l&&la(f,v)&&la(v,f)){l=f,m=!1,y=(f.x+v.x)/2,v=(f.y+v.y)/2;do l.y>v!==l.next.y>v&&l.next.y!==l.y&&y<(l.next.x-l.x)*(v-l.y)/(l.next.y-l.y)+l.x&&(m=!m),l=l.next;while(l!==f);l=m}f=l}if(f){o=ga(c,u),c=$e(c,c.next),o=$e(o,o.next),Qr(c,a,i,s,d,e),Qr(o,a,i,s,d,e);break a}u=u.next}c=c.next}while(c!==o)}break}}}}function Kr(e,t){return e.x-t.x}function $r(r,a){var o=a,i=r.x,n=r.y,e=-Infinity;do{if(n<=o.y&&n>=o.next.y&&o.next.y!==o.y){var s=o.x+(n-o.y)*(o.next.x-o.x)/(o.next.y-o.y);if(s<=i&&s>e){if(e=s,s===i){if(n===o.y)return o;if(n===o.next.y)return o.next}var l=o.x<o.next.x?o:o.next}}o=o.next}while(o!==a);if(!l)return null;if(i===e)return l.prev;a=l;for(var s=l.x,p=l.y,d=Infinity,o=l.next,c;o!==a;)i>=o.x&&o.x>=s&&i!==o.x&&aa(n<p?i:e,n,s,p,n<p?e:i,n,o.x,o.y)&&(c=fn(n-o.y)/(i-o.x),(c<d||c===d&&o.x>l.x)&&la(o,r)&&(l=o,d=c)),o=o.next;return l}function ea(t,r,a,o,i){return t=32767*(t-a)*i,r=32767*(r-o)*i,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),r=16711935&(r|r<<8),r=252645135&(r|r<<4),r=858993459&(r|r<<2),1431655765&(t|t<<1)|(1431655765&(r|r<<1))<<1}function de(e){var t=e,r=e;do t.x<r.x&&(r=t),t=t.next;while(t!==e);return r}function aa(t,r,a,o,i,e,n,s){return 0<=(i-n)*(r-s)-(t-n)*(e-s)&&0<=(t-n)*(o-s)-(a-n)*(r-s)&&0<=(a-n)*(e-s)-(i-n)*(o-s)}function ia(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function na(e,t){return e.x===t.x&&e.y===t.y}function sa(e,t,r,a){return na(e,t)&&na(r,a)||na(e,a)&&na(r,t)||0<ia(e,t,r)!==0<ia(e,t,a)&&0<ia(r,a,e)!==0<ia(r,a,t)}function la(e,t){return 0>ia(e.prev,e,e.next)?0<=ia(e,t,e.next)&&0<=ia(e,e.prev,t):0>ia(e,t,e.prev)||0>ia(e,e.next,t)}function ga(t,r){var a=new _a(t.i,t.x,t.y),o=new _a(r.i,r.x,r.y),i=t.next,e=r.prev;return t.next=r,r.prev=t,a.next=i,i.prev=a,o.next=a,a.prev=o,e.next=o,o.prev=e,o}function fa(e,t,r,a){return e=new _a(e,t,r),a?(e.next=a.next,e.prev=a,a.next.prev=e,a.next=e):(e.prev=e,e.next=e),e}function xa(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function _a(e,t,r){this.i=e,this.x=t,this.y=r,this.nextZ=this.prevZ=this.z=this.next=this.prev=null,this.steiner=!1}function ee(e){var t=e.length;2<t&&e[t-1].equals(e[0])&&e.pop()}function ba(e,t){for(var r=0;r<t.length;r++)e.push(t[r].x),e.push(t[r].y)}function Ea(e,t){gt.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new wa(e,t)),this.mergeVertices()}function wa(e,t){"undefined"!==typeof e&&(St.call(this),this.type="ExtrudeBufferGeometry",e=Array.isArray(e)?e:[e],this.addShapeList(e,t),this.computeVertexNormals())}function Ra(e,t){gt.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new Pa(e,t)),this.mergeVertices()}function Pa(e,t){t=t||{};var r=t.font;return r&&r.isFont?void(e=r.generateShapes(e,t.size,t.curveSegments),t.amount=void 0===t.height?50:t.height,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),wa.call(this,e,t),this.type="TextBufferGeometry"):(console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new gt)}function Da(t,r,o,i,n,s,l){gt.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:r,heightSegments:o,phiStart:i,phiLength:n,thetaStart:s,thetaLength:l},this.fromBufferGeometry(new Oa(t,r,o,i,n,s,l)),this.mergeVertices()}function Oa(o,i,s,p,v,E,T){St.call(this),this.type="SphereBufferGeometry",this.parameters={radius:o,widthSegments:i,heightSegments:s,phiStart:p,phiLength:v,thetaStart:E,thetaLength:T},o=o||1,i=mn(3,hn(i)||8),s=mn(2,hn(s)||6),p=void 0===p?0:p,v=void 0===v?2*ln:v,E=void 0===E?0:E,T=void 0===T?ln:T;var S=E+T,h=0,t=[],n=new _,l=new _,r=[],M=[],u=[],w=[],x,R;for(R=0;R<=s;R++){var m=[],L=R/s;for(x=0;x<=i;x++){var A=x/i;n.x=-o*gn(p+A*v)*on(E+L*T),n.y=o*gn(E+L*T),n.z=o*on(p+A*v)*on(E+L*T),M.push(n.x,n.y,n.z),l.set(n.x,n.y,n.z).normalize(),u.push(l.x,l.y,l.z),w.push(A,1-L),m.push(h++)}t.push(m)}for(R=0;R<s;R++)for(x=0;x<i;x++)o=t[R][x+1],p=t[R][x],v=t[R+1][x],T=t[R+1][x+1],(0!==R||0<E)&&r.push(o,p,T),(R!==s-1||S<ln)&&r.push(p,v,T);this.setIndex(r),this.addAttribute("position",new Et(M,3)),this.addAttribute("normal",new Et(u,3)),this.addAttribute("uv",new Et(w,2))}function Va(t,r,o,i,n,s){gt.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:r,thetaSegments:o,phiSegments:i,thetaStart:n,thetaLength:s},this.fromBufferGeometry(new Wa(t,r,o,i,n,s)),this.mergeVertices()}function Wa(i,s,p,y,x,v){St.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:i,outerRadius:s,thetaSegments:p,phiSegments:y,thetaStart:x,thetaLength:v},i=i||.5,s=s||1,x=void 0===x?0:x,v=void 0===v?2*ln:v,p=void 0===p?8:mn(3,p),y=void 0===y?1:mn(1,y);var E=[],g=[],h=[],T=[],m=i,t=(s-i)/y,n=new _,l=new o,r,S;for(r=0;r<=y;r++){for(S=0;S<=p;S++)i=x+S/p*v,n.x=m*gn(i),n.y=m*on(i),g.push(n.x,n.y,n.z),h.push(0,0,1),l.x=(n.x/s+1)/2,l.y=(n.y/s+1)/2,T.push(l.x,l.y);m+=t}for(r=0;r<y;r++)for(s=r*(p+1),S=0;S<p;S++)i=S+s,x=i+p+1,v=i+p+2,m=i+1,E.push(i,x,m),E.push(x,v,m);this.setIndex(E),this.addAttribute("position",new Et(g,3)),this.addAttribute("normal",new Et(h,3)),this.addAttribute("uv",new Et(T,2))}function Xa(e,t,r,o){gt.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:o},this.fromBufferGeometry(new qa(e,t,r,o)),this.mergeVertices()}function qa(i,s,p,u){St.call(this),this.type="LatheBufferGeometry",this.parameters={points:i,segments:s,phiStart:p,phiLength:u},s=hn(s)||12,p=p||0,u=u||2*ln,u=yn.clamp(u,0,2*ln);var y=[],e=[],f=[],g=1/s,h=new _,x=new o,m;for(m=0;m<=s;m++){var t=p+m*g*u,n=on(t),l=gn(t);for(t=0;t<=i.length-1;t++)h.x=i[t].x*n,h.y=i[t].y,h.z=i[t].x*l,e.push(h.x,h.y,h.z),x.x=m/s,x.y=t/(i.length-1),f.push(x.x,x.y)}for(m=0;m<s;m++)for(t=0;t<i.length-1;t++)p=t+m*i.length,g=p+i.length,h=p+i.length+1,x=p+1,y.push(p,g,x),y.push(g,h,x);if(this.setIndex(y),this.addAttribute("position",new Et(e,3)),this.addAttribute("uv",new Et(f,2)),this.computeVertexNormals(),u===2*ln)for(u=this.attributes.normal.array,y=new _,e=new _,f=new _,p=3*(s*i.length),t=m=0;m<i.length;m++,t+=3)y.x=u[t+0],y.y=u[t+1],y.z=u[t+2],e.x=u[p+t+0],e.y=u[p+t+1],e.z=u[p+t+2],f.addVectors(y,e).normalize(),u[t+0]=u[p+t+0]=f.x,u[t+1]=u[p+t+1]=f.y,u[t+2]=u[p+t+2]=f.z}function eo(e,t){gt.call(this),this.type="ShapeGeometry","object"===("undefined"===typeof t?"undefined":babelHelpers.typeof(t))&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new to(e,t)),this.mergeVertices()}function to(t,r){function o(o){var a=n.length/3,u;o=o.extractPoints(r);var g=o.shape,m=o.holes;if(!1===wn.isClockWise(g))for(g=g.reverse(),o=0,u=m.length;o<u;o++){var t=m[o];!0===wn.isClockWise(t)&&(m[o]=t.reverse())}var l=wn.triangulateShape(g,m);for(o=0,u=m.length;o<u;o++)t=m[o],g=g.concat(t);for(o=0,u=g.length;o<u;o++)t=g[o],n.push(t.x,t.y,0),e.push(0,0,1),s.push(t.x,t.y);for(o=0,u=l.length;o<u;o++)g=l[o],i.push(g[0]+a,g[1]+a,g[2]+a),d+=3}St.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:r},r=r||12;var i=[],n=[],e=[],s=[],l=0,d=0;if(!1===Array.isArray(t))o(t);else for(var p=0;p<t.length;p++)o(t[p]),this.addGroup(l,d,p),l+=d,d=0;this.setIndex(i),this.addAttribute("position",new Et(n,3)),this.addAttribute("normal",new Et(e,3)),this.addAttribute("uv",new Et(s,2))}function ro(e,t){if(t.shapes=[],Array.isArray(e))for(var r=0,a=e.length;r<a;r++)t.shapes.push(e[r].uuid);else t.shapes.push(e.uuid);return t}function ao(r,a){St.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:a};var o=[];a=gn(yn.DEG2RAD*(void 0===a?1:a));var i=[0,0],s={},e=["a","b","c"];if(r.isBufferGeometry){var p=new gt;p.fromBufferGeometry(r)}else p=r.clone();p.mergeVertices(),p.computeFaceNormals(),r=p.vertices,p=p.faces;for(var d=0,c=p.length;d<c;d++)for(var u=p[d],m=0;3>m;m++){var t=u[e[m]],n=u[e[(m+1)%3]];i[0]=un(t,n),i[1]=mn(t,n),t=i[0]+","+i[1],void 0===s[t]?s[t]={index1:i[0],index2:i[1],face1:d,face2:void 0}:s[t].face2=d}for(t in s)(i=s[t],void 0===i.face2||p[i.face1].normal.dot(p[i.face2].normal)<=a)&&(e=r[i.index1],o.push(e.x,e.y,e.z),e=r[i.index2],o.push(e.x,e.y,e.z));this.addAttribute("position",new Et(o,3))}function oo(t,r,o,i,n,s,l,p){gt.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:r,height:o,radialSegments:i,heightSegments:n,openEnded:s,thetaStart:l,thetaLength:p},this.fromBufferGeometry(new io(t,r,o,i,n,s,l,p)),this.mergeVertices()}function io(i,s,p,y,T,v,S,M){function E(a){var p=new o,d=new _,c=0,g=!0===a?i:s,u=!0===a?1:-1,f=r,h;for(h=1;h<=y;h++)t.push(0,P*u,0),n.push(0,u,0),l.push(.5,.5),r++;var e=r;for(h=0;h<=y;h++){var x=h/y*M+S,v=gn(x),x=on(x);d.x=g*x,d.y=P*u,d.z=g*v,t.push(d.x,d.y,d.z),n.push(0,u,0),p.x=.5*v+.5,p.y=.5*x*u+.5,l.push(p.x,p.y),r++}for(h=0;h<y;h++)p=f+h,d=e+h,!0===a?m.push(d,d+1,p):m.push(d+1,d,p),c+=3;A.addGroup(w,c,!0===a?1:2),w+=c}St.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:i,radiusBottom:s,height:p,radialSegments:y,heightSegments:T,openEnded:v,thetaStart:S,thetaLength:M};var A=this;i=void 0===i?1:i,s=void 0===s?1:s,p=p||1,y=hn(y)||8,T=hn(T)||1,v=void 0!==v&&v,S=void 0===S?0:S,M=void 0===M?2*ln:M;var m=[],t=[],n=[],l=[],r=0,L=[],P=p/2,w=0;(function(){var e=new _,a=new _,o=0,d=(s-i)/p,c,u;for(u=0;u<=T;u++){var g=[],f=u/T,h=f*(s-i)+i;for(c=0;c<=y;c++){var x=c/y,v=x*M+S,b=on(v),v=gn(v);a.x=h*b,a.y=-f*p+P,a.z=h*v,t.push(a.x,a.y,a.z),e.set(b,d,v).normalize(),n.push(e.x,e.y,e.z),l.push(x,1-f),g.push(r++)}L.push(g)}for(c=0;c<y;c++)for(u=0;u<T;u++)e=L[u+1][c],a=L[u+1][c+1],d=L[u][c+1],m.push(L[u][c],e,d),m.push(e,a,d),o+=6;A.addGroup(w,o,0),w+=o})(),!1===v&&(0<i&&E(!0),0<s&&E(!1)),this.setIndex(m),this.addAttribute("position",new Et(t,3)),this.addAttribute("normal",new Et(n,3)),this.addAttribute("uv",new Et(l,2))}function no(t,r,o,i,n,s,l){oo.call(this,0,t,r,o,i,n,s,l),this.type="ConeGeometry",this.parameters={radius:t,height:r,radialSegments:o,heightSegments:i,openEnded:n,thetaStart:s,thetaLength:l}}function so(t,r,o,i,n,s,l){io.call(this,0,t,r,o,i,n,s,l),this.type="ConeBufferGeometry",this.parameters={radius:t,height:r,radialSegments:o,heightSegments:i,openEnded:n,thetaStart:s,thetaLength:l}}function lo(e,t,r,o){gt.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:o},this.fromBufferGeometry(new po(e,t,r,o)),this.mergeVertices()}function po(r,i,s,p){St.call(this),this.type="CircleBufferGeometry",this.parameters={radius:r,segments:i,thetaStart:s,thetaLength:p},r=r||1,i=void 0===i?8:mn(3,i),s=void 0===s?0:s,p=void 0===p?2*ln:p;var u=[],e=[],f=[],g=[],h=new _,m=new o,t;e.push(0,0,0),f.push(0,0,1),g.push(.5,.5);var y=0;for(t=3;y<=i;y++,t+=3){var n=s+y/i*p;h.x=r*gn(n),h.y=r*on(n),e.push(h.x,h.y,h.z),f.push(0,0,1),m.x=(e[t]/r+1)/2,m.y=(e[t+1]/r+1)/2,g.push(m.x,m.y)}for(t=1;t<=i;t++)u.push(t,t+1,0);this.setIndex(u),this.addAttribute("position",new Et(e,3)),this.addAttribute("normal",new Et(f,3)),this.addAttribute("uv",new Et(g,2))}function co(e){et.call(this),this.type="ShadowMaterial",this.color=new Oe(0),this.opacity=1,this.transparent=this.lights=!0,this.setValues(e)}function mo(e){Ct.call(this,e),this.type="RawShaderMaterial"}function uo(e){et.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Oe(16777215),this.metalness=this.roughness=.5,this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Oe(0),this.emissiveIntensity=1,this.bumpMap=this.emissiveMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new o(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.envMap=this.alphaMap=this.metalnessMap=this.roughnessMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)}function go(e){uo.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoatRoughness=this.clearCoat=0,this.setValues(e)}function fo(e){et.call(this),this.type="MeshPhongMaterial",this.color=new Oe(16777215),this.specular=new Oe(1118481),this.shininess=30,this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Oe(0),this.emissiveIntensity=1,this.bumpMap=this.emissiveMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new o(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.envMap=this.alphaMap=this.specularMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)}function ho(e){fo.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(e)}function yo(e){et.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new o(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.morphNormals=this.morphTargets=this.skinning=this.lights=this.fog=!1,this.setValues(e)}function xo(e){et.call(this),this.type="MeshLambertMaterial",this.color=new Oe(16777215),this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Oe(0),this.emissiveIntensity=1,this.envMap=this.alphaMap=this.specularMap=this.emissiveMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)}function vo(e){br.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}function _o(t,r,a){var o=this,i=!1,e=0,n=0,s;this.onStart=void 0,this.onLoad=t,this.onProgress=r,this.onError=a,this.itemStart=function(t){n++,!1===i&&void 0!==o.onStart&&o.onStart(t,e,n),i=!0},this.itemEnd=function(t){e++,void 0!==o.onProgress&&o.onProgress(t,e,n),e===n&&(i=!1,void 0!==o.onLoad)&&o.onLoad()},this.itemError=function(e){void 0!==o.onError&&o.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this}}function fe(e){this.manager=void 0===e?Ln:e}function Ia(e){this.manager=void 0===e?Ln:e,this._parser=null}function bo(e){this.manager=void 0===e?Ln:e,this._parser=null}function ge(e){this.manager=void 0===e?Ln:e}function Eo(e){this.manager=void 0===e?Ln:e}function he(e){this.manager=void 0===e?Ln:e}function To(){this.type="Curve",this.arcLengthDivisions=200}function H(t,r,a,o,i,e,n,s){To.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=r||0,this.xRadius=a||1,this.yRadius=o||1,this.aStartAngle=i||0,this.aEndAngle=e||2*ln,this.aClockwise=n||!1,this.aRotation=s||0}function So(t,r,a,o,i,e){H.call(this,t,r,a,a,o,i,e),this.type="ArcCurve"}function Mo(){var r=0,a=0,o=0,i=0;return{initCatmullRom:function(t,e,n,s,l){t=l*(n-t),s=l*(s-e),r=e,a=t,o=-3*e+3*n-2*t-s,i=2*e-2*n+t+s},initNonuniformCatmullRom:function(n,e,s,l,p,d,c){n=((e-n)/p-(s-n)/(p+d)+(s-e)/d)*d,l=((s-e)/d-(l-e)/(d+c)+(l-s)/c)*d,r=e,a=n,o=-3*e+3*s-2*n-l,i=2*e-2*s+n+l},calc:function(t){var e=t*t;return r+a*t+o*e+i*e*t}}}function ie(e,t,r,a){To.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=r||"centripetal",this.tension=a||.5}function Ao(t,r,a,o,i){r=.5*(o-r),i=.5*(i-a);var e=t*t;return(2*a-2*o+r+i)*t*e+(-3*a+3*o-2*r-i)*e+r*t+a}function wo(t,r,a,o){var i=1-t;return i*i*r+2*(1-t)*t*a+t*t*o}function Ro(t,r,a,o,i){var e=1-t,n=1-t;return e*e*e*r+3*n*n*t*a+3*(1-t)*t*t*o+t*t*t*i}function Lo(e,t,r,a){To.call(this),this.type="CubicBezierCurve",this.v0=e||new o,this.v1=t||new o,this.v2=r||new o,this.v3=a||new o}function Co(e,t,r,a){To.call(this),this.type="CubicBezierCurve3",this.v0=e||new _,this.v1=t||new _,this.v2=r||new _,this.v3=a||new _}function Po(e,t){To.call(this),this.type="LineCurve",this.v1=e||new o,this.v2=t||new o}function Io(e,t){To.call(this),this.type="LineCurve3",this.v1=e||new _,this.v2=t||new _}function No(e,t,r){To.call(this),this.type="QuadraticBezierCurve",this.v0=e||new o,this.v1=t||new o,this.v2=r||new o}function Uo(e,t,r){To.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new _,this.v1=t||new _,this.v2=r||new _}function Do(e){To.call(this),this.type="SplineCurve",this.points=e||[]}function Bo(){To.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Fo(e){Bo.call(this),this.type="Path",this.currentPoint=new o,e&&this.setFromPoints(e)}function zo(e){Fo.call(this,e),this.uuid=yn.generateUUID(),this.type="Shape",this.holes=[]}function Go(e,t){dt.call(this),this.type="Light",this.color=new Oe(e),this.intensity=void 0===t?1:t,this.receiveShadow=void 0}function Oo(e,t,r){Go.call(this,e,r),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(dt.DefaultUp),this.updateMatrix(),this.groundColor=new Oe(t)}function Ho(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new o(512,512),this.map=null,this.matrix=new i}function Vo(){Ho.call(this,new lr(50,1,.5,500))}function ko(t,r,a,o,i,e){Go.call(this,t,r),this.type="SpotLight",this.position.copy(dt.DefaultUp),this.updateMatrix(),this.target=new dt,Object.defineProperty(this,"power",{get:function(){return this.intensity*ln},set:function(e){this.intensity=e/ln}}),this.distance=void 0===a?0:a,this.angle=void 0===o?ln/3:o,this.penumbra=void 0===i?0:i,this.decay=void 0===e?1:e,this.shadow=new Vo}function Wo(e,t,r,a){Go.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*ln},set:function(e){this.intensity=e/(4*ln)}}),this.distance=void 0===r?0:r,this.decay=void 0===a?1:a,this.shadow=new Ho(new lr(90,1,.5,500))}function jo(){Ho.call(this,new mt(-5,5,5,-5,.5,500))}function Xo(e,t){Go.call(this,e,t),this.type="DirectionalLight",this.position.copy(dt.DefaultUp),this.updateMatrix(),this.target=new dt,this.shadow=new jo}function Yo(e,t){Go.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function qo(e,t,r,a){Go.call(this,e,t),this.type="RectAreaLight",this.width=void 0===r?10:r,this.height=void 0===a?10:a}function Zo(e,t,r,a){oi.call(this,e,t,r,a)}function Jo(e,t,r){oi.call(this,e,t,r)}function Qo(e,t,r,a){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0===a?new t.constructor(r):a,this.sampleValues=t,this.valueSize=r}function ya(e,t,r,a){Qo.call(this,e,t,r,a)}function Ko(e,t,r,a){oi.call(this,e,t,r,a)}function $o(e,t,r,a){oi.call(this,e,t,r,a)}function ei(e,t,r,a){oi.call(this,e,t,r,a)}function ti(e,t,r,a){Qo.call(this,e,t,r,a),this._offsetNext=this._weightNext=this._offsetPrev=this._weightPrev=-0}function ri(e,t,r,a){Qo.call(this,e,t,r,a)}function ai(e,t,r,a){Qo.call(this,e,t,r,a)}function oi(e,t,r,a){if(void 0===e)throw Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=In.convertArray(t,this.TimeBufferType),this.values=In.convertArray(r,this.ValueBufferType),this.setInterpolation(a||this.DefaultInterpolation),this.validate(),this.optimize()}function ii(e,t,r,a){oi.call(this,e,t,r,a)}function ni(e,t,r){this.name=e,this.tracks=r,this.duration=void 0===t?-1:t,this.uuid=yn.generateUUID(),0>this.duration&&this.resetDuration(),this.optimize()}function Ca(e){this.manager=void 0===e?Ln:e,this.textures={}}function si(e){this.manager=void 0===e?Ln:e}function je(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}}function li(e){"boolean"===typeof e&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=void 0===e?Ln:e,this.withCredentials=!1}function ke(e){this.manager=void 0===e?Ln:e,this.texturePath=""}function pi(e){"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.manager=void 0===e?Ln:e,this.options=void 0}function di(){this.type="ShapePath",this.subPaths=[],this.currentPath=null}function me(e){this.type="Font",this.data=e}function ne(e){this.manager=void 0===e?Ln:e}function ci(e){this.manager=void 0===e?Ln:e}function oe(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new lr,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new lr,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}function mi(t,r,a){dt.call(this),this.type="CubeCamera";var o=new lr(90,1,t,r);o.up.set(0,-1,0),o.lookAt(new _(1,0,0)),this.add(o);var i=new lr(90,1,t,r);i.up.set(0,-1,0),i.lookAt(new _(-1,0,0)),this.add(i);var e=new lr(90,1,t,r);e.up.set(0,0,1),e.lookAt(new _(0,1,0)),this.add(e);var s=new lr(90,1,t,r);s.up.set(0,0,-1),s.lookAt(new _(0,-1,0)),this.add(s);var l=new lr(90,1,t,r);l.up.set(0,-1,0),l.lookAt(new _(0,0,1)),this.add(l);var p=new lr(90,1,t,r);p.up.set(0,-1,0),p.lookAt(new _(0,0,-1)),this.add(p),this.renderTarget=new n(a,a,{format:1022,magFilter:1006,minFilter:1006}),this.renderTarget.texture.name="CubeCamera",this.update=function(t,r){null===this.parent&&this.updateMatrixWorld();var a=this.renderTarget,n=a.texture.generateMipmaps;a.texture.generateMipmaps=!1,a.activeCubeFace=0,t.render(r,o,a),a.activeCubeFace=1,t.render(r,i,a),a.activeCubeFace=2,t.render(r,e,a),a.activeCubeFace=3,t.render(r,s,a),a.activeCubeFace=4,t.render(r,l,a),a.texture.generateMipmaps=n,a.activeCubeFace=5,t.render(r,p,a),t.setRenderTarget(null)},this.clear=function(t,r,a,o){for(var i=this.renderTarget,e=0;6>e;e++)i.activeCubeFace=e,t.setRenderTarget(i),t.clear(r,a,o);t.setRenderTarget(null)}}function ui(){dt.call(this),this.type="AudioListener",this.context=Bn.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null}function gi(e){dt.call(this),this.type="Audio",this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.loop=!1,this.offset=this.startTime=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function fi(e){gi.call(this,e),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function hi(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0===t?2048:t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function se(e,t,r){this.binding=e,this.valueSize=r,e=Float64Array;"quaternion"===t?t=this._slerp:"string"===t||"bool"===t?(e=Array,t=this._select):t=this._lerp;this.buffer=new e(4*r),this._mixBufferRegion=t,this.referenceCount=this.useCount=this.cumulativeWeight=0}function te(e,t,r){r=r||yi.parseTrackName(t),this._targetGroup=e,this._bindings=e.subscribe_(t,r)}function yi(e,t,r){this.path=t,this.parsedPath=r||yi.parseTrackName(t),this.node=yi.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function pa(){this.uuid=yn.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,r=arguments.length;t!==r;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var a=this;this.stats={objects:{get total(){return a._objects.length},get inUse(){return this.total-a.nCachedObjects_}},get bindingsPerObject(){return a._bindings.length}}}function xi(t,r,a){this._mixer=t,this._clip=r,this._localRoot=a||null,t=r.tracks,r=t.length,a=Array(r);for(var o={endingStart:2400,endingEnd:2400},i=0,e;i!==r;++i)e=t[i].createInterpolant(null),a[i]=e,e.settings=o;this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=Array(r),this._weightInterpolant=this._timeScaleInterpolant=this._byClipCacheIndex=this._cacheIndex=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this._effectiveWeight=this.weight=this._effectiveTimeScale=this.timeScale=1,this.repetitions=Infinity,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtEnd=this.zeroSlopeAtStart=!0}function vi(e){this._root=e,this._initMemoryManager(),this.time=this._accuIndex=0,this.timeScale=1}function _i(e,t){"string"===typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=t),this.value=e}function bi(){St.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function Ei(e,t,r,a){this.uuid=yn.generateUUID(),this.data=e,this.itemSize=t,this.offset=r,this.normalized=!0===a}function we(e,t){this.uuid=yn.generateUUID(),this.array=e,this.stride=t,this.count=void 0===e?0:e.length/t,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.onUploadCallback=function(){},this.version=0}function Ti(e,t,r){we.call(this,e,t),this.meshPerAttribute=r||1}function Si(e,t,r){ft.call(this,e,t),this.meshPerAttribute=r||1}function Mi(e,t,r,a){this.ray=new Pt(e,t),this.near=r||0,this.far=a||Infinity,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Ai(e,t){return e.distance-t.distance}function wi(t,r,a,o){if(!1!==t.visible&&(t.raycast(r,a),!0===o)){t=t.children,o=0;for(var i=t.length;o<i;o++)wi(t[o],r,a,!0)}}function ze(e){this.autoStart=!(void 0!==e)||e,this.elapsedTime=this.oldTime=this.startTime=0,this.running=!1}function Ri(e,t,r){return this.radius=void 0===e?1:e,this.phi=void 0===t?0:t,this.theta=void 0===r?0:r,this}function Li(e,t,r){return this.radius=void 0===e?1:e,this.theta=void 0===t?0:t,this.y=void 0===r?0:r,this}function Ci(e,t){this.min=void 0===e?new o(Infinity,Infinity):e,this.max=void 0===t?new o(-Infinity,-Infinity):t}function Ae(e){dt.call(this),this.material=e,this.render=function(){}}function Pi(e,t,r,o){this.object=e,this.size=void 0===t?1:t,e=void 0===r?16711680:r,o=void 0===o?1:o,t=0,(r=this.object.geometry)&&r.isGeometry?t=3*r.faces.length:r&&r.isBufferGeometry&&(t=r.attributes.normal.count),r=new St,t=new Et(6*t,3),r.addAttribute("position",t),Tr.call(this,r,new br({color:e,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function Ii(t,r){dt.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,t=new St,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(var a=0,o=1;32>a;a++,o++){var i=2*(a/32*ln),e=2*(o/32*ln);r.push(gn(i),on(i),1,gn(e),on(e),1)}t.addAttribute("position",new Et(r,3)),r=new br({fog:!1}),this.cone=new Tr(t,r),this.add(this.cone),this.update()}function Ni(e){var t=[];e&&e.isBone&&t.push(e);for(var r=0;r<e.children.length;r++)t.push.apply(t,Ni(e.children[r]));return t}function Ui(t){for(var r=Ni(t),a=new St,o=[],i=[],e=new Oe(0,0,1),n=new Oe(0,1,0),s=0,l;s<r.length;s++)l=r[s],l.parent&&l.parent.isBone&&(o.push(0,0,0),o.push(0,0,0),i.push(e.r,e.g,e.b),i.push(n.r,n.g,n.b));a.addAttribute("position",new Et(o,3)),a.addAttribute("color",new Et(i,3)),o=new br({vertexColors:2,depthTest:!1,depthWrite:!1,transparent:!0}),Tr.call(this,a,o),this.root=t,this.bones=r,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}function Di(e,t,r){this.light=e,this.light.updateMatrixWorld(),this.color=r,e=new Oa(t,4,2),t=new Lt({wireframe:!0,fog:!1}),Ut.call(this,e,t),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function Bi(e,t){dt.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,e=new br({fog:!1}),t=new St,t.addAttribute("position",new ft(new Float32Array(15),3)),this.line=new Er(t,e),this.add(this.line),this.update()}function Fi(e,t,r){dt.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,e=new Gr(t),e.rotateY(.5*ln),this.material=new Lt({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=2),t=e.getAttribute("position"),t=new Float32Array(3*t.count),e.addAttribute("color",new ft(t,3)),this.add(new Ut(e,this.material)),this.update()}function zi(t,r,a,o){t=t||10,r=r||10,a=new Oe(void 0===a?4473924:a),o=new Oe(void 0===o?8947848:o);var i=r/2,e=t/r,s=t/2;t=[];for(var p=[],d=0,c=0,m=-s;d<=r;d++,m+=e){t.push(-s,0,m,s,0,m),t.push(m,0,-s,m,0,s);var l=d===i?a:o;l.toArray(p,c),c+=3,l.toArray(p,c),c+=3,l.toArray(p,c),c+=3,l.toArray(p,c),c+=3}r=new St,r.addAttribute("position",new Et(t,3)),r.addAttribute("color",new Et(p,3)),a=new br({vertexColors:2}),Tr.call(this,r,a)}function Gi(t,r,a,o,i,e){t=t||10,r=r||16,a=a||8,o=o||64,i=new Oe(void 0===i?4473924:i),e=new Oe(void 0===e?8947848:e);var s=[],d=[],c;for(c=0;c<=r;c++){var u=2*(c/r)*ln,m=on(u)*t;u=gn(u)*t,s.push(0,0,0),s.push(m,0,u);var l=1&c?i:e;d.push(l.r,l.g,l.b),d.push(l.r,l.g,l.b)}for(c=0;c<=a;c++){l=1&c?i:e;var n=t-t/a*c;for(r=0;r<o;r++)u=2*(r/o)*ln,m=on(u)*n,u=gn(u)*n,s.push(m,0,u),d.push(l.r,l.g,l.b),u=2*((r+1)/o)*ln,m=on(u)*n,u=gn(u)*n,s.push(m,0,u),d.push(l.r,l.g,l.b)}t=new St,t.addAttribute("position",new Et(s,3)),t.addAttribute("color",new Et(d,3)),s=new br({vertexColors:2}),Tr.call(this,t,s)}function Oi(e,t,r,o){this.object=e,this.size=void 0===t?1:t,e=void 0===r?16776960:r,o=void 0===o?1:o,t=0,(r=this.object.geometry)&&r.isGeometry?t=r.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead."),r=new St,t=new Et(6*t,3),r.addAttribute("position",t),Tr.call(this,r,new br({color:e,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function Hi(e,t,r){dt.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,void 0===t&&(t=1),e=new St,e.addAttribute("position",new Et([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3)),t=new br({fog:!1}),this.lightPlane=new Er(e,t),this.add(this.lightPlane),e=new St,e.addAttribute("position",new Et([0,0,0,0,0,1],3)),this.targetLine=new Er(e,t),this.add(this.targetLine),this.update()}function Vi(t){function r(e,t,r){o(e,r),o(t,r)}function o(t,r){e.push(0,0,0),s.push(r.r,r.g,r.b),void 0===d[t]&&(d[t]=[]),d[t].push(e.length/3-1)}var a=new St,i=new br({color:16777215,vertexColors:1}),e=[],s=[],d={},c=new Oe(16755200),u=new Oe(16711680),m=new Oe(43775),l=new Oe(16777215),n=new Oe(3355443);r("n1","n2",c),r("n2","n4",c),r("n4","n3",c),r("n3","n1",c),r("f1","f2",c),r("f2","f4",c),r("f4","f3",c),r("f3","f1",c),r("n1","f1",c),r("n2","f2",c),r("n3","f3",c),r("n4","f4",c),r("p","n1",u),r("p","n2",u),r("p","n3",u),r("p","n4",u),r("u1","u2",m),r("u2","u3",m),r("u3","u1",m),r("c","t",l),r("p","c",n),r("cn1","cn2",n),r("cn3","cn4",n),r("cf1","cf2",n),r("cf3","cf4",n),a.addAttribute("position",new Et(e,3)),a.addAttribute("color",new Et(s,3)),Tr.call(this,a,i),this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=d,this.update()}function ki(e,t){this.object=e,void 0===t&&(t=16776960),e=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var r=new Float32Array(24),a=new St;a.setIndex(new ft(e,1)),a.addAttribute("position",new ft(r,3)),Tr.call(this,a,new br({color:t})),this.matrixAutoUpdate=!1,this.update()}function Wi(e,t){this.type="Box3Helper",this.box=e,e=void 0===t?16776960:t,t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var r=new St;r.setIndex(new ft(t,1)),r.addAttribute("position",new Et([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),Tr.call(this,r,new br({color:e})),this.geometry.computeBoundingSphere()}function ji(e,t,r){this.type="PlaneHelper",this.plane=e,this.size=void 0===t?1:t,e=void 0===r?16776960:r,t=new St,t.addAttribute("position",new Et([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),t.computeBoundingSphere(),Er.call(this,t,new br({color:e})),t=new St,t.addAttribute("position",new Et([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),t.computeBoundingSphere(),this.add(new Ut(t,new Lt({color:e,opacity:.2,transparent:!0,depthWrite:!1})))}function Xi(t,r,a,o,i,e){dt.call(this),void 0===o&&(o=16776960),void 0===a&&(a=1),void 0===i&&(i=.2*a),void 0===e&&(e=.2*i),void 0===Fn&&(Fn=new St,Fn.addAttribute("position",new Et([0,0,0,0,1,0],3)),zn=new io(0,.5,1,5,1),zn.translate(0,-.5,0)),this.position.copy(r),this.line=new Er(Fn,new br({color:o})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ut(zn,new Lt({color:o})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(a,i,e)}function Yi(e){e=e||1;var t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e];e=new St,e.addAttribute("position",new Et(t,3)),e.addAttribute("color",new Et([1,0,0,1,0.6,0,0,1,0,0.6,1,0,0,0,1,0,0.6,1],3)),t=new br({vertexColors:2}),Tr.call(this,e,t)}function qi(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),ie.call(this,e),this.type="catmullrom",this.closed=!0}function Zi(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),ie.call(this,e),this.type="catmullrom"}function Ji(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),ie.call(this,e),this.type="catmullrom"}var Ce=Math.tan,Qi=Math.atan,Ki=Math.acos,$i=Math.round,en=Math.ceil,tn=Math.sign,rn=Number.isInteger,an=Number.EPSILON,on=Math.sin,nn=Math.atan2,sn=Math.pow,ln=Math.PI,pn=Math.sqrt,dn=Math.LN2,cn=Math.log,mn=Math.max,un=Math.min,gn=Math.cos,fn=Math.abs,hn=Math.floor;void 0===an&&(an=2.220446049250313e-16),void 0===rn&&(rn=function(e){return"number"===typeof e&&isFinite(e)&&hn(e)===e}),void 0===tn&&(tn=function(e){return 0>e?-1:0<e?1:+e}),!1==="name"in Function.prototype&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&function(){Object.assign=function(t){if(void 0===t||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(t),a=1,o;a<arguments.length;a++)if(o=arguments[a],void 0!==o&&null!==o)for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i]);return r}}(),Object.assign(t.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)},removeEventListener:function(e,t){void 0!==this._listeners&&(e=this._listeners[e],void 0!==e&&(t=e.indexOf(t),-1!==t&&e.splice(t,1)))},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var t=t.slice(0),r=0,a=t.length;r<a;r++)t[r].call(this,e)}}}});var yn={DEG2RAD:ln/180,RAD2DEG:180/ln,generateUUID:function(){for(var t=[],e=0;256>e;e++)t[e]=(16>e?"0":"")+e.toString(16).toUpperCase();return function(){var r=0|4294967295*Math.random(),a=0|4294967295*Math.random(),o=0|4294967295*Math.random(),e=0|4294967295*Math.random();return t[255&r]+t[255&r>>8]+t[255&r>>16]+t[255&r>>24]+"-"+t[255&a]+t[255&a>>8]+"-"+t[64|15&a>>16]+t[255&a>>24]+"-"+t[128|63&o]+t[255&o>>8]+"-"+t[255&o>>16]+t[255&o>>24]+t[255&e]+t[255&e>>8]+t[255&e>>16]+t[255&e>>24]}}(),clamp:function(e,t,r){return mn(t,un(r,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(t,r,a,o,i){return o+(t-r)*(i-o)/(a-r)},lerp:function(e,t,r){return(1-r)*e+r*t},smoothstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t),e*e*(3-2*e))},smootherstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t),e*e*e*(e*(6*e-15)+10))},randInt:function(e,t){return e+hn(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*yn.DEG2RAD},radToDeg:function(e){return e*yn.RAD2DEG},isPowerOfTwo:function(e){return 0===(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return sn(2,en(cn(e)/dn))},floorPowerOfTwo:function(e){return sn(2,hn(cn(e)/dn))}};Object.defineProperties(o.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(o.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.y=this.x=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw Error("index is out of range: "+e);}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+e);}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0===t?(this.x+=e.x,this.y+=e.y,this):(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t))},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0===t?(this.x-=e.x,this.y-=e.y,this):(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t))},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,r=this.y;return e=e.elements,this.x=e[0]*t+e[3]*r+e[6],this.y=e[1]*t+e[4]*r+e[7],this},min:function(e){return this.x=un(this.x,e.x),this.y=un(this.y,e.y),this},max:function(e){return this.x=mn(this.x,e.x),this.y=mn(this.y,e.y),this},clamp:function(e,t){return this.x=mn(e.x,un(t.x,this.x)),this.y=mn(e.y,un(t.y,this.y)),this},clampScalar:function(){var e=new o,t=new o;return function(r,a){return e.set(r,r),t.set(a,a),this.clamp(e,t)}}(),clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(mn(e,un(t,r)))},floor:function(){return this.x=hn(this.x),this.y=hn(this.y),this},ceil:function(){return this.x=en(this.x),this.y=en(this.y),this},round:function(){return this.x=$i(this.x),this.y=$i(this.y),this},roundToZero:function(){return this.x=0>this.x?en(this.x):hn(this.x),this.y=0>this.y?en(this.y):hn(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return pn(this.x*this.x+this.y*this.y)},manhattanLength:function(){return fn(this.x)+fn(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=nn(this.y,this.x);return 0>e&&(e+=2*ln),e},distanceTo:function(e){return pn(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x;return e=this.y-e.y,t*t+e*e},manhattanDistanceTo:function(e){return fn(this.x-e.x)+fn(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(t,r){var a=gn(r);r=on(r);var o=this.x-t.x,i=this.y-t.y;return this.x=o*a-i*r+t.x,this.y=o*r+i*a+t.y,this}}),Object.assign(i.prototype,{isMatrix4:!0,set:function(o,a,i,s,d,e,c,g,f,h,m,l,n,p,r,y){var u=this.elements;return u[0]=o,u[4]=a,u[8]=i,u[12]=s,u[1]=d,u[5]=e,u[9]=c,u[13]=g,u[2]=f,u[6]=h,u[10]=m,u[14]=l,u[3]=n,u[7]=p,u[11]=r,u[15]=y,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return new i().fromArray(this.elements)},copy:function(e){var t=this.elements;return e=e.elements,t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],this},copyPosition:function(e){var t=this.elements;return e=e.elements,t[12]=e[12],t[13]=e[13],t[14]=e[14],this},extractBasis:function(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this},extractRotation:function(){var t=new _;return function(r){var a=this.elements,o=r.elements,i=1/t.setFromMatrixColumn(r,0).length(),e=1/t.setFromMatrixColumn(r,1).length();return r=1/t.setFromMatrixColumn(r,2).length(),a[0]=o[0]*i,a[1]=o[1]*i,a[2]=o[2]*i,a[4]=o[4]*e,a[5]=o[5]*e,a[6]=o[6]*e,a[8]=o[8]*r,a[9]=o[9]*r,a[10]=o[10]*r,this}}(),makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var r=this.elements,a=t.x,o=t.y,i=t.z,n=gn(a),a=on(a),s=gn(o),o=on(o),p=gn(i),i=on(i);if("XYZ"===t.order){var u=n*p,h=n*i,m=a*p;t=a*i,r[0]=s*p,r[4]=-s*i,r[8]=o,r[1]=h+m*o,r[5]=u-t*o,r[9]=-a*s,r[2]=t-u*o,r[6]=m+h*o,r[10]=n*s}else"YXZ"===t.order?(u=s*p,h=s*i,m=o*p,t=o*i,r[0]=u+t*a,r[4]=m*a-h,r[8]=n*o,r[1]=n*i,r[5]=n*p,r[9]=-a,r[2]=h*a-m,r[6]=t+u*a,r[10]=n*s):"ZXY"===t.order?(u=s*p,h=s*i,m=o*p,t=o*i,r[0]=u-t*a,r[4]=-n*i,r[8]=m+h*a,r[1]=h+m*a,r[5]=n*p,r[9]=t-u*a,r[2]=-n*o,r[6]=a,r[10]=n*s):"ZYX"===t.order?(u=n*p,h=n*i,m=a*p,t=a*i,r[0]=s*p,r[4]=m*o-h,r[8]=u*o+t,r[1]=s*i,r[5]=t*o+u,r[9]=h*o-m,r[2]=-o,r[6]=a*s,r[10]=n*s):"YZX"===t.order?(u=n*s,h=n*o,m=a*s,t=a*o,r[0]=s*p,r[4]=t-u*i,r[8]=m*i+h,r[1]=i,r[5]=n*p,r[9]=-a*p,r[2]=-o*p,r[6]=h*i+m,r[10]=u-t*i):"XZY"===t.order&&(u=n*s,h=n*o,m=a*s,t=a*o,r[0]=s*p,r[4]=-i,r[8]=o*p,r[1]=u*i+t,r[5]=n*p,r[9]=h*i-m,r[2]=m*i-h,r[6]=a*p,r[10]=t*i+u);return r[3]=0,r[7]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this},makeRotationFromQuaternion:function(t){var r=this.elements,a=t._x,o=t._y,i=t._z,e=t._w,n=a+a,s=o+o,p=i+i;t=a*n;var d=a*s,a=a*p,c=o*s,o=o*p,i=i*p,n=e*n,s=e*s,e=e*p;return r[0]=1-(c+i),r[4]=d-e,r[8]=a+s,r[1]=d+e,r[5]=1-(t+i),r[9]=o-n,r[2]=a-s,r[6]=o+n,r[10]=1-(t+c),r[3]=0,r[7]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this},lookAt:function(){var t=new _,r=new _,a=new _;return function(o,i,e){var n=this.elements;return a.subVectors(o,i),0===a.lengthSq()&&(a.z=1),a.normalize(),t.crossVectors(e,a),0===t.lengthSq()&&(1===fn(e.z)?a.x+=1E-4:a.z+=1E-4,a.normalize(),t.crossVectors(e,a)),t.normalize(),r.crossVectors(a,t),n[0]=t.x,n[4]=r.x,n[8]=a.x,n[1]=t.y,n[5]=r.y,n[9]=a.y,n[2]=t.z,n[6]=r.z,n[10]=a.z,this}}(),multiply:function(e,t){return void 0===t?this.multiplyMatrices(this,e):(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t))},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(t,a){var o=t.elements,i=a.elements;a=this.elements,t=o[0];var s=o[4],e=o[8],d=o[12],c=o[1],g=o[5],f=o[9],m=o[13],l=o[2],n=o[6],p=o[10],r=o[14],h=o[3],u=o[7],v=o[11],o=o[15],x=i[0],_=i[4],b=i[8],y=i[12],T=i[1],S=i[5],A=i[9],w=i[13],E=i[2],R=i[6],L=i[10],C=i[14],I=i[3],N=i[7],M=i[11],i=i[15];return a[0]=t*x+s*T+e*E+d*I,a[4]=t*_+s*S+e*R+d*N,a[8]=t*b+s*A+e*L+d*M,a[12]=t*y+s*w+e*C+d*i,a[1]=c*x+g*T+f*E+m*I,a[5]=c*_+g*S+f*R+m*N,a[9]=c*b+g*A+f*L+m*M,a[13]=c*y+g*w+f*C+m*i,a[2]=l*x+n*T+p*E+r*I,a[6]=l*_+n*S+p*R+r*N,a[10]=l*b+n*A+p*L+r*M,a[14]=l*y+n*w+p*C+r*i,a[3]=h*x+u*T+v*E+o*I,a[7]=h*_+u*S+v*R+o*N,a[11]=h*b+u*A+v*L+o*M,a[15]=h*y+u*w+v*C+o*i,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new _;return function(t){for(var r=0,a=t.count;r<a;r++)e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.applyMatrix4(this),t.setXYZ(r,e.x,e.y,e.z);return t}}(),determinant:function(){var t=this.elements,r=t[0],a=t[4],o=t[8],i=t[12],s=t[1],c=t[5],u=t[9],g=t[13],f=t[2],m=t[6],l=t[10],n=t[14];return t[3]*(+i*u*m-o*g*m-i*c*l+a*g*l+o*c*n-a*u*n)+t[7]*(+r*u*n-r*g*l+i*s*l-o*s*n+o*g*f-i*u*f)+t[11]*(+r*g*m-r*c*n-i*s*m+a*s*n+i*c*f-a*g*f)+t[15]*(-o*c*f-r*u*m+r*c*l+o*s*m-a*s*l+a*u*f)},transpose:function(){var e=this.elements,t=e[1];return e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(t,a){var o=this.elements,i=t.elements;t=i[0];var s=i[1],e=i[2],d=i[3],c=i[4],g=i[5],f=i[6],m=i[7],l=i[8],n=i[9],p=i[10],r=i[11],h=i[12],u=i[13],v=i[14],i=i[15],x=n*v*m-u*p*m+u*f*r-g*v*r-n*f*i+g*p*i,_=h*p*m-l*v*m-h*f*r+c*v*r+l*f*i-c*p*i,b=l*u*m-h*n*m+h*g*r-c*u*r-l*g*i+c*n*i,y=h*n*f-l*u*f-h*g*p+c*u*p+l*g*v-c*n*v,E=t*x+s*_+e*b+d*y;if(0===E){if(!0===a)throw Error("THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0");return console.warn("THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0"),this.identity()}return a=1/E,o[0]=x*a,o[1]=(u*p*d-n*v*d-u*e*r+s*v*r+n*e*i-s*p*i)*a,o[2]=(g*v*d-u*f*d+u*e*m-s*v*m-g*e*i+s*f*i)*a,o[3]=(n*f*d-g*p*d-n*e*m+s*p*m+g*e*r-s*f*r)*a,o[4]=_*a,o[5]=(l*v*d-h*p*d+h*e*r-t*v*r-l*e*i+t*p*i)*a,o[6]=(h*f*d-c*v*d-h*e*m+t*v*m+c*e*i-t*f*i)*a,o[7]=(c*p*d-l*f*d+l*e*m-t*p*m-c*e*r+t*f*r)*a,o[8]=b*a,o[9]=(h*n*d-l*u*d-h*s*r+t*u*r+l*s*i-t*n*i)*a,o[10]=(c*u*d-h*g*d+h*s*m-t*u*m-c*s*i+t*g*i)*a,o[11]=(l*g*d-c*n*d-l*s*m+t*n*m+c*s*r-t*g*r)*a,o[12]=y*a,o[13]=(l*u*e-h*n*e+h*s*p-t*u*p-l*s*v+t*n*v)*a,o[14]=(h*g*e-c*u*e-h*s*f+t*u*f+c*s*v-t*g*v)*a,o[15]=(c*n*e-l*g*e+l*s*f-t*n*f-c*s*p+t*g*p)*a,this},scale:function(e){var t=this.elements,r=e.x,a=e.y;return e=e.z,t[0]*=r,t[4]*=a,t[8]*=e,t[1]*=r,t[5]*=a,t[9]*=e,t[2]*=r,t[6]*=a,t[10]*=e,t[3]*=r,t[7]*=a,t[11]*=e,this},getMaxScaleOnAxis:function(){var e=this.elements;return pn(mn(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=gn(e);return e=on(e),this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this},makeRotationY:function(e){var t=gn(e);return e=on(e),this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=gn(e);return e=on(e),this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,r){var a=gn(r);r=on(r);var o=1-a,i=t.x,e=t.y;t=t.z;var n=o*i,s=o*e;return this.set(n*i+a,n*e-r*t,n*t+r*e,0,n*e+r*t,s*e+a,s*t-r*i,0,n*t-r*e,s*t+r*i,o*t*t+a,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},makeShear:function(e,t,r){return this.set(1,t,r,0,e,1,r,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,r){return this.makeRotationFromQuaternion(t),this.scale(r),this.setPosition(e),this},decompose:function(){var t=new _,r=new i;return function(a,o,i){var e=this.elements,n=t.set(e[0],e[1],e[2]).length(),s=t.set(e[4],e[5],e[6]).length(),l=t.set(e[8],e[9],e[10]).length();0>this.determinant()&&(n=-n),a.x=e[12],a.y=e[13],a.z=e[14],r.copy(this),a=1/n;var e=1/s,p=1/l;return r.elements[0]*=a,r.elements[1]*=a,r.elements[2]*=a,r.elements[4]*=e,r.elements[5]*=e,r.elements[6]*=e,r.elements[8]*=p,r.elements[9]*=p,r.elements[10]*=p,o.setFromRotationMatrix(r),i.x=n,i.y=s,i.z=l,this}}(),makePerspective:function(t,r,a,o,i,e){void 0===e&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var n=this.elements;return n[0]=2*i/(r-t),n[4]=0,n[8]=(r+t)/(r-t),n[12]=0,n[1]=0,n[5]=2*i/(a-o),n[9]=(a+o)/(a-o),n[13]=0,n[2]=0,n[6]=0,n[10]=-(e+i)/(e-i),n[14]=-2*e*i/(e-i),n[3]=0,n[7]=0,n[11]=-1,n[15]=0,this},makeOrthographic:function(t,r,a,o,i,e){var n=this.elements,s=1/(r-t),l=1/(a-o),p=1/(e-i);return n[0]=2*s,n[4]=0,n[8]=0,n[12]=-((r+t)*s),n[1]=0,n[5]=2*l,n[9]=0,n[13]=-((a+o)*l),n[2]=0,n[6]=0,n[10]=-2*p,n[14]=-((e+i)*p),n[3]=0,n[7]=0,n[11]=0,n[15]=1,this},equals:function(e){var t=this.elements;e=e.elements;for(var r=0;16>r;r++)if(t[r]!==e[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var r=0;16>r;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}),Object.assign(s,{slerp:function(e,t,r,a){return r.copy(e).slerp(t,a)},slerpFlat:function(t,a,o,i,s,e,d){var c=o[i+0],u=o[i+1],g=o[i+2];o=o[i+3],i=s[e+0];var m=s[e+1],l=s[e+2];if(s=s[e+3],o!==s||c!==i||u!==m||g!==l){e=1-d;var n=c*i+u*m+g*l+o*s,p=0<=n?1:-1,r=1-n*n;r>an&&(r=pn(r),n=nn(r,n*p),e=on(e*n)/r,d=on(d*n)/r),p*=d,c=c*e+i*p,u=u*e+m*p,g=g*e+l*p,o=o*e+s*p,e===1-d&&(d=1/pn(c*c+u*u+g*g+o*o),c*=d,u*=d,g*=d,o*=d)}t[a]=c,t[a+1]=u,t[a+2]=g,t[a+3]=o}}),Object.defineProperties(s.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}}),Object.assign(s.prototype,{set:function(e,t,r,a){return this._x=e,this._y=t,this._z=r,this._w=a,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(t,r){if(!t||!t.isEuler)throw Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var o=t._x,i=t._y,n=t._z;t=t.order;var e=gn,s=on,l=e(o/2),p=e(i/2),e=e(n/2),o=s(o/2),i=s(i/2),n=s(n/2);return"XYZ"===t?(this._x=o*p*e+l*i*n,this._y=l*i*e-o*p*n,this._z=l*p*n+o*i*e,this._w=l*p*e-o*i*n):"YXZ"===t?(this._x=o*p*e+l*i*n,this._y=l*i*e-o*p*n,this._z=l*p*n-o*i*e,this._w=l*p*e+o*i*n):"ZXY"===t?(this._x=o*p*e-l*i*n,this._y=l*i*e+o*p*n,this._z=l*p*n+o*i*e,this._w=l*p*e-o*i*n):"ZYX"===t?(this._x=o*p*e-l*i*n,this._y=l*i*e+o*p*n,this._z=l*p*n-o*i*e,this._w=l*p*e+o*i*n):"YZX"===t?(this._x=o*p*e+l*i*n,this._y=l*i*e+o*p*n,this._z=l*p*n-o*i*e,this._w=l*p*e-o*i*n):"XZY"===t&&(this._x=o*p*e-l*i*n,this._y=l*i*e-o*p*n,this._z=l*p*n+o*i*e,this._w=l*p*e+o*i*n),!1!==r&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){t/=2;var r=on(t);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=gn(t),this.onChangeCallback(),this},setFromRotationMatrix:function(t){var r=t.elements,a=r[0];t=r[4];var o=r[8],i=r[1],e=r[5],n=r[9],s=r[2],l=r[6],r=r[10],p=a+e+r;return 0<p?(a=.5/pn(p+1),this._w=.25/a,this._x=(l-n)*a,this._y=(o-s)*a,this._z=(i-t)*a):a>e&&a>r?(a=2*pn(1+a-e-r),this._w=(l-n)/a,this._x=.25*a,this._y=(t+i)/a,this._z=(o+s)/a):e>r?(a=2*pn(1+e-a-r),this._w=(o-s)/a,this._x=(t+i)/a,this._y=.25*a,this._z=(n+l)/a):(a=2*pn(1+r-a-e),this._w=(i-t)/a,this._x=(o+s)/a,this._y=(n+l)/a,this._z=.25*a),this.onChangeCallback(),this},setFromUnitVectors:function(){var e=new _,t;return function(r,a){return void 0===e&&(e=new _),t=r.dot(a)+1,1E-6>t?(t=0,fn(r.x)>fn(r.z)?e.set(-r.y,r.x,0):e.set(0,-r.z,r.y)):e.crossVectors(r,a),this._x=e.x,this._y=e.y,this._z=e.z,this._w=t,this.normalize()}}(),inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return pn(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._z=this._y=this._x=0,this._w=1):(e=1/e,this._x*=e,this._y*=e,this._z*=e,this._w*=e),this.onChangeCallback(),this},multiply:function(e,t){return void 0===t?this.multiplyQuaternions(this,e):(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t))},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(t,r){var a=t._x,o=t._y,i=t._z;t=t._w;var e=r._x,n=r._y,s=r._z;return r=r._w,this._x=a*r+t*e+o*s-i*n,this._y=o*r+t*n+i*e-a*s,this._z=i*r+t*s+a*n-o*e,this._w=t*r-a*e-o*n-i*s,this.onChangeCallback(),this},slerp:function(t,r){if(0===r)return this;if(1===r)return this.copy(t);var a=this._x,o=this._y,i=this._z,e=this._w,n=e*t._w+a*t._x+o*t._y+i*t._z;if(0>n?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,n=-n):this.copy(t),1<=n)return this._w=e,this._x=a,this._y=o,this._z=i,this;if(t=pn(1-n*n),.001>fn(t))return this._w=.5*(e+this._w),this._x=.5*(a+this._x),this._y=.5*(o+this._y),this._z=.5*(i+this._z),this;var s=nn(t,n),n=on((1-r)*s)/t;return r=on(r*s)/t,this._w=e*n+this._w*r,this._x=a*n+this._x*r,this._y=o*n+this._y*r,this._z=i*n+this._z*r,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(_.prototype,{isVector3:!0,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setScalar:function(e){return this.z=this.y=this.x=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw Error("index is out of range: "+e);}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+e);}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0===t?(this.x+=e.x,this.y+=e.y,this.z+=e.z,this):(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t))},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0===t?(this.x-=e.x,this.y-=e.y,this.z-=e.z,this):(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t))},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0===t?(this.x*=e.x,this.y*=e.y,this.z*=e.z,this):(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t))},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e=new s;return function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(e.setFromEuler(t))}}(),applyAxisAngle:function(){var e=new s;return function(t,r){return this.applyQuaternion(e.setFromAxisAngle(t,r))}}(),applyMatrix3:function(e){var t=this.x,r=this.y,a=this.z;return e=e.elements,this.x=e[0]*t+e[3]*r+e[6]*a,this.y=e[1]*t+e[4]*r+e[7]*a,this.z=e[2]*t+e[5]*r+e[8]*a,this},applyMatrix4:function(t){var r=this.x,a=this.y,o=this.z;t=t.elements;var i=1/(t[3]*r+t[7]*a+t[11]*o+t[15]);return this.x=(t[0]*r+t[4]*a+t[8]*o+t[12])*i,this.y=(t[1]*r+t[5]*a+t[9]*o+t[13])*i,this.z=(t[2]*r+t[6]*a+t[10]*o+t[14])*i,this},applyQuaternion:function(t){var r=this.x,a=this.y,o=this.z,i=t.x,n=t.y,s=t.z;t=t.w;var l=t*r+n*o-s*a,p=t*a+s*r-i*o,d=t*o+i*a-n*r,r=-i*r-n*a-s*o;return this.x=l*t+r*-i+p*-s-d*-n,this.y=p*t+r*-n+d*-i-l*-s,this.z=d*t+r*-s+l*-n-p*-i,this},project:function(){var e=new i;return function(t){return e.multiplyMatrices(t.projectionMatrix,e.getInverse(t.matrixWorld)),this.applyMatrix4(e)}}(),unproject:function(){var e=new i;return function(t){return e.multiplyMatrices(t.matrixWorld,e.getInverse(t.projectionMatrix)),this.applyMatrix4(e)}}(),transformDirection:function(e){var t=this.x,r=this.y,a=this.z;return e=e.elements,this.x=e[0]*t+e[4]*r+e[8]*a,this.y=e[1]*t+e[5]*r+e[9]*a,this.z=e[2]*t+e[6]*r+e[10]*a,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=un(this.x,e.x),this.y=un(this.y,e.y),this.z=un(this.z,e.z),this},max:function(e){return this.x=mn(this.x,e.x),this.y=mn(this.y,e.y),this.z=mn(this.z,e.z),this},clamp:function(e,t){return this.x=mn(e.x,un(t.x,this.x)),this.y=mn(e.y,un(t.y,this.y)),this.z=mn(e.z,un(t.z,this.z)),this},clampScalar:function(){var e=new _,t=new _;return function(r,a){return e.set(r,r,r),t.set(a,a,a),this.clamp(e,t)}}(),clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(mn(e,un(t,r)))},floor:function(){return this.x=hn(this.x),this.y=hn(this.y),this.z=hn(this.z),this},ceil:function(){return this.x=en(this.x),this.y=en(this.y),this.z=en(this.z),this},round:function(){return this.x=$i(this.x),this.y=$i(this.y),this.z=$i(this.z),this},roundToZero:function(){return this.x=0>this.x?en(this.x):hn(this.x),this.y=0>this.y?en(this.y):hn(this.y),this.z=0>this.z?en(this.z):hn(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return pn(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return fn(this.x)+fn(this.y)+fn(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},cross:function(e,t){return void 0===t?this.crossVectors(this,e):(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t))},crossVectors:function(t,r){var a=t.x,o=t.y;t=t.z;var i=r.x,e=r.y;return r=r.z,this.x=o*r-t*e,this.y=t*i-a*r,this.z=a*e-o*i,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:function(){var e=new _;return function(t){return e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e=new _;return function(t){return this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){return e=this.dot(e)/pn(this.lengthSq()*e.lengthSq()),Ki(yn.clamp(e,-1,1))},distanceTo:function(e){return pn(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return e=this.z-e.z,t*t+r*r+e*e},manhattanDistanceTo:function(e){return fn(this.x-e.x)+fn(this.y-e.y)+fn(this.z-e.z)},setFromSpherical:function(e){var t=on(e.phi)*e.radius;return this.x=t*on(e.theta),this.y=gn(e.phi)*e.radius,this.z=t*gn(e.theta),this},setFromCylindrical:function(e){return this.x=e.radius*on(e.theta),this.y=e.y,this.z=e.radius*gn(e.theta),this},setFromMatrixPosition:function(e){return e=e.elements,this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length();return e=this.setFromMatrixColumn(e,2).length(),this.x=t,this.y=r,this.z=e,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}),Object.assign(y.prototype,{isMatrix3:!0,set:function(t,r,a,o,i,e,n,s,l){var p=this.elements;return p[0]=t,p[1]=o,p[2]=n,p[3]=r,p[4]=i,p[5]=s,p[6]=a,p[7]=e,p[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return new this.constructor().fromArray(this.elements)},copy:function(e){var t=this.elements;return e=e.elements,t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],this},setFromMatrix4:function(e){return e=e.elements,this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},applyToBufferAttribute:function(){var e=new _;return function(t){for(var r=0,a=t.count;r<a;r++)e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.applyMatrix3(this),t.setXYZ(r,e.x,e.y,e.z);return t}}(),multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(t,a){var o=t.elements,i=a.elements;a=this.elements,t=o[0];var s=o[3],e=o[6],d=o[1],c=o[4],g=o[7],f=o[2],m=o[5],o=o[8],l=i[0],n=i[3],p=i[6],r=i[1],h=i[4],u=i[7],y=i[2],x=i[5],i=i[8];return a[0]=t*l+s*r+e*y,a[3]=t*n+s*h+e*x,a[6]=t*p+s*u+e*i,a[1]=d*l+c*r+g*y,a[4]=d*n+c*h+g*x,a[7]=d*p+c*u+g*i,a[2]=f*l+m*r+o*y,a[5]=f*n+m*h+o*x,a[8]=f*p+m*u+o*i,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var t=this.elements,r=t[0],a=t[1],o=t[2],i=t[3],e=t[4],n=t[5],s=t[6],l=t[7],t=t[8];return r*e*t-r*n*l-a*i*t+a*n*s+o*i*l-o*e*s},getInverse:function(t,a){t&&t.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var o=t.elements;t=this.elements;var i=o[0],s=o[1],e=o[2],d=o[3],c=o[4],u=o[5],g=o[6],m=o[7],o=o[8],l=o*c-u*m,n=u*g-o*d,p=m*d-c*g,r=i*l+s*n+e*p;if(0===r){if(!0===a)throw Error("THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0");return console.warn("THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0"),this.identity()}return a=1/r,t[0]=l*a,t[1]=(e*m-o*s)*a,t[2]=(u*s-e*c)*a,t[3]=n*a,t[4]=(o*i-e*g)*a,t[5]=(e*d-u*i)*a,t[6]=p*a,t[7]=(s*g-m*i)*a,t[8]=(c*i-s*d)*a,this},transpose:function(){var e=this.elements,t=e[1];return e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(t,r,a,o,i,n,s){var l=gn(i);i=on(i),this.set(a*l,a*i,-a*(l*n+i*s)+n+t,-o*i,o*l,-o*(-i*n+l*s)+s+r,0,0,1)},scale:function(e,t){var r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=t,r[4]*=t,r[7]*=t,this},rotate:function(t){var r=gn(t);t=on(t);var o=this.elements,i=o[0],n=o[3],e=o[6],s=o[1],l=o[4],p=o[7];return o[0]=r*i+t*s,o[3]=r*n+t*l,o[6]=r*e+t*p,o[1]=-t*i+r*s,o[4]=-t*n+r*l,o[7]=-t*e+r*p,this},translate:function(e,t){var r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=t*r[2],r[4]+=t*r[5],r[7]+=t*r[8],this},equals:function(e){var t=this.elements;e=e.elements;for(var r=0;9>r;r++)if(t[r]!==e[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var r=0;9>r;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}});var S=0;r.DEFAULT_IMAGE=void 0,r.DEFAULT_MAPPING=300,r.prototype=Object.assign(Object.create(t.prototype),{constructor:r,isTexture:!0,clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(t){var r=void 0===t||"string"===typeof t;if(!r&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];var o={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var i=this.image;if(void 0===i.uuid&&(i.uuid=yn.generateUUID()),!r&&void 0===t.images[i.uuid]){var n=t.images,e=i.uuid,s=i.uuid;if(i instanceof HTMLCanvasElement)var l=i;else{l=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),l.width=i.width,l.height=i.height;var p=l.getContext("2d");i instanceof ImageData?p.putImageData(i,0,0):p.drawImage(i,0,0,i.width,i.height)}l=2048<l.width||2048<l.height?l.toDataURL("image/jpeg",.6):l.toDataURL("image/png"),n[e]={uuid:s,url:l}}o.image=i.uuid}return r||(t.textures[this.uuid]=o),o},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(300===this.mapping){if(e.applyMatrix3(this.matrix),0>e.x||1<e.x)switch(this.wrapS){case 1E3:e.x-=hn(e.x);break;case 1001:e.x=0>e.x?0:1;break;case 1002:e.x=1===fn(hn(e.x)%2)?en(e.x)-e.x:e.x-hn(e.x);}if(0>e.y||1<e.y)switch(this.wrapT){case 1E3:e.y-=hn(e.y);break;case 1001:e.y=0>e.y?0:1;break;case 1002:e.y=1===fn(hn(e.y)%2)?en(e.y)-e.y:e.y-hn(e.y);}this.flipY&&(e.y=1-e.y)}}}),Object.defineProperty(r.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(j.prototype,{isVector4:!0,set:function(e,t,r,a){return this.x=e,this.y=t,this.z=r,this.w=a,this},setScalar:function(e){return this.w=this.z=this.y=this.x=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw Error("index is out of range: "+e);}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+e);}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0===e.w?1:e.w,this},add:function(e,t){return void 0===t?(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this):(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t))},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0===t?(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this):(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t))},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(t){var r=this.x,a=this.y,o=this.z,i=this.w;return t=t.elements,this.x=t[0]*r+t[4]*a+t[8]*o+t[12]*i,this.y=t[1]*r+t[5]*a+t[9]*o+t[13]*i,this.z=t[2]*r+t[6]*a+t[10]*o+t[14]*i,this.w=t[3]*r+t[7]*a+t[11]*o+t[15]*i,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Ki(e.w);var t=pn(1-e.w*e.w);return 1E-4>t?(this.x=1,this.z=this.y=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(t){t=t.elements;var r=t[0],a=t[4],o=t[8],i=t[1],e=t[5],n=t[9],s=t[2],l=t[6],p=t[10];return .01>fn(a-i)&&.01>fn(o-s)&&.01>fn(n-l)?.1>fn(a+i)&&.1>fn(o+s)&&.1>fn(n+l)&&.1>fn(r+e+p-3)?(this.set(1,0,0,0),this):(t=ln,r=(r+1)/2,e=(e+1)/2,p=(p+1)/2,a=(a+i)/4,o=(o+s)/4,n=(n+l)/4,r>e&&r>p?.01>r?(l=0,a=s=.707106781):(l=pn(r),s=a/l,a=o/l):e>p?.01>e?(l=.707106781,s=0,a=.707106781):(s=pn(e),l=a/s,a=n/s):.01>p?(s=l=.707106781,a=0):(a=pn(p),l=o/a,s=n/a),this.set(l,s,a,t),this):(t=pn((l-n)*(l-n)+(o-s)*(o-s)+(i-a)*(i-a)),.001>fn(t)&&(t=1),this.x=(l-n)/t,this.y=(o-s)/t,this.z=(i-a)/t,this.w=Ki((r+e+p-1)/2),this)},min:function(e){return this.x=un(this.x,e.x),this.y=un(this.y,e.y),this.z=un(this.z,e.z),this.w=un(this.w,e.w),this},max:function(e){return this.x=mn(this.x,e.x),this.y=mn(this.y,e.y),this.z=mn(this.z,e.z),this.w=mn(this.w,e.w),this},clamp:function(e,t){return this.x=mn(e.x,un(t.x,this.x)),this.y=mn(e.y,un(t.y,this.y)),this.z=mn(e.z,un(t.z,this.z)),this.w=mn(e.w,un(t.w,this.w)),this},clampScalar:function(){var e,t;return function(r,a){return void 0===e&&(e=new j,t=new j),e.set(r,r,r,r),t.set(a,a,a,a),this.clamp(e,t)}}(),clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(mn(e,un(t,r)))},floor:function(){return this.x=hn(this.x),this.y=hn(this.y),this.z=hn(this.z),this.w=hn(this.w),this},ceil:function(){return this.x=en(this.x),this.y=en(this.y),this.z=en(this.z),this.w=en(this.w),this},round:function(){return this.x=$i(this.x),this.y=$i(this.y),this.z=$i(this.z),this.w=$i(this.w),this},roundToZero:function(){return this.x=0>this.x?en(this.x):hn(this.x),this.y=0>this.y?en(this.y):hn(this.y),this.z=0>this.z?en(this.z):hn(this.z),this.w=0>this.w?en(this.w):hn(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return pn(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return fn(this.x)+fn(this.y)+fn(this.z)+fn(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,r){return void 0!==r&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),M.prototype=Object.assign(Object.create(t.prototype),{constructor:M,isWebGLRenderTarget:!0,setSize:function(e,t){(this.width!==e||this.height!==t)&&(this.width=e,this.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),n.prototype=Object.create(M.prototype),n.prototype.constructor=n,n.prototype.isWebGLRenderTargetCube=!0,l.prototype=Object.create(r.prototype),l.prototype.constructor=l,l.prototype.isDataTexture=!0,p.prototype=Object.create(r.prototype),p.prototype.constructor=p,p.prototype.isCubeTexture=!0,Object.defineProperty(p.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}});var xn=new r,Me=new p,Ne=[],He=[],Je=new Float32Array(16),Le=new Float32Array(9);Ie.prototype.setValue=function(t,r){for(var a=this.seq,o=0,i=a.length,e;o!==i;++o)e=a[o],e.setValue(t,r[e.id])};var Ke=/([\w\d_]+)(\])?(\[|\.)?/g;Re.prototype.setValue=function(e,t,r){t=this.map[t],void 0!==t&&t.setValue(e,r,this.renderer)},Re.prototype.setOptional=function(e,t,r){t=t[r],void 0!==t&&this.setValue(e,r,t)},Re.upload=function(t,r,a,o){for(var i=0,e=r.length;i!==e;++i){var n=r[i],s=a[n.id];!1!==s.needsUpdate&&n.setValue(t,s.value,o)}},Re.seqWithValue=function(t,r){for(var a=[],o=0,i=t.length,e;o!==i;++o)e=t[o],e.id in r&&a.push(e);return a};var vn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Object.assign(Oe.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"===typeof e?this.setHex(e):"string"===typeof e&&this.setStyle(e),this},setScalar:function(e){return this.b=this.g=this.r=e,this},setHex:function(e){return e=hn(e),this.r=(255&e>>16)/255,this.g=(255&e>>8)/255,this.b=(255&e)/255,this},setRGB:function(e,t,r){return this.r=e,this.g=t,this.b=r,this},setHSL:function(){function e(e,t,r){return 0>r&&(r+=1),1<r&&--r,r<1/6?e+6*(t-e)*r:.5>r?t:r<2/3?e+6*(t-e)*(2/3-r):e}return function(t,r,a){return t=yn.euclideanModulo(t,1),r=yn.clamp(r,0,1),a=yn.clamp(a,0,1),0===r?this.r=this.g=this.b=a:(r=.5>=a?a*(1+r):a+r-a*r,a=2*a-r,this.r=e(a,r,t+1/3),this.g=e(a,r,t),this.b=e(a,r,t-1/3)),this}}(),setStyle:function(t){function r(e){void 0!==e&&1>parseFloat(e)&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}var a;if(a=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var o=a[2];switch(a[1]){case"rgb":case"rgba":if(a=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=un(255,parseInt(a[1],10))/255,this.g=un(255,parseInt(a[2],10))/255,this.b=un(255,parseInt(a[3],10))/255,r(a[5]),this;if(a=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=un(100,parseInt(a[1],10))/100,this.g=un(100,parseInt(a[2],10))/100,this.b=un(100,parseInt(a[3],10))/100,r(a[5]),this;break;case"hsl":case"hsla":if(a=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var o=parseFloat(a[1])/360,i=parseInt(a[2],10)/100,e=parseInt(a[3],10)/100;return r(a[5]),this.setHSL(o,i,e)}}}else if(a=/^\#([A-Fa-f0-9]+)$/.exec(t)){if(a=a[1],o=a.length,3===o)return this.r=parseInt(a.charAt(0)+a.charAt(0),16)/255,this.g=parseInt(a.charAt(1)+a.charAt(1),16)/255,this.b=parseInt(a.charAt(2)+a.charAt(2),16)/255,this;if(6===o)return this.r=parseInt(a.charAt(0)+a.charAt(1),16)/255,this.g=parseInt(a.charAt(2)+a.charAt(3),16)/255,this.b=parseInt(a.charAt(4)+a.charAt(5),16)/255,this}return t&&0<t.length&&(a=vn[t],void 0===a?console.warn("THREE.Color: Unknown color "+t):this.setHex(a)),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=sn(e.r,t),this.g=sn(e.g,t),this.b=sn(e.b,t),this},copyLinearToGamma:function(e,t){return void 0===t&&(t=2),t=0<t?1/t:1,this.r=sn(e.r,t),this.g=sn(e.g,t),this.b=sn(e.b,t),this},convertGammaToLinear:function(){var e=this.r,t=this.g,r=this.b;return this.r=e*e,this.g=t*t,this.b=r*r,this},convertLinearToGamma:function(){return this.r=pn(this.r),this.g=pn(this.g),this.b=pn(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){t=t||{h:0,s:0,l:0};var r=this.r,a=this.g,o=this.b,i=mn(r,a,o),e=un(r,a,o),n=(e+i)/2,s;if(e===i)e=s=0;else{var l=i-e,e=.5>=n?l/(i+e):l/(2-i-e);i===r?s=(a-o)/l+(a<o?6:0):i===a?s=(o-r)/l+2:i===o?s=(r-a)/l+4:void 0,s/=6}return t.h=s,t.s=e,t.l=n,t},getStyle:function(){return"rgb("+(0|255*this.r)+","+(0|255*this.g)+","+(0|255*this.b)+")"},offsetHSL:function(e,t,r){var a=this.getHSL();return a.h+=e,a.s+=t,a.l+=r,this.setHSL(a.h,a.s,a.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=mn(0,this.r-e.r),this.g=mn(0,this.g-e.g),this.b=mn(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}});var _n={common:{diffuse:{value:new Oe(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new y},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new o(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:2.5E-4},fogNear:{value:1},fogFar:{value:2E3},fogColor:{value:new Oe(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Oe(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new y}}},K={merge:function(t){for(var r={},a=0;a<t.length;a++){var o=this.clone(t[a]),i;for(i in o)r[i]=o[i]}return r},clone:function(t){var r={},a;for(a in t)for(var o in r[a]={},t[a]){var i=t[a][o];r[a][o]=i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?i.clone():Array.isArray(i)?i.slice():i}return r}},Aa={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t}\n\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; ++ i ) {\n\t\tvec4 plane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t\t\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; ++ i ) {\n\t\t\tvec4 plane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t\n\t#endif\n#endif\n",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\n",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}\n",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\nfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n  varying float fogDepth;\n#endif\n",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",lights_pars:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",lights_template:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\n\t#endif\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\n\t#ifndef STANDARD\n\t\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\n\t#else\n\t\tvec3 clearCoatRadiance = vec3( 0.0 );\n\t#endif\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif\n",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif\n",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",normal_fragment:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n#endif\n#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif\n",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif\n",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif\n",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\n",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}\n",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}\n",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}\n",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n"},U={basic:{uniforms:K.merge([_n.common,_n.specularmap,_n.envmap,_n.aomap,_n.lightmap,_n.fog]),vertexShader:Aa.meshbasic_vert,fragmentShader:Aa.meshbasic_frag},lambert:{uniforms:K.merge([_n.common,_n.specularmap,_n.envmap,_n.aomap,_n.lightmap,_n.emissivemap,_n.fog,_n.lights,{emissive:{value:new Oe(0)}}]),vertexShader:Aa.meshlambert_vert,fragmentShader:Aa.meshlambert_frag},phong:{uniforms:K.merge([_n.common,_n.specularmap,_n.envmap,_n.aomap,_n.lightmap,_n.emissivemap,_n.bumpmap,_n.normalmap,_n.displacementmap,_n.gradientmap,_n.fog,_n.lights,{emissive:{value:new Oe(0)},specular:{value:new Oe(1118481)},shininess:{value:30}}]),vertexShader:Aa.meshphong_vert,fragmentShader:Aa.meshphong_frag},standard:{uniforms:K.merge([_n.common,_n.envmap,_n.aomap,_n.lightmap,_n.emissivemap,_n.bumpmap,_n.normalmap,_n.displacementmap,_n.roughnessmap,_n.metalnessmap,_n.fog,_n.lights,{emissive:{value:new Oe(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:Aa.meshphysical_vert,fragmentShader:Aa.meshphysical_frag},points:{uniforms:K.merge([_n.points,_n.fog]),vertexShader:Aa.points_vert,fragmentShader:Aa.points_frag},dashed:{uniforms:K.merge([_n.common,_n.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Aa.linedashed_vert,fragmentShader:Aa.linedashed_frag},depth:{uniforms:K.merge([_n.common,_n.displacementmap]),vertexShader:Aa.depth_vert,fragmentShader:Aa.depth_frag},normal:{uniforms:K.merge([_n.common,_n.bumpmap,_n.normalmap,_n.displacementmap,{opacity:{value:1}}]),vertexShader:Aa.normal_vert,fragmentShader:Aa.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Aa.cube_vert,fragmentShader:Aa.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Aa.equirect_vert,fragmentShader:Aa.equirect_frag},distanceRGBA:{uniforms:K.merge([_n.common,_n.displacementmap,{referencePosition:{value:new _},nearDistance:{value:1},farDistance:{value:1E3}}]),vertexShader:Aa.distanceRGBA_vert,fragmentShader:Aa.distanceRGBA_frag},shadow:{uniforms:K.merge([_n.lights,_n.fog,{color:{value:new Oe(0)},opacity:{value:1}}]),vertexShader:Aa.shadow_vert,fragmentShader:Aa.shadow_frag}};U.physical={uniforms:K.merge([U.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:Aa.meshphysical_vert,fragmentShader:Aa.meshphysical_frag},G.prototype=Object.create(r.prototype),G.prototype.constructor=G;var bn=0;et.prototype=Object.assign(Object.create(t.prototype),{constructor:et,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var r=e[t];if(void 0===r)console.warn("THREE.Material: '"+t+"' parameter is undefined.");else if("shading"===t)console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=!(1!==r);else{var a=this[t];void 0===a?console.warn("THREE."+this.type+": '"+t+"' is not a property of this material."):a&&a.isColor?a.set(r):a&&a.isVector3&&r&&r.isVector3?a.copy(r):this[t]="overdraw"===t?+r:r}}},toJSON:function(e){function t(e){var t=[],r;for(r in e){var a=e[r];delete a.metadata,t.push(a)}return t}var r=void 0===e||"string"===typeof e;r&&(e={textures:{},images:{}});var o={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};return o.uuid=this.uuid,o.type=this.type,""!==this.name&&(o.name=this.name),this.color&&this.color.isColor&&(o.color=this.color.getHex()),void 0!==this.roughness&&(o.roughness=this.roughness),void 0!==this.metalness&&(o.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(o.emissive=this.emissive.getHex()),1!==this.emissiveIntensity&&(o.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(o.specular=this.specular.getHex()),void 0!==this.shininess&&(o.shininess=this.shininess),void 0!==this.clearCoat&&(o.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(o.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(o.map=this.map.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(o.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(o.lightMap=this.lightMap.toJSON(e).uuid),this.bumpMap&&this.bumpMap.isTexture&&(o.bumpMap=this.bumpMap.toJSON(e).uuid,o.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(o.normalMap=this.normalMap.toJSON(e).uuid,o.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(o.displacementMap=this.displacementMap.toJSON(e).uuid,o.displacementScale=this.displacementScale,o.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(o.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(o.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(o.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(o.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(o.envMap=this.envMap.toJSON(e).uuid,o.reflectivity=this.reflectivity),this.gradientMap&&this.gradientMap.isTexture&&(o.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(o.size=this.size),void 0!==this.sizeAttenuation&&(o.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(o.blending=this.blending),!0===this.flatShading&&(o.flatShading=this.flatShading),0!==this.side&&(o.side=this.side),0!==this.vertexColors&&(o.vertexColors=this.vertexColors),1>this.opacity&&(o.opacity=this.opacity),!0===this.transparent&&(o.transparent=this.transparent),o.depthFunc=this.depthFunc,o.depthTest=this.depthTest,o.depthWrite=this.depthWrite,0!==this.rotation&&(o.rotation=this.rotation),1!==this.linewidth&&(o.linewidth=this.linewidth),void 0!==this.dashSize&&(o.dashSize=this.dashSize),void 0!==this.gapSize&&(o.gapSize=this.gapSize),void 0!==this.scale&&(o.scale=this.scale),!0===this.dithering&&(o.dithering=!0),0<this.alphaTest&&(o.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(o.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(o.wireframe=this.wireframe),1<this.wireframeLinewidth&&(o.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(o.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(o.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(o.morphTargets=!0),!0===this.skinning&&(o.skinning=!0),!1===this.visible&&(o.visible=!1),"{}"!==JSON.stringify(this.userData)&&(o.userData=this.userData),r&&(r=t(e.textures),e=t(e.images),0<r.length&&(o.textures=r),0<e.length&&(o.images=e)),o},clone:function(){return new this.constructor().copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.lights=t.lights,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.overdraw=t.overdraw,this.visible=t.visible,this.userData=JSON.parse(JSON.stringify(t.userData)),this.clipShadows=t.clipShadows,this.clipIntersection=t.clipIntersection;var r=t.clippingPlanes,a=null;if(null!==r)for(var o=r.length,a=Array(o),i=0;i!==o;++i)a[i]=r[i].clone();return this.clippingPlanes=a,this.shadowSide=t.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),tt.prototype=Object.create(et.prototype),tt.prototype.constructor=tt,tt.prototype.isMeshDepthMaterial=!0,tt.prototype.copy=function(e){return et.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},rt.prototype=Object.create(et.prototype),rt.prototype.constructor=rt,rt.prototype.isMeshDistanceMaterial=!0,rt.prototype.copy=function(e){return et.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},Object.assign(at.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(t){for(var r=Infinity,a=Infinity,o=Infinity,i=-Infinity,e=-Infinity,s=-Infinity,p=0,d=t.length;p<d;p+=3){var c=t[p],m=t[p+1],l=t[p+2];c<r&&(r=c),m<a&&(a=m),l<o&&(o=l),c>i&&(i=c),m>e&&(e=m),l>s&&(s=l)}return this.min.set(r,a,o),this.max.set(i,e,s),this},setFromBufferAttribute:function(t){for(var r=Infinity,a=Infinity,o=Infinity,i=-Infinity,e=-Infinity,s=-Infinity,p=0,d=t.count;p<d;p++){var c=t.getX(p),m=t.getY(p),l=t.getZ(p);c<r&&(r=c),m<a&&(a=m),l<o&&(o=l),c>i&&(i=c),m>e&&(e=m),l>s&&(s=l)}return this.min.set(r,a,o),this.max.set(i,e,s),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new _;return function(t,r){return r=e.copy(r).multiplyScalar(.5),this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=Infinity,this.max.x=this.max.y=this.max.z=-Infinity,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return e=e||new _,this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return e=e||new _,this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(){function t(t){var n=t.geometry;if(void 0!==n)if(n.isGeometry)for(n=n.vertices,o=0,i=n.length;o<i;o++)r.copy(n[o]),r.applyMatrix4(t.matrixWorld),e.expandByPoint(r);else if(n.isBufferGeometry&&(n=n.attributes.position,void 0!==n))for(o=0,i=n.count;o<i;o++)r.fromBufferAttribute(n,o).applyMatrix4(t.matrixWorld),e.expandByPoint(r)}var r=new _,e,o,i;return function(r){return e=this,r.updateMatrixWorld(!0),r.traverse(t),this}}(),containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return(t||new _).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z?!1:!0},intersectsSphere:function(){var e=new _;return function(t){return this.clampPoint(t.center,e),e.distanceToSquared(t.center)<=t.radius*t.radius}}(),intersectsPlane:function(e){if(0<e.normal.x)var t=e.normal.x*this.min.x,r=e.normal.x*this.max.x;else t=e.normal.x*this.max.x,r=e.normal.x*this.min.x;return 0<e.normal.y?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=e.constant&&r>=e.constant},intersectsTriangle:function(){function t(t){var p=0,c;for(c=t.length-3;p<=c;p+=3){s.fromArray(t,p);var e=d.x*fn(s.x)+d.y*fn(s.y)+d.z*fn(s.z),m=r.dot(s),u=o.dot(s),l=i.dot(s);if(mn(-mn(m,u,l),un(m,u,l))>e)return!1}return!0}var r=new _,o=new _,i=new _,a=new _,e=new _,n=new _,s=new _,p=new _,d=new _,c=new _;return function(s){return!this.isEmpty()&&(this.getCenter(p),d.subVectors(this.max,p),r.subVectors(s.a,p),o.subVectors(s.b,p),i.subVectors(s.c,p),a.subVectors(o,r),e.subVectors(i,o),n.subVectors(r,i),s=[0,-a.z,a.y,0,-e.z,e.y,0,-n.z,n.y,a.z,0,-a.x,e.z,0,-e.x,n.z,0,-n.x,-a.y,a.x,0,-e.y,e.x,0,-n.y,n.x,0],!!t(s))&&(s=[1,0,0,0,1,0,0,0,1],!!t(s))&&(c.crossVectors(a,e),s=[c.x,c.y,c.z],t(s))}}(),clampPoint:function(e,t){return(t||new _).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new _;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new _;return function(t){return t=t||new ot,this.getCenter(t.center),t.radius=.5*this.getSize(e).length(),t}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new _,new _,new _,new _,new _,new _,new _,new _];return function(t){return this.isEmpty()?this:(e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(e),this)}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(ot.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var t=new at;return function(r,a){var o=this.center;void 0===a?t.setFromPoints(r).getCenter(o):o.copy(a);for(var i=a=0,e=r.length;i<e;i++)a=mn(a,o.distanceToSquared(r[i]));return this.radius=pn(a),this}}(),clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return 0>=this.radius},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return fn(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var r=this.center.distanceToSquared(e);return t=t||new _,t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return e=e||new at,e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius*=e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}),Object.assign(it.prototype,{set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,r,a){return this.normal.set(e,t,r),this.constant=a,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var t=new _,r=new _;return function(a,o,i){return o=t.subVectors(i,o).cross(r.subVectors(a,o)).normalize(),this.setFromNormalAndCoplanarPoint(o,a),this}}(),clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return(t||new _).copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(){var t=new _;return function(r,a){a=a||new _;var o=r.delta(t),i=this.normal.dot(o);if(0===i){if(0===this.distanceToPoint(r.start))return a.copy(r.start);}else if(i=-(r.start.dot(this.normal)+this.constant)/i,!(0>i||1<i))return a.copy(o).multiplyScalar(i).add(r.start)}}(),intersectsLine:function(e){var t=this.distanceToPoint(e.start);return e=this.distanceToPoint(e.end),0>t&&0<e||0>e&&0<t},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return(e||new _).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new _,t=new y;return function(r,a){return a=a||t.getNormalMatrix(r),r=this.coplanarPoint(e).applyMatrix4(r),a=this.normal.applyMatrix3(a).normalize(),this.constant=-r.dot(a),this}}(),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}),Object.assign(nt.prototype,{set:function(t,r,a,o,i,e){var n=this.planes;return n[0].copy(t),n[1].copy(r),n[2].copy(a),n[3].copy(o),n[4].copy(i),n[5].copy(e),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){for(var t=this.planes,r=0;6>r;r++)t[r].copy(e.planes[r]);return this},setFromMatrix:function(t){var a=this.planes,o=t.elements;t=o[0];var i=o[1],s=o[2],e=o[3],d=o[4],c=o[5],g=o[6],f=o[7],m=o[8],l=o[9],n=o[10],p=o[11],r=o[12],h=o[13],u=o[14],o=o[15];return a[0].setComponents(e-t,f-d,p-m,o-r).normalize(),a[1].setComponents(e+t,f+d,p+m,o+r).normalize(),a[2].setComponents(e+i,f+c,p+l,o+h).normalize(),a[3].setComponents(e-i,f-c,p-l,o-h).normalize(),a[4].setComponents(e-s,f-g,p-n,o-u).normalize(),a[5].setComponents(e+s,f+g,p+n,o+u).normalize(),this},intersectsObject:function(){var e=new ot;return function(t){var r=t.geometry;return null===r.boundingSphere&&r.computeBoundingSphere(),e.copy(r.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSprite:function(){var e=new ot;return function(t){return e.center.set(0,0,0),e.radius=.7071067811865476,e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){var t=this.planes,r=e.center;e=-e.radius;for(var a=0;6>a;a++)if(t[a].distanceToPoint(r)<e)return!1;return!0},intersectsBox:function(){var t=new _,r=new _;return function(a){for(var o=this.planes,i=0,e;6>i;i++){e=o[i],t.x=0<e.normal.x?a.min.x:a.max.x,r.x=0<e.normal.x?a.max.x:a.min.x,t.y=0<e.normal.y?a.min.y:a.max.y,r.y=0<e.normal.y?a.max.y:a.min.y,t.z=0<e.normal.z?a.min.z:a.max.z,r.z=0<e.normal.z?a.max.z:a.min.z;var n=e.distanceToPoint(t),e=e.distanceToPoint(r);if(0>n&&0>e)return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,r=0;6>r;r++)if(0>t[r].distanceToPoint(e))return!1;return!0}}),lt.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],lt.DefaultOrder="XYZ",Object.defineProperties(lt.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this.onChangeCallback()}}}),Object.assign(lt.prototype,{isEuler:!0,set:function(e,t,r,a){return this._x=e,this._y=t,this._z=r,this._order=a||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,r,a){var o=Math.asin,i=yn.clamp,s=t.elements;t=s[0];var e=s[4],p=s[8],d=s[1],c=s[5],u=s[9],g=s[2],h=s[6],s=s[10];return r=r||this._order,"XYZ"===r?(this._y=o(i(p,-1,1)),.99999>fn(p)?(this._x=nn(-u,s),this._z=nn(-e,t)):(this._x=nn(h,c),this._z=0)):"YXZ"===r?(this._x=o(-i(u,-1,1)),.99999>fn(u)?(this._y=nn(p,s),this._z=nn(d,c)):(this._y=nn(-g,t),this._z=0)):"ZXY"===r?(this._x=o(i(h,-1,1)),.99999>fn(h)?(this._y=nn(-g,s),this._z=nn(-e,c)):(this._y=0,this._z=nn(d,t))):"ZYX"===r?(this._y=o(-i(g,-1,1)),.99999>fn(g)?(this._x=nn(h,s),this._z=nn(d,t)):(this._x=0,this._z=nn(-e,c))):"YZX"===r?(this._z=o(i(d,-1,1)),.99999>fn(d)?(this._x=nn(-u,c),this._y=nn(-g,t)):(this._x=0,this._y=nn(p,s))):"XZY"===r?(this._z=o(-i(e,-1,1)),.99999>fn(e)?(this._x=nn(h,c),this._y=nn(p,t)):(this._x=nn(-u,s),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+r),this._order=r,!1!==a&&this.onChangeCallback(),this},setFromQuaternion:function(){var e=new i;return function(t,r,a){return e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,r,a)}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){var e=new s;return function(t){return e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new _(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(pt.prototype,{set:function(e){this.mask=0|1<<e},enable:function(e){this.mask=0|(this.mask|1<<e)},toggle:function(e){this.mask^=0|1<<e},disable:function(e){this.mask&=~(0|1<<e)},test:function(e){return 0!==(this.mask&e.mask)}});var En=0;dt.DefaultUp=new _(0,1,0),dt.DefaultMatrixAutoUpdate=!0,dt.prototype=Object.assign(Object.create(t.prototype),{constructor:dt,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new s;return function(t,r){return e.setFromAxisAngle(t,r),this.quaternion.multiply(e),this}}(),rotateOnWorldAxis:function(){var e=new s;return function(t,r){return e.setFromAxisAngle(t,r),this.quaternion.premultiply(e),this}}(),rotateX:function(){var e=new _(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new _(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new _(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new _;return function(t,r){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(r)),this}}(),translateX:function(){var e=new _(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new _(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new _(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new i;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var t=new i,r=new _;return function(a,o,i){a.isVector3?r.copy(a):r.set(a,o,i),this.isCamera?t.lookAt(this.position,r,this.up):t.lookAt(r,this.position,this.up),this.quaternion.setFromRotationMatrix(t)}}(),add:function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}return t=this.children.indexOf(e),-1!==t&&(e.parent=null,e.dispatchEvent({type:"removed"}),this.children.splice(t,1)),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(t,r){if(this[t]===r)return this;for(var a=0,o=this.children.length,i;a<o;a++)if(i=this.children[a].getObjectByProperty(t,r),void 0!==i)return i},getWorldPosition:function(e){return e=e||new _,this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new _,t=new _;return function(r){return r=r||new s,this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,r,t),r}}(),getWorldRotation:function(){var e=new s;return function(t){return t=t||new lt,this.getWorldQuaternion(e),t.setFromQuaternion(e,this.rotation.order,!1)}}(),getWorldScale:function(){var e=new _,t=new s;return function(r){return r=r||new _,this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,r),r}}(),getWorldDirection:function(){var e=new s;return function(t){return t=t||new _,this.getWorldQuaternion(e),t.set(0,0,1).applyQuaternion(e)}}(),raycast:function(){},traverse:function(e){e(this);for(var t=this.children,r=0,a=t.length;r<a;r++)t[r].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,r=0,a=t.length;r<a;r++)t[r].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,r=0,a=t.length;r<a;r++)t[r].updateMatrixWorld(e)},toJSON:function(t){function r(e,r){return void 0===e[r.uuid]&&(e[r.uuid]=r.toJSON(t)),r.uuid}function o(e){var t=[],r;for(r in e){var a=e[r];delete a.metadata,t.push(a)}return t}var i=void 0===t||"string"===typeof t,n={};i&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var e={};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),!0===this.castShadow&&(e.castShadow=!0),!0===this.receiveShadow&&(e.receiveShadow=!0),!1===this.visible&&(e.visible=!1),"{}"!==JSON.stringify(this.userData)&&(e.userData=this.userData),e.matrix=this.matrix.toArray(),void 0!==this.geometry){e.geometry=r(t.geometries,this.geometry);var s=this.geometry.parameters;if(void 0!==s&&void 0!==s.shapes)if(s=s.shapes,Array.isArray(s))for(var l=0,p=s.length;l<p;l++)r(t.shapes,s[l]);else r(t.shapes,s)}if(void 0!==this.material)if(Array.isArray(this.material)){for(s=[],l=0,p=this.material.length;l<p;l++)s.push(r(t.materials,this.material[l]));e.material=s}else e.material=r(t.materials,this.material);if(0<this.children.length)for(e.children=[],l=0;l<this.children.length;l++)e.children.push(this.children[l].toJSON(t).object);if(i){var i=o(t.geometries),l=o(t.materials),p=o(t.textures),d=o(t.images);s=o(t.shapes),0<i.length&&(n.geometries=i),0<l.length&&(n.materials=l),0<p.length&&(n.textures=p),0<d.length&&(n.images=d),0<s.length&&(n.shapes=s)}return n.object=e,n},clone:function(e){return new this.constructor().copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(t=0;t<e.children.length;t++)this.add(e.children[t].clone());return this}}),ct.prototype=Object.assign(Object.create(dt.prototype),{constructor:ct,isCamera:!0,copy:function(e,t){return dt.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this},getWorldDirection:function(){var e=new s;return function(t){return t=t||new _,this.getWorldQuaternion(e),t.set(0,0,-1).applyQuaternion(e)}}(),updateMatrixWorld:function(e){dt.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return new this.constructor().copy(this)}}),mt.prototype=Object.assign(Object.create(ct.prototype),{constructor:mt,isOrthographicCamera:!0,copy:function(e,t){return ct.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(t,r,a,o,i,e){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=r,this.view.offsetX=a,this.view.offsetY=o,this.view.width=i,this.view.height=e,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),r=(this.top-this.bottom)/(2*this.zoom),a=(this.right+this.left)/2,o=(this.top+this.bottom)/2,i=a-t,a=a+t,t=o+r,r=o-r;if(null!==this.view&&this.view.enabled)var a=this.zoom/(this.view.width/this.view.fullWidth),r=this.zoom/(this.view.height/this.view.fullHeight),e=(this.right-this.left)/this.view.width,o=(this.top-this.bottom)/this.view.height,i=i+this.view.offsetX/a*e,a=i+this.view.width/a*e,t=t-this.view.offsetY/r*o,r=t-this.view.height/r*o;this.projectionMatrix.makeOrthographic(i,a,t,r,this.near,this.far)},toJSON:function(e){return e=dt.prototype.toJSON.call(this,e),e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}),Object.assign(ut.prototype,{clone:function(){return new this.constructor().copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,r=e.vertexNormals.length;t<r;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,r=e.vertexColors.length;t<r;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});var Tn=0;gt.prototype=Object.assign(Object.create(t.prototype),{constructor:gt,isGeometry:!0,applyMatrix:function(t){for(var r=new y().getNormalMatrix(t),a=0,o=this.vertices.length;a<o;a++)this.vertices[a].applyMatrix4(t);for(a=0,o=this.faces.length;a<o;a++){t=this.faces[a],t.normal.applyMatrix3(r).normalize();for(var i=0,e=t.vertexNormals.length;i<e;i++)t.vertexNormals[i].applyMatrix3(r).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.normalsNeedUpdate=this.verticesNeedUpdate=!0,this},rotateX:function(){var e=new i;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new i;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new i;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new i;return function(t,r,a){return e.makeTranslation(t,r,a),this.applyMatrix(e),this}}(),scale:function(){var e=new i;return function(t,r,a){return e.makeScale(t,r,a),this.applyMatrix(e),this}}(),lookAt:function(){var e=new dt;return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),fromBufferGeometry:function(t){function a(r,a,o,s){var e=void 0===c?[]:[m[r].clone(),m[a].clone(),m[o].clone()],p=void 0===g?[]:[i.colors[r].clone(),i.colors[a].clone(),i.colors[o].clone()];s=new ut(r,a,o,e,p,s),i.faces.push(s),void 0!==h&&i.faceVertexUvs[0].push([l[r].clone(),l[a].clone(),l[o].clone()]),void 0!==y&&i.faceVertexUvs[1].push([n[r].clone(),n[a].clone(),n[o].clone()])}var i=this,s=null===t.index?void 0:t.index.array,p=t.attributes,e=p.position.array,c=void 0===p.normal?void 0:p.normal.array,g=void 0===p.color?void 0:p.color.array,h=void 0===p.uv?void 0:p.uv.array,y=void 0===p.uv2?void 0:p.uv2.array;void 0!==y&&(this.faceVertexUvs[1]=[]);for(var m=[],l=[],n=[],d=p=0;p<e.length;p+=3,d+=2)i.vertices.push(new _(e[p],e[p+1],e[p+2])),void 0!==c&&m.push(new _(c[p],c[p+1],c[p+2])),void 0!==g&&i.colors.push(new Oe(g[p],g[p+1],g[p+2])),void 0!==h&&l.push(new o(h[d],h[d+1])),void 0!==y&&n.push(new o(y[d],y[d+1]));var r=t.groups;if(0<r.length)for(p=0;p<r.length;p++)for(var e=r[p],f=e.start,u=e.count,d=f,f=f+u;d<f;d+=3)void 0===s?a(d,d+1,d+2,e.materialIndex):a(s[d],s[d+1],s[d+2],e.materialIndex);else if(void 0!==s)for(p=0;p<s.length;p+=3)a(s[p],s[p+1],s[p+2]);else for(p=0;p<e.length/3;p+=3)a(p,p+1,p+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var e=this.boundingBox.getCenter().negate();return this.translate(e.x,e.y,e.z),e},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,t=0===t?1:1/t,r=new i;return r.set(t,0,0,-t*e.x,0,t,0,-t*e.y,0,0,t,-t*e.z,0,0,0,1),this.applyMatrix(r),this},computeFaceNormals:function(){for(var t=new _,r=new _,a=0,o=this.faces.length;a<o;a++){var i=this.faces[a],e=this.vertices[i.a],n=this.vertices[i.b];t.subVectors(this.vertices[i.c],n),r.subVectors(e,n),t.cross(r),t.normalize(),i.normal.copy(t)}},computeVertexNormals:function(t){void 0===t&&(t=!0);var r=Array(this.vertices.length),a=0,o;for(o=this.vertices.length;a<o;a++)r[a]=new _;if(t){var i=new _,e=new _;for(t=0,a=this.faces.length;t<a;t++){o=this.faces[t];var n=this.vertices[o.a],s=this.vertices[o.b],l=this.vertices[o.c];i.subVectors(l,s),e.subVectors(n,s),i.cross(e),r[o.a].add(i),r[o.b].add(i),r[o.c].add(i)}}else for(this.computeFaceNormals(),t=0,a=this.faces.length;t<a;t++)o=this.faces[t],r[o.a].add(o.normal),r[o.b].add(o.normal),r[o.c].add(o.normal);for(a=0,o=this.vertices.length;a<o;a++)r[a].normalize();for(t=0,a=this.faces.length;t<a;t++)o=this.faces[t],n=o.vertexNormals,3===n.length?(n[0].copy(r[o.a]),n[1].copy(r[o.b]),n[2].copy(r[o.c])):(n[0]=r[o.a].clone(),n[1]=r[o.b].clone(),n[2]=r[o.c].clone());0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e;this.computeFaceNormals();var t=0;for(e=this.faces.length;t<e;t++){var r=this.faces[t],a=r.vertexNormals;3===a.length?(a[0].copy(r.normal),a[1].copy(r.normal),a[2].copy(r.normal)):(a[0]=r.normal.clone(),a[1]=r.normal.clone(),a[2]=r.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t=0,r,a;for(a=this.faces.length;t<a;t++){var o=this.faces[t];o.__originalFaceNormal?o.__originalFaceNormal.copy(o.normal):o.__originalFaceNormal=o.normal.clone(),o.__originalVertexNormals||(o.__originalVertexNormals=[]);var i=0;for(r=o.vertexNormals.length;i<r;i++)o.__originalVertexNormals[i]?o.__originalVertexNormals[i].copy(o.vertexNormals[i]):o.__originalVertexNormals[i]=o.vertexNormals[i].clone()}var e=new gt;for(e.faces=this.faces,i=0,r=this.morphTargets.length;i<r;i++){if(!this.morphNormals[i]){this.morphNormals[i]={},this.morphNormals[i].faceNormals=[],this.morphNormals[i].vertexNormals=[],o=this.morphNormals[i].faceNormals;var n=this.morphNormals[i].vertexNormals;for(t=0,a=this.faces.length;t<a;t++){var s=new _,l={a:new _,b:new _,c:new _};o.push(s),n.push(l)}}for(n=this.morphNormals[i],e.vertices=this.morphTargets[i].vertices,e.computeFaceNormals(),e.computeVertexNormals(),t=0,a=this.faces.length;t<a;t++)o=this.faces[t],s=n.faceNormals[t],l=n.vertexNormals[t],s.copy(o.normal),l.a.copy(o.vertexNormals[0]),l.b.copy(o.vertexNormals[1]),l.c.copy(o.vertexNormals[2])}for(t=0,a=this.faces.length;t<a;t++)o=this.faces[t],o.normal=o.__originalFaceNormal,o.vertexNormals=o.__originalVertexNormals},computeLineDistances:function(){for(var e=0,t=this.vertices,r=0,a=t.length;r<a;r++)0<r&&(e+=t[r].distanceTo(t[r-1])),this.lineDistances[r]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new at),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new ot),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,a,o){if(t&&t.isGeometry){var i=this.vertices.length,e=this.vertices,s=t.vertices,c=this.faces,g=t.faces,f=this.faceVertexUvs[0],m=t.faceVertexUvs[0],l=this.colors,n=t.colors,p;void 0===o&&(o=0),void 0!==a&&(p=new y().getNormalMatrix(a)),t=0;for(var d=s.length,r;t<d;t++)r=s[t].clone(),void 0!==a&&r.applyMatrix4(a),e.push(r);for(t=0,d=n.length;t<d;t++)l.push(n[t].clone());for(t=0,d=g.length;t<d;t++){var s=g[t],h=s.vertexNormals,n=s.vertexColors,l=new ut(s.a+i,s.b+i,s.c+i);for(l.normal.copy(s.normal),void 0!==p&&l.normal.applyMatrix3(p).normalize(),a=0,e=h.length;a<e;a++)r=h[a].clone(),void 0!==p&&r.applyMatrix3(p).normalize(),l.vertexNormals.push(r);for(l.color.copy(s.color),a=0,e=n.length;a<e;a++)r=n[a],l.vertexColors.push(r.clone());l.materialIndex=s.materialIndex+o,c.push(l)}for(t=0,d=m.length;t<d;t++)if(o=m[t],p=[],void 0!==o){for(a=0,e=o.length;a<e;a++)p.push(o[a].clone());f.push(p)}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var t={},r=[],a=[],o=10000,i=0,n;for(n=this.vertices.length;i<n;i++){var e=this.vertices[i];e=$i(e.x*o)+"_"+$i(e.y*o)+"_"+$i(e.z*o),void 0===t[e]?(t[e]=i,r.push(this.vertices[i]),a[i]=r.length-1):a[i]=a[t[e]]}for(t=[],i=0,n=this.faces.length;i<n;i++)for(o=this.faces[i],o.a=a[o.a],o.b=a[o.b],o.c=a[o.c],o=[o.a,o.b,o.c],e=0;3>e;e++)if(o[e]===o[(e+1)%3]){t.push(i);break}for(i=t.length-1;0<=i;i--)for(o=t[i],this.faces.splice(o,1),a=0,n=this.faceVertexUvs.length;a<n;a++)this.faceVertexUvs[a].splice(o,1);return i=this.vertices.length-r.length,this.vertices=r,i},setFromPoints:function(e){this.vertices=[];for(var t=0,r=e.length,a;t<r;t++)a=e[t],this.vertices.push(new _(a.x,a.y,a.z||0));return this},sortFacesByMaterialIndex:function(){for(var t=this.faces,r=t.length,a=0;a<r;a++)t[a]._id=a;t.sort(function(e,t){return e.materialIndex-t.materialIndex});var o=this.faceVertexUvs[0],i=this.faceVertexUvs[1],e,n;for(o&&o.length===r&&(e=[]),i&&i.length===r&&(n=[]),a=0;a<r;a++){var s=t[a]._id;e&&e.push(o[s]),n&&n.push(i[s])}e&&(this.faceVertexUvs[0]=e),n&&(this.faceVertexUvs[1]=n)},toJSON:function(){function t(e,t,r){return r?e|1<<t:e&~(1<<t)}function a(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0===f[t]?(f[t]=g.length/3,g.push(e.x,e.y,e.z),f[t]):f[t]}function o(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0===l[t]?(l[t]=m.length,m.push(e.getHex()),l[t]):l[t]}function i(e){var t=e.x.toString()+e.y.toString();return void 0===p[t]?(p[t]=n.length/2,n.push(e.x,e.y),p[t]):p[t]}var s={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(s.uuid=this.uuid,s.type=this.type,""!==this.name&&(s.name=this.name),void 0!==this.parameters){var e=this.parameters,d;for(d in e)void 0!==e[d]&&(s[d]=e[d]);return s}for(e=[],d=0;d<this.vertices.length;d++){var c=this.vertices[d];e.push(c.x,c.y,c.z)}var c=[],g=[],f={},m=[],l={},n=[],p={};for(d=0;d<this.faces.length;d++){var r=this.faces[d],h=void 0!==this.faceVertexUvs[0][d],u=0<r.normal.length(),v=0<r.vertexNormals.length,x=1!==r.color.r||1!==r.color.g||1!==r.color.b,_=0<r.vertexColors.length,b=0,b=t(b,0,0),b=t(b,1,!0),b=t(b,2,!1),b=t(b,3,h),b=t(b,4,u),b=t(b,5,v),b=t(b,6,x),b=t(b,7,_);c.push(b),c.push(r.a,r.b,r.c),c.push(r.materialIndex),h&&(h=this.faceVertexUvs[0][d],c.push(i(h[0]),i(h[1]),i(h[2]))),u&&c.push(a(r.normal)),v&&(u=r.vertexNormals,c.push(a(u[0]),a(u[1]),a(u[2]))),x&&c.push(o(r.color)),_&&(r=r.vertexColors,c.push(o(r[0]),o(r[1]),o(r[2])))}return s.data={},s.data.vertices=e,s.data.normals=g,0<m.length&&(s.data.colors=m),0<n.length&&(s.data.uvs=[n]),s.data.faces=c,s},clone:function(){return new gt().copy(this)},copy:function(t){var r,a,o;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingSphere=this.boundingBox=null,this.name=t.name;var i=t.vertices,e=0;for(r=i.length;e<r;e++)this.vertices.push(i[e].clone());for(i=t.colors,e=0,r=i.length;e<r;e++)this.colors.push(i[e].clone());for(i=t.faces,e=0,r=i.length;e<r;e++)this.faces.push(i[e].clone());for(e=0,r=t.faceVertexUvs.length;e<r;e++){var n=t.faceVertexUvs[e];for(void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]),i=0,a=n.length;i<a;i++){var s=n[i],l=[],p=0;for(o=s.length;p<o;p++)l.push(s[p].clone());this.faceVertexUvs[e].push(l)}}for(p=t.morphTargets,e=0,r=p.length;e<r;e++){if(o={},o.name=p[e].name,void 0!==p[e].vertices)for(o.vertices=[],i=0,a=p[e].vertices.length;i<a;i++)o.vertices.push(p[e].vertices[i].clone());if(void 0!==p[e].normals)for(o.normals=[],i=0,a=p[e].normals.length;i<a;i++)o.normals.push(p[e].normals[i].clone());this.morphTargets.push(o)}for(p=t.morphNormals,e=0,r=p.length;e<r;e++){if(o={},void 0!==p[e].vertexNormals)for(o.vertexNormals=[],i=0,a=p[e].vertexNormals.length;i<a;i++)n=p[e].vertexNormals[i],s={},s.a=n.a.clone(),s.b=n.b.clone(),s.c=n.c.clone(),o.vertexNormals.push(s);if(void 0!==p[e].faceNormals)for(o.faceNormals=[],i=0,a=p[e].faceNormals.length;i<a;i++)o.faceNormals.push(p[e].faceNormals[i].clone());this.morphNormals.push(o)}for(i=t.skinWeights,e=0,r=i.length;e<r;e++)this.skinWeights.push(i[e].clone());for(i=t.skinIndices,e=0,r=i.length;e<r;e++)this.skinIndices.push(i[e].clone());for(i=t.lineDistances,e=0,r=i.length;e<r;e++)this.lineDistances.push(i[e]);return e=t.boundingBox,null!==e&&(this.boundingBox=e.clone()),e=t.boundingSphere,null!==e&&(this.boundingSphere=e.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(ft.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(ft.prototype,{isBufferAttribute:!0,setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0===e?0:e.length/this.itemSize,this.array=e},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.dynamic=e.dynamic,this},copyAt:function(t,r,a){t*=this.itemSize,a*=r.itemSize;for(var o=0,i=this.itemSize;o<i;o++)this.array[t+o]=r.array[a+o];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(t){for(var r=this.array,a=0,o=0,i=t.length,e;o<i;o++)e=t[o],void 0===e&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",o),e=new Oe),r[a++]=e.r,r[a++]=e.g,r[a++]=e.b;return this},copyIndicesArray:function(t){for(var r=this.array,a=0,o=0,i=t.length,e;o<i;o++)e=t[o],r[a++]=e.a,r[a++]=e.b,r[a++]=e.c;return this},copyVector2sArray:function(t){for(var r=this.array,a=0,i=0,n=t.length,e;i<n;i++)e=t[i],void 0===e&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),e=new o),r[a++]=e.x,r[a++]=e.y;return this},copyVector3sArray:function(t){for(var r=this.array,a=0,o=0,i=t.length,e;o<i;o++)e=t[o],void 0===e&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",o),e=new _),r[a++]=e.x,r[a++]=e.y,r[a++]=e.z;return this},copyVector4sArray:function(t){for(var r=this.array,a=0,o=0,i=t.length,e;o<i;o++)e=t[o],void 0===e&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",o),e=new j),r[a++]=e.x,r[a++]=e.y,r[a++]=e.z,r[a++]=e.w;return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this},setXYZ:function(e,t,r,a){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=a,this},setXYZW:function(t,r,a,o,i){return t*=this.itemSize,this.array[t+0]=r,this.array[t+1]=a,this.array[t+2]=o,this.array[t+3]=i,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),L.prototype=Object.create(ft.prototype),L.prototype.constructor=L,ht.prototype=Object.create(ft.prototype),ht.prototype.constructor=ht,yt.prototype=Object.create(ft.prototype),yt.prototype.constructor=yt,xt.prototype=Object.create(ft.prototype),xt.prototype.constructor=xt,vt.prototype=Object.create(ft.prototype),vt.prototype.constructor=vt,_t.prototype=Object.create(ft.prototype),_t.prototype.constructor=_t,bt.prototype=Object.create(ft.prototype),bt.prototype.constructor=bt,Et.prototype=Object.create(ft.prototype),Et.prototype.constructor=Et,D.prototype=Object.create(ft.prototype),D.prototype.constructor=D,Object.assign(Tt.prototype,{computeGroups:function(t){var r=[],a;t=t.faces;for(var o=0,i;o<t.length;o++)if(i=t[o],i.materialIndex!==a){a=i.materialIndex,void 0!==e&&(e.count=3*o-e.start,r.push(e));var e={start:3*o,materialIndex:a}}void 0!==e&&(e.count=3*o-e.start,r.push(e)),this.groups=r},fromGeometry:function(t){var a=t.faces,i=t.vertices,s=t.faceVertexUvs,d=s[0]&&0<s[0].length,e=s[1]&&0<s[1].length,c=t.morphTargets,g=c.length;if(0<g){for(var f=[],h=0;h<g;h++)f[h]=[];this.morphTargets.position=f}var m=t.morphNormals,l=m.length;if(0<l){var n=[];for(h=0;h<l;h++)n[h]=[];this.morphTargets.normal=n}for(var p=t.skinIndices,r=t.skinWeights,y=p.length===i.length,u=r.length===i.length,h=0,v;h<a.length;h++){v=a[h],this.vertices.push(i[v.a],i[v.b],i[v.c]);var x=v.vertexNormals;for(3===x.length?this.normals.push(x[0],x[1],x[2]):(x=v.normal,this.normals.push(x,x,x)),x=v.vertexColors,3===x.length?this.colors.push(x[0],x[1],x[2]):(x=v.color,this.colors.push(x,x,x)),!0===d&&(x=s[0][h],void 0===x?(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",h),this.uvs.push(new o,new o,new o)):this.uvs.push(x[0],x[1],x[2])),!0===e&&(x=s[1][h],void 0===x?(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",h),this.uvs2.push(new o,new o,new o)):this.uvs2.push(x[0],x[1],x[2])),x=0;x<g;x++){var _=c[x].vertices;f[x].push(_[v.a],_[v.b],_[v.c])}for(x=0;x<l;x++)_=m[x].vertexNormals[h],n[x].push(_.a,_.b,_.c);y&&this.skinIndices.push(p[v.a],p[v.b],p[v.c]),u&&this.skinWeights.push(r[v.a],r[v.b],r[v.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this}});var Sn=1;St.prototype=Object.assign(Object.create(t.prototype),{constructor:St,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){this.index=Array.isArray(e)?new(65535<Ue(e)?bt:vt)(e,1):e},addAttribute:function(e,t,r){if(!(t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute))console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(e,new ft(t,r));else if("index"===e)console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t);else return this.attributes[e]=t,this},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,r){this.groups.push({start:e,count:t,materialIndex:void 0===r?0:r})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;return void 0!==t&&(e.applyToBufferAttribute(t),t.needsUpdate=!0),t=this.attributes.normal,void 0!==t&&(new y().getNormalMatrix(e).applyToBufferAttribute(t),t.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var e=new i;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new i;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new i;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new i;return function(t,r,a){return e.makeTranslation(t,r,a),this.applyMatrix(e),this}}(),scale:function(){var e=new i;return function(t,r,a){return e.makeScale(t,r,a),this.applyMatrix(e),this}}(),lookAt:function(){var e=new dt;return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),center:function(){this.computeBoundingBox();var e=this.boundingBox.getCenter().negate();return this.translate(e.x,e.y,e.z),e},setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){e=new Et(3*t.vertices.length,3);var r=new Et(3*t.colors.length,3);this.addAttribute("position",e.copyVector3sArray(t.vertices)),this.addAttribute("color",r.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length&&(e=new Et(t.lineDistances.length,1),this.addAttribute("lineDistance",e.copyArray(t.lineDistances))),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(t){for(var r=[],a=0,o=t.length,i;a<o;a++)i=t[a],r.push(i.x,i.y,i.z||0);return this.addAttribute("position",new Et(r,3)),this},updateFromObject:function(e){var t=e.geometry;if(e.isMesh){var r=t.__directGeometry;if(!0===t.elementsNeedUpdate&&(r=void 0,t.elementsNeedUpdate=!1),void 0===r)return this.fromGeometry(t);r.verticesNeedUpdate=t.verticesNeedUpdate,r.normalsNeedUpdate=t.normalsNeedUpdate,r.colorsNeedUpdate=t.colorsNeedUpdate,r.uvsNeedUpdate=t.uvsNeedUpdate,r.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=r}return!0===t.verticesNeedUpdate&&(r=this.attributes.position,void 0!==r&&(r.copyVector3sArray(t.vertices),r.needsUpdate=!0),t.verticesNeedUpdate=!1),!0===t.normalsNeedUpdate&&(r=this.attributes.normal,void 0!==r&&(r.copyVector3sArray(t.normals),r.needsUpdate=!0),t.normalsNeedUpdate=!1),!0===t.colorsNeedUpdate&&(r=this.attributes.color,void 0!==r&&(r.copyColorsArray(t.colors),r.needsUpdate=!0),t.colorsNeedUpdate=!1),t.uvsNeedUpdate&&(r=this.attributes.uv,void 0!==r&&(r.copyVector2sArray(t.uvs),r.needsUpdate=!0),t.uvsNeedUpdate=!1),t.lineDistancesNeedUpdate&&(r=this.attributes.lineDistance,void 0!==r&&(r.copyArray(t.lineDistances),r.needsUpdate=!0),t.lineDistancesNeedUpdate=!1),t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=new Tt().fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(t){var r=new Float32Array(3*t.vertices.length);for(var a in this.addAttribute("position",new ft(r,3).copyVector3sArray(t.vertices)),0<t.normals.length&&(r=new Float32Array(3*t.normals.length),this.addAttribute("normal",new ft(r,3).copyVector3sArray(t.normals))),0<t.colors.length&&(r=new Float32Array(3*t.colors.length),this.addAttribute("color",new ft(r,3).copyColorsArray(t.colors))),0<t.uvs.length&&(r=new Float32Array(2*t.uvs.length),this.addAttribute("uv",new ft(r,2).copyVector2sArray(t.uvs))),0<t.uvs2.length&&(r=new Float32Array(2*t.uvs2.length),this.addAttribute("uv2",new ft(r,2).copyVector2sArray(t.uvs2))),0<t.indices.length&&(r=new(65535<Ue(t.indices)?Uint32Array:Uint16Array)(3*t.indices.length),this.setIndex(new ft(r,1).copyIndicesArray(t.indices))),this.groups=t.groups,t.morphTargets){for(var r=[],o=t.morphTargets[a],i=0,e=o.length;i<e;i++){var n=o[i],s=new Et(3*n.length,3);r.push(s.copyVector3sArray(n))}this.morphAttributes[a]=r}return 0<t.skinIndices.length&&(a=new Et(4*t.skinIndices.length,4),this.addAttribute("skinIndex",a.copyVector4sArray(t.skinIndices))),0<t.skinWeights.length&&(a=new Et(4*t.skinWeights.length,4),this.addAttribute("skinWeight",a.copyVector4sArray(t.skinWeights))),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new at);var e=this.attributes.position;void 0===e?this.boundingBox.makeEmpty():this.boundingBox.setFromBufferAttribute(e),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error("THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The \"position\" attribute is likely to have NaN values.",this)},computeBoundingSphere:function(){var t=new at,r=new _;return function(){null===this.boundingSphere&&(this.boundingSphere=new ot);var a=this.attributes.position;if(a){var o=this.boundingSphere.center;t.setFromBufferAttribute(a),t.getCenter(o);for(var i=0,e=0,n=a.count;e<n;e++)r.x=a.getX(e),r.y=a.getY(e),r.z=a.getZ(e),i=mn(i,o.distanceToSquared(r));this.boundingSphere.radius=pn(i),isNaN(this.boundingSphere.radius)&&console.error("THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The \"position\" attribute is likely to have NaN values.",this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,a=this.attributes,o=this.groups;if(a.position){var i=a.position.array;if(void 0===a.normal)this.addAttribute("normal",new ft(new Float32Array(i.length),3));else for(var s=a.normal.array,e=0,p=s.length;e<p;e++)s[e]=0;var s=a.normal.array,d=new _,c=new _,g=new _,m=new _,l=new _;if(t){t=t.array,0===o.length&&this.addGroup(0,t.length);for(var n=0,f=o.length;n<f;++n){e=o[n],p=e.start;var r=e.count;for(e=p,p+=r;e<p;e+=3){r=3*t[e+0];var h=3*t[e+1],u=3*t[e+2];d.fromArray(i,r),c.fromArray(i,h),g.fromArray(i,u),m.subVectors(g,c),l.subVectors(d,c),m.cross(l),s[r]+=m.x,s[r+1]+=m.y,s[r+2]+=m.z,s[h]+=m.x,s[h+1]+=m.y,s[h+2]+=m.z,s[u]+=m.x,s[u+1]+=m.y,s[u+2]+=m.z}}}else for(e=0,p=i.length;e<p;e+=9)d.fromArray(i,e),c.fromArray(i,e+3),g.fromArray(i,e+6),m.subVectors(g,c),l.subVectors(d,c),m.cross(l),s[e]=m.x,s[e+1]=m.y,s[e+2]=m.z,s[e+3]=m.x,s[e+4]=m.y,s[e+5]=m.z,s[e+6]=m.x,s[e+7]=m.y,s[e+8]=m.z;this.normalizeNormals(),a.normal.needsUpdate=!0}},merge:function(t,r){if(t&&t.isBufferGeometry){void 0===r&&(r=0);var a=this.attributes,o;for(o in a)if(void 0!==t.attributes[o])for(var i=a[o].array,e=t.attributes[o],n=e.array,s=0,e=e.itemSize*r;s<n.length;s++,e++)i[e]=n[s];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t)},normalizeNormals:function(){var e=new _;return function(){for(var t=this.attributes.normal,r=0,a=t.count;r<a;r++)e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.normalize(),t.setXYZ(r,e.x,e.y,e.z)}}(),toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new St,r=this.index.array,a=this.attributes,o;for(o in a){for(var i=a[o],e=i.array,i=i.itemSize,s=new e.constructor(r.length*i),p=0,d=0,c=r.length,l;d<c;d++){l=r[d]*i;for(var m=0;m<i;m++)s[p++]=e[l++]}t.addAttribute(o,new ft(s,i))}return t},toJSON:function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var r=this.parameters;for(var a in r)void 0!==r[a]&&(t[a]=r[a]);return t}t.data={attributes:{}};var o=this.index;for(a in null!==o&&(r=Array.prototype.slice.call(o.array),t.data.index={type:o.array.constructor.name,array:r}),o=this.attributes,o){var i=o[a];r=Array.prototype.slice.call(i.array),t.data.attributes[a]={itemSize:i.itemSize,type:i.array.constructor.name,array:r,normalized:i.normalized}}return a=this.groups,0<a.length&&(t.data.groups=JSON.parse(JSON.stringify(a))),a=this.boundingSphere,null!==a&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t},clone:function(){return new St().copy(this)},copy:function(t){var r;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingSphere=this.boundingBox=null,this.name=t.name;var a=t.index;for(n in null!==a&&this.setIndex(a.clone()),a=t.attributes,a)this.addAttribute(n,a[n].clone());var o=t.morphAttributes;for(n in o){var i=[],e=o[n];for(a=0,r=e.length;a<r;a++)i.push(e[a].clone());this.morphAttributes[n]=i}var n=t.groups;for(a=0,r=n.length;a<r;a++)o=n[a],this.addGroup(o.start,o.count,o.materialIndex);return n=t.boundingBox,null!==n&&(this.boundingBox=n.clone()),n=t.boundingSphere,null!==n&&(this.boundingSphere=n.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Mt.prototype=Object.create(gt.prototype),Mt.prototype.constructor=Mt,At.prototype=Object.create(St.prototype),At.prototype.constructor=At,wt.prototype=Object.create(gt.prototype),wt.prototype.constructor=wt,Rt.prototype=Object.create(St.prototype),Rt.prototype.constructor=Rt,Lt.prototype=Object.create(et.prototype),Lt.prototype.constructor=Lt,Lt.prototype.isMeshBasicMaterial=!0,Lt.prototype.copy=function(e){return et.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},Ct.prototype=Object.create(et.prototype),Ct.prototype.constructor=Ct,Ct.prototype.isShaderMaterial=!0,Ct.prototype.copy=function(e){return et.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=K.clone(e.uniforms),this.defines=e.defines,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},Ct.prototype.toJSON=function(e){return e=et.prototype.toJSON.call(this,e),e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e},Object.assign(Pt.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return(t||new _).copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(){var e=new _;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){return t=t||new _,t.subVectors(e,this.origin),e=t.dot(this.direction),0>e?t.copy(this.origin):t.copy(this.direction).multiplyScalar(e).add(this.origin)},distanceToPoint:function(e){return pn(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new _;return function(t){var r=e.subVectors(t,this.origin).dot(this.direction);return 0>r?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(r).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:function(){var t=new _,a=new _,o=new _;return function(i,s,e,c){t.copy(i).add(s).multiplyScalar(.5),a.copy(s).sub(i).normalize(),o.copy(this.origin).sub(t);var u=.5*i.distanceTo(s),g=-this.direction.dot(a),f=o.dot(this.direction),m=-o.dot(a),y=o.lengthSq(),n=fn(1-g*g);if(0<n){i=g*m-f,s=g*f-m;var p=u*n;0<=i?s>=-p?s<=p?(u=1/n,i*=u,s*=u,g=i*(i+g*s+2*f)+s*(g*i+s+2*m)+y):(s=u,i=mn(0,-(g*s+f)),g=-i*i+s*(s+2*m)+y):(s=-u,i=mn(0,-(g*s+f)),g=-i*i+s*(s+2*m)+y):s<=-p?(i=mn(0,-(-g*u+f)),s=0<i?-u:un(mn(-u,-m),u),g=-i*i+s*(s+2*m)+y):s<=p?(i=0,s=un(mn(-u,-m),u),g=s*(s+2*m)+y):(i=mn(0,-(g*u+f)),s=0<i?u:un(mn(-u,-m),u),g=-i*i+s*(s+2*m)+y)}else s=0<g?-u:u,i=mn(0,-(g*s+f)),g=-i*i+s*(s+2*m)+y;return e&&e.copy(this.direction).multiplyScalar(i).add(this.origin),c&&c.copy(a).multiplyScalar(s).add(t),g}}(),intersectSphere:function(){var t=new _;return function(r,a){t.subVectors(r.center,this.origin);var o=t.dot(this.direction),i=t.dot(t)-o*o;return(r=r.radius*r.radius,i>r)?null:(r=pn(r-i),i=o-r,o+=r,0>i&&0>o?null:0>i?this.at(o,a):this.at(i,a))}}(),intersectsSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);return 0===t?0===e.distanceToPoint(this.origin)?0:null:(e=-(this.origin.dot(e.normal)+e.constant)/t,0<=e?e:null)},intersectPlane:function(e,t){return e=this.distanceToPlane(e),null===e?null:this.at(e,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||0>e.normal.dot(this.direction)*t},intersectBox:function(t,r){var a=1/this.direction.x,o=1/this.direction.y,i=1/this.direction.z,e=this.origin;if(0<=a){var n=(t.min.x-e.x)*a;a*=t.max.x-e.x}else n=(t.max.x-e.x)*a,a*=t.min.x-e.x;if(0<=o){var s=(t.min.y-e.y)*o;o*=t.max.y-e.y}else s=(t.max.y-e.y)*o,o*=t.min.y-e.y;return n>o||s>a?null:((s>n||n!==n)&&(n=s),(o<a||a!==a)&&(a=o),0<=i?(s=(t.min.z-e.z)*i,t=(t.max.z-e.z)*i):(s=(t.max.z-e.z)*i,t=(t.min.z-e.z)*i),n>t||s>a)?null:((s>n||n!==n)&&(n=s),(t<a||a!==a)&&(a=t),0>a?null:this.at(0<=n?n:a,r))},intersectsBox:function(){var e=new _;return function(t){return null!==this.intersectBox(t,e)}}(),intersectTriangle:function(){var t=new _,r=new _,a=new _,o=new _;return function(i,e,n,s,l){if(r.subVectors(e,i),a.subVectors(n,i),o.crossVectors(r,a),e=this.direction.dot(o),0<e){if(s)return null;s=1}else if(0>e)s=-1,e=-e;else return null;return(t.subVectors(this.origin,i),i=s*this.direction.dot(a.crossVectors(t,a)),0>i)?null:(n=s*this.direction.dot(r.cross(t)),0>n||i+n>e)?null:(i=-s*t.dot(o),0>i?null:this.at(i/e,l))}}(),applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}),Object.assign(It.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return(e||new _).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return(e||new _).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return t=t||new _,this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new _,t=new _;return function(r,a){return e.subVectors(r,this.start),t.subVectors(this.end,this.start),r=t.dot(t),r=t.dot(e)/r,a&&(r=yn.clamp(r,0,1)),r}}(),closestPointToPoint:function(e,t,r){return e=this.closestPointToPointParameter(e,t),r=r||new _,this.delta(r).multiplyScalar(e).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),Object.assign(Nt,{normal:function(){var t=new _;return function(r,a,o,i){return i=i||new _,i.subVectors(o,a),t.subVectors(r,a),i.cross(t),r=i.lengthSq(),0<r?i.multiplyScalar(1/pn(r)):i.set(0,0,0)}}(),barycoordFromPoint:function(){var t=new _,r=new _,a=new _;return function(o,i,e,n,s){t.subVectors(n,i),r.subVectors(e,i),a.subVectors(o,i),o=t.dot(t),i=t.dot(r),e=t.dot(a);var l=r.dot(r);n=r.dot(a);var p=o*l-i*i;return(s=s||new _,0===p)?s.set(-2,-1,-1):(p=1/p,l=(l*e-i*n)*p,o=(o*n-i*e)*p,s.set(1-l-o,o,l))}}(),containsPoint:function(){var t=new _;return function(r,a,o,i){return r=Nt.barycoordFromPoint(r,a,o,i,t),0<=r.x&&0<=r.y&&1>=r.x+r.y}}()}),Object.assign(Nt.prototype,{set:function(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this},setFromPointsAndIndices:function(e,t,r,a){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[a]),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new _,t=new _;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),midpoint:function(e){return(e||new _).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return Nt.normal(this.a,this.b,this.c,e)},plane:function(e){return(e||new it).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return Nt.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return Nt.containsPoint(e,this.a,this.b,this.c)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(){var t=new it,r=[new It,new It,new It],a=new _,o=new _;return function(i,e){e=e||new _;var n=Infinity;if(t.setFromCoplanarPoints(this.a,this.b,this.c),t.projectPoint(i,a),!0===this.containsPoint(a))e.copy(a);else for(r[0].set(this.a,this.b),r[1].set(this.b,this.c),r[2].set(this.c,this.a),i=0;i<r.length;i++){r[i].closestPointToPoint(a,!0,o);var s=a.distanceToSquared(o);s<n&&(n=s,e.copy(o))}return e}}(),equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}),Ut.prototype=Object.assign(Object.create(dt.prototype),{constructor:Ut,isMesh:!0,setDrawMode:function(e){this.drawMode=e},copy:function(e){return dt.prototype.copy.call(this,e),this.drawMode=e.drawMode,void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e=this.geometry;if(e.isBufferGeometry){e=e.morphAttributes;var t=Object.keys(e);if(0<t.length){var r=e[t[0]];if(void 0!==r)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=r.length;e<t;e++){var a=r[e].name||e+"";this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=e}}}else if(r=e.morphTargets,void 0!==r&&0<r.length)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=r.length;e<t;e++)a=r[e].name||e+"",this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=e},raycast:function(){function s(t,r,o,i,s,e,l){return Nt.barycoordFromPoint(t,r,o,i,n),s.multiplyScalar(n.x),e.multiplyScalar(n.y),l.multiplyScalar(n.z),s.add(e).add(l),s.clone()}function a(t,r,o,i,n,e,s,l){return null===(1===r.side?i.intersectTriangle(s,e,n,!0,l):i.intersectTriangle(n,e,s,2!==r.side,l))?null:(u.copy(l),u.applyMatrix4(t.matrixWorld),r=o.ray.origin.distanceTo(u),r<o.near||r>o.far?null:{distance:r,point:u.clone(),object:t})}function y(o,i,d,e,u,m,l,n){return t.fromBufferAttribute(e,m),g.fromBufferAttribute(e,l),h.fromBufferAttribute(e,n),(o=a(o,o.material,i,d,t,g,h,T))&&(u&&(b.fromBufferAttribute(u,m),v.fromBufferAttribute(u,l),r.fromBufferAttribute(u,n),o.uv=s(T,t,g,h,b,v,r)),o.face=new ut(m,l,n,Nt.normal(t,g,h)),o.faceIndex=m),o}var c=new i,d=new Pt,e=new ot,t=new _,g=new _,h=new _,p=new _,m=new _,l=new _,b=new o,v=new o,r=new o,n=new _,T=new _,u=new _;return function(o,i){var n=this.geometry,u=this.material,f=this.matrixWorld;if(void 0!==u&&(null===n.boundingSphere&&n.computeBoundingSphere(),e.copy(n.boundingSphere),e.applyMatrix4(f),!1!==o.ray.intersectsSphere(e)&&(c.getInverse(f),d.copy(o.ray).applyMatrix4(c),null===n.boundingBox||!1!==d.intersectsBox(n.boundingBox)))){var x;if(n.isBufferGeometry){var u=n.index,_=n.attributes.position,f=n.attributes.uv,A;if(null!==u){var w=0;for(A=u.count;w<A;w+=3){n=u.getX(w);var R=u.getX(w+1),E=u.getX(w+2);(x=y(this,o,d,_,f,n,R,E))&&(x.faceIndex=hn(w/3),i.push(x))}}else if(void 0!==_)for(w=0,A=_.count;w<A;w+=3)(n=w,R=w+1,E=w+2,x=y(this,o,d,_,f,n,R,E))&&(x.index=n,i.push(x))}else if(n.isGeometry){var f=Array.isArray(u);w=n.vertices,A=n.faces,R=n.faceVertexUvs[0],0<R.length&&(_=R);for(var C=0,I=A.length,D;C<I;C++)if(D=A[C],x=f?u[D.materialIndex]:u,void 0!==x){R=w[D.a],E=w[D.b];var M=w[D.c];if(!0===x.morphTargets){var P=n.morphTargets,B=this.morphTargetInfluences;t.set(0,0,0),g.set(0,0,0),h.set(0,0,0);for(var L=0,N=P.length,F;L<N;L++)if(F=B[L],0!==F){var S=P[L].vertices;t.addScaledVector(p.subVectors(S[D.a],R),F),g.addScaledVector(m.subVectors(S[D.b],E),F),h.addScaledVector(l.subVectors(S[D.c],M),F)}t.add(R),g.add(E),h.add(M),R=t,E=g,M=h}(x=a(this,x,o,d,R,E,M,T))&&(_&&_[C]&&(P=_[C],b.copy(P[0]),v.copy(P[1]),r.copy(P[2]),x.uv=s(T,R,E,M,b,v,r)),x.face=D,x.faceIndex=C,i.push(x))}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Mn=0;lr.prototype=Object.assign(Object.create(ct.prototype),{constructor:lr,isPerspectiveCamera:!0,copy:function(e,t){return ct.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){e=.5*this.getFilmHeight()/e,this.fov=2*yn.RAD2DEG*Qi(e),this.updateProjectionMatrix()},getFocalLength:function(){var e=Ce(.5*yn.DEG2RAD*this.fov);return .5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*yn.RAD2DEG*Qi(Ce(.5*yn.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*un(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/mn(this.aspect,1)},setViewOffset:function(t,r,a,o,i,e){this.aspect=t/r,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=r,this.view.offsetX=a,this.view.offsetY=o,this.view.width=i,this.view.height=e,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=this.near,r=t*Ce(.5*yn.DEG2RAD*this.fov)/this.zoom,a=2*r,o=this.aspect*a,i=-.5*o,e=this.view;if(null!==this.view&&this.view.enabled)var n=e.fullWidth,s=e.fullHeight,i=i+e.offsetX*o/n,r=r-e.offsetY*a/s,o=e.width/n*o,a=e.height/s*a;e=this.filmOffset,0!==e&&(i+=t*e/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+o,r,r-a,t,this.far)},toJSON:function(e){return e=dt.prototype.toJSON.call(this,e),e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}),pr.prototype=Object.assign(Object.create(lr.prototype),{constructor:pr,isArrayCamera:!0}),be.prototype.isFogExp2=!0,be.prototype.clone=function(){return new be(this.color.getHex(),this.density)},be.prototype.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}},ur.prototype.isFog=!0,ur.prototype.clone=function(){return new ur(this.color.getHex(),this.near,this.far)},ur.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},gr.prototype=Object.assign(Object.create(dt.prototype),{constructor:gr,copy:function(e,t){return dt.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=dt.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}),fr.prototype=Object.create(et.prototype),fr.prototype.constructor=fr,fr.prototype.isSpriteMaterial=!0,fr.prototype.copy=function(e){return et.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this},hr.prototype=Object.assign(Object.create(dt.prototype),{constructor:hr,isSprite:!0,raycast:function(){var t=new _,r=new _,a=new _;return function(o,i){r.setFromMatrixPosition(this.matrixWorld),o.ray.closestPointToPoint(r,t),a.setFromMatrixScale(this.matrixWorld);var e=a.x*a.y/4;r.distanceToSquared(t)>e||(e=o.ray.origin.distanceTo(t),e<o.near||e>o.far||i.push({distance:e,point:t.clone(),face:null,object:this}))}}(),clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return dt.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this}}),yr.prototype=Object.assign(Object.create(dt.prototype),{constructor:yr,copy:function(e){dt.prototype.copy.call(this,e,!1),e=e.levels;for(var t=0,r=e.length,a;t<r;t++)a=e[t],this.addLevel(a.object.clone(),a.distance);return this},addLevel:function(e,t){void 0===t&&(t=0),t=fn(t);for(var r=this.levels,o=0;o<r.length&&!(t<r[o].distance);o++);r.splice(o,0,{distance:t,object:e}),this.add(e)},getObjectForDistance:function(e){for(var t=this.levels,r=1,a=t.length;r<a&&!(e<t[r].distance);r++);return t[r-1].object},raycast:function(){var e=new _;return function(t,r){e.setFromMatrixPosition(this.matrixWorld);var a=t.ray.origin.distanceTo(e);this.getObjectForDistance(a).raycast(t,r)}}(),update:function(){var t=new _,r=new _;return function(a){var o=this.levels;if(1<o.length){t.setFromMatrixPosition(a.matrixWorld),r.setFromMatrixPosition(this.matrixWorld),a=t.distanceTo(r),o[0].object.visible=!0;for(var i=1,e=o.length;i<e&&a>=o[i].distance;i++)o[i-1].object.visible=!1,o[i].object.visible=!0;for(;i<e;i++)o[i].object.visible=!1}}}(),toJSON:function(t){t=dt.prototype.toJSON.call(this,t),t.object.levels=[];for(var r=this.levels,a=0,o=r.length,i;a<o;a++)i=r[a],t.object.levels.push({object:i.object.uuid,distance:i.distance});return t}}),Object.assign(xr.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length,r;e<t;e++)r=new i,this.bones[e]&&r.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(r)},pose:function(){var e=0,t,r;for(r=this.bones.length;e<r;e++)(t=this.bones[e])&&t.matrixWorld.getInverse(this.boneInverses[e]);for(e=0,r=this.bones.length;e<r;e++)(t=this.bones[e])&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:function(){var t=new i,r=new i;return function(){for(var a=this.bones,o=this.boneInverses,i=this.boneMatrices,e=this.boneTexture,n=0,s=a.length;n<s;n++)t.multiplyMatrices(a[n]?a[n].matrixWorld:r,o[n]),t.toArray(i,16*n);void 0!==e&&(e.needsUpdate=!0)}}(),clone:function(){return new xr(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,r=this.bones.length,a;t<r;t++)if(a=this.bones[t],a.name===e)return a}}),vr.prototype=Object.assign(Object.create(dt.prototype),{constructor:vr,isBone:!0}),_r.prototype=Object.assign(Object.create(Ut.prototype),{constructor:_r,isSkinnedMesh:!0,initBones:function(){var t=[],r;if(this.geometry&&void 0!==this.geometry.bones){var a=0;for(r=this.geometry.bones.length;a<r;a++){var o=this.geometry.bones[a],i=new vr;t.push(i),i.name=o.name,i.position.fromArray(o.pos),i.quaternion.fromArray(o.rotq),void 0!==o.scl&&i.scale.fromArray(o.scl)}for(a=0,r=this.geometry.bones.length;a<r;a++)o=this.geometry.bones[a],-1!==o.parent&&null!==o.parent&&void 0!==t[o.parent]?t[o.parent].add(t[a]):this.add(t[a])}return this.updateMatrixWorld(!0),t},bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){var e;if(this.geometry&&this.geometry.isGeometry)for(e=0;e<this.geometry.skinWeights.length;e++){var t=this.geometry.skinWeights[e],r=1/t.manhattanLength();Infinity===r?t.set(1,0,0,0):t.multiplyScalar(r)}else if(this.geometry&&this.geometry.isBufferGeometry){var t=new j,a=this.geometry.attributes.skinWeight;for(e=0;e<a.count;e++)t.x=a.getX(e),t.y=a.getY(e),t.z=a.getZ(e),t.w=a.getW(e),r=1/t.manhattanLength(),Infinity===r?t.set(1,0,0,0):t.multiplyScalar(r),a.setXYZW(e,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(e){Ut.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),br.prototype=Object.create(et.prototype),br.prototype.constructor=br,br.prototype.isLineBasicMaterial=!0,br.prototype.copy=function(e){return et.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this},Er.prototype=Object.assign(Object.create(dt.prototype),{constructor:Er,isLine:!0,raycast:function(){var t=new i,a=new Pt,o=new ot;return function(i,s){var e=i.linePrecision,e=e*e,p=this.geometry,d=this.matrixWorld;if(null===p.boundingSphere&&p.computeBoundingSphere(),o.copy(p.boundingSphere),o.applyMatrix4(d),!1!==i.ray.intersectsSphere(o)){t.getInverse(d),a.copy(i.ray).applyMatrix4(t);var c=new _,f=new _,d=new _,m=new _,l=this&&this.isLineSegments?2:1;if(p.isBufferGeometry){var n=p.index,h=p.attributes.position.array;if(null!==n)for(var r=n.array,p=0,y=r.length-1;p<y;p+=l)n=r[p+1],c.fromArray(h,3*r[p]),f.fromArray(h,3*n),n=a.distanceSqToSegment(c,f,m,d),n>e||(m.applyMatrix4(this.matrixWorld),n=i.ray.origin.distanceTo(m),n<i.near||n>i.far||s.push({distance:n,point:d.clone().applyMatrix4(this.matrixWorld),index:p,face:null,faceIndex:null,object:this}));else for(p=0,y=h.length/3-1;p<y;p+=l)c.fromArray(h,3*p),f.fromArray(h,3*p+3),n=a.distanceSqToSegment(c,f,m,d),n>e||(m.applyMatrix4(this.matrixWorld),n=i.ray.origin.distanceTo(m),n<i.near||n>i.far||s.push({distance:n,point:d.clone().applyMatrix4(this.matrixWorld),index:p,face:null,faceIndex:null,object:this}))}else if(p.isGeometry)for(c=p.vertices,f=c.length,p=0;p<f-1;p+=l)n=a.distanceSqToSegment(c[p],c[p+1],m,d),n>e||(m.applyMatrix4(this.matrixWorld),n=i.ray.origin.distanceTo(m),n<i.near||n>i.far||s.push({distance:n,point:d.clone().applyMatrix4(this.matrixWorld),index:p,face:null,faceIndex:null,object:this}))}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Tr.prototype=Object.assign(Object.create(Er.prototype),{constructor:Tr,isLineSegments:!0}),Sr.prototype=Object.assign(Object.create(Er.prototype),{constructor:Sr,isLineLoop:!0}),Mr.prototype=Object.create(et.prototype),Mr.prototype.constructor=Mr,Mr.prototype.isPointsMaterial=!0,Mr.prototype.copy=function(e){return et.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this},Ar.prototype=Object.assign(Object.create(dt.prototype),{constructor:Ar,isPoints:!0,raycast:function(){var e=new i,t=new Pt,a=new ot;return function(o,i){function s(e,r){var a=t.distanceSqToPoint(e);if(a<m){e=t.closestPointToPoint(e),e.applyMatrix4(u);var n=o.ray.origin.distanceTo(e);n<o.near||n>o.far||i.push({distance:n,distanceToRay:pn(a),point:e.clone(),index:r,face:null,object:p})}}var p=this,d=this.geometry,u=this.matrixWorld,c=o.params.Points.threshold;if(null===d.boundingSphere&&d.computeBoundingSphere(),a.copy(d.boundingSphere),a.applyMatrix4(u),a.radius+=c,!1!==o.ray.intersectsSphere(a)){e.getInverse(u),t.copy(o.ray).applyMatrix4(e);var c=c/((this.scale.x+this.scale.y+this.scale.z)/3),m=c*c,c=new _;if(d.isBufferGeometry){var l=d.index,d=d.attributes.position.array;if(null!==l)for(var n=l.array,l=0,f=n.length,r;l<f;l++)r=n[l],c.fromArray(d,3*r),s(c,r);else for(l=0,n=d.length/3;l<n;l++)c.fromArray(d,3*l),s(c,l)}else for(c=d.vertices,l=0,n=c.length;l<n;l++)s(c[l],l)}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),wr.prototype=Object.assign(Object.create(dt.prototype),{constructor:wr,isGroup:!0}),Rr.prototype=Object.assign(Object.create(r.prototype),{constructor:Rr,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),Lr.prototype=Object.create(r.prototype),Lr.prototype.constructor=Lr,Lr.prototype.isCompressedTexture=!0,Cr.prototype=Object.create(r.prototype),Cr.prototype.constructor=Cr,Cr.prototype.isDepthTexture=!0,Pr.prototype=Object.create(St.prototype),Pr.prototype.constructor=Pr,Ir.prototype=Object.create(gt.prototype),Ir.prototype.constructor=Ir,Nr.prototype=Object.create(St.prototype),Nr.prototype.constructor=Nr,Ur.prototype=Object.create(gt.prototype),Ur.prototype.constructor=Ur,Dr.prototype=Object.create(St.prototype),Dr.prototype.constructor=Dr,Br.prototype=Object.create(gt.prototype),Br.prototype.constructor=Br,Fr.prototype=Object.create(Dr.prototype),Fr.prototype.constructor=Fr,zr.prototype=Object.create(gt.prototype),zr.prototype.constructor=zr,Gr.prototype=Object.create(Dr.prototype),Gr.prototype.constructor=Gr,Or.prototype=Object.create(gt.prototype),Or.prototype.constructor=Or,Hr.prototype=Object.create(Dr.prototype),Hr.prototype.constructor=Hr,Vr.prototype=Object.create(gt.prototype),Vr.prototype.constructor=Vr,kr.prototype=Object.create(Dr.prototype),kr.prototype.constructor=kr,Wr.prototype=Object.create(gt.prototype),Wr.prototype.constructor=Wr,jr.prototype=Object.create(St.prototype),jr.prototype.constructor=jr,Xr.prototype=Object.create(gt.prototype),Xr.prototype.constructor=Xr,Yr.prototype=Object.create(St.prototype),Yr.prototype.constructor=Yr,qr.prototype=Object.create(gt.prototype),qr.prototype.constructor=qr,Zr.prototype=Object.create(St.prototype),Zr.prototype.constructor=Zr;var An={triangulate:function(t,a,o){o=o||2;var i=a&&a.length,s=i?a[0]*o:t.length,e=Jr(t,0,s,o,!0),d=[];if(!e)return d;var c;if(i){var u=o,i=[],g=0,l;for(l=a.length;g<l;g++){var m=a[g]*u,n=g<l-1?a[g+1]*u:t.length;m=Jr(t,m,n,u,!1),m===m.next&&(m.steiner=!0),i.push(de(m))}for(i.sort(Kr),g=0;g<i.length;g++)a=i[g],u=e,(u=$r(a,u))&&(a=ga(u,a),$e(a,a.next)),e=$e(e,e.next)}if(t.length>80*o){var p=c=t[0],r=i=t[1];for(u=o;u<s;u+=o)g=t[u],a=t[u+1],g<p&&(p=g),a<r&&(r=a),g>c&&(c=g),a>i&&(i=a);c=mn(c-p,i-r),c=0===c?0:1/c}return Qr(e,d,o,p,r,c),d}},wn={area:function(t){for(var r=t.length,a=0,o=r-1,i=0;i<r;o=i++)a+=t[o].x*t[i].y-t[i].x*t[o].y;return .5*a},isClockWise:function(e){return 0>wn.area(e)},triangulateShape:function(t,r){var a=[],o=[],i=[];ee(t),ba(a,t);var e=t.length;for(r.forEach(ee),t=0;t<r.length;t++)o.push(e),e+=r[t].length,ba(a,r[t]);for(r=An.triangulate(a,o),t=0;t<r.length;t+=3)i.push(r.slice(t,t+3));return i}};Ea.prototype=Object.create(gt.prototype),Ea.prototype.constructor=Ea,wa.prototype=Object.create(St.prototype),wa.prototype.constructor=wa,wa.prototype.getArrays=function(){var e=this.getAttribute("position"),e=e?Array.prototype.slice.call(e.array):[],t=this.getAttribute("uv"),t=t?Array.prototype.slice.call(t.array):[],r=this.index,r=r?Array.prototype.slice.call(r.array):[];return{position:e,uv:t,index:r}},wa.prototype.addShapeList=function(e,t){var r=e.length;t.arrays=this.getArrays();for(var a=0;a<r;a++)this.addShape(e[a],t);this.setIndex(t.arrays.index),this.addAttribute("position",new Et(t.arrays.position,3)),this.addAttribute("uv",new Et(t.arrays.uv,2))},wa.prototype.addShape=function(t,i){function a(e,t,r){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(r).add(e)}function s(t,r,a){var i=t.x-r.x,n=t.y-r.y,s=a.x-t.x,l=a.y-t.y,p=i*i+n*n;if(fn(i*l-n*s)>an){var c=pn(p),u=pn(s*s+l*l),p=r.x-n/c;if(r=r.y+i/c,l=((a.x-l/u-p)*l-(a.y+s/u-r)*s)/(i*l-n*s),s=p+i*l-t.x,i=r+n*l-t.y,n=s*s+i*i,2>=n)return new o(s,i);n=pn(n/2)}else t=!1,i>an?s>an&&(t=!0):i<-an?s<-an&&(t=!0):tn(n)===tn(l)&&(t=!0),t?(s=-n,n=pn(p)):(s=i,i=n,n=pn(p/2));return new o(s/n,i/n)}function p(t,r){for(H=t.length;0<=--H;){var a=H,o=H-1;0>o&&(o=t.length-1);var i=w+2*u,s;for(s=0;s<i;s++){var l=G*s,d=G*(s+1),c=r+o+l,n=r+o+d,d=r+a+d;f(r+a+l),f(c),f(d),f(c),f(n),f(d),l=R.length/3,l=A.generateSideWallUV(N,R,l-6,l-3,l-2,l-1),h(l[0]),h(l[1]),h(l[3]),h(l[1]),h(l[2]),h(l[3])}}}function e(e,t,r){m.push(e),m.push(t),m.push(r)}function d(e,t,r){f(e),f(t),f(r),e=R.length/3,e=A.generateTopUV(N,R,e-3,e-2,e-1),h(e[0]),h(e[1]),h(e[2])}function f(e){l.push(R.length/3),R.push(m[3*e+0]),R.push(m[3*e+1]),R.push(m[3*e+2])}function h(e){n.push(e.x),n.push(e.y)}var c=i.arrays?i.arrays:this.getArrays(),R=c.position,l=c.index,n=c.uv,m=[],c=void 0===i.amount?100:i.amount,r=void 0===i.bevelThickness?6:i.bevelThickness,g=void 0===i.bevelSize?r-2:i.bevelSize,u=void 0===i.bevelSegments?3:i.bevelSegments,v=!(void 0!==i.bevelEnabled)||i.bevelEnabled,x=void 0===i.curveSegments?12:i.curveSegments,w=void 0===i.steps?1:i.steps,b=i.extrudePath,y=!1,A=void 0===i.UVGenerator?Ea.WorldUVGenerator:i.UVGenerator;if(b){var E=b.getSpacedPoints(w);y=!0,v=!1;var C=void 0===i.frames?b.computeFrenetFrames(w,!1):i.frames,D=new _,B=new _,F=new _}v||(g=r=u=0);var N=this,x=t.extractPoints(x),S;t=x.shape;var L=x.holes;if(!wn.isClockWise(t)){t=t.reverse();var z=0;for(S=L.length;z<S;z++){var M=L[z];wn.isClockWise(M)&&(L[z]=M.reverse())}}var P=wn.triangulateShape(t,L),U=t;for(z=0,S=L.length;z<S;z++)M=L[z],t=t.concat(M);var G=t.length,O=P.length,x=[],H=0,I=U.length,k=I-1,W,T;for(W=H+1;H<I;H++,k++,W++)k===I&&(k=0),W===I&&(W=0),x[H]=s(U[H],U[k],U[W]);var b=[],V=x.concat();for(z=0,S=L.length;z<S;z++){M=L[z];var j=[];for(H=0,I=M.length,k=I-1,W=H+1;H<I;H++,k++,W++)k===I&&(k=0),W===I&&(W=0),j[H]=s(M[H],M[k],M[W]);b.push(j),V=V.concat(j)}for(k=0;k<u;k++){I=k/u;var X=r*gn(I*ln/2);for(W=g*on(I*ln/2),H=0,I=U.length;H<I;H++){var Y=a(U[H],x[H],W);e(Y.x,Y.y,-X)}for(z=0,S=L.length;z<S;z++)for(M=L[z],j=b[z],H=0,I=M.length;H<I;H++)Y=a(M[H],j[H],W),e(Y.x,Y.y,-X)}for(W=g,H=0;H<G;H++)Y=v?a(t[H],V[H],W):t[H],y?(B.copy(C.normals[0]).multiplyScalar(Y.x),D.copy(C.binormals[0]).multiplyScalar(Y.y),F.copy(E[0]).add(B).add(D),e(F.x,F.y,F.z)):e(Y.x,Y.y,0);for(I=1;I<=w;I++)for(H=0;H<G;H++)Y=v?a(t[H],V[H],W):t[H],y?(B.copy(C.normals[I]).multiplyScalar(Y.x),D.copy(C.binormals[I]).multiplyScalar(Y.y),F.copy(E[I]).add(B).add(D),e(F.x,F.y,F.z)):e(Y.x,Y.y,c/w*I);for(k=u-1;0<=k;k--){for(I=k/u,X=r*gn(I*ln/2),W=g*on(I*ln/2),H=0,I=U.length;H<I;H++)Y=a(U[H],x[H],W),e(Y.x,Y.y,c+X);for(z=0,S=L.length;z<S;z++)for(M=L[z],j=b[z],H=0,I=M.length;H<I;H++)Y=a(M[H],j[H],W),y?e(Y.x,Y.y+E[w-1].y,E[w-1].x+X):e(Y.x,Y.y,c+X)}(function(){var e=R.length/3;if(v){var t=0*G;for(H=0;H<O;H++)T=P[H],d(T[2]+t,T[1]+t,T[0]+t);for(t=G*(w+2*u),H=0;H<O;H++)T=P[H],d(T[0]+t,T[1]+t,T[2]+t)}else{for(H=0;H<O;H++)T=P[H],d(T[2],T[1],T[0]);for(H=0;H<O;H++)T=P[H],d(T[0]+G*w,T[1]+G*w,T[2]+G*w)}N.addGroup(e,R.length/3-e,void 0===i.material?0:i.material)})(),function(){var e=R.length/3,t=0;for(p(U,t),t+=U.length,z=0,S=L.length;z<S;z++)M=L[z],p(M,t),t+=M.length;N.addGroup(e,R.length/3-e,void 0===i.extrudeMaterial?1:i.extrudeMaterial)}(),i.arrays||(this.setIndex(l),this.addAttribute("position",new Et(R,3)),this.addAttribute("uv",new Et(n,2)))},Ea.WorldUVGenerator={generateTopUV:function(t,r,a,i,n){t=r[3*i],i=r[3*i+1];var e=r[3*n];return n=r[3*n+1],[new o(r[3*a],r[3*a+1]),new o(t,i),new o(e,n)]},generateSideWallUV:function(t,r,a,i,s,e){t=r[3*a];var d=r[3*a+1];a=r[3*a+2];var c=r[3*i],u=r[3*i+1];i=r[3*i+2];var g=r[3*s],m=r[3*s+1];s=r[3*s+2];var l=r[3*e],n=r[3*e+1];return r=r[3*e+2],.01>fn(d-u)?[new o(t,1-a),new o(c,1-i),new o(g,1-s),new o(l,1-r)]:[new o(d,1-a),new o(u,1-i),new o(m,1-s),new o(n,1-r)]}},Ra.prototype=Object.create(gt.prototype),Ra.prototype.constructor=Ra,Pa.prototype=Object.create(wa.prototype),Pa.prototype.constructor=Pa,Da.prototype=Object.create(gt.prototype),Da.prototype.constructor=Da,Oa.prototype=Object.create(St.prototype),Oa.prototype.constructor=Oa,Va.prototype=Object.create(gt.prototype),Va.prototype.constructor=Va,Wa.prototype=Object.create(St.prototype),Wa.prototype.constructor=Wa,Xa.prototype=Object.create(gt.prototype),Xa.prototype.constructor=Xa,qa.prototype=Object.create(St.prototype),qa.prototype.constructor=qa,eo.prototype=Object.create(gt.prototype),eo.prototype.constructor=eo,eo.prototype.toJSON=function(){var e=gt.prototype.toJSON.call(this);return ro(this.parameters.shapes,e)},to.prototype=Object.create(St.prototype),to.prototype.constructor=to,to.prototype.toJSON=function(){var e=St.prototype.toJSON.call(this);return ro(this.parameters.shapes,e)},ao.prototype=Object.create(St.prototype),ao.prototype.constructor=ao,oo.prototype=Object.create(gt.prototype),oo.prototype.constructor=oo,io.prototype=Object.create(St.prototype),io.prototype.constructor=io,no.prototype=Object.create(oo.prototype),no.prototype.constructor=no,so.prototype=Object.create(io.prototype),so.prototype.constructor=so,lo.prototype=Object.create(gt.prototype),lo.prototype.constructor=lo,po.prototype=Object.create(St.prototype),po.prototype.constructor=po;var Ya=Object.freeze({WireframeGeometry:Pr,ParametricGeometry:Ir,ParametricBufferGeometry:Nr,TetrahedronGeometry:Br,TetrahedronBufferGeometry:Fr,OctahedronGeometry:zr,OctahedronBufferGeometry:Gr,IcosahedronGeometry:Or,IcosahedronBufferGeometry:Hr,DodecahedronGeometry:Vr,DodecahedronBufferGeometry:kr,PolyhedronGeometry:Ur,PolyhedronBufferGeometry:Dr,TubeGeometry:Wr,TubeBufferGeometry:jr,TorusKnotGeometry:Xr,TorusKnotBufferGeometry:Yr,TorusGeometry:qr,TorusBufferGeometry:Zr,TextGeometry:Ra,TextBufferGeometry:Pa,SphereGeometry:Da,SphereBufferGeometry:Oa,RingGeometry:Va,RingBufferGeometry:Wa,PlaneGeometry:wt,PlaneBufferGeometry:Rt,LatheGeometry:Xa,LatheBufferGeometry:qa,ShapeGeometry:eo,ShapeBufferGeometry:to,ExtrudeGeometry:Ea,ExtrudeBufferGeometry:wa,EdgesGeometry:ao,ConeGeometry:no,ConeBufferGeometry:so,CylinderGeometry:oo,CylinderBufferGeometry:io,CircleGeometry:lo,CircleBufferGeometry:po,BoxGeometry:Mt,BoxBufferGeometry:At});co.prototype=Object.create(et.prototype),co.prototype.constructor=co,co.prototype.isShadowMaterial=!0,mo.prototype=Object.create(Ct.prototype),mo.prototype.constructor=mo,mo.prototype.isRawShaderMaterial=!0,uo.prototype=Object.create(et.prototype),uo.prototype.constructor=uo,uo.prototype.isMeshStandardMaterial=!0,uo.prototype.copy=function(e){return et.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},go.prototype=Object.create(uo.prototype),go.prototype.constructor=go,go.prototype.isMeshPhysicalMaterial=!0,go.prototype.copy=function(e){return uo.prototype.copy.call(this,e),this.defines={PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearCoat=e.clearCoat,this.clearCoatRoughness=e.clearCoatRoughness,this},fo.prototype=Object.create(et.prototype),fo.prototype.constructor=fo,fo.prototype.isMeshPhongMaterial=!0,fo.prototype.copy=function(e){return et.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},ho.prototype=Object.create(fo.prototype),ho.prototype.constructor=ho,ho.prototype.isMeshToonMaterial=!0,ho.prototype.copy=function(e){return fo.prototype.copy.call(this,e),this.gradientMap=e.gradientMap,this},yo.prototype=Object.create(et.prototype),yo.prototype.constructor=yo,yo.prototype.isMeshNormalMaterial=!0,yo.prototype.copy=function(e){return et.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},xo.prototype=Object.create(et.prototype),xo.prototype.constructor=xo,xo.prototype.isMeshLambertMaterial=!0,xo.prototype.copy=function(e){return et.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},vo.prototype=Object.create(br.prototype),vo.prototype.constructor=vo,vo.prototype.isLineDashedMaterial=!0,vo.prototype.copy=function(e){return br.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var za=Object.freeze({ShadowMaterial:co,SpriteMaterial:fr,RawShaderMaterial:mo,ShaderMaterial:Ct,PointsMaterial:Mr,MeshPhysicalMaterial:go,MeshStandardMaterial:uo,MeshPhongMaterial:fo,MeshToonMaterial:ho,MeshNormalMaterial:yo,MeshLambertMaterial:xo,MeshDepthMaterial:tt,MeshDistanceMaterial:rt,MeshBasicMaterial:Lt,LineDashedMaterial:vo,LineBasicMaterial:br,Material:et}),Rn={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},Ln=new _o,ua={};Object.assign(fe.prototype,{load:function(t,r,a,o){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,e=Rn.get(t);if(void 0!==e)return i.manager.itemStart(t),setTimeout(function(){r&&r(e),i.manager.itemEnd(t)},0),e;if(void 0!==ua[t])ua[t].push({onLoad:r,onProgress:a,onError:o});else{var s=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(s){a=s[1];var p=!!s[2],s=s[3],s=window.decodeURIComponent(s);p&&(s=window.atob(s));try{var u=(this.responseType||"").toLowerCase();switch(u){case"arraybuffer":case"blob":for(var g=new Uint8Array(s.length),p=0;p<s.length;p++)g[p]=s.charCodeAt(p);var m="blob"===u?new Blob([g.buffer],{type:a}):g.buffer;break;case"document":m=new DOMParser().parseFromString(s,a);break;case"json":m=JSON.parse(s);break;default:m=s;}window.setTimeout(function(){r&&r(m),i.manager.itemEnd(t)},0)}catch(e){window.setTimeout(function(){o&&o(e),i.manager.itemEnd(t),i.manager.itemError(t)},0)}}else{ua[t]=[],ua[t].push({onLoad:r,onProgress:a,onError:o});var l=new XMLHttpRequest;for(p in l.open("GET",t,!0),l.addEventListener("load",function(e){var r=this.response;Rn.add(t,r);var a=ua[t];if(delete ua[t],200===this.status){for(var o=0,n=a.length,s;o<n;o++)s=a[o],s.onLoad&&s.onLoad(r);i.manager.itemEnd(t)}else if(0===this.status){for(console.warn("THREE.FileLoader: HTTP Status 0 received."),o=0,n=a.length;o<n;o++)(s=a[o],s.onLoad)&&s.onLoad(r);i.manager.itemEnd(t)}else{for(o=0,n=a.length;o<n;o++)(s=a[o],s.onError)&&s.onError(e);i.manager.itemEnd(t),i.manager.itemError(t)}},!1),l.addEventListener("progress",function(r){for(var a=ua[t],o=0,i=a.length,e;o<i;o++)e=a[o],e.onProgress&&e.onProgress(r)},!1),l.addEventListener("error",function(e){var r=ua[t];delete ua[t];for(var a=0,o=r.length,n;a<o;a++)n=r[a],n.onError&&n.onError(e);i.manager.itemEnd(t),i.manager.itemError(t)},!1),void 0!==this.responseType&&(l.responseType=this.responseType),void 0!==this.withCredentials&&(l.withCredentials=this.withCredentials),l.overrideMimeType&&l.overrideMimeType(void 0===this.mimeType?"text/plain":this.mimeType),this.requestHeader)l.setRequestHeader(p,this.requestHeader[p]);l.send(null)}return i.manager.itemStart(t),l}},setPath:function(e){return this.path=e,this},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),Object.assign(Ia.prototype,{load:function(t,r,a,o){function i(i){c.load(t[i],function(e){e=s._parser(e,!0),p[i]={width:e.width,height:e.height,format:e.format,mipmaps:e.mipmaps},d+=1,6===d&&(1===e.mipmapCount&&(u.minFilter=1006),u.format=e.format,u.needsUpdate=!0,r&&r(u))},a,o)}var s=this,p=[],u=new Lr,d;u.image=p;var c=new fe(this.manager);if(c.setPath(this.path),c.setResponseType("arraybuffer"),Array.isArray(t))for(var e=d=0,l=t.length;e<l;++e)i(e);else c.load(t,function(t){if(t=s._parser(t,!0),t.isCubemap)for(var a=t.mipmaps.length/t.mipmapCount,o=0;o<a;o++){p[o]={mipmaps:[]};for(var i=0;i<t.mipmapCount;i++)p[o].mipmaps.push(t.mipmaps[o*t.mipmapCount+i]),p[o].format=t.format,p[o].width=t.width,p[o].height=t.height}else u.image.width=t.width,u.image.height=t.height,u.mipmaps=t.mipmaps;1===t.mipmapCount&&(u.minFilter=1006),u.format=t.format,u.needsUpdate=!0,r&&r(u)},a,o);return u},setPath:function(e){return this.path=e,this}}),Object.assign(bo.prototype,{load:function(t,r,a,o){var i=this,e=new l,n=new fe(this.manager);return n.setResponseType("arraybuffer"),n.load(t,function(t){(t=i._parser(t))&&(void 0===t.image?void 0!==t.data&&(e.image.width=t.width,e.image.height=t.height,e.image.data=t.data):e.image=t.image,e.wrapS=void 0===t.wrapS?1001:t.wrapS,e.wrapT=void 0===t.wrapT?1001:t.wrapT,e.magFilter=void 0===t.magFilter?1006:t.magFilter,e.minFilter=void 0===t.minFilter?1008:t.minFilter,e.anisotropy=void 0===t.anisotropy?1:t.anisotropy,void 0!==t.format&&(e.format=t.format),void 0!==t.type&&(e.type=t.type),void 0!==t.mipmaps&&(e.mipmaps=t.mipmaps),1===t.mipmapCount&&(e.minFilter=1006),e.needsUpdate=!0,r&&r(e,t))},a,o),e}}),Object.assign(ge.prototype,{crossOrigin:"Anonymous",load:function(t,r,a,o){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,e=Rn.get(t);return void 0===e?(a=document.createElementNS("http://www.w3.org/1999/xhtml","img"),a.addEventListener("load",function(){Rn.add(t,this),r&&r(this),i.manager.itemEnd(t)},!1),a.addEventListener("error",function(e){o&&o(e),i.manager.itemEnd(t),i.manager.itemError(t)},!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),i.manager.itemStart(t),a.src=t,a):(i.manager.itemStart(t),setTimeout(function(){r&&r(e),i.manager.itemEnd(t)},0),e)},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Eo.prototype,{crossOrigin:"Anonymous",load:function(t,r,a,o){function i(i){n.load(t[i],function(t){e.images[i]=t,s++,6===s&&(e.needsUpdate=!0,r&&r(e))},void 0,o)}var e=new p,n=new ge(this.manager);n.setCrossOrigin(this.crossOrigin),n.setPath(this.path);var s=0;for(a=0;a<t.length;++a)i(a);return e},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(he.prototype,{crossOrigin:"Anonymous",load:function(t,a,o,i){var n=new r,e=new ge(this.manager);return e.setCrossOrigin(this.crossOrigin),e.setPath(this.path),e.load(t,function(e){n.image=e,e=0<t.search(/\.(jpg|jpeg)$/)||0===t.search(/^data\:image\/jpeg/),n.format=e?1022:1023,n.needsUpdate=!0,void 0!==a&&a(n)},o,i),n},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(To.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){return e=this.getUtoTmapping(e),this.getPoint(e,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var r=[],a=this.getPoint(0),o=0,e;for(r.push(0),e=1;e<=t;e++){var i=this.getPoint(e/t);o+=i.distanceTo(a),r.push(o),a=i}return this.cacheArcLengths=r},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,r){var a=this.getLengths(),o=a.length;r=r?r:t*a[o-1];for(var i=0,e=o-1,n;i<=e;)if(t=hn(i+(e-i)/2),n=a[t]-r,0>n)i=t+1;else if(0<n)e=t-1;else{e=t;break}return(t=e,a[t]===r)?t/(o-1):(i=a[t],(t+(r-i)/(a[t+1]-i))/(o-1))},getTangent:function(e){var t=e-1E-4;return e+=1E-4,0>t&&(t=0),1<e&&(e=1),t=this.getPoint(t),this.getPoint(e).clone().sub(t).normalize()},getTangentAt:function(e){return e=this.getUtoTmapping(e),this.getTangent(e)},computeFrenetFrames:function(t,r){var a=new _,o=[],s=[],p=[],u=new _,g=new i,h;for(h=0;h<=t;h++){var y=h/t;o[h]=this.getTangentAt(y),o[h].normalize()}s[0]=new _,p[0]=new _,h=Number.MAX_VALUE,y=fn(o[0].x);var m=fn(o[0].y),l=fn(o[0].z);for(y<=h&&(h=y,a.set(1,0,0)),m<=h&&(h=m,a.set(0,1,0)),l<=h&&a.set(0,0,1),u.crossVectors(o[0],a).normalize(),s[0].crossVectors(o[0],u),p[0].crossVectors(o[0],s[0]),h=1;h<=t;h++)s[h]=s[h-1].clone(),p[h]=p[h-1].clone(),u.crossVectors(o[h-1],o[h]),u.length()>an&&(u.normalize(),a=Ki(yn.clamp(o[h-1].dot(o[h]),-1,1)),s[h].applyMatrix4(g.makeRotationAxis(u,a))),p[h].crossVectors(o[h],s[h]);if(!0===r)for(a=Ki(yn.clamp(s[0].dot(s[t]),-1,1)),a/=t,0<o[0].dot(u.crossVectors(s[0],s[t]))&&(a=-a),h=1;h<=t;h++)s[h].applyMatrix4(g.makeRotationAxis(o[h],a*h)),p[h].crossVectors(o[h],s[h]);return{tangents:o,normals:s,binormals:p}},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"},arcLengthDivisions:this.arcLengthDivisions,type:this.type};return e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),H.prototype=Object.create(To.prototype),H.prototype.constructor=H,H.prototype.isEllipseCurve=!0,H.prototype.getPoint=function(t,r){r=r||new o;for(var a=2*ln,i=this.aEndAngle-this.aStartAngle,n=fn(i)<an;0>i;)i+=a;for(;i>a;)i-=a;i<an&&(i=n?0:a),!0!==this.aClockwise||n||(i=i===a?-a:i-a),a=this.aStartAngle+t*i,t=this.aX+this.xRadius*gn(a);var e=this.aY+this.yRadius*on(a);return 0!==this.aRotation&&(a=gn(this.aRotation),i=on(this.aRotation),n=t-this.aX,e-=this.aY,t=n*a-e*i+this.aX,e=n*i+e*a+this.aY),r.set(t,e)},H.prototype.copy=function(e){return To.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},H.prototype.toJSON=function(){var e=To.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},H.prototype.fromJSON=function(e){return To.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},So.prototype=Object.create(H.prototype),So.prototype.constructor=So,So.prototype.isArcCurve=!0;var Cn=new _,Pn=new Mo,De=new Mo,Ee=new Mo;ie.prototype=Object.create(To.prototype),ie.prototype.constructor=ie,ie.prototype.isCatmullRomCurve3=!0,ie.prototype.getPoint=function(t,r){r=r||new _;var a=this.points,o=a.length;t*=o-(this.closed?0:1);var i=hn(t);if(t-=i,this.closed?i+=0<i?0:(hn(fn(i)/a.length)+1)*a.length:0===t&&i===o-1&&(i=o-2,t=1),this.closed||0<i)var e=a[(i-1)%o];else Cn.subVectors(a[0],a[1]).add(a[0]),e=Cn;var n=a[i%o],s=a[(i+1)%o];if(this.closed||i+2<o?a=a[(i+2)%o]:(Cn.subVectors(a[o-1],a[o-2]).add(a[o-1]),a=Cn),"centripetal"===this.curveType||"chordal"===this.curveType){var l="chordal"===this.curveType?.5:.25,o=sn(e.distanceToSquared(n),l),i=sn(n.distanceToSquared(s),l),l=sn(s.distanceToSquared(a),l);1E-4>i&&(i=1),1E-4>o&&(o=i),1E-4>l&&(l=i),Pn.initNonuniformCatmullRom(e.x,n.x,s.x,a.x,o,i,l),De.initNonuniformCatmullRom(e.y,n.y,s.y,a.y,o,i,l),Ee.initNonuniformCatmullRom(e.z,n.z,s.z,a.z,o,i,l)}else"catmullrom"===this.curveType&&(Pn.initCatmullRom(e.x,n.x,s.x,a.x,this.tension),De.initCatmullRom(e.y,n.y,s.y,a.y,this.tension),Ee.initCatmullRom(e.z,n.z,s.z,a.z,this.tension));return r.set(Pn.calc(t),De.calc(t),Ee.calc(t)),r},ie.prototype.copy=function(e){To.prototype.copy.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++)this.points.push(e.points[t].clone());return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},ie.prototype.toJSON=function(){var e=To.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++)e.points.push(this.points[t].toArray());return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},ie.prototype.fromJSON=function(e){To.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length,a;t<r;t++)a=e.points[t],this.points.push(new _().fromArray(a));return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Lo.prototype=Object.create(To.prototype),Lo.prototype.constructor=Lo,Lo.prototype.isCubicBezierCurve=!0,Lo.prototype.getPoint=function(t,r){r=r||new o;var a=this.v0,i=this.v1,n=this.v2,e=this.v3;return r.set(Ro(t,a.x,i.x,n.x,e.x),Ro(t,a.y,i.y,n.y,e.y)),r},Lo.prototype.copy=function(e){return To.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Lo.prototype.toJSON=function(){var e=To.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Lo.prototype.fromJSON=function(e){return To.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Co.prototype=Object.create(To.prototype),Co.prototype.constructor=Co,Co.prototype.isCubicBezierCurve3=!0,Co.prototype.getPoint=function(t,r){r=r||new _;var a=this.v0,o=this.v1,i=this.v2,e=this.v3;return r.set(Ro(t,a.x,o.x,i.x,e.x),Ro(t,a.y,o.y,i.y,e.y),Ro(t,a.z,o.z,i.z,e.z)),r},Co.prototype.copy=function(e){return To.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Co.prototype.toJSON=function(){var e=To.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Co.prototype.fromJSON=function(e){return To.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Po.prototype=Object.create(To.prototype),Po.prototype.constructor=Po,Po.prototype.isLineCurve=!0,Po.prototype.getPoint=function(e,t){return t=t||new o,1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t},Po.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Po.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},Po.prototype.copy=function(e){return To.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Po.prototype.toJSON=function(){var e=To.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Po.prototype.fromJSON=function(e){return To.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Io.prototype=Object.create(To.prototype),Io.prototype.constructor=Io,Io.prototype.isLineCurve3=!0,Io.prototype.getPoint=function(e,t){return t=t||new _,1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t},Io.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Io.prototype.copy=function(e){return To.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Io.prototype.toJSON=function(){var e=To.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Io.prototype.fromJSON=function(e){return To.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},No.prototype=Object.create(To.prototype),No.prototype.constructor=No,No.prototype.isQuadraticBezierCurve=!0,No.prototype.getPoint=function(t,r){r=r||new o;var a=this.v0,i=this.v1,n=this.v2;return r.set(wo(t,a.x,i.x,n.x),wo(t,a.y,i.y,n.y)),r},No.prototype.copy=function(e){return To.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},No.prototype.toJSON=function(){var e=To.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},No.prototype.fromJSON=function(e){return To.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Uo.prototype=Object.create(To.prototype),Uo.prototype.constructor=Uo,Uo.prototype.isQuadraticBezierCurve3=!0,Uo.prototype.getPoint=function(t,r){r=r||new _;var a=this.v0,o=this.v1,i=this.v2;return r.set(wo(t,a.x,o.x,i.x),wo(t,a.y,o.y,i.y),wo(t,a.z,o.z,i.z)),r},Uo.prototype.copy=function(e){return To.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Uo.prototype.toJSON=function(){var e=To.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Uo.prototype.fromJSON=function(e){return To.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Do.prototype=Object.create(To.prototype),Do.prototype.constructor=Do,Do.prototype.isSplineCurve=!0,Do.prototype.getPoint=function(t,r){r=r||new o;var a=this.points,i=(a.length-1)*t;t=hn(i);var i=i-t,n=a[0===t?t:t-1],e=a[t],s=a[t>a.length-2?a.length-1:t+1],a=a[t>a.length-3?a.length-1:t+2];return r.set(Ao(i,n.x,e.x,s.x,a.x),Ao(i,n.y,e.y,s.y,a.y)),r},Do.prototype.copy=function(e){To.prototype.copy.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++)this.points.push(e.points[t].clone());return this},Do.prototype.toJSON=function(){var e=To.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++)e.points.push(this.points[t].toArray());return e},Do.prototype.fromJSON=function(e){To.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length,a;t<r;t++)a=e.points[t],this.points.push(new o().fromArray(a));return this};var Fe=Object.freeze({ArcCurve:So,CatmullRomCurve3:ie,CubicBezierCurve:Lo,CubicBezierCurve3:Co,EllipseCurve:H,LineCurve:Po,LineCurve3:Io,QuadraticBezierCurve:No,QuadraticBezierCurve3:Uo,SplineCurve:Do});Bo.prototype=Object.assign(Object.create(To.prototype),{constructor:Bo,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Po(t,e))},getPoint:function(e){var t=e*this.getLength(),r=this.getCurveLengths();for(e=0;e<r.length;){if(r[e]>=t)return t=r[e]-t,e=this.curves[e],r=e.getLength(),e.getPointAt(0===r?0:1-t/r);e++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,r=0,a=this.curves.length;r<a;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(t){t=t||12;for(var r=[],a=0,o=this.curves,e;a<o.length;a++)for(var i=o[a],i=i.getPoints(i&&i.isEllipseCurve?2*t:i&&i.isLineCurve?1:i&&i.isSplineCurve?t*i.points.length:t),n=0,s;n<i.length;n++)s=i[n],e&&e.equals(s)||(r.push(s),e=s);return this.autoClose&&1<r.length&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r},copy:function(e){To.prototype.copy.call(this,e),this.curves=[];for(var t=0,r=e.curves.length;t<r;t++)this.curves.push(e.curves[t].clone());return this.autoClose=e.autoClose,this},toJSON:function(){var e=To.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,r=this.curves.length;t<r;t++)e.curves.push(this.curves[t].toJSON());return e},fromJSON:function(e){To.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,r=e.curves.length,a;t<r;t++)a=e.curves[t],this.curves.push(new Fe[a.type]().fromJSON(a));return this}}),Fo.prototype=Object.assign(Object.create(Bo.prototype),{constructor:Fo,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y)},moveTo:function(e,t){this.currentPoint.set(e,t)},lineTo:function(e,t){var r=new Po(this.currentPoint.clone(),new o(e,t));this.curves.push(r),this.currentPoint.set(e,t)},quadraticCurveTo:function(e,t,r,a){e=new No(this.currentPoint.clone(),new o(e,t),new o(r,a)),this.curves.push(e),this.currentPoint.set(r,a)},bezierCurveTo:function(t,r,a,i,n,e){t=new Lo(this.currentPoint.clone(),new o(t,r),new o(a,i),new o(n,e)),this.curves.push(t),this.currentPoint.set(n,e)},splineThru:function(e){var t=[this.currentPoint.clone()].concat(e),t=new Do(t);this.curves.push(t),this.currentPoint.copy(e[e.length-1])},arc:function(t,r,a,o,i,e){this.absarc(t+this.currentPoint.x,r+this.currentPoint.y,a,o,i,e)},absarc:function(t,r,a,o,i,e){this.absellipse(t,r,a,a,o,i,e)},ellipse:function(t,r,a,o,i,e,n,s){this.absellipse(t+this.currentPoint.x,r+this.currentPoint.y,a,o,i,e,n,s)},absellipse:function(t,r,a,o,i,e,n,s){t=new H(t,r,a,o,i,e,n,s),0<this.curves.length&&(r=t.getPoint(0),r.equals(this.currentPoint)||this.lineTo(r.x,r.y)),this.curves.push(t),t=t.getPoint(1),this.currentPoint.copy(t)},copy:function(e){return Bo.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=Bo.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return Bo.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),zo.prototype=Object.assign(Object.create(Fo.prototype),{constructor:zo,getPointsHoles:function(e){for(var t=[],r=0,a=this.holes.length;r<a;r++)t[r]=this.holes[r].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){Fo.prototype.copy.call(this,e),this.holes=[];for(var t=0,r=e.holes.length;t<r;t++)this.holes.push(e.holes[t].clone());return this},toJSON:function(){var e=Fo.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,r=this.holes.length;t<r;t++)e.holes.push(this.holes[t].toJSON());return e},fromJSON:function(e){Fo.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,r=e.holes.length,a;t<r;t++)a=e.holes[t],this.holes.push(new Fo().fromJSON(a));return this}}),Go.prototype=Object.assign(Object.create(dt.prototype),{constructor:Go,isLight:!0,copy:function(e){return dt.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){return e=dt.prototype.toJSON.call(this,e),e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),Oo.prototype=Object.assign(Object.create(Go.prototype),{constructor:Oo,isHemisphereLight:!0,copy:function(e){return Go.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(Ho.prototype,{copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),Vo.prototype=Object.assign(Object.create(Ho.prototype),{constructor:Vo,isSpotLightShadow:!0,update:function(e){var t=this.camera,r=2*yn.RAD2DEG*e.angle,a=this.mapSize.width/this.mapSize.height;e=e.distance||t.far,(r!==t.fov||a!==t.aspect||e!==t.far)&&(t.fov=r,t.aspect=a,t.far=e,t.updateProjectionMatrix())}}),ko.prototype=Object.assign(Object.create(Go.prototype),{constructor:ko,isSpotLight:!0,copy:function(e){return Go.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Wo.prototype=Object.assign(Object.create(Go.prototype),{constructor:Wo,isPointLight:!0,copy:function(e){return Go.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),jo.prototype=Object.assign(Object.create(Ho.prototype),{constructor:jo}),Xo.prototype=Object.assign(Object.create(Go.prototype),{constructor:Xo,isDirectionalLight:!0,copy:function(e){return Go.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Yo.prototype=Object.assign(Object.create(Go.prototype),{constructor:Yo,isAmbientLight:!0}),qo.prototype=Object.assign(Object.create(Go.prototype),{constructor:qo,isRectAreaLight:!0,copy:function(e){return Go.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){return e=Go.prototype.toJSON.call(this,e),e.object.width=this.width,e.object.height=this.height,e}}),Zo.prototype=Object.assign(Object.create(oi.prototype),{constructor:Zo,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Jo.prototype=Object.assign(Object.create(oi.prototype),{constructor:Jo,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Object.assign(Qo.prototype,{evaluate:function(t){var r=this.parameterPositions,a=this._cachedIndex,o=r[a],i=r[a-1];a:{b:{c:{d:if(!(t<o)){for(var e=a+2;;){if(void 0===o){if(t<i)break d;return this._cachedIndex=a=r.length,this.afterEnd_(a-1,t,i)}if(a===e)break;if(i=o,o=r[++a],t<o)break b}o=r.length;break c}if(t>=i)break a;else{for(e=r[1],t<e&&(a=2,i=e),e=a-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,o);if(a===e)break;if(o=i,i=r[--a-1],t>=i)break b}o=a,a=0}}for(;a<o;)i=a+o>>>1,t<r[i]?o=i:a=i+1;if(o=r[a],i=r[a-1],void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,o);if(void 0===o)return this._cachedIndex=a=r.length,this.afterEnd_(a-1,i,t)}this._cachedIndex=a,this.intervalChanged_(a,i,o)}return this.interpolate_(a,i,t,o)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize;t*=o;for(var i=0;i!==o;++i)r[i]=a[t+i];return r},interpolate_:function(){throw Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Qo.prototype,{beforeStart_:Qo.prototype.copySampleValue_,afterEnd_:Qo.prototype.copySampleValue_}),ya.prototype=Object.assign(Object.create(Qo.prototype),{constructor:ya,interpolate_:function(t,r,a,o){var i=this.resultBuffer,e=this.sampleValues,n=this.valueSize;for(t*=n,r=(a-r)/(o-r),a=t+n;t!==a;t+=4)s.slerpFlat(i,0,e,t-n,e,t,r);return i}}),Ko.prototype=Object.assign(Object.create(oi.prototype),{constructor:Ko,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(e){return new ya(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),$o.prototype=Object.assign(Object.create(oi.prototype),{constructor:$o,ValueTypeName:"color"}),ei.prototype=Object.assign(Object.create(oi.prototype),{constructor:ei,ValueTypeName:"number"}),ti.prototype=Object.assign(Object.create(Qo.prototype),{constructor:ti,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(t,r,a){var o=this.parameterPositions,i=t-2,e=t+1,n=o[i],s=o[e];if(void 0===n)switch(this.getSettings_().endingStart){case 2401:i=t,n=2*r-a;break;case 2402:i=o.length-2,n=r+o[i]-o[i+1];break;default:i=t,n=a;}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:e=t,s=2*a-r;break;case 2402:e=1,s=a+o[1]-o[0];break;default:e=t-1,s=r;}t=.5*(a-r),o=this.valueSize,this._weightPrev=t/(r-n),this._weightNext=t/(s-a),this._offsetPrev=i*o,this._offsetNext=e*o},interpolate_:function(t,r,a,o){var i=this.resultBuffer,e=this.sampleValues,s=this.valueSize;t*=s;var d=t-s,c=this._offsetPrev,u=this._offsetNext,m=this._weightPrev,g=this._weightNext,n=(a-r)/(o-r);for(a=n*n,o=a*n,r=-m*o+2*m*a-m*n,m=(1+m)*o+(-1.5-2*m)*a+(-.5+m)*n+1,n=(-1-g)*o+(1.5+g)*a+.5*n,g=g*o-g*a,a=0;a!==s;++a)i[a]=r*e[c+a]+m*e[d+a]+n*e[t+a]+g*e[u+a];return i}}),ri.prototype=Object.assign(Object.create(Qo.prototype),{constructor:ri,interpolate_:function(t,r,a,o){var i=this.resultBuffer,e=this.sampleValues,n=this.valueSize;t*=n;var s=t-n;for(r=(a-r)/(o-r),a=1-r,o=0;o!==n;++o)i[o]=e[s+o]*a+e[t+o]*r;return i}}),ai.prototype=Object.assign(Object.create(Qo.prototype),{constructor:ai,interpolate_:function(e){return this.copySampleValue_(e-1)}});var In={arraySlice:function(e,t,r){return In.isTypedArray(e)?new e.constructor(e.subarray(t,void 0===r?e.length:r)):e.slice(t,r)},convertArray:function(e,t,r){return e&&(r||e.constructor!==t)?"number"===typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e):e},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,r=Array(t),a=0;a!==t;++a)r[a]=a;return r.sort(function(t,r){return e[t]-e[r]}),r},sortedArray:function(t,r,a){for(var o=t.length,i=new t.constructor(o),e=0,n=0;n!==o;++e)for(var s=a[e]*r,l=0;l!==r;++l)i[n++]=t[s+l];return i},flattenJSON:function(t,r,a,o){for(var i=1,e=t[0];void 0!==e&&void 0===e[o];)e=t[i++];if(void 0!==e){var n=e[o];if(void 0!==n)if(Array.isArray(n))do n=e[o],void 0!==n&&(r.push(e.time),a.push.apply(a,n)),e=t[i++];while(void 0!==e);else if(void 0!==n.toArray)do n=e[o],void 0!==n&&(r.push(e.time),n.toArray(a,a.length)),e=t[i++];while(void 0!==e);else do n=e[o],void 0!==n&&(r.push(e.time),a.push(n)),e=t[i++];while(void 0!==e)}}};Object.assign(oi,{parse:function(e){if(void 0===e.type)throw Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=oi._getTrackTypeForValueTypeName(e.type);if(void 0===e.times){var r=[],a=[];In.flattenJSON(e.keys,r,a,"value"),e.times=r,e.values=a}return void 0===t.parse?new t(e.name,e.times,e.values,e.interpolation):t.parse(e)},toJSON:function(e){var t=e.constructor;if(void 0!==t.toJSON)t=t.toJSON(e);else{var t={name:e.name,times:In.convertArray(e.times,Array),values:In.convertArray(e.values,Array)},r=e.getInterpolation();r!==e.DefaultInterpolation&&(t.interpolation=r)}return t.type=e.ValueTypeName,t},_getTrackTypeForValueTypeName:function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ei;case"vector":case"vector2":case"vector3":case"vector4":return ii;case"color":return $o;case"quaternion":return Ko;case"bool":case"boolean":return Jo;case"string":return Zo;}throw Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}}),Object.assign(oi.prototype,{constructor:oi,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(e){return new ai(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new ri(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new ti(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){switch(e){case 2300:var t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth;}if(void 0===t){if(t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name,void 0===this.createInterpolant)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw Error(t);console.warn("THREE.KeyframeTrack:",t)}else this.createInterpolant=t},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302;}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,r=0,a=t.length;r!==a;++r)t[r]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,r=0,a=t.length;r!==a;++r)t[r]*=e;return this},trim:function(t,r){for(var a=this.times,o=a.length,i=0,e=o-1;i!==o&&a[i]<t;)++i;for(;-1!==e&&a[e]>r;)--e;return++e,(0!==i||e!==o)&&(i>=e&&(e=mn(e,1),i=e-1),t=this.getValueSize(),this.times=In.arraySlice(a,i,e),this.values=In.arraySlice(this.values,i*t,e*t)),this},validate:function(){var t=!0,r=this.getValueSize();0!==r-hn(r)&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);var a=this.times,r=this.values,o=a.length;0===o&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);for(var i=null,e=0,n;e!==o;e++){if(n=a[e],"number"===typeof n&&isNaN(n)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,n),t=!1;break}if(null!==i&&i>n){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,n,i),t=!1;break}i=n}if(void 0!==r&&In.isTypedArray(r))for(e=0,a=r.length;e!==a;++e)if(o=r[e],isNaN(o)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,o),t=!1;break}return t},optimize:function(){for(var t=this.times,r=this.values,o=this.getValueSize(),e=2302===this.getInterpolation(),i=1,s=t.length-1,d=1,c,a;d<s;++d){c=!1;var u=t[d];if(u!==t[d+1]&&(1!==d||u!==u[0]))if(e)c=!0;else{a=d*o;for(var m=a-o,l=a+o,u=0,n;u!==o;++u)if(n=r[a+u],n!==r[m+u]||n!==r[l+u]){c=!0;break}}if(c){if(d!==i)for(t[i]=t[d],a=d*o,c=i*o,u=0;u!==o;++u)r[c+u]=r[a+u];++i}}if(0<s){for(t[i]=t[s],a=s*o,c=i*o,u=0;u!==o;++u)r[c+u]=r[a+u];++i}return i!==t.length&&(this.times=In.arraySlice(t,0,i),this.values=In.arraySlice(r,0,i*o)),this}}),ii.prototype=Object.assign(Object.create(oi.prototype),{constructor:ii,ValueTypeName:"vector"}),Object.assign(ni,{parse:function(t){for(var r=[],a=t.tracks,o=1/(t.fps||1),i=0,e=a.length;i!==e;++i)r.push(oi.parse(a[i]).scale(o));return new ni(t.name,t.duration,r)},toJSON:function(t){var r=[],a=t.tracks;t={name:t.name,duration:t.duration,tracks:r};for(var o=0,i=a.length;o!==i;++o)r.push(oi.toJSON(a[o]));return t},CreateFromMorphTargetSequence:function(t,r,a,o){for(var i=r.length,e=[],n=0;n<i;n++){var s=[],l=[];s.push((n+i-1)%i,n,(n+1)%i),l.push(0,1,0);var p=In.getKeyframeOrder(s),s=In.sortedArray(s,1,p),l=In.sortedArray(l,1,p);o||0!==s[0]||(s.push(i),l.push(l[0])),e.push(new ei(".morphTargetInfluences["+r[n].name+"]",s,l).scale(1/a))}return new ni(t,-1,e)},findByName:function(e,t){var r=e;for(Array.isArray(e)||(r=e.geometry&&e.geometry.animations||e.animations),e=0;e<r.length;e++)if(r[e].name===t)return r[e];return null},CreateClipsFromMorphTargetSequences:function(t,r,a){for(var o={},e=/^([\w-]*?)([\d]+)$/,i=0,n=t.length,s;i<n;i++){var l=t[i],p=l.name.match(e);p&&1<p.length&&(s=p[1],(p=o[s])||(o[s]=p=[]),p.push(l))}for(s in t=[],o)t.push(ni.CreateFromMorphTargetSequence(s,o[s],r,a));return t},parseAnimation:function(t,o){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;var i=function(t,r,a,o,i){if(0!==a.length){var e=[],n=[];In.flattenJSON(a,e,n,o),0!==e.length&&i.push(new t(r,e,n))}},s=[],d=t.name||"default",e=t.length||-1,c=t.fps||30;t=t.hierarchy||[];for(var u=0,g;u<t.length;u++)if(g=t[u].keys,g&&0!==g.length)if(g[0].morphTargets){for(var e={},f=0;f<g.length;f++)if(g[f].morphTargets)for(var m=0;m<g[f].morphTargets.length;m++)e[g[f].morphTargets[m]]=-1;for(var l in e){for(var n=[],p=[],m=0,r;m!==g[f].morphTargets.length;++m)r=g[f],n.push(r.time),p.push(r.morphTarget===l?1:0);s.push(new ei(".morphTargetInfluence["+l+"]",n,p))}e=e.length*(c||1)}else f=".bones["+o[u].name+"]",i(ii,f+".position",g,"pos",s),i(Ko,f+".quaternion",g,"rot",s),i(ii,f+".scale",g,"scl",s);return 0===s.length?null:new ni(d,e,s)}}),Object.assign(ni.prototype,{resetDuration:function(){for(var e=0,t=0,r=this.tracks.length;t!==r;++t)var a=this.tracks[t],e=mn(e,a.times[a.times.length-1]);this.duration=e},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}}),Object.assign(Ca.prototype,{load:function(t,r,a,o){var i=this;new fe(i.manager).load(t,function(e){r(i.parse(JSON.parse(e)))},a,o)},setTextures:function(e){this.textures=e},parse:function(t){function r(e){return void 0===i[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),i[e]}var i=this.textures,a=new za[t.type];if(void 0!==t.uuid&&(a.uuid=t.uuid),void 0!==t.name&&(a.name=t.name),void 0!==t.color&&a.color.setHex(t.color),void 0!==t.roughness&&(a.roughness=t.roughness),void 0!==t.metalness&&(a.metalness=t.metalness),void 0!==t.emissive&&a.emissive.setHex(t.emissive),void 0!==t.specular&&a.specular.setHex(t.specular),void 0!==t.shininess&&(a.shininess=t.shininess),void 0!==t.clearCoat&&(a.clearCoat=t.clearCoat),void 0!==t.clearCoatRoughness&&(a.clearCoatRoughness=t.clearCoatRoughness),void 0!==t.uniforms&&(a.uniforms=t.uniforms),void 0!==t.vertexShader&&(a.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(a.fragmentShader=t.fragmentShader),void 0!==t.vertexColors&&(a.vertexColors=t.vertexColors),void 0!==t.fog&&(a.fog=t.fog),void 0!==t.flatShading&&(a.flatShading=t.flatShading),void 0!==t.blending&&(a.blending=t.blending),void 0!==t.side&&(a.side=t.side),void 0!==t.opacity&&(a.opacity=t.opacity),void 0!==t.transparent&&(a.transparent=t.transparent),void 0!==t.alphaTest&&(a.alphaTest=t.alphaTest),void 0!==t.depthTest&&(a.depthTest=t.depthTest),void 0!==t.depthWrite&&(a.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(a.colorWrite=t.colorWrite),void 0!==t.wireframe&&(a.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(a.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(a.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(a.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(a.rotation=t.rotation),1!==t.linewidth&&(a.linewidth=t.linewidth),void 0!==t.dashSize&&(a.dashSize=t.dashSize),void 0!==t.gapSize&&(a.gapSize=t.gapSize),void 0!==t.scale&&(a.scale=t.scale),void 0!==t.skinning&&(a.skinning=t.skinning),void 0!==t.morphTargets&&(a.morphTargets=t.morphTargets),void 0!==t.dithering&&(a.dithering=t.dithering),void 0!==t.visible&&(a.visible=t.visible),void 0!==t.userData&&(a.userData=t.userData),void 0!==t.shading&&(a.flatShading=1===t.shading),void 0!==t.size&&(a.size=t.size),void 0!==t.sizeAttenuation&&(a.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(a.map=r(t.map)),void 0!==t.alphaMap&&(a.alphaMap=r(t.alphaMap),a.transparent=!0),void 0!==t.bumpMap&&(a.bumpMap=r(t.bumpMap)),void 0!==t.bumpScale&&(a.bumpScale=t.bumpScale),void 0!==t.normalMap&&(a.normalMap=r(t.normalMap)),void 0!==t.normalScale){var n=t.normalScale;!1===Array.isArray(n)&&(n=[n,n]),a.normalScale=new o().fromArray(n)}return void 0!==t.displacementMap&&(a.displacementMap=r(t.displacementMap)),void 0!==t.displacementScale&&(a.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(a.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(a.roughnessMap=r(t.roughnessMap)),void 0!==t.metalnessMap&&(a.metalnessMap=r(t.metalnessMap)),void 0!==t.emissiveMap&&(a.emissiveMap=r(t.emissiveMap)),void 0!==t.emissiveIntensity&&(a.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(a.specularMap=r(t.specularMap)),void 0!==t.envMap&&(a.envMap=r(t.envMap)),void 0!==t.reflectivity&&(a.reflectivity=t.reflectivity),void 0!==t.lightMap&&(a.lightMap=r(t.lightMap)),void 0!==t.lightMapIntensity&&(a.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(a.aoMap=r(t.aoMap)),void 0!==t.aoMapIntensity&&(a.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(a.gradientMap=r(t.gradientMap)),a}}),Object.assign(si.prototype,{load:function(t,r,a,o){var i=this;new fe(i.manager).load(t,function(e){r(i.parse(JSON.parse(e)))},a,o)},parse:function(t){var r=new St,a=t.data.index;void 0!==a&&(a=new oa[a.type](a.array),r.setIndex(new ft(a,1)));var o=t.data.attributes;for(e in o){var i=o[e];a=new oa[i.type](i.array),r.addAttribute(e,new ft(a,i.itemSize,i.normalized))}var e=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==e)for(a=0,o=e.length;a!==o;++a)i=e[a],r.addGroup(i.start,i.count,i.materialIndex);return t=t.data.boundingSphere,void 0!==t&&(e=new _,void 0!==t.center&&e.fromArray(t.center),r.boundingSphere=new ot(e,t.radius)),r}});var oa={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"===typeof Uint8ClampedArray?Uint8Array:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};je.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(t){for(var r=this.handlers,a=0,o=r.length,i;a<o;a+=2)if(i=r[a+1],r[a].test(t))return i;return null}},Object.assign(je.prototype,{crossOrigin:void 0,initMaterials:function(t,r,a){for(var o=[],i=0;i<t.length;++i)o[i]=this.createMaterial(t[i],r,a);return o},createMaterial:function(){var t={NoBlending:0,NormalBlending:1,AdditiveBlending:2,SubtractiveBlending:3,MultiplyBlending:4,CustomBlending:5},r=new Oe,o=new he,a=new Ca;return function(i,s,p){function e(t,r,a,i,e){t=s+t;var n=je.Handlers.get(t);return null===n?(o.setCrossOrigin(p),t=o.load(t)):t=n.load(t),void 0!==r&&(t.repeat.fromArray(r),1!==r[0]&&(t.wrapS=1E3),1!==r[1]&&(t.wrapT=1E3)),void 0!==a&&t.offset.fromArray(a),void 0!==i&&("repeat"===i[0]&&(t.wrapS=1E3),"mirror"===i[0]&&(t.wrapS=1002),"repeat"===i[1]&&(t.wrapT=1E3),"mirror"===i[1]&&(t.wrapT=1002)),void 0!==e&&(t.anisotropy=e),r=yn.generateUUID(),c[r]=t,r}var c={},d={uuid:yn.generateUUID(),type:"MeshLambertMaterial"},m;for(m in i){var l=i[m];switch(m){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":d.name=l;break;case"blending":d.blending=t[l];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",m,"is no longer supported.");break;case"colorDiffuse":d.color=r.fromArray(l).getHex();break;case"colorSpecular":d.specular=r.fromArray(l).getHex();break;case"colorEmissive":d.emissive=r.fromArray(l).getHex();break;case"specularCoef":d.shininess=l;break;case"shading":"basic"===l.toLowerCase()&&(d.type="MeshBasicMaterial"),"phong"===l.toLowerCase()&&(d.type="MeshPhongMaterial"),"standard"===l.toLowerCase()&&(d.type="MeshStandardMaterial");break;case"mapDiffuse":d.map=e(l,i.mapDiffuseRepeat,i.mapDiffuseOffset,i.mapDiffuseWrap,i.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":d.emissiveMap=e(l,i.mapEmissiveRepeat,i.mapEmissiveOffset,i.mapEmissiveWrap,i.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":d.lightMap=e(l,i.mapLightRepeat,i.mapLightOffset,i.mapLightWrap,i.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":d.aoMap=e(l,i.mapAORepeat,i.mapAOOffset,i.mapAOWrap,i.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":d.bumpMap=e(l,i.mapBumpRepeat,i.mapBumpOffset,i.mapBumpWrap,i.mapBumpAnisotropy);break;case"mapBumpScale":d.bumpScale=l;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":d.normalMap=e(l,i.mapNormalRepeat,i.mapNormalOffset,i.mapNormalWrap,i.mapNormalAnisotropy);break;case"mapNormalFactor":d.normalScale=[l,l];break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":d.specularMap=e(l,i.mapSpecularRepeat,i.mapSpecularOffset,i.mapSpecularWrap,i.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":d.metalnessMap=e(l,i.mapMetalnessRepeat,i.mapMetalnessOffset,i.mapMetalnessWrap,i.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":d.roughnessMap=e(l,i.mapRoughnessRepeat,i.mapRoughnessOffset,i.mapRoughnessWrap,i.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":d.alphaMap=e(l,i.mapAlphaRepeat,i.mapAlphaOffset,i.mapAlphaWrap,i.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":d.side=1;break;case"doubleSided":d.side=2;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),d.opacity=l;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":d[m]=l;break;case"vertexColors":!0===l&&(d.vertexColors=2),"face"===l&&(d.vertexColors=1);break;default:console.error("THREE.Loader.createMaterial: Unsupported",m,l);}}return"MeshBasicMaterial"===d.type&&delete d.emissive,"MeshPhongMaterial"!==d.type&&delete d.specular,1>d.opacity&&(d.transparent=!0),a.setTextures(c),a.parse(d)}}()});var Nn={decodeText:function(e){if("undefined"!==typeof TextDecoder)return new TextDecoder().decode(e);for(var t="",r=0,a=e.length;r<a;r++)t+=String.fromCharCode(e[r]);return decodeURIComponent(escape(t))},extractUrlBase:function(e){return(e=e.split("/"),1===e.length)?"./":(e.pop(),e.join("/")+"/")}};Object.assign(li.prototype,{load:function(t,r,a,o){var i=this,e=this.texturePath&&"string"===typeof this.texturePath?this.texturePath:Nn.extractUrlBase(t),n=new fe(this.manager);n.setWithCredentials(this.withCredentials),n.load(t,function(a){a=JSON.parse(a);var o=a.metadata;if(void 0!==o&&(o=o.type,void 0!==o)){if("object"===o.toLowerCase())return void console.error("THREE.JSONLoader: "+t+" should be loaded with THREE.ObjectLoader instead.");if("scene"===o.toLowerCase())return void console.error("THREE.JSONLoader: "+t+" should be loaded with THREE.SceneLoader instead.")}a=i.parse(a,e),r(a.geometry,a.materials)},a,o)},setTexturePath:function(e){this.texturePath=e},parse:function(){return function(t,i){void 0!==t.data&&(t=t.data),t.scale=void 0===t.scale?1:1/t.scale;var s=new gt,p=t,d=p.faces,h=p.vertices,b=p.normals,m=p.colors,l=p.scale,n=0,v,e,f;if(void 0!==p.uvs){for(v=0;v<p.uvs.length;v++)p.uvs[v].length&&n++;for(v=0;v<n;v++)s.faceVertexUvs[v]=[]}var g=0;for(f=h.length;g<f;)v=new _,v.x=h[g++]*l,v.y=h[g++]*l,v.z=h[g++]*l,s.vertices.push(v);for(g=0,f=d.length;g<f;){h=d[g++];var r=1&h,E=2&h;v=8&h;var u=16&h,T=32&h;if(l=64&h,h&=128,r){r=new ut,r.a=d[g],r.b=d[g+1],r.c=d[g+3];var x=new ut;if(x.a=d[g+1],x.b=d[g+2],x.c=d[g+3],g+=4,E&&(E=d[g++],r.materialIndex=E,x.materialIndex=E),E=s.faces.length,v)for(v=0;v<n;v++){var S=p.uvs[v];for(s.faceVertexUvs[v][E]=[],s.faceVertexUvs[v][E+1]=[],e=0;4>e;e++){var M=d[g++],y=S[2*M];M=S[2*M+1],y=new o(y,M),2!==e&&s.faceVertexUvs[v][E].push(y),0!==e&&s.faceVertexUvs[v][E+1].push(y)}}if(u&&(u=3*d[g++],r.normal.set(b[u++],b[u++],b[u]),x.normal.copy(r.normal)),T)for(v=0;4>v;v++)u=3*d[g++],T=new _(b[u++],b[u++],b[u]),2!==v&&r.vertexNormals.push(T),0!==v&&x.vertexNormals.push(T);if(l&&(l=d[g++],l=m[l],r.color.setHex(l),x.color.setHex(l)),h)for(v=0;4>v;v++)l=d[g++],l=m[l],2!==v&&r.vertexColors.push(new Oe(l)),0!==v&&x.vertexColors.push(new Oe(l));s.faces.push(r),s.faces.push(x)}else{if(r=new ut,r.a=d[g++],r.b=d[g++],r.c=d[g++],E&&(E=d[g++],r.materialIndex=E),E=s.faces.length,v)for(v=0;v<n;v++)for(S=p.uvs[v],s.faceVertexUvs[v][E]=[],e=0;3>e;e++)M=d[g++],y=S[2*M],M=S[2*M+1],y=new o(y,M),s.faceVertexUvs[v][E].push(y);if(u&&(u=3*d[g++],r.normal.set(b[u++],b[u++],b[u])),T)for(v=0;3>v;v++)u=3*d[g++],T=new _(b[u++],b[u++],b[u]),r.vertexNormals.push(T);if(l&&(l=d[g++],r.color.setHex(m[l])),h)for(v=0;3>v;v++)l=d[g++],r.vertexColors.push(new Oe(m[l]));s.faces.push(r)}}if(p=t,g=void 0===p.influencesPerVertex?2:p.influencesPerVertex,p.skinWeights)for(f=0,d=p.skinWeights.length;f<d;f+=g)s.skinWeights.push(new j(p.skinWeights[f],1<g?p.skinWeights[f+1]:0,2<g?p.skinWeights[f+2]:0,3<g?p.skinWeights[f+3]:0));if(p.skinIndices)for(f=0,d=p.skinIndices.length;f<d;f+=g)s.skinIndices.push(new j(p.skinIndices[f],1<g?p.skinIndices[f+1]:0,2<g?p.skinIndices[f+2]:0,3<g?p.skinIndices[f+3]:0));if(s.bones=p.bones,s.bones&&0<s.bones.length&&(s.skinWeights.length!==s.skinIndices.length||s.skinIndices.length!==s.vertices.length)&&console.warn("When skinning, number of vertices ("+s.vertices.length+"), skinIndices ("+s.skinIndices.length+"), and skinWeights ("+s.skinWeights.length+") should match."),f=t,d=f.scale,void 0!==f.morphTargets)for(p=0,g=f.morphTargets.length;p<g;p++)for(s.morphTargets[p]={},s.morphTargets[p].name=f.morphTargets[p].name,s.morphTargets[p].vertices=[],b=s.morphTargets[p].vertices,m=f.morphTargets[p].vertices,n=0,h=m.length;n<h;n+=3)l=new _,l.x=m[n]*d,l.y=m[n+1]*d,l.z=m[n+2]*d,b.push(l);if(void 0!==f.morphColors&&0<f.morphColors.length)for(console.warn("THREE.JSONLoader: \"morphColors\" no longer supported. Using them as face colors."),d=s.faces,f=f.morphColors[0].colors,p=0,g=d.length;p<g;p++)d[p].color.fromArray(f,3*p);for(f=t,p=[],g=[],void 0!==f.animation&&g.push(f.animation),void 0!==f.animations&&(f.animations.length?g=g.concat(f.animations):g.push(f.animations)),f=0;f<g.length;f++)(d=ni.parseAnimation(g[f],s.bones))&&p.push(d);return(s.morphTargets&&(g=ni.CreateClipsFromMorphTargetSequences(s.morphTargets,10),p=p.concat(g)),0<p.length&&(s.animations=p),s.computeFaceNormals(),s.computeBoundingSphere(),void 0===t.materials||0===t.materials.length)?{geometry:s}:(t=je.prototype.initMaterials(t.materials,i,this.crossOrigin),{geometry:s,materials:t})}}()}),Object.assign(ke.prototype,{load:function(t,r,a,o){""===this.texturePath&&(this.texturePath=t.substring(0,t.lastIndexOf("/")+1));var i=this;new fe(i.manager).load(t,function(e){var a=null;try{a=JSON.parse(e)}catch(e){return void 0!==o&&o(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}e=a.metadata,void 0===e||void 0===e.type||"geometry"===e.type.toLowerCase()?console.error("THREE.ObjectLoader: Can't load "+t+". Use THREE.JSONLoader instead."):i.parse(a,r)},a,o)},setTexturePath:function(e){this.texturePath=e},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(t,r){var a=this.parseShape(t.shapes),a=this.parseGeometries(t.geometries,a),o=this.parseImages(t.images,function(){void 0!==r&&r(i)}),o=this.parseTextures(t.textures,o),o=this.parseMaterials(t.materials,o),i=this.parseObject(t.object,a,o);return t.animations&&(i.animations=this.parseAnimations(t.animations)),void 0!==t.images&&0!==t.images.length||void 0===r||r(i),i},parseShape:function(t){var r={};if(void 0!==t)for(var a=0,o=t.length,i;a<o;a++)i=new zo().fromJSON(t[a]),r[i.uuid]=i;return r},parseGeometries:function(t,r){var a={};if(void 0!==t)for(var o=new li,i=new si,e=0,n=t.length,s;e<n;e++){switch(s=t[e],s.type){case"PlaneGeometry":case"PlaneBufferGeometry":var l=new Ya[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":l=new Ya[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":l=new Ya[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":l=new Ya[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":l=new Ya[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":l=new Ya[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":l=new Ya[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":l=new Ya[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":l=new Ya[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":l=new Ya[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"LatheGeometry":case"LatheBufferGeometry":l=new Ya[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":l=new Ya[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(l=[],e=0,n=s.shapes.length;e<n;e++)l.push(r[s.shapes[e]]);l=new Ya[s.type](l,s.curveSegments);break;case"BufferGeometry":l=i.parse(s);break;case"Geometry":l=o.parse(s,this.texturePath).geometry;break;default:console.warn("THREE.ObjectLoader: Unsupported geometry type \""+s.type+"\"");continue;}l.uuid=s.uuid,void 0!==s.name&&(l.name=s.name),a[s.uuid]=l}return a},parseMaterials:function(t,r){var a={};if(void 0!==t){var o=new Ca;o.setTextures(r),r=0;for(var i=t.length,e;r<i;r++)if(e=t[r],"MultiMaterial"===e.type){for(var n=[],s=0;s<e.materials.length;s++)n.push(o.parse(e.materials[s]));a[e.uuid]=n}else a[e.uuid]=o.parse(e)}return a},parseAnimations:function(e){for(var t=[],r=0,a;r<e.length;r++)a=ni.parse(e[r]),t.push(a);return t},parseImages:function(t,r){function a(t){return o.manager.itemStart(t),e.load(t,function(){o.manager.itemEnd(t)},void 0,function(){o.manager.itemEnd(t),o.manager.itemError(t)})}var o=this,i={};if(void 0!==t&&0<t.length){r=new _o(r);var e=new ge(r);e.setCrossOrigin(this.crossOrigin),r=0;for(var n=t.length;r<n;r++){var s=t[r],l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(s.url)?s.url:o.texturePath+s.url;i[s.uuid]=a(l)}}return i},parseTextures:function(t,a){function o(e,t){return"number"===typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var i={};if(void 0!==t)for(var n=0,e=t.length,s;n<e;n++){s=t[n],void 0===s.image&&console.warn("THREE.ObjectLoader: No \"image\" specified for",s.uuid),void 0===a[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);var l=new r(a[s.image]);l.needsUpdate=!0,l.uuid=s.uuid,void 0!==s.name&&(l.name=s.name),void 0!==s.mapping&&(l.mapping=o(s.mapping,Ge)),void 0!==s.offset&&l.offset.fromArray(s.offset),void 0!==s.repeat&&l.repeat.fromArray(s.repeat),void 0!==s.center&&l.center.fromArray(s.center),void 0!==s.rotation&&(l.rotation=s.rotation),void 0!==s.wrap&&(l.wrapS=o(s.wrap[0],Un),l.wrapT=o(s.wrap[1],Un)),void 0!==s.minFilter&&(l.minFilter=o(s.minFilter,Dn)),void 0!==s.magFilter&&(l.magFilter=o(s.magFilter,Dn)),void 0!==s.anisotropy&&(l.anisotropy=s.anisotropy),void 0!==s.flipY&&(l.flipY=s.flipY),i[s.uuid]=l}return i},parseObject:function(t,r,o){function a(e){return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),r[e]}function i(t){if(void 0!==t){if(Array.isArray(t)){for(var r=[],a=0,i=t.length,n;a<i;a++)n=t[a],void 0===o[n]&&console.warn("THREE.ObjectLoader: Undefined material",n),r.push(o[n]);return r}return void 0===o[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),o[t]}}switch(t.type){case"Scene":var e=new gr;void 0!==t.background&&rn(t.background)&&(e.background=new Oe(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?e.fog=new ur(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(e.fog=new be(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":e=new lr(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(e.focus=t.focus),void 0!==t.zoom&&(e.zoom=t.zoom),void 0!==t.filmGauge&&(e.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(e.filmOffset=t.filmOffset),void 0!==t.view&&(e.view=Object.assign({},t.view));break;case"OrthographicCamera":e=new mt(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":e=new Yo(t.color,t.intensity);break;case"DirectionalLight":e=new Xo(t.color,t.intensity);break;case"PointLight":e=new Wo(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":e=new qo(t.color,t.intensity,t.width,t.height);break;case"SpotLight":e=new ko(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":e=new Oo(t.color,t.groundColor,t.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":e=a(t.geometry);var n=i(t.material);e=e.bones&&0<e.bones.length?new _r(e,n):new Ut(e,n);break;case"LOD":e=new yr;break;case"Line":e=new Er(a(t.geometry),i(t.material),t.mode);break;case"LineLoop":e=new Sr(a(t.geometry),i(t.material));break;case"LineSegments":e=new Tr(a(t.geometry),i(t.material));break;case"PointCloud":case"Points":e=new Ar(a(t.geometry),i(t.material));break;case"Sprite":e=new hr(i(t.material));break;case"Group":e=new wr;break;default:e=new dt;}if(e.uuid=t.uuid,void 0!==t.name&&(e.name=t.name),void 0===t.matrix?(void 0!==t.position&&e.position.fromArray(t.position),void 0!==t.rotation&&e.rotation.fromArray(t.rotation),void 0!==t.quaternion&&e.quaternion.fromArray(t.quaternion),void 0!==t.scale&&e.scale.fromArray(t.scale)):(e.matrix.fromArray(t.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale)),void 0!==t.castShadow&&(e.castShadow=t.castShadow),void 0!==t.receiveShadow&&(e.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(e.shadow.bias=t.shadow.bias),void 0!==t.shadow.radius&&(e.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&e.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(e.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(e.visible=t.visible),void 0!==t.userData&&(e.userData=t.userData),void 0!==t.children)for(var n=t.children,s=0;s<n.length;s++)e.add(this.parseObject(n[s],r,o));if("LOD"===t.type)for(t=t.levels,n=0;n<t.length;n++){var s=t[n],l=e.getObjectByProperty("uuid",s.object);void 0!==l&&e.addLevel(l,s.distance)}return e}});var Ge={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,SphericalReflectionMapping:305,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},Un={RepeatWrapping:1E3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},Dn={NearestFilter:1003,NearestMipMapNearestFilter:1004,NearestMipMapLinearFilter:1005,LinearFilter:1006,LinearMipMapNearestFilter:1007,LinearMipMapLinearFilter:1008};pi.prototype={constructor:pi,setOptions:function(e){return this.options=e,this},load:function(t,r,a,o){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t);var i=this,e=Rn.get(t);return void 0===e?void fetch(t).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,i.options)}).then(function(e){Rn.add(t,e),r&&r(e),i.manager.itemEnd(t)}).catch(function(e){o&&o(e),i.manager.itemEnd(t),i.manager.itemError(t)}):(i.manager.itemStart(t),setTimeout(function(){r&&r(e),i.manager.itemEnd(t)},0),e)},setCrossOrigin:function(){return this},setPath:function(e){return this.path=e,this}},Object.assign(di.prototype,{moveTo:function(e,t){this.currentPath=new Fo,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t)},lineTo:function(e,t){this.currentPath.lineTo(e,t)},quadraticCurveTo:function(e,t,r,a){this.currentPath.quadraticCurveTo(e,t,r,a)},bezierCurveTo:function(t,r,a,o,i,e){this.currentPath.bezierCurveTo(t,r,a,o,i,e)},splineThru:function(e){this.currentPath.splineThru(e)},toShapes:function(t,a){function o(t){for(var r=[],a=0,o=t.length;a<o;a++){var i=t[a],e=new zo;e.curves=i.curves,r.push(e)}return r}function i(t,r){for(var a=r.length,o=!1,i=a-1,e=0;e<a;i=e++){var n=r[i],s=r[e],p=s.x-n.x,c=s.y-n.y;if(fn(c)>an){if(0>c&&(n=r[e],p=-p,s=r[i],c=-c),!(t.y<n.y||t.y>s.y))if(t.y!==n.y){if(i=c*(t.x-n.x)-p*(t.y-n.y),0===i)return!0;0>i||(o=!o)}else if(t.x===n.x)return!0;}else if(t.y===n.y&&(s.x<=t.x&&t.x<=n.x||n.x<=t.x&&t.x<=s.x))return!0}return o}var s=wn.isClockWise,d=this.subPaths;if(0===d.length)return[];if(!0===a)return o(d);if(a=[],1===d.length){var c=d[0],m=new zo;return m.curves=c.curves,a.push(m),a}var f=!s(d[0].getPoints()),f=t?!f:f;m=[];var h=[],l=[],p=0;h[p]=void 0,l[p]=[];for(var n=0,y=d.length;n<y;n++){c=d[n];var r=c.getPoints(),x=s(r);(x=t?!x:x)?(!f&&h[p]&&p++,h[p]={s:new zo,p:r},h[p].s.curves=c.curves,f&&p++,l[p]=[]):l[p].push({h:c,p:r[0]})}if(!h[0])return o(d);if(1<h.length){for(n=!1,t=[],s=0,d=h.length;s<d;s++)m[s]=[];for(s=0,d=h.length;s<d;s++)for(c=l[s],x=0;x<c.length;x++){for(f=c[x],p=!0,r=0;r<h.length;r++)i(f.p,h[r].p)&&(s!==r&&t.push({froms:s,tos:r,hole:x}),p?(p=!1,m[r].push(f)):n=!0);p&&m[s].push(f)}0<t.length&&(n||(l=m))}for(n=0,s=h.length;n<s;n++)for(m=h[n].s,a.push(m),t=l[n],d=0,c=t.length;d<c;d++)m.holes.push(t[d].h);return a}}),Object.assign(me.prototype,{isFont:!0,generateShapes:function(t,a,o){void 0===a&&(a=100),o=[];var i=a;a=this.data;var s=(t+"").split(""),i=i/a.resolution,e=(a.boundingBox.yMax-a.boundingBox.yMin+a.underlineThickness)*i;t=[];for(var d=0,c=0,m=0,g;m<s.length;m++)if(g=s[m],"\n"===g)d=0,c-=e;else{var l=i,p=d,n=c;if(g=a.glyphs[g]||a.glyphs["?"]){var f=new di;if(g.o)for(var h=g._cachedOutline||(g._cachedOutline=g.o.split(" ")),v=0,u=h.length;v<u;)switch(h[v++]){case"m":var _=h[v++]*l+p,x=h[v++]*l+n;f.moveTo(_,x);break;case"l":_=h[v++]*l+p,x=h[v++]*l+n,f.lineTo(_,x);break;case"q":var b=h[v++]*l+p,E=h[v++]*l+n,y=h[v++]*l+p,T=h[v++]*l+n;f.quadraticCurveTo(y,T,b,E);break;case"b":b=h[v++]*l+p,E=h[v++]*l+n,y=h[v++]*l+p,T=h[v++]*l+n,_=h[v++]*l+p,x=h[v++]*l+n,f.bezierCurveTo(y,T,_,x,b,E);}l={offsetX:g.ha*l,path:f}}else l=void 0;d+=l.offsetX,t.push(l.path)}for(a=0,s=t.length;a<s;a++)Array.prototype.push.apply(o,t[a].toShapes());return o}}),Object.assign(ne.prototype,{load:function(t,r,a,o){var i=this,e=new fe(this.manager);e.setPath(this.path),e.load(t,function(e){try{var t=JSON.parse(e)}catch(r){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),t=JSON.parse(e.substring(65,e.length-2))}e=i.parse(t),r&&r(e)},a,o)},parse:function(e){return new me(e)},setPath:function(e){return this.path=e,this}});var Bn={getContext:function(){return void 0===qe&&(qe=new(window.AudioContext||window.webkitAudioContext)),qe},setContext:function(e){qe=e}},qe;Object.assign(ci.prototype,{load:function(t,r,a,o){var i=new fe(this.manager);i.setResponseType("arraybuffer"),i.load(t,function(e){Bn.getContext().decodeAudioData(e,function(e){r(e)})},a,o)}}),Object.assign(oe.prototype,{update:function(){var o=new i,s=new i,l,a,u,c,d,e,f,g;return function(i){if(l!==this||a!==i.focus||u!==i.fov||c!==i.aspect*this.aspect||d!==i.near||e!==i.far||f!==i.zoom||g!==this.eyeSep){l=this,a=i.focus,u=i.fov,c=i.aspect*this.aspect,d=i.near,e=i.far,f=i.zoom;var m=i.projectionMatrix.clone();g=this.eyeSep/2;var n=g*d/a,p=d*Ce(.5*(yn.DEG2RAD*u))/f;s.elements[12]=-g,o.elements[12]=g;var y=-p*c+n,x=p*c+n;m.elements[0]=2*d/(x-y),m.elements[8]=(x+y)/(x-y),this.cameraL.projectionMatrix.copy(m),y=-p*c-n,x=p*c-n,m.elements[0]=2*d/(x-y),m.elements[8]=(x+y)/(x-y),this.cameraR.projectionMatrix.copy(m)}this.cameraL.matrixWorld.copy(i.matrixWorld).multiply(s),this.cameraR.matrixWorld.copy(i.matrixWorld).multiply(o)}}()}),mi.prototype=Object.create(dt.prototype),mi.prototype.constructor=mi,ui.prototype=Object.assign(Object.create(dt.prototype),{constructor:ui,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(e){null===this.filter?this.gain.disconnect(this.context.destination):(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){this.gain.gain.value=e},updateMatrixWorld:function(){var t=new _,r=new s,a=new _,o=new _;return function(i){dt.prototype.updateMatrixWorld.call(this,i),i=this.context.listener;var e=this.up;this.matrixWorld.decompose(t,r,a),o.set(0,0,-1).applyQuaternion(r),i.positionX?(i.positionX.setValueAtTime(t.x,this.context.currentTime),i.positionY.setValueAtTime(t.y,this.context.currentTime),i.positionZ.setValueAtTime(t.z,this.context.currentTime),i.forwardX.setValueAtTime(o.x,this.context.currentTime),i.forwardY.setValueAtTime(o.y,this.context.currentTime),i.forwardZ.setValueAtTime(o.z,this.context.currentTime),i.upX.setValueAtTime(e.x,this.context.currentTime),i.upY.setValueAtTime(e.y,this.context.currentTime),i.upZ.setValueAtTime(e.z,this.context.currentTime)):(i.setPosition(t.x,t.y,t.z),i.setOrientation(o.x,o.y,o.z,e.x,e.y,e.z))}}()}),gi.prototype=Object.assign(Object.create(dt.prototype),{constructor:gi,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0===this.isPlaying)console.warn("THREE.Audio: Audio is already playing.");else if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else{var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.onended=this.onEnded.bind(this),e.playbackRate.setValueAtTime(this.playbackRate,this.startTime),this.startTime=this.context.currentTime,e.start(this.startTime,this.offset),this.isPlaying=!0,this.source=e,this.connect()}},pause:function(){return!1===this.hasPlaybackControl?void console.warn("THREE.Audio: this Audio has no playback control."):(!0===this.isPlaying&&(this.source.stop(),this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this)},stop:function(){return!1===this.hasPlaybackControl?void console.warn("THREE.Audio: this Audio has no playback control."):(this.source.stop(),this.offset=0,this.isPlaying=!1,this)},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){return!1===this.hasPlaybackControl?void console.warn("THREE.Audio: this Audio has no playback control."):(this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this)},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){return!1===this.hasPlaybackControl?void console.warn("THREE.Audio: this Audio has no playback control."):(this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this)},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.value=e,this}}),fi.prototype=Object.assign(Object.create(gi.prototype),{constructor:fi,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){this.panner.refDistance=e},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){this.panner.rolloffFactor=e},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){this.panner.distanceModel=e},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){this.panner.maxDistance=e},updateMatrixWorld:function(){var e=new _;return function(t){dt.prototype.updateMatrixWorld.call(this,t),e.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(e.x,e.y,e.z)}}()}),Object.assign(hi.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),r=0;r<t.length;r++)e+=t[r];return e/t.length}}),Object.assign(se.prototype,{accumulate:function(t,r){var a=this.buffer,o=this.valueSize;t=t*o+o;var i=this.cumulativeWeight;if(0===i){for(i=0;i!==o;++i)a[t+i]=a[i];i=r}else i+=r,this._mixBufferRegion(a,t,0,r/i,o);this.cumulativeWeight=i},apply:function(t){var r=this.valueSize,a=this.buffer;t=t*r+r;var o=this.cumulativeWeight,i=this.binding;this.cumulativeWeight=0,1>o&&this._mixBufferRegion(a,t,3*r,1-o,r);for(var o=r;o!==r+r;++o)if(a[o]!==a[o+r]){i.setValue(a,t);break}},saveOriginalState:function(){var e=this.buffer,t=this.valueSize,r=3*t;this.binding.getValue(e,r);for(var a=t;a!==r;++a)e[a]=e[r+a%t];this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_select:function(t,r,a,o,i){if(.5<=o)for(o=0;o!==i;++o)t[r+o]=t[a+o]},_slerp:function(e,t,r,a){s.slerpFlat(e,t,e,t,e,r,a)},_lerp:function(t,r,a,o,i){for(var e=0,n;e!==i;++e)n=r+e,t[n]=t[n]*(1-o)+t[a+e]*o}}),Object.assign(te.prototype,{getValue:function(e,t){this.bind();var r=this._bindings[this._targetGroup.nCachedObjects_];void 0!==r&&r.getValue(e,t)},setValue:function(t,r){for(var a=this._bindings,o=this._targetGroup.nCachedObjects_,i=a.length;o!==i;++o)a[o].setValue(t,r)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}}),Object.assign(yi,{Composite:te,create:function(e,t,r){return e&&e.isAnimationObjectGroup?new yi.Composite(e,t,r):new yi(e,t,r)},sanitizeNodeName:function(){var e=/[\[\]\.:\/]/g;return function(t){return t.replace(/\s/g,"_").replace(e,"")}}(),parseTrackName:function(){var t="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",r=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),t=/(WCOD+)?/.source.replace("WCOD",t),a=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),o=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),i=new RegExp("^"+r+t+a+o+"$"),e=["material","materials","bones"];return function(t){var r=i.exec(t);if(!r)throw Error("PropertyBinding: Cannot parse trackName: "+t);var r={nodeName:r[2],objectName:r[3],objectIndex:r[4],propertyName:r[5],propertyIndex:r[6]},a=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==a&&-1!==a){var o=r.nodeName.substring(a+1);-1!==e.indexOf(o)&&(r.nodeName=r.nodeName.substring(0,a),r.objectName=o)}if(null===r.propertyName||0===r.propertyName.length)throw Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r}}(),findNode:function(e,t){if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var r=e.skeleton.getBoneByName(t);if(void 0!==r)return r}if(e.children){var a=function r(o){for(var a=0,i;a<o.length;a++)if(i=o[a],i.name===t||i.uuid===t||(i=r(i.children)))return i;return null};if(e=a(e.children))return e}return null}}),Object.assign(yi.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(t,r){for(var a=this.resolvedProperty,o=0,i=a.length;o!==i;++o)t[r++]=a[o]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,r){for(var a=this.resolvedProperty,o=0,i=a.length;o!==i;++o)a[o]=t[r++]},function(t,r){for(var a=this.resolvedProperty,o=0,i=a.length;o!==i;++o)a[o]=t[r++];this.targetObject.needsUpdate=!0},function(t,r){for(var a=this.resolvedProperty,o=0,i=a.length;o!==i;++o)a[o]=t[r++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var t=this.node,r=this.parsedPath,a=r.objectName,o=r.propertyName,i=r.propertyIndex;if(t||(this.node=t=yi.findNode(this.rootNode,r.nodeName)||this.rootNode),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(a){var e=r.objectIndex;switch(a){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);for(t=t.skeleton.bones,a=0;a<t.length;a++)if(t[a].name===e){e=a;break}break;default:if(void 0===t[a])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[a];}if(void 0!==e){if(void 0===t[e])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[e]}}if(e=t[o],void 0===e)console.error("THREE.PropertyBinding: Trying to update property for track: "+r.nodeName+"."+o+" but it wasn't found.",t);else{if(r=this.Versioning.None,void 0===t.needsUpdate?void 0!==t.matrixWorldNeedsUpdate&&(r=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=t):(r=this.Versioning.NeedsUpdate,this.targetObject=t),a=this.BindingType.Direct,void 0!==i){if("morphTargetInfluences"===o){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(a=0;a<this.node.geometry.morphAttributes.position.length;a++)if(t.geometry.morphAttributes.position[a].name===i){i=a;break}}else{if(!t.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(a=0;a<this.node.geometry.morphTargets.length;a++)if(t.geometry.morphTargets[a].name===i){i=a;break}}}a=this.BindingType.ArrayElement,this.resolvedProperty=e,this.propertyIndex=i}else void 0!==e.fromArray&&void 0!==e.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=e):Array.isArray(e)?(a=this.BindingType.EntireArray,this.resolvedProperty=e):this.propertyName=o;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][r]}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(yi.prototype,{_getValue_unbound:yi.prototype.getValue,_setValue_unbound:yi.prototype.setValue}),Object.assign(pa.prototype,{isAnimationObjectGroup:!0,add:function(){for(var t=this._objects,a=t.length,o=this.nCachedObjects_,i=this._indicesByUUID,s=this._paths,e=this._parsedPaths,d=this._bindings,c=d.length,m=void 0,g=0,l=arguments.length;g!==l;++g){var p=arguments[g],n=p.uuid,f=i[n];if(void 0===f){f=a++,i[n]=f,t.push(p);for(var n=0,r=c;n!==r;++n)d[n].push(new yi(p,s[n],e[n]))}else if(f<o){var m=t[f],h=--o,r=t[h];for(i[r.uuid]=f,t[f]=r,i[n]=h,t[h]=p,n=0,r=c;n!==r;++n){var u=d[n],y=u[f];u[f]=u[h],void 0===y&&(y=new yi(p,s[n],e[n])),u[h]=y}}else t[f]!==m&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=o},remove:function(){for(var t=this._objects,r=this.nCachedObjects_,a=this._indicesByUUID,o=this._bindings,i=o.length,e=0,s=arguments.length;e!==s;++e){var d=arguments[e],c=d.uuid,m=a[c];if(void 0!==m&&m>=r){var l=r++,p=t[l];for(a[p.uuid]=m,t[m]=p,a[c]=l,t[l]=d,d=0,c=i;d!==c;++d){var p=o[d],n=p[m];p[m]=p[l],p[l]=n}}}this.nCachedObjects_=r},uncache:function(){for(var t=this._objects,o=t.length,i=this.nCachedObjects_,e=this._indicesByUUID,s=this._bindings,d=s.length,c=0,m=arguments.length,l,a;c!==m;++c){a=arguments[c].uuid;var u=e[a];if(void 0!==u)if(delete e[a],u<i){var p=--i,n=t[p];a=--o,l=t[a],e[n.uuid]=u,t[u]=n,e[l.uuid]=p,t[p]=l,t.pop();for(var n=0,g=d;n!==g;++n){l=s[n];var r=l[a];l[u]=l[p],l[p]=r,l.pop()}}else for(a=--o,l=t[a],e[l.uuid]=u,t[u]=l,t.pop(),n=0,g=d;n!==g;++n)l=s[n],l[u]=l[a],l.pop()}this.nCachedObjects_=i},subscribe_:function(t,r){var a=this._bindingsIndicesByPath,o=a[t],i=this._bindings;if(void 0!==o)return i[o];var e=this._paths,n=this._parsedPaths,s=this._objects,p=this.nCachedObjects_,d=Array(s.length),o=i.length;for(a[t]=o,e.push(t),n.push(r),i.push(d),a=p,o=s.length;a!==o;++a)d[a]=new yi(s[a],t,r);return d},unsubscribe_:function(t){var r=this._bindingsIndicesByPath,a=r[t];if(void 0!==a){var o=this._paths,i=this._parsedPaths,e=this._bindings,n=e.length-1,s=e[n];r[t[n]]=a,e[a]=s,e.pop(),i[a]=i[n],i.pop(),o[a]=o[n],o.pop()}}}),Object.assign(xi.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(t,r,a){if(t.fadeOut(r),this.fadeIn(r),a){a=this._clip.duration;var o=t._clip.duration,i=a/o;t.warp(1,o/a,r),this.warp(i,1,r)}return this},crossFadeTo:function(e,t,r){return e.crossFadeFrom(this,t,r)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(t,r,a){var o=this._mixer,i=o.time,e=this._timeScaleInterpolant,n=this.timeScale;return null===e&&(this._timeScaleInterpolant=e=o._lendControlInterpolant()),o=e.parameterPositions,e=e.sampleValues,o[0]=i,o[1]=i+a,e[0]=t/n,e[1]=r/n,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,r,a,o){if(this.enabled){var i=this._startTime;if(null!==i){if(r=(t-i)*a,0>r||0===a)return;this._startTime=null,r*=a}if(r*=this._updateTimeScale(t),a=this._updateTime(r),t=this._updateWeight(t),0<t){r=this._interpolants;for(var i=this._propertyBindings,e=0,n=r.length;e!==n;++e)r[e].evaluate(a),i[e].accumulate(o,t)}}else this._updateWeight(t)},_updateWeight:function(e){var t=0;if(this.enabled){var t=this.weight,r=this._weightInterpolant;if(null!==r){var a=r.evaluate(e)[0],t=t*a;e>r.parameterPositions[1]&&(this.stopFading(),0===a&&(this.enabled=!1))}}return this._effectiveWeight=t},_updateTimeScale:function(e){var t=0;if(!this.paused){var t=this.timeScale,r=this._timeScaleInterpolant;if(null!==r){var a=r.evaluate(e)[0],t=t*a;e>r.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t},_updateTime:function(t){var r=this.time+t;if(0===t)return r;var o=this._clip.duration,i=this.loop,n=this._loopCount;if(2200===i)a:{if(-1===n&&(this._loopCount=0,this._setEndings(!0,!0,!1)),r>=o)r=o;else if(0>r)r=0;else break a;this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:0>t?-1:1})}else{if(i=2202===i,-1===n&&(0<=t?(n=0,this._setEndings(!0,0===this.repetitions,i)):this._setEndings(0===this.repetitions,!0,i)),r>=o||0>r){var e=hn(r/o),r=r-o*e,n=n+fn(e),s=this.repetitions-n;0>s?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=0<t?o:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<t?1:-1})):(0===s?(t=0>t,this._setEndings(t,!t,i)):this._setEndings(!1,!1,i),this._loopCount=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:e}))}if(i&&1===(1&n))return this.time=r,o-r}return this.time=r},_setEndings:function(e,t,r){var a=this._interpolantSettings;r?(a.endingStart=2401,a.endingEnd=2401):(a.endingStart=e?this.zeroSlopeAtStart?2401:2400:2402,a.endingEnd=t?this.zeroSlopeAtEnd?2401:2400:2402)},_scheduleFading:function(t,r,a){var o=this._mixer,i=o.time,e=this._weightInterpolant;return null===e&&(this._weightInterpolant=e=o._lendControlInterpolant()),o=e.parameterPositions,e=e.sampleValues,o[0]=i,e[0]=r,o[1]=i+t,e[1]=a,this}}),vi.prototype=Object.assign(Object.create(t.prototype),{constructor:vi,_bindAction:function(t,r){var a=t._localRoot||this._root,o=t._clip.tracks,i=o.length,e=t._propertyBindings;t=t._interpolants;var s=a.uuid,d=this._bindingsByRootAndName,c=d[s];for(void 0===c&&(c={},d[s]=c),d=0;d!==i;++d){var m=o[d],l=m.name,p=c[l];if(void 0===p){if(p=e[d],void 0!==p){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,s,l));continue}p=new se(yi.create(a,l,r&&r._propertyBindings[d].binding.parsedPath),m.ValueTypeName,m.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,s,l)}e[d]=p,t[d].resultBuffer=p.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){var r=(t._localRoot||this._root).uuid,a=t._clip.uuid,o=this._actionsByClip[a];this._bindAction(t,o&&o.knownActions[0]),this._addInactiveAction(t,a,r)}for(r=t._propertyBindings,a=0,o=r.length;a!==o;++a){var i=r[a];0===i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){for(var r=t._propertyBindings,a=0,o=r.length,i;a!==o;++a)i=r[a],0===--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i));this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){return e=e._cacheIndex,null!==e&&e<this._nActiveActions},_addInactiveAction:function(t,r,a){var o=this._actions,i=this._actionsByClip,e=i[r];void 0===e?(e={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,i[r]=e):(r=e.knownActions,t._byClipCacheIndex=r.length,r.push(t)),t._cacheIndex=o.length,o.push(t),e.actionByRoot[a]=t},_removeInactiveAction:function(t){var r=this._actions,a=r[r.length-1],o=t._cacheIndex;a._cacheIndex=o,r[o]=a,r.pop(),t._cacheIndex=null;var r=t._clip.uuid,a=this._actionsByClip,o=a[r],i=o.knownActions,e=i[i.length-1],n=t._byClipCacheIndex;e._byClipCacheIndex=n,i[n]=e,i.pop(),t._byClipCacheIndex=null,delete o.actionByRoot[(t._localRoot||this._root).uuid],0===i.length&&delete a[r],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(e){e=e._propertyBindings;for(var t=0,r=e.length,a;t!==r;++t)a=e[t],0===--a.referenceCount&&this._removeInactiveBinding(a)},_lendAction:function(t){var r=this._actions,a=t._cacheIndex,o=this._nActiveActions++,i=r[o];t._cacheIndex=o,r[o]=t,i._cacheIndex=a,r[a]=i},_takeBackAction:function(t){var r=this._actions,a=t._cacheIndex,o=--this._nActiveActions,i=r[o];t._cacheIndex=o,r[o]=t,i._cacheIndex=a,r[a]=i},_addInactiveBinding:function(t,r,a){var o=this._bindingsByRootAndName,i=o[r],e=this._bindings;void 0===i&&(i={},o[r]=i),i[a]=t,t._cacheIndex=e.length,e.push(t)},_removeInactiveBinding:function(t){var r=this._bindings,a=t.binding,o=a.rootNode.uuid,a=a.path,i=this._bindingsByRootAndName,e=i[o],n=r[r.length-1];t=t._cacheIndex,n._cacheIndex=t,r[t]=n,r.pop(),delete e[a];a:{for(var s in e)break a;delete i[o]}},_lendBinding:function(t){var r=this._bindings,a=t._cacheIndex,o=this._nActiveBindings++,i=r[o];t._cacheIndex=o,r[o]=t,i._cacheIndex=a,r[a]=i},_takeBackBinding:function(t){var r=this._bindings,a=t._cacheIndex,o=--this._nActiveBindings,i=r[o];t._cacheIndex=o,r[o]=t,i._cacheIndex=a,r[a]=i},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,r=e[t];return void 0===r&&(r=new ri(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),r.__cacheIndex=t,e[t]=r),r},_takeBackControlInterpolant:function(t){var r=this._controlInterpolants,a=t.__cacheIndex,o=--this._nActiveControlInterpolants,i=r[o];t.__cacheIndex=o,r[o]=t,i.__cacheIndex=a,r[a]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,r){var o=r||this._root,i=o.uuid,o="string"===typeof t?ni.findByName(o,t):t;t=null===o?t:o.uuid;var n=this._actionsByClip[t],e=null;if(void 0!==n){if(e=n.actionByRoot[i],void 0!==e)return e;e=n.knownActions[0],null===o&&(o=e._clip)}return null===o?null:(r=new xi(this,o,r),this._bindAction(r,e),this._addInactiveAction(r,t,i),r)},existingAction:function(e,t){var r=t||this._root;return t=r.uuid,r="string"===typeof e?ni.findByName(r,e):e,e=this._actionsByClip[r?r.uuid:e],void 0===e?null:e.actionByRoot[t]||null},stopAllAction:function(){for(var t=this._actions,r=this._nActiveActions,a=this._bindings,o=this._nActiveBindings,i=this._nActiveBindings=this._nActiveActions=0;i!==r;++i)t[i].reset();for(i=0;i!==o;++i)a[i].useCount=0;return this},update:function(t){t*=this.timeScale;for(var r=this._actions,a=this._nActiveActions,o=this.time+=t,i=tn(t),e=this._accuIndex^=1,n=0;n!==a;++n)r[n]._update(o,t,i,e);for(t=this._bindings,r=this._nActiveBindings,n=0;n!==r;++n)t[n].apply(e);return this},getRoot:function(){return this._root},uncacheClip:function(t){var r=this._actions;t=t.uuid;var a=this._actionsByClip,o=a[t];if(void 0!==o){for(var o=o.knownActions,i=0,e=o.length,n;i!==e;++i){n=o[i],this._deactivateAction(n);var s=n._cacheIndex,l=r[r.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,l._cacheIndex=s,r[s]=l,r.pop(),this._removeInactiveBindingsForAction(n)}delete a[t]}},uncacheRoot:function(t){t=t.uuid;var r=this._actionsByClip;for(o in r){var a=r[o].actionByRoot[t];void 0!==a&&(this._deactivateAction(a),this._removeInactiveAction(a))}var o=this._bindingsByRootAndName[t];if(void 0!==o)for(var i in o)t=o[i],t.restoreOriginalState(),this._removeInactiveBinding(t)},uncacheAction:function(e,t){e=this.existingAction(e,t),null!==e&&(this._deactivateAction(e),this._removeInactiveAction(e))}}),_i.prototype.clone=function(){return new _i(void 0===this.value.clone?this.value:this.value.clone())},bi.prototype=Object.assign(Object.create(St.prototype),{constructor:bi,isInstancedBufferGeometry:!0,copy:function(e){return St.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return new this.constructor().copy(this)}}),Object.defineProperties(Ei.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(Ei.prototype,{isInterleavedBufferAttribute:!0,setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this},setXYZ:function(e,t,r,a){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=a,this},setXYZW:function(t,r,a,o,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=r,this.data.array[t+1]=a,this.data.array[t+2]=o,this.data.array[t+3]=i,this}}),Object.defineProperty(we.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(we.prototype,{isInterleavedBuffer:!0,setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0===e?0:e.length/this.stride,this.array=e},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.dynamic=e.dynamic,this},copyAt:function(t,r,a){t*=this.stride,a*=r.stride;for(var o=0,i=this.stride;o<i;o++)this.array[t+o]=r.array[a+o];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return new this.constructor().copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}}),Ti.prototype=Object.assign(Object.create(we.prototype),{constructor:Ti,isInstancedInterleavedBuffer:!0,copy:function(e){return we.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Si.prototype=Object.assign(Object.create(ft.prototype),{constructor:Si,isInstancedBufferAttribute:!0,copy:function(e){return ft.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(Mi.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize()):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t){var r=[];return wi(e,this,r,t),r.sort(Ai),r},intersectObjects:function(t,r){var a=[];if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),a;for(var o=0,i=t.length;o<i;o++)wi(t[o],this,a,r);return a.sort(Ai),a}}),Object.assign(ze.prototype,{start:function(){this.oldTime=this.startTime=("undefined"===typeof performance?Date:performance).now(),this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.autoStart=this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"===typeof performance?Date:performance).now(),e=(t-this.oldTime)/1E3;this.oldTime=t,this.elapsedTime+=e}return e}}),Object.assign(Ri.prototype,{set:function(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=mn(1E-6,un(ln-1E-6,this.phi)),this},setFromVector3:function(e){return this.radius=e.length(),0===this.radius?this.phi=this.theta=0:(this.theta=nn(e.x,e.z),this.phi=Ki(yn.clamp(e.y/this.radius,-1,1))),this}}),Object.assign(Li.prototype,{set:function(e,t,r){return this.radius=e,this.theta=t,this.y=r,this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.radius=pn(e.x*e.x+e.z*e.z),this.theta=nn(e.x,e.z),this.y=e.y,this}}),Object.assign(Ci.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new o;return function(t,r){return r=e.copy(r).multiplyScalar(.5),this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=Infinity,this.max.x=this.max.y=-Infinity,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return e=e||new o,this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return e=e||new o,this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return(t||new o).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y?!1:!0},clampPoint:function(e,t){return(t||new o).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new o;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Ae.prototype=Object.create(dt.prototype),Ae.prototype.constructor=Ae,Ae.prototype.isImmediateRenderObject=!0,Pi.prototype=Object.create(Tr.prototype),Pi.prototype.constructor=Pi,Pi.prototype.update=function(){var t=new _,a=new _,o=new y;return function(){var i=["a","b","c"],e;this.object.updateMatrixWorld(!0),o.getNormalMatrix(this.object.matrixWorld);var s=this.object.matrixWorld,d=this.geometry.attributes.position;if((e=this.object.geometry)&&e.isGeometry)for(var c=e.vertices,m=e.faces,u=e=0,l=m.length;u<l;u++)for(var p=m[u],n=0,g=p.vertexNormals.length,r;n<g;n++)r=p.vertexNormals[n],t.copy(c[p[i[n]]]).applyMatrix4(s),a.copy(r).applyMatrix3(o).normalize().multiplyScalar(this.size).add(t),d.setXYZ(e,t.x,t.y,t.z),e+=1,d.setXYZ(e,a.x,a.y,a.z),e+=1;else if(e&&e.isBufferGeometry)for(i=e.attributes.position,c=e.attributes.normal,n=e=0,g=i.count;n<g;n++)t.set(i.getX(n),i.getY(n),i.getZ(n)).applyMatrix4(s),a.set(c.getX(n),c.getY(n),c.getZ(n)),a.applyMatrix3(o).normalize().multiplyScalar(this.size).add(t),d.setXYZ(e,t.x,t.y,t.z),e+=1,d.setXYZ(e,a.x,a.y,a.z),e+=1;d.needsUpdate=!0}}(),Ii.prototype=Object.create(dt.prototype),Ii.prototype.constructor=Ii,Ii.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Ii.prototype.update=function(){var e=new _,t=new _;return function(){this.light.updateMatrixWorld();var r=this.light.distance?this.light.distance:1E3,a=r*Ce(this.light.angle);this.cone.scale.set(a,a,r),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),void 0===this.color?this.cone.material.color.copy(this.light.color):this.cone.material.color.set(this.color)}}(),Ui.prototype=Object.create(Tr.prototype),Ui.prototype.constructor=Ui,Ui.prototype.updateMatrixWorld=function(){var t=new _,r=new i,a=new i;return function(o){var i=this.bones,e=this.geometry,n=e.getAttribute("position");a.getInverse(this.root.matrixWorld);for(var s=0,p=0,d;s<i.length;s++)d=i[s],d.parent&&d.parent.isBone&&(r.multiplyMatrices(a,d.matrixWorld),t.setFromMatrixPosition(r),n.setXYZ(p,t.x,t.y,t.z),r.multiplyMatrices(a,d.parent.matrixWorld),t.setFromMatrixPosition(r),n.setXYZ(p+1,t.x,t.y,t.z),p+=2);e.getAttribute("position").needsUpdate=!0,dt.prototype.updateMatrixWorld.call(this,o)}}(),Di.prototype=Object.create(Ut.prototype),Di.prototype.constructor=Di,Di.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Di.prototype.update=function(){void 0===this.color?this.material.color.copy(this.light.color):this.material.color.set(this.color)},Bi.prototype=Object.create(dt.prototype),Bi.prototype.constructor=Bi,Bi.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Bi.prototype.update=function(){var e=.5*this.light.width,t=.5*this.light.height,r=this.line.geometry.attributes.position,o=r.array;o[0]=e,o[1]=-t,o[2]=0,o[3]=e,o[4]=t,o[5]=0,o[6]=-e,o[7]=t,o[8]=0,o[9]=-e,o[10]=-t,o[11]=0,o[12]=e,o[13]=-t,o[14]=0,r.needsUpdate=!0,void 0===this.color?this.line.material.color.copy(this.light.color):this.line.material.color.set(this.color)},Fi.prototype=Object.create(dt.prototype),Fi.prototype.constructor=Fi,Fi.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Fi.prototype.update=function(){var t=new _,r=new Oe,a=new Oe;return function(){var o=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var i=o.geometry.getAttribute("color");r.copy(this.light.color),a.copy(this.light.groundColor);for(var e=0,n=i.count,s;e<n;e++)s=e<n/2?r:a,i.setXYZ(e,s.r,s.g,s.b);i.needsUpdate=!0}o.lookAt(t.setFromMatrixPosition(this.light.matrixWorld).negate())}}(),zi.prototype=Object.create(Tr.prototype),zi.prototype.constructor=zi,Gi.prototype=Object.create(Tr.prototype),Gi.prototype.constructor=Gi,Oi.prototype=Object.create(Tr.prototype),Oi.prototype.constructor=Oi,Oi.prototype.update=function(){var t=new _,r=new _,a=new y;return function(){this.object.updateMatrixWorld(!0),a.getNormalMatrix(this.object.matrixWorld);for(var o=this.object.matrixWorld,i=this.geometry.attributes.position,e=this.object.geometry,s=e.vertices,e=e.faces,d=0,c=0,m=e.length;c<m;c++){var l=e[c],p=l.normal;t.copy(s[l.a]).add(s[l.b]).add(s[l.c]).divideScalar(3).applyMatrix4(o),r.copy(p).applyMatrix3(a).normalize().multiplyScalar(this.size).add(t),i.setXYZ(d,t.x,t.y,t.z),d+=1,i.setXYZ(d,r.x,r.y,r.z),d+=1}i.needsUpdate=!0}}(),Hi.prototype=Object.create(dt.prototype),Hi.prototype.constructor=Hi,Hi.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Hi.prototype.update=function(){var e=new _,t=new _,r=new _;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),r.subVectors(t,e),this.lightPlane.lookAt(r),void 0===this.color?(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)):(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)),this.targetLine.lookAt(r),this.targetLine.scale.z=r.length()}}(),Vi.prototype=Object.create(Tr.prototype),Vi.prototype.constructor=Vi,Vi.prototype.update=function(){function t(t,n,s,l){if(r.set(n,s,l).unproject(o),t=i[t],void 0!==t)for(n=e.getAttribute("position"),s=0,l=t.length;s<l;s++)n.setXYZ(t[s],r.x,r.y,r.z)}var r=new _,o=new ct,e,i;return function(){e=this.geometry,i=this.pointMap,o.projectionMatrix.copy(this.camera.projectionMatrix),t("c",0,0,-1),t("t",0,0,1),t("n1",-1,-1,-1),t("n2",1,-1,-1),t("n3",-1,1,-1),t("n4",1,1,-1),t("f1",-1,-1,1),t("f2",1,-1,1),t("f3",-1,1,1),t("f4",1,1,1),t("u1",.7,1.1,-1),t("u2",-.7,1.1,-1),t("u3",0,2,-1),t("cf1",-1,0,1),t("cf2",1,0,1),t("cf3",0,-1,1),t("cf4",0,1,1),t("cn1",-1,0,-1),t("cn2",1,0,-1),t("cn3",0,-1,-1),t("cn4",0,1,-1),e.getAttribute("position").needsUpdate=!0}}(),ki.prototype=Object.create(Tr.prototype),ki.prototype.constructor=ki,ki.prototype.update=function(){var t=new at;return function(r){if(void 0!==r&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&t.setFromObject(this.object),!t.isEmpty()){r=t.min;var a=t.max,o=this.geometry.attributes.position,i=o.array;i[0]=a.x,i[1]=a.y,i[2]=a.z,i[3]=r.x,i[4]=a.y,i[5]=a.z,i[6]=r.x,i[7]=r.y,i[8]=a.z,i[9]=a.x,i[10]=r.y,i[11]=a.z,i[12]=a.x,i[13]=a.y,i[14]=r.z,i[15]=r.x,i[16]=a.y,i[17]=r.z,i[18]=r.x,i[19]=r.y,i[20]=r.z,i[21]=a.x,i[22]=r.y,i[23]=r.z,o.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),ki.prototype.setFromObject=function(e){return this.object=e,this.update(),this},Wi.prototype=Object.create(Tr.prototype),Wi.prototype.constructor=Wi,Wi.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),dt.prototype.updateMatrixWorld.call(this,e))},ji.prototype=Object.create(Er.prototype),ji.prototype.constructor=ji,ji.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;1e-8>fn(t)&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.lookAt(this.plane.normal),dt.prototype.updateMatrixWorld.call(this,e)};var Fn,zn;Xi.prototype=Object.create(dt.prototype),Xi.prototype.constructor=Xi,Xi.prototype.setDirection=function(){var e=new _,t;return function(r){.99999<r.y?this.quaternion.set(0,0,0,1):-.99999>r.y?this.quaternion.set(1,0,0,0):(e.set(r.z,0,-r.x).normalize(),t=Ki(r.y),this.quaternion.setFromAxisAngle(e,t))}}(),Xi.prototype.setLength=function(e,t,r){void 0===t&&(t=.2*e),void 0===r&&(r=.2*t),this.line.scale.set(1,mn(0,e-t),1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()},Xi.prototype.setColor=function(e){this.line.material.color.copy(e),this.cone.material.color.copy(e)},Yi.prototype=Object.create(Tr.prototype),Yi.prototype.constructor=Yi,To.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(To.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(Bo.prototype,{createPointsGeometry:function(e){return console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead."),e=this.getPoints(e),this.createGeometry(e)},createSpacedPointsGeometry:function(e){return console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead."),e=this.getSpacedPoints(e),this.createGeometry(e)},createGeometry:function(t){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var r=new gt,a=0,o=t.length,i;a<o;a++)i=t[a],r.vertices.push(new _(i.x,i.y,i.z||0));return r}}),Object.assign(Fo.prototype,{fromPoints:function(e){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),qi.prototype=Object.create(ie.prototype),Zi.prototype=Object.create(ie.prototype),Ji.prototype=Object.create(ie.prototype),Object.assign(Ji.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),zi.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Ui.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(je.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Nn.extractUrlBase(e)}}),Object.assign(Ci.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(at.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),It.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(yn,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),yn.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),yn.ceilPowerOfTwo(e)}}),Object.assign(y.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(i.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){var e;return function(){return void 0===e&&(e=new _),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),e.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,r,a,o,i,e){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,r,o,a,i,e)}}),it.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},s.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(Pt.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(zo.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Ea(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new eo(this,e)}}),Object.assign(o.prototype,{fromAttribute:function(e,t,r){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(_.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,r){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(j.prototype,{fromAttribute:function(e,t,r){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),gt.prototype.computeTangents=function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},Object.assign(dt.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)}}),Object.defineProperties(dt.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(yr.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(xr.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Object.defineProperty(To.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),lr.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(Go.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(ft.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}}}),Object.assign(St.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addDrawCall:function(e,t,r){void 0!==r&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(St.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(_i.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(et.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Oe}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}}}),Object.defineProperties(fo.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(Ct.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(Ze.prototype,{getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}}),Object.defineProperties(Ze.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(st.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(M.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.assign(dr.prototype,{getStandingMatrix:function(){console.warn("THREE.WebVRManager: .getStandingMatrix() has been removed.")}}),Object.defineProperties(dr.prototype,{standing:{set:function(){console.warn("THREE.WebVRManager: .standing has been removed.")}}}),gi.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return new ci().load(e,function(e){t.setBuffer(e)}),this},hi.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},mi.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},e.WebGLRenderTargetCube=n,e.WebGLRenderTarget=M,e.WebGLRenderer=Ze,e.ShaderLib=U,e.UniformsLib=_n,e.UniformsUtils=K,e.ShaderChunk=Aa,e.FogExp2=be,e.Fog=ur,e.Scene=gr,e.Sprite=hr,e.LOD=yr,e.SkinnedMesh=_r,e.Skeleton=xr,e.Bone=vr,e.Mesh=Ut,e.LineSegments=Tr,e.LineLoop=Sr,e.Line=Er,e.Points=Ar,e.Group=wr,e.VideoTexture=Rr,e.DataTexture=l,e.CompressedTexture=Lr,e.CubeTexture=p,e.CanvasTexture=G,e.DepthTexture=Cr,e.Texture=r,e.CompressedTextureLoader=Ia,e.DataTextureLoader=bo,e.CubeTextureLoader=Eo,e.TextureLoader=he,e.ObjectLoader=ke,e.MaterialLoader=Ca,e.BufferGeometryLoader=si,e.DefaultLoadingManager=Ln,e.LoadingManager=_o,e.JSONLoader=li,e.ImageLoader=ge,e.ImageBitmapLoader=pi,e.FontLoader=ne,e.FileLoader=fe,e.Loader=je,e.LoaderUtils=Nn,e.Cache=Rn,e.AudioLoader=ci,e.SpotLightShadow=Vo,e.SpotLight=ko,e.PointLight=Wo,e.RectAreaLight=qo,e.HemisphereLight=Oo,e.DirectionalLightShadow=jo,e.DirectionalLight=Xo,e.AmbientLight=Yo,e.LightShadow=Ho,e.Light=Go,e.StereoCamera=oe,e.PerspectiveCamera=lr,e.OrthographicCamera=mt,e.CubeCamera=mi,e.ArrayCamera=pr,e.Camera=ct,e.AudioListener=ui,e.PositionalAudio=fi,e.AudioContext=Bn,e.AudioAnalyser=hi,e.Audio=gi,e.VectorKeyframeTrack=ii,e.StringKeyframeTrack=Zo,e.QuaternionKeyframeTrack=Ko,e.NumberKeyframeTrack=ei,e.ColorKeyframeTrack=$o,e.BooleanKeyframeTrack=Jo,e.PropertyMixer=se,e.PropertyBinding=yi,e.KeyframeTrack=oi,e.AnimationUtils=In,e.AnimationObjectGroup=pa,e.AnimationMixer=vi,e.AnimationClip=ni,e.Uniform=_i,e.InstancedBufferGeometry=bi,e.BufferGeometry=St,e.Geometry=gt,e.InterleavedBufferAttribute=Ei,e.InstancedInterleavedBuffer=Ti,e.InterleavedBuffer=we,e.InstancedBufferAttribute=Si,e.Face3=ut,e.Object3D=dt,e.Raycaster=Mi,e.Layers=pt,e.EventDispatcher=t,e.Clock=ze,e.QuaternionLinearInterpolant=ya,e.LinearInterpolant=ri,e.DiscreteInterpolant=ai,e.CubicInterpolant=ti,e.Interpolant=Qo,e.Triangle=Nt,e.Math=yn,e.Spherical=Ri,e.Cylindrical=Li,e.Plane=it,e.Frustum=nt,e.Sphere=ot,e.Ray=Pt,e.Matrix4=i,e.Matrix3=y,e.Box3=at,e.Box2=Ci,e.Line3=It,e.Euler=lt,e.Vector4=j,e.Vector3=_,e.Vector2=o,e.Quaternion=s,e.Color=Oe,e.ImmediateRenderObject=Ae,e.VertexNormalsHelper=Pi,e.SpotLightHelper=Ii,e.SkeletonHelper=Ui,e.PointLightHelper=Di,e.RectAreaLightHelper=Bi,e.HemisphereLightHelper=Fi,e.GridHelper=zi,e.PolarGridHelper=Gi,e.FaceNormalsHelper=Oi,e.DirectionalLightHelper=Hi,e.CameraHelper=Vi,e.BoxHelper=ki,e.Box3Helper=Wi,e.PlaneHelper=ji,e.ArrowHelper=Xi,e.AxesHelper=Yi,e.Shape=zo,e.Path=Fo,e.ShapePath=di,e.Font=me,e.CurvePath=Bo,e.Curve=To,e.ShapeUtils=wn,e.WebGLUtils=mr,e.WireframeGeometry=Pr,e.ParametricGeometry=Ir,e.ParametricBufferGeometry=Nr,e.TetrahedronGeometry=Br,e.TetrahedronBufferGeometry=Fr,e.OctahedronGeometry=zr,e.OctahedronBufferGeometry=Gr,e.IcosahedronGeometry=Or,e.IcosahedronBufferGeometry=Hr,e.DodecahedronGeometry=Vr,e.DodecahedronBufferGeometry=kr,e.PolyhedronGeometry=Ur,e.PolyhedronBufferGeometry=Dr,e.TubeGeometry=Wr,e.TubeBufferGeometry=jr,e.TorusKnotGeometry=Xr,e.TorusKnotBufferGeometry=Yr,e.TorusGeometry=qr,e.TorusBufferGeometry=Zr,e.TextGeometry=Ra,e.TextBufferGeometry=Pa,e.SphereGeometry=Da,e.SphereBufferGeometry=Oa,e.RingGeometry=Va,e.RingBufferGeometry=Wa,e.PlaneGeometry=wt,e.PlaneBufferGeometry=Rt,e.LatheGeometry=Xa,e.LatheBufferGeometry=qa,e.ShapeGeometry=eo,e.ShapeBufferGeometry=to,e.ExtrudeGeometry=Ea,e.ExtrudeBufferGeometry=wa,e.EdgesGeometry=ao,e.ConeGeometry=no,e.ConeBufferGeometry=so,e.CylinderGeometry=oo,e.CylinderBufferGeometry=io,e.CircleGeometry=lo,e.CircleBufferGeometry=po,e.BoxGeometry=Mt,e.BoxBufferGeometry=At,e.ShadowMaterial=co,e.SpriteMaterial=fr,e.RawShaderMaterial=mo,e.ShaderMaterial=Ct,e.PointsMaterial=Mr,e.MeshPhysicalMaterial=go,e.MeshStandardMaterial=uo,e.MeshPhongMaterial=fo,e.MeshToonMaterial=ho,e.MeshNormalMaterial=yo,e.MeshLambertMaterial=xo,e.MeshDepthMaterial=tt,e.MeshDistanceMaterial=rt,e.MeshBasicMaterial=Lt,e.LineDashedMaterial=vo,e.LineBasicMaterial=br,e.Material=et,e.Float64BufferAttribute=D,e.Float32BufferAttribute=Et,e.Uint32BufferAttribute=bt,e.Int32BufferAttribute=_t,e.Uint16BufferAttribute=vt,e.Int16BufferAttribute=xt,e.Uint8ClampedBufferAttribute=yt,e.Uint8BufferAttribute=ht,e.Int8BufferAttribute=L,e.BufferAttribute=ft,e.ArcCurve=So,e.CatmullRomCurve3=ie,e.CubicBezierCurve=Lo,e.CubicBezierCurve3=Co,e.EllipseCurve=H,e.LineCurve=Po,e.LineCurve3=Io,e.QuadraticBezierCurve=No,e.QuadraticBezierCurve3=Uo,e.SplineCurve=Do,e.REVISION="90dev",e.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},e.CullFaceNone=0,e.CullFaceBack=1,e.CullFaceFront=2,e.CullFaceFrontBack=3,e.FrontFaceDirectionCW=0,e.FrontFaceDirectionCCW=1,e.BasicShadowMap=0,e.PCFShadowMap=1,e.PCFSoftShadowMap=2,e.FrontSide=0,e.BackSide=1,e.DoubleSide=2,e.FlatShading=1,e.SmoothShading=2,e.NoColors=0,e.FaceColors=1,e.VertexColors=2,e.NoBlending=0,e.NormalBlending=1,e.AdditiveBlending=2,e.SubtractiveBlending=3,e.MultiplyBlending=4,e.CustomBlending=5,e.AddEquation=100,e.SubtractEquation=101,e.ReverseSubtractEquation=102,e.MinEquation=103,e.MaxEquation=104,e.ZeroFactor=200,e.OneFactor=201,e.SrcColorFactor=202,e.OneMinusSrcColorFactor=203,e.SrcAlphaFactor=204,e.OneMinusSrcAlphaFactor=205,e.DstAlphaFactor=206,e.OneMinusDstAlphaFactor=207,e.DstColorFactor=208,e.OneMinusDstColorFactor=209,e.SrcAlphaSaturateFactor=210,e.NeverDepth=0,e.AlwaysDepth=1,e.LessDepth=2,e.LessEqualDepth=3,e.EqualDepth=4,e.GreaterEqualDepth=5,e.GreaterDepth=6,e.NotEqualDepth=7,e.MultiplyOperation=0,e.MixOperation=1,e.AddOperation=2,e.NoToneMapping=0,e.LinearToneMapping=1,e.ReinhardToneMapping=2,e.Uncharted2ToneMapping=3,e.CineonToneMapping=4,e.UVMapping=300,e.CubeReflectionMapping=301,e.CubeRefractionMapping=302,e.EquirectangularReflectionMapping=303,e.EquirectangularRefractionMapping=304,e.SphericalReflectionMapping=305,e.CubeUVReflectionMapping=306,e.CubeUVRefractionMapping=307,e.RepeatWrapping=1E3,e.ClampToEdgeWrapping=1001,e.MirroredRepeatWrapping=1002,e.NearestFilter=1003,e.NearestMipMapNearestFilter=1004,e.NearestMipMapLinearFilter=1005,e.LinearFilter=1006,e.LinearMipMapNearestFilter=1007,e.LinearMipMapLinearFilter=1008,e.UnsignedByteType=1009,e.ByteType=1010,e.ShortType=1011,e.UnsignedShortType=1012,e.IntType=1013,e.UnsignedIntType=1014,e.FloatType=1015,e.HalfFloatType=1016,e.UnsignedShort4444Type=1017,e.UnsignedShort5551Type=1018,e.UnsignedShort565Type=1019,e.UnsignedInt248Type=1020,e.AlphaFormat=1021,e.RGBFormat=1022,e.RGBAFormat=1023,e.LuminanceFormat=1024,e.LuminanceAlphaFormat=1025,e.RGBEFormat=1023,e.DepthFormat=1026,e.DepthStencilFormat=1027,e.RGB_S3TC_DXT1_Format=33776,e.RGBA_S3TC_DXT1_Format=33777,e.RGBA_S3TC_DXT3_Format=33778,e.RGBA_S3TC_DXT5_Format=33779,e.RGB_PVRTC_4BPPV1_Format=35840,e.RGB_PVRTC_2BPPV1_Format=35841,e.RGBA_PVRTC_4BPPV1_Format=35842,e.RGBA_PVRTC_2BPPV1_Format=35843,e.RGB_ETC1_Format=36196,e.RGBA_ASTC_4x4_Format=37808,e.RGBA_ASTC_5x4_Format=37809,e.RGBA_ASTC_5x5_Format=37810,e.RGBA_ASTC_6x5_Format=37811,e.RGBA_ASTC_6x6_Format=37812,e.RGBA_ASTC_8x5_Format=37813,e.RGBA_ASTC_8x6_Format=37814,e.RGBA_ASTC_8x8_Format=37815,e.RGBA_ASTC_10x5_Format=37816,e.RGBA_ASTC_10x6_Format=37817,e.RGBA_ASTC_10x8_Format=37818,e.RGBA_ASTC_10x10_Format=37819,e.RGBA_ASTC_12x10_Format=37820,e.RGBA_ASTC_12x12_Format=37821,e.LoopOnce=2200,e.LoopRepeat=2201,e.LoopPingPong=2202,e.InterpolateDiscrete=2300,e.InterpolateLinear=2301,e.InterpolateSmooth=2302,e.ZeroCurvatureEnding=2400,e.ZeroSlopeEnding=2401,e.WrapAroundEnding=2402,e.TrianglesDrawMode=0,e.TriangleStripDrawMode=1,e.TriangleFanDrawMode=2,e.LinearEncoding=3E3,e.sRGBEncoding=3001,e.GammaEncoding=3007,e.RGBEEncoding=3002,e.LogLuvEncoding=3003,e.RGBM7Encoding=3004,e.RGBM16Encoding=3005,e.RGBDEncoding=3006,e.BasicDepthPacking=3200,e.RGBADepthPacking=3201,e.CubeGeometry=Mt,e.Face4=function(t,r,a,o,i,e,n){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new ut(t,r,a,i,e,n)},e.LineStrip=0,e.LinePieces=1,e.MeshFaceMaterial=function(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e},e.MultiMaterial=function(e){return void 0===e&&(e=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e},e.PointCloud=function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Ar(e,t)},e.Particle=function(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new hr(e)},e.ParticleSystem=function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Ar(e,t)},e.PointCloudMaterial=function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Mr(e)},e.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Mr(e)},e.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Mr(e)},e.Vertex=function(e,t,r){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new _(e,t,r)},e.DynamicBufferAttribute=function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new ft(e,t).setDynamic(!0)},e.Int8Attribute=function(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new L(e,t)},e.Uint8Attribute=function(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new ht(e,t)},e.Uint8ClampedAttribute=function(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new yt(e,t)},e.Int16Attribute=function(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new xt(e,t)},e.Uint16Attribute=function(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new vt(e,t)},e.Int32Attribute=function(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new _t(e,t)},e.Uint32Attribute=function(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new bt(e,t)},e.Float32Attribute=function(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Et(e,t)},e.Float64Attribute=function(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new D(e,t)},e.ClosedSplineCurve3=qi,e.SplineCurve3=Zi,e.Spline=Ji,e.AxisHelper=function(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Yi(e)},e.BoundingBoxHelper=function(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new ki(e,t)},e.EdgesHelper=function(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Tr(new ao(e.geometry),new br({color:void 0===t?16777215:t}))},e.WireframeHelper=function(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Tr(new Pr(e.geometry),new br({color:void 0===t?16777215:t}))},e.XHRLoader=function(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new fe(e)},e.BinaryTextureLoader=function(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new bo(e)},e.GeometryUtils={merge:function(e,t,r){if(console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t.isMesh){t.matrixAutoUpdate&&t.updateMatrix();var a=t.matrix;t=t.geometry}e.merge(t,a,r)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}},e.ImageUtils={crossOrigin:void 0,loadTexture:function(t,r,a,o){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var i=new he;return i.setCrossOrigin(this.crossOrigin),t=i.load(t,a,void 0,o),r&&(t.mapping=r),t},loadTextureCube:function(t,r,a,o){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var i=new Eo;return i.setCrossOrigin(this.crossOrigin),t=i.load(t,a,void 0,o),r&&(t.mapping=r),t},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}},e.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}},e.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}},e.SceneUtils={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}},e.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/js/objects/LensFlare.js")},Object.defineProperty(e,"__esModule",{value:!0})});</script><script>THREE.STLLoader=function(a){this.manager=a===void 0?THREE.DefaultLoadingManager:a},THREE.STLLoader.prototype={constructor:THREE.STLLoader,load:function(a,b,c,d){var e=this,f=new THREE.FileLoader(e.manager);f.setResponseType('arraybuffer'),f.load(a,function(a){try{b(e.parse(a))}catch(a){d&&d(a)}},c,d)},parse:function(a){var b=function(a){if('string'===typeof a){for(var b=new Uint8Array(a.length),c=0;c<a.length;c++)b[c]=255&a.charCodeAt(c);return b.buffer||b}return a}(a);return function(a){var b,c,d,e;if(e=new DataView(a),c=50,d=e.getUint32(80,!0),b=84+d*c,b===e.byteLength)return!0;for(var f=[115,111,108,105,100],g=0;5>g;g++)if(f[g]!=e.getUint8(g,!1))return!0;return!1}(b)?function(a){for(var c,d,e,b,f,g,h,j,k=new DataView(a),l=k.getUint32(80,!0),m=!1,n=0;70>n;n++)1129270351==k.getUint32(n,!1)&&82==k.getUint8(n+4)&&61==k.getUint8(n+5)&&(m=!0,b=[],f=k.getUint8(n+6)/255,g=k.getUint8(n+7)/255,h=k.getUint8(n+8)/255,j=k.getUint8(n+9)/255);for(var o=new THREE.BufferGeometry,p=[],q=[],r=0;r<l;r++){var s=84+r*50,t=k.getFloat32(s,!0),u=k.getFloat32(s+4,!0),v=k.getFloat32(s+8,!0);if(m){var w=k.getUint16(s+48,!0);0===(32768&w)?(c=(31&w)/31,d=(31&w>>5)/31,e=(31&w>>10)/31):(c=f,d=g,e=h)}for(var x,y=1;3>=y;y++)x=s+12*y,p.push(k.getFloat32(x,!0)),p.push(k.getFloat32(x+4,!0)),p.push(k.getFloat32(x+8,!0)),q.push(t,u,v),m&&b.push(c,d,e)}return o.addAttribute('position',new THREE.BufferAttribute(new Float32Array(p),3)),o.addAttribute('normal',new THREE.BufferAttribute(new Float32Array(q),3)),m&&(o.addAttribute('color',new THREE.BufferAttribute(new Float32Array(b),3)),o.hasColors=!0,o.alpha=j),o}(b):function(a){for(var b,c=new THREE.BufferGeometry,d=/facet([\s\S]*?)endfacet/g,e=0,f=/[\s]+([+-]?(?:\d+.\d+|\d+.|\d+|.\d+)(?:[eE][+-]?\d+)?)/.source,g=new RegExp('vertex'+f+f+f,'g'),h=new RegExp('normal'+f+f+f,'g'),i=[],j=[],k=new THREE.Vector3;null!==(b=d.exec(a));){for(var l=0,m=0,n=b[0];null!==(b=h.exec(n));)k.x=parseFloat(b[1]),k.y=parseFloat(b[2]),k.z=parseFloat(b[3]),m++;for(;null!==(b=g.exec(n));)i.push(parseFloat(b[1]),parseFloat(b[2]),parseFloat(b[3])),j.push(k.x,k.y,k.z),l++;1!==m&&console.error('THREE.STLLoader: Something isn\'t right with the normal of face number '+e),3!==l&&console.error('THREE.STLLoader: Something isn\'t right with the vertices of face number '+e),e++}return c.addAttribute('position',new THREE.Float32BufferAttribute(i,3)),c.addAttribute('normal',new THREE.Float32BufferAttribute(j,3)),c}(function(a){return'string'===typeof a?a:THREE.LoaderUtils.decodeText(new Uint8Array(a))}(a))}};</script><script>THREE.VTKLoader=function(a){this.manager=a===void 0?THREE.DefaultLoadingManager:a},Object.assign(THREE.VTKLoader.prototype,THREE.EventDispatcher.prototype,{load:function(a,b,c,d){var e=this,f=new THREE.FileLoader(e.manager);f.setResponseType('arraybuffer'),f.load(a,function(a){b(e.parse(a))},c,d)},parse:function(a){function b(a,b){var c=a.length,d=new Float32Array(c+b.length);return d.set(a),d.set(b,c),d}function c(a,b){var c=a.length,d=new Int32Array(c+b.length);return d.set(a),d.set(b,c),d}function d(a){for(var b='',c=new Uint8Array(a),d=0,f=c.length;f--;)b+=e(c[d++]);return b}var e=String.fromCharCode,f=THREE.LoaderUtils.decodeText(new Uint8Array(a,0,250)).split('\n');return-1===f[0].indexOf('xml')?f[2].includes('ASCII')?function(a){var c,d=[],e=[],f=[],h=[],l=/(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)/g,m=/^(\d+)\s+([\s\d]*)/,n=/^POINTS /,o=/^POLYGONS /,p=/^TRIANGLE_STRIPS /,q=/^POINT_DATA[ ]+(\d+)/,s=/^CELL_DATA[ ]+(\d+)/,t=/^COLOR_SCALARS[ ]+(\w+)[ ]+3/,u=/^NORMALS[ ]+(\w+)[ ]+(\w+)/,v=!1,w=!1,A=!1,B=!1,C=!1,D=!1,E=!1,F=a.split('\n');for(var G in F){var i=F[G];if(v)for(;null!==(c=l.exec(i));){var H=parseFloat(c[1]),x=parseFloat(c[2]),y=parseFloat(c[3]);e.push(H,x,y)}else if(w){if(null!==(c=m.exec(i))){var z=parseInt(c[1]),I=c[2].split(/\s+/);if(3<=z)for(var J,K,L=parseInt(I[0]),M=1,k=0;k<z-2;++k)J=parseInt(I[M]),K=parseInt(I[M+1]),d.push(L,J,K),M++}}else if(A){if(null!==(c=m.exec(i))){var z=parseInt(c[1]),I=c[2].split(/\s+/);if(3<=z)for(var L,J,K,k=0;k<z-2;k++)1===k%2?(L=parseInt(I[k]),J=parseInt(I[k+2]),K=parseInt(I[k+1]),d.push(L,J,K)):(L=parseInt(I[k]),J=parseInt(I[k+1]),K=parseInt(I[k+2]),d.push(L,J,K))}}else if(B||C)if(D)for(;null!==(c=l.exec(i));){var j=parseFloat(c[1]),r=parseFloat(c[2]),g=parseFloat(c[3]);f.push(j,r,g)}else if(E)for(;null!==(c=l.exec(i));){var b=parseFloat(c[1]),N=parseFloat(c[2]),O=parseFloat(c[3]);h.push(b,N,O)}null===o.exec(i)?null===n.exec(i)?null===p.exec(i)?null===q.exec(i)?null===s.exec(i)?null===t.exec(i)?null!==u.exec(i)&&(E=!0,D=!1,v=!1,w=!1,A=!1):(D=!0,E=!1,v=!1,w=!1,A=!1):(C=!0,v=!1,w=!1,A=!1):(B=!0,v=!1,w=!1,A=!1):(w=!1,v=!1,A=!0):(w=!1,v=!0,A=!1):(w=!0,v=!1,A=!1)}var P,Q='point';if(f.length===d.length&&(Q='cell'),'point'===Q)P=new THREE.BufferGeometry,P.setIndex(new THREE.BufferAttribute(new Uint32Array(d),1)),P.addAttribute('position',new THREE.BufferAttribute(new Float32Array(e),3)),f.length===e.length&&P.addAttribute('color',new THREE.BufferAttribute(new Float32Array(f),3)),h.length===e.length&&P.addAttribute('normal',new THREE.BufferAttribute(new Float32Array(h),3));else{P=new THREE.Geometry;for(var R,S,T,U,H,x,y,j,r,g,V=d.length/3,W=e.length/3,k=0;k<W;++k)H=e[3*k+0],x=e[3*k+1],y=e[3*k+2],P.vertices.push(new THREE.Vector3(H,x,y));for(var G=0;G<V;++G)S=d[3*G+0],T=d[3*G+1],U=d[3*G+2],P.faces.push(new THREE.Face3(S,T,U));if(f.length===3*V)for(var G=0;G<V;++G)R=P.faces[G],j=f[3*G+0],r=f[3*G+1],g=f[3*G+2],R.color=new THREE.Color().setRGB(j,r,g)}return P}(d(a)):function(a){function b(a,b){for(var d=b,f=a[d],c=[];10!==f;)c.push(e(f)),d++,f=a[d];return{start:b,end:d,next:d+1,parsedString:c.join('')}}for(var c,d,f,g,h,i,k,l=new Uint8Array(a),m=new DataView(a),n=[],o=[],p=[],q=[],r=0;;){if(i=b(l,r),k=i.parsedString,0===k.indexOf('POINTS')){for(q.push(k),g=parseInt(k.split(' ')[1],10),c=3*(4*g),n=new Float32Array(3*g),d=i.next,f=0;f<g;f++)n[3*f]=m.getFloat32(d,!1),n[3*f+1]=m.getFloat32(d+4,!1),n[3*f+2]=m.getFloat32(d+8,!1),d+=12;i.next=i.next+c+1}else if(0===k.indexOf('TRIANGLE_STRIPS')){var s=parseInt(k.split(' ')[1],10),t=parseInt(k.split(' ')[2],10);c=4*t,p=new Uint32Array(3*t-9*s);var u=0;for(d=i.next,f=0;f<s;f++){var v=m.getInt32(d,!1),w=[];for(d+=4,h=0;h<v;h++)w.push(m.getInt32(d,!1)),d+=4;for(var x=0;x<v-2;x++)x%2?(p[u++]=w[x],p[u++]=w[x+2],p[u++]=w[x+1]):(p[u++]=w[x],p[u++]=w[x+1],p[u++]=w[x+2])}i.next=i.next+c+1}else if(0===k.indexOf('POLYGONS')){var s=parseInt(k.split(' ')[1],10),t=parseInt(k.split(' ')[2],10);c=4*t,p=new Uint32Array(3*t-9*s);var u=0;for(d=i.next,f=0;f<s;f++){var v=m.getInt32(d,!1),w=[];for(d+=4,h=0;h<v;h++)w.push(m.getInt32(d,!1)),d+=4;for(var x=1;x<v-1;x++)p[u++]=w[0],p[u++]=w[x],p[u++]=w[x+1]}i.next=i.next+c+1}else if(0===k.indexOf('POINT_DATA')){for(g=parseInt(k.split(' ')[1],10),i=b(l,i.next),c=3*(4*g),o=new Float32Array(3*g),d=i.next,f=0;f<g;f++)o[3*f]=m.getFloat32(d,!1),o[3*f+1]=m.getFloat32(d+4,!1),o[3*f+2]=m.getFloat32(d+8,!1),d+=12;i.next+=c}if(r=i.next,r>=l.byteLength)break}var j=new THREE.BufferGeometry;return j.setIndex(new THREE.BufferAttribute(p,1)),j.addAttribute('position',new THREE.BufferAttribute(n,3)),o.length===n.length&&j.addAttribute('normal',new THREE.BufferAttribute(o,3)),j}(a):function(a){function d(a){var b={};if(!(1===a.nodeType))3===a.nodeType&&(b=a.nodeValue.trim());else if(a.attributes&&0<a.attributes.length){b.attributes={};for(var c,e=0;e<a.attributes.length;e++)c=a.attributes.item(e),b.attributes[c.nodeName]=c.nodeValue.trim()}if(a.hasChildNodes())for(var f=0;f<a.childNodes.length;f++){var g=a.childNodes.item(f),h=g.nodeName;if('undefined'===typeof b[h]){var i=d(g);''!==i&&(b[h]=i)}else{if('undefined'===typeof b[h].push){var j=b[h];b[h]=[j]}var i=d(g);''!==i&&b[h].push(i)}}return b}function e(a){var b,c='undefined'===typeof Uint8Array?Array:Uint8Array,d=[],e=[],f='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/',g=f.length;for(b=0;b<g;b++)d[b]=f[b];for(b=0;b<g;++b)e[f.charCodeAt(b)]=b;e[45]=62,e[95]=63;var h,i,j,k,l,g=a.length;if(0<g%4)throw new Error('Invalid string. Length must be a multiple of 4');k='='===a[g-2]?2:'='===a[g-1]?1:0,l=new c(3*g/4-k),i=0<k?g-4:g;var m=0;for(b=0,h=0;b<i;b+=4,h+=3)j=e[a.charCodeAt(b)]<<18|e[a.charCodeAt(b+1)]<<12|e[a.charCodeAt(b+2)]<<6|e[a.charCodeAt(b+3)],l[m++]=(16711680&j)>>16,l[m++]=(65280&j)>>8,l[m++]=255&j;return 2===k?(j=e[a.charCodeAt(b)]<<2|e[a.charCodeAt(b+1)]>>4,l[m++]=255&j):1===k&&(j=e[a.charCodeAt(b)]<<10|e[a.charCodeAt(b+1)]<<4|e[a.charCodeAt(b+2)]>>2,l[m++]=255&j>>8,l[m++]=255&j),l}function f(a,d){var f=0;if('UInt64'===k.attributes.header_type?f=8:'UInt32'===k.attributes.header_type&&(f=4),'binary'===a.attributes.format&&d){var g,h,l,m,n,o,p,q,r;if('Float32'===a.attributes.type)var s=new Float32Array;else if('Int64'===a.attributes.type)var s=new Int32Array;g=a['#text'],l=e(g),m=l[0];for(var t=1;t<f-1;t++)m|=l[t]<<t*f;o=(m+3)*f,p=0<o%3?3-o%3:0,o+=p,q=[],r=o,q.push(r),n=3*f;for(var i,t=0;t<m;t++){i=l[t*f+n];for(var u=1;u<f-1;u++)i|=l[t*f+n+u]<<8*u;r+=i,q.push(r)}for(var j,t=0;t<q.length-1;t++)j=new Zlib.Inflate(l.slice(q[t],q[t+1]),{resize:!0,verify:!0}),h=j.decompress(),h=h.buffer,'Float32'===a.attributes.type?(h=new Float32Array(h),s=b(s,h)):'Int64'===a.attributes.type&&(h=new Int32Array(h),s=c(s,h));delete a['#text'],'Float32'===a.attributes.type?'binary'===a.attributes.format&&!d&&(s=s.filter(function(a,b){if(0!==b)return!0})):'Int64'===a.attributes.type&&'binary'===a.attributes.format&&(!d&&(s=s.filter(function(a,b){if(0!==b)return!0})),s=s.filter(function(a,b){if(1!==b%2)return!0}))}else{if('binary'===a.attributes.format&&!d){var h=e(a['#text']);h=h.slice(f).buffer}else if(a['#text'])var h=a['#text'].split(/\s+/).filter(function(a){if(''!==a)return a});else var h=new Int32Array(0).buffer;if(delete a['#text'],'Float32'===a.attributes.type)var s=new Float32Array(h);else if('Int32'===a.attributes.type)var s=new Int32Array(h);else if('Int64'===a.attributes.type){var s=new Int32Array(h);'binary'===a.attributes.format&&(s=s.filter(function(a,b){if(1!==b%2)return!0}))}}return s}var g=null;if(window.DOMParser)try{g=new DOMParser().parseFromString(a,'text/xml')}catch(a){g=null}else if(window.ActiveXObject)try{if(g=new ActiveXObject('Microsoft.XMLDOM'),g.async=!1,!g.loadXML())throw new Error(g.parseError.reason+g.parseError.srcText)}catch(a){g=null}else throw new Error('Cannot parse xml string!');var h=g.documentElement,k=d(h),l=[],m=[],n=[];if(k.PolyData){for(var o,p=k.PolyData.Piece,q=k.attributes.hasOwnProperty('compressor'),r=['PointData','Points','Strips','Polys'],t=0,u=r.length;t<u;){if(o=p[r[t]],o&&o.DataArray){if('[object Array]'===Object.prototype.toString.call(o.DataArray))var v=o.DataArray;else var v=[o.DataArray];for(var w=0,x=v.length;w<x;)'#text'in v[w]&&0<v[w]['#text'].length&&(v[w].text=f(v[w],q)),w++;switch(r[t]){case'PointData':var y=parseInt(p.attributes.NumberOfPoints),z=o.attributes.Normals;if(0<y)for(var A=0,i=v.length;A<i;A++)if(z===v[A].attributes.Name){var B=v[A].attributes.NumberOfComponents;m=new Float32Array(y*B),m.set(v[A].text,0)}break;case'Points':var y=parseInt(p.attributes.NumberOfPoints);if(0<y){var B=o.DataArray.attributes.NumberOfComponents;l=new Float32Array(y*B),l.set(o.DataArray.text,0)}break;case'Strips':var C=parseInt(p.attributes.NumberOfStrips);if(0<C){var D=new Int32Array(o.DataArray[0].text.length),E=new Int32Array(o.DataArray[1].text.length);D.set(o.DataArray[0].text,0),E.set(o.DataArray[1].text,0);var F=C+D.length;n=new Uint32Array(3*F-9*C);for(var G,H=0,A=0,i=C;A<i;A++){G=[];for(var I=0,s=E[A],J=0;I<s-J;I++)G.push(D[I]),0<A&&(J=E[A-1]);for(var K=0,s=E[A],J=0;K<s-J-2;K++)K%2?(n[H++]=G[K],n[H++]=G[K+2],n[H++]=G[K+1]):(n[H++]=G[K],n[H++]=G[K+1],n[H++]=G[K+2]),0<A&&(J=E[A-1])}}break;case'Polys':var j=parseInt(p.attributes.NumberOfPolys);if(0<j){var D=new Int32Array(o.DataArray[0].text.length),E=new Int32Array(o.DataArray[1].text.length);D.set(o.DataArray[0].text,0),E.set(o.DataArray[1].text,0);var F=j+D.length;n=new Uint32Array(3*F-9*j);for(var H=0,L=0,A=0,i=j,J=0;A<i;){for(var M=[],I=0,s=E[A];I<s-J;)M.push(D[L++]),I++;for(var K=1;K<s-J-1;)n[H++]=M[0],n[H++]=M[K],n[H++]=M[K+1],K++;A++,J=E[A-1]}}break;default:}}t++}var N=new THREE.BufferGeometry;return N.setIndex(new THREE.BufferAttribute(n,1)),N.addAttribute('position',new THREE.BufferAttribute(l,3)),m.length===l.length&&N.addAttribute('normal',new THREE.BufferAttribute(m,3)),N}}(d(a))}});</script><script>!function(a,t){"object"==("undefined"===typeof exports?"undefined":babelHelpers.typeof(exports))&&"object"==("undefined"===typeof module?"undefined":babelHelpers.typeof(module))?module.exports=t():"function"==typeof define&&define.amd?define("AMI",[],t):"object"==("undefined"===typeof exports?"undefined":babelHelpers.typeof(exports))?exports.AMI=t():a.AMI=t()}(this,function(){var a=Number.isNaN,l=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY,F=String.fromCharCode,b=Number.MAX_VALUE,P=Math.round,D=Math.atan2,Gn=Math.PI,S=Math.pow,T=Math.ceil,N=Math.sqrt,o=Math.LN2,i=Math.log,C=Math.max,U=Math.min,B=Math.abs,z=Math.floor;return function(a){function o(t){if(e[t])return e[t].exports;var n=e[t]={i:t,l:!1,exports:{}};return a[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}var e={};return o.m=a,o.c=e,o.d=function(e,t,a){o.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(a,t){return Object.prototype.hasOwnProperty.call(a,t)},o.p="",o(o.s=83)}([function(Hn,t,e){"use strict";function n(){}function el(a,t){this.x=a||0,this.y=t||0}function tl(o,t,e,r,n,a,i,l,s,c){Object.defineProperty(this,"id",{value:La++}),this.uuid=rd.generateUUID(),this.name="",this.image=void 0===o?tl.DEFAULT_IMAGE:o,this.mipmaps=[],this.mapping=void 0===t?tl.DEFAULT_MAPPING:t,this.wrapS=void 0===e?qc:e,this.wrapT=void 0===r?qc:r,this.magFilter=void 0===n?Kc:n,this.minFilter=void 0===a?$c:a,this.anisotropy=void 0===s?1:s,this.format=void 0===i?td:i,this.type=void 0===l?ed:l,this.offset=new el(0,0),this.repeat=new el(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0===c?wa:c,this.version=0,this.onUpdate=null}function al(a,t,e,o){this.x=a||0,this.y=t||0,this.z=e||0,this.w=void 0===o?1:o}function a(a,t,e){this.uuid=rd.generateUUID(),this.width=a,this.height=t,this.scissor=new al(0,0,a,t),this.scissorTest=!1,this.viewport=new al(0,0,a,t),void 0===(e=e||{}).minFilter&&(e.minFilter=Kc),this.texture=new tl(void 0,void 0,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.depthBuffer=void 0===e.depthBuffer||e.depthBuffer,this.stencilBuffer=void 0===e.stencilBuffer||e.stencilBuffer,this.depthTexture=void 0===e.depthTexture?null:e.depthTexture}function ol(o,t,e){a.call(this,o,t,e),this.activeCubeFace=0,this.activeMipMapLevel=0}function rl(a,t,e,o){this._x=a||0,this._y=t||0,this._z=e||0,this._w=void 0===o?1:o}function nl(a,t,e){this.x=a||0,this.y=t||0,this.z=e||0}function il(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function l(o,d,m,_,i,r,a,s,l,c,h,u){tl.call(this,null,r,a,s,l,c,_,i,h,u),this.image={data:o,width:d,height:m},this.magFilter=void 0===l?Yc:l,this.minFilter=void 0===c?Yc:c,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function c(o,t,e,n,i,r,a,s,l,c){o=void 0===o?[]:o,t=void 0===t?To:t,tl.call(this,o,t,e,n,i,r,a,s,l,c),this.flipY=!1}function s(){this.seq=[],this.map={}}function r(l,t,e){var n=l[0];if(0>=n||0<n)return l;var i=t*e,r=Da[i];if(void 0===r&&(r=new Float32Array(i),Da[i]=r),0!==t){n.toArray(r,0);for(var o=1,a=0;o!==t;++o)a+=e,l[o].toArray(r,a)}return r}function d(a,t){var e=Oa[t];void 0===e&&(e=new Int32Array(t),Oa[t]=e);for(var o=0;o!==t;++o)e[o]=a.allocTextureUnit();return e}function p(a,t){a.uniform1f(this.addr,t)}function u(a,t){a.uniform1i(this.addr,t)}function m(a,t){void 0===t.x?a.uniform2fv(this.addr,t):a.uniform2f(this.addr,t.x,t.y)}function _(a,t){void 0===t.x?void 0===t.r?a.uniform3fv(this.addr,t):a.uniform3f(this.addr,t.r,t.g,t.b):a.uniform3f(this.addr,t.x,t.y,t.z)}function h(a,t){void 0===t.x?a.uniform4fv(this.addr,t):a.uniform4f(this.addr,t.x,t.y,t.z,t.w)}function g(a,t){a.uniformMatrix2fv(this.addr,!1,t.elements||t)}function f(a,t){void 0===t.elements?a.uniformMatrix3fv(this.addr,!1,t):(Ua.set(t.elements),a.uniformMatrix3fv(this.addr,!1,Ua))}function y(a,t){void 0===t.elements?a.uniformMatrix4fv(this.addr,!1,t):(Fa.set(t.elements),a.uniformMatrix4fv(this.addr,!1,Fa))}function x(a,t,e){var o=e.allocTextureUnit();a.uniform1i(this.addr,o),e.setTexture2D(t||Ra,o)}function v(a,t,e){var o=e.allocTextureUnit();a.uniform1i(this.addr,o),e.setTextureCube(t||ka,o)}function w(a,t){a.uniform2iv(this.addr,t)}function E(a,t){a.uniform3iv(this.addr,t)}function M(a,t){a.uniform4iv(this.addr,t)}function A(e){return 5126===e?p:35664===e?m:35665===e?_:35666===e?h:35674===e?g:35675===e?f:35676===e?y:35678===e||36198===e?x:35680===e?v:5124===e||35670===e?u:35667===e||35671===e?w:35668===e||35672===e?E:35669===e||35673===e?M:void 0}function I(a,t){a.uniform1fv(this.addr,t)}function L(a,t){a.uniform1iv(this.addr,t)}function R(a,t){a.uniform2fv(this.addr,r(t,this.size,2))}function k(a,t){a.uniform3fv(this.addr,r(t,this.size,3))}function ll(a,t){a.uniform4fv(this.addr,r(t,this.size,4))}function O(a,t){a.uniformMatrix2fv(this.addr,!1,r(t,this.size,4))}function F(a,t){a.uniformMatrix3fv(this.addr,!1,r(t,this.size,9))}function sl(a,t){a.uniformMatrix4fv(this.addr,!1,r(t,this.size,16))}function cl(a,t,e){var n=t.length,i=d(e,n);a.uniform1iv(this.addr,i);for(var r=0;r!==n;++r)e.setTexture2D(t[r]||Ra,i[r])}function dl(a,t,e){var n=t.length,i=d(e,n);a.uniform1iv(this.addr,i);for(var r=0;r!==n;++r)e.setTextureCube(t[r]||ka,i[r])}function pl(e){return 5126===e?I:35664===e?R:35665===e?k:35666===e?ll:35674===e?O:35675===e?F:35676===e?sl:35678===e?cl:35680===e?dl:5124===e||35670===e?L:35667===e||35671===e?w:35668===e||35672===e?E:35669===e||35673===e?M:void 0}function G(a,t,e){this.id=a,this.addr=e,this.setValue=A(t.type)}function j(a,t,e){this.id=a,this.addr=e,this.size=t.size,this.setValue=pl(t.type)}function H(e){this.id=e,s.call(this)}function V(a,t){a.seq.push(t),a.map[t.id]=t}function W(d,t,e){var n=d.name,i=n.length;for(Na.lastIndex=0;;){var r=Na.exec(n),o=Na.lastIndex,a=r[1],s="]"===r[2],l=r[3];if(s&&(a|=0),void 0===l||"["===l&&o+2===i){V(e,void 0===l?new G(a,d,t):new j(a,d,t));break}var c=e.map[a];void 0===c&&V(e,c=new H(a)),e=c}}function q(l,t,e){s.call(this),this.renderer=e;for(var n=l.getProgramParameter(t,l.ACTIVE_UNIFORMS),i=0;i<n;++i){var r=l.getActiveUniform(t,i),o=r.name;W(r,l.getUniformLocation(t,o),this)}}function X(a,t,e){return void 0===t&&void 0===e?this.set(a):this.setRGB(a,t,e)}function Y(a,t){this.min=void 0===a?new el(1/0,1/0):a,this.max=void 0===t?new el(-1/0,-1/0):t}function ul(r,h,e,t,g){function o(){var o=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),t=new Uint16Array([0,1,2,0,2,3]);n=h.createBuffer(),l=h.createBuffer(),h.bindBuffer(h.ARRAY_BUFFER,n),h.bufferData(h.ARRAY_BUFFER,o,h.STATIC_DRAW),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,l),h.bufferData(h.ELEMENT_ARRAY_BUFFER,t,h.STATIC_DRAW),f=h.createTexture(),m=h.createTexture(),e.bindTexture(h.TEXTURE_2D,f),h.texImage2D(h.TEXTURE_2D,0,h.RGB,16,16,0,h.RGB,h.UNSIGNED_BYTE,null),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST),e.bindTexture(h.TEXTURE_2D,m),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,16,16,0,h.RGBA,h.UNSIGNED_BYTE,null),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST),s={vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif ( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility =        visibility.r / 9.0;\nvVisibility *= 1.0 - visibility.g / 9.0;\nvVisibility *=       visibility.b / 9.0;\nvVisibility *= 1.0 - visibility.a / 9.0;\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif ( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if ( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},c=a(s),p={vertex:h.getAttribLocation(c,"position"),uv:h.getAttribLocation(c,"uv")},d={renderType:h.getUniformLocation(c,"renderType"),map:h.getUniformLocation(c,"map"),occlusionMap:h.getUniformLocation(c,"occlusionMap"),opacity:h.getUniformLocation(c,"opacity"),color:h.getUniformLocation(c,"color"),scale:h.getUniformLocation(c,"scale"),rotation:h.getUniformLocation(c,"rotation"),screenPosition:h.getUniformLocation(c,"screenPosition")}}function a(e){var t=h.createProgram(),o=h.createShader(h.FRAGMENT_SHADER),n=h.createShader(h.VERTEX_SHADER),r="precision "+g.precision+" float;\n";return h.shaderSource(o,r+e.fragmentShader),h.shaderSource(n,r+e.vertexShader),h.compileShader(o),h.compileShader(n),h.attachShader(t,o),h.attachShader(t,n),h.linkProgram(t),t}var n,l,s,c,p,d,f,m;this.render=function(a,r,i,s){if(0!==a.length){var u=new nl,_=s.w/s.z,g=.5*s.z,y=.5*s.w,b=16/s.w,v=new el(b*_,b),x=new nl(1,1,0),S=new el(1,1),w=new Y;w.min.set(s.x,s.y),w.max.set(s.x+(s.z-16),s.y+(s.w-16)),void 0===c&&o(),e.useProgram(c),e.initAttributes(),e.enableAttribute(p.vertex),e.enableAttribute(p.uv),e.disableUnusedAttributes(),h.uniform1i(d.occlusionMap,0),h.uniform1i(d.map,1),h.bindBuffer(h.ARRAY_BUFFER,n),h.vertexAttribPointer(p.vertex,2,h.FLOAT,!1,16,0),h.vertexAttribPointer(p.uv,2,h.FLOAT,!1,16,8),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,l),e.disable(h.CULL_FACE),e.buffers.depth.setMask(!1);for(var E=0,T=a.length;E<T;E++){b=16/s.w,v.set(b*_,b);var M=a[E];if(u.set(M.matrixWorld.elements[12],M.matrixWorld.elements[13],M.matrixWorld.elements[14]),u.applyMatrix4(i.matrixWorldInverse),u.applyMatrix4(i.projectionMatrix),x.copy(u),S.x=s.x+x.x*g+g-8,S.y=s.y+x.y*y+y-8,!0===w.containsPoint(S)){e.activeTexture(h.TEXTURE0),e.bindTexture(h.TEXTURE_2D,null),e.activeTexture(h.TEXTURE1),e.bindTexture(h.TEXTURE_2D,f),h.copyTexImage2D(h.TEXTURE_2D,0,h.RGB,S.x,S.y,16,16,0),h.uniform1i(d.renderType,0),h.uniform2f(d.scale,v.x,v.y),h.uniform3f(d.screenPosition,x.x,x.y,x.z),e.disable(h.BLEND),e.enable(h.DEPTH_TEST),h.drawElements(h.TRIANGLES,6,h.UNSIGNED_SHORT,0),e.activeTexture(h.TEXTURE0),e.bindTexture(h.TEXTURE_2D,m),h.copyTexImage2D(h.TEXTURE_2D,0,h.RGBA,S.x,S.y,16,16,0),h.uniform1i(d.renderType,1),e.disable(h.DEPTH_TEST),e.activeTexture(h.TEXTURE1),e.bindTexture(h.TEXTURE_2D,f),h.drawElements(h.TRIANGLES,6,h.UNSIGNED_SHORT,0),M.positionScreen.copy(x),M.customUpdateCallback?M.customUpdateCallback(M):M.updateLensFlares(),h.uniform1i(d.renderType,2),e.enable(h.BLEND);for(var P=0,A=M.lensFlares.length,C;P<A;P++)C=M.lensFlares[P],.001<C.opacity&&.001<C.scale&&(x.x=C.x,x.y=C.y,x.z=C.z,b=C.size*C.scale/s.w,v.x=b*_,v.y=b,h.uniform3f(d.screenPosition,x.x,x.y,x.z),h.uniform2f(d.scale,v.x,v.y),h.uniform1f(d.rotation,C.rotation),h.uniform1f(d.opacity,C.opacity),h.uniform3f(d.color,C.color.r,C.color.g,C.color.b),e.setBlending(C.blending,C.blendEquation,C.blendSrc,C.blendDst),t.setTexture2D(C.texture,1),h.drawElements(h.TRIANGLES,6,h.UNSIGNED_SHORT,0))}}e.enable(h.CULL_FACE),e.enable(h.DEPTH_TEST),e.buffers.depth.setMask(!0),e.reset()}}}function Z(o,t,e,n,i,r,a,s,l){tl.call(this,o,t,e,n,i,r,a,s,l),this.needsUpdate=!0}function J(b,P,e,t,c){function n(){var e=new Float32Array([-0.5,-0.5,0,0,0.5,-0.5,1,0,0.5,0.5,1,1,-0.5,0.5,0,1]),t=new Uint16Array([0,1,2,0,2,3]);g=P.createBuffer(),l=P.createBuffer(),P.bindBuffer(P.ARRAY_BUFFER,g),P.bufferData(P.ARRAY_BUFFER,e,P.STATIC_DRAW),P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,l),P.bufferData(P.ELEMENT_ARRAY_BUFFER,t,P.STATIC_DRAW),u=o(),p={position:P.getAttribLocation(u,"position"),uv:P.getAttribLocation(u,"uv")},d={uvOffset:P.getUniformLocation(u,"uvOffset"),uvScale:P.getUniformLocation(u,"uvScale"),rotation:P.getUniformLocation(u,"rotation"),scale:P.getUniformLocation(u,"scale"),color:P.getUniformLocation(u,"color"),map:P.getUniformLocation(u,"map"),opacity:P.getUniformLocation(u,"opacity"),modelViewMatrix:P.getUniformLocation(u,"modelViewMatrix"),projectionMatrix:P.getUniformLocation(u,"projectionMatrix"),fogType:P.getUniformLocation(u,"fogType"),fogDensity:P.getUniformLocation(u,"fogDensity"),fogNear:P.getUniformLocation(u,"fogNear"),fogFar:P.getUniformLocation(u,"fogFar"),fogColor:P.getUniformLocation(u,"fogColor"),alphaTest:P.getUniformLocation(u,"alphaTest")};var a=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");a.width=8,a.height=8;var n=a.getContext("2d");n.fillStyle="white",n.fillRect(0,0,8,8),f=new Z(a)}function o(){var e=P.createProgram(),t=P.createShader(P.VERTEX_SHADER),a=P.createShader(P.FRAGMENT_SHADER);return P.shaderSource(t,["precision "+c.precision+" float;","#define SHADER_NAME SpriteMaterial","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),P.shaderSource(a,["precision "+c.precision+" float;","#define SHADER_NAME SpriteMaterial","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),P.compileShader(t),P.compileShader(a),P.attachShader(e,t),P.attachShader(e,a),P.linkProgram(e),e}function i(a,t){return a.renderOrder===t.renderOrder?a.z===t.z?t.id-a.id:t.z-a.z:a.renderOrder-t.renderOrder}var r=new nl,s=new rl,_=new nl,g,l,u,p,d,f;this.render=function(o,m,a){if(0!==o.length){void 0===u&&n(),e.useProgram(u),e.initAttributes(),e.enableAttribute(p.position),e.enableAttribute(p.uv),e.disableUnusedAttributes(),e.disable(P.CULL_FACE),e.enable(P.BLEND),P.bindBuffer(P.ARRAY_BUFFER,g),P.vertexAttribPointer(p.position,2,P.FLOAT,!1,16,0),P.vertexAttribPointer(p.uv,2,P.FLOAT,!1,16,8),P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,l),P.uniformMatrix4fv(d.projectionMatrix,!1,a.projectionMatrix.elements),e.activeTexture(P.TEXTURE0),P.uniform1i(d.map,0);var c=0,h=0,y=m.fog;y?(P.uniform3f(d.fogColor,y.color.r,y.color.g,y.color.b),y.isFog?(P.uniform1f(d.fogNear,y.near),P.uniform1f(d.fogFar,y.far),P.uniform1i(d.fogType,1),c=1,h=1):y.isFogExp2&&(P.uniform1f(d.fogDensity,y.density),P.uniform1i(d.fogType,2),c=2,h=2)):(P.uniform1i(d.fogType,0),c=0,h=0);for(var v=0,w=o.length;v<w;v++)(S=o[v]).modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,S.matrixWorld),S.z=-S.modelViewMatrix.elements[14];o.sort(i);for(var x=[],v=0,w=o.length;v<w;v++){var S=o[v],E=S.material;if(!1!==E.visible){S.onBeforeRender(b,m,a,void 0,E,void 0),P.uniform1f(d.alphaTest,E.alphaTest),P.uniformMatrix4fv(d.modelViewMatrix,!1,S.modelViewMatrix.elements),S.matrixWorld.decompose(r,s,_),x[0]=_.x,x[1]=_.y;var M=0;m.fog&&E.fog&&(M=h),c!==M&&(P.uniform1i(d.fogType,M),c=M),null===E.map?(P.uniform2f(d.uvOffset,0,0),P.uniform2f(d.uvScale,1,1)):(P.uniform2f(d.uvOffset,E.map.offset.x,E.map.offset.y),P.uniform2f(d.uvScale,E.map.repeat.x,E.map.repeat.y)),P.uniform1f(d.opacity,E.opacity),P.uniform3f(d.color,E.color.r,E.color.g,E.color.b),P.uniform1f(d.rotation,E.rotation),P.uniform2fv(d.scale,x),e.setBlending(E.blending,E.blendEquation,E.blendSrc,E.blendDst,E.blendEquationAlpha,E.blendSrcAlpha,E.blendDstAlpha,E.premultipliedAlpha),e.buffers.depth.setTest(E.depthTest),e.buffers.depth.setMask(E.depthWrite),t.setTexture2D(E.map||f,0),P.drawElements(P.TRIANGLES,6,P.UNSIGNED_SHORT,0),S.onAfterRender(b,m,a,void 0,E,void 0)}}e.enable(P.CULL_FACE),e.reset()}}}function K(){Object.defineProperty(this,"id",{value:Va++}),this.uuid=rd.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=Dc,this.side=Or,this.flatShading=!1,this.vertexColors=Nr,this.opacity=1,this.transparent=!1,this.blendSrc=no,this.blendDst=io,this.blendEquation=Bc,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=po,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this.userData={},this.needsUpdate=!0}function Q(e){K.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function ml(e){K.call(this),this.type="MeshDepthMaterial",this.depthPacking=Pa,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(e)}function _l(e){K.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new nl,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(e)}function hl(a,t){this.min=void 0===a?new nl(1/0,1/0,1/0):a,this.max=void 0===t?new nl(-1/0,-1/0,-1/0):t}function it(a,t){this.center=void 0===a?new nl:a,this.radius=void 0===t?0:t}function rt(){this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function ot(a,t){this.normal=void 0===a?new nl(1,0,0):a,this.constant=void 0===t?0:t}function gl(a,t,e,n,i,r){this.planes=[void 0===a?new ot:a,void 0===t?new ot:t,void 0===e?new ot:e,void 0===n?new ot:n,void 0===i?new ot:i,void 0===r?new ot:r]}function st(R,t,e){function r(t,e,n,b,r,o){var a=t.geometry,s=null,l=_,c=t.customDepthMaterial;if(n&&(l=g,c=t.customDistanceMaterial),c)s=c;else{var h=!1;e.morphTargets&&(a&&a.isBufferGeometry?h=a.morphAttributes&&a.morphAttributes.position&&0<a.morphAttributes.position.length:a&&a.isGeometry&&(h=a.morphTargets&&0<a.morphTargets.length)),t.isSkinnedMesh&&!1===e.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t);var u=t.isSkinnedMesh&&e.skinning,v=0;h&&(v|=i),u&&(v|=m),s=l[v]}if(R.localClippingEnabled&&!0===e.clipShadows&&0!==e.clippingPlanes.length){var d=s.uuid,f=e.uuid,w=p[d];void 0===w&&(w={},p[d]=w);var y=w[f];void 0===y&&(y=s.clone(),w[f]=y),s=y}s.visible=e.visible,s.wireframe=e.wireframe;var x=e.side;return E.renderSingleSided&&x==Ac&&(x=Or),E.renderReverseSided&&(x===Or?x=Fr:x===Fr&&(x=Or)),s.side=x,s.clipShadows=e.clipShadows,s.clippingPlanes=e.clippingPlanes,s.clipIntersection=e.clipIntersection,s.wireframeLinewidth=e.wireframeLinewidth,s.linewidth=e.linewidth,n&&s.isMeshDistanceMaterial&&(s.referencePosition.copy(b),s.nearDistance=r,s.farDistance=o),s}function u(e,n,i,a){if(!1!==e.visible){if(e.layers.test(n.layers)&&(e.isMesh||e.isLine||e.isPoints)&&e.castShadow&&(!e.frustumCulled||o.intersectsObject(e))){e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld);var l=t.update(e),s=e.material;if(Array.isArray(s))for(var c=l.groups,m=0,p=c.length;m<p;m++){var d=c[m],h=s[d.materialIndex];h&&h.visible&&(_=r(e,h,a,D,i.near,i.far),R.renderBufferDirect(i,null,l,_,e,d))}else if(s.visible){var _=r(e,s,a,D,i.near,i.far);R.renderBufferDirect(i,null,l,_,e,null)}}for(var g=e.children,f=0,y=g.length;f<y;f++)u(g[f],n,i,a)}}for(var o=new gl,l=new il,s=new el,c=new el(e,e),d=new nl,D=new nl,i=1,m=2,_=[,,,,],g=[,,,,],p={},n=[new nl(1,0,0),new nl(-1,0,0),new nl(0,0,1),new nl(0,0,-1),new nl(0,1,0),new nl(0,-1,0)],h=[new nl(0,1,0),new nl(0,1,0),new nl(0,1,0),new nl(0,1,0),new nl(0,0,1),new nl(0,0,-1)],f=[new al,new al,new al,new al,new al,new al],y=0;y!==1+(i|m);++y){var b=0!=(y&i),x=0!=(y&m),v=new ml({depthPacking:Ia,morphTargets:b,skinning:x});_[y]=v;var S=new _l({morphTargets:b,skinning:x});g[y]=S}var E=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=kr,this.renderReverseSided=!0,this.renderSingleSided=!0,this.render=function(t,e,p){if(!1!==E.enabled&&(!1!==E.autoUpdate||!1!==E.needsUpdate)&&0!==t.length){var i=R.context,r=R.state;r.disable(i.BLEND),r.buffers.color.setClear(1,1,1,1),r.buffers.depth.setTest(!0),r.setScissorTest(!1);for(var m=0,x=t.length,_;m<x;m++){var S=t[m],g=S.shadow,y=S&&S.isPointLight;if(void 0!==g){var v=g.camera;if(s.copy(g.mapSize),s.min(c),y){var b=s.x,w=s.y;f[0].set(2*b,w,b,w),f[1].set(0,w,b,w),f[2].set(3*b,w,b,w),f[3].set(b,w,b,w),f[4].set(3*b,0,b,w),f[5].set(b,0,b,w),s.x*=4,s.y*=2}if(null===g.map){g.map=new a(s.x,s.y,{minFilter:Yc,magFilter:Yc,format:td}),g.map.texture.name=S.name+".shadowMap",v.updateProjectionMatrix()}g.isSpotLightShadow&&g.update(S);var T=g.map,M=g.matrix;D.setFromMatrixPosition(S.matrixWorld),v.position.copy(D),y?(_=6,M.makeTranslation(-D.x,-D.y,-D.z)):(_=1,d.setFromMatrixPosition(S.target.matrixWorld),v.lookAt(d),v.updateMatrixWorld(),M.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),M.multiply(v.projectionMatrix),M.multiply(v.matrixWorldInverse)),R.setRenderTarget(T),R.clear();for(var P=0;P<_;P++){if(y){d.copy(v.position),d.add(n[P]),v.up.copy(h[P]),v.lookAt(d),v.updateMatrixWorld();var C=f[P];r.viewport(C)}l.multiplyMatrices(v.projectionMatrix,v.matrixWorldInverse),o.setFromMatrix(l),u(e,p,v,y)}}else console.warn("THREE.WebGLShadowMap:",S,"has no shadow.")}E.needsUpdate=!1}}}function lt(l){function a(t,s){var n=t.array,i=t.dynamic?l.DYNAMIC_DRAW:l.STATIC_DRAW,r=l.createBuffer();l.bindBuffer(s,r),l.bufferData(s,n,i),t.onUploadCallback();var c=l.FLOAT;return n instanceof Float32Array?c=l.FLOAT:n instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):n instanceof Uint16Array?c=l.UNSIGNED_SHORT:n instanceof Int16Array?c=l.SHORT:n instanceof Uint32Array?c=l.UNSIGNED_INT:n instanceof Int32Array?c=l.INT:n instanceof Int8Array?c=l.BYTE:n instanceof Uint8Array&&(c=l.UNSIGNED_BYTE),{buffer:r,type:c,bytesPerElement:n.BYTES_PER_ELEMENT,version:t.version}}function e(t,e,a){var i=e.array,r=e.updateRange;l.bindBuffer(a,t),!1===e.dynamic?l.bufferData(a,i,l.STATIC_DRAW):-1===r.count?l.bufferSubData(a,0,i):0===r.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(l.bufferSubData(a,r.offset*i.BYTES_PER_ELEMENT,i.subarray(r.offset,r.offset+r.count)),r.count=-1)}var s={};return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),s[e.uuid]},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var e=s[t.uuid];e&&(l.deleteBuffer(e.buffer),delete s[t.uuid])},update:function(n,t){n.isInterleavedBufferAttribute&&(n=n.data);var r=s[n.uuid];void 0===r?s[n.uuid]=a(n,t):r.version<n.version&&(e(r.buffer,n,t),r.version=n.version)}}}function at(a,t,e,o){this._x=a||0,this._y=t||0,this._z=e||0,this._order=o||at.DefaultOrder}function ct(){this.mask=1}function ut(){Object.defineProperty(this,"id",{value:Wa++}),this.uuid=rd.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ut.DefaultUp.clone();var a=new nl,o=new at,r=new rl,l=new nl(1,1,1);o.onChange(function(){r.setFromEuler(o,!1)}),r.onChange(function(){o.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:a},rotation:{enumerable:!0,value:o},quaternion:{enumerable:!0,value:r},scale:{enumerable:!0,value:l},modelViewMatrix:{value:new il},normalMatrix:{value:new rt}}),this.matrix=new il,this.matrixWorld=new il,this.matrixAutoUpdate=ut.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new ct,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function pt(){ut.call(this),this.type="Camera",this.matrixWorldInverse=new il,this.projectionMatrix=new il}function ht(a,t,e,n,i,r){pt.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=a,this.right=t,this.top=e,this.bottom=n,this.near=void 0===i?.1:i,this.far=void 0===r?2e3:r,this.updateProjectionMatrix()}function fl(a,t,e,o){pt.call(this),this.type="PerspectiveCamera",this.fov=void 0===a?50:a,this.zoom=1,this.near=void 0===e?.1:e,this.far=void 0===o?2e3:o,this.focus=10,this.aspect=void 0===t?1:t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function yl(a,t,e,n,i,r){this.a=a,this.b=t,this.c=e,this.normal=n&&n.isVector3?n:new nl,this.vertexNormals=Array.isArray(n)?n:[],this.color=i&&i.isColor?i:new X,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0===r?0:r}function _t(){return qa++}function gt(){Object.defineProperty(this,"id",{value:_t()}),this.uuid=rd.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function yt(a,t,e){if(Array.isArray(a))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.uuid=rd.generateUUID(),this.name="",this.array=a,this.itemSize=t,this.count=void 0===a?0:a.length/t,this.normalized=!0===e,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.onUploadCallback=function(){},this.version=0}function vt(a,t){yt.call(this,new Int8Array(a),t)}function bt(a,t){yt.call(this,new Uint8Array(a),t)}function wt(a,t){yt.call(this,new Uint8ClampedArray(a),t)}function xt(a,t){yt.call(this,new Int16Array(a),t)}function St(a,t){yt.call(this,new Uint16Array(a),t)}function Et(a,t){yt.call(this,new Int32Array(a),t)}function Mt(a,t){yt.call(this,new Uint32Array(a),t)}function Tt(a,t){yt.call(this,new Float32Array(a),t)}function At(a,t){yt.call(this,new Float64Array(a),t)}function Pt(){this.indices=[],this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function It(a){if(0===a.length)return-1/0;for(var t=a[0],e=1,o=a.length;e<o;++e)a[e]>t&&(t=a[e]);return t}function bl(){Object.defineProperty(this,"id",{value:_t()}),this.uuid=rd.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}}function Ct(a,l,s,c,d,p){gt.call(this),this.type="BoxGeometry",this.parameters={width:a,height:l,depth:s,widthSegments:c,heightSegments:d,depthSegments:p},this.fromBufferGeometry(new Lt(a,l,s,c,d,p)),this.mergeVertices()}function Lt(m,_,h,g,y,b){function x(u,t,e,n,i,r,o,h,m,_,g){var f=m+1,y=0,x=0,w=new nl,E,v;for(v=0;v<_+1;v++){var b=v*(o/_)-o/2;for(E=0;E<f;E++){var T=E*(r/m)-r/2;w[u]=T*n,w[t]=b*i,w[e]=h/2,l.push(w.x,w.y,w.z),w[u]=0,w[t]=0,w[e]=0<h?1:-1,s.push(w.x,w.y,w.z),c.push(E/m),c.push(1-v/_),y+=1}}for(v=0;v<_;v++)for(E=0;E<m;E++){var M=p+E+f*v,P=p+E+f*(v+1),C=p+(E+1)+f*(v+1),L=p+(E+1)+f*v;a.push(M,P,L),a.push(P,C,L),x+=6}S.addGroup(d,x,g),d+=x,p+=y}bl.call(this),this.type="BoxBufferGeometry",this.parameters={width:m,height:_,depth:h,widthSegments:g,heightSegments:y,depthSegments:b};var S=this;g=z(g)||1,y=z(y)||1;var a=[],l=[],s=[],c=[],p=0,d=0;x("z","y","x",-1,-1,h,_,m,b=z(b)||1,y,0),x("z","y","x",1,-1,h,_,-m,b,y,1),x("x","z","y",1,1,m,h,_,g,b,2),x("x","z","y",1,-1,m,h,-_,g,b,3),x("x","y","z",1,-1,m,_,h,g,y,4),x("x","y","z",-1,-1,m,_,-h,g,y,5),this.setIndex(a),this.addAttribute("position",new Tt(l,3)),this.addAttribute("normal",new Tt(s,3)),this.addAttribute("uv",new Tt(c,2))}function xl(a,o,r,l){gt.call(this),this.type="PlaneGeometry",this.parameters={width:a,height:o,widthSegments:r,heightSegments:l},this.fromBufferGeometry(new vl(a,o,r,l)),this.mergeVertices()}function vl(a,s,d,p){bl.call(this),this.type="PlaneBufferGeometry",this.parameters={width:a,height:s,widthSegments:d,heightSegments:p};var u=z(d)||1,l=z(p)||1,c=u+1,h=[],f=[],m=[],_=[],g,r;for(r=0;r<l+1;r++){var o=r*(s/l)-s/2;for(g=0;g<c;g++){var E=g*(a/u)-a/2;f.push(E,-o,0),m.push(0,0,1),_.push(g/u),_.push(1-r/l)}}for(r=0;r<l;r++)for(g=0;g<u;g++){var v=g+c*r,b=g+c*(r+1),w=g+1+c*(r+1),x=g+1+c*r;h.push(v,b,x),h.push(b,w,x)}this.setIndex(h),this.addAttribute("position",new Tt(f,3)),this.addAttribute("normal",new Tt(m,3)),this.addAttribute("uv",new Tt(_,2))}function Sl(e){K.call(this),this.type="MeshBasicMaterial",this.color=new X(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=yo,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(e)}function wl(a,t){this.origin=void 0===a?new nl:a,this.direction=void 0===t?new nl:t}function Ut(a,t){this.start=void 0===a?new nl:a,this.end=void 0===t?new nl:t}function Nt(a,t,e){this.a=void 0===a?new nl:a,this.b=void 0===t?new nl:t,this.c=void 0===e?new nl:e}function Bt(a,t){ut.call(this),this.type="Mesh",this.geometry=void 0===a?new bl:a,this.material=void 0===t?new Sl({color:16777215*Math.random()}):t,this.drawMode=od,this.updateMorphTargets()}function El(d,p,t,e){function n(a,t){p.buffers.color.setClear(a.r,a.g,a.b,t,e)}var r=new X(0),l=0,c,o,a;return{getClearColor:function(){return r},setClearColor:function(a,t){r.set(a),n(r,l=void 0===t?1:t)},getClearAlpha:function(){return l},setClearAlpha:function(e){n(r,l=e)},render:function(s,e,i,m){var u=e.background;null===u?n(r,l):u&&u.isColor&&(n(u,1),m=!0),(d.autoClear||m)&&d.clear(d.autoClearColor,d.autoClearDepth,d.autoClearStencil),u&&u.isCubeTexture?(void 0===a&&((a=new Bt(new Lt(1,1,1),new Q({uniforms:Ha.cube.uniforms,vertexShader:Ha.cube.vertexShader,fragmentShader:Ha.cube.fragmentShader,side:Fr,depthTest:!0,depthWrite:!1,polygonOffset:!0,fog:!1}))).geometry.removeAttribute("normal"),a.geometry.removeAttribute("uv"),a.onBeforeRender=function(a,t,e){var o=e.far;this.matrixWorld.makeScale(o,o,o),this.matrixWorld.copyPosition(e.matrixWorld),this.material.polygonOffsetUnits=10*o},t.update(a.geometry)),a.material.uniforms.tCube.value=u,s.push(a,a.geometry,a.material,0,null)):u&&u.isTexture&&(void 0===c&&(c=new ht(-1,1,1,-1,0,1),o=new Bt(new vl(2,2),new Sl({depthTest:!1,depthWrite:!1,fog:!1})),t.update(o.geometry)),o.material.map=u,d.renderBufferDirect(c,null,o.geometry,o.material,o,null))}}}function Gt(a,t){return a.renderOrder===t.renderOrder?a.program&&t.program&&a.program!==t.program?a.program.id-t.program.id:a.material.id===t.material.id?a.z===t.z?a.id-t.id:a.z-t.z:a.material.id-t.material.id:a.renderOrder-t.renderOrder}function jt(a,t){return a.renderOrder===t.renderOrder?a.z===t.z?a.id-t.id:t.z-a.z:a.renderOrder-t.renderOrder}function Ht(){var d=[],t=0,e=[],p=[];return{opaque:e,transparent:p,init:function(){t=0,e.length=0,p.length=0},push:function(n,i,u,m,_){var h=d[t];void 0===h?(h={id:n.id,object:n,geometry:i,material:u,program:u.program,renderOrder:n.renderOrder,z:m,group:_},d[t]=h):(h.id=n.id,h.object=n,h.geometry=i,h.material=u,h.program=u.program,h.renderOrder=n.renderOrder,h.z=m,h.group=_),(!0===u.transparent?p:e).push(h),t++},sort:function(){1<e.length&&e.sort(Gt),1<p.length&&p.sort(jt)}}}function Tl(){var a={};return{get:function(t,e){var o=t.id+","+e.id,n=a[o];return void 0===n&&(n=new Ht,a[o]=n),n},dispose:function(){a={}}}}function Vt(a,t){return B(t[1])-B(a[1])}function Wt(_){var t={},e=new Float32Array(8);return{update:function(n,i,r,o){var a=n.morphTargetInfluences,s=a.length,l=t[i.id];if(void 0===l){for(l=[],u=0;u<s;u++)l[u]=[u,0];t[i.id]=l}for(var c=r.morphTargets&&i.morphAttributes.position,h=r.morphNormals&&i.morphAttributes.normal,u=0;u<s;u++)0!==(p=l[u])[1]&&(c&&i.removeAttribute("morphTarget"+u),h&&i.removeAttribute("morphNormal"+u));for(u=0;u<s;u++)(p=l[u])[0]=u,p[1]=a[u];for(l.sort(Vt),u=0;8>u;u++){var p=l[u];if(p){var d=p[0],g=p[1];if(g){c&&i.addAttribute("morphTarget"+u,c[d]),h&&i.addAttribute("morphNormal"+u,h[d]),e[u]=g;continue}}e[u]=0}o.getUniforms().setValue(_,"morphTargetInfluences",e)}}}function Xt(d,t,p){var n,i,r;this.setMode=function(e){n=e},this.setIndex=function(e){i=e.type,r=e.bytesPerElement},this.render=function(t,e){d.drawElements(n,e,i,t*r),p.calls++,p.vertices+=e,n===d.TRIANGLES?p.faces+=e/3:n===d.POINTS&&(p.points+=e)},this.renderInstances=function(e,a,o){var l=t.get("ANGLE_instanced_arrays");null===l?console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays."):(l.drawElementsInstancedANGLE(n,o,i,a*r,e.maxInstancedCount),p.calls++,p.vertices+=o*e.maxInstancedCount,n===d.TRIANGLES?p.faces+=e.maxInstancedCount*o/3:n===d.POINTS&&(p.points+=e.maxInstancedCount*o))}}function Yt(c,t,d){var n;this.setMode=function(e){n=e},this.render=function(t,e){c.drawArrays(n,t,e),d.calls++,d.vertices+=e,n===c.TRIANGLES?d.faces+=e/3:n===c.POINTS&&(d.points+=e)},this.renderInstances=function(e,r,o){var a=t.get("ANGLE_instanced_arrays");if(null!==a){var i=e.attributes.position;i.isInterleavedBufferAttribute?(o=i.data.count,a.drawArraysInstancedANGLE(n,0,o,e.maxInstancedCount)):a.drawArraysInstancedANGLE(n,r,o,e.maxInstancedCount),d.calls++,d.vertices+=o*e.maxInstancedCount,n===c.TRIANGLES?d.faces+=e.maxInstancedCount*o/3:n===c.POINTS&&(d.points+=e.maxInstancedCount*o)}else console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}}function Zt(m,_,d){function n(o){var t=o.target,a=i[t.id];for(var r in null!==a.index&&_.remove(a.index),a.attributes)_.remove(a.attributes[r]);t.removeEventListener("dispose",n),delete i[t.id];var l=e[t.id];l&&(_.remove(l),delete e[t.id]),(l=e[a.id])&&(_.remove(l),delete e[a.id]),d.geometries--}var i={},e={};return{get:function(a,t){var e=i[t.id];return e||(t.addEventListener("dispose",n),t.isBufferGeometry?e=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=new bl().setFromObject(a)),e=t._bufferGeometry),i[t.id]=e,d.geometries++,e)},update:function(e){var t=e.index,n=e.attributes;for(var r in null!==t&&_.update(t,m.ELEMENT_ARRAY_BUFFER),n)_.update(n[r],m.ARRAY_BUFFER);var o=e.morphAttributes;for(var r in o)for(var a=o[r],i=0,l=a.length;i<l;i++)_.update(a[i],m.ARRAY_BUFFER)},getWireframeAttribute:function(t){var o=e[t.id];if(o)return o;var n=[],r=t.index,a=t.attributes;if(null!==r)for(var i=0,l=(p=r.array).length;i<l;i+=3){var s=p[i+0],c=p[i+1],u=p[i+2];n.push(s,c,c,u,u,s)}else for(var p=a.position.array,i=0,l=p.length/3-1;i<l;i+=3){var s=i+0,c=i+1,u=i+2;n.push(s,c,c,u,u,s)}return o=new(65535<It(n)?Mt:St)(n,1),_.update(o,m.ELEMENT_ARRAY_BUFFER),e[t.id]=o,o}}}function qt(){var a={};return{get:function(t){if(void 0!==a[t.id])return a[t.id];var e;switch(t.type){case"DirectionalLight":e={direction:new nl,color:new X,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new el};break;case"SpotLight":e={position:new nl,direction:new nl,color:new X,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new el};break;case"PointLight":e={position:new nl,color:new X,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new el,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":e={direction:new nl,skyColor:new X,groundColor:new X};break;case"RectAreaLight":e={color:new X,position:new nl,halfWidth:new nl,halfHeight:new nl};}return a[t.id]=e,e}}}function Jt(){var a=new qt,t={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},s=new nl,n=new il,i=new il;return{setup:function(e,o,r){for(var T=0,l=0,c=0,h=0,u=0,p=0,d=0,f=0,m=r.matrixWorldInverse,_=0,g=e.length;_<g;_++){var y=e[_],v=y.color,b=y.intensity,w=y.distance,x=y.shadow&&y.shadow.map?y.shadow.map.texture:null;if(y.isAmbientLight)T+=v.r*b,l+=v.g*b,c+=v.b*b;else if(y.isDirectionalLight)(E=a.get(y)).color.copy(y.color).multiplyScalar(y.intensity),E.direction.setFromMatrixPosition(y.matrixWorld),s.setFromMatrixPosition(y.target.matrixWorld),E.direction.sub(s),E.direction.transformDirection(m),E.shadow=y.castShadow,y.castShadow&&(S=y.shadow,E.shadowBias=S.bias,E.shadowRadius=S.radius,E.shadowMapSize=S.mapSize),t.directionalShadowMap[h]=x,t.directionalShadowMatrix[h]=y.shadow.matrix,t.directional[h]=E,h++;else if(y.isSpotLight)(E=a.get(y)).position.setFromMatrixPosition(y.matrixWorld),E.position.applyMatrix4(m),E.color.copy(v).multiplyScalar(b),E.distance=w,E.direction.setFromMatrixPosition(y.matrixWorld),s.setFromMatrixPosition(y.target.matrixWorld),E.direction.sub(s),E.direction.transformDirection(m),E.coneCos=Cc(y.angle),E.penumbraCos=Cc(y.angle*(1-y.penumbra)),E.decay=0===y.distance?0:y.decay,E.shadow=y.castShadow,y.castShadow&&(S=y.shadow,E.shadowBias=S.bias,E.shadowRadius=S.radius,E.shadowMapSize=S.mapSize),t.spotShadowMap[p]=x,t.spotShadowMatrix[p]=y.shadow.matrix,t.spot[p]=E,p++;else if(y.isRectAreaLight)(E=a.get(y)).color.copy(v).multiplyScalar(b/(y.width*y.height)),E.position.setFromMatrixPosition(y.matrixWorld),E.position.applyMatrix4(m),i.identity(),n.copy(y.matrixWorld),n.premultiply(m),i.extractRotation(n),E.halfWidth.set(.5*y.width,0,0),E.halfHeight.set(0,.5*y.height,0),E.halfWidth.applyMatrix4(i),E.halfHeight.applyMatrix4(i),t.rectArea[d]=E,d++;else if(y.isPointLight){if((E=a.get(y)).position.setFromMatrixPosition(y.matrixWorld),E.position.applyMatrix4(m),E.color.copy(y.color).multiplyScalar(y.intensity),E.distance=y.distance,E.decay=0===y.distance?0:y.decay,E.shadow=y.castShadow,y.castShadow){var S=y.shadow;E.shadowBias=S.bias,E.shadowRadius=S.radius,E.shadowMapSize=S.mapSize,E.shadowCameraNear=S.camera.near,E.shadowCameraFar=S.camera.far}t.pointShadowMap[u]=x,t.pointShadowMatrix[u]=y.shadow.matrix,t.point[u]=E,u++}else if(y.isHemisphereLight){var E=a.get(y);E.direction.setFromMatrixPosition(y.matrixWorld),E.direction.transformDirection(m),E.direction.normalize(),E.skyColor.copy(y.color).multiplyScalar(b),E.groundColor.copy(y.groundColor).multiplyScalar(b),t.hemi[f]=E,f++}}t.ambient[0]=T,t.ambient[1]=l,t.ambient[2]=c,t.directional.length=h,t.spot.length=p,t.rectArea.length=d,t.point.length=u,t.hemi.length=f,t.hash=h+","+u+","+p+","+d+","+f+","+o.length},state:t}}function Qt(l,t){var e={};return{update:function(n){var i=t.frame,r=n.geometry,o=l.get(n,r);return e[o.id]!==i&&(r.isGeometry&&o.updateFromObject(n),l.update(o),e[o.id]=i),o},clear:function(){e={}}}}function Kt(a){for(var t=a.split("\n"),e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join("\n")}function te(a,t,e){var o=a.createShader(t);return a.shaderSource(o,e),a.compileShader(o),!1===a.getShaderParameter(o,a.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==a.getShaderInfoLog(o)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",t===a.VERTEX_SHADER?"vertex":"fragment",a.getShaderInfoLog(o),Kt(e)),o}function ee(e){switch(e){case wa:return["Linear","( value )"];case xa:return["sRGB","( value )"];case Ea:return["RGBE","( value )"];case Ma:return["RGBM","( value, 7.0 )"];case Ta:return["RGBM","( value, 16.0 )"];case Aa:return["RGBD","( value, 256.0 )"];case Sa:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+e);}}function ne(a,t){var e=ee(t);return"vec4 "+a+"( vec4 value ) { return "+e[0]+"ToLinear"+e[1]+"; }"}function ie(a,t){var e=ee(t);return"vec4 "+a+"( vec4 value ) { return LinearTo"+e[0]+e[1]+"; }"}function re(a,t){var e;switch(t){case xo:e="Linear";break;case So:e="Reinhard";break;case Eo:e="Uncharted2";break;case Mo:e="OptimizedCineon";break;default:throw new Error("unsupported toneMapping: "+t);}return"vec3 "+a+"( vec3 color ) { return "+e+"ToneMapping( color ); }"}function oe(a,t,e){return[(a=a||{}).derivatives||t.envMapCubeUV||t.bumpMap||t.normalMap||t.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(a.fragDepth||t.logarithmicDepthBuffer)&&e.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",a.drawBuffers&&e.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(a.shaderTextureLOD||t.envMap)&&e.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(le).join("\n")}function ae(a){var t=[];for(var e in a){var o=a[e];!1!==o&&t.push("#define "+e+" "+o)}return t.join("\n")}function se(n,t){for(var e={},i=n.getProgramParameter(t,n.ACTIVE_ATTRIBUTES),r=0,o;r<i;r++)o=n.getActiveAttrib(t,r).name,e[o]=n.getAttribLocation(t,o);return e}function le(e){return""!==e}function ce(a,t){return a.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights)}function he(a){var t=/^[ \t]*#include +<([\w\d.]+)>/gm;return a.replace(t,function(a,t){var e=ja[t];if(void 0===e)throw new Error("Can not resolve #include <"+t+">");return he(e)})}function ue(a){var t=/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;return a.replace(t,function(a,t,e,n){for(var i="",r=parseInt(t);r<parseInt(e);r++)i+=n.replace(/\[ i \]/g,"[ "+r+" ]");return i})}function pe(L,t,e,n,R,r){var o=L.context,a=n.defines,s=R.vertexShader,l=R.fragmentShader,c="SHADOWMAP_TYPE_BASIC";r.shadowMapType===kr?c="SHADOWMAP_TYPE_PCF":r.shadowMapType===Dr&&(c="SHADOWMAP_TYPE_PCF_SOFT");var h="ENVMAP_TYPE_CUBE",u="ENVMAP_MODE_REFLECTION",p="ENVMAP_BLENDING_MULTIPLY";if(r.envMap){switch(n.envMap.mapping){case To:case zc:h="ENVMAP_TYPE_CUBE";break;case Vc:case Wc:h="ENVMAP_TYPE_CUBE_UV";break;case Oc:case Gc:h="ENVMAP_TYPE_EQUIREC";break;case Hc:h="ENVMAP_TYPE_SPHERE";}switch(n.envMap.mapping){case zc:case Gc:u="ENVMAP_MODE_REFRACTION";}switch(n.combine){case yo:p="ENVMAP_BLENDING_MULTIPLY";break;case vo:p="ENVMAP_BLENDING_MIX";break;case bo:p="ENVMAP_BLENDING_ADD";}}var d=0<L.gammaFactor?L.gammaFactor:1,_=oe(n.extensions,r,t),g=ae(a),y=o.createProgram(),v,D;n.isRawShaderMaterial?(v=[g,"\n"].filter(le).join("\n"),D=[_,g,"\n"].filter(le).join("\n")):(v=["precision "+r.precision+" float;","precision "+r.precision+" int;","#define SHADER_NAME "+R.name,g,r.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+d,"#define MAX_BONES "+r.maxBones,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+u:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.displacementMap&&r.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.vertexColors?"#define USE_COLOR":"",r.flatShading?"#define FLAT_SHADED":"",r.skinning?"#define USE_SKINNING":"",r.useVertexTexture?"#define BONE_TEXTURE":"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals&&!1===r.flatShading?"#define USE_MORPHNORMALS":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+r.numClippingPlanes,r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+c:"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&t.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(le).join("\n"),D=[_,"precision "+r.precision+" float;","precision "+r.precision+" int;","#define SHADER_NAME "+R.name,g,r.alphaTest?"#define ALPHATEST "+r.alphaTest:"","#define GAMMA_FACTOR "+d,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+h:"",r.envMap?"#define "+u:"",r.envMap?"#define "+p:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.vertexColors?"#define USE_COLOR":"",r.gradientMap?"#define USE_GRADIENTMAP":"",r.flatShading?"#define FLAT_SHADED":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+r.numClippingPlanes,"#define UNION_CLIPPING_PLANES "+(r.numClippingPlanes-r.numClipIntersection),r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+c:"",r.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",r.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&t.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",r.envMap&&t.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",r.toneMapping===wo?"":"#define TONE_MAPPING",r.toneMapping===wo?"":ja.tonemapping_pars_fragment,r.toneMapping===wo?"":re("toneMapping",r.toneMapping),r.dithering?"#define DITHERING":"",r.outputEncoding||r.mapEncoding||r.envMapEncoding||r.emissiveMapEncoding?ja.encodings_pars_fragment:"",r.mapEncoding?ne("mapTexelToLinear",r.mapEncoding):"",r.envMapEncoding?ne("envMapTexelToLinear",r.envMapEncoding):"",r.emissiveMapEncoding?ne("emissiveMapTexelToLinear",r.emissiveMapEncoding):"",r.outputEncoding?ie("linearToOutputTexel",r.outputEncoding):"",r.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(le).join("\n")),s=ce(s=he(s),r),l=ce(l=he(l),r),n.isShaderMaterial||(s=ue(s),l=ue(l));var k=v+s,b=D+l,w=te(o,o.VERTEX_SHADER,k),x=te(o,o.FRAGMENT_SHADER,b);o.attachShader(y,w),o.attachShader(y,x),void 0===n.index0AttributeName?!0===r.morphTargets&&o.bindAttribLocation(y,0,"position"):o.bindAttribLocation(y,0,n.index0AttributeName),o.linkProgram(y);var S=o.getProgramInfoLog(y),F=o.getShaderInfoLog(w),N=o.getShaderInfoLog(x),U=!0,B=!0;!1===o.getProgramParameter(y,o.LINK_STATUS)?(U=!1,console.error("THREE.WebGLProgram: shader error: ",o.getError(),"gl.VALIDATE_STATUS",o.getProgramParameter(y,o.VALIDATE_STATUS),"gl.getProgramInfoLog",S,F,N)):""===S?""!==F&&""!==N||(B=!1):console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",S),B&&(this.diagnostics={runnable:U,material:n,programLog:S,vertexShader:{log:F,prefix:v},fragmentShader:{log:N,prefix:D}}),o.deleteShader(w),o.deleteShader(x);var P;this.getUniforms=function(){return void 0===P&&(P=new q(o,y,L)),P};var I;return this.getAttributes=function(){return void 0===I&&(I=se(o,y)),I},this.destroy=function(){o.deleteProgram(y),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.id=Xa++,this.code=e,this.usedTimes=1,this.program=y,this.vertexShader=w,this.fragmentShader=x,this}function de(_,t,g){function n(a){var t=a.skeleton.bones;if(g.floatVertexTextures)return 1024;var e=g.maxVertexUniforms,n=z((e-20)/4),r=U(n,t.length);return r<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+r+"."),0):r}function i(a,t){var e;return a?a.isTexture?e=a.encoding:a.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e=a.texture.encoding):e=wa,e===wa&&t&&(e=Sa),e}var d=[],r={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow"},e=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];this.getParameters=function(t,e,a,o,s,y,b){var u=r[t.type],x=b.isSkinnedMesh?n(b):0,v=g.precision;null!==t.precision&&(v=g.getMaxPrecision(t.precision))!==t.precision&&console.warn("THREE.WebGLProgram.getParameters:",t.precision,"not supported, using",v,"instead.");var S=_.getRenderTarget();return{shaderID:u,precision:v,supportsVertexTextures:g.vertexTextures,outputEncoding:i(S?S.texture:null,_.gammaOutput),map:!!t.map,mapEncoding:i(t.map,_.gammaInput),envMap:!!t.envMap,envMapMode:t.envMap&&t.envMap.mapping,envMapEncoding:i(t.envMap,_.gammaInput),envMapCubeUV:!!t.envMap&&(t.envMap.mapping===Vc||t.envMap.mapping===Wc),lightMap:!!t.lightMap,aoMap:!!t.aoMap,emissiveMap:!!t.emissiveMap,emissiveMapEncoding:i(t.emissiveMap,_.gammaInput),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,gradientMap:!!t.gradientMap,combine:t.combine,vertexColors:t.vertexColors,fog:!!o,useFog:t.fog,fogExp:o&&o.isFogExp2,flatShading:t.flatShading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:g.logarithmicDepthBuffer,skinning:t.skinning&&0<x,maxBones:x,useVertexTexture:g.floatVertexTextures,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:_.maxMorphTargets,maxMorphNormals:_.maxMorphNormals,numDirLights:e.directional.length,numPointLights:e.point.length,numSpotLights:e.spot.length,numRectAreaLights:e.rectArea.length,numHemiLights:e.hemi.length,numClippingPlanes:s,numClipIntersection:y,dithering:t.dithering,shadowMapEnabled:_.shadowMap.enabled&&b.receiveShadow&&0<a.length,shadowMapType:_.shadowMap.type,toneMapping:_.toneMapping,physicallyCorrectLights:_.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,alphaTest:t.alphaTest,doubleSided:t.side===Ac,flipSided:t.side===Fr,depthPacking:void 0!==t.depthPacking&&t.depthPacking}},this.getProgramCode=function(t,a){var n=[];if(a.shaderID?n.push(a.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(var i in t.defines)n.push(i),n.push(t.defines[i]);for(var r=0;r<e.length;r++)n.push(a[e[r]]);return n.push(t.onBeforeCompile.toString()),n.push(_.gammaOutput),n.join()},this.acquireProgram=function(e,o,n,r){for(var a=0,i=d.length,l,s;a<i;a++)if(s=d[a],s.code===r){++(l=s).usedTimes;break}return void 0===l&&(l=new pe(_,t,r,e,o,n),d.push(l)),l},this.releaseProgram=function(a){if(0==--a.usedTimes){var t=d.indexOf(a);d[t]=d[d.length-1],d.pop(),a.destroy()}},this.programs=d}function fe(T,t,M,P,L,A,n){function a(a,t){if(a.width>t||a.height>t){var e=t/C(a.width,a.height),o=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return o.width=z(a.width*e),o.height=z(a.height*e),o.getContext("2d").drawImage(a,0,0,a.width,a.height,0,0,o.width,o.height),console.warn("THREE.WebGLRenderer: image is too big ("+a.width+"x"+a.height+"). Resized to "+o.width+"x"+o.height,a),o}return a}function I(e){return rd.isPowerOfTwo(e.width)&&rd.isPowerOfTwo(e.height)}function o(a){if(a instanceof HTMLImageElement||a instanceof HTMLCanvasElement){var t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return t.width=rd.nearestPowerOfTwo(a.width),t.height=rd.nearestPowerOfTwo(a.height),t.getContext("2d").drawImage(a,0,0,t.width,t.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+a.width+"x"+a.height+"). Resized to "+t.width+"x"+t.height,a),t}return a}function r(e){return e.wrapS!==qc||e.wrapT!==qc||e.minFilter!==Yc&&e.minFilter!==Kc}function l(a,t){return a.generateMipmaps&&t&&a.minFilter!==Yc&&a.minFilter!==Kc}function e(t){return t===Yc||t===Zc||t===Jc?T.NEAREST:T.LINEAR}function s(a){var t=a.target;t.removeEventListener("dispose",s),c(t),n.textures--}function i(a){var t=a.target;t.removeEventListener("dispose",i),d(t),n.textures--}function c(t){var e=P.get(t);if(t.image&&e.__image__webglTextureCube)T.deleteTexture(e.__image__webglTextureCube);else{if(void 0===e.__webglInit)return;T.deleteTexture(e.__webglTexture)}P.remove(t)}function d(t){var e=P.get(t),a=P.get(t.texture);if(t){if(void 0!==a.__webglTexture&&T.deleteTexture(a.__webglTexture),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLRenderTargetCube)for(var r=0;6>r;r++)T.deleteFramebuffer(e.__webglFramebuffer[r]),e.__webglDepthbuffer&&T.deleteRenderbuffer(e.__webglDepthbuffer[r]);else T.deleteFramebuffer(e.__webglFramebuffer),e.__webglDepthbuffer&&T.deleteRenderbuffer(e.__webglDepthbuffer);P.remove(t.texture),P.remove(t)}}function p(t,e){var r=P.get(t);if(0<t.version&&r.__version!==t.version){var o=t.image;if(void 0===o)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",t);else{if(!1!==o.complete)return void m(r,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",t)}}M.activeTexture(T.TEXTURE0+e),M.bindTexture(T.TEXTURE_2D,r.__webglTexture)}function u(o,r,a){var n;if(a?(T.texParameteri(o,T.TEXTURE_WRAP_S,A.convert(r.wrapS)),T.texParameteri(o,T.TEXTURE_WRAP_T,A.convert(r.wrapT)),T.texParameteri(o,T.TEXTURE_MAG_FILTER,A.convert(r.magFilter)),T.texParameteri(o,T.TEXTURE_MIN_FILTER,A.convert(r.minFilter))):(T.texParameteri(o,T.TEXTURE_WRAP_S,T.CLAMP_TO_EDGE),T.texParameteri(o,T.TEXTURE_WRAP_T,T.CLAMP_TO_EDGE),r.wrapS===qc&&r.wrapT===qc||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",r),T.texParameteri(o,T.TEXTURE_MAG_FILTER,e(r.magFilter)),T.texParameteri(o,T.TEXTURE_MIN_FILTER,e(r.minFilter)),r.minFilter!==Yc&&r.minFilter!==Kc&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",r)),n=t.get("EXT_texture_filter_anisotropic")){if(r.type===Yo&&null===t.get("OES_texture_float_linear"))return;if(r.type===Zo&&null===t.get("OES_texture_half_float_linear"))return;(1<r.anisotropy||P.get(r).__currentAnisotropy)&&(T.texParameterf(o,n.TEXTURE_MAX_ANISOTROPY_EXT,U(r.anisotropy,L.getMaxAnisotropy())),P.get(r).__currentAnisotropy=r.anisotropy)}}function m(t,e,i){void 0===t.__webglInit&&(t.__webglInit=!0,e.addEventListener("dispose",s),t.__webglTexture=T.createTexture(),n.textures++),M.activeTexture(T.TEXTURE0+i),M.bindTexture(T.TEXTURE_2D,t.__webglTexture),T.pixelStorei(T.UNPACK_FLIP_Y_WEBGL,e.flipY),T.pixelStorei(T.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),T.pixelStorei(T.UNPACK_ALIGNMENT,e.unpackAlignment);var c=a(e.image,L.maxTextureSize);r(e)&&!1===I(c)&&(c=o(c));var d=I(c),p=A.convert(e.format),m=A.convert(e.type);u(T.TEXTURE_2D,e,d);var _=e.mipmaps,h;if(e.isDepthTexture){var g=T.DEPTH_COMPONENT;if(e.type===Yo){if(!y)throw new Error("Float Depth Texture only supported in WebGL2.0");g=T.DEPTH_COMPONENT32F}else y&&(g=T.DEPTH_COMPONENT16);e.format===oa&&g===T.DEPTH_COMPONENT&&e.type!==Wo&&e.type!==Xo&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),e.type=Wo,m=A.convert(e.type)),e.format===aa&&(g=T.DEPTH_STENCIL,e.type!==$o&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),e.type=$o,m=A.convert(e.type))),M.texImage2D(T.TEXTURE_2D,0,g,c.width,c.height,0,p,m,null)}else if(e.isDataTexture){if(0<_.length&&d){for(var f=0,b=_.length;f<b;f++)h=_[f],M.texImage2D(T.TEXTURE_2D,f,p,h.width,h.height,0,p,m,h.data);e.generateMipmaps=!1}else M.texImage2D(T.TEXTURE_2D,0,p,c.width,c.height,0,p,m,c.data);}else if(e.isCompressedTexture)for(var f=0,b=_.length;f<b;f++)h=_[f],e.format!==td&&e.format!==ea?-1<M.getCompressedTextureFormats().indexOf(p)?M.compressedTexImage2D(T.TEXTURE_2D,f,p,h.width,h.height,0,h.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):M.texImage2D(T.TEXTURE_2D,f,p,h.width,h.height,0,p,m,h.data);else if(0<_.length&&d){for(var f=0,b=_.length;f<b;f++)h=_[f],M.texImage2D(T.TEXTURE_2D,f,p,p,m,h);e.generateMipmaps=!1}else M.texImage2D(T.TEXTURE_2D,0,p,p,m,c);l(e,d)&&T.generateMipmap(T.TEXTURE_2D),t.__version=e.version,e.onUpdate&&e.onUpdate(e)}function _(t,e,o,a){var r=A.convert(e.texture.format),n=A.convert(e.texture.type);M.texImage2D(a,0,r,e.width,e.height,0,r,n,null),T.bindFramebuffer(T.FRAMEBUFFER,t),T.framebufferTexture2D(T.FRAMEBUFFER,o,a,P.get(e.texture).__webglTexture,0),T.bindFramebuffer(T.FRAMEBUFFER,null)}function h(t,e){T.bindRenderbuffer(T.RENDERBUFFER,t),e.depthBuffer&&!e.stencilBuffer?(T.renderbufferStorage(T.RENDERBUFFER,T.DEPTH_COMPONENT16,e.width,e.height),T.framebufferRenderbuffer(T.FRAMEBUFFER,T.DEPTH_ATTACHMENT,T.RENDERBUFFER,t)):e.depthBuffer&&e.stencilBuffer?(T.renderbufferStorage(T.RENDERBUFFER,T.DEPTH_STENCIL,e.width,e.height),T.framebufferRenderbuffer(T.FRAMEBUFFER,T.DEPTH_STENCIL_ATTACHMENT,T.RENDERBUFFER,t)):T.renderbufferStorage(T.RENDERBUFFER,T.RGBA4,e.width,e.height),T.bindRenderbuffer(T.RENDERBUFFER,null)}function g(t,e){if(e&&e.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(T.bindFramebuffer(T.FRAMEBUFFER,t),!e.depthTexture||!e.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");P.get(e.depthTexture).__webglTexture&&e.depthTexture.image.width===e.width&&e.depthTexture.image.height===e.height||(e.depthTexture.image.width=e.width,e.depthTexture.image.height=e.height,e.depthTexture.needsUpdate=!0),p(e.depthTexture,0);var a=P.get(e.depthTexture).__webglTexture;if(e.depthTexture.format===oa)T.framebufferTexture2D(T.FRAMEBUFFER,T.DEPTH_ATTACHMENT,T.TEXTURE_2D,a,0);else{if(e.depthTexture.format!==aa)throw new Error("Unknown depthTexture format");T.framebufferTexture2D(T.FRAMEBUFFER,T.DEPTH_STENCIL_ATTACHMENT,T.TEXTURE_2D,a,0)}}function f(t){var e=P.get(t),a=!0===t.isWebGLRenderTargetCube;if(t.depthTexture){if(a)throw new Error("target.depthTexture not supported in Cube render targets");g(e.__webglFramebuffer,t)}else if(a){e.__webglDepthbuffer=[];for(var r=0;6>r;r++)T.bindFramebuffer(T.FRAMEBUFFER,e.__webglFramebuffer[r]),e.__webglDepthbuffer[r]=T.createRenderbuffer(),h(e.__webglDepthbuffer[r],t)}else T.bindFramebuffer(T.FRAMEBUFFER,e.__webglFramebuffer),e.__webglDepthbuffer=T.createRenderbuffer(),h(e.__webglDepthbuffer,t);T.bindFramebuffer(T.FRAMEBUFFER,null)}var y="undefined"!=typeof WebGL2RenderingContext&&T instanceof WebGL2RenderingContext;this.setTexture2D=p,this.setTextureCube=function(t,e){var o=P.get(t);if(6===t.image.length)if(0<t.version&&o.__version!==t.version){o.__image__webglTextureCube||(t.addEventListener("dispose",s),o.__image__webglTextureCube=T.createTexture(),n.textures++),M.activeTexture(T.TEXTURE0+e),M.bindTexture(T.TEXTURE_CUBE_MAP,o.__image__webglTextureCube),T.pixelStorei(T.UNPACK_FLIP_Y_WEBGL,t.flipY);for(var r=t&&t.isCompressedTexture,i=t.image[0]&&t.image[0].isDataTexture,c=[],d=0;6>d;d++)c[d]=r||i?i?t.image[d].image:t.image[d]:a(t.image[d],L.maxCubemapSize);var p=I(c[0]),m=A.convert(t.format),_=A.convert(t.type);for(u(T.TEXTURE_CUBE_MAP,t,p),d=0;6>d;d++)if(r)for(var h=c[d].mipmaps,g=0,f=h.length,y;g<f;g++)y=h[g],t.format!==td&&t.format!==ea?-1<M.getCompressedTextureFormats().indexOf(m)?M.compressedTexImage2D(T.TEXTURE_CUBE_MAP_POSITIVE_X+d,g,m,y.width,y.height,0,y.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):M.texImage2D(T.TEXTURE_CUBE_MAP_POSITIVE_X+d,g,m,y.width,y.height,0,m,_,y.data);else i?M.texImage2D(T.TEXTURE_CUBE_MAP_POSITIVE_X+d,0,m,c[d].width,c[d].height,0,m,_,c[d].data):M.texImage2D(T.TEXTURE_CUBE_MAP_POSITIVE_X+d,0,m,m,_,c[d]);l(t,p)&&T.generateMipmap(T.TEXTURE_CUBE_MAP),o.__version=t.version,t.onUpdate&&t.onUpdate(t)}else M.activeTexture(T.TEXTURE0+e),M.bindTexture(T.TEXTURE_CUBE_MAP,o.__image__webglTextureCube)},this.setTextureCubeDynamic=function(t,e){M.activeTexture(T.TEXTURE0+e),M.bindTexture(T.TEXTURE_CUBE_MAP,P.get(t).__webglTexture)},this.setupRenderTarget=function(t){var e=P.get(t),a=P.get(t.texture);t.addEventListener("dispose",i),a.__webglTexture=T.createTexture(),n.textures++;var o=!0===t.isWebGLRenderTargetCube,r=I(t);if(o)for(e.__webglFramebuffer=[],s=0;6>s;s++)e.__webglFramebuffer[s]=T.createFramebuffer();else e.__webglFramebuffer=T.createFramebuffer();if(o){M.bindTexture(T.TEXTURE_CUBE_MAP,a.__webglTexture),u(T.TEXTURE_CUBE_MAP,t.texture,r);for(var s=0;6>s;s++)_(e.__webglFramebuffer[s],t,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+s);l(t.texture,r)&&T.generateMipmap(T.TEXTURE_CUBE_MAP),M.bindTexture(T.TEXTURE_CUBE_MAP,null)}else M.bindTexture(T.TEXTURE_2D,a.__webglTexture),u(T.TEXTURE_2D,t.texture,r),_(e.__webglFramebuffer,t,T.COLOR_ATTACHMENT0,T.TEXTURE_2D),l(t.texture,r)&&T.generateMipmap(T.TEXTURE_2D),M.bindTexture(T.TEXTURE_2D,null);t.depthBuffer&&f(t)},this.updateRenderTargetMipmap=function(t){var e=t.texture;if(l(e,I(t))){var r=t.isWebGLRenderTargetCube?T.TEXTURE_CUBE_MAP:T.TEXTURE_2D,o=P.get(e).__webglTexture;M.bindTexture(r,o),T.generateMipmap(r),M.bindTexture(r,null)}}}function me(){var a={};return{get:function(t){var e=t.uuid,o=a[e];return void 0===o&&(o={},a[e]=o),o},remove:function(t){delete a[t.uuid]},clear:function(){a={}}}}function _e(H,t,V){function e(t,e,n){var l=new Uint8Array(4),r=H.createTexture();H.bindTexture(t,r),H.texParameteri(t,H.TEXTURE_MIN_FILTER,H.NEAREST),H.texParameteri(t,H.TEXTURE_MAG_FILTER,H.NEAREST);for(var o=0;o<n;o++)H.texImage2D(e+o,0,H.RGBA,1,1,0,H.RGBA,H.UNSIGNED_BYTE,l);return r}function W(t){!0!==y[t]&&(H.enable(t),y[t]=!0)}function q(t){!1!==y[t]&&(H.disable(t),y[t]=!1)}function a(t,e,o,a,r,n,i,l){(t===Rc?q(H.BLEND):W(H.BLEND),t!==Uc)?((t!==w||l!==P)&&(t===kc?l?(H.blendEquationSeparate(H.FUNC_ADD,H.FUNC_ADD),H.blendFuncSeparate(H.ONE,H.ONE,H.ONE,H.ONE)):(H.blendEquation(H.FUNC_ADD),H.blendFunc(H.SRC_ALPHA,H.ONE)):t===Fc?l?(H.blendEquationSeparate(H.FUNC_ADD,H.FUNC_ADD),H.blendFuncSeparate(H.ZERO,H.ZERO,H.ONE_MINUS_SRC_COLOR,H.ONE_MINUS_SRC_ALPHA)):(H.blendEquation(H.FUNC_ADD),H.blendFunc(H.ZERO,H.ONE_MINUS_SRC_COLOR)):t===Nc?l?(H.blendEquationSeparate(H.FUNC_ADD,H.FUNC_ADD),H.blendFuncSeparate(H.ZERO,H.SRC_COLOR,H.ZERO,H.SRC_ALPHA)):(H.blendEquation(H.FUNC_ADD),H.blendFunc(H.ZERO,H.SRC_COLOR)):l?(H.blendEquationSeparate(H.FUNC_ADD,H.FUNC_ADD),H.blendFuncSeparate(H.ONE,H.ONE_MINUS_SRC_ALPHA,H.ONE,H.ONE_MINUS_SRC_ALPHA)):(H.blendEquationSeparate(H.FUNC_ADD,H.FUNC_ADD),H.blendFuncSeparate(H.SRC_ALPHA,H.ONE_MINUS_SRC_ALPHA,H.ONE,H.ONE_MINUS_SRC_ALPHA))),x=null,S=null,E=null,M=null,T=null,A=null):(r=r||e,n=n||o,i=i||a,e===x&&r===M||(H.blendEquationSeparate(V.convert(e),V.convert(r)),x=e,M=r),o===S&&a===E&&n===T&&i===A||(H.blendFuncSeparate(V.convert(o),V.convert(a),V.convert(n),V.convert(i)),S=o,E=a,T=n,A=i));w=t,P=l}function n(t){I!==t&&(t?H.frontFace(H.CW):H.frontFace(H.CCW),I=t)}function i(t){t===Ir?q(H.CULL_FACE):(W(H.CULL_FACE),t!==C&&(t===Cr?H.cullFace(H.BACK):t===Lr?H.cullFace(H.FRONT):H.cullFace(H.FRONT_AND_BACK))),C=t}function X(t,e,a){t?(W(H.POLYGON_OFFSET_FILL),R===e&&k===a||(H.polygonOffset(e,a),R=e,k=a)):q(H.POLYGON_OFFSET_FILL)}function Y(t){void 0===t&&(t=H.TEXTURE0+D-1),U!==t&&(H.activeTexture(t),U=t)}var Z=new function(){var a=!1,t=new al,e=null,n=new al(0,0,0,0);return{setMask:function(t){e===t||a||(H.colorMask(t,t,t,t),e=t)},setLocked:function(e){a=e},setClear:function(r,e,i,o,a){!0===a&&(r*=o,e*=o,i*=o),t.set(r,e,i,o),!1===n.equals(t)&&(H.clearColor(r,e,i,o),n.copy(t))},reset:function(){a=!1,e=null,n.set(-1,0,0,0)}}},J=new function(){var o=!1,e=null,t=null,r=null;return{setTest:function(t){t?W(H.DEPTH_TEST):q(H.DEPTH_TEST)},setMask:function(t){e===t||o||(H.depthMask(t),e=t)},setFunc:function(a){t!==a&&(a?a===co?H.depthFunc(H.NEVER):a===ho?H.depthFunc(H.ALWAYS):a===uo?H.depthFunc(H.LESS):a===po?H.depthFunc(H.LEQUAL):a===fo?H.depthFunc(H.EQUAL):a===mo?H.depthFunc(H.GEQUAL):a===_o?H.depthFunc(H.GREATER):a===go?H.depthFunc(H.NOTEQUAL):H.depthFunc(H.LEQUAL):H.depthFunc(H.LEQUAL),t=a)},setLocked:function(e){o=e},setClear:function(t){r!==t&&(H.clearDepth(t),r=t)},reset:function(){o=!1,e=null,t=null,r=null}}},K=new function(){var o=!1,e=null,t=null,i=null,a=null,r=null,l=null,s=null,n=null;return{setTest:function(t){t?W(H.STENCIL_TEST):q(H.STENCIL_TEST)},setMask:function(t){e===t||o||(H.stencilMask(t),e=t)},setFunc:function(o,e,n){t===o&&i===e&&a===n||(H.stencilFunc(o,e,n),t=o,i=e,a=n)},setOp:function(t,e,a){r===t&&l===e&&s===a||(H.stencilOp(t,e,a),r=t,l=e,s=a)},setLocked:function(e){o=e},setClear:function(t){n!==t&&(H.clearStencil(t),n=t)},reset:function(){o=!1,e=null,t=null,i=null,a=null,r=null,l=null,s=null,n=null}}},Q=H.getParameter(H.MAX_VERTEX_ATTRIBS),m=new Uint8Array(Q),_=new Uint8Array(Q),g=new Uint8Array(Q),y={},v=null,b=null,w=null,x=null,S=null,E=null,M=null,T=null,A=null,P=!1,I=null,C=null,L=null,R=null,k=null,D=H.getParameter(H.MAX_COMBINED_TEXTURE_IMAGE_UNITS),O=parseFloat(/^WebGL\ ([0-9])/.exec(H.getParameter(H.VERSION))[1]),F=1<=parseFloat(O),U=null,N={},B=new al,z=new al,G={};return G[H.TEXTURE_2D]=e(H.TEXTURE_2D,H.TEXTURE_2D,1),G[H.TEXTURE_CUBE_MAP]=e(H.TEXTURE_CUBE_MAP,H.TEXTURE_CUBE_MAP_POSITIVE_X,6),Z.setClear(0,0,0,1),J.setClear(1),K.setClear(0),W(H.DEPTH_TEST),J.setFunc(po),n(!1),i(Cr),W(H.CULL_FACE),W(H.BLEND),a(Dc),{buffers:{color:Z,depth:J,stencil:K},initAttributes:function(){for(var a=0,t=m.length;a<t;a++)m[a]=0},enableAttribute:function(e){m[e]=1,0===_[e]&&(H.enableVertexAttribArray(e),_[e]=1),0!==g[e]&&(t.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(e,0),g[e]=0)},enableAttributeAndDivisor:function(e,a){m[e]=1,0===_[e]&&(H.enableVertexAttribArray(e),_[e]=1),g[e]!==a&&(t.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(e,a),g[e]=a)},disableUnusedAttributes:function(){for(var t=0,e=_.length;t!==e;++t)_[t]!==m[t]&&(H.disableVertexAttribArray(t),_[t]=0)},enable:W,disable:q,getCompressedTextureFormats:function(){if(null===v&&(v=[],t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")||t.get("WEBGL_compressed_texture_etc1")))for(var e=H.getParameter(H.COMPRESSED_TEXTURE_FORMATS),a=0;a<e.length;a++)v.push(e[a]);return v},useProgram:function(t){return b!==t&&(H.useProgram(t),b=t,!0)},setBlending:a,setMaterial:function(t){t.side===Ac?q(H.CULL_FACE):W(H.CULL_FACE),n(t.side===Fr),!0===t.transparent?a(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha):a(Rc),J.setFunc(t.depthFunc),J.setTest(t.depthTest),J.setMask(t.depthWrite),Z.setMask(t.colorWrite),X(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:n,setCullFace:i,setLineWidth:function(t){t!==L&&(F&&H.lineWidth(t),L=t)},setPolygonOffset:X,setScissorTest:function(t){t?W(H.SCISSOR_TEST):q(H.SCISSOR_TEST)},activeTexture:Y,bindTexture:function(t,e){null===U&&Y();var a=N[U];void 0===a&&(a={type:void 0,texture:void 0},N[U]=a),a.type===t&&a.texture===e||(H.bindTexture(t,e||G[t]),a.type=t,a.texture=e)},compressedTexImage2D:function(){try{H.compressedTexImage2D.apply(H,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{H.texImage2D.apply(H,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===B.equals(t)&&(H.scissor(t.x,t.y,t.z,t.w),B.copy(t))},viewport:function(t){!1===z.equals(t)&&(H.viewport(t.x,t.y,t.z,t.w),z.copy(t))},reset:function(){for(var t=0;t<_.length;t++)1===_[t]&&(H.disableVertexAttribArray(t),_[t]=0);y={},v=null,U=null,N={},b=null,w=null,I=null,C=null,Z.reset(),J.reset(),K.reset()}}}function ge(y,t,e){function n(t){if("highp"===t){if(0<y.getShaderPrecisionFormat(y.VERTEX_SHADER,y.HIGH_FLOAT).precision&&0<y.getShaderPrecisionFormat(y.FRAGMENT_SHADER,y.HIGH_FLOAT).precision)return"highp";t="mediump"}return"mediump"===t&&0<y.getShaderPrecisionFormat(y.VERTEX_SHADER,y.MEDIUM_FLOAT).precision&&0<y.getShaderPrecisionFormat(y.FRAGMENT_SHADER,y.MEDIUM_FLOAT).precision?"mediump":"lowp"}var b=void 0===e.precision?"highp":e.precision,x=n(b),a;x!==b&&(console.warn("THREE.WebGLRenderer:",b,"not supported, using",x,"instead."),b=x);var r=!0===e.logarithmicDepthBuffer&&!!t.get("EXT_frag_depth"),v=y.getParameter(y.MAX_TEXTURE_IMAGE_UNITS),S=y.getParameter(y.MAX_VERTEX_TEXTURE_IMAGE_UNITS),w=y.getParameter(y.MAX_TEXTURE_SIZE),E=y.getParameter(y.MAX_CUBE_MAP_TEXTURE_SIZE),T=y.getParameter(y.MAX_VERTEX_ATTRIBS),M=y.getParameter(y.MAX_VERTEX_UNIFORM_VECTORS),P=y.getParameter(y.MAX_VARYING_VECTORS),C=y.getParameter(y.MAX_FRAGMENT_UNIFORM_VECTORS),L=0<S,A=!!t.get("OES_texture_float");return{getMaxAnisotropy:function(){if(void 0!==a)return a;var e=t.get("EXT_texture_filter_anisotropic");return a=null===e?0:y.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT)},getMaxPrecision:n,precision:b,logarithmicDepthBuffer:r,maxTextures:v,maxVertexTextures:S,maxTextureSize:w,maxCubemapSize:E,maxAttributes:T,maxVertexUniforms:M,maxVaryings:P,maxFragmentUniforms:C,vertexTextures:L,floatFragmentTextures:A,floatVertexTextures:L&&A}}function ye(e){fl.call(this),this.cameras=e||[]}function $t(a){function t(){if(null!==m&&m.isPresenting){var t=m.getEyeParameters("left"),i=t.renderWidth,r=t.renderHeight;d=a.getPixelRatio(),n=a.getSize(),a.setDrawingBufferSize(2*i,r,1)}else u.enabled&&a.setDrawingBufferSize(n.width,n.height,d)}var u=this,m=null,i=null;"VRFrameData"in window&&(i=new window.VRFrameData);var r=new il,o=new il,s=new il,l=new fl;l.bounds=new al(0,0,.5,1),l.layers.enable(1);var c=new fl;c.bounds=new al(.5,0,.5,1),c.layers.enable(2);var _=new ye([l,c]);_.layers.enable(1),_.layers.enable(2);var n,d;window.addEventListener("vrdisplaypresentchange",t,!1),this.enabled=!1,this.standing=!1,this.getDevice=function(){return m},this.setDevice=function(e){void 0!==e&&(m=e)},this.getCamera=function(p){if(null===m)return p;m.depthNear=p.near,m.depthFar=p.far,m.getFrameData(i);var t=i.pose;null===t.position?p.position.set(0,0,0):p.position.fromArray(t.position),null!==t.orientation&&p.quaternion.fromArray(t.orientation),p.updateMatrixWorld();var e=m.stageParameters;if(this.standing&&e&&(o.fromArray(e.sittingToStandingTransform),s.getInverse(o),p.matrixWorld.multiply(o),p.matrixWorldInverse.multiply(s)),!1===m.isPresenting)return p;l.near=p.near,c.near=p.near,l.far=p.far,c.far=p.far,_.matrixWorld.copy(p.matrixWorld),_.matrixWorldInverse.copy(p.matrixWorldInverse),l.matrixWorldInverse.fromArray(i.leftViewMatrix),c.matrixWorldInverse.fromArray(i.rightViewMatrix),this.standing&&e&&(l.matrixWorldInverse.multiply(s),c.matrixWorldInverse.multiply(s));var n=p.parent;null!==n&&(r.getInverse(n.matrixWorld),l.matrixWorldInverse.multiply(r),c.matrixWorldInverse.multiply(r)),l.matrixWorld.getInverse(l.matrixWorldInverse),c.matrixWorld.getInverse(c.matrixWorldInverse),l.projectionMatrix.fromArray(i.leftProjectionMatrix),c.projectionMatrix.fromArray(i.rightProjectionMatrix),_.projectionMatrix.copy(l.projectionMatrix);var a=m.getLayers();if(a.length){var u=a[0];null!==u.leftBounds&&4===u.leftBounds.length&&l.bounds.fromArray(u.leftBounds),null!==u.rightBounds&&4===u.rightBounds.length&&c.bounds.fromArray(u.rightBounds)}return _},this.getStandingMatrix=function(){return o},this.submitFrame=function(){m&&m.isPresenting&&m.submitFrame()},this.dispose=function(){window.removeEventListener("vrdisplaypresentchange",t)}}function be(a){var t={};return{get:function(e){if(void 0!==t[e])return t[e];var o;return o="WEBGL_depth_texture"===e?a.getExtension("WEBGL_depth_texture")||a.getExtension("MOZ_WEBGL_depth_texture")||a.getExtension("WEBKIT_WEBGL_depth_texture"):"EXT_texture_filter_anisotropic"===e?a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"):"WEBGL_compressed_texture_s3tc"===e?a.getExtension("WEBGL_compressed_texture_s3tc")||a.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"):"WEBGL_compressed_texture_pvrtc"===e?a.getExtension("WEBGL_compressed_texture_pvrtc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"):"WEBGL_compressed_texture_etc1"===e?a.getExtension("WEBGL_compressed_texture_etc1"):a.getExtension(e),null===o&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t[e]=o,o}}}function we(){function g(){l.value!==e&&(l.value=e,l.needsUpdate=0<i),m.numPlanes=i,m.numIntersection=0}function y(c,t,_,i){var r=null===c?0:c.length,o=null;if(0!==r){if(o=l.value,!0!==i||null===o){var a=_+4*r,h=t.matrixWorldInverse;s.getNormalMatrix(h),(null===o||o.length<a)&&(o=new Float32Array(a));for(var u=0,p=_;u!==r;++u,p+=4)n.copy(c[u]).applyMatrix4(h,s),n.normal.toArray(o,p),o[p+3]=n.constant}l.value=o,l.needsUpdate=!0}return m.numPlanes=r,o}var m=this,e=null,i=0,r=!1,t=!1,n=new ot,s=new rt,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(o,t,n){var a=0!==o.length||t||0!==i||r;return r=t,e=y(o,n,0),i=o.length,a},this.beginShadows=function(){t=!0,y(null)},this.endShadows=function(){t=!1,g()},this.setState=function(a,n,s,c,h,u){if(!r||null===a||0===a.length||t&&!s)t?y(null):g();else{var p=t?0:i,d=4*p,f=h.clippingState||null;l.value=f,f=y(a,c,d,u);for(var m=0;m!==d;++m)f[m]=e[m];h.clippingState=f,this.numIntersection=n?this.numPlanes:0,this.numPlanes+=p}}}function xe(a,t){return{convert:function(e){var o;if(e===jc)return a.REPEAT;if(e===qc)return a.CLAMP_TO_EDGE;if(e===Xc)return a.MIRRORED_REPEAT;if(e===Yc)return a.NEAREST;if(e===Zc)return a.NEAREST_MIPMAP_NEAREST;if(e===Jc)return a.NEAREST_MIPMAP_LINEAR;if(e===Kc)return a.LINEAR;if(e===Qc)return a.LINEAR_MIPMAP_NEAREST;if(e===$c)return a.LINEAR_MIPMAP_LINEAR;if(e===ed)return a.UNSIGNED_BYTE;if(e===Jo)return a.UNSIGNED_SHORT_4_4_4_4;if(e===Ko)return a.UNSIGNED_SHORT_5_5_5_1;if(e===Qo)return a.UNSIGNED_SHORT_5_6_5;if(e===Ho)return a.BYTE;if(e===Vo)return a.SHORT;if(e===Wo)return a.UNSIGNED_SHORT;if(e===qo)return a.INT;if(e===Xo)return a.UNSIGNED_INT;if(e===Yo)return a.FLOAT;if(e===Zo&&null!==(o=t.get("OES_texture_half_float")))return o.HALF_FLOAT_OES;if(e===ta)return a.ALPHA;if(e===ea)return a.RGB;if(e===td)return a.RGBA;if(e===ad)return a.LUMINANCE;if(e===ra)return a.LUMINANCE_ALPHA;if(e===oa)return a.DEPTH_COMPONENT;if(e===aa)return a.DEPTH_STENCIL;if(e===Bc)return a.FUNC_ADD;if(e===Yr)return a.FUNC_SUBTRACT;if(e===Zr)return a.FUNC_REVERSE_SUBTRACT;if(e===Qr)return a.ZERO;if(e===$r)return a.ONE;if(e===to)return a.SRC_COLOR;if(e===eo)return a.ONE_MINUS_SRC_COLOR;if(e===no)return a.SRC_ALPHA;if(e===io)return a.ONE_MINUS_SRC_ALPHA;if(e===ro)return a.DST_ALPHA;if(e===oo)return a.ONE_MINUS_DST_ALPHA;if(e===ao)return a.DST_COLOR;if(e===so)return a.ONE_MINUS_DST_COLOR;if(e===lo)return a.SRC_ALPHA_SATURATE;if((e===sa||e===la||e===ca||e===ha)&&null!==(o=t.get("WEBGL_compressed_texture_s3tc"))){if(e===sa)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===la)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===ca)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===ha)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((e===ua||e===pa||e===da||e===fa)&&null!==(o=t.get("WEBGL_compressed_texture_pvrtc"))){if(e===ua)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===pa)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===da)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===fa)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===ma&&null!==(o=t.get("WEBGL_compressed_texture_etc1")))return o.COMPRESSED_RGB_ETC1_WEBGL;if((e===Jr||e===Kr)&&null!==(o=t.get("EXT_blend_minmax"))){if(e===Jr)return o.MIN_EXT;if(e===Kr)return o.MAX_EXT}return e===$o&&null!==(o=t.get("WEBGL_depth_texture"))?o.UNSIGNED_INT_24_8_WEBGL:0}}}function Se(a){function t(){return null===he?Ie:1}function e(){(je=new be(Ve)).get("WEBGL_depth_texture"),je.get("OES_texture_float"),je.get("OES_texture_float_linear"),je.get("OES_texture_half_float"),je.get("OES_texture_half_float_linear"),je.get("OES_standard_derivatives"),je.get("ANGLE_instanced_arrays"),je.get("OES_element_index_uint")&&(bl.MaxIndex=4294967296),ut=new xe(Ve,je),qe=new ge(Ve,je,a),(Xe=new _e(Ve,je,ut)).scissor(Me.copy(De).multiplyScalar(Ie)),Xe.viewport(Te.copy(Re).multiplyScalar(Ie)),Ye=new me,Ze=new fe(Ve,je,Xe,Ye,qe,ut,Ge),Je=new lt(Ve),Ke=new Zt(Ve,Je,Ge),Qe=new Qt(Ke,He),ot=new Wt(Ve),et=new de(Y,je,qe),$e=new Jt,tt=new Tl,at=new El(Y,Xe,Ke,F),rt=new Yt(Ve,je,He),nt=new Xt(Ve,je,He),it=new ul(Y,Ve,Xe,Ze,qe),ct=new J(Y,Ve,Xe,Ze,qe),Y.info.programs=et.programs,Y.context=Ve,Y.capabilities=qe,Y.extensions=je,Y.properties=Ye,Y.renderLists=tt,Y.state=Xe}function n(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),Z=!0}function p(){console.log("THREE.WebGLRenderer: Context Restored."),Z=!1,e()}function X(a){var t=a.target;t.removeEventListener("dispose",X),r(t)}function r(e){Q(e),Ye.remove(e)}function Q(a){var t=Ye.get(a).program;a.program=void 0,void 0!==t&&et.releaseProgram(t)}function s(a,o,e){a.render(function(a){Y.renderBufferImmediate(a,o,e)})}function ae(b,t,e,n){if(e&&e.isInstancedBufferGeometry&&null===je.get("ANGLE_instanced_arrays"))console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{void 0===n&&(n=0),Xe.initAttributes();var i=e.attributes,r=t.getAttributes(),o=b.defaultAttributeValues;for(var a in r){var s=r[a];if(0<=s){var l=i[a];if(void 0!==l){var c=l.normalized,h=l.itemSize,u=Je.get(l);if(void 0===u)continue;var p=u.buffer,x=u.type,f=u.bytesPerElement;if(l.isInterleavedBufferAttribute){var m=l.data,_=m.stride,g=l.offset;m&&m.isInstancedInterleavedBuffer?(Xe.enableAttributeAndDivisor(s,m.meshPerAttribute),void 0===e.maxInstancedCount&&(e.maxInstancedCount=m.meshPerAttribute*m.count)):Xe.enableAttribute(s),Ve.bindBuffer(Ve.ARRAY_BUFFER,p),Ve.vertexAttribPointer(s,h,x,c,_*f,(n*_+g)*f)}else l.isInstancedBufferAttribute?(Xe.enableAttributeAndDivisor(s,l.meshPerAttribute),void 0===e.maxInstancedCount&&(e.maxInstancedCount=l.meshPerAttribute*l.count)):Xe.enableAttribute(s),Ve.bindBuffer(Ve.ARRAY_BUFFER,p),Ve.vertexAttribPointer(s,h,x,c,0,n*h*f)}else if(void 0!==o){var y=o[a];if(void 0!==y)switch(y.length){case 2:Ve.vertexAttrib2fv(s,y);break;case 3:Ve.vertexAttrib3fv(s,y);break;case 4:Ve.vertexAttrib4fv(s,y);break;default:Ve.vertexAttrib1fv(s,y);}}}}Xe.disableUnusedAttributes()}}function c(){ne||(te.getDevice()||window).requestAnimationFrame(d)}function d(e){null!==ie&&ie(e),(te.getDevice()||window).requestAnimationFrame(d)}function u(d,t,e){if(d.visible){if(d.layers.test(t.layers))if(d.isLight)pe.push(d),d.castShadow&&H.push(d);else if(d.isSprite)d.frustumCulled&&!Fe.intersectsSprite(d)||W.push(d);else if(d.isLensFlare)ue.push(d);else if(d.isImmediateRenderObject)e&&Oe.setFromMatrixPosition(d.matrixWorld).applyMatrix4(ze),V.push(d,null,d.material,Oe.z,null);else if((d.isMesh||d.isLine||d.isPoints)&&(d.isSkinnedMesh&&d.skeleton.update(),!d.frustumCulled||Fe.intersectsObject(d))){e&&Oe.setFromMatrixPosition(d.matrixWorld).applyMatrix4(ze);var n=Qe.update(d),i=d.material;if(Array.isArray(i))for(var r=n.groups,o=0,a=r.length;o<a;o++){var s=r[o],l=i[s.materialIndex];l&&l.visible&&V.push(d,n,l,Oe.z,s)}else i.visible&&V.push(d,n,i,Oe.z,null)}for(var c=d.children,o=0,a=c.length;o<a;o++)u(c[o],t,e)}}function m(y,t,e,n){for(var i=0,r=y.length;i<r;i++){var o=y[i],a=o.object,s=o.geometry,l=void 0===n?o.material:n,c=o.group;if(e.isArrayCamera){Ee=e;for(var h=e.cameras,u=0,p=h.length,d;u<p;u++)if(d=h[u],a.layers.test(d.layers)){var f=d.bounds,m=f.x*Le,_=f.y*Ae,x=f.z*Le,v=f.w*Ae;Xe.viewport(Te.set(m,_,x,v).multiplyScalar(Ie)),oe(a,t,d,s,l,c)}}else Ee=null,oe(a,t,e,s,l,c)}}function oe(l,t,e,n,i,r){if(l.onBeforeRender(Y,t,e,n,i,r),l.modelViewMatrix.multiplyMatrices(e.matrixWorldInverse,l.matrixWorld),l.normalMatrix.getNormalMatrix(l.modelViewMatrix),l.isImmediateRenderObject){Xe.setMaterial(i);var o=se(e,t.fog,i,l);ve="",s(l,o,i)}else Y.renderBufferDirect(e,t.fog,n,i,l,r);l.onAfterRender(Y,t,e,n,i,r)}function le(o,t,e){var n=Ye.get(o),i=et.getParameters(o,$e.state,H,t,Ne.numPlanes,Ne.numIntersection,e),r=et.getProgramCode(o,i),a=n.program,l=!0;if(void 0===a)o.addEventListener("dispose",X);else if(a.code!==r)Q(o);else{if(void 0!==i.shaderID)return;l=!1}if(l){if(i.shaderID){var s=Ha[i.shaderID];n.shader={name:o.type,uniforms:Ga.clone(s.uniforms),vertexShader:s.vertexShader,fragmentShader:s.fragmentShader}}else n.shader={name:o.type,uniforms:o.uniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader};o.onBeforeCompile(n.shader),a=et.acquireProgram(o,n.shader,i,r),n.program=a,o.program=a}var c=a.getAttributes();if(o.morphTargets)for(o.numSupportedMorphTargets=0,u=0;u<Y.maxMorphTargets;u++)0<=c["morphTarget"+u]&&o.numSupportedMorphTargets++;if(o.morphNormals){o.numSupportedMorphNormals=0;for(var u=0;u<Y.maxMorphNormals;u++)0<=c["morphNormal"+u]&&o.numSupportedMorphNormals++}var p=n.shader.uniforms;(o.isShaderMaterial||o.isRawShaderMaterial)&&!0!==o.clipping||(n.numClippingPlanes=Ne.numPlanes,n.numIntersection=Ne.numIntersection,p.clippingPlanes=Ne.uniform),n.fog=t,n.lightsHash=$e.state.hash,o.lights&&(p.ambientLightColor.value=$e.state.ambient,p.directionalLights.value=$e.state.directional,p.spotLights.value=$e.state.spot,p.rectAreaLights.value=$e.state.rectArea,p.pointLights.value=$e.state.point,p.hemisphereLights.value=$e.state.hemi,p.directionalShadowMap.value=$e.state.directionalShadowMap,p.directionalShadowMatrix.value=$e.state.directionalShadowMatrix,p.spotShadowMap.value=$e.state.spotShadowMap,p.spotShadowMatrix.value=$e.state.spotShadowMatrix,p.pointShadowMap.value=$e.state.pointShadowMap,p.pointShadowMatrix.value=$e.state.pointShadowMatrix);var d=n.program.getUniforms(),_=q.seqWithValue(d.seq,p);n.uniformsList=_}function se(p,t,e,n){Ce=0;var D=Ye.get(e);if(Ue&&(Be||p!==Se)){var r=p===Se&&e.id===ye;Ne.setState(e.clippingPlanes,e.clipIntersection,e.clipShadows,p,D,r)}!1===e.needsUpdate&&(void 0===D.program?e.needsUpdate=!0:e.fog&&D.fog!==t?e.needsUpdate=!0:e.lights&&D.lightsHash!==$e.state.hash?e.needsUpdate=!0:void 0===D.numClippingPlanes||D.numClippingPlanes===Ne.numPlanes&&D.numIntersection===Ne.numIntersection||(e.needsUpdate=!0)),e.needsUpdate&&(le(e,t,n),e.needsUpdate=!1);var F=!1,a=!1,s=!1,U=D.program,c=U.getUniforms(),h=D.shader.uniforms;if(Xe.useProgram(U.program)&&(F=!0,a=!0,s=!0),e.id!==ye&&(ye=e.id,a=!0),F||p!==Se){if(c.setValue(Ve,"projectionMatrix",p.projectionMatrix),qe.logarithmicDepthBuffer&&c.setValue(Ve,"logDepthBufFC",2/(i(p.far+1)/o)),Se!==(Ee||p)&&(Se=Ee||p,a=!0,s=!0),e.isShaderMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.envMap){var u=c.map.cameraPosition;void 0!==u&&u.setValue(Ve,Oe.setFromMatrixPosition(p.matrixWorld))}(e.isMeshPhongMaterial||e.isMeshLambertMaterial||e.isMeshBasicMaterial||e.isMeshStandardMaterial||e.isShaderMaterial||e.skinning)&&c.setValue(Ve,"viewMatrix",p.matrixWorldInverse)}if(e.skinning){c.setOptional(Ve,n,"bindMatrix"),c.setOptional(Ve,n,"bindMatrixInverse");var d=n.skeleton;if(d){var f=d.bones;if(qe.floatVertexTextures){if(void 0===d.boneTexture){var m=N(4*f.length);m=rd.nextPowerOfTwo(T(m)),m=C(m,4);var _=new Float32Array(4*(m*m));_.set(d.boneMatrices);var g=new l(_,m,m,td,Yo);d.boneMatrices=_,d.boneTexture=g,d.boneTextureSize=m}c.setValue(Ve,"boneTexture",d.boneTexture),c.setValue(Ve,"boneTextureSize",d.boneTextureSize)}else c.setOptional(Ve,d,"boneMatrices")}}return a&&(c.setValue(Ve,"toneMappingExposure",Y.toneMappingExposure),c.setValue(Ve,"toneMappingWhitePoint",Y.toneMappingWhitePoint),e.lights&&k(h,s),t&&e.fog&&w(h,t),e.isMeshBasicMaterial?b(h,e):e.isMeshLambertMaterial?(b(h,e),E(h,e)):e.isMeshPhongMaterial?(b(h,e),e.isMeshToonMaterial?A(h,e):M(h,e)):e.isMeshStandardMaterial?(b(h,e),e.isMeshPhysicalMaterial?I(h,e):P(h,e)):e.isMeshDepthMaterial?(b(h,e),ce(h,e)):e.isMeshDistanceMaterial?(b(h,e),L(h,e)):e.isMeshNormalMaterial?(b(h,e),R(h,e)):e.isLineBasicMaterial?(v(h,e),e.isLineDashedMaterial&&x(h,e)):e.isPointsMaterial?S(h,e):e.isShadowMaterial&&(h.color.value=e.color,h.opacity.value=e.opacity),void 0!==h.ltcMat&&(h.ltcMat.value=za.LTC_MAT_TEXTURE),void 0!==h.ltcMag&&(h.ltcMag.value=za.LTC_MAG_TEXTURE),q.upload(Ve,D.uniformsList,h,Y)),c.setValue(Ve,"modelViewMatrix",n.modelViewMatrix),c.setValue(Ve,"normalMatrix",n.normalMatrix),c.setValue(Ve,"modelMatrix",n.matrixWorld),U}function b(a,t){a.opacity.value=t.opacity,t.color&&(a.diffuse.value=t.color),t.emissive&&a.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(a.map.value=t.map),t.alphaMap&&(a.alphaMap.value=t.alphaMap),t.specularMap&&(a.specularMap.value=t.specularMap),t.envMap&&(a.envMap.value=t.envMap,a.flipEnvMap.value=t.envMap&&t.envMap.isCubeTexture?-1:1,a.reflectivity.value=t.reflectivity,a.refractionRatio.value=t.refractionRatio),t.lightMap&&(a.lightMap.value=t.lightMap,a.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(a.aoMap.value=t.aoMap,a.aoMapIntensity.value=t.aoMapIntensity);var e;if(t.map?e=t.map:t.specularMap?e=t.specularMap:t.displacementMap?e=t.displacementMap:t.normalMap?e=t.normalMap:t.bumpMap?e=t.bumpMap:t.roughnessMap?e=t.roughnessMap:t.metalnessMap?e=t.metalnessMap:t.alphaMap?e=t.alphaMap:t.emissiveMap&&(e=t.emissiveMap),void 0!==e){e.isWebGLRenderTarget&&(e=e.texture);var o=e.offset,n=e.repeat;a.offsetRepeat.value.set(o.x,o.y,n.x,n.y)}}function v(a,t){a.diffuse.value=t.color,a.opacity.value=t.opacity}function x(a,t){a.dashSize.value=t.dashSize,a.totalSize.value=t.dashSize+t.gapSize,a.scale.value=t.scale}function S(a,t){if(a.diffuse.value=t.color,a.opacity.value=t.opacity,a.size.value=t.size*Ie,a.scale.value=.5*Ae,a.map.value=t.map,null!==t.map){var e=t.map.offset,o=t.map.repeat;a.offsetRepeat.value.set(e.x,e.y,o.x,o.y)}}function w(a,t){a.fogColor.value=t.color,t.isFog?(a.fogNear.value=t.near,a.fogFar.value=t.far):t.isFogExp2&&(a.fogDensity.value=t.density)}function E(a,t){t.emissiveMap&&(a.emissiveMap.value=t.emissiveMap)}function M(a,t){a.specular.value=t.specular,a.shininess.value=C(t.shininess,1e-4),t.emissiveMap&&(a.emissiveMap.value=t.emissiveMap),t.bumpMap&&(a.bumpMap.value=t.bumpMap,a.bumpScale.value=t.bumpScale),t.normalMap&&(a.normalMap.value=t.normalMap,a.normalScale.value.copy(t.normalScale)),t.displacementMap&&(a.displacementMap.value=t.displacementMap,a.displacementScale.value=t.displacementScale,a.displacementBias.value=t.displacementBias)}function A(a,t){M(a,t),t.gradientMap&&(a.gradientMap.value=t.gradientMap)}function P(a,t){a.roughness.value=t.roughness,a.metalness.value=t.metalness,t.roughnessMap&&(a.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(a.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(a.emissiveMap.value=t.emissiveMap),t.bumpMap&&(a.bumpMap.value=t.bumpMap,a.bumpScale.value=t.bumpScale),t.normalMap&&(a.normalMap.value=t.normalMap,a.normalScale.value.copy(t.normalScale)),t.displacementMap&&(a.displacementMap.value=t.displacementMap,a.displacementScale.value=t.displacementScale,a.displacementBias.value=t.displacementBias),t.envMap&&(a.envMapIntensity.value=t.envMapIntensity)}function I(a,t){a.clearCoat.value=t.clearCoat,a.clearCoatRoughness.value=t.clearCoatRoughness,P(a,t)}function ce(a,t){t.displacementMap&&(a.displacementMap.value=t.displacementMap,a.displacementScale.value=t.displacementScale,a.displacementBias.value=t.displacementBias)}function L(a,t){t.displacementMap&&(a.displacementMap.value=t.displacementMap,a.displacementScale.value=t.displacementScale,a.displacementBias.value=t.displacementBias),a.referencePosition.value.copy(t.referencePosition),a.nearDistance.value=t.nearDistance,a.farDistance.value=t.farDistance}function R(a,t){t.bumpMap&&(a.bumpMap.value=t.bumpMap,a.bumpScale.value=t.bumpScale),t.normalMap&&(a.normalMap.value=t.normalMap,a.normalScale.value.copy(t.normalScale)),t.displacementMap&&(a.displacementMap.value=t.displacementMap,a.displacementScale.value=t.displacementScale,a.displacementBias.value=t.displacementBias)}function k(a,t){a.ambientLightColor.needsUpdate=t,a.directionalLights.needsUpdate=t,a.pointLights.needsUpdate=t,a.spotLights.needsUpdate=t,a.rectAreaLights.needsUpdate=t,a.hemisphereLights.needsUpdate=t}console.log("THREE.WebGLRenderer",Lc);var _=void 0===(a=a||{}).canvas?document.createElementNS("http://www.w3.org/1999/xhtml","canvas"):a.canvas,h=void 0===a.context?null:a.context,g=void 0!==a.alpha&&a.alpha,f=void 0===a.depth||a.depth,y=void 0===a.stencil||a.stencil,D=void 0!==a.antialias&&a.antialias,F=void 0===a.premultipliedAlpha||a.premultipliedAlpha,O=void 0!==a.preserveDrawingBuffer&&a.preserveDrawingBuffer,pe=[],H=[],V=null,W=[],ue=[];this.domElement=_,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=xo,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var Y=this,Z=!1,he=null,$=null,ye=-1,ve="",Se=null,Ee=null,Te=new al,Me=new al,Pe=null,Ce=0,Le=_.width,Ae=_.height,Ie=1,Re=new al(0,0,Le,Ae),De=new al(0,0,Le,Ae),ke=!1,Fe=new gl,Ne=new we,Ue=!1,Be=!1,ze=new il,Oe=new nl,Ge={geometries:0,textures:0},He={frame:0,calls:0,vertices:0,faces:0,points:0};this.info={render:He,memory:Ge,programs:null};var Ve;try{var We={alpha:g,depth:f,stencil:y,antialias:D,premultipliedAlpha:F,preserveDrawingBuffer:O};if(null===(Ve=h||_.getContext("webgl",We)||_.getContext("experimental-webgl",We)))throw null===_.getContext("webgl")?"Error creating WebGL context.":"Error creating WebGL context with your selected attributes.";void 0===Ve.getShaderPrecisionFormat&&(Ve.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),_.addEventListener("webglcontextlost",n,!1),_.addEventListener("webglcontextrestored",p,!1)}catch(e){console.error("THREE.WebGLRenderer: "+e)}var je,qe,Xe,Ye,Ze,Je,Ke,Qe,$e,et,tt,at,ot,rt,nt,it,ct,ut;e();var te=new $t(Y);this.vr=te;var ee=new st(Y,Qe,qe.maxTextureSize);this.shadowMap=ee,this.getContext=function(){return Ve},this.getContextAttributes=function(){return Ve.getContextAttributes()},this.forceContextLoss=function(){var e=je.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=je.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return Ie},this.setPixelRatio=function(e){void 0!==e&&(Ie=e,this.setSize(Le,Ae,!1))},this.getSize=function(){return{width:Le,height:Ae}},this.setSize=function(a,t,e){var o=te.getDevice();o&&o.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Le=a,Ae=t,_.width=a*Ie,_.height=t*Ie,!1!==e&&(_.style.width=a+"px",_.style.height=t+"px"),this.setViewport(0,0,a,t))},this.getDrawingBufferSize=function(){return{width:Le*Ie,height:Ae*Ie}},this.setDrawingBufferSize=function(a,t,e){Le=a,Ae=t,Ie=e,_.width=a*e,_.height=t*e,this.setViewport(0,0,a,t)},this.setViewport=function(a,t,e,o){Re.set(a,Ae-t-o,e,o),Xe.viewport(Te.copy(Re).multiplyScalar(Ie))},this.setScissor=function(a,t,e,o){De.set(a,Ae-t-o,e,o),Xe.scissor(Me.copy(De).multiplyScalar(Ie))},this.setScissorTest=function(e){Xe.setScissorTest(ke=e)},this.getClearColor=at.getClearColor,this.setClearColor=at.setClearColor,this.getClearAlpha=at.getClearAlpha,this.setClearAlpha=at.setClearAlpha,this.clear=function(a,t,e){var o=0;(void 0===a||a)&&(o|=Ve.COLOR_BUFFER_BIT),(void 0===t||t)&&(o|=Ve.DEPTH_BUFFER_BIT),(void 0===e||e)&&(o|=Ve.STENCIL_BUFFER_BIT),Ve.clear(o)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(a,t,e,o){this.setRenderTarget(a),this.clear(t,e,o)},this.dispose=function(){_.removeEventListener("webglcontextlost",n,!1),_.removeEventListener("webglcontextrestored",p,!1),tt.dispose(),te.dispose()},this.renderBufferImmediate=function(d,t,e){Xe.initAttributes();var n=Ye.get(d);d.hasPositions&&!n.position&&(n.position=Ve.createBuffer()),d.hasNormals&&!n.normal&&(n.normal=Ve.createBuffer()),d.hasUvs&&!n.uv&&(n.uv=Ve.createBuffer()),d.hasColors&&!n.color&&(n.color=Ve.createBuffer());var i=t.getAttributes();if(d.hasPositions&&(Ve.bindBuffer(Ve.ARRAY_BUFFER,n.position),Ve.bufferData(Ve.ARRAY_BUFFER,d.positionArray,Ve.DYNAMIC_DRAW),Xe.enableAttribute(i.position),Ve.vertexAttribPointer(i.position,3,Ve.FLOAT,!1,0,0)),d.hasNormals){if(Ve.bindBuffer(Ve.ARRAY_BUFFER,n.normal),!e.isMeshPhongMaterial&&!e.isMeshStandardMaterial&&!e.isMeshNormalMaterial&&!0===e.flatShading)for(var r=0,o=3*d.count;r<o;r+=9){var a=d.normalArray,s=(a[r+0]+a[r+3]+a[r+6])/3,l=(a[r+1]+a[r+4]+a[r+7])/3,c=(a[r+2]+a[r+5]+a[r+8])/3;a[r+0]=s,a[r+1]=l,a[r+2]=c,a[r+3]=s,a[r+4]=l,a[r+5]=c,a[r+6]=s,a[r+7]=l,a[r+8]=c}Ve.bufferData(Ve.ARRAY_BUFFER,d.normalArray,Ve.DYNAMIC_DRAW),Xe.enableAttribute(i.normal),Ve.vertexAttribPointer(i.normal,3,Ve.FLOAT,!1,0,0)}d.hasUvs&&e.map&&(Ve.bindBuffer(Ve.ARRAY_BUFFER,n.uv),Ve.bufferData(Ve.ARRAY_BUFFER,d.uvArray,Ve.DYNAMIC_DRAW),Xe.enableAttribute(i.uv),Ve.vertexAttribPointer(i.uv,2,Ve.FLOAT,!1,0,0)),d.hasColors&&e.vertexColors!==Nr&&(Ve.bindBuffer(Ve.ARRAY_BUFFER,n.color),Ve.bufferData(Ve.ARRAY_BUFFER,d.colorArray,Ve.DYNAMIC_DRAW),Xe.enableAttribute(i.color),Ve.vertexAttribPointer(i.color,3,Ve.FLOAT,!1,0,0)),Xe.disableUnusedAttributes(),Ve.drawArrays(Ve.TRIANGLES,0,d.count),d.count=0},this.renderBufferDirect=function(e,d,n,i,r,o){Xe.setMaterial(i);var a=se(e,d,i,r),s=n.id+"_"+a.id+"_"+(!0===i.wireframe),l=!1;s!==ve&&(ve=s,l=!0),r.morphTargetInfluences&&(ot.update(r,n,i,a),l=!0);var c=n.index,h=n.attributes.position,u=1;!0===i.wireframe&&(c=Ke.getWireframeAttribute(n),u=2);var p=rt,m;null!==c&&(m=Je.get(c),(p=nt).setIndex(m)),l&&(ae(i,a,n),null!==c&&Ve.bindBuffer(Ve.ELEMENT_ARRAY_BUFFER,m.buffer));var f=0;null===c?void 0!==h&&(f=h.count):f=c.count;var _=n.drawRange.start*u,g=n.drawRange.count*u,y=null===o?0:o.start*u,b=null===o?1/0:o.count*u,v=C(_,y),x=U(f,_+g,y+b)-1,S=C(0,x-v+1);if(0!==S){if(r.isMesh){if(!0===i.wireframe)Xe.setLineWidth(i.wireframeLinewidth*t()),p.setMode(Ve.LINES);else switch(r.drawMode){case od:p.setMode(Ve.TRIANGLES);break;case va:p.setMode(Ve.TRIANGLE_STRIP);break;case ba:p.setMode(Ve.TRIANGLE_FAN);}}else if(r.isLine){var w=i.linewidth;void 0===w&&(w=1),Xe.setLineWidth(w*t()),r.isLineSegments?p.setMode(Ve.LINES):r.isLineLoop?p.setMode(Ve.LINE_LOOP):p.setMode(Ve.LINE_STRIP)}else r.isPoints&&p.setMode(Ve.POINTS);n&&n.isInstancedBufferGeometry?0<n.maxInstancedCount&&p.renderInstances(n,v,S):p.render(v,S)}},this.compile=function(a,t){pe.length=0,H.length=0,a.traverse(function(e){e.isLight&&(pe.push(e),e.castShadow&&H.push(e))}),$e.setup(pe,H,t),a.traverse(function(t){if(t.material)if(Array.isArray(t.material))for(var e=0;e<t.material.length;e++)le(t.material[e],a.fog,t);else le(t.material,a.fog,t)})};var ne=!1,ie=null;this.animate=function(e){ie=e,c()},this.render=function(l,t,e,n){if(!(t&&t.isCamera))console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else if(!Z){ve="",ye=-1,Se=null,!0===l.autoUpdate&&l.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),te.enabled&&(t=te.getCamera(t)),ze.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),Fe.setFromMatrix(ze),pe.length=0,H.length=0,W.length=0,ue.length=0,Be=this.localClippingEnabled,Ue=Ne.init(this.clippingPlanes,Be,t),(V=tt.get(l,t)).init(),u(l,t,Y.sortObjects),!0===Y.sortObjects&&V.sort(),Ue&&Ne.beginShadows(),ee.render(H,l,t),$e.setup(pe,H,t),Ue&&Ne.endShadows(),He.frame++,He.calls=0,He.vertices=0,He.faces=0,He.points=0,void 0===e&&(e=null),this.setRenderTarget(e),at.render(V,l,t,n);var i=V.opaque,r=V.transparent;if(l.overrideMaterial){var o=l.overrideMaterial;i.length&&m(i,l,t,o),r.length&&m(r,l,t,o)}else i.length&&m(i,l,t),r.length&&m(r,l,t);ct.render(W,l,t),it.render(ue,l,t,Te),e&&Ze.updateRenderTargetMipmap(e),Xe.buffers.depth.setTest(!0),Xe.buffers.depth.setMask(!0),Xe.buffers.color.setMask(!0),Xe.setPolygonOffset(!1),te.enabled&&te.submitFrame()}},this.setFaceCulling=function(a,t){Xe.setCullFace(a),Xe.setFlipSided(t===Rr)},this.allocTextureUnit=function(){var e=Ce;return e>=qe.maxTextures&&console.warn("THREE.WebGLRenderer: Trying to use "+e+" texture units while this GPU supports only "+qe.maxTextures),Ce+=1,e},this.setTexture2D=function(){var a=!1;return function(t,e){t&&t.isWebGLRenderTarget&&(a||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),a=!0),t=t.texture),Ze.setTexture2D(t,e)}}(),this.setTexture=function(){var a=!1;return function(t,e){a||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),a=!0),Ze.setTexture2D(t,e)}}(),this.setTextureCube=function(){var a=!1;return function(t,e){t&&t.isWebGLRenderTargetCube&&(a||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),a=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?Ze.setTextureCube(t,e):Ze.setTextureCubeDynamic(t,e)}}(),this.getRenderTarget=function(){return he},this.setRenderTarget=function(a){he=a,a&&void 0===Ye.get(a).__webglFramebuffer&&Ze.setupRenderTarget(a);var t=null,e=!1;if(a){var o=Ye.get(a).__webglFramebuffer;a.isWebGLRenderTargetCube?(t=o[a.activeCubeFace],e=!0):t=o,Te.copy(a.viewport),Me.copy(a.scissor),Pe=a.scissorTest}else Te.copy(Re).multiplyScalar(Ie),Me.copy(De).multiplyScalar(Ie),Pe=ke;if($!==t&&(Ve.bindFramebuffer(Ve.FRAMEBUFFER,t),$=t),Xe.viewport(Te),Xe.scissor(Me),Xe.setScissorTest(Pe),e){var n=Ye.get(a.texture);Ve.framebufferTexture2D(Ve.FRAMEBUFFER,Ve.COLOR_ATTACHMENT0,Ve.TEXTURE_CUBE_MAP_POSITIVE_X+a.activeCubeFace,n.__webglTexture,a.activeMipMapLevel)}},this.readRenderTargetPixels=function(d,t,e,n,i,r){if(d&&d.isWebGLRenderTarget){var o=Ye.get(d).__webglFramebuffer;if(o){var a=!1;o!==$&&(Ve.bindFramebuffer(Ve.FRAMEBUFFER,o),a=!0);try{var s=d.texture,l=s.format,c=s.type;if(l!==td&&ut.convert(l)!==Ve.getParameter(Ve.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(c===ed||ut.convert(c)===Ve.getParameter(Ve.IMPLEMENTATION_COLOR_READ_TYPE)||c===Yo&&(je.get("OES_texture_float")||je.get("WEBGL_color_buffer_float"))||c===Zo&&je.get("EXT_color_buffer_half_float")))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");Ve.checkFramebufferStatus(Ve.FRAMEBUFFER)===Ve.FRAMEBUFFER_COMPLETE?0<=t&&t<=d.width-n&&0<=e&&e<=d.height-i&&Ve.readPixels(t,e,n,i,ut.convert(l),ut.convert(c),r):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{a&&Ve.bindFramebuffer(Ve.FRAMEBUFFER,$)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")}}function Ee(a,t){this.name="",this.color=new X(a),this.density=void 0===t?25e-5:t}function Me(a,t,e){this.name="",this.color=new X(a),this.near=void 0===t?1:t,this.far=void 0===e?1e3:e}function Te(){ut.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function Ml(a,t,e,o,n){ut.call(this),this.lensFlares=[],this.positionScreen=new nl,this.customUpdateCallback=void 0,void 0!==a&&this.add(a,t,e,o,n)}function Pl(e){K.call(this),this.type="SpriteMaterial",this.color=new X(16777215),this.map=null,this.rotation=0,this.fog=!1,this.lights=!1,this.setValues(e)}function Cl(e){ut.call(this),this.type="Sprite",this.material=void 0===e?new Pl:e}function Ll(){ut.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function Al(a,t){if(a=a||[],this.bones=a.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var e=0,o=this.bones.length;e<o;e++)this.boneInverses.push(new il)}}function Re(){ut.call(this),this.type="Bone"}function Il(a,t){Bt.call(this,a,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new il,this.bindMatrixInverse=new il;var e=new Al(this.initBones());this.bind(e,this.matrixWorld),this.normalizeSkinWeights()}function Rl(e){K.call(this),this.type="LineBasicMaterial",this.color=new X(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(e)}function Dl(a,t,e){return 1===e?(console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new kl(a,t)):void(ut.call(this),this.type="Line",this.geometry=void 0===a?new bl:a,this.material=void 0===t?new Rl({color:16777215*Math.random()}):t)}function kl(a,t){Dl.call(this,a,t),this.type="LineSegments"}function Fl(a,t){Dl.call(this,a,t),this.type="LineLoop"}function Nl(e){K.call(this),this.type="PointsMaterial",this.color=new X(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.lights=!1,this.setValues(e)}function Ul(a,t){ut.call(this),this.type="Points",this.geometry=void 0===a?new bl:a,this.material=void 0===t?new Nl({color:16777215*Math.random()}):t}function Bl(){ut.call(this),this.type="Group"}function zl(o,t,e,n,i,r,a,s,l){function c(){requestAnimationFrame(c),o.readyState>=o.HAVE_CURRENT_DATA&&(d.needsUpdate=!0)}tl.call(this,o,t,e,n,i,r,a,s,l),this.generateMipmaps=!1;var d=this;c()}function je(o,t,d,m,i,r,a,s,l,c,_,u){tl.call(this,null,r,a,s,l,c,m,i,_,u),this.image={width:t,height:d},this.mipmaps=o,this.flipY=!1,this.generateMipmaps=!1}function He(o,d,p,n,i,r,a,s,l,c){if((c=void 0===c?oa:c)!==oa&&c!==aa)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===p&&c===oa&&(p=Wo),void 0===p&&c===aa&&(p=$o),tl.call(this,null,n,i,r,a,s,c,p,l),this.image={width:o,height:d},this.magFilter=void 0===a?Yc:a,this.minFilter=void 0===s?Yc:s,this.flipY=!1,this.generateMipmaps=!1}function Ve(h){bl.call(this),this.type="WireframeGeometry";var t=[],p=[0,0],d={},f=["a","b","c"],m,e,n,i,r,o,a,s,l,c;if(h&&h.isGeometry){var u=h.faces;for(m=0,n=u.length;m<n;m++){var _=u[m];for(e=0;3>e;e++)a=_[f[e]],s=_[f[(e+1)%3]],p[0]=U(a,s),p[1]=C(a,s),void 0===d[l=p[0]+","+p[1]]&&(d[l]={index1:p[0],index2:p[1]})}for(l in d)o=d[l],c=h.vertices[o.index1],t.push(c.x,c.y,c.z),c=h.vertices[o.index2],t.push(c.x,c.y,c.z)}else if(h&&h.isBufferGeometry){var g,y,v,b,w,x,S;if(c=new nl,null!==h.index){for(g=h.attributes.position,y=h.index,0===(v=h.groups).length&&(v=[{start:0,count:y.count,materialIndex:0}]),i=0,r=v.length;i<r;++i)for(m=w=(b=v[i]).start,n=w+b.count;m<n;m+=3)for(e=0;3>e;e++)a=y.getX(m+e),s=y.getX(m+(e+1)%3),p[0]=U(a,s),p[1]=C(a,s),void 0===d[l=p[0]+","+p[1]]&&(d[l]={index1:p[0],index2:p[1]});for(l in d)o=d[l],c.fromBufferAttribute(g,o.index1),t.push(c.x,c.y,c.z),c.fromBufferAttribute(g,o.index2),t.push(c.x,c.y,c.z)}else for(m=0,n=(g=h.attributes.position).count/3;m<n;m++)for(e=0;3>e;e++)x=3*m+e,c.fromBufferAttribute(g,x),t.push(c.x,c.y,c.z),S=3*m+(e+1)%3,c.fromBufferAttribute(g,S),t.push(c.x,c.y,c.z)}this.addAttribute("position",new Tt(t,3))}function Ol(a,o,r){gt.call(this),this.type="ParametricGeometry",this.parameters={func:a,slices:o,stacks:r},this.fromBufferGeometry(new Gl(a,o,r)),this.mergeVertices()}function Gl(h,x,S){bl.call(this),this.type="ParametricBufferGeometry",this.parameters={func:h,slices:x,stacks:S};var E=[],o=[],a=[],s=[],l=new nl,c=new nl,u=new nl,p=new nl,d=new nl,f=x+1,m,i;for(m=0;m<=S;m++){var r=m/S;for(i=0;i<=x;i++){var _=i/x;c=h(_,r,c),o.push(c.x,c.y,c.z),0<=_-1e-5?(u=h(_-1e-5,r,u),p.subVectors(c,u)):(u=h(_+1e-5,r,u),p.subVectors(u,c)),0<=r-1e-5?(u=h(_,r-1e-5,u),d.subVectors(c,u)):(u=h(_,r+1e-5,u),d.subVectors(u,c)),l.crossVectors(p,d).normalize(),a.push(l.x,l.y,l.z),s.push(_,r)}}for(m=0;m<S;m++)for(i=0;i<x;i++){var g=m*f+i,y=m*f+i+1,v=(m+1)*f+i+1,b=(m+1)*f+i;E.push(g,y,b),E.push(y,v,b)}this.setIndex(E),this.addAttribute("position",new Tt(o,3)),this.addAttribute("normal",new Tt(a,3)),this.addAttribute("uv",new Tt(s,2))}function Hl(a,o,r,l){gt.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:a,indices:o,radius:r,detail:l},this.fromBufferGeometry(new Vl(a,o,r,l)),this.mergeVertices()}function Vl(r,_,h,g){function y(s,t,e,n){var i=S(2,n),d=[],l,r;for(l=0;l<=i;l++){d[l]=[];var m=s.clone().lerp(e,l/i),c=t.clone().lerp(e,l/i),_=i-l;for(r=0;r<=_;r++)d[l][r]=0===r&&l===i?m:m.clone().lerp(c,r/_)}for(l=0;l<i;l++)for(r=0;r<2*(i-l)-1;r++){var u=z(r/2);0==r%2?(a(d[l][u+1]),a(d[l+1][u]),a(d[l][u])):(a(d[l][u+1]),a(d[l+1][u+1]),a(d[l+1][u]))}}function o(){for(var a=0;a<f.length;a+=6){var t=f[a+0],e=f[a+2],n=f[a+4],i=C(t,e,n),r=U(t,e,n);.9<i&&.1>r&&(.2>t&&(f[a+0]+=1),.2>e&&(f[a+2]+=1),.2>n&&(f[a+4]+=1))}}function a(e){p.push(e.x,e.y,e.z)}function s(t,e){var a=3*t;e.x=r[a+0],e.y=r[a+1],e.z=r[a+2]}function l(){for(var r=new nl,t=new nl,e=new nl,n=new nl,i=new el,o=new el,a=new el,s=0,l=0;s<p.length;s+=9,l+=6){r.set(p[s+0],p[s+1],p[s+2]),t.set(p[s+3],p[s+4],p[s+5]),e.set(p[s+6],p[s+7],p[s+8]),i.set(f[l+0],f[l+1]),o.set(f[l+2],f[l+3]),a.set(f[l+4],f[l+5]),n.copy(r).add(t).add(e).divideScalar(3);var m=u(n);b(i,l+0,r,m),b(o,l+2,t,m),b(a,l+4,e,m)}}function b(a,t,e,o){0>o&&1===a.x&&(f[t]=a.x-1),0===e.x&&0===e.z&&(f[t]=o/2/Gn+.5)}function u(e){return D(e.z,-e.x)}function c(e){return D(-e.y,N(e.x*e.x+e.z*e.z))}bl.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:r,indices:_,radius:h,detail:g},h=h||1;var p=[],f=[];!function(e){for(var t=new nl,o=new nl,n=new nl,r=0;r<_.length;r+=3)s(_[r+0],t),s(_[r+1],o),s(_[r+2],n),y(t,o,n,e)}(g=g||0),function(a){for(var t=new nl,e=0;e<p.length;e+=3)t.x=p[e+0],t.y=p[e+1],t.z=p[e+2],t.normalize().multiplyScalar(a),p[e+0]=t.x,p[e+1]=t.y,p[e+2]=t.z}(h),function(){for(var a=new nl,t=0;t<p.length;t+=3){a.x=p[t+0],a.y=p[t+1],a.z=p[t+2];var e=u(a)/2/Gn+.5,r=c(a)/Gn+.5;f.push(e,1-r)}l(),o()}(),this.addAttribute("position",new Tt(p,3)),this.addAttribute("normal",new Tt(p.slice(),3)),this.addAttribute("uv",new Tt(f,2)),0===g?this.computeVertexNormals():this.normalizeNormals()}function Wl(a,o){gt.call(this),this.type="TetrahedronGeometry",this.parameters={radius:a,detail:o},this.fromBufferGeometry(new jl(a,o)),this.mergeVertices()}function jl(a,o){Vl.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],a,o),this.type="TetrahedronBufferGeometry",this.parameters={radius:a,detail:o}}function ql(a,o){gt.call(this),this.type="OctahedronGeometry",this.parameters={radius:a,detail:o},this.fromBufferGeometry(new Xl(a,o)),this.mergeVertices()}function Xl(a,o){Vl.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],a,o),this.type="OctahedronBufferGeometry",this.parameters={radius:a,detail:o}}function Yl(a,o){gt.call(this),this.type="IcosahedronGeometry",this.parameters={radius:a,detail:o},this.fromBufferGeometry(new Zl(a,o)),this.mergeVertices()}function Zl(a,o){var r=(1+2.23606797749979)/2;Vl.call(this,[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a,o),this.type="IcosahedronBufferGeometry",this.parameters={radius:a,detail:o}}function Jl(a,o){gt.call(this),this.type="DodecahedronGeometry",this.parameters={radius:a,detail:o},this.fromBufferGeometry(new Kl(a,o)),this.mergeVertices()}function Kl(a,o){var r=(1+2.23606797749979)/2,l=1/r;Vl.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-l,-r,0,-l,r,0,l,-r,0,l,r,-l,-r,0,-l,r,0,l,-r,0,l,r,0,-r,0,-l,r,0,-l,-r,0,l,r,0,l],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],a,o),this.type="DodecahedronBufferGeometry",this.parameters={radius:a,detail:o}}function Ql(l,s,c,d,p,u){gt.call(this),this.type="TubeGeometry",this.parameters={path:l,tubularSegments:s,radius:c,radialSegments:d,closed:p},void 0!==u&&console.warn("THREE.TubeGeometry: taper has been removed.");var o=new $l(l,s,c,d,p);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals,this.fromBufferGeometry(o),this.mergeVertices()}function $l(b,x,r,S,h){function w(e){var t=b.getPointAt(e/x),o=E.normals[e],n=E.binormals[e];for(v=0;v<=S;v++){var i=2*(v/S*Gn),l=Pc(i),s=-Cc(i);d.x=s*o.x+l*n.x,d.y=s*o.y+l*n.y,d.z=s*o.z+l*n.z,d.normalize(),_.push(d.x,d.y,d.z),c.x=t.x+r*d.x,c.y=t.y+r*d.y,c.z=t.z+r*d.z,m.push(c.x,c.y,c.z)}}function a(){for(v=1;v<=x;v++)for(y=1;y<=S;y++){var e=(S+1)*(v-1)+(y-1),t=(S+1)*v+(y-1),a=(S+1)*v+y,r=(S+1)*(v-1)+y;f.push(e,t,r),f.push(t,a,r)}}function s(){for(y=0;y<=x;y++)for(v=0;v<=S;v++)l.x=y/x,l.y=v/S,g.push(l.x,l.y)}bl.call(this),this.type="TubeBufferGeometry",this.parameters={path:b,tubularSegments:x,radius:r,radialSegments:S,closed:h},x=x||64,r=r||1,S=S||8,h=h||!1;var E=b.computeFrenetFrames(x,h);this.tangents=E.tangents,this.normals=E.normals,this.binormals=E.binormals;var c=new nl,d=new nl,l=new el,m=[],_=[],g=[],f=[],y,v;!function(){for(y=0;y<x;y++)w(y);w(!1===h?x:0),s(),a()}(),this.setIndex(f),this.addAttribute("position",new Tt(m,3)),this.addAttribute("normal",new Tt(_,3)),this.addAttribute("uv",new Tt(g,2))}function ms(l,s,c,d,p,u,m){gt.call(this),this.type="TorusKnotGeometry",this.parameters={radius:l,tube:s,tubularSegments:c,radialSegments:d,p:p,q:u},void 0!==m&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new _s(l,s,c,d,p,u)),this.mergeVertices()}function _s(h,C,L,I,R,D){function k(c,t,e,n,i){var r=Cc(c),o=Pc(c),d=e/t*c,s=Cc(d);i.x=.5*(n*(2+s))*r,i.y=.5*(n*(2+s)*o),i.z=.5*(n*Pc(d))}bl.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:h,tube:C,tubularSegments:L,radialSegments:I,p:R,q:D},h=h||100,C=C||40,L=z(L)||64,I=z(I)||8,R=R||2,D=D||3;var a=[],c=[],u=[],p=[],d=new nl,f=new nl,m=new nl,_=new nl,g=new nl,y=new nl,v=new nl,b,s;for(b=0;b<=L;++b){var l=2*(b/L*R*Gn);for(k(l,R,D,h,m),k(l+.01,R,D,h,_),y.subVectors(_,m),v.addVectors(_,m),g.crossVectors(y,v),v.crossVectors(g,y),g.normalize(),v.normalize(),s=0;s<=I;++s){var w=2*(s/I*Gn),x=-C*Cc(w),S=C*Pc(w);d.x=m.x+(x*v.x+S*g.x),d.y=m.y+(x*v.y+S*g.y),d.z=m.z+(x*v.z+S*g.z),c.push(d.x,d.y,d.z),f.subVectors(d,m).normalize(),u.push(f.x,f.y,f.z),p.push(b/L),p.push(s/I)}}for(s=1;s<=L;s++)for(b=1;b<=I;b++){var E=(I+1)*(s-1)+(b-1),M=(I+1)*s+(b-1),T=(I+1)*s+b,A=(I+1)*(s-1)+b;a.push(E,M,A),a.push(M,T,A)}this.setIndex(a),this.addAttribute("position",new Tt(c,3)),this.addAttribute("normal",new Tt(u,3)),this.addAttribute("uv",new Tt(p,2))}function gs(a,o,l,s,c){gt.call(this),this.type="TorusGeometry",this.parameters={radius:a,tube:o,radialSegments:l,tubularSegments:s,arc:c},this.fromBufferGeometry(new ys(a,o,l,s,c)),this.mergeVertices()}function ys(h,x,S,w,E){bl.call(this),this.type="TorusBufferGeometry",this.parameters={radius:h,tube:x,radialSegments:S,tubularSegments:w,arc:E},h=h||100,x=x||40,S=z(S)||8,w=z(w)||6,E=E||2*Gn;var T=[],s=[],l=[],c=[],u=new nl,p=new nl,d=new nl,f,o;for(f=0;f<=S;f++)for(o=0;o<=w;o++){var a=o/w*E,m=2*(f/S*Gn);p.x=(h+x*Cc(m))*Cc(a),p.y=(h+x*Cc(m))*Pc(a),p.z=x*Pc(m),s.push(p.x,p.y,p.z),u.x=h*Cc(a),u.y=h*Pc(a),d.subVectors(p,u).normalize(),l.push(d.x,d.y,d.z),c.push(o/w),c.push(f/S)}for(f=1;f<=S;f++)for(o=1;o<=w;o++){var _=(w+1)*f+o-1,g=(w+1)*(f-1)+o-1,y=(w+1)*(f-1)+o,v=(w+1)*f+o;T.push(_,g,v),T.push(g,y,v)}this.setIndex(T),this.addAttribute("position",new Tt(s,3)),this.addAttribute("normal",new Tt(l,3)),this.addAttribute("uv",new Tt(c,2))}function bs(a,o){gt.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:a,options:o},this.fromBufferGeometry(new xs(a,o)),this.mergeVertices()}function xs(a,t){void 0!==a&&(bl.call(this),this.type="ExtrudeBufferGeometry",a=Array.isArray(a)?a:[a],this.addShapeList(a,t),this.computeVertexNormals())}function vs(a,o){gt.call(this),this.type="TextGeometry",this.parameters={text:a,parameters:o},this.fromBufferGeometry(new Ss(a,o)),this.mergeVertices()}function Ss(a,t){var e=(t=t||{}).font;if(!e||!e.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new gt;var o=e.generateShapes(a,t.size,t.curveSegments);t.amount=void 0===t.height?50:t.height,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),xs.call(this,o,t),this.type="TextBufferGeometry"}function ws(l,s,c,d,p,u,m){gt.call(this),this.type="SphereGeometry",this.parameters={radius:l,widthSegments:s,heightSegments:c,phiStart:d,phiLength:p,thetaStart:u,thetaLength:m},this.fromBufferGeometry(new Es(l,s,c,d,p,u,m)),this.mergeVertices()}function Es(h,T,P,L,A,I,R){bl.call(this),this.type="SphereBufferGeometry",this.parameters={radius:h,widthSegments:T,heightSegments:P,phiStart:L,phiLength:A,thetaStart:I,thetaLength:R},h=h||50,T=C(3,z(T)||8),P=C(2,z(P)||6),L=void 0===L?0:L,A=void 0===A?2*Gn:A;var D=(I=void 0===I?0:I)+(R=void 0===R?Gn:R),c=0,u=[],p=new nl,d=new nl,f=[],m=[],_=[],g=[],y,s;for(s=0;s<=P;s++){var l=[],v=s/P;for(y=0;y<=T;y++){var b=y/T;p.x=-h*Cc(L+b*A)*Pc(I+v*R),p.y=h*Cc(I+v*R),p.z=h*Pc(L+b*A)*Pc(I+v*R),m.push(p.x,p.y,p.z),d.set(p.x,p.y,p.z).normalize(),_.push(d.x,d.y,d.z),g.push(b,1-v),l.push(c++)}u.push(l)}for(s=0;s<P;s++)for(y=0;y<T;y++){var w=u[s][y+1],x=u[s][y],S=u[s+1][y],E=u[s+1][y+1];(0!==s||0<I)&&f.push(w,x,E),(s!==P-1||D<Gn)&&f.push(x,S,E)}this.setIndex(f),this.addAttribute("position",new Tt(m,3)),this.addAttribute("normal",new Tt(_,3)),this.addAttribute("uv",new Tt(g,2))}function Ts(a,l,s,c,d,p){gt.call(this),this.type="RingGeometry",this.parameters={innerRadius:a,outerRadius:l,thetaSegments:s,phiSegments:c,thetaStart:d,thetaLength:p},this.fromBufferGeometry(new Ms(a,l,s,c,d,p)),this.mergeVertices()}function Ms(r,h,E,T,M,P){bl.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:r,outerRadius:h,thetaSegments:E,phiSegments:T,thetaStart:M,thetaLength:P},r=r||20,h=h||50,M=void 0===M?0:M,P=void 0===P?2*Gn:P,E=void 0===E?8:C(3,E);var L=[],u=[],p=[],d=[],f=r,m=(h-r)/(T=void 0===T?1:C(1,T)),_=new nl,g=new el,y,s,l;for(s=0;s<=T;s++){for(l=0;l<=E;l++)y=M+l/E*P,_.x=f*Cc(y),_.y=f*Pc(y),u.push(_.x,_.y,_.z),p.push(0,0,1),g.x=(_.x/h+1)/2,g.y=(_.y/h+1)/2,d.push(g.x,g.y);f+=m}for(s=0;s<T;s++){var c=s*(E+1);for(l=0;l<E;l++){var v=y=l+c,b=y+E+1,w=y+E+2,x=y+1;L.push(v,b,x),L.push(b,w,x)}}this.setIndex(L),this.addAttribute("position",new Tt(u,3)),this.addAttribute("normal",new Tt(p,3)),this.addAttribute("uv",new Tt(d,2))}function Ps(a,o,r,l){gt.call(this),this.type="LatheGeometry",this.parameters={points:a,segments:o,phiStart:r,phiLength:l},this.fromBufferGeometry(new Cs(a,o,r,l)),this.mergeVertices()}function Cs(r,h,T,P){bl.call(this),this.type="LatheBufferGeometry",this.parameters={points:r,segments:h,phiStart:T,phiLength:P},h=z(h)||12,T=T||0,P=P||2*Gn,P=rd.clamp(P,0,2*Gn);var C=[],l=[],c=[],u=1/h,p=new nl,d=new el,f,o,a;for(o=0;o<=h;o++){var s=T+o*u*P,m=Pc(s),_=Cc(s);for(a=0;a<=r.length-1;a++)p.x=r[a].x*m,p.y=r[a].y,p.z=r[a].x*_,l.push(p.x,p.y,p.z),d.x=o/h,d.y=a/(r.length-1),c.push(d.x,d.y)}for(o=0;o<h;o++)for(a=0;a<r.length-1;a++){var g=f=a+o*r.length,y=f+r.length,v=f+r.length+1,b=f+1;C.push(g,y,b),C.push(y,v,b)}if(this.setIndex(C),this.addAttribute("position",new Tt(l,3)),this.addAttribute("uv",new Tt(c,2)),this.computeVertexNormals(),P===2*Gn){var w=this.attributes.normal.array,x=new nl,S=new nl,E=new nl;for(f=3*(h*r.length),o=0,a=0;o<r.length;o++,a+=3)x.x=w[a+0],x.y=w[a+1],x.z=w[a+2],S.x=w[f+a+0],S.y=w[f+a+1],S.z=w[f+a+2],E.addVectors(x,S).normalize(),w[a+0]=w[f+a+0]=E.x,w[a+1]=w[f+a+1]=E.y,w[a+2]=w[f+a+2]=E.z}}function Ls(a,o){gt.call(this),this.type="ShapeGeometry","object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),o=o.curveSegments),this.parameters={shapes:a,curveSegments:o},this.fromBufferGeometry(new As(a,o)),this.mergeVertices()}function As(d,b){function p(e){var t=i.length/3,a=e.extractPoints(b),l=a.shape,p=a.holes,d,h,x;if(!1===Ya.isClockWise(l))for(l=l.reverse(),d=0,h=p.length;d<h;d++)x=p[d],!0===Ya.isClockWise(x)&&(p[d]=x.reverse());var c=Ya.triangulateShape(l,p);for(d=0,h=p.length;d<h;d++)x=p[d],l=l.concat(x);for(d=0,h=l.length;d<h;d++){var f=l[d];i.push(f.x,f.y,0),r.push(0,0,1),o.push(f.x,f.y)}for(d=0,h=c.length;d<h;d++){var m=c[d],_=m[0]+t,g=m[1]+t,y=m[2]+t;u.push(_,g,y),s+=3}}bl.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:d,curveSegments:b},b=b||12;var u=[],i=[],r=[],o=[],a=0,s=0;if(!1===Array.isArray(d))p(d);else for(var n=0;n<d.length;n++)p(d[n]),this.addGroup(a,s,n),a+=s,s=0;this.setIndex(u),this.addAttribute("position",new Tt(i,3)),this.addAttribute("normal",new Tt(r,3)),this.addAttribute("uv",new Tt(o,2))}function Is(b,t){bl.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0===t?1:t;var x=[],a=Cc(rd.DEG2RAD*t),s=[0,0],l={},c=["a","b","c"],h,n,i,r;b.isBufferGeometry?(r=new gt).fromBufferGeometry(b):r=b.clone(),r.mergeVertices(),r.computeFaceNormals();for(var o=r.vertices,u=r.faces,p=0,v=u.length;p<v;p++)for(var f=u[p],m=0;3>m;m++)h=f[c[m]],n=f[c[(m+1)%3]],s[0]=U(h,n),s[1]=C(h,n),void 0===l[i=s[0]+","+s[1]]?l[i]={index1:s[0],index2:s[1],face1:p,face2:void 0}:l[i].face2=p;for(i in l){var _=l[i];if(void 0===_.face2||u[_.face1].normal.dot(u[_.face2].normal)<=a){var g=o[_.index1];x.push(g.x,g.y,g.z),g=o[_.index2],x.push(g.x,g.y,g.z)}}this.addAttribute("position",new Tt(x,3))}function Rs(l,c,d,p,u,m,_,h){gt.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:l,radiusBottom:c,height:d,radialSegments:p,heightSegments:u,openEnded:m,thetaStart:_,thetaLength:h},this.fromBufferGeometry(new Ds(l,c,d,p,u,m,_,h)),this.mergeVertices()}function Ds(h,D,F,N,U,r,w,C){function b(e){var t=new el,r=new nl,n=0,i=!0===e?h:D,l=!0===e?1:-1,s,o,a;for(o=m,s=1;s<=N;s++)p.push(0,L*l,0),d.push(0,l,0),f.push(.5,.5),m++;for(a=m,s=0;s<=N;s++){var _=s/N*C+w,g=Cc(_),b=Pc(_);r.x=i*b,r.y=L*l,r.z=i*g,p.push(r.x,r.y,r.z),d.push(0,l,0),t.x=.5*g+.5,t.y=.5*b*l+.5,f.push(t.x,t.y),m++}for(s=0;s<N;s++){var x=o+s,v=a+s;!0===e?u.push(v,v+1,x):u.push(v+1,v,x),n+=3}B.addGroup(y,n,!0===e?1:2),y+=n}bl.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:h,radiusBottom:D,height:F,radialSegments:N,heightSegments:U,openEnded:r,thetaStart:w,thetaLength:C};var B=this;h=void 0===h?20:h,D=void 0===D?20:D,F=void 0===F?100:F,N=z(N)||8,U=z(U)||1,r=void 0!==r&&r,w=void 0===w?0:w,C=void 0===C?2*Gn:C;var u=[],p=[],d=[],f=[],m=0,_=[],L=F/2,y=0;!function(){var e=new nl,t=new nl,o=0,n=(D-h)/F,i,r;for(r=0;r<=U;r++){var a=[],l=r/U,s=l*(D-h)+h;for(i=0;i<=N;i++){var c=i/N,g=c*C+w,b=Pc(g),x=Cc(g);t.x=s*b,t.y=-l*F+L,t.z=s*x,p.push(t.x,t.y,t.z),e.set(b,n,x).normalize(),d.push(e.x,e.y,e.z),f.push(c,1-l),a.push(m++)}_.push(a)}for(i=0;i<N;i++)for(r=0;r<U;r++){var v=_[r][i],S=_[r+1][i],T=_[r+1][i+1],M=_[r][i+1];u.push(v,S,M),u.push(S,T,M),o+=6}B.addGroup(y,o,0),y+=o}(),!1===r&&(0<h&&b(!0),0<D&&b(!1)),this.setIndex(u),this.addAttribute("position",new Tt(p,3)),this.addAttribute("normal",new Tt(d,3)),this.addAttribute("uv",new Tt(f,2))}function ks(l,s,c,d,p,u,m){Rs.call(this,0,l,s,c,d,p,u,m),this.type="ConeGeometry",this.parameters={radius:l,height:s,radialSegments:c,heightSegments:d,openEnded:p,thetaStart:u,thetaLength:m}}function Fs(l,s,c,d,p,u,m){Ds.call(this,0,l,s,c,d,p,u,m),this.type="ConeBufferGeometry",this.parameters={radius:l,height:s,radialSegments:c,heightSegments:d,openEnded:p,thetaStart:u,thetaLength:m}}function Ns(a,o,r,l){gt.call(this),this.type="CircleGeometry",this.parameters={radius:a,segments:o,thetaStart:r,thetaLength:l},this.fromBufferGeometry(new Us(a,o,r,l)),this.mergeVertices()}function Us(r,m,_,h){bl.call(this),this.type="CircleBufferGeometry",this.parameters={radius:r,segments:m,thetaStart:_,thetaLength:h},r=r||50,m=void 0===m?8:C(3,m),_=void 0===_?0:_,h=void 0===h?2*Gn:h;var g=[],s=[],l=[],c=[],u=new nl,p=new el,d,o;for(s.push(0,0,0),l.push(0,0,1),c.push(.5,.5),o=0,d=3;o<=m;o++,d+=3){var a=_+o/m*h;u.x=r*Cc(a),u.y=r*Pc(a),s.push(u.x,u.y,u.z),l.push(0,0,1),p.x=(s[d]/r+1)/2,p.y=(s[d+1]/r+1)/2,c.push(p.x,p.y)}for(d=1;d<=m;d++)g.push(d,d+1,0);this.setIndex(g),this.addAttribute("position",new Tt(s,3)),this.addAttribute("normal",new Tt(l,3)),this.addAttribute("uv",new Tt(c,2))}function Bs(e){K.call(this),this.type="ShadowMaterial",this.color=new X(0),this.opacity=1,this.lights=!0,this.transparent=!0,this.setValues(e)}function zs(e){Q.call(this,e),this.type="RawShaderMaterial"}function Os(e){K.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new X(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new X(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new el(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Gs(e){Os.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(e)}function Hs(e){K.call(this),this.type="MeshPhongMaterial",this.color=new X(16777215),this.specular=new X(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new X(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new el(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=yo,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Vs(e){Hs.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(e)}function Ws(e){K.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new el(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function js(e){K.call(this),this.type="MeshLambertMaterial",this.color=new X(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new X(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=yo,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function qs(e){Rl.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}function Xs(l,t,e){var n=this,i=!1,r=0,o=0;this.onStart=void 0,this.onLoad=l,this.onProgress=t,this.onError=e,this.itemStart=function(e){o++,!1===i&&void 0!==n.onStart&&n.onStart(e,r,o),i=!0},this.itemEnd=function(e){r++,void 0!==n.onProgress&&n.onProgress(e,r,o),r===o&&(i=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(e){void 0!==n.onError&&n.onError(e)}}function Bn(e){this.manager=void 0===e?Qa:e}function zn(e){this.manager=void 0===e?Qa:e}function jn(e){this.manager=void 0===e?Qa:e}function Vn(a,t){ut.call(this),this.type="Light",this.color=new X(a),this.intensity=void 0===t?1:t,this.receiveShadow=void 0}function Ys(a,t,e){Vn.call(this,a,e),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(ut.DefaultUp),this.updateMatrix(),this.groundColor=new X(t)}function Zs(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new el(512,512),this.map=null,this.matrix=new il}function Xn(){Zs.call(this,new fl(50,1,.5,500))}function Js(a,t,e,n,i,r){Vn.call(this,a,t),this.type="SpotLight",this.position.copy(ut.DefaultUp),this.updateMatrix(),this.target=new ut,Object.defineProperty(this,"power",{get:function(){return this.intensity*Gn},set:function(e){this.intensity=e/Gn}}),this.distance=void 0===e?0:e,this.angle=void 0===n?Gn/3:n,this.penumbra=void 0===i?0:i,this.decay=void 0===r?1:r,this.shadow=new Xn}function Ks(a,t,e,o){Vn.call(this,a,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Gn},set:function(e){this.intensity=e/(4*Gn)}}),this.distance=void 0===e?0:e,this.decay=void 0===o?1:o,this.shadow=new Zs(new fl(90,1,.5,500))}function Qs(){Zs.call(this,new ht(-5,5,5,-5,.5,500))}function $s(a,t){Vn.call(this,a,t),this.type="DirectionalLight",this.position.copy(ut.DefaultUp),this.updateMatrix(),this.target=new ut,this.shadow=new Qs}function ec(a,t){Vn.call(this,a,t),this.type="AmbientLight",this.castShadow=void 0}function tc(a,t,e,o){Vn.call(this,a,t),this.type="RectAreaLight",this.position.set(0,1,0),this.updateMatrix(),this.width=void 0===e?10:e,this.height=void 0===o?10:o}function ac(a,t,e,o){this.parameterPositions=a,this._cachedIndex=0,this.resultBuffer=void 0===o?new t.constructor(e):o,this.sampleValues=t,this.valueSize=e}function ei(a,t,e,o){ac.call(this,a,t,e,o),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function oc(a,t,e,o){ac.call(this,a,t,e,o)}function rc(a,t,e,o){ac.call(this,a,t,e,o)}function nc(a,t,e,o){if(void 0===a)throw new Error("track name is undefined");if(void 0===t||0===t.length)throw new Error("no keyframes in track named "+a);this.name=a,this.times=$a.convertArray(t,this.TimeBufferType),this.values=$a.convertArray(e,this.ValueBufferType),this.setInterpolation(o||this.DefaultInterpolation),this.validate(),this.optimize()}function oi(a,t,e,o){nc.call(this,a,t,e,o)}function ic(a,t,e,o){ac.call(this,a,t,e,o)}function lc(a,t,e,o){nc.call(this,a,t,e,o)}function sc(a,t,e,o){nc.call(this,a,t,e,o)}function cc(a,t,e,o){nc.call(this,a,t,e,o)}function dc(a,t,e){nc.call(this,a,t,e)}function pc(a,t,e,o){nc.call(this,a,t,e,o)}function uc(){nc.apply(this,arguments)}function di(a,t,e){this.name=a,this.tracks=e,this.duration=void 0===t?-1:t,this.uuid=rd.generateUUID(),0>this.duration&&this.resetDuration(),this.optimize()}function fi(e){this.manager=void 0===e?Qa:e,this.textures={}}function mi(e){this.manager=void 0===e?Qa:e}function _i(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}}function gi(e){"boolean"==typeof e&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=void 0===e?Qa:e,this.withCredentials=!1}function yi(l,t,e,n,i){var r=.5*(n-t),o=.5*(i-e),a=l*l;return(2*e-2*n+r+o)*(l*a)+(-3*e+3*n-2*r-o)*a+r*l+e}function vi(a,t){var e=1-a;return e*e*t}function bi(a,t){return 2*(1-a)*a*t}function wi(a,t){return a*a*t}function xi(a,t,e,o){return vi(a,t)+bi(a,e)+wi(a,o)}function Si(a,t){var e=1-a;return e*e*e*t}function Ei(a,t){var e=1-a;return 3*e*e*a*t}function Mi(a,t){return 3*(1-a)*a*a*t}function Ti(a,t){return a*a*a*t}function Ai(a,t,e,o,n){return Si(a,t)+Ei(a,e)+Mi(a,o)+Ti(a,n)}function Pi(){this.arcLengthDivisions=200}function Ii(a,t){Pi.call(this),this.v1=a,this.v2=t}function Ci(){Pi.call(this),this.curves=[],this.autoClose=!1}function mc(l,t,e,n,i,r,o,a){Pi.call(this),this.aX=l,this.aY=t,this.xRadius=e,this.yRadius=n,this.aStartAngle=i,this.aEndAngle=r,this.aClockwise=o,this.aRotation=a||0}function Ri(e){Pi.call(this),this.points=void 0===e?[]:e}function ki(a,t,e,o){Pi.call(this),this.v0=a,this.v1=t,this.v2=e,this.v3=o}function Di(a,t,e){Pi.call(this),this.v0=a,this.v1=t,this.v2=e}function Oi(e){Ci.call(this),this.currentPoint=new el,e&&this.fromPoints(e)}function Fi(){Oi.apply(this,arguments),this.holes=[]}function _c(){this.subPaths=[],this.currentPath=null}function Ni(e){this.data=e}function Bi(e){this.manager=void 0===e?Qa:e}function zi(l,t,e){ut.call(this),this.type="CubeCamera";var d=new fl(90,1,l,t);d.up.set(0,-1,0),d.lookAt(new nl(1,0,0)),this.add(d);var i=new fl(90,1,l,t);i.up.set(0,-1,0),i.lookAt(new nl(-1,0,0)),this.add(i);var r=new fl(90,1,l,t);r.up.set(0,0,1),r.lookAt(new nl(0,1,0)),this.add(r);var o=new fl(90,1,l,t);o.up.set(0,0,-1),o.lookAt(new nl(0,-1,0)),this.add(o);var a=new fl(90,1,l,t);a.up.set(0,-1,0),a.lookAt(new nl(0,0,1)),this.add(a);var s=new fl(90,1,l,t);s.up.set(0,-1,0),s.lookAt(new nl(0,0,-1)),this.add(s);this.renderTarget=new ol(e,e,{format:ea,magFilter:Kc,minFilter:Kc}),this.renderTarget.texture.name="CubeCamera",this.update=function(c,t){null===this.parent&&this.updateMatrixWorld();var e=this.renderTarget,n=e.texture.generateMipmaps;e.texture.generateMipmaps=!1,e.activeCubeFace=0,c.render(t,d,e),e.activeCubeFace=1,c.render(t,i,e),e.activeCubeFace=2,c.render(t,r,e),e.activeCubeFace=3,c.render(t,o,e),e.activeCubeFace=4,c.render(t,a,e),e.texture.generateMipmaps=n,e.activeCubeFace=5,c.render(t,s,e),c.setRenderTarget(null)},this.clear=function(a,t,e,n){for(var i=this.renderTarget,r=0;6>r;r++)i.activeCubeFace=r,a.setRenderTarget(i),a.clear(t,e,n);a.setRenderTarget(null)}}function Gi(){ut.call(this),this.type="AudioListener",this.context=as.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null}function hc(e){ut.call(this),this.type="Audio",this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.loop=!1,this.startTime=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function gc(e){hc.call(this,e),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function fc(a,t){this.analyser=a.context.createAnalyser(),this.analyser.fftSize=void 0===t?2048:t,this.data=new Uint8Array(this.analyser.frequencyBinCount),a.getOutput().connect(this.analyser)}function Wi(a,t,e){this.binding=a,this.valueSize=e;var o=Float64Array,r;"quaternion"===t?r=this._slerp:"string"===t||"bool"===t?(o=Array,r=this._select):r=this._lerp;this.buffer=new o(4*e),this._mixBufferRegion=r,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}function qi(a,t,e){var o=e||yc.parseTrackName(t);this._targetGroup=a,this._bindings=a.subscribe_(t,o)}function yc(a,t,e){this.path=t,this.parsedPath=e||yc.parseTrackName(t),this.node=yc.findNode(a,this.parsedPath.nodeName)||a,this.rootNode=a}function Yi(c,t,e){this._mixer=c,this._clip=t,this._localRoot=e||null;for(var n=t.tracks,i=n.length,r=Array(i),o={endingStart:ga,endingEnd:ga},a=0,s;a!==i;++a)s=n[a].createInterpolant(null),r[a]=s,s.settings=o;this._interpolantSettings=o,this._interpolants=r,this._propertyBindings=Array(i),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=_a,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function Zi(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function Ji(){bl.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function bc(a,t,e,o){this.uuid=rd.generateUUID(),this.data=a,this.itemSize=t,this.offset=e,this.normalized=!0===o}function Qi(a,t){this.uuid=rd.generateUUID(),this.array=a,this.stride=t,this.count=void 0===a?0:a.length/t,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.onUploadCallback=function(){},this.version=0}function $i(a,t,e){Qi.call(this,a,t),this.meshPerAttribute=e||1}function xc(a,t,e){yt.call(this,a,t),this.meshPerAttribute=e||1}function vc(a,t){return a.distance-t.distance}function nr(l,t,e,n){if(!1!==l.visible&&(l.raycast(t,e),!0===n))for(var i=l.children,r=0,o=i.length;r<o;r++)nr(i[r],t,e,!0)}function ir(e){ut.call(this),this.material=e,this.render=function(){}}function rr(d,t,e,n){this.object=d,this.size=void 0===t?1:t;var i=void 0===e?16711680:e,p=void 0===n?1:n,u=0,a=this.object.geometry;a&&a.isGeometry?u=3*a.faces.length:a&&a.isBufferGeometry&&(u=a.attributes.normal.count);var s=new bl,l=new Tt(3*(2*u),3);s.addAttribute("position",l),kl.call(this,s,new Rl({color:i,linewidth:p})),this.matrixAutoUpdate=!1,this.update()}function or(c,t){ut.call(this),this.light=c,this.light.updateMatrixWorld(),this.matrix=c.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var e=new bl,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],i=0,r=1;32>i;i++,r++){var o=2*(i/32*Gn),a=2*(r/32*Gn);n.push(Cc(o),Pc(o),1,Cc(a),Pc(a),1)}e.addAttribute("position",new Tt(n,3));var s=new Rl({fog:!1});this.cone=new kl(e,s),this.add(this.cone),this.update()}function ar(a){var t=[];a&&a.isBone&&t.push(a);for(var e=0;e<a.children.length;e++)t.push.apply(t,ar(a.children[e]));return t}function sr(d){for(var t=ar(d),e=new bl,n=[],i=[],r=new X(0,0,1),o=new X(0,1,0),a=0,s;a<t.length;a++)s=t[a],s.parent&&s.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),i.push(r.r,r.g,r.b),i.push(o.r,o.g,o.b));e.addAttribute("position",new Tt(n,3)),e.addAttribute("color",new Tt(i,3));var l=new Rl({vertexColors:Ic,depthTest:!1,depthWrite:!1,transparent:!0});kl.call(this,e,l),this.root=d,this.bones=t,this.matrix=d.matrixWorld,this.matrixAutoUpdate=!1,this.onBeforeRender()}function lr(a,t,e){this.light=a,this.light.updateMatrixWorld(),this.color=e;var o=new Es(t,4,2),n=new Sl({wireframe:!0,fog:!1});Bt.call(this,o,n),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function cr(a,t){ut.call(this),this.light=a,this.light.updateMatrixWorld(),this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;var e=new Rl({fog:!1}),o=new bl;o.addAttribute("position",new yt(new Float32Array(15),3)),this.line=new Dl(o,e),this.add(this.line),this.update()}function hr(a,t,e){ut.call(this),this.light=a,this.light.updateMatrixWorld(),this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;var n=new Xl(t);n.rotateY(.5*Gn),this.material=new Sl({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=Ic);var i=n.getAttribute("position"),r=new Float32Array(3*i.count);n.addAttribute("color",new yt(r,3)),this.add(new Bt(n,this.material)),this.update()}function ur(m,t,e,n){m=m||10,t=t||10,e=new X(void 0===e?4473924:e),n=new X(void 0===n?8947848:n);for(var i=t/2,r=m/t,o=m/2,_=[],s=[],l=0,c=0,h=-o;l<=t;l++,h+=r){_.push(-o,0,h,o,0,h),_.push(h,0,-o,h,0,o);var u=l===i?e:n;u.toArray(s,c),c+=3,u.toArray(s,c),c+=3,u.toArray(s,c),c+=3,u.toArray(s,c),c+=3}var p=new bl;p.addAttribute("position",new Tt(_,3)),p.addAttribute("color",new Tt(s,3));var d=new Rl({vertexColors:Ic});kl.call(this,p,d)}function pr(g,t,e,n,i,r){g=g||10,t=t||16,e=e||8,n=n||64,i=new X(void 0===i?4473924:i),r=new X(void 0===r?8947848:r);var o=[],d=[],f,a,s,l,c,h,u;for(l=0;l<=t;l++)s=l/t*(2*Gn),f=Pc(s)*g,a=Cc(s)*g,o.push(0,0,0),o.push(f,0,a),u=1&l?i:r,d.push(u.r,u.g,u.b),d.push(u.r,u.g,u.b);for(l=0;l<=e;l++)for(u=1&l?i:r,h=g-g/e*l,c=0;c<n;c++)s=c/n*(2*Gn),f=Pc(s)*h,a=Cc(s)*h,o.push(f,0,a),d.push(u.r,u.g,u.b),s=(c+1)/n*(2*Gn),f=Pc(s)*h,a=Cc(s)*h,o.push(f,0,a),d.push(u.r,u.g,u.b);var p=new bl;p.addAttribute("position",new Tt(o,3)),p.addAttribute("color",new Tt(d,3));var m=new Rl({vertexColors:Ic});kl.call(this,p,m)}function dr(d,t,e,n){this.object=d,this.size=void 0===t?1:t;var i=void 0===e?16776960:e,p=void 0===n?1:n,u=0,a=this.object.geometry;a&&a.isGeometry?u=a.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var s=new bl,l=new Tt(3*(2*u),3);s.addAttribute("position",l),kl.call(this,s,new Rl({color:i,linewidth:p})),this.matrixAutoUpdate=!1,this.update()}function fr(a,t,o){ut.call(this),this.light=a,this.light.updateMatrixWorld(),this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1,this.color=o,void 0===t&&(t=1);var n=new bl;n.addAttribute("position",new Tt([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var i=new Rl({fog:!1});this.lightPlane=new Dl(n,i),this.add(this.lightPlane),(n=new bl).addAttribute("position",new Tt([0,0,0,0,0,1],3)),this.targetLine=new Dl(n,i),this.add(this.targetLine),this.update()}function mr(d){function t(a,t,o){m(a,o),m(t,o)}function m(n,t){r.push(0,0,0),o.push(t.r,t.g,t.b),void 0===a[n]&&(a[n]=[]),a[n].push(r.length/3-1)}var e=new bl,n=new Rl({color:16777215,vertexColors:Br}),r=[],o=[],a={},i=new X(16755200),l=new X(16711680),s=new X(43775),c=new X(16777215),u=new X(3355443);t("n1","n2",i),t("n2","n4",i),t("n4","n3",i),t("n3","n1",i),t("f1","f2",i),t("f2","f4",i),t("f4","f3",i),t("f3","f1",i),t("n1","f1",i),t("n2","f2",i),t("n3","f3",i),t("n4","f4",i),t("p","n1",l),t("p","n2",l),t("p","n3",l),t("p","n4",l),t("u1","u2",s),t("u2","u3",s),t("u3","u1",s),t("c","t",c),t("p","c",u),t("cn1","cn2",u),t("cn3","cn4",u),t("cf1","cf2",u),t("cf3","cf4",u),e.addAttribute("position",new Tt(r,3)),e.addAttribute("color",new Tt(o,3)),kl.call(this,e,n),this.camera=d,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=d.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}function _r(a,t){this.object=a,void 0===t&&(t=16776960);var o=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),i=new bl;i.setIndex(new yt(o,1)),i.addAttribute("position",new yt(n,3)),kl.call(this,i,new Rl({color:t})),this.matrixAutoUpdate=!1,this.update()}function gr(a,t){this.type="Box3Helper",this.box=a;var e=void 0===t?16776960:t,r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new bl;i.setIndex(new yt(r,1)),i.addAttribute("position",new Tt([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),kl.call(this,i,new Rl({color:e})),this.geometry.computeBoundingSphere(),this.onBeforeRender()}function yr(a,t,e){this.type="PlaneHelper",this.plane=a,this.size=void 0===t?1:t;var r=void 0===e?16776960:e,n=new bl;n.addAttribute("position",new Tt([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),n.computeBoundingSphere(),Dl.call(this,n,new Rl({color:r}));var o=new bl;o.addAttribute("position",new Tt([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new Bt(o,new Sl({color:r,opacity:.2,transparent:!0,depthWrite:!1}))),this.onBeforeRender()}function vr(a,t,e,n,l,r){ut.call(this),void 0===n&&(n=16776960),void 0===e&&(e=1),void 0===l&&(l=.2*e),void 0===r&&(r=.2*l),void 0===ss&&((ss=new bl).addAttribute("position",new Tt([0,0,0,0,1,0],3)),(cs=new Ds(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new Dl(ss,new Rl({color:n})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Bt(cs,new Sl({color:n})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(a),this.setLength(e,l,r)}function br(a){var t=[0,0,0,a=a||1,0,0,0,0,0,0,a,0,0,0,0,0,0,a],e=new bl;e.addAttribute("position",new Tt(t,3)),e.addAttribute("color",new Tt([1,0,0,1,0.6,0,0,1,0,0.6,1,0,0,0,1,0,0.6,1],3));var o=new Rl({vertexColors:Ic});kl.call(this,e,o)}function wr(){function d(r,c,o,a){l=r,e=o,n=-3*r+3*c-2*o-a,i=2*r-2*c+o+a}var l=0,e=0,n=0,i=0;return{initCatmullRom:function(t,e,a,n,r){d(e,a,r*(a-t),r*(n-e))},initNonuniformCatmullRom:function(t,e,n,i,r,o,a){var s=(e-t)/r-(n-t)/(r+o)+(n-e)/o,l=(n-e)/o-(i-e)/(o+a)+(i-n)/a;d(e,n,s*=o,l*=o)},calc:function(a){var t=a*a;return l+e*a+n*t+i*(t*a)}}}function xr(e){Pi.call(this),2>e.length&&console.warn("THREE.CatmullRomCurve3: Points array needs at least two entries."),this.points=e||[],this.closed=!1}function Sr(a,t,e,o){Pi.call(this),this.v0=a,this.v1=t,this.v2=e,this.v3=o}function Er(a,t,e){Pi.call(this),this.v0=a,this.v1=t,this.v2=e}function Mr(a,t){Pi.call(this),this.v1=a,this.v2=t}function Tr(a,t,e,n,i,r){mc.call(this,a,t,e,e,n,i,r)}function Ar(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),xr.call(this,e),this.type="catmullrom"}var Pr=Math.tan,Sc=Math.atan,wc=Math.acos,Ec=Math.sign,Tc=Number.isInteger,Mc=Number.EPSILON,Pc=Math.sin,Cc=Math.cos;e.d(t,"b",function(){return n}),e.d(t,"c",function(){return il}),e.d(t,"g",function(){return al}),e.d(t,"f",function(){return nl}),e.d(t,"e",function(){return el}),e.d(t,"d",function(){return rl}),e.d(t,"a",function(){return X}),void 0===Mc&&(Mc=2.220446049250313e-16),void 0===Tc&&(Tc=function(e){return"number"==typeof e&&isFinite(e)&&z(e)===e}),void 0===Ec&&(Ec=function(e){return 0>e?-1:0<e?1:+e}),void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(a){if(void 0===a||null===a)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(a),e=1,o;e<arguments.length;e++)if(o=arguments[e],void 0!==o&&null!==o)for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n]);return t}),Object.assign(n.prototype,{addEventListener:function(a,t){void 0===this._listeners&&(this._listeners={});var e=this._listeners;void 0===e[a]&&(e[a]=[]),-1===e[a].indexOf(t)&&e[a].push(t)},hasEventListener:function(a,t){if(void 0===this._listeners)return!1;var e=this._listeners;return void 0!==e[a]&&-1!==e[a].indexOf(t)},removeEventListener:function(a,t){if(void 0!==this._listeners){var e=this._listeners[a];if(void 0!==e){var o=e.indexOf(t);-1!==o&&e.splice(o,1)}}},dispatchEvent:function(a){if(void 0!==this._listeners){var t=this._listeners[a.type];if(void 0!==t){a.target=this;for(var e=t.slice(0),o=0,n=e.length;o<n;o++)e[o].call(this,a)}}}});var Lc="87",Ir=0,Cr=1,Lr=2,Rr=0,kr=1,Dr=2,Or=0,Fr=1,Ac=2,Nr=0,Br=1,Ic=2,Rc=0,Dc=1,kc=2,Fc=3,Nc=4,Uc=5,Bc=100,Yr=101,Zr=102,Jr=103,Kr=104,Qr=200,$r=201,to=202,eo=203,no=204,io=205,ro=206,oo=207,ao=208,so=209,lo=210,co=0,ho=1,uo=2,po=3,fo=4,mo=5,_o=6,go=7,yo=0,vo=1,bo=2,wo=0,xo=1,So=2,Eo=3,Mo=4,To=301,zc=302,Oc=303,Gc=304,Hc=305,Vc=306,Wc=307,jc=1e3,qc=1001,Xc=1002,Yc=1003,Zc=1004,Jc=1005,Kc=1006,Qc=1007,$c=1008,ed=1009,Ho=1010,Vo=1011,Wo=1012,qo=1013,Xo=1014,Yo=1015,Zo=1016,Jo=1017,Ko=1018,Qo=1019,$o=1020,ta=1021,ea=1022,td=1023,ad=1024,ra=1025,oa=1026,aa=1027,sa=2001,la=2002,ca=2003,ha=2004,ua=2100,pa=2101,da=2102,fa=2103,ma=2151,_a=2201,ga=2400,od=0,va=1,ba=2,wa=3e3,xa=3001,Sa=3007,Ea=3002,Ma=3004,Ta=3005,Aa=3006,Pa=3200,Ia=3201,rd={DEG2RAD:Gn/180,RAD2DEG:180/Gn,generateUUID:function(){var a=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],e=Array(36),o=0,n;return function(){for(var t=0;36>t;t++)8===t||13===t||18===t||23===t?e[t]="-":14===t?e[t]="4":(2>=o&&(o=0|33554432+16777216*Math.random()),n=15&o,o>>=4,e[t]=a[19===t?8|3&n:n]);return e.join("")}}(),clamp:function(a,t,e){return C(t,U(e,a))},euclideanModulo:function(a,t){return(a%t+t)%t},mapLinear:function(a,t,e,o,n){return o+(a-t)*(n-o)/(e-t)},lerp:function(a,t,e){return(1-e)*a+e*t},smoothstep:function(a,t,e){return a<=t?0:a>=e?1:(a=(a-t)/(e-t))*a*(3-2*a)},smootherstep:function(a,t,e){return a<=t?0:a>=e?1:(a=(a-t)/(e-t))*a*a*(a*(6*a-15)+10)},randInt:function(a,t){return a+z(Math.random()*(t-a+1))},randFloat:function(a,t){return a+Math.random()*(t-a)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*rd.DEG2RAD},radToDeg:function(e){return e*rd.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},nearestPowerOfTwo:function(e){return S(2,P(i(e)/o))},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}};Object.defineProperties(el.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(el.prototype,{isVector2:!0,set:function(a,t){return this.x=a,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(a,t){switch(a){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+a);}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e);}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(a,t){return void 0===t?(this.x+=a.x,this.y+=a.y,this):(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,t))},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(a,t){return this.x=a.x+t.x,this.y=a.y+t.y,this},addScaledVector:function(a,t){return this.x+=a.x*t,this.y+=a.y*t,this},sub:function(a,t){return void 0===t?(this.x-=a.x,this.y-=a.y,this):(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,t))},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(a,t){return this.x=a.x-t.x,this.y=a.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=U(this.x,e.x),this.y=U(this.y,e.y),this},max:function(e){return this.x=C(this.x,e.x),this.y=C(this.y,e.y),this},clamp:function(a,t){return this.x=C(a.x,U(t.x,this.x)),this.y=C(a.y,U(t.y,this.y)),this},clampScalar:function(){var a=new el,t=new el;return function(e,o){return a.set(e,e),t.set(o,o),this.clamp(a,t)}}(),clampLength:function(a,t){var e=this.length();return this.divideScalar(e||1).multiplyScalar(C(a,U(t,e)))},floor:function(){return this.x=z(this.x),this.y=z(this.y),this},ceil:function(){return this.x=T(this.x),this.y=T(this.y),this},round:function(){return this.x=P(this.x),this.y=P(this.y),this},roundToZero:function(){return this.x=0>this.x?T(this.x):z(this.x),this.y=0>this.y?T(this.y):z(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return N(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return B(this.x)+B(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=D(this.y,this.x);return 0>e&&(e+=2*Gn),e},distanceTo:function(e){return N(this.distanceToSquared(e))},distanceToSquared:function(a){var t=this.x-a.x,e=this.y-a.y;return t*t+e*e},distanceToManhattan:function(e){return B(this.x-e.x)+B(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(a,t){return this.x+=(a.x-this.x)*t,this.y+=(a.y-this.y)*t,this},lerpVectors:function(a,t,e){return this.subVectors(t,a).multiplyScalar(e).add(a)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(a,t){return void 0===t&&(t=0),this.x=a[t],this.y=a[t+1],this},toArray:function(a,t){return void 0===a&&(a=[]),void 0===t&&(t=0),a[t]=this.x,a[t+1]=this.y,a},fromBufferAttribute:function(a,t,e){return void 0!==e&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=a.getX(t),this.y=a.getY(t),this},rotateAround:function(a,t){var e=Cc(t),n=Pc(t),i=this.x-a.x,r=this.y-a.y;return this.x=i*e-r*n+a.x,this.y=i*n+r*e+a.y,this}});var La=0;tl.DEFAULT_IMAGE=void 0,tl.DEFAULT_MAPPING=300,Object.defineProperty(tl.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(tl.prototype,n.prototype,{constructor:tl,isTexture:!0,clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(a){if(void 0!==a.textures[this.uuid])return a.textures[this.uuid];var t={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var e=this.image;void 0===e.uuid&&(e.uuid=rd.generateUUID()),void 0===a.images[e.uuid]&&(a.images[e.uuid]={uuid:e.uuid,url:function(a){var t;if(a instanceof HTMLCanvasElement)t=a;else{(t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")).width=a.width,t.height=a.height;var e=t.getContext("2d");a instanceof ImageData?e.putImageData(a,0,0):e.drawImage(a,0,0,a.width,a.height)}return 2048<t.width||2048<t.height?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}(e)}),t.image=e.uuid}return a.textures[this.uuid]=t,t},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(300===this.mapping){if(e.multiply(this.repeat),e.add(this.offset),0>e.x||1<e.x)switch(this.wrapS){case jc:e.x-=z(e.x);break;case qc:e.x=0>e.x?0:1;break;case Xc:1===B(z(e.x)%2)?e.x=T(e.x)-e.x:e.x-=z(e.x);}if(0>e.y||1<e.y)switch(this.wrapT){case jc:e.y-=z(e.y);break;case qc:e.y=0>e.y?0:1;break;case Xc:1===B(z(e.y)%2)?e.y=T(e.y)-e.y:e.y-=z(e.y);}this.flipY&&(e.y=1-e.y)}}}),Object.assign(al.prototype,{isVector4:!0,set:function(a,t,e,o){return this.x=a,this.y=t,this.z=e,this.w=o,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(a,t){switch(a){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+a);}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e);}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0===e.w?1:e.w,this},add:function(a,t){return void 0===t?(this.x+=a.x,this.y+=a.y,this.z+=a.z,this.w+=a.w,this):(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,t))},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(a,t){return this.x=a.x+t.x,this.y=a.y+t.y,this.z=a.z+t.z,this.w=a.w+t.w,this},addScaledVector:function(a,t){return this.x+=a.x*t,this.y+=a.y*t,this.z+=a.z*t,this.w+=a.w*t,this},sub:function(a,t){return void 0===t?(this.x-=a.x,this.y-=a.y,this.z-=a.z,this.w-=a.w,this):(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,t))},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(a,t){return this.x=a.x-t.x,this.y=a.y-t.y,this.z=a.z-t.z,this.w=a.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(a){var t=this.x,e=this.y,n=this.z,i=this.w,r=a.elements;return this.x=r[0]*t+r[4]*e+r[8]*n+r[12]*i,this.y=r[1]*t+r[5]*e+r[9]*n+r[13]*i,this.z=r[2]*t+r[6]*e+r[10]*n+r[14]*i,this.w=r[3]*t+r[7]*e+r[11]*n+r[15]*i,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(a){this.w=2*wc(a.w);var t=N(1-a.w*a.w);return 1e-4>t?(this.x=1,this.y=0,this.z=0):(this.x=a.x/t,this.y=a.y/t,this.z=a.z/t),this},setAxisAngleFromRotationMatrix:function(x){var t=x.elements,o=t[0],a=t[4],s=t[8],l=t[1],c=t[5],h=t[9],u=t[2],p=t[6],d=t[10],f,e,n,i;if(.01>B(a-l)&&.01>B(s-u)&&.01>B(h-p)){if(.1>B(a+l)&&.1>B(s+u)&&.1>B(h+p)&&.1>B(o+c+d-3))return this.set(1,0,0,0),this;f=Gn;var r=(o+1)/2,m=(c+1)/2,_=(d+1)/2,g=(a+l)/4,y=(s+u)/4,v=(h+p)/4;return r>m&&r>_?.01>r?(e=0,n=.707106781,i=.707106781):(n=g/(e=N(r)),i=y/e):m>_?.01>m?(e=.707106781,n=0,i=.707106781):(e=g/(n=N(m)),i=v/n):.01>_?(e=.707106781,n=.707106781,i=0):(e=y/(i=N(_)),n=v/i),this.set(e,n,i,f),this}var b=N((p-h)*(p-h)+(s-u)*(s-u)+(l-a)*(l-a));return .001>B(b)&&(b=1),this.x=(p-h)/b,this.y=(s-u)/b,this.z=(l-a)/b,this.w=wc((o+c+d-1)/2),this},min:function(e){return this.x=U(this.x,e.x),this.y=U(this.y,e.y),this.z=U(this.z,e.z),this.w=U(this.w,e.w),this},max:function(e){return this.x=C(this.x,e.x),this.y=C(this.y,e.y),this.z=C(this.z,e.z),this.w=C(this.w,e.w),this},clamp:function(a,t){return this.x=C(a.x,U(t.x,this.x)),this.y=C(a.y,U(t.y,this.y)),this.z=C(a.z,U(t.z,this.z)),this.w=C(a.w,U(t.w,this.w)),this},clampScalar:function(){var a,t;return function(e,o){return void 0===a&&(a=new al,t=new al),a.set(e,e,e,e),t.set(o,o,o,o),this.clamp(a,t)}}(),clampLength:function(a,t){var e=this.length();return this.divideScalar(e||1).multiplyScalar(C(a,U(t,e)))},floor:function(){return this.x=z(this.x),this.y=z(this.y),this.z=z(this.z),this.w=z(this.w),this},ceil:function(){return this.x=T(this.x),this.y=T(this.y),this.z=T(this.z),this.w=T(this.w),this},round:function(){return this.x=P(this.x),this.y=P(this.y),this.z=P(this.z),this.w=P(this.w),this},roundToZero:function(){return this.x=0>this.x?T(this.x):z(this.x),this.y=0>this.y?T(this.y):z(this.y),this.z=0>this.z?T(this.z):z(this.z),this.w=0>this.w?T(this.w):z(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return N(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return B(this.x)+B(this.y)+B(this.z)+B(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(a,t){return this.x+=(a.x-this.x)*t,this.y+=(a.y-this.y)*t,this.z+=(a.z-this.z)*t,this.w+=(a.w-this.w)*t,this},lerpVectors:function(a,t,e){return this.subVectors(t,a).multiplyScalar(e).add(a)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(a,t){return void 0===t&&(t=0),this.x=a[t],this.y=a[t+1],this.z=a[t+2],this.w=a[t+3],this},toArray:function(a,t){return void 0===a&&(a=[]),void 0===t&&(t=0),a[t]=this.x,a[t+1]=this.y,a[t+2]=this.z,a[t+3]=this.w,a},fromBufferAttribute:function(a,t,e){return void 0!==e&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=a.getX(t),this.y=a.getY(t),this.z=a.getZ(t),this.w=a.getW(t),this}}),Object.assign(a.prototype,n.prototype,{isWebGLRenderTarget:!0,setSize:function(a,t){this.width===a&&this.height===t||(this.width=a,this.height=t,this.dispose()),this.viewport.set(0,0,a,t),this.scissor.set(0,0,a,t)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),ol.prototype=Object.create(a.prototype),ol.prototype.constructor=ol,ol.prototype.isWebGLRenderTargetCube=!0,Object.assign(rl,{slerp:function(a,t,e,o){return e.copy(a).slerp(t,o)},slerpFlat:function(S,t,e,n,i,r,o){var a=e[n+0],s=e[n+1],l=e[n+2],c=e[n+3],h=i[r+0],u=i[r+1],p=i[r+2],d=i[r+3];if(c!==d||a!==h||s!==u||l!==p){var f=1-o,m=a*h+s*u+l*p+c*d,_=0<=m?1:-1,g=1-m*m;if(g>Mc){var y=N(g),v=D(y,m*_);f=Pc(f*v)/y,o=Pc(o*v)/y}var b=o*_;if(a=a*f+h*b,s=s*f+u*b,l=l*f+p*b,c=c*f+d*b,f===1-o){var w=1/N(a*a+s*s+l*l+c*c);a*=w,s*=w,l*=w,c*=w}}S[t]=a,S[t+1]=s,S[t+2]=l,S[t+3]=c}}),Object.defineProperties(rl.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}}),Object.assign(rl.prototype,{set:function(a,t,e,o){return this._x=a,this._y=t,this._z=e,this._w=o,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(m,_){if(!m||!m.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var e=m._x,n=m._y,i=m._z,r=m.order,o=Cc,a=Pc,s=o(e/2),l=o(n/2),c=o(i/2),h=a(e/2),u=a(n/2),p=a(i/2);return"XYZ"===r?(this._x=h*l*c+s*u*p,this._y=s*u*c-h*l*p,this._z=s*l*p+h*u*c,this._w=s*l*c-h*u*p):"YXZ"===r?(this._x=h*l*c+s*u*p,this._y=s*u*c-h*l*p,this._z=s*l*p-h*u*c,this._w=s*l*c+h*u*p):"ZXY"===r?(this._x=h*l*c-s*u*p,this._y=s*u*c+h*l*p,this._z=s*l*p+h*u*c,this._w=s*l*c-h*u*p):"ZYX"===r?(this._x=h*l*c-s*u*p,this._y=s*u*c+h*l*p,this._z=s*l*p-h*u*c,this._w=s*l*c+h*u*p):"YZX"===r?(this._x=h*l*c+s*u*p,this._y=s*u*c+h*l*p,this._z=s*l*p-h*u*c,this._w=s*l*c-h*u*p):"XZY"===r&&(this._x=h*l*c-s*u*p,this._y=s*u*c-h*l*p,this._z=s*l*p+h*u*c,this._w=s*l*c+h*u*p),!1!==_&&this.onChangeCallback(),this},setFromAxisAngle:function(a,t){var e=t/2,o=Pc(e);return this._x=a.x*o,this._y=a.y*o,this._z=a.z*o,this._w=Cc(e),this.onChangeCallback(),this},setFromRotationMatrix:function(d){var t=d.elements,n=t[0],i=t[4],r=t[8],o=t[1],a=t[5],s=t[9],l=t[2],c=t[6],m=t[10],u=n+a+m,p;return 0<u?(p=.5/N(u+1),this._w=.25/p,this._x=(c-s)*p,this._y=(r-l)*p,this._z=(o-i)*p):n>a&&n>m?(p=2*N(1+n-a-m),this._w=(c-s)/p,this._x=.25*p,this._y=(i+o)/p,this._z=(r+l)/p):a>m?(p=2*N(1+a-n-m),this._w=(r-l)/p,this._x=(i+o)/p,this._y=.25*p,this._z=(s+c)/p):(p=2*N(1+m-n-a),this._w=(o-i)/p,this._x=(r+l)/p,this._y=(s+c)/p,this._z=.25*p),this.onChangeCallback(),this},setFromUnitVectors:function(){var a=new nl,e;return function(t,o){return void 0===a&&(a=new nl),1e-6>(e=t.dot(o)+1)?(e=0,B(t.x)>B(t.z)?a.set(-t.y,t.x,0):a.set(0,-t.z,t.y)):a.crossVectors(t,o),this._x=a.x,this._y=a.y,this._z=a.z,this._w=e,this.normalize()}}(),inverse:function(){return this.conjugate().normalize()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return N(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x*=e,this._y*=e,this._z*=e,this._w*=e),this.onChangeCallback(),this},multiply:function(a,t){return void 0===t?this.multiplyQuaternions(this,a):(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(a,t))},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(d,t){var e=d._x,n=d._y,i=d._z,r=d._w,o=t._x,a=t._y,s=t._z,l=t._w;return this._x=e*l+r*o+n*s-i*a,this._y=n*l+r*a+i*o-e*s,this._z=i*l+r*s+e*a-n*o,this._w=r*l-e*o-n*a-i*s,this.onChangeCallback(),this},slerp:function(d,t){if(0===t)return this;if(1===t)return this.copy(d);var e=this._x,n=this._y,i=this._z,r=this._w,o=r*d._w+e*d._x+n*d._y+i*d._z;if(0>o?(this._w=-d._w,this._x=-d._x,this._y=-d._y,this._z=-d._z,o=-o):this.copy(d),1<=o)return this._w=r,this._x=e,this._y=n,this._z=i,this;var p=N(1-o*o);if(.001>B(p))return this._w=.5*(r+this._w),this._x=.5*(e+this._x),this._y=.5*(n+this._y),this._z=.5*(i+this._z),this;var s=D(p,o),l=Pc((1-t)*s)/p,c=Pc(t*s)/p;return this._w=r*l+this._w*c,this._x=e*l+this._x*c,this._y=n*l+this._y*c,this._z=i*l+this._z*c,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(a,t){return void 0===t&&(t=0),this._x=a[t],this._y=a[t+1],this._z=a[t+2],this._w=a[t+3],this.onChangeCallback(),this},toArray:function(a,t){return void 0===a&&(a=[]),void 0===t&&(t=0),a[t]=this._x,a[t+1]=this._y,a[t+2]=this._z,a[t+3]=this._w,a},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(nl.prototype,{isVector3:!0,set:function(a,t,e){return this.x=a,this.y=t,this.z=e,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(a,t){switch(a){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+a);}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e);}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(a,t){return void 0===t?(this.x+=a.x,this.y+=a.y,this.z+=a.z,this):(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,t))},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(a,t){return this.x=a.x+t.x,this.y=a.y+t.y,this.z=a.z+t.z,this},addScaledVector:function(a,t){return this.x+=a.x*t,this.y+=a.y*t,this.z+=a.z*t,this},sub:function(a,t){return void 0===t?(this.x-=a.x,this.y-=a.y,this.z-=a.z,this):(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,t))},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(a,t){return this.x=a.x-t.x,this.y=a.y-t.y,this.z=a.z-t.z,this},multiply:function(a,t){return void 0===t?(this.x*=a.x,this.y*=a.y,this.z*=a.z,this):(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,t))},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(a,t){return this.x=a.x*t.x,this.y=a.y*t.y,this.z=a.z*t.z,this},applyEuler:function(){var a=new rl;return function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(a.setFromEuler(t))}}(),applyAxisAngle:function(){var a=new rl;return function(t,e){return this.applyQuaternion(a.setFromAxisAngle(t,e))}}(),applyMatrix3:function(a){var t=this.x,e=this.y,o=this.z,n=a.elements;return this.x=n[0]*t+n[3]*e+n[6]*o,this.y=n[1]*t+n[4]*e+n[7]*o,this.z=n[2]*t+n[5]*e+n[8]*o,this},applyMatrix4:function(a){var t=this.x,e=this.y,n=this.z,i=a.elements,r=1/(i[3]*t+i[7]*e+i[11]*n+i[15]);return this.x=(i[0]*t+i[4]*e+i[8]*n+i[12])*r,this.y=(i[1]*t+i[5]*e+i[9]*n+i[13])*r,this.z=(i[2]*t+i[6]*e+i[10]*n+i[14])*r,this},applyQuaternion:function(d){var t=this.x,e=this.y,n=this.z,i=d.x,p=d.y,m=d.z,_=d.w,s=_*t+p*n-m*e,l=_*e+m*t-i*n,c=_*n+i*e-p*t,h=-i*t-p*e-m*n;return this.x=s*_+h*-i+l*-m-c*-p,this.y=l*_+h*-p+c*-i-s*-m,this.z=c*_+h*-m+s*-p-l*-i,this},project:function(){var a=new il;return function(t){return a.multiplyMatrices(t.projectionMatrix,a.getInverse(t.matrixWorld)),this.applyMatrix4(a)}}(),unproject:function(){var a=new il;return function(t){return a.multiplyMatrices(t.matrixWorld,a.getInverse(t.projectionMatrix)),this.applyMatrix4(a)}}(),transformDirection:function(a){var t=this.x,e=this.y,o=this.z,n=a.elements;return this.x=n[0]*t+n[4]*e+n[8]*o,this.y=n[1]*t+n[5]*e+n[9]*o,this.z=n[2]*t+n[6]*e+n[10]*o,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=U(this.x,e.x),this.y=U(this.y,e.y),this.z=U(this.z,e.z),this},max:function(e){return this.x=C(this.x,e.x),this.y=C(this.y,e.y),this.z=C(this.z,e.z),this},clamp:function(a,t){return this.x=C(a.x,U(t.x,this.x)),this.y=C(a.y,U(t.y,this.y)),this.z=C(a.z,U(t.z,this.z)),this},clampScalar:function(){var a=new nl,t=new nl;return function(e,o){return a.set(e,e,e),t.set(o,o,o),this.clamp(a,t)}}(),clampLength:function(a,t){var e=this.length();return this.divideScalar(e||1).multiplyScalar(C(a,U(t,e)))},floor:function(){return this.x=z(this.x),this.y=z(this.y),this.z=z(this.z),this},ceil:function(){return this.x=T(this.x),this.y=T(this.y),this.z=T(this.z),this},round:function(){return this.x=P(this.x),this.y=P(this.y),this.z=P(this.z),this},roundToZero:function(){return this.x=0>this.x?T(this.x):z(this.x),this.y=0>this.y?T(this.y):z(this.y),this.z=0>this.z?T(this.z):z(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return N(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return B(this.x)+B(this.y)+B(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(a,t){return this.x+=(a.x-this.x)*t,this.y+=(a.y-this.y)*t,this.z+=(a.z-this.z)*t,this},lerpVectors:function(a,t,e){return this.subVectors(t,a).multiplyScalar(e).add(a)},cross:function(a,t){if(void 0!==t)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(a,t);var e=this.x,o=this.y,n=this.z;return this.x=o*a.z-n*a.y,this.y=n*a.x-e*a.z,this.z=e*a.y-o*a.x,this},crossVectors:function(l,t){var e=l.x,n=l.y,i=l.z,r=t.x,o=t.y,a=t.z;return this.x=n*a-i*o,this.y=i*r-e*a,this.z=e*o-n*r,this},projectOnVector:function(a){var t=a.dot(this)/a.lengthSq();return this.copy(a).multiplyScalar(t)},projectOnPlane:function(){var a=new nl;return function(t){return a.copy(this).projectOnVector(t),this.sub(a)}}(),reflect:function(){var a=new nl;return function(t){return this.sub(a.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(a){var t=this.dot(a)/N(this.lengthSq()*a.lengthSq());return wc(rd.clamp(t,-1,1))},distanceTo:function(e){return N(this.distanceToSquared(e))},distanceToSquared:function(a){var t=this.x-a.x,e=this.y-a.y,o=this.z-a.z;return t*t+e*e+o*o},distanceToManhattan:function(e){return B(this.x-e.x)+B(this.y-e.y)+B(this.z-e.z)},setFromSpherical:function(a){var t=Pc(a.phi)*a.radius;return this.x=t*Pc(a.theta),this.y=Cc(a.phi)*a.radius,this.z=t*Cc(a.theta),this},setFromCylindrical:function(e){return this.x=e.radius*Pc(e.theta),this.y=e.y,this.z=e.radius*Cc(e.theta),this},setFromMatrixPosition:function(a){var t=a.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(a){var t=this.setFromMatrixColumn(a,0).length(),e=this.setFromMatrixColumn(a,1).length(),o=this.setFromMatrixColumn(a,2).length();return this.x=t,this.y=e,this.z=o,this},setFromMatrixColumn:function(a,t){return this.fromArray(a.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(a,t){return void 0===t&&(t=0),this.x=a[t],this.y=a[t+1],this.z=a[t+2],this},toArray:function(a,t){return void 0===a&&(a=[]),void 0===t&&(t=0),a[t]=this.x,a[t+1]=this.y,a[t+2]=this.z,a},fromBufferAttribute:function(a,t,e){return void 0!==e&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=a.getX(t),this.y=a.getY(t),this.z=a.getZ(t),this}}),Object.assign(il.prototype,{isMatrix4:!0,set:function(g,t,e,n,i,r,o,a,s,l,c,h,u,p,d,f){var m=this.elements;return m[0]=g,m[4]=t,m[8]=e,m[12]=n,m[1]=i,m[5]=r,m[9]=o,m[13]=a,m[2]=s,m[6]=l,m[10]=c,m[14]=h,m[3]=u,m[7]=p,m[11]=d,m[15]=f,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return new il().fromArray(this.elements)},copy:function(a){var t=this.elements,e=a.elements;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],this},copyPosition:function(a){var t=this.elements,e=a.elements;return t[12]=e[12],t[13]=e[13],t[14]=e[14],this},extractBasis:function(a,t,e){return a.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),e.setFromMatrixColumn(this,2),this},makeBasis:function(a,t,e){return this.set(a.x,t.x,e.x,0,a.y,t.y,e.y,0,a.z,t.z,e.z,0,0,0,0,1),this},extractRotation:function(){var l=new nl;return function(t){var e=this.elements,n=t.elements,i=1/l.setFromMatrixColumn(t,0).length(),r=1/l.setFromMatrixColumn(t,1).length(),o=1/l.setFromMatrixColumn(t,2).length();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[8]=n[8]*o,e[9]=n[9]*o,e[10]=n[10]*o,this}}(),makeRotationFromEuler:function(S){S&&S.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,e=S.x,n=S.y,i=S.z,r=Cc(e),E=Pc(e),T=Cc(n),M=Pc(n),P=Cc(i),c=Pc(i);if("XYZ"===S.order){var C=r*P,u=r*c,p=E*P,d=E*c;t[0]=T*P,t[4]=-T*c,t[8]=M,t[1]=u+p*M,t[5]=C-d*M,t[9]=-E*T,t[2]=d-C*M,t[6]=p+u*M,t[10]=r*T}else if("YXZ"===S.order){var f=T*P,m=T*c,_=M*P,g=M*c;t[0]=f+g*E,t[4]=_*E-m,t[8]=r*M,t[1]=r*c,t[5]=r*P,t[9]=-E,t[2]=m*E-_,t[6]=g+f*E,t[10]=r*T}else if("ZXY"===S.order){var f=T*P,m=T*c,_=M*P,g=M*c;t[0]=f-g*E,t[4]=-r*c,t[8]=_+m*E,t[1]=m+_*E,t[5]=r*P,t[9]=g-f*E,t[2]=-r*M,t[6]=E,t[10]=r*T}else if("ZYX"===S.order){var C=r*P,u=r*c,p=E*P,d=E*c;t[0]=T*P,t[4]=p*M-u,t[8]=C*M+d,t[1]=T*c,t[5]=d*M+C,t[9]=u*M-p,t[2]=-M,t[6]=E*T,t[10]=r*T}else if("YZX"===S.order){var y=r*T,v=r*M,b=E*T,w=E*M;t[0]=T*P,t[4]=w-y*c,t[8]=b*c+v,t[1]=c,t[5]=r*P,t[9]=-E*P,t[2]=-M*P,t[6]=v*c+b,t[10]=y-w*c}else if("XZY"===S.order){var y=r*T,v=r*M,b=E*T,w=E*M;t[0]=T*P,t[4]=-c,t[8]=M*P,t[1]=y*c+w,t[5]=r*P,t[9]=v*c-b,t[2]=b*c-v,t[6]=E*P,t[10]=w*c+y}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(y){var t=this.elements,e=y._x,n=y._y,i=y._z,r=y._w,o=e+e,a=n+n,s=i+i,l=e*o,c=e*a,h=e*s,u=n*a,p=n*s,d=i*s,f=r*o,m=r*a,_=r*s;return t[0]=1-(u+d),t[4]=c-_,t[8]=h+m,t[1]=c+_,t[5]=1-(l+d),t[9]=p-f,t[2]=h-m,t[6]=p+f,t[10]=1-(l+u),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var l=new nl,t=new nl,e=new nl;return function(n,i,r){var o=this.elements;return e.subVectors(n,i),0===e.lengthSq()&&(e.z=1),e.normalize(),l.crossVectors(r,e),0===l.lengthSq()&&(1===B(r.z)?e.x+=1e-4:e.z+=1e-4,e.normalize(),l.crossVectors(r,e)),l.normalize(),t.crossVectors(e,l),o[0]=l.x,o[4]=t.x,o[8]=e.x,o[1]=l.y,o[5]=t.y,o[9]=e.y,o[2]=l.z,o[6]=t.z,o[10]=e.z,this}}(),multiply:function(a,t){return void 0===t?this.multiplyMatrices(this,a):(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(a,t))},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(N,t){var e=N.elements,n=t.elements,i=this.elements,r=e[0],o=e[4],a=e[8],s=e[12],l=e[1],c=e[5],h=e[9],u=e[13],p=e[2],d=e[6],f=e[10],m=e[14],_=e[3],g=e[7],y=e[11],v=e[15],b=n[0],w=n[4],x=n[8],S=n[12],E=n[1],M=n[5],T=n[9],A=n[13],P=n[2],I=n[6],C=n[10],L=n[14],R=n[3],k=n[7],D=n[11],U=n[15];return i[0]=r*b+o*E+a*P+s*R,i[4]=r*w+o*M+a*I+s*k,i[8]=r*x+o*T+a*C+s*D,i[12]=r*S+o*A+a*L+s*U,i[1]=l*b+c*E+h*P+u*R,i[5]=l*w+c*M+h*I+u*k,i[9]=l*x+c*T+h*C+u*D,i[13]=l*S+c*A+h*L+u*U,i[2]=p*b+d*E+f*P+m*R,i[6]=p*w+d*M+f*I+m*k,i[10]=p*x+d*T+f*C+m*D,i[14]=p*S+d*A+f*L+m*U,i[3]=_*b+g*E+y*P+v*R,i[7]=_*w+g*M+y*I+v*k,i[11]=_*x+g*T+y*C+v*D,i[15]=_*S+g*A+y*L+v*U,this},multiplyScalar:function(a){var t=this.elements;return t[0]*=a,t[4]*=a,t[8]*=a,t[12]*=a,t[1]*=a,t[5]*=a,t[9]*=a,t[13]*=a,t[2]*=a,t[6]*=a,t[10]*=a,t[14]*=a,t[3]*=a,t[7]*=a,t[11]*=a,t[15]*=a,this},applyToBufferAttribute:function(){var a=new nl;return function(t){for(var e=0,o=t.count;e<o;e++)a.x=t.getX(e),a.y=t.getY(e),a.z=t.getZ(e),a.applyMatrix4(this),t.setXYZ(e,a.x,a.y,a.z);return t}}(),determinant:function(){var d=this.elements,t=d[0],m=d[4],n=d[8],_=d[12],g=d[1],o=d[5],a=d[9],s=d[13],l=d[2],c=d[6],h=d[10],u=d[14];return d[3]*(+_*a*c-n*s*c-_*o*h+m*s*h+n*o*u-m*a*u)+d[7]*(+t*a*u-t*s*h+_*g*h-n*g*u+n*s*l-_*a*l)+d[11]*(+t*s*c-t*o*u-_*g*c+m*g*u+_*o*l-m*s*l)+d[15]*(-n*o*l-t*a*c+t*o*h+n*g*c-m*g*h+m*a*l)},transpose:function(){var a=this.elements,e;return e=a[1],a[1]=a[4],a[4]=e,e=a[2],a[2]=a[8],a[8]=e,e=a[6],a[6]=a[9],a[9]=e,e=a[3],a[3]=a[12],a[12]=e,e=a[7],a[7]=a[13],a[13]=e,e=a[11],a[11]=a[14],a[14]=e,this},setPosition:function(a){var t=this.elements;return t[12]=a.x,t[13]=a.y,t[14]=a.z,this},getInverse:function(P,t){var e=this.elements,n=P.elements,i=n[0],r=n[1],o=n[2],a=n[3],s=n[4],l=n[5],c=n[6],h=n[7],u=n[8],p=n[9],d=n[10],f=n[11],m=n[12],_=n[13],g=n[14],y=n[15],v=p*g*h-_*d*h+_*c*f-l*g*f-p*c*y+l*d*y,b=m*d*h-u*g*h-m*c*f+s*g*f+u*c*y-s*d*y,w=u*_*h-m*p*h+m*l*f-s*_*f-u*l*y+s*p*y,x=m*p*c-u*_*c-m*l*d+s*_*d+u*l*g-s*p*g,S=i*v+r*b+o*w+a*x;if(0===S){var E="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(E);return console.warn(E),this.identity()}var M=1/S;return e[0]=v*M,e[1]=(_*d*a-p*g*a-_*o*f+r*g*f+p*o*y-r*d*y)*M,e[2]=(l*g*a-_*c*a+_*o*h-r*g*h-l*o*y+r*c*y)*M,e[3]=(p*c*a-l*d*a-p*o*h+r*d*h+l*o*f-r*c*f)*M,e[4]=b*M,e[5]=(u*g*a-m*d*a+m*o*f-i*g*f-u*o*y+i*d*y)*M,e[6]=(m*c*a-s*g*a-m*o*h+i*g*h+s*o*y-i*c*y)*M,e[7]=(s*d*a-u*c*a+u*o*h-i*d*h-s*o*f+i*c*f)*M,e[8]=w*M,e[9]=(m*p*a-u*_*a-m*r*f+i*_*f+u*r*y-i*p*y)*M,e[10]=(s*_*a-m*l*a+m*r*h-i*_*h-s*r*y+i*l*y)*M,e[11]=(u*l*a-s*p*a-u*r*h+i*p*h+s*r*f-i*l*f)*M,e[12]=x*M,e[13]=(u*_*o-m*p*o+m*r*d-i*_*d-u*r*g+i*p*g)*M,e[14]=(m*l*o-s*_*o-m*r*c+i*_*c+s*r*g-i*l*g)*M,e[15]=(s*p*o-u*l*o+u*r*c-i*p*c-s*r*d+i*l*d)*M,this},scale:function(a){var t=this.elements,e=a.x,o=a.y,n=a.z;return t[0]*=e,t[4]*=o,t[8]*=n,t[1]*=e,t[5]*=o,t[9]*=n,t[2]*=e,t[6]*=o,t[10]*=n,t[3]*=e,t[7]*=o,t[11]*=n,this},getMaxScaleOnAxis:function(){var a=this.elements,t=a[0]*a[0]+a[1]*a[1]+a[2]*a[2],e=a[4]*a[4]+a[5]*a[5]+a[6]*a[6],o=a[8]*a[8]+a[9]*a[9]+a[10]*a[10];return N(C(t,e,o))},makeTranslation:function(a,t,e){return this.set(1,0,0,a,0,1,0,t,0,0,1,e,0,0,0,1),this},makeRotationX:function(a){var t=Cc(a),e=Pc(a);return this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this},makeRotationY:function(a){var t=Cc(a),e=Pc(a);return this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this},makeRotationZ:function(a){var t=Cc(a),e=Pc(a);return this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(d,t){var e=Cc(t),n=Pc(t),i=1-e,r=d.x,o=d.y,a=d.z,s=i*r,l=i*o;return this.set(s*r+e,s*o-n*a,s*a+n*o,0,s*o+n*a,l*o+e,l*a-n*r,0,s*a-n*o,l*a+n*r,i*a*a+e,0,0,0,0,1),this},makeScale:function(a,t,e){return this.set(a,0,0,0,0,t,0,0,0,0,e,0,0,0,0,1),this},makeShear:function(a,t,e){return this.set(1,t,e,0,a,1,e,0,a,t,1,0,0,0,0,1),this},compose:function(a,t,e){return this.makeRotationFromQuaternion(t),this.scale(e),this.setPosition(a),this},decompose:function(){var d=new nl,t=new il;return function(e,n,i){var r=this.elements,o=d.set(r[0],r[1],r[2]).length(),p=d.set(r[4],r[5],r[6]).length(),s=d.set(r[8],r[9],r[10]).length();0>this.determinant()&&(o=-o),e.x=r[12],e.y=r[13],e.z=r[14],t.copy(this);var l=1/o,c=1/p,m=1/s;return t.elements[0]*=l,t.elements[1]*=l,t.elements[2]*=l,t.elements[4]*=c,t.elements[5]*=c,t.elements[6]*=c,t.elements[8]*=m,t.elements[9]*=m,t.elements[10]*=m,n.setFromRotationMatrix(t),i.x=o,i.y=p,i.z=s,this}}(),makePerspective:function(l,t,e,n,i,r){void 0===r&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements;return o[0]=2*i/(t-l),o[4]=0,o[8]=(t+l)/(t-l),o[12]=0,o[1]=0,o[5]=2*i/(e-n),o[9]=(e+n)/(e-n),o[13]=0,o[2]=0,o[6]=0,o[10]=-(r+i)/(r-i),o[14]=-2*r*i/(r-i),o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(d,t,e,n,i,r){var o=this.elements,a=1/(t-d),s=1/(e-n),l=1/(r-i);return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-((t+d)*a),o[1]=0,o[5]=2*s,o[9]=0,o[13]=-((e+n)*s),o[2]=0,o[6]=0,o[10]=-2*l,o[14]=-((r+i)*l),o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(a){for(var t=this.elements,e=a.elements,o=0;16>o;o++)if(t[o]!==e[o])return!1;return!0},fromArray:function(a,t){void 0===t&&(t=0);for(var e=0;16>e;e++)this.elements[e]=a[e+t];return this},toArray:function(a,t){void 0===a&&(a=[]),void 0===t&&(t=0);var e=this.elements;return a[t]=e[0],a[t+1]=e[1],a[t+2]=e[2],a[t+3]=e[3],a[t+4]=e[4],a[t+5]=e[5],a[t+6]=e[6],a[t+7]=e[7],a[t+8]=e[8],a[t+9]=e[9],a[t+10]=e[10],a[t+11]=e[11],a[t+12]=e[12],a[t+13]=e[13],a[t+14]=e[14],a[t+15]=e[15],a}}),l.prototype=Object.create(tl.prototype),l.prototype.constructor=l,l.prototype.isDataTexture=!0,(c.prototype=Object.create(tl.prototype)).constructor=c,c.prototype.isCubeTexture=!0,Object.defineProperty(c.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}});var Ra=new tl,ka=new c,Da=[],Oa=[],Fa=new Float32Array(16),Ua=new Float32Array(9);H.prototype.setValue=function(a,t){for(var e=this.seq,n=0,i=e.length,r;n!==i;++n)r=e[n],r.setValue(a,t[r.id])};var Na=/([\w\d_]+)(\])?(\[|\.)?/g;q.prototype.setValue=function(a,t,e){var o=this.map[t];void 0!==o&&o.setValue(a,e,this.renderer)},q.prototype.setOptional=function(a,t,e){var o=t[e];void 0!==o&&this.setValue(a,e,o)},q.upload=function(l,t,e,n){for(var i=0,r=t.length;i!==r;++i){var o=t[i],a=e[o.id];!1!==a.needsUpdate&&o.setValue(l,a.value,n)}},q.seqWithValue=function(a,t){for(var e=[],n=0,i=a.length,r;n!==i;++n)r=a[n],r.id in t&&e.push(r);return e};var Ba={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Object.assign(X.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=z(e),this.r=(255&e>>16)/255,this.g=(255&e>>8)/255,this.b=(255&e)/255,this},setRGB:function(a,t,e){return this.r=a,this.g=t,this.b=e,this},setHSL:function(){function a(a,o,e){return 0>e&&(e+=1),1<e&&(e-=1),e<1/6?a+6*(o-a)*e:.5>e?o:e<2/3?a+6*(o-a)*(2/3-e):a}return function(t,e,n){if(t=rd.euclideanModulo(t,1),e=rd.clamp(e,0,1),n=rd.clamp(n,0,1),0===e)this.r=this.g=this.b=n;else{var i=.5>=n?n*(1+e):n+e-n*e,r=2*n-i;this.r=a(r,i,t+1/3),this.g=a(r,i,t),this.b=a(r,i,t-1/3)}return this}}(),setStyle:function(d){function t(t){void 0!==t&&1>parseFloat(t)&&console.warn("THREE.Color: Alpha component of "+d+" will be ignored.")}var e;if(e=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(d)){var n=e[1],r=e[2],o;switch(n){case"rgb":case"rgba":if(o=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r))return this.r=U(255,parseInt(o[1],10))/255,this.g=U(255,parseInt(o[2],10))/255,this.b=U(255,parseInt(o[3],10))/255,t(o[5]),this;if(o=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r))return this.r=U(100,parseInt(o[1],10))/100,this.g=U(100,parseInt(o[2],10))/100,this.b=U(100,parseInt(o[3],10))/100,t(o[5]),this;break;case"hsl":case"hsla":if(o=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r)){var i=parseFloat(o[1])/360,a=parseInt(o[2],10)/100,s=parseInt(o[3],10)/100;return t(o[5]),this.setHSL(i,a,s)}}}else if(e=/^\#([A-Fa-f0-9]+)$/.exec(d)){var l=(c=e[1]).length;if(3===l)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===l)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}if(d&&0<d.length){var c=Ba[d];void 0===c?console.warn("THREE.Color: Unknown color "+d):this.setHex(c)}return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(a,t){return void 0===t&&(t=2),this.r=S(a.r,t),this.g=S(a.g,t),this.b=S(a.b,t),this},copyLinearToGamma:function(a,t){void 0===t&&(t=2);var e=0<t?1/t:1;return this.r=S(a.r,e),this.g=S(a.g,e),this.b=S(a.b,e),this},convertGammaToLinear:function(){var a=this.r,t=this.g,e=this.b;return this.r=a*a,this.g=t*t,this.b=e*e,this},convertLinearToGamma:function(){return this.r=N(this.r),this.g=N(this.g),this.b=N(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(d){var t=d||{h:0,s:0,l:0},i=this.r,r=this.g,o=this.b,a=C(i,r,o),s=U(i,r,o),l=(s+a)/2,c,e;if(s===a)c=0,e=0;else{var n=a-s;switch(e=.5>=l?n/(a+s):n/(2-a-s),a){case i:c=(r-o)/n+(r<o?6:0);break;case r:c=(o-i)/n+2;break;case o:c=(i-r)/n+4;}c/=6}return t.h=c,t.s=e,t.l=l,t},getStyle:function(){return"rgb("+(0|255*this.r)+","+(0|255*this.g)+","+(0|255*this.b)+")"},offsetHSL:function(a,t,e){var o=this.getHSL();return o.h+=a,o.s+=t,o.l+=e,this.setHSL(o.h,o.s,o.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(a,t){return this.r=a.r+t.r,this.g=a.g+t.g,this.b=a.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=C(0,this.r-e.r),this.g=C(0,this.g-e.g),this.b=C(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(a,t){return this.r+=(a.r-this.r)*t,this.g+=(a.g-this.g)*t,this.b+=(a.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(a,t){return void 0===t&&(t=0),this.r=a[t],this.g=a[t+1],this.b=a[t+2],this},toArray:function(a,t){return void 0===a&&(a=[]),void 0===t&&(t=0),a[t]=this.r,a[t+1]=this.g,a[t+2]=this.b,a},toJSON:function(){return this.getHex()}});var za={common:{diffuse:{value:new X(15658734)},opacity:{value:1},map:{value:null},offsetRepeat:{value:new al(0,0,1,1)},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new el(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new X(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new X(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},offsetRepeat:{value:new al(0,0,1,1)}}},Ga={merge:function(a){for(var t={},e=0,o;e<a.length;e++)for(var n in o=this.clone(a[e]),o)t[n]=o[n];return t},clone:function(a){var t={};for(var e in a)for(var o in t[e]={},a[e]){var n=a[e][o];t[e][o]=n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture)?n.clone():Array.isArray(n)?n.slice():n}return t}},ja={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t}\n\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat theta = acos( dot( N, V ) );\n\tvec2 uv = vec2(\n\t\tsqrt( saturate( roughness ) ),\n\t\tsaturate( theta / ( 0.5 * PI ) ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.86267 + (0.49788 + 0.01436 * y ) * y;\n\tfloat b = 3.45068 + (4.18814 + y) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = (x > 0.0) ? v : 0.5 * inversesqrt( 1.0 - x * x ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transpose( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tvec3 result = vec3( LTC_ClippedSphereFormFactor( vectorFormFactor ) );\n\treturn result;\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; ++ i ) {\n\t\tvec4 plane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t\t\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; ++ i ) {\n\t\t\tvec4 plane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t\n\t#endif\n#endif\n",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transpose( const in mat3 v ) {\n\tmat3 tmp;\n\ttmp[0] = vec3(v[0].x, v[1].x, v[2].x);\n\ttmp[1] = vec3(v[0].y, v[1].y, v[2].y);\n\ttmp[2] = vec3(v[0].z, v[1].z, v[2].z);\n\treturn tmp;\n}\n",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}\n",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\nfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n  varying float fogDepth;\n#endif\n",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",lights_pars:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltcMat;\tuniform sampler2D ltcMag;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tfloat norm = texture2D( ltcMag, uv ).a;\n\t\tvec4 t = texture2D( ltcMat, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3(   1,   0, t.y ),\n\t\t\tvec3(   0, t.z,   0 ),\n\t\t\tvec3( t.w,   0, t.x )\n\t\t);\n\t\treflectedLight.directSpecular += lightColor * material.specularColor * norm * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",lights_template:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\n\t#endif\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\n\t#ifndef STANDARD\n\t\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\n\t#else\n\t\tvec3 clearCoatRadiance = vec3( 0.0 );\n\t#endif\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",logdepthbuf_fragment:"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\t#endif\n#endif\n",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n#endif\n",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",normal_fragment:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n#endif\n#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 1.0 - 2.0 * rgb.xyz;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif\n",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif\n",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif\n",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#define saturate(a) clamp( a, 0.0, 1.0 )\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n#endif\n",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( PHYSICAL ) || defined( LAMBERT ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}\n",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}\n",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <bsdfs>\n#include <lights_pars>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n}\n",shadow_vert:"#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n"},Ha={basic:{uniforms:Ga.merge([za.common,za.specularmap,za.envmap,za.aomap,za.lightmap,za.fog]),vertexShader:ja.meshbasic_vert,fragmentShader:ja.meshbasic_frag},lambert:{uniforms:Ga.merge([za.common,za.specularmap,za.envmap,za.aomap,za.lightmap,za.emissivemap,za.fog,za.lights,{emissive:{value:new X(0)}}]),vertexShader:ja.meshlambert_vert,fragmentShader:ja.meshlambert_frag},phong:{uniforms:Ga.merge([za.common,za.specularmap,za.envmap,za.aomap,za.lightmap,za.emissivemap,za.bumpmap,za.normalmap,za.displacementmap,za.gradientmap,za.fog,za.lights,{emissive:{value:new X(0)},specular:{value:new X(1118481)},shininess:{value:30}}]),vertexShader:ja.meshphong_vert,fragmentShader:ja.meshphong_frag},standard:{uniforms:Ga.merge([za.common,za.envmap,za.aomap,za.lightmap,za.emissivemap,za.bumpmap,za.normalmap,za.displacementmap,za.roughnessmap,za.metalnessmap,za.fog,za.lights,{emissive:{value:new X(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:ja.meshphysical_vert,fragmentShader:ja.meshphysical_frag},points:{uniforms:Ga.merge([za.points,za.fog]),vertexShader:ja.points_vert,fragmentShader:ja.points_frag},dashed:{uniforms:Ga.merge([za.common,za.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ja.linedashed_vert,fragmentShader:ja.linedashed_frag},depth:{uniforms:Ga.merge([za.common,za.displacementmap]),vertexShader:ja.depth_vert,fragmentShader:ja.depth_frag},normal:{uniforms:Ga.merge([za.common,za.bumpmap,za.normalmap,za.displacementmap,{opacity:{value:1}}]),vertexShader:ja.normal_vert,fragmentShader:ja.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ja.cube_vert,fragmentShader:ja.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ja.equirect_vert,fragmentShader:ja.equirect_frag},distanceRGBA:{uniforms:Ga.merge([za.common,za.displacementmap,{referencePosition:{value:new nl},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ja.distanceRGBA_vert,fragmentShader:ja.distanceRGBA_frag},shadow:{uniforms:Ga.merge([za.lights,{color:{value:new X(0)},opacity:{value:1}}]),vertexShader:ja.shadow_vert,fragmentShader:ja.shadow_frag}};Ha.physical={uniforms:Ga.merge([Ha.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:ja.meshphysical_vert,fragmentShader:ja.meshphysical_frag},Object.assign(Y.prototype,{set:function(a,t){return this.min.copy(a),this.max.copy(t),this},setFromPoints:function(a){this.makeEmpty();for(var t=0,e=a.length;t<e;t++)this.expandByPoint(a[t]);return this},setFromCenterAndSize:function(){var a=new el;return function(t,e){var o=a.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(o),this.max.copy(t).add(o),this}}(),clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(a){var t=a||new el;return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(a){var t=a||new el;return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(a,t){return(t||new el).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(a,t){return(t||new el).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new el;return function(t){return a.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Z.prototype=Object.create(tl.prototype),Z.prototype.constructor=Z;var Va=0;Object.assign(K.prototype,n.prototype,{isMaterial:!0,onBeforeCompile:function(){},setValues:function(a){if(void 0!==a)for(var t in a){var e=a[t];if(!(void 0!==e))console.warn("THREE.Material: '"+t+"' parameter is undefined.");else if("shading"!==t){var o=this[t];void 0===o?console.warn("THREE."+this.type+": '"+t+"' is not a property of this material."):o&&o.isColor?o.set(e):o&&o.isVector3&&e&&e.isVector3?o.copy(e):this[t]="overdraw"===t?+e:e}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}},toJSON:function(a){function t(a){var t=[];for(var o in a){var r=a[o];delete r.metadata,t.push(r)}return t}var e=void 0===a;e&&(a={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearCoat&&(n.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(n.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(a).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(a).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(a).uuid),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(a).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(a).uuid,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(a).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(a).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(a).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(a).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(a).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(a).uuid,n.reflectivity=this.reflectivity),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(a).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==Dc&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),this.side!==Or&&(n.side=this.side),this.vertexColors!==Nr&&(n.vertexColors=this.vertexColors),1>this.opacity&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,!0===this.dithering&&(n.dithering=!0),0<this.alphaTest&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),1<this.wireframeLinewidth&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e){var i=t(a.textures),r=t(a.images);0<i.length&&(n.textures=i),0<r.length&&(n.images=r)}return n},clone:function(){return new this.constructor().copy(this)},copy:function(a){this.name=a.name,this.fog=a.fog,this.lights=a.lights,this.blending=a.blending,this.side=a.side,this.flatShading=a.flatShading,this.vertexColors=a.vertexColors,this.opacity=a.opacity,this.transparent=a.transparent,this.blendSrc=a.blendSrc,this.blendDst=a.blendDst,this.blendEquation=a.blendEquation,this.blendSrcAlpha=a.blendSrcAlpha,this.blendDstAlpha=a.blendDstAlpha,this.blendEquationAlpha=a.blendEquationAlpha,this.depthFunc=a.depthFunc,this.depthTest=a.depthTest,this.depthWrite=a.depthWrite,this.colorWrite=a.colorWrite,this.precision=a.precision,this.polygonOffset=a.polygonOffset,this.polygonOffsetFactor=a.polygonOffsetFactor,this.polygonOffsetUnits=a.polygonOffsetUnits,this.dithering=a.dithering,this.alphaTest=a.alphaTest,this.premultipliedAlpha=a.premultipliedAlpha,this.overdraw=a.overdraw,this.visible=a.visible,this.userData=JSON.parse(JSON.stringify(a.userData)),this.clipShadows=a.clipShadows,this.clipIntersection=a.clipIntersection;var t=a.clippingPlanes,e=null;if(null!==t){var o=t.length;e=Array(o);for(var n=0;n!==o;++n)e[n]=t[n].clone()}return this.clippingPlanes=e,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Q.prototype=Object.create(K.prototype),Q.prototype.constructor=Q,Q.prototype.isShaderMaterial=!0,Q.prototype.copy=function(e){return K.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Ga.clone(e.uniforms),this.defines=e.defines,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},Q.prototype.toJSON=function(a){var t=K.prototype.toJSON.call(this,a);return t.uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t},ml.prototype=Object.create(K.prototype),ml.prototype.constructor=ml,ml.prototype.isMeshDepthMaterial=!0,ml.prototype.copy=function(e){return K.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},_l.prototype=Object.create(K.prototype),_l.prototype.constructor=_l,_l.prototype.isMeshDistanceMaterial=!0,_l.prototype.copy=function(e){return K.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},Object.assign(hl.prototype,{isBox3:!0,set:function(a,t){return this.min.copy(a),this.max.copy(t),this},setFromArray:function(d){for(var t=1/0,e=1/0,n=1/0,i=-1/0,r=-1/0,o=-1/0,a=0,s=d.length;a<s;a+=3){var l=d[a],c=d[a+1],p=d[a+2];l<t&&(t=l),c<e&&(e=c),p<n&&(n=p),l>i&&(i=l),c>r&&(r=c),p>o&&(o=p)}return this.min.set(t,e,n),this.max.set(i,r,o),this},setFromBufferAttribute:function(d){for(var t=1/0,e=1/0,n=1/0,i=-1/0,r=-1/0,o=-1/0,a=0,s=d.count;a<s;a++){var l=d.getX(a),c=d.getY(a),p=d.getZ(a);l<t&&(t=l),c<e&&(e=c),p<n&&(n=p),l>i&&(i=l),c>r&&(r=c),p>o&&(o=p)}return this.min.set(t,e,n),this.max.set(i,r,o),this},setFromPoints:function(a){this.makeEmpty();for(var t=0,e=a.length;t<e;t++)this.expandByPoint(a[t]);return this},setFromCenterAndSize:function(){var a=new nl;return function(t,e){var o=a.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(o),this.max.copy(t).add(o),this}}(),setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(a){var t=a||new nl;return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(a){var t=a||new nl;return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(){var o=new nl;return function(t){var l=this;return t.updateMatrixWorld(!0),t.traverse(function(t){var e=t.geometry,n,i;if(void 0!==e)if(e.isGeometry){var r=e.vertices;for(n=0,i=r.length;n<i;n++)o.copy(r[n]),o.applyMatrix4(t.matrixWorld),l.expandByPoint(o)}else if(e.isBufferGeometry){var a=e.attributes.position;if(void 0!==a)for(n=0,i=a.count;n<i;n++)o.fromBufferAttribute(a,n).applyMatrix4(t.matrixWorld),l.expandByPoint(o)}}),this}}(),containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(a,t){return(t||new nl).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(){var a=new nl;return function(t){return this.clampPoint(t.center,a),a.distanceToSquared(t.center)<=t.radius*t.radius}}(),intersectsPlane:function(a){var t,e;return 0<a.normal.x?(t=a.normal.x*this.min.x,e=a.normal.x*this.max.x):(t=a.normal.x*this.max.x,e=a.normal.x*this.min.x),0<a.normal.y?(t+=a.normal.y*this.min.y,e+=a.normal.y*this.max.y):(t+=a.normal.y*this.max.y,e+=a.normal.y*this.min.y),0<a.normal.z?(t+=a.normal.z*this.min.z,e+=a.normal.z*this.max.z):(t+=a.normal.z*this.max.z,e+=a.normal.z*this.min.z),t<=a.constant&&e>=a.constant},clampPoint:function(a,t){return(t||new nl).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new nl;return function(t){return a.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var a=new nl;return function(t){var e=t||new it;return this.getCenter(e.center),e.radius=.5*this.getSize(a).length(),e}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var a=[new nl,new nl,new nl,new nl,new nl,new nl,new nl,new nl];return function(t){return this.isEmpty()?this:(a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(a),this)}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(it.prototype,{set:function(a,t){return this.center.copy(a),this.radius=t,this},setFromPoints:function(){var l=new hl;return function(t,e){var n=this.center;void 0===e?l.setFromPoints(t).getCenter(n):n.copy(e);for(var i=0,r=0,o=t.length;r<o;r++)i=C(i,n.distanceToSquared(t[r]));return this.radius=N(i),this}}(),clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return 0>=this.radius},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(a){var t=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return B(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(a,t){var e=this.center.distanceToSquared(a),o=t||new nl;return o.copy(a),e>this.radius*this.radius&&(o.sub(this.center).normalize(),o.multiplyScalar(this.radius).add(this.center)),o},getBoundingBox:function(a){var t=a||new hl;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius*=e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}),Object.assign(rt.prototype,{isMatrix3:!0,set:function(d,t,e,n,i,r,o,a,s){var l=this.elements;return l[0]=d,l[1]=n,l[2]=o,l[3]=t,l[4]=i,l[5]=a,l[6]=e,l[7]=r,l[8]=s,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return new this.constructor().fromArray(this.elements)},copy:function(a){var t=this.elements,e=a.elements;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],this},setFromMatrix4:function(a){var t=a.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToBufferAttribute:function(){var a=new nl;return function(t){for(var e=0,o=t.count;e<o;e++)a.x=t.getX(e),a.y=t.getY(e),a.z=t.getZ(e),a.applyMatrix3(this),t.setXYZ(e,a.x,a.y,a.z);return t}}(),multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(S,t){var e=S.elements,n=t.elements,i=this.elements,r=e[0],o=e[3],a=e[6],s=e[1],l=e[4],c=e[7],h=e[2],u=e[5],p=e[8],d=n[0],f=n[3],m=n[6],_=n[1],g=n[4],y=n[7],v=n[2],b=n[5],w=n[8];return i[0]=r*d+o*_+a*v,i[3]=r*f+o*g+a*b,i[6]=r*m+o*y+a*w,i[1]=s*d+l*_+c*v,i[4]=s*f+l*g+c*b,i[7]=s*m+l*y+c*w,i[2]=h*d+u*_+p*v,i[5]=h*f+u*g+p*b,i[8]=h*m+u*y+p*w,this},multiplyScalar:function(a){var t=this.elements;return t[0]*=a,t[3]*=a,t[6]*=a,t[1]*=a,t[4]*=a,t[7]*=a,t[2]*=a,t[5]*=a,t[8]*=a,this},determinant:function(){var d=this.elements,t=d[0],e=d[1],n=d[2],i=d[3],r=d[4],o=d[5],a=d[6],s=d[7],l=d[8];return t*r*l-t*o*s-e*i*l+e*o*a+n*i*s-n*r*a},getInverse:function(b,t){b&&b.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var e=b.elements,n=this.elements,i=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=e[6],h=e[7],u=e[8],p=u*s-l*h,d=l*c-u*a,f=h*a-s*c,m=i*p+r*d+o*f;if(0===m){var _="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(_);return console.warn(_),this.identity()}var g=1/m;return n[0]=p*g,n[1]=(o*h-u*r)*g,n[2]=(l*r-o*s)*g,n[3]=d*g,n[4]=(u*i-o*c)*g,n[5]=(o*a-l*i)*g,n[6]=f*g,n[7]=(r*c-h*i)*g,n[8]=(s*i-r*a)*g,this},transpose:function(){var a=this.elements,e;return e=a[1],a[1]=a[3],a[3]=e,e=a[2],a[2]=a[6],a[6]=e,e=a[5],a[5]=a[7],a[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(a){var t=this.elements;return a[0]=t[0],a[1]=t[3],a[2]=t[6],a[3]=t[1],a[4]=t[4],a[5]=t[7],a[6]=t[2],a[7]=t[5],a[8]=t[8],this},equals:function(a){for(var t=this.elements,e=a.elements,o=0;9>o;o++)if(t[o]!==e[o])return!1;return!0},fromArray:function(a,t){void 0===t&&(t=0);for(var e=0;9>e;e++)this.elements[e]=a[e+t];return this},toArray:function(a,t){void 0===a&&(a=[]),void 0===t&&(t=0);var e=this.elements;return a[t]=e[0],a[t+1]=e[1],a[t+2]=e[2],a[t+3]=e[3],a[t+4]=e[4],a[t+5]=e[5],a[t+6]=e[6],a[t+7]=e[7],a[t+8]=e[8],a}}),Object.assign(ot.prototype,{set:function(a,t){return this.normal.copy(a),this.constant=t,this},setComponents:function(a,t,e,o){return this.normal.set(a,t,e),this.constant=o,this},setFromNormalAndCoplanarPoint:function(a,t){return this.normal.copy(a),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var a=new nl,t=new nl;return function(e,n,i){var r=a.subVectors(i,n).cross(t.subVectors(e,n)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}}(),clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(a,t){return(t||new nl).copy(this.normal).multiplyScalar(-this.distanceToPoint(a)).add(a)},intersectLine:function(){var l=new nl;return function(t,e){var n=e||new nl,i=t.delta(l),r=this.normal.dot(i);if(0!==r){var o=-(t.start.dot(this.normal)+this.constant)/r;if(!(0>o||1<o))return n.copy(i).multiplyScalar(o).add(t.start)}else if(0===this.distanceToPoint(t.start))return n.copy(t.start)}}(),intersectsLine:function(a){var t=this.distanceToPoint(a.start),e=this.distanceToPoint(a.end);return 0>t&&0<e||0>e&&0<t},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return(e||new nl).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var l=new nl,t=new rt;return function(e,n){var i=n||t.getNormalMatrix(e),r=this.coplanarPoint(l).applyMatrix4(e),o=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(o),this}}(),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}),Object.assign(gl.prototype,{set:function(l,t,e,n,i,r){var o=this.planes;return o[0].copy(l),o[1].copy(t),o[2].copy(e),o[3].copy(n),o[4].copy(i),o[5].copy(r),this},clone:function(){return new this.constructor().copy(this)},copy:function(a){for(var t=this.planes,e=0;6>e;e++)t[e].copy(a.planes[e]);return this},setFromMatrix:function(b){var t=this.planes,e=b.elements,n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],l=e[6],c=e[7],h=e[8],u=e[9],p=e[10],d=e[11],f=e[12],m=e[13],_=e[14],g=e[15];return t[0].setComponents(o-n,c-a,d-h,g-f).normalize(),t[1].setComponents(o+n,c+a,d+h,g+f).normalize(),t[2].setComponents(o+i,c+s,d+u,g+m).normalize(),t[3].setComponents(o-i,c-s,d-u,g-m).normalize(),t[4].setComponents(o-r,c-l,d-p,g-_).normalize(),t[5].setComponents(o+r,c+l,d+p,g+_).normalize(),this},intersectsObject:function(){var a=new it;return function(t){var e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),a.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(a)}}(),intersectsSprite:function(){var a=new it;return function(t){return a.center.set(0,0,0),a.radius=.7071067811865476,a.applyMatrix4(t.matrixWorld),this.intersectsSphere(a)}}(),intersectsSphere:function(a){for(var t=this.planes,e=a.center,o=-a.radius,n=0;6>n;n++)if(t[n].distanceToPoint(e)<o)return!1;return!0},intersectsBox:function(){var l=new nl,t=new nl;return function(e){for(var n=this.planes,i=0,r;6>i;i++){r=n[i],l.x=0<r.normal.x?e.min.x:e.max.x,t.x=0<r.normal.x?e.max.x:e.min.x,l.y=0<r.normal.y?e.min.y:e.max.y,t.y=0<r.normal.y?e.max.y:e.min.y,l.z=0<r.normal.z?e.min.z:e.max.z,t.z=0<r.normal.z?e.max.z:e.min.z;var o=r.distanceToPoint(l),a=r.distanceToPoint(t);if(0>o&&0>a)return!1}return!0}}(),containsPoint:function(a){for(var t=this.planes,e=0;6>e;e++)if(0>t[e].distanceToPoint(a))return!1;return!0}}),at.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],at.DefaultOrder="XYZ",Object.defineProperties(at.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this.onChangeCallback()}}}),Object.assign(at.prototype,{isEuler:!0,set:function(a,t,e,o){return this._x=a,this._y=t,this._z=e,this._order=o||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(m,t,e){var n=Math.asin,_=rd.clamp,i=m.elements,r=i[0],o=i[4],g=i[8],s=i[1],l=i[5],c=i[9],f=i[2],y=i[6],p=i[10];return"XYZ"===(t=t||this._order)?(this._y=n(_(g,-1,1)),.99999>B(g)?(this._x=D(-c,p),this._z=D(-o,r)):(this._x=D(y,l),this._z=0)):"YXZ"===t?(this._x=n(-_(c,-1,1)),.99999>B(c)?(this._y=D(g,p),this._z=D(s,l)):(this._y=D(-f,r),this._z=0)):"ZXY"===t?(this._x=n(_(y,-1,1)),.99999>B(y)?(this._y=D(-f,p),this._z=D(-o,l)):(this._y=0,this._z=D(s,r))):"ZYX"===t?(this._y=n(-_(f,-1,1)),.99999>B(f)?(this._x=D(y,p),this._z=D(s,r)):(this._x=0,this._z=D(-o,l))):"YZX"===t?(this._z=n(_(s,-1,1)),.99999>B(s)?(this._x=D(-c,l),this._y=D(-f,r)):(this._x=0,this._y=D(g,p))):"XZY"===t?(this._z=n(-_(o,-1,1)),.99999>B(o)?(this._x=D(y,l),this._y=D(g,r)):(this._x=D(-c,p),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==e&&this.onChangeCallback(),this},setFromQuaternion:function(){var a=new il;return function(t,e,o){return a.makeRotationFromQuaternion(t),this.setFromRotationMatrix(a,e,o)}}(),setFromVector3:function(a,t){return this.set(a.x,a.y,a.z,t||this._order)},reorder:function(){var a=new rl;return function(t){return a.setFromEuler(this),this.setFromQuaternion(a,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(a,t){return void 0===a&&(a=[]),void 0===t&&(t=0),a[t]=this._x,a[t+1]=this._y,a[t+2]=this._z,a[t+3]=this._order,a},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new nl(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(ct.prototype,{set:function(e){this.mask=0|1<<e},enable:function(e){this.mask|=0|1<<e},toggle:function(e){this.mask^=0|1<<e},disable:function(e){this.mask&=~(0|1<<e)},test:function(e){return 0!=(this.mask&e.mask)}});var Wa=0;ut.DefaultUp=new nl(0,1,0),ut.DefaultMatrixAutoUpdate=!0,Object.assign(ut.prototype,n.prototype,{isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(a,t){this.quaternion.setFromAxisAngle(a,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var a=new rl;return function(t,e){return a.setFromAxisAngle(t,e),this.quaternion.multiply(a),this}}(),rotateX:function(){var a=new nl(1,0,0);return function(t){return this.rotateOnAxis(a,t)}}(),rotateY:function(){var a=new nl(0,1,0);return function(t){return this.rotateOnAxis(a,t)}}(),rotateZ:function(){var a=new nl(0,0,1);return function(t){return this.rotateOnAxis(a,t)}}(),translateOnAxis:function(){var a=new nl;return function(t,e){return a.copy(t).applyQuaternion(this.quaternion),this.position.add(a.multiplyScalar(e)),this}}(),translateX:function(){var a=new nl(1,0,0);return function(t){return this.translateOnAxis(a,t)}}(),translateY:function(){var a=new nl(0,1,0);return function(t){return this.translateOnAxis(a,t)}}(),translateZ:function(){var a=new nl(0,0,1);return function(t){return this.translateOnAxis(a,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var a=new il;return function(t){return t.applyMatrix4(a.getInverse(this.matrixWorld))}}(),lookAt:function(){var a=new il;return function(t){this.isCamera?a.lookAt(this.position,t,this.up):a.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(a)}}(),add:function(a){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return a===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",a),this):(a&&a.isObject3D?(null!==a.parent&&a.parent.remove(a),a.parent=this,a.dispatchEvent({type:"added"}),this.children.push(a)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",a),this)},remove:function(a){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var e=this.children.indexOf(a);return-1!==e&&(a.parent=null,a.dispatchEvent({type:"removed"}),this.children.splice(e,1)),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(a,t){if(this[a]===t)return this;for(var e=0,o=this.children.length,n;e<o;e++)if(n=this.children[e].getObjectByProperty(a,t),void 0!==n)return n},getWorldPosition:function(a){var t=a||new nl;return this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var a=new nl,t=new nl;return function(e){var o=e||new rl;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(a,o,t),o}}(),getWorldRotation:function(){var a=new rl;return function(t){var e=t||new at;return this.getWorldQuaternion(a),e.setFromQuaternion(a,this.rotation.order,!1)}}(),getWorldScale:function(){var a=new nl,t=new rl;return function(e){var o=e||new nl;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(a,t,o),o}}(),getWorldDirection:function(){var a=new rl;return function(t){var e=t||new nl;return this.getWorldQuaternion(a),e.set(0,0,1).applyQuaternion(a)}}(),raycast:function(){},traverse:function(a){a(this);for(var t=this.children,e=0,o=t.length;e<o;e++)t[e].traverse(a)},traverseVisible:function(a){if(!1!==this.visible){a(this);for(var t=this.children,e=0,o=t.length;e<o;e++)t[e].traverseVisible(a)}},traverseAncestors:function(a){var t=this.parent;null!==t&&(a(t),t.traverseAncestors(a))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(a){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||a)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0);for(var t=this.children,e=0,o=t.length;e<o;e++)t[e].updateMatrixWorld(a)},toJSON:function(d){function t(t,a){return void 0===t[a.uuid]&&(t[a.uuid]=a.toJSON(d)),a.uuid}function e(a){var t=[];for(var e in a){var o=a[e];delete o.metadata,t.push(o)}return t}var n=void 0===d||""===d,i={};n&&(d={geometries:{},materials:{},textures:{},images:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r={};if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.matrix=this.matrix.toArray(),void 0!==this.geometry&&(r.geometry=t(d.geometries,this.geometry)),void 0!==this.material)if(Array.isArray(this.material)){for(var o=[],a=0,s=this.material.length;a<s;a++)o.push(t(d.materials,this.material[a]));r.material=o}else r.material=t(d.materials,this.material);if(0<this.children.length)for(r.children=[],a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(d).object);if(n){var l=e(d.geometries),c=e(d.materials),m=e(d.textures),u=e(d.images);0<l.length&&(i.geometries=l),0<c.length&&(i.materials=c),0<m.length&&(i.textures=m),0<u.length&&(i.images=u)}return i.object=r,i},clone:function(e){return new this.constructor().copy(this,e)},copy:function(a,t){if(void 0===t&&(t=!0),this.name=a.name,this.up.copy(a.up),this.position.copy(a.position),this.quaternion.copy(a.quaternion),this.scale.copy(a.scale),this.matrix.copy(a.matrix),this.matrixWorld.copy(a.matrixWorld),this.matrixAutoUpdate=a.matrixAutoUpdate,this.matrixWorldNeedsUpdate=a.matrixWorldNeedsUpdate,this.layers.mask=a.layers.mask,this.visible=a.visible,this.castShadow=a.castShadow,this.receiveShadow=a.receiveShadow,this.frustumCulled=a.frustumCulled,this.renderOrder=a.renderOrder,this.userData=JSON.parse(JSON.stringify(a.userData)),!0===t)for(var e=0,o;e<a.children.length;e++)o=a.children[e],this.add(o.clone());return this}}),pt.prototype=Object.assign(Object.create(ut.prototype),{constructor:pt,isCamera:!0,copy:function(a,t){return ut.prototype.copy.call(this,a,t),this.matrixWorldInverse.copy(a.matrixWorldInverse),this.projectionMatrix.copy(a.projectionMatrix),this},getWorldDirection:function(){var a=new rl;return function(t){var e=t||new nl;return this.getWorldQuaternion(a),e.set(0,0,-1).applyQuaternion(a)}}(),updateMatrixWorld:function(e){ut.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return new this.constructor().copy(this)}}),ht.prototype=Object.assign(Object.create(pt.prototype),{constructor:ht,isOrthographicCamera:!0,copy:function(a,t){return pt.prototype.copy.call(this,a,t),this.left=a.left,this.right=a.right,this.top=a.top,this.bottom=a.bottom,this.near=a.near,this.far=a.far,this.zoom=a.zoom,this.view=null===a.view?null:Object.assign({},a.view),this},setViewOffset:function(a,l,s,c,d,p){this.view={fullWidth:a,fullHeight:l,offsetX:s,offsetY:c,width:d,height:p},this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null,this.updateProjectionMatrix()},updateProjectionMatrix:function(){var d=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),e=(this.right+this.left)/2,n=(this.top+this.bottom)/2,i=e-d,r=e+d,o=n+t,a=n-t;if(null!==this.view){var s=this.zoom/(this.view.width/this.view.fullWidth),l=this.zoom/(this.view.height/this.view.fullHeight),c=(this.right-this.left)/this.view.width,p=(this.top-this.bottom)/this.view.height;r=(i+=c*(this.view.offsetX/s))+c*(this.view.width/s),a=(o-=p*(this.view.offsetY/l))-p*(this.view.height/l)}this.projectionMatrix.makeOrthographic(i,r,o,a,this.near,this.far)},toJSON:function(a){var t=ut.prototype.toJSON.call(this,a);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),fl.prototype=Object.assign(Object.create(pt.prototype),{constructor:fl,isPerspectiveCamera:!0,copy:function(a,t){return pt.prototype.copy.call(this,a,t),this.fov=a.fov,this.zoom=a.zoom,this.near=a.near,this.far=a.far,this.focus=a.focus,this.aspect=a.aspect,this.view=null===a.view?null:Object.assign({},a.view),this.filmGauge=a.filmGauge,this.filmOffset=a.filmOffset,this},setFocalLength:function(a){var t=.5*this.getFilmHeight()/a;this.fov=2*rd.RAD2DEG*Sc(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Pr(.5*rd.DEG2RAD*this.fov);return .5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*rd.RAD2DEG*Sc(Pr(.5*rd.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*U(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/C(this.aspect,1)},setViewOffset:function(a,l,s,c,d,p){this.aspect=a/l,this.view={fullWidth:a,fullHeight:l,offsetX:s,offsetY:c,width:d,height:p},this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null,this.updateProjectionMatrix()},updateProjectionMatrix:function(){var c=this.near,t=c*Pr(.5*rd.DEG2RAD*this.fov)/this.zoom,e=2*t,n=this.aspect*e,i=-.5*n,r=this.view;if(null!==r){var o=r.fullWidth,a=r.fullHeight;i+=r.offsetX*n/o,t-=r.offsetY*e/a,n*=r.width/o,e*=r.height/a}var s=this.filmOffset;0!==s&&(i+=c*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+n,t,t-e,c,this.far)},toJSON:function(a){var t=ut.prototype.toJSON.call(this,a);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}),Object.assign(yl.prototype,{clone:function(){return new this.constructor().copy(this)},copy:function(a){this.a=a.a,this.b=a.b,this.c=a.c,this.normal.copy(a.normal),this.color.copy(a.color),this.materialIndex=a.materialIndex;for(var t=0,e=a.vertexNormals.length;t<e;t++)this.vertexNormals[t]=a.vertexNormals[t].clone();for(var t=0,e=a.vertexColors.length;t<e;t++)this.vertexColors[t]=a.vertexColors[t].clone();return this}});var qa=0;Object.assign(gt.prototype,n.prototype,{isGeometry:!0,applyMatrix:function(l){for(var t=new rt().getNormalMatrix(l),e=0,n=this.vertices.length;e<n;e++)this.vertices[e].applyMatrix4(l);for(var e=0,n=this.faces.length,i;e<n;e++){i=this.faces[e],i.normal.applyMatrix3(t).normalize();for(var r=0,o=i.vertexNormals.length;r<o;r++)i.vertexNormals[r].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var a=new il;return function(t){return a.makeRotationX(t),this.applyMatrix(a),this}}(),rotateY:function(){var a=new il;return function(t){return a.makeRotationY(t),this.applyMatrix(a),this}}(),rotateZ:function(){var a=new il;return function(t){return a.makeRotationZ(t),this.applyMatrix(a),this}}(),translate:function(){var a=new il;return function(t,e,o){return a.makeTranslation(t,e,o),this.applyMatrix(a),this}}(),scale:function(){var a=new il;return function(t,e,o){return a.makeScale(t,e,o),this.applyMatrix(a),this}}(),lookAt:function(){var a=new ut;return function(t){a.lookAt(t),a.updateMatrix(),this.applyMatrix(a.matrix)}}(),fromBufferGeometry:function(r){function t(n,t,m,i){var r=new yl(n,t,m,void 0===a?[]:[u[n].clone(),u[t].clone(),u[m].clone()],void 0===s?[]:[h.colors[n].clone(),h.colors[t].clone(),h.colors[m].clone()],i);h.faces.push(r),void 0!==l&&h.faceVertexUvs[0].push([p[n].clone(),p[t].clone(),p[m].clone()]),void 0!==c&&h.faceVertexUvs[1].push([d[n].clone(),d[t].clone(),d[m].clone()])}var h=this,e=null===r.index?void 0:r.index.array,n=r.attributes,o=n.position.array,a=void 0===n.normal?void 0:n.normal.array,s=void 0===n.color?void 0:n.color.array,l=void 0===n.uv?void 0:n.uv.array,c=void 0===n.uv2?void 0:n.uv2.array;void 0!==c&&(this.faceVertexUvs[1]=[]);for(var u=[],p=[],d=[],i=0,m=0;i<o.length;i+=3,m+=2)h.vertices.push(new nl(o[i],o[i+1],o[i+2])),void 0!==a&&u.push(new nl(a[i],a[i+1],a[i+2])),void 0!==s&&h.colors.push(new X(s[i],s[i+1],s[i+2])),void 0!==l&&p.push(new el(l[m],l[m+1])),void 0!==c&&d.push(new el(c[m],c[m+1]));var _=r.groups;if(0<_.length)for(i=0;i<_.length;i++)for(var g=_[i],f=g.start,m=f,y=f+g.count;m<y;m+=3)void 0===e?t(m,m+1,m+2,g.materialIndex):t(e[m],e[m+1],e[m+2],g.materialIndex);else if(void 0!==e)for(i=0;i<e.length;i+=3)t(e[i],e[i+1],e[i+2]);else for(i=0;i<o.length/3;i+=3)t(i,i+1,i+2);return this.computeFaceNormals(),null!==r.boundingBox&&(this.boundingBox=r.boundingBox.clone()),null!==r.boundingSphere&&(this.boundingSphere=r.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var e=this.boundingBox.getCenter().negate();return this.translate(e.x,e.y,e.z),e},normalize:function(){this.computeBoundingSphere();var a=this.boundingSphere.center,t=this.boundingSphere.radius,e=0===t?1:1/t,o=new il;return o.set(e,0,0,-e*a.x,0,e,0,-e*a.y,0,0,e,-e*a.z,0,0,0,1),this.applyMatrix(o),this},computeFaceNormals:function(){for(var l=new nl,t=new nl,e=0,n=this.faces.length;e<n;e++){var i=this.faces[e],r=this.vertices[i.a],o=this.vertices[i.b],a=this.vertices[i.c];l.subVectors(a,o),t.subVectors(r,o),l.cross(t),l.normalize(),i.normal.copy(l)}},computeVertexNormals:function(m){void 0===m&&(m=!0);var t,e,n,i,r,o;for(o=Array(this.vertices.length),t=0,e=this.vertices.length;t<e;t++)o[t]=new nl;if(m){var a=new nl,u=new nl,p,s,l;for(n=0,i=this.faces.length;n<i;n++)r=this.faces[n],p=this.vertices[r.a],s=this.vertices[r.b],l=this.vertices[r.c],a.subVectors(l,s),u.subVectors(p,s),a.cross(u),o[r.a].add(a),o[r.b].add(a),o[r.c].add(a)}else for(this.computeFaceNormals(),n=0,i=this.faces.length;n<i;n++)o[(r=this.faces[n]).a].add(r.normal),o[r.b].add(r.normal),o[r.c].add(r.normal);for(t=0,e=this.vertices.length;t<e;t++)o[t].normalize();for(n=0,i=this.faces.length;n<i;n++){var c=(r=this.faces[n]).vertexNormals;3===c.length?(c[0].copy(o[r.a]),c[1].copy(o[r.b]),c[2].copy(o[r.c])):(c[0]=o[r.a].clone(),c[1]=o[r.b].clone(),c[2]=o[r.c].clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var a,t,e;for(this.computeFaceNormals(),a=0,t=this.faces.length;a<t;a++){var o=(e=this.faces[a]).vertexNormals;3===o.length?(o[0].copy(e.normal),o[1].copy(e.normal),o[2].copy(e.normal)):(o[0]=e.normal.clone(),o[1]=e.normal.clone(),o[2]=e.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var d,t,e,n,i;for(e=0,n=this.faces.length;e<n;e++)for((i=this.faces[e]).__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),d=0,t=i.vertexNormals.length;d<t;d++)i.__originalVertexNormals[d]?i.__originalVertexNormals[d].copy(i.vertexNormals[d]):i.__originalVertexNormals[d]=i.vertexNormals[d].clone();var r=new gt;for(r.faces=this.faces,d=0,t=this.morphTargets.length;d<t;d++){if(!this.morphNormals[d]){this.morphNormals[d]={},this.morphNormals[d].faceNormals=[],this.morphNormals[d].vertexNormals=[];var o=this.morphNormals[d].faceNormals,a=this.morphNormals[d].vertexNormals;for(e=0,n=this.faces.length;e<n;e++)l=new nl,c={a:new nl,b:new nl,c:new nl},o.push(l),a.push(c)}var s=this.morphNormals[d];r.vertices=this.morphTargets[d].vertices,r.computeFaceNormals(),r.computeVertexNormals();var l,c;for(e=0,n=this.faces.length;e<n;e++)i=this.faces[e],l=s.faceNormals[e],c=s.vertexNormals[e],l.copy(i.normal),c.a.copy(i.vertexNormals[0]),c.b.copy(i.vertexNormals[1]),c.c.copy(i.vertexNormals[2])}for(e=0,n=this.faces.length;e<n;e++)(i=this.faces[e]).normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeLineDistances:function(){for(var a=0,t=this.vertices,e=0,o=t.length;e<o;e++)0<e&&(a+=t[e].distanceTo(t[e-1])),this.lineDistances[e]=a},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new hl),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new it),this.boundingSphere.setFromPoints(this.vertices)},merge:function(T,t,e){if(T&&T.isGeometry){var n=this.vertices.length,r=this.vertices,o=T.vertices,a=this.faces,s=T.faces,l=this.faceVertexUvs[0],c=T.faceVertexUvs[0],h=this.colors,u=T.colors,p;void 0===e&&(e=0),void 0!==t&&(p=new rt().getNormalMatrix(t));for(var i=0,d=o.length,f;i<d;i++)f=o[i].clone(),void 0!==t&&f.applyMatrix4(t),r.push(f);for(var i=0,d=u.length;i<d;i++)h.push(u[i].clone());for(i=0,d=s.length;i<d;i++){var m=s[i],v=m.vertexNormals,b=m.vertexColors,w,_,g;(w=new yl(m.a+n,m.b+n,m.c+n)).normal.copy(m.normal),void 0!==p&&w.normal.applyMatrix3(p).normalize();for(var y=0,x=v.length;y<x;y++)_=v[y].clone(),void 0!==p&&_.applyMatrix3(p).normalize(),w.vertexNormals.push(_);w.color.copy(m.color);for(var y=0,x=b.length;y<x;y++)g=b[y],w.vertexColors.push(g.clone());w.materialIndex=m.materialIndex+e,a.push(w)}for(i=0,d=c.length;i<d;i++){var S=c[i],E=[];if(void 0!==S){for(var y=0,x=S.length;y<x;y++)E.push(S[y].clone());l.push(E)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",T)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var _={},l=[],c=[],h=10000,u,t,e,n,i,r,o,a;for(e=0,n=this.vertices.length;e<n;e++)u=this.vertices[e],void 0===_[t=P(u.x*h)+"_"+P(u.y*h)+"_"+P(u.z*h)]?(_[t]=e,l.push(this.vertices[e]),c[e]=l.length-1):c[e]=c[_[t]];var s=[];for(e=0,n=this.faces.length;e<n;e++){(i=this.faces[e]).a=c[i.a],i.b=c[i.b],i.c=c[i.c],r=[i.a,i.b,i.c];for(var p=0;3>p;p++)if(r[p]===r[(p+1)%3]){s.push(e);break}}for(e=s.length-1;0<=e;e--){var d=s[e];for(this.faces.splice(d,1),o=0,a=this.faceVertexUvs.length;o<a;o++)this.faceVertexUvs[o].splice(d,1)}var g=this.vertices.length-l.length;return this.vertices=l,g},sortFacesByMaterialIndex:function(){for(var l=this.faces,t=l.length,e=0;e<t;e++)l[e]._id=e;l.sort(function(a,t){return a.materialIndex-t.materialIndex});var n=this.faceVertexUvs[0],o=this.faceVertexUvs[1],a,i;for(n&&n.length===t&&(a=[]),o&&o.length===t&&(i=[]),e=0;e<t;e++){var r=l[e]._id;a&&a.push(n[r]),i&&i.push(o[r])}a&&(this.faceVertexUvs[0]=a),i&&(this.faceVertexUvs[1]=i)},toJSON:function(){function P(a,o,e){return e?a|1<<o:a&~(1<<o)}function t(a){var t=a.x.toString()+a.y.toString()+a.z.toString();return void 0===u[t]?(u[t]=h.length/3,h.push(a.x,a.y,a.z),u[t]):u[t]}function e(a){var t=a.r.toString()+a.g.toString()+a.b.toString();return void 0===d[t]?(d[t]=p.length,p.push(a.getHex()),d[t]):d[t]}function n(a){var t=a.x.toString()+a.y.toString();return void 0===m[t]?(m[t]=f.length/2,f.push(a.x,a.y),m[t]):m[t]}var i={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),void 0!==this.parameters){var r=this.parameters;for(var o in r)void 0!==r[o]&&(i[o]=r[o]);return i}for(var a=[],s=0,l;s<this.vertices.length;s++)l=this.vertices[s],a.push(l.x,l.y,l.z);for(var c=[],h=[],u={},p=[],d={},f=[],m={},s=0;s<this.faces.length;s++){var _=this.faces[s],g=void 0!==this.faceVertexUvs[0][s],y=0<_.normal.length(),v=0<_.vertexNormals.length,b=1!==_.color.r||1!==_.color.g||1!==_.color.b,w=0<_.vertexColors.length,x=0;if(x=P(x,0,0),x=P(x,1,!0),x=P(x,2,!1),x=P(x,3,g),x=P(x,4,y),x=P(x,5,v),x=P(x,6,b),x=P(x,7,w),c.push(x),c.push(_.a,_.b,_.c),c.push(_.materialIndex),g){var S=this.faceVertexUvs[0][s];c.push(n(S[0]),n(S[1]),n(S[2]))}if(y&&c.push(t(_.normal)),v){var E=_.vertexNormals;c.push(t(E[0]),t(E[1]),t(E[2]))}if(b&&c.push(e(_.color)),w){var M=_.vertexColors;c.push(e(M[0]),e(M[1]),e(M[2]))}}return i.data={},i.data.vertices=a,i.data.normals=h,0<p.length&&(i.data.colors=p),0<f.length&&(i.data.uvs=[f]),i.data.faces=c,i},clone:function(){return new gt().copy(this)},copy:function(T){var t,e,n,i,r,o;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=T.name;var a=T.vertices;for(t=0,e=a.length;t<e;t++)this.vertices.push(a[t].clone());var s=T.colors;for(t=0,e=s.length;t<e;t++)this.colors.push(s[t].clone());var l=T.faces;for(t=0,e=l.length;t<e;t++)this.faces.push(l[t].clone());for(t=0,e=T.faceVertexUvs.length;t<e;t++){var c=T.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),n=0,i=c.length;n<i;n++){var h=c[n],u=[];for(r=0,o=h.length;r<o;r++){var p=h[r];u.push(p.clone())}this.faceVertexUvs[t].push(u)}}var d=T.morphTargets;for(t=0,e=d.length;t<e;t++){var f={};if(f.name=d[t].name,void 0!==d[t].vertices)for(f.vertices=[],n=0,i=d[t].vertices.length;n<i;n++)f.vertices.push(d[t].vertices[n].clone());if(void 0!==d[t].normals)for(f.normals=[],n=0,i=d[t].normals.length;n<i;n++)f.normals.push(d[t].normals[n].clone());this.morphTargets.push(f)}var m=T.morphNormals;for(t=0,e=m.length;t<e;t++){var _={};if(void 0!==m[t].vertexNormals)for(_.vertexNormals=[],n=0,i=m[t].vertexNormals.length;n<i;n++){var g=m[t].vertexNormals[n],y={};y.a=g.a.clone(),y.b=g.b.clone(),y.c=g.c.clone(),_.vertexNormals.push(y)}if(void 0!==m[t].faceNormals)for(_.faceNormals=[],n=0,i=m[t].faceNormals.length;n<i;n++)_.faceNormals.push(m[t].faceNormals[n].clone());this.morphNormals.push(_)}var v=T.skinWeights;for(t=0,e=v.length;t<e;t++)this.skinWeights.push(v[t].clone());var b=T.skinIndices;for(t=0,e=b.length;t<e;t++)this.skinIndices.push(b[t].clone());var w=T.lineDistances;for(t=0,e=w.length;t<e;t++)this.lineDistances.push(w[t]);var x=T.boundingBox;null!==x&&(this.boundingBox=x.clone());var S=T.boundingSphere;return null!==S&&(this.boundingSphere=S.clone()),this.elementsNeedUpdate=T.elementsNeedUpdate,this.verticesNeedUpdate=T.verticesNeedUpdate,this.uvsNeedUpdate=T.uvsNeedUpdate,this.normalsNeedUpdate=T.normalsNeedUpdate,this.colorsNeedUpdate=T.colorsNeedUpdate,this.lineDistancesNeedUpdate=T.lineDistancesNeedUpdate,this.groupsNeedUpdate=T.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(yt.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(yt.prototype,{isBufferAttribute:!0,setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0===e?0:e.length/this.itemSize,this.array=e},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.dynamic=e.dynamic,this},copyAt:function(a,t,e){a*=this.itemSize,e*=t.itemSize;for(var o=0,n=this.itemSize;o<n;o++)this.array[a+o]=t.array[e+o];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(a){for(var t=this.array,e=0,n=0,i=a.length,r;n<i;n++)r=a[n],void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),r=new X),t[e++]=r.r,t[e++]=r.g,t[e++]=r.b;return this},copyIndicesArray:function(a){for(var t=this.array,e=0,n=0,i=a.length,r;n<i;n++)r=a[n],t[e++]=r.a,t[e++]=r.b,t[e++]=r.c;return this},copyVector2sArray:function(r){for(var t=this.array,e=0,n=0,i=r.length,o;n<i;n++)o=r[n],void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),o=new el),t[e++]=o.x,t[e++]=o.y;return this},copyVector3sArray:function(a){for(var t=this.array,e=0,n=0,i=a.length,r;n<i;n++)r=a[n],void 0===r&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),r=new nl),t[e++]=r.x,t[e++]=r.y,t[e++]=r.z;return this},copyVector4sArray:function(a){for(var t=this.array,e=0,n=0,i=a.length,r;n<i;n++)r=a[n],void 0===r&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),r=new al),t[e++]=r.x,t[e++]=r.y,t[e++]=r.z,t[e++]=r.w;return this},set:function(a,t){return void 0===t&&(t=0),this.array.set(a,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(a,t){return this.array[a*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(a,t){return this.array[a*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(a,t){return this.array[a*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(a,t){return this.array[a*this.itemSize+3]=t,this},setXY:function(a,t,e){return a*=this.itemSize,this.array[a+0]=t,this.array[a+1]=e,this},setXYZ:function(a,t,e,o){return a*=this.itemSize,this.array[a+0]=t,this.array[a+1]=e,this.array[a+2]=o,this},setXYZW:function(a,t,e,o,n){return a*=this.itemSize,this.array[a+0]=t,this.array[a+1]=e,this.array[a+2]=o,this.array[a+3]=n,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),vt.prototype=Object.create(yt.prototype),vt.prototype.constructor=vt,bt.prototype=Object.create(yt.prototype),bt.prototype.constructor=bt,wt.prototype=Object.create(yt.prototype),wt.prototype.constructor=wt,xt.prototype=Object.create(yt.prototype),xt.prototype.constructor=xt,St.prototype=Object.create(yt.prototype),St.prototype.constructor=St,Et.prototype=Object.create(yt.prototype),Et.prototype.constructor=Et,Mt.prototype=Object.create(yt.prototype),Mt.prototype.constructor=Mt,Tt.prototype=Object.create(yt.prototype),Tt.prototype.constructor=Tt,At.prototype=Object.create(yt.prototype),At.prototype.constructor=At,Object.assign(Pt.prototype,{computeGroups:function(l){for(var t=[],n=void 0,s=l.faces,r=0,o,e;r<s.length;r++)e=s[r],e.materialIndex!==n&&(n=e.materialIndex,void 0!==o&&(o.count=3*r-o.start,t.push(o)),o={start:3*r,materialIndex:n});void 0!==o&&(o.count=3*r-o.start,t.push(o)),this.groups=t},fromGeometry:function(r){var t=r.faces,n=r.vertices,i=r.faceVertexUvs,o=i[0]&&0<i[0].length,a=i[1]&&0<i[1].length,s=r.morphTargets,l=s.length,c;if(0<l){for(c=[],_=0;_<l;_++)c[_]=[];this.morphTargets.position=c}var e=r.morphNormals,u=e.length,p;if(0<u){for(p=[],_=0;_<u;_++)p[_]=[];this.morphTargets.normal=p}for(var h=r.skinIndices,d=r.skinWeights,f=h.length===n.length,m=d.length===n.length,_=0,g;_<t.length;_++){g=t[_],this.vertices.push(n[g.a],n[g.b],n[g.c]);var y=g.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var v=g.normal;this.normals.push(v,v,v)}var b=g.vertexColors;if(3===b.length)this.colors.push(b[0],b[1],b[2]);else{var w=g.color;this.colors.push(w,w,w)}if(!0===o&&(void 0===(x=i[0][_])?(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",_),this.uvs.push(new el,new el,new el)):this.uvs.push(x[0],x[1],x[2])),!0===a){var x=i[1][_];void 0===x?(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",_),this.uvs2.push(new el,new el,new el)):this.uvs2.push(x[0],x[1],x[2])}for(E=0;E<l;E++){var S=s[E].vertices;c[E].push(S[g.a],S[g.b],S[g.c])}for(var E=0,M;E<u;E++)M=e[E].vertexNormals[_],p[E].push(M.a,M.b,M.c);f&&this.skinIndices.push(h[g.a],h[g.b],h[g.c]),m&&this.skinWeights.push(d[g.a],d[g.b],d[g.c])}return this.computeGroups(r),this.verticesNeedUpdate=r.verticesNeedUpdate,this.normalsNeedUpdate=r.normalsNeedUpdate,this.colorsNeedUpdate=r.colorsNeedUpdate,this.uvsNeedUpdate=r.uvsNeedUpdate,this.groupsNeedUpdate=r.groupsNeedUpdate,this}}),bl.MaxIndex=65535,Object.assign(bl.prototype,n.prototype,{isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){this.index=Array.isArray(e)?new(65535<It(e)?Mt:St)(e,1):e},addAttribute:function(a,t){return t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===a?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),void this.setIndex(t)):(this.attributes[a]=t,this):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void this.addAttribute(a,new yt(arguments[1],arguments[2])))},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){return delete this.attributes[e],this},addGroup:function(a,o,r){this.groups.push({start:a,count:o,materialIndex:void 0===r?0:r})},clearGroups:function(){this.groups=[]},setDrawRange:function(a,t){this.drawRange.start=a,this.drawRange.count=t},applyMatrix:function(a){var t=this.attributes.position;void 0!==t&&(a.applyToBufferAttribute(t),t.needsUpdate=!0);var e=this.attributes.normal;return void 0!==e&&(new rt().getNormalMatrix(a).applyToBufferAttribute(e),e.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var a=new il;return function(t){return a.makeRotationX(t),this.applyMatrix(a),this}}(),rotateY:function(){var a=new il;return function(t){return a.makeRotationY(t),this.applyMatrix(a),this}}(),rotateZ:function(){var a=new il;return function(t){return a.makeRotationZ(t),this.applyMatrix(a),this}}(),translate:function(){var a=new il;return function(t,e,o){return a.makeTranslation(t,e,o),this.applyMatrix(a),this}}(),scale:function(){var a=new il;return function(t,e,o){return a.makeScale(t,e,o),this.applyMatrix(a),this}}(),lookAt:function(){var a=new ut;return function(t){a.lookAt(t),a.updateMatrix(),this.applyMatrix(a.matrix)}}(),center:function(){this.computeBoundingBox();var e=this.boundingBox.getCenter().negate();return this.translate(e.x,e.y,e.z),e},setFromObject:function(a){var t=a.geometry;if(a.isPoints||a.isLine){var e=new Tt(3*t.vertices.length,3),o=new Tt(3*t.colors.length,3);if(this.addAttribute("position",e.copyVector3sArray(t.vertices)),this.addAttribute("color",o.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var n=new Tt(t.lineDistances.length,1);this.addAttribute("lineDistance",n.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else a.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},updateFromObject:function(a){var t=a.geometry;if(a.isMesh){var e=t.__directGeometry;if(!0===t.elementsNeedUpdate&&(e=void 0,t.elementsNeedUpdate=!1),void 0===e)return this.fromGeometry(t);e.verticesNeedUpdate=t.verticesNeedUpdate,e.normalsNeedUpdate=t.normalsNeedUpdate,e.colorsNeedUpdate=t.colorsNeedUpdate,e.uvsNeedUpdate=t.uvsNeedUpdate,e.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=e}var o;return!0===t.verticesNeedUpdate&&(void 0!==(o=this.attributes.position)&&(o.copyVector3sArray(t.vertices),o.needsUpdate=!0),t.verticesNeedUpdate=!1),!0===t.normalsNeedUpdate&&(void 0!==(o=this.attributes.normal)&&(o.copyVector3sArray(t.normals),o.needsUpdate=!0),t.normalsNeedUpdate=!1),!0===t.colorsNeedUpdate&&(void 0!==(o=this.attributes.color)&&(o.copyColorsArray(t.colors),o.needsUpdate=!0),t.colorsNeedUpdate=!1),t.uvsNeedUpdate&&(void 0!==(o=this.attributes.uv)&&(o.copyVector2sArray(t.uvs),o.needsUpdate=!0),t.uvsNeedUpdate=!1),t.lineDistancesNeedUpdate&&(void 0!==(o=this.attributes.lineDistance)&&(o.copyArray(t.lineDistances),o.needsUpdate=!0),t.lineDistancesNeedUpdate=!1),t.groupsNeedUpdate&&(t.computeGroups(a.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=new Pt().fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(_){var t=new Float32Array(3*_.vertices.length);if(this.addAttribute("position",new yt(t,3).copyVector3sArray(_.vertices)),0<_.normals.length){var e=new Float32Array(3*_.normals.length);this.addAttribute("normal",new yt(e,3).copyVector3sArray(_.normals))}if(0<_.colors.length){var n=new Float32Array(3*_.colors.length);this.addAttribute("color",new yt(n,3).copyColorsArray(_.colors))}if(0<_.uvs.length){var i=new Float32Array(2*_.uvs.length);this.addAttribute("uv",new yt(i,2).copyVector2sArray(_.uvs))}if(0<_.uvs2.length){var r=new Float32Array(2*_.uvs2.length);this.addAttribute("uv2",new yt(r,2).copyVector2sArray(_.uvs2))}if(0<_.indices.length){var o=new(65535<It(_.indices)?Uint32Array:Uint16Array)(3*_.indices.length);this.setIndex(new yt(o,1).copyIndicesArray(_.indices))}for(var a in this.groups=_.groups,_.morphTargets){for(var s=[],l=_.morphTargets[a],c=0,h=l.length;c<h;c++){var u=l[c],p=new Tt(3*u.length,3);s.push(p.copyVector3sArray(u))}this.morphAttributes[a]=s}if(0<_.skinIndices.length){var d=new Tt(4*_.skinIndices.length,4);this.addAttribute("skinIndex",d.copyVector4sArray(_.skinIndices))}if(0<_.skinWeights.length){var g=new Tt(4*_.skinWeights.length,4);this.addAttribute("skinWeight",g.copyVector4sArray(_.skinWeights))}return null!==_.boundingSphere&&(this.boundingSphere=_.boundingSphere.clone()),null!==_.boundingBox&&(this.boundingBox=_.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new hl);var e=this.attributes.position;void 0===e?this.boundingBox.makeEmpty():this.boundingBox.setFromBufferAttribute(e),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error("THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The \"position\" attribute is likely to have NaN values.",this)},computeBoundingSphere:function(){var l=new hl,t=new nl;return function(){null===this.boundingSphere&&(this.boundingSphere=new it);var e=this.attributes.position;if(e){var n=this.boundingSphere.center;l.setFromBufferAttribute(e),l.getCenter(n);for(var i=0,r=0,o=e.count;r<o;r++)t.x=e.getX(r),t.y=e.getY(r),t.z=e.getZ(r),i=C(i,n.distanceToSquared(t));this.boundingSphere.radius=N(i),isNaN(this.boundingSphere.radius)&&console.error("THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The \"position\" attribute is likely to have NaN values.",this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var h=this.index,t=this.attributes,e=this.groups;if(t.position){var n=t.position.array;if(void 0===t.normal)this.addAttribute("normal",new yt(new Float32Array(n.length),3));else for(var i=t.normal.array,r=0,o=i.length;r<o;r++)i[r]=0;var a=t.normal.array,u=new nl,p=new nl,d=new nl,f=new nl,m=new nl,_,s,l;if(h){var c=h.array;0===e.length&&this.addGroup(0,c.length);for(var g=0,y=e.length;g<y;++g)for(var x=e[g],b=x.start,r=b,o=b+x.count;r<o;r+=3)_=3*c[r+0],s=3*c[r+1],l=3*c[r+2],u.fromArray(n,_),p.fromArray(n,s),d.fromArray(n,l),f.subVectors(d,p),m.subVectors(u,p),f.cross(m),a[_]+=f.x,a[_+1]+=f.y,a[_+2]+=f.z,a[s]+=f.x,a[s+1]+=f.y,a[s+2]+=f.z,a[l]+=f.x,a[l+1]+=f.y,a[l+2]+=f.z}else for(var r=0,o=n.length;r<o;r+=9)u.fromArray(n,r),p.fromArray(n,r+3),d.fromArray(n,r+6),f.subVectors(d,p),m.subVectors(u,p),f.cross(m),a[r]=f.x,a[r+1]=f.y,a[r+2]=f.z,a[r+3]=f.x,a[r+4]=f.y,a[r+5]=f.z,a[r+6]=f.x,a[r+7]=f.y,a[r+8]=f.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(c,t){if(c&&c.isBufferGeometry){void 0===t&&(t=0);var e=this.attributes;for(var n in e)if(void 0!==c.attributes[n])for(var i=e[n].array,r=c.attributes[n],o=r.array,a=0,s=r.itemSize*t;a<o.length;a++,s++)i[s]=o[a];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",c)},normalizeNormals:function(){var a=new nl;return function(){for(var t=this.attributes.normal,e=0,o=t.count;e<o;e++)a.x=t.getX(e),a.y=t.getY(e),a.z=t.getZ(e),a.normalize(),t.setXYZ(e,a.x,a.y,a.z)}}(),toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var d=new bl,t=this.index.array,e=this.attributes;for(var n in e){for(var i=e[n],r=i.array,o=i.itemSize,a=new r.constructor(t.length*o),s=0,l=0,c=0,m=t.length;c<m;c++){s=t[c]*o;for(var u=0;u<o;u++)a[l++]=r[s++]}d.addAttribute(n,new yt(a,o))}return d},toJSON:function(){var c={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(c.uuid=this.uuid,c.type=this.type,""!==this.name&&(c.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var e in t)void 0!==t[e]&&(c[e]=t[e]);return c}c.data={attributes:{}};var n=this.index;null!==n&&(o=Array.prototype.slice.call(n.array),c.data.index={type:n.array.constructor.name,array:o});var i=this.attributes;for(var e in i){var r=i[e],o=Array.prototype.slice.call(r.array);c.data.attributes[e]={itemSize:r.itemSize,type:r.array.constructor.name,array:o,normalized:r.normalized}}var d=this.groups;0<d.length&&(c.data.groups=JSON.parse(JSON.stringify(d)));var s=this.boundingSphere;return null!==s&&(c.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),c},clone:function(){return new bl().copy(this)},copy:function(m){var t,e,n;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=m.name;var i=m.index;null!==i&&this.setIndex(i.clone());var r=m.attributes;for(t in r){var o=r[t];this.addAttribute(t,o.clone())}var a=m.morphAttributes;for(t in a){var s=[],l=a[t];for(e=0,n=l.length;e<n;e++)s.push(l[e].clone());this.morphAttributes[t]=s}var c=m.groups;for(e=0,n=c.length;e<n;e++){var _=c[e];this.addGroup(_.start,_.count,_.materialIndex)}var u=m.boundingBox;null!==u&&(this.boundingBox=u.clone());var p=m.boundingSphere;return null!==p&&(this.boundingSphere=p.clone()),this.drawRange.start=m.drawRange.start,this.drawRange.count=m.drawRange.count,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(Ct.prototype=Object.create(gt.prototype)).constructor=Ct,Lt.prototype=Object.create(bl.prototype),Lt.prototype.constructor=Lt,(xl.prototype=Object.create(gt.prototype)).constructor=xl,vl.prototype=Object.create(bl.prototype),vl.prototype.constructor=vl,Sl.prototype=Object.create(K.prototype),Sl.prototype.constructor=Sl,Sl.prototype.isMeshBasicMaterial=!0,Sl.prototype.copy=function(e){return K.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},Object.assign(wl.prototype,{set:function(a,t){return this.origin.copy(a),this.direction.copy(t),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(a,t){return(t||new nl).copy(this.direction).multiplyScalar(a).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(){var a=new nl;return function(t){return this.origin.copy(this.at(t,a)),this}}(),closestPointToPoint:function(a,t){var e=t||new nl;e.subVectors(a,this.origin);var o=e.dot(this.direction);return 0>o?e.copy(this.origin):e.copy(this.direction).multiplyScalar(o).add(this.origin)},distanceToPoint:function(e){return N(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var a=new nl;return function(t){var e=a.subVectors(t,this.origin).dot(this.direction);return 0>e?this.origin.distanceToSquared(t):(a.copy(this.direction).multiplyScalar(e).add(this.origin),a.distanceToSquared(t))}}(),distanceSqToSegment:function(){var y=new nl,t=new nl,e=new nl;return function(n,i,r,o){y.copy(n).add(i).multiplyScalar(.5),t.copy(i).sub(n).normalize(),e.copy(this.origin).sub(y);var a=.5*n.distanceTo(i),b=-this.direction.dot(t),x=e.dot(this.direction),d=-e.dot(t),v=e.lengthSq(),m=B(1-b*b),_,s,l,c;if(!(0<m))s=0<b?-a:a,l=-(_=C(0,-(b*s+x)))*_+s*(s+2*d)+v;else if(_=b*d-x,s=b*x-d,c=a*m,!(0<=_))s<=-c?l=-(_=C(0,-(-b*a+x)))*_+(s=0<_?-a:U(C(-a,-d),a))*(s+2*d)+v:s<=c?(_=0,l=(s=U(C(-a,-d),a))*(s+2*d)+v):l=-(_=C(0,-(b*a+x)))*_+(s=0<_?a:U(C(-a,-d),a))*(s+2*d)+v;else if(!(s>=-c))s=-a,l=-(_=C(0,-(b*s+x)))*_+s*(s+2*d)+v;else if(s<=c){var S=1/m;l=(_*=S)*(_+b*(s*=S)+2*x)+s*(b*_+s+2*d)+v}else s=a,l=-(_=C(0,-(b*s+x)))*_+s*(s+2*d)+v;return r&&r.copy(this.direction).multiplyScalar(_).add(this.origin),o&&o.copy(t).multiplyScalar(s).add(y),l}}(),intersectSphere:function(){var c=new nl;return function(t,e){c.subVectors(t.center,this.origin);var n=c.dot(this.direction),i=c.dot(c)-n*n,r=t.radius*t.radius;if(i>r)return null;var o=N(r-i),a=n-o,s=n+o;return 0>a&&0>s?null:0>a?this.at(s,e):this.at(a,e)}}(),intersectsSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},distanceToPlane:function(a){var t=a.normal.dot(this.direction);if(0===t)return 0===a.distanceToPoint(this.origin)?0:null;var e=-(this.origin.dot(a.normal)+a.constant)/t;return 0<=e?e:null},intersectPlane:function(a,t){var e=this.distanceToPlane(a);return null===e?null:this.at(e,t)},intersectsPlane:function(a){var t=a.distanceToPoint(this.origin);return 0===t||0>a.normal.dot(this.direction)*t},intersectBox:function(d,t){var e=1/this.direction.x,l=1/this.direction.y,c=1/this.direction.z,p=this.origin,u,n,i,r,o,a;return 0<=e?(u=(d.min.x-p.x)*e,n=(d.max.x-p.x)*e):(u=(d.max.x-p.x)*e,n=(d.min.x-p.x)*e),0<=l?(i=(d.min.y-p.y)*l,r=(d.max.y-p.y)*l):(i=(d.max.y-p.y)*l,r=(d.min.y-p.y)*l),u>r||i>n?null:((i>u||u!==u)&&(u=i),(r<n||n!==n)&&(n=r),0<=c?(o=(d.min.z-p.z)*c,a=(d.max.z-p.z)*c):(o=(d.max.z-p.z)*c,a=(d.min.z-p.z)*c),u>a||o>n?null:((o>u||u!==u)&&(u=o),(a<n||n!==n)&&(n=a),0>n?null:this.at(0<=u?u:n,t)))},intersectsBox:function(){var a=new nl;return function(t){return null!==this.intersectBox(t,a)}}(),intersectTriangle:function(){var m=new nl,t=new nl,e=new nl,n=new nl;return function(i,r,o,a,s){t.subVectors(r,i),e.subVectors(o,i),n.crossVectors(t,e);var l=this.direction.dot(n),_;if(0<l){if(a)return null;_=1}else{if(!(0>l))return null;_=-1,l=-l}m.subVectors(this.origin,i);var g=_*this.direction.dot(e.crossVectors(m,e));if(0>g)return null;var u=_*this.direction.dot(t.cross(m));if(0>u)return null;if(g+u>l)return null;var p=-_*m.dot(n);return 0>p?null:this.at(p/l,s)}}(),applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}),Object.assign(Ut.prototype,{set:function(a,t){return this.start.copy(a),this.end.copy(t),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return(e||new nl).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return(e||new nl).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(a,t){var e=t||new nl;return this.delta(e).multiplyScalar(a).add(this.start)},closestPointToPointParameter:function(){var a=new nl,t=new nl;return function(e,n){a.subVectors(e,this.start),t.subVectors(this.end,this.start);var i=t.dot(t),r=t.dot(a)/i;return n&&(r=rd.clamp(r,0,1)),r}}(),closestPointToPoint:function(a,t,e){var o=this.closestPointToPointParameter(a,t),n=e||new nl;return this.delta(n).multiplyScalar(o).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),Object.assign(Nt,{normal:function(){var l=new nl;return function(t,e,n,i){var r=i||new nl;r.subVectors(n,e),l.subVectors(t,e),r.cross(l);var o=r.lengthSq();return 0<o?r.multiplyScalar(1/N(o)):r.set(0,0,0)}}(),barycoordFromPoint:function(){var h=new nl,t=new nl,e=new nl;return function(n,i,r,o,a){h.subVectors(o,i),t.subVectors(r,i),e.subVectors(n,i);var s=h.dot(h),l=h.dot(t),c=h.dot(e),u=t.dot(t),p=t.dot(e),d=s*u-l*l,f=a||new nl;if(0===d)return f.set(-2,-1,-1);var m=1/d,_=(u*c-l*p)*m,g=(s*p-l*c)*m;return f.set(1-_-g,g,_)}}(),containsPoint:function(){var a=new nl;return function(t,e,n,i){var r=Nt.barycoordFromPoint(t,e,n,i,a);return 0<=r.x&&0<=r.y&&1>=r.x+r.y}}()}),Object.assign(Nt.prototype,{set:function(a,t,e){return this.a.copy(a),this.b.copy(t),this.c.copy(e),this},setFromPointsAndIndices:function(a,t,e,o){return this.a.copy(a[t]),this.b.copy(a[e]),this.c.copy(a[o]),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var a=new nl,t=new nl;return function(){return a.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*a.cross(t).length()}}(),midpoint:function(e){return(e||new nl).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return Nt.normal(this.a,this.b,this.c,e)},plane:function(e){return(e||new ot).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(a,t){return Nt.barycoordFromPoint(a,this.a,this.b,this.c,t)},containsPoint:function(e){return Nt.containsPoint(e,this.a,this.b,this.c)},closestPointToPoint:function(){var d=new ot,t=[new Ut,new Ut,new Ut],e=new nl,o=new nl;return function(n,r){var i=r||new nl,a=1/0;if(d.setFromCoplanarPoints(this.a,this.b,this.c),d.projectPoint(n,e),!0===this.containsPoint(e))i.copy(e);else{t[0].set(this.a,this.b),t[1].set(this.b,this.c),t[2].set(this.c,this.a);for(var s=0;s<t.length;s++){t[s].closestPointToPoint(e,!0,o);var l=e.distanceToSquared(o);l<a&&(a=l,i.copy(o))}}return i}}(),equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}),Bt.prototype=Object.assign(Object.create(ut.prototype),{constructor:Bt,isMesh:!0,setDrawMode:function(e){this.drawMode=e},copy:function(e){return ut.prototype.copy.call(this,e),this.drawMode=e.drawMode,this},updateMorphTargets:function(){var l=this.geometry,i,t,e;if(l.isBufferGeometry){var n=l.morphAttributes,r=Object.keys(n);if(0<r.length){var o=n[r[0]];if(void 0!==o)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},i=0,t=o.length;i<t;i++)e=o[i].name||i+"",this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=i}}else{var a=l.morphTargets;if(void 0!==a&&0<a.length)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},i=0,t=a.length;i<t;i++)e=a[i].name||i+"",this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=i}},raycast:function(){function x(l,s,e,n,i,r,o){return Nt.barycoordFromPoint(l,s,e,n,d),i.multiplyScalar(d.x),r.multiplyScalar(d.y),o.multiplyScalar(d.z),i.add(r).add(o),i.clone()}function t(c,d,u,n,i,r,o,a){if(null===(d.side===Fr?n.intersectTriangle(o,r,i,!0,a):n.intersectTriangle(i,r,o,d.side!==Ac,a)))return null;p.copy(a),p.applyMatrix4(c.matrixWorld);var s=u.ray.origin.distanceTo(p);return s<u.near||s>u.far?null:{distance:s,point:p.clone(),object:c}}function e(e,c,i,r,o,a,h,u){S.fromBufferAttribute(r,a),s.fromBufferAttribute(r,h),l.fromBufferAttribute(r,u);var p=t(e,e.material,c,i,S,s,l,g);return p&&(o&&(f.fromBufferAttribute(o,a),m.fromBufferAttribute(o,h),_.fromBufferAttribute(o,u),p.uv=x(g,S,s,l,f,m,_)),p.face=new yl(a,h,u,Nt.normal(S,s,l)),p.faceIndex=a),p}var n=new il,i=new wl,o=new it,S=new nl,s=new nl,l=new nl,a=new nl,r=new nl,c=new nl,f=new el,m=new el,_=new el,d=new nl,g=new nl,p=new nl;return function(d,p){var h=this.geometry,u=this.material,y=this.matrixWorld;if(void 0!==u&&(null===h.boundingSphere&&h.computeBoundingSphere(),o.copy(h.boundingSphere),o.applyMatrix4(y),!1!==d.ray.intersectsSphere(o)&&(n.getInverse(y),i.copy(d.ray).applyMatrix4(n),null===h.boundingBox||!1!==i.intersectsBox(h.boundingBox)))){var b;if(h.isBufferGeometry){var v=h.index,w=h.attributes.position,P=h.attributes.uv,A,I,Z,E,M;if(null!==v)for(E=0,M=v.count;E<M;E+=3)A=v.getX(E),I=v.getX(E+1),Z=v.getX(E+2),(b=e(this,d,i,w,P,A,I,Z))&&(b.faceIndex=z(E/3),p.push(b));else for(E=0,M=w.count;E<M;E+=3)(b=e(this,d,i,w,P,A=E,I=E+1,Z=E+2))&&(b.index=A,p.push(b))}else if(h.isGeometry){var T=Array.isArray(u),D=h.vertices,O=h.faces,F=h.faceVertexUvs[0],U,C,L,R;0<F.length&&(R=F);for(var k=0,N=O.length;k<N;k++){var B=O[k],J=T?u[B.materialIndex]:u;if(void 0!==J){if(U=D[B.a],C=D[B.b],L=D[B.c],!0===J.morphTargets){var G=h.morphTargets,j=this.morphTargetInfluences;S.set(0,0,0),s.set(0,0,0),l.set(0,0,0);for(var H=0,V=G.length,W;H<V;H++)if(W=j[H],0!==W){var q=G[H].vertices;S.addScaledVector(a.subVectors(q[B.a],U),W),s.addScaledVector(r.subVectors(q[B.b],C),W),l.addScaledVector(c.subVectors(q[B.c],L),W)}S.add(U),s.add(C),l.add(L),U=S,C=s,L=l}if(b=t(this,J,d,i,U,C,L,g)){if(R&&R[k]){var X=R[k];f.copy(X[0]),m.copy(X[1]),_.copy(X[2]),b.uv=x(g,U,C,L,f,m,_)}b.face=B,b.faceIndex=k,p.push(b)}}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Xa=0;ye.prototype=Object.assign(Object.create(fl.prototype),{constructor:ye,isArrayCamera:!0}),Ee.prototype.isFogExp2=!0,Ee.prototype.clone=function(){return new Ee(this.color.getHex(),this.density)},Ee.prototype.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}},Me.prototype.isFog=!0,Me.prototype.clone=function(){return new Me(this.color.getHex(),this.near,this.far)},Me.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},Te.prototype=Object.assign(Object.create(ut.prototype),{constructor:Te,copy:function(a,t){return ut.prototype.copy.call(this,a,t),null!==a.background&&(this.background=a.background.clone()),null!==a.fog&&(this.fog=a.fog.clone()),null!==a.overrideMaterial&&(this.overrideMaterial=a.overrideMaterial.clone()),this.autoUpdate=a.autoUpdate,this.matrixAutoUpdate=a.matrixAutoUpdate,this},toJSON:function(a){var t=ut.prototype.toJSON.call(this,a);return null!==this.background&&(t.object.background=this.background.toJSON(a)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}),Ml.prototype=Object.assign(Object.create(ut.prototype),{constructor:Ml,isLensFlare:!0,copy:function(a){ut.prototype.copy.call(this,a),this.positionScreen.copy(a.positionScreen),this.customUpdateCallback=a.customUpdateCallback;for(var t=0,e=a.lensFlares.length;t<e;t++)this.lensFlares.push(a.lensFlares[t]);return this},add:function(a,l,s,c,d,p){void 0===l&&(l=-1),void 0===s&&(s=0),void 0===p&&(p=1),void 0===d&&(d=new X(16777215)),void 0===c&&(c=Dc),s=U(s,C(0,s)),this.lensFlares.push({texture:a,size:l,distance:s,x:0,y:0,z:0,scale:1,rotation:0,opacity:p,color:d,blending:c})},updateLensFlares:function(){var a=this.lensFlares.length,o=2*-this.positionScreen.x,n=2*-this.positionScreen.y,r,t;for(r=0;r<a;r++)(t=this.lensFlares[r]).x=this.positionScreen.x+o*t.distance,t.y=this.positionScreen.y+n*t.distance,t.wantedRotation=.25*(t.x*Gn),t.rotation+=.25*(t.wantedRotation-t.rotation)}}),Pl.prototype=Object.create(K.prototype),Pl.prototype.constructor=Pl,Pl.prototype.isSpriteMaterial=!0,Pl.prototype.copy=function(e){return K.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this},Cl.prototype=Object.assign(Object.create(ut.prototype),{constructor:Cl,isSprite:!0,raycast:function(){var l=new nl,t=new nl,e=new nl;return function(n,i){t.setFromMatrixPosition(this.matrixWorld),n.ray.closestPointToPoint(t,l),e.setFromMatrixScale(this.matrixWorld);var r=e.x*e.y/4;if(!(t.distanceToSquared(l)>r)){var o=n.ray.origin.distanceTo(l);o<n.near||o>n.far||i.push({distance:o,point:l.clone(),face:null,object:this})}}}(),clone:function(){return new this.constructor(this.material).copy(this)}}),Ll.prototype=Object.assign(Object.create(ut.prototype),{constructor:Ll,copy:function(a){ut.prototype.copy.call(this,a,!1);for(var t=a.levels,e=0,o=t.length,n;e<o;e++)n=t[e],this.addLevel(n.object.clone(),n.distance);return this},addLevel:function(a,o){void 0===o&&(o=0),o=B(o);for(var r=this.levels,n=0;n<r.length&&!(o<r[n].distance);n++);r.splice(n,0,{distance:o,object:a}),this.add(a)},getObjectForDistance:function(a){for(var t=this.levels,e=1,o=t.length;e<o&&!(a<t[e].distance);e++);return t[e-1].object},raycast:function(){var a=new nl;return function(t,e){a.setFromMatrixPosition(this.matrixWorld);var o=t.ray.origin.distanceTo(a);this.getObjectForDistance(o).raycast(t,e)}}(),update:function(){var l=new nl,t=new nl;return function(e){var n=this.levels;if(1<n.length){l.setFromMatrixPosition(e.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var i=l.distanceTo(t);n[0].object.visible=!0;for(var r=1,o=n.length;r<o&&i>=n[r].distance;r++)n[r-1].object.visible=!1,n[r].object.visible=!0;for(;r<o;r++)n[r].object.visible=!1}}}(),toJSON:function(a){var t=ut.prototype.toJSON.call(this,a);t.object.levels=[];for(var e=this.levels,n=0,i=e.length,r;n<i;n++)r=e[n],t.object.levels.push({object:r.object.uuid,distance:r.distance});return t}}),Object.assign(Al.prototype,{calculateInverses:function(){this.boneInverses=[];for(var a=0,t=this.bones.length,e;a<t;a++)e=new il,this.bones[a]&&e.getInverse(this.bones[a].matrixWorld),this.boneInverses.push(e)},pose:function(){var a,t,e;for(t=0,e=this.bones.length;t<e;t++)(a=this.bones[t])&&a.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,e=this.bones.length;t<e;t++)(a=this.bones[t])&&(a.parent&&a.parent.isBone?(a.matrix.getInverse(a.parent.matrixWorld),a.matrix.multiply(a.matrixWorld)):a.matrix.copy(a.matrixWorld),a.matrix.decompose(a.position,a.quaternion,a.scale))},update:function(){var o=new il,t=new il;return function(){for(var e=this.bones,n=this.boneInverses,i=this.boneMatrices,r=this.boneTexture,c=0,a=e.length,s;c<a;c++)s=e[c]?e[c].matrixWorld:t,o.multiplyMatrices(s,n[c]),o.toArray(i,16*c);void 0!==r&&(r.needsUpdate=!0)}}(),clone:function(){return new Al(this.bones,this.boneInverses)}}),Re.prototype=Object.assign(Object.create(ut.prototype),{constructor:Re,isBone:!0}),Il.prototype=Object.assign(Object.create(Bt.prototype),{constructor:Il,isSkinnedMesh:!0,initBones:function(){var a=[],o,t,e,r;if(this.geometry&&void 0!==this.geometry.bones){for(e=0,r=this.geometry.bones.length;e<r;e++)t=this.geometry.bones[e],o=new Re,a.push(o),o.name=t.name,o.position.fromArray(t.pos),o.quaternion.fromArray(t.rotq),void 0!==t.scl&&o.scale.fromArray(t.scl);for(e=0,r=this.geometry.bones.length;e<r;e++)-1!==(t=this.geometry.bones[e]).parent&&null!==t.parent&&void 0!==a[t.parent]?a[t.parent].add(a[e]):this.add(a[e])}return this.updateMatrixWorld(!0),a},bind:function(a,t){this.skeleton=a,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){var a,t;if(this.geometry&&this.geometry.isGeometry)for(t=0;t<this.geometry.skinWeights.length;t++){var e=this.geometry.skinWeights[t];(a=1/e.lengthManhattan())===1/0?e.set(1,0,0,0):e.multiplyScalar(a)}else if(this.geometry&&this.geometry.isBufferGeometry){var o=new al,n=this.geometry.attributes.skinWeight;for(t=0;t<n.count;t++)o.x=n.getX(t),o.y=n.getY(t),o.z=n.getZ(t),o.w=n.getW(t),(a=1/o.lengthManhattan())===1/0?o.set(1,0,0,0):o.multiplyScalar(a),n.setXYZW(t,o.x,o.y,o.z,o.w)}},updateMatrixWorld:function(e){Bt.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Rl.prototype=Object.create(K.prototype),Rl.prototype.constructor=Rl,Rl.prototype.isLineBasicMaterial=!0,Rl.prototype.copy=function(e){return K.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this},Dl.prototype=Object.assign(Object.create(ut.prototype),{constructor:Dl,isLine:!0,raycast:function(){var o=new il,t=new wl,e=new it;return function(n,i){var r=n.linePrecision,h=r*r,a=this.geometry,s=this.matrixWorld;if(null===a.boundingSphere&&a.computeBoundingSphere(),e.copy(a.boundingSphere),e.applyMatrix4(s),!1!==n.ray.intersectsSphere(e)){o.getInverse(s),t.copy(n.ray).applyMatrix4(o);var l=new nl,c=new nl,u=new nl,p=new nl,d=this&&this.isLineSegments?2:1;if(a.isBufferGeometry){var f=a.index,m=a.attributes.position.array;if(null!==f)for(var _=f.array,g=0,T=_.length-1;g<T;g+=d){var v=_[g],b=_[g+1];l.fromArray(m,3*v),c.fromArray(m,3*b),(S=t.distanceSqToSegment(l,c,p,u))>h||(p.applyMatrix4(this.matrixWorld),(E=n.ray.origin.distanceTo(p))<n.near||E>n.far||i.push({distance:E,point:u.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}else for(var g=0,T=m.length/3-1;g<T;g+=d)l.fromArray(m,3*g),c.fromArray(m,3*g+3),(S=t.distanceSqToSegment(l,c,p,u))>h||(p.applyMatrix4(this.matrixWorld),(E=n.ray.origin.distanceTo(p))<n.near||E>n.far||i.push({distance:E,point:u.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}else if(a.isGeometry)for(var w=a.vertices,x=w.length,g=0,S;g<x-1;g+=d)if(S=t.distanceSqToSegment(w[g],w[g+1],p,u),!(S>h)){p.applyMatrix4(this.matrixWorld);var E=n.ray.origin.distanceTo(p);E<n.near||E>n.far||i.push({distance:E,point:u.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this})}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),kl.prototype=Object.assign(Object.create(Dl.prototype),{constructor:kl,isLineSegments:!0}),Fl.prototype=Object.assign(Object.create(Dl.prototype),{constructor:Fl,isLineLoop:!0}),Nl.prototype=Object.create(K.prototype),Nl.prototype.constructor=Nl,Nl.prototype.isPointsMaterial=!0,Nl.prototype.copy=function(e){return K.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this},Ul.prototype=Object.assign(Object.create(ut.prototype),{constructor:Ul,isPoints:!0,raycast:function(){var a=new il,h=new wl,e=new it;return function(x,i){function t(e,t){var l=h.distanceSqToPoint(e);if(l<u){var d=h.closestPointToPoint(e);d.applyMatrix4(S);var s=x.ray.origin.distanceTo(d);if(s<x.near||s>x.far)return;i.push({distance:s,distanceToRay:N(l),point:d.clone(),index:t,face:null,object:r})}}var r=this,o=this.geometry,S=this.matrixWorld,n=x.params.Points.threshold;if(null===o.boundingSphere&&o.computeBoundingSphere(),e.copy(o.boundingSphere),e.applyMatrix4(S),e.radius+=n,!1!==x.ray.intersectsSphere(e)){a.getInverse(S),h.copy(x.ray).applyMatrix4(a);var l=n/((this.scale.x+this.scale.y+this.scale.z)/3),u=l*l,s=new nl;if(o.isBufferGeometry){var c=o.index,d=o.attributes.position.array;if(null!==c)for(var p=c.array,m=0,_=p.length,g;m<_;m++)g=p[m],s.fromArray(d,3*g),t(s,g);else for(var m=0,f=d.length/3;m<f;m++)s.fromArray(d,3*m),t(s,m)}else for(var y=o.vertices,m=0,f=y.length;m<f;m++)t(y[m],m)}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Bl.prototype=Object.assign(Object.create(ut.prototype),{constructor:Bl}),(zl.prototype=Object.create(tl.prototype)).constructor=zl,(je.prototype=Object.create(tl.prototype)).constructor=je,je.prototype.isCompressedTexture=!0,(He.prototype=Object.create(tl.prototype)).constructor=He,He.prototype.isDepthTexture=!0,Ve.prototype=Object.create(bl.prototype),Ve.prototype.constructor=Ve,(Ol.prototype=Object.create(gt.prototype)).constructor=Ol,(Gl.prototype=Object.create(bl.prototype)).constructor=Gl,(Hl.prototype=Object.create(gt.prototype)).constructor=Hl,Vl.prototype=Object.create(bl.prototype),Vl.prototype.constructor=Vl,(Wl.prototype=Object.create(gt.prototype)).constructor=Wl,(jl.prototype=Object.create(Vl.prototype)).constructor=jl,(ql.prototype=Object.create(gt.prototype)).constructor=ql,Xl.prototype=Object.create(Vl.prototype),Xl.prototype.constructor=Xl,(Yl.prototype=Object.create(gt.prototype)).constructor=Yl,(Zl.prototype=Object.create(Vl.prototype)).constructor=Zl,(Jl.prototype=Object.create(gt.prototype)).constructor=Jl,(Kl.prototype=Object.create(Vl.prototype)).constructor=Kl,(Ql.prototype=Object.create(gt.prototype)).constructor=Ql,($l.prototype=Object.create(bl.prototype)).constructor=$l,(ms.prototype=Object.create(gt.prototype)).constructor=ms,(_s.prototype=Object.create(bl.prototype)).constructor=_s,(gs.prototype=Object.create(gt.prototype)).constructor=gs,(ys.prototype=Object.create(bl.prototype)).constructor=ys;var Ya={area:function(a){for(var t=a.length,e=0,o=t-1,n=0;n<t;o=n++)e+=a[o].x*a[n].y-a[n].x*a[o].y;return .5*e},triangulate:function(){function i(C,L,e,n,i,r){var o,a,s,l,c,h,u,p,d;if(a=C[r[L]].x,s=C[r[L]].y,l=C[r[e]].x,c=C[r[e]].y,h=C[r[n]].x,u=C[r[n]].y,0>=(l-a)*(u-s)-(c-s)*(h-a))return!1;var f,m,_,g,y,v,b,w,x,S,E,M,T,A,P;for(f=h-l,m=u-c,_=a-h,g=s-u,y=l-a,v=c-s,o=0;o<i;o++)if(p=C[r[o]].x,d=C[r[o]].y,(p!==a||d!==s)&&(p!==l||d!==c)&&(p!==h||d!==u)&&(b=p-a,w=d-s,x=p-l,S=d-c,E=p-h,M=d-u,P=f*S-m*x,T=y*w-v*b,A=_*M-g*E,P>=-Mc&&A>=-Mc&&T>=-Mc))return!1;return!0}return function(t,e){var n=t.length;if(3>n)return null;var g=[],s=[],l=[],c,r,o;if(0<Ya.area(t))for(r=0;r<n;r++)s[r]=r;else for(r=0;r<n;r++)s[r]=n-1-r;var a=n,h=2*a;for(r=a-1;2<a;){if(0>=h--)return console.warn("THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()"),e?l:g;if(c=r,a<=c&&(c=0),r=c+1,a<=r&&(r=0),o=r+1,a<=o&&(o=0),i(t,c,r,o,a,s)){var u,p,d,f,m;for(u=s[c],p=s[r],d=s[o],g.push([t[u],t[p],t[d]]),l.push([s[c],s[r],s[o]]),f=r,m=r+1;m<a;f++,m++)s[f]=s[m];h=2*--a}}return e?l:g}}(),triangulateShape:function(y,t){function e(a){var t=a.length;2<t&&a[t-1].equals(a[0])&&a.pop()}function T(a,t,e){return a.x===t.x?a.y<t.y?a.y<=e.y&&e.y<=t.y:t.y<=e.y&&e.y<=a.y:a.x<t.x?a.x<=e.x&&e.x<=t.x:t.x<=e.x&&e.x<=a.x}function b(i,t,e,n,P){var o=t.x-i.x,a=t.y-i.y,s=n.x-e.x,l=n.y-e.y,c=i.x-e.x,h=i.y-e.y,u=a*s-o*l,p=a*c-o*h;if(B(u)>Mc){var d;if(0<u){if(0>p||p>u)return[];if(0>(d=l*c-s*h)||d>u)return[]}else{if(0<p||p<u)return[];if(0<(d=l*c-s*h)||d<u)return[]}if(0===d)return P&&(0===p||p===u)?[]:[i];if(d===u)return P&&(0===p||p===u)?[]:[t];if(0===p)return[e];if(p===u)return[n];var f=d/u;return[{x:i.x+f*o,y:i.y+f*a}]}if(0!==p||l*c!=s*h)return[];var m=0===o&&0===a,_=0===s&&0===l;if(m&&_)return i.x!==e.x||i.y!==e.y?[]:[i];if(m)return T(e,n,i)?[i]:[];if(_)return T(i,t,e)?[e]:[];var g,y,v,b,w,x,S,E;return 0===o?(i.y<t.y?(g=i,v=i.y,y=t,b=t.y):(g=t,v=t.y,y=i,b=i.y),e.y<n.y?(w=e,S=e.y,x=n,E=n.y):(w=n,S=n.y,x=e,E=e.y)):(i.x<t.x?(g=i,v=i.x,y=t,b=t.x):(g=t,v=t.x,y=i,b=i.x),e.x<n.x?(w=e,S=e.x,x=n,E=n.x):(w=n,S=n.x,x=e,E=e.x)),v<=S?b<S?[]:b===S?P?[]:[w]:b<=E?[w,y]:[w,x]:v>E?[]:v===E?P?[]:[g]:b<=E?[g,y]:[g,x]}function x(d,t,e,n){var i=t.x-d.x,r=t.y-d.y,m=e.x-d.x,a=e.y-d.y,s=n.x-d.x,l=n.y-d.y,c=i*a-r*m,_=i*l-r*s;if(B(c)>Mc){var u=s*a-l*m;return 0<c?0<=_&&0<=u:0<=_||0<=u}return 0<_}e(y),t.forEach(e);for(var o={},r=y.concat(),n=0,i=t.length,d,a,s,l,c,p;n<i;n++)Array.prototype.push.apply(r,t[n]);for(d=0,a=r.length;d<a;d++)void 0!==o[c=r[d].x+":"+r[d].y]&&console.warn("THREE.ShapeUtils: Duplicate point",c,d),o[c]=d;var u=function(o,r){for(var S=o.concat(),e=[],t=[],m=0,_=r.length,g,n,i,a,s,l,c,h,u,p,d;m<_;m++)e.push(m);for(var f=0,y=2*e.length;0<e.length;){if(0>--y){console.log("THREE.ShapeUtils: Infinite Loop! Holes left:\" + indepHoles.length + \", Probably Hole outside Shape!");break}for(i=f;i<S.length;i++){for(a=S[i],n=-1,m=0;m<e.length;m++)if(l=e[m],c=a.x+":"+a.y+":"+l,void 0===t[c]){g=r[l];for(var v=0;v<g.length;v++)if(s=g[v],function(o,t){var e=S.length-1,n=o-1;0>n&&(n=e);var r=o+1;r>e&&(r=0);var a=x(S[o],S[n],S[r],g[t]);if(!a)return!1;var i=g.length-1,l=t-1;0>l&&(l=i);var c=t+1;return c>i&&(c=0),!!(a=x(g[t],g[l],g[c],S[o]))}(i,v)&&!function(a,t){var e,o;for(e=0;e<S.length;e++)if(o=e+1,o%=S.length,0<b(a,t,S[e],S[o],!0).length)return!0;return!1}(a,s)&&!function(l,t){var n,i,o,a;for(n=0;n<e.length;n++)for(i=r[e[n]],o=0;o<i.length;o++)if(a=o+1,a%=i.length,0<b(l,t,i[o],i[a],!0).length)return!0;return!1}(a,s)){n=v,e.splice(m,1),h=S.slice(0,i+1),u=S.slice(i),p=g.slice(n),d=g.slice(0,n+1),S=h.concat(p).concat(d).concat(u),f=i;break}if(0<=n)break;t[c]=!0}if(0<=n)break}}return S}(y,t),m=Ya.triangulate(u,!1);for(d=0,a=m.length;d<a;d++)for(l=m[d],s=0;3>s;s++)void 0!==(p=o[c=l[s].x+":"+l[s].y])&&(l[s]=p);return m.concat()},isClockWise:function(e){return 0>Ya.area(e)}};(bs.prototype=Object.create(gt.prototype)).constructor=bs,xs.prototype=Object.create(bl.prototype),xs.prototype.constructor=xs,xs.prototype.getArrays=function(){var a=this.getAttribute("position"),t=a?Array.prototype.slice.call(a.array):[],o=this.getAttribute("uv"),n=o?Array.prototype.slice.call(o.array):[],l=this.index;return{position:t,uv:n,index:l?Array.prototype.slice.call(l.array):[]}},xs.prototype.addShapeList=function(a,t){var e=a.length;t.arrays=this.getArrays();for(var o=0,n;o<e;o++)n=a[o],this.addShape(n,t);this.setIndex(t.arrays.index),this.addAttribute("position",new Tt(t.arrays.position,3)),this.addAttribute("uv",new Tt(t.arrays.uv,2))},xs.prototype.addShape=function(r,h){function e(a,t,e){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(e).add(a)}function t(r,t,e){var n=r.x-t.x,s=r.y-t.y,p=e.x-r.x,c=e.y-r.y,h=n*n+s*s,u,b,o;if(B(n*c-s*p)>Mc){var a=N(h),d=N(p*p+c*c),f=t.x-s/a,m=t.y+n/a,_=((e.x-c/d-f)*c-(e.y+p/d-m)*p)/(n*c-s*p),g=(u=f+n*_-r.x)*u+(b=m+s*_-r.y)*b;if(2>=g)return new el(u,b);o=N(g/2)}else{var y=!1;n>Mc?p>Mc&&(y=!0):n<-Mc?p<-Mc&&(y=!0):Ec(s)===Ec(c)&&(y=!0),y?(u=-s,b=n,o=N(h)):(u=n,b=s,o=N(h/2))}return new el(u/o,b/o)}function i(l,t){var e,n;for(Z=l.length;0<=--Z;){e=Z,0>(n=Z-1)&&(n=l.length-1);var i=0,r=T+2*S;for(i=0;i<r;i++){var c=z*i,a=z*(i+1);ee(t+e+c,t+n+c,t+n+a,t+e+a,l,i,r,e,n)}}}function o(a,t,e){y.push(a),y.push(t),y.push(e)}function a(a,t,e){l(a),l(t),l(e);var o=c.length/3,n=C.generateTopUV(_,c,o-3,o-2,o-1);s(n[0]),s(n[1]),s(n[2])}function ee(a,t,e,o){l(a),l(t),l(o),l(t),l(e),l(o);var r=c.length/3,n=C.generateSideWallUV(_,c,r-6,r-3,r-2,r-1);s(n[0]),s(n[1]),s(n[3]),s(n[1]),s(n[2]),s(n[3])}function l(e){u.push(c.length/3),c.push(y[3*e+0]),c.push(y[3*e+1]),c.push(y[3*e+2])}function s(e){g.push(e.x),g.push(e.y)}var n=h.arrays?h.arrays:this.getArrays(),c=n.position,u=n.index,g=n.uv,y=[],b=void 0===h.amount?100:h.amount,x=void 0===h.bevelThickness?6:h.bevelThickness,v=void 0===h.bevelSize?x-2:h.bevelSize,S=void 0===h.bevelSegments?3:h.bevelSegments,w=void 0===h.bevelEnabled||h.bevelEnabled,E=void 0===h.curveSegments?12:h.curveSegments,T=void 0===h.steps?1:h.steps,M=h.extrudePath,P=!1,C=void 0===h.UVGenerator?bs.WorldUVGenerator:h.UVGenerator,L,p,d,f,m;M&&(L=M.getSpacedPoints(T),P=!0,w=!1,p=void 0===h.frames?M.computeFrenetFrames(T,!1):h.frames,d=new nl,f=new nl,m=new nl),w||(S=0,x=0,v=0);var _=this,A=r.extractPoints(E),I=A.shape,F=A.holes,U,R,k;if(!Ya.isClockWise(I))for(I=I.reverse(),R=0,k=F.length;R<k;R++)U=F[R],Ya.isClockWise(U)&&(F[R]=U.reverse());var D=Ya.triangulateShape(I,F),O=I;for(R=0,k=F.length;R<k;R++)U=F[R],I=I.concat(U);for(var z=I.length,X=D.length,Y=[],Z=0,J=O.length,K=J-1,Q=Z+1,$,G,j,H,te,W;Z<J;Z++,K++,Q++)K===J&&(K=0),Q===J&&(Q=0),Y[Z]=t(O[Z],O[K],O[Q]);var q=[],ae=Y.concat(),oe;for(R=0,k=F.length;R<k;R++){for(U=F[R],oe=[],Z=0,K=(J=U.length)-1,Q=Z+1;Z<J;Z++,K++,Q++)K===J&&(K=0),Q===J&&(Q=0),oe[Z]=t(U[Z],U[K],U[Q]);q.push(oe),ae=ae.concat(oe)}for($=0;$<S;$++){for(j=$/S,H=x*Cc(j*Gn/2),G=v*Pc(j*Gn/2),Z=0,J=O.length;Z<J;Z++)o((te=e(O[Z],Y[Z],G)).x,te.y,-H);for(R=0,k=F.length;R<k;R++)for(U=F[R],oe=q[R],Z=0,J=U.length;Z<J;Z++)o((te=e(U[Z],oe[Z],G)).x,te.y,-H)}for(G=v,Z=0;Z<z;Z++)te=w?e(I[Z],ae[Z],G):I[Z],P?(f.copy(p.normals[0]).multiplyScalar(te.x),d.copy(p.binormals[0]).multiplyScalar(te.y),m.copy(L[0]).add(f).add(d),o(m.x,m.y,m.z)):o(te.x,te.y,0);var re;for(re=1;re<=T;re++)for(Z=0;Z<z;Z++)te=w?e(I[Z],ae[Z],G):I[Z],P?(f.copy(p.normals[re]).multiplyScalar(te.x),d.copy(p.binormals[re]).multiplyScalar(te.y),m.copy(L[re]).add(f).add(d),o(m.x,m.y,m.z)):o(te.x,te.y,b/T*re);for($=S-1;0<=$;$--){for(j=$/S,H=x*Cc(j*Gn/2),G=v*Pc(j*Gn/2),Z=0,J=O.length;Z<J;Z++)o((te=e(O[Z],Y[Z],G)).x,te.y,b+H);for(R=0,k=F.length;R<k;R++)for(U=F[R],oe=q[R],Z=0,J=U.length;Z<J;Z++)te=e(U[Z],oe[Z],G),P?o(te.x,te.y+L[T-1].y,L[T-1].x+H):o(te.x,te.y,b+H)}!function(){var e=c.length/3;if(w){var t=0,o=z*t;for(Z=0;Z<X;Z++)a((W=D[Z])[2]+o,W[1]+o,W[0]+o);for(o=z*(t=T+2*S),Z=0;Z<X;Z++)a((W=D[Z])[0]+o,W[1]+o,W[2]+o)}else{for(Z=0;Z<X;Z++)a((W=D[Z])[2],W[1],W[0]);for(Z=0;Z<X;Z++)a((W=D[Z])[0]+z*T,W[1]+z*T,W[2]+z*T)}_.addGroup(e,c.length/3-e,void 0===h.material?0:h.material)}(),function(){var e=c.length/3,t=0;for(i(O,t),t+=O.length,R=0,k=F.length;R<k;R++)i(U=F[R],t),t+=U.length;_.addGroup(e,c.length/3-e,void 0===h.extrudeMaterial?1:h.extrudeMaterial)}(),h.arrays||(this.setIndex(u),this.addAttribute("position",new Tt(c,3)),this.addAttribute("uv",new Tt(h.arrays.uv,2)))},bs.WorldUVGenerator={generateTopUV:function(r,t,e,n,i){var o=t[3*e],a=t[3*e+1],s=t[3*n],l=t[3*n+1],c=t[3*i],d=t[3*i+1];return[new el(o,a),new el(s,l),new el(c,d)]},generateSideWallUV:function(r,t,e,n,i,o){var a=t[3*e],s=t[3*e+1],l=t[3*e+2],c=t[3*n],h=t[3*n+1],u=t[3*n+2],p=t[3*i],d=t[3*i+1],f=t[3*i+2],m=t[3*o],_=t[3*o+1],g=t[3*o+2];return .01>B(s-h)?[new el(a,1-l),new el(c,1-u),new el(p,1-f),new el(m,1-g)]:[new el(s,1-l),new el(h,1-u),new el(d,1-f),new el(_,1-g)]}},(vs.prototype=Object.create(gt.prototype)).constructor=vs,(Ss.prototype=Object.create(xs.prototype)).constructor=Ss,(ws.prototype=Object.create(gt.prototype)).constructor=ws,Es.prototype=Object.create(bl.prototype),Es.prototype.constructor=Es,(Ts.prototype=Object.create(gt.prototype)).constructor=Ts,(Ms.prototype=Object.create(bl.prototype)).constructor=Ms,(Ps.prototype=Object.create(gt.prototype)).constructor=Ps,(Cs.prototype=Object.create(bl.prototype)).constructor=Cs,(Ls.prototype=Object.create(gt.prototype)).constructor=Ls,(As.prototype=Object.create(bl.prototype)).constructor=As,Is.prototype=Object.create(bl.prototype),Is.prototype.constructor=Is,Rs.prototype=Object.create(gt.prototype),Rs.prototype.constructor=Rs,Ds.prototype=Object.create(bl.prototype),Ds.prototype.constructor=Ds,(ks.prototype=Object.create(Rs.prototype)).constructor=ks,(Fs.prototype=Object.create(Ds.prototype)).constructor=Fs,(Ns.prototype=Object.create(gt.prototype)).constructor=Ns,(Us.prototype=Object.create(bl.prototype)).constructor=Us;var Za=Object.freeze({WireframeGeometry:Ve,ParametricGeometry:Ol,ParametricBufferGeometry:Gl,TetrahedronGeometry:Wl,TetrahedronBufferGeometry:jl,OctahedronGeometry:ql,OctahedronBufferGeometry:Xl,IcosahedronGeometry:Yl,IcosahedronBufferGeometry:Zl,DodecahedronGeometry:Jl,DodecahedronBufferGeometry:Kl,PolyhedronGeometry:Hl,PolyhedronBufferGeometry:Vl,TubeGeometry:Ql,TubeBufferGeometry:$l,TorusKnotGeometry:ms,TorusKnotBufferGeometry:_s,TorusGeometry:gs,TorusBufferGeometry:ys,TextGeometry:vs,TextBufferGeometry:Ss,SphereGeometry:ws,SphereBufferGeometry:Es,RingGeometry:Ts,RingBufferGeometry:Ms,PlaneGeometry:xl,PlaneBufferGeometry:vl,LatheGeometry:Ps,LatheBufferGeometry:Cs,ShapeGeometry:Ls,ShapeBufferGeometry:As,ExtrudeGeometry:bs,ExtrudeBufferGeometry:xs,EdgesGeometry:Is,ConeGeometry:ks,ConeBufferGeometry:Fs,CylinderGeometry:Rs,CylinderBufferGeometry:Ds,CircleGeometry:Ns,CircleBufferGeometry:Us,BoxGeometry:Ct,BoxBufferGeometry:Lt});(Bs.prototype=Object.create(K.prototype)).constructor=Bs,Bs.prototype.isShadowMaterial=!0,(zs.prototype=Object.create(Q.prototype)).constructor=zs,zs.prototype.isRawShaderMaterial=!0,Os.prototype=Object.create(K.prototype),Os.prototype.constructor=Os,Os.prototype.isMeshStandardMaterial=!0,Os.prototype.copy=function(e){return K.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},(Gs.prototype=Object.create(Os.prototype)).constructor=Gs,Gs.prototype.isMeshPhysicalMaterial=!0,Gs.prototype.copy=function(e){return Os.prototype.copy.call(this,e),this.defines={PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearCoat=e.clearCoat,this.clearCoatRoughness=e.clearCoatRoughness,this},Hs.prototype=Object.create(K.prototype),Hs.prototype.constructor=Hs,Hs.prototype.isMeshPhongMaterial=!0,Hs.prototype.copy=function(e){return K.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},(Vs.prototype=Object.create(Hs.prototype)).constructor=Vs,Vs.prototype.isMeshToonMaterial=!0,Vs.prototype.copy=function(e){return Hs.prototype.copy.call(this,e),this.gradientMap=e.gradientMap,this},(Ws.prototype=Object.create(K.prototype)).constructor=Ws,Ws.prototype.isMeshNormalMaterial=!0,Ws.prototype.copy=function(e){return K.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},(js.prototype=Object.create(K.prototype)).constructor=js,js.prototype.isMeshLambertMaterial=!0,js.prototype.copy=function(e){return K.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},(qs.prototype=Object.create(Rl.prototype)).constructor=qs,qs.prototype.isLineDashedMaterial=!0,qs.prototype.copy=function(e){return Rl.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var Ja=Object.freeze({ShadowMaterial:Bs,SpriteMaterial:Pl,RawShaderMaterial:zs,ShaderMaterial:Q,PointsMaterial:Nl,MeshPhysicalMaterial:Gs,MeshStandardMaterial:Os,MeshPhongMaterial:Hs,MeshToonMaterial:Vs,MeshNormalMaterial:Ws,MeshLambertMaterial:js,MeshDepthMaterial:ml,MeshDistanceMaterial:_l,MeshBasicMaterial:Sl,LineDashedMaterial:qs,LineBasicMaterial:Rl,Material:K}),Ka={enabled:!1,files:{},add:function(a,t){!1!==this.enabled&&(this.files[a]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},Qa=new Xs;Object.assign(Bn.prototype,{load:function(y,t,e,b){void 0===y&&(y=""),void 0!==this.path&&(y=this.path+y);var i=this,r=Ka.get(y);if(void 0!==r)return i.manager.itemStart(y),setTimeout(function(){t&&t(r),i.manager.itemEnd(y)},0),r;var o=/^data:(.*?)(;base64)?,(.*)$/,a=y.match(o);if(a){var n=a[1],s=!!a[2],c=a[3];c=window.decodeURIComponent(c),s&&(c=window.atob(c));try{var h=(this.responseType||"").toLowerCase(),p;switch(h){case"arraybuffer":case"blob":p=new ArrayBuffer(c.length);for(var u=new Uint8Array(p),d=0;d<c.length;d++)u[d]=c.charCodeAt(d);"blob"===h&&(p=new Blob([p],{type:n}));break;case"document":var f=new DOMParser;p=f.parseFromString(c,n);break;case"json":p=JSON.parse(c);break;default:p=c;}window.setTimeout(function(){t&&t(p),i.manager.itemEnd(y)},0)}catch(t){window.setTimeout(function(){b&&b(t),i.manager.itemEnd(y),i.manager.itemError(y)},0)}}else{var m=new XMLHttpRequest;for(var _ in m.open("GET",y,!0),m.addEventListener("load",function(e){var a=e.target.response;Ka.add(y,a),200===this.status?(t&&t(a),i.manager.itemEnd(y)):0===this.status?(console.warn("THREE.FileLoader: HTTP Status 0 received."),t&&t(a),i.manager.itemEnd(y)):(b&&b(e),i.manager.itemEnd(y),i.manager.itemError(y))},!1),void 0!==e&&m.addEventListener("progress",function(a){e(a)},!1),m.addEventListener("error",function(t){b&&b(t),i.manager.itemEnd(y),i.manager.itemError(y)},!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0===this.mimeType?"text/plain":this.mimeType),this.requestHeader)m.setRequestHeader(_,this.requestHeader[_]);m.send(null)}return i.manager.itemStart(y),m},setPath:function(e){return this.path=e,this},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),Object.assign(function(e){this.manager=void 0===e?Qa:e,this._parser=null}.prototype,{load:function(d,p,e,t){var u=this,r=[],o=new je;o.image=r;var a=new Bn(this.manager);if(a.setPath(this.path),a.setResponseType("arraybuffer"),Array.isArray(d))for(var i=0,n=0,l=d.length;n<l;++n)!function(l){a.load(d[l],function(e){var t=u._parser(e,!0);r[l]={width:t.width,height:t.height,format:t.format,mipmaps:t.mipmaps},6===(i+=1)&&(1===t.mipmapCount&&(o.minFilter=Kc),o.format=t.format,o.needsUpdate=!0,p&&p(o))},e,t)}(n);else a.load(d,function(e){var t=u._parser(e,!0);if(t.isCubemap)for(var a=t.mipmaps.length/t.mipmapCount,n=0;n<a;n++){r[n]={mipmaps:[]};for(var i=0;i<t.mipmapCount;i++)r[n].mipmaps.push(t.mipmaps[n*t.mipmapCount+i]),r[n].format=t.format,r[n].width=t.width,r[n].height=t.height}else o.image.width=t.width,o.image.height=t.height,o.mipmaps=t.mipmaps;1===t.mipmapCount&&(o.minFilter=Kc),o.format=t.format,o.needsUpdate=!0,p&&p(o)},e,t);return o},setPath:function(e){return this.path=e,this}}),Object.assign(function(e){this.manager=void 0===e?Qa:e,this._parser=null}.prototype,{load:function(s,c,e,t){var i=this,r=new l,o=new Bn(this.manager);return o.setResponseType("arraybuffer"),o.load(s,function(e){var t=i._parser(e);t&&(void 0===t.image?void 0!==t.data&&(r.image.width=t.width,r.image.height=t.height,r.image.data=t.data):r.image=t.image,r.wrapS=void 0===t.wrapS?qc:t.wrapS,r.wrapT=void 0===t.wrapT?qc:t.wrapT,r.magFilter=void 0===t.magFilter?Kc:t.magFilter,r.minFilter=void 0===t.minFilter?$c:t.minFilter,r.anisotropy=void 0===t.anisotropy?1:t.anisotropy,void 0!==t.format&&(r.format=t.format),void 0!==t.type&&(r.type=t.type),void 0!==t.mipmaps&&(r.mipmaps=t.mipmaps),1===t.mipmapCount&&(r.minFilter=Kc),r.needsUpdate=!0,c&&c(r,t))},e,t),r}}),Object.assign(zn.prototype,{crossOrigin:"Anonymous",load:function(l,t,e,n){void 0===l&&(l=""),void 0!==this.path&&(l=this.path+l);var i=this,r=Ka.get(l);if(void 0!==r)return i.manager.itemStart(l),setTimeout(function(){t&&t(r),i.manager.itemEnd(l)},0),r;var o=document.createElementNS("http://www.w3.org/1999/xhtml","img");return o.addEventListener("load",function(){Ka.add(l,this),t&&t(this),i.manager.itemEnd(l)},!1),o.addEventListener("error",function(t){n&&n(t),i.manager.itemEnd(l),i.manager.itemError(l)},!1),"data:"!==l.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(l),o.src=l,o},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(function(e){this.manager=void 0===e?Qa:e}.prototype,{crossOrigin:"Anonymous",load:function(l,d,e,t){var i=new c,r=new zn(this.manager);r.setCrossOrigin(this.crossOrigin),r.setPath(this.path);for(var o=0,a=0;a<l.length;++a)!function(e){r.load(l[e],function(a){i.images[e]=a,6==++o&&(i.needsUpdate=!0,d&&d(i))},void 0,t)}(a);return i},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(jn.prototype,{crossOrigin:"Anonymous",load:function(o,t,e,n){var i=new zn(this.manager);i.setCrossOrigin(this.crossOrigin),i.setPath(this.path);var r=new tl;return r.image=i.load(o,function(){var e=0<o.search(/\.(jpg|jpeg)$/)||0===o.search(/^data\:image\/jpeg/);r.format=e?ea:td,r.needsUpdate=!0,void 0!==t&&t(r)},e,n),r},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Vn.prototype=Object.assign(Object.create(ut.prototype),{constructor:Vn,isLight:!0,copy:function(e){return ut.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(a){var t=ut.prototype.toJSON.call(this,a);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),Ys.prototype=Object.assign(Object.create(Vn.prototype),{constructor:Ys,isHemisphereLight:!0,copy:function(e){return Vn.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(Zs.prototype,{copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),Xn.prototype=Object.assign(Object.create(Zs.prototype),{constructor:Xn,isSpotLightShadow:!0,update:function(a){var t=this.camera,e=2*rd.RAD2DEG*a.angle,o=this.mapSize.width/this.mapSize.height,n=a.distance||t.far;e===t.fov&&o===t.aspect&&n===t.far||(t.fov=e,t.aspect=o,t.far=n,t.updateProjectionMatrix())}}),Js.prototype=Object.assign(Object.create(Vn.prototype),{constructor:Js,isSpotLight:!0,copy:function(e){return Vn.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Ks.prototype=Object.assign(Object.create(Vn.prototype),{constructor:Ks,isPointLight:!0,copy:function(e){return Vn.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),Qs.prototype=Object.assign(Object.create(Zs.prototype),{constructor:Qs}),$s.prototype=Object.assign(Object.create(Vn.prototype),{constructor:$s,isDirectionalLight:!0,copy:function(e){return Vn.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),ec.prototype=Object.assign(Object.create(Vn.prototype),{constructor:ec,isAmbientLight:!0}),tc.prototype=Object.assign(Object.create(Vn.prototype),{constructor:tc,isRectAreaLight:!0,copy:function(e){return Vn.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(a){var t=Vn.prototype.toJSON.call(this,a);return t.object.width=this.width,t.object.height=this.height,t}});var $a={arraySlice:function(a,t,e){return $a.isTypedArray(a)?new a.constructor(a.subarray(t,void 0===e?a.length:e)):a.slice(t,e)},convertArray:function(a,t,e){return a&&(e||a.constructor!==t)?"number"==typeof t.BYTES_PER_ELEMENT?new t(a):Array.prototype.slice.call(a):a},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(a){for(var t=a.length,e=Array(t),o=0;o!==t;++o)e[o]=o;return e.sort(function(t,e){return a[t]-a[e]}),e},sortedArray:function(c,t,e){for(var n=c.length,i=new c.constructor(n),r=0,o=0;o!==n;++r)for(var a=e[r]*t,s=0;s!==t;++s)i[o++]=c[a+s];return i},flattenJSON:function(l,t,e,n){for(var i=1,r=l[0];void 0!==r&&void 0===r[n];)r=l[i++];if(void 0!==r){var o=r[n];if(void 0!==o)if(Array.isArray(o))do void 0!==(o=r[n])&&(t.push(r.time),e.push.apply(e,o)),r=l[i++];while(void 0!==r);else if(void 0!==o.toArray)do void 0!==(o=r[n])&&(t.push(r.time),o.toArray(e,e.length)),r=l[i++];while(void 0!==r);else do void 0!==(o=r[n])&&(t.push(r.time),e.push(o)),r=l[i++];while(void 0!==r)}}};Object.assign(ac.prototype,{evaluate:function(c){var t=this.parameterPositions,e=this._cachedIndex,n=t[e],i=t[e-1];t:{e:{var r;n:{i:if(!(c<n)){for(a=e+2;;){if(void 0===n){if(c<i)break i;return e=t.length,this._cachedIndex=e,this.afterEnd_(e-1,c,i)}if(e===a)break;if(i=n,n=t[++e],c<n)break e}r=t.length;break n}if(c>=i)break t;var o=t[1];c<o&&(e=2,i=o);for(var a=e-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,c,n);if(e===a)break;if(n=i,i=t[--e-1],c>=i)break e}r=e,e=0}for(;e<r;){var s=e+r>>>1;c<t[s]?r=s:e=s+1}if(n=t[e],void 0===(i=t[e-1]))return this._cachedIndex=0,this.beforeStart_(0,c,n);if(void 0===n)return e=t.length,this._cachedIndex=e,this.afterEnd_(e-1,i,c)}this._cachedIndex=e,this.intervalChanged_(e,i,n)}return this.interpolate_(e,i,c,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(a){for(var t=this.resultBuffer,e=this.sampleValues,r=this.valueSize,n=0;n!==r;++n)t[n]=e[a*r+n];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(ac.prototype,{beforeStart_:ac.prototype.copySampleValue_,afterEnd_:ac.prototype.copySampleValue_}),ei.prototype=Object.assign(Object.create(ac.prototype),{constructor:ei,DefaultSettings_:{endingStart:ga,endingEnd:ga},intervalChanged_:function(d,t,e){var n=this.parameterPositions,i=d-2,r=d+1,o=n[i],a=n[r];if(void 0===o)switch(this.getSettings_().endingStart){case 2401:i=d,o=2*t-e;break;case 2402:o=t+n[i=n.length-2]-n[i+1];break;default:i=d,o=e;}if(void 0===a)switch(this.getSettings_().endingEnd){case 2401:r=d,a=2*e-t;break;case 2402:r=1,a=e+n[1]-n[0];break;default:r=d-1,a=t;}var s=.5*(e-t),l=this.valueSize;this._weightPrev=s/(t-o),this._weightNext=s/(a-e),this._offsetPrev=i*l,this._offsetNext=r*l},interpolate_:function(l,t,e,n){for(var i=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=l*o,s=this._offsetPrev,c=this._offsetNext,_=this._weightPrev,h=this._weightNext,p=(e-t)/(n-t),d=p*p,g=d*p,m=0;m!==o;++m)i[m]=(-_*g+2*_*d-_*p)*r[s+m]+((1+_)*g+(-1.5-2*_)*d+(-.5+_)*p+1)*r[a-o+m]+((-1-h)*g+(1.5+h)*d+.5*p)*r[a+m]+(h*g-h*d)*r[c+m];return i}}),oc.prototype=Object.assign(Object.create(ac.prototype),{constructor:oc,interpolate_:function(l,t,e,n){for(var i=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=l*o,s=(e-t)/(n-t),c=0;c!==o;++c)i[c]=r[a-o+c]*(1-s)+r[a+c]*s;return i}}),rc.prototype=Object.assign(Object.create(ac.prototype),{constructor:rc,interpolate_:function(e){return this.copySampleValue_(e-1)}});var ts;ts={TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(e){return new rc(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new oc(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new ei(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(a){var t;if(2300===a?t=this.InterpolantFactoryMethodDiscrete:2301===a?t=this.InterpolantFactoryMethodLinear:2302===a?t=this.InterpolantFactoryMethodSmooth:void 0,void 0!==t)this.createInterpolant=t;else{var e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(a===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}console.warn("THREE.KeyframeTrackPrototype:",e)}},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302;}},getValueSize:function(){return this.values.length/this.times.length},shift:function(a){if(0!==a)for(var t=this.times,e=0,o=t.length;e!==o;++e)t[e]+=a;return this},scale:function(a){if(1!==a)for(var t=this.times,e=0,o=t.length;e!==o;++e)t[e]*=a;return this},trim:function(l,t){for(var e=this.times,n=e.length,i=0,r=n-1;i!==n&&e[i]<l;)++i;for(;-1!==r&&e[r]>t;)--r;if(++r,0!==i||r!==n){i>=r&&(r=C(r,1),i=r-1);var o=this.getValueSize();this.times=$a.arraySlice(e,i,r),this.values=$a.arraySlice(this.values,i*o,r*o)}return this},validate:function(){var d=!0,t=this.getValueSize();0!=t-z(t)&&(console.error("THREE.KeyframeTrackPrototype: Invalid value size in track.",this),d=!1);var e=this.times,n=this.values,i=e.length;0===i&&(console.error("THREE.KeyframeTrackPrototype: Track is empty.",this),d=!1);for(var r=null,o=0,a;o!==i;o++){if(a=e[o],"number"==typeof a&&isNaN(a)){console.error("THREE.KeyframeTrackPrototype: Time is not a valid number.",this,o,a),d=!1;break}if(null!==r&&r>a){console.error("THREE.KeyframeTrackPrototype: Out of order keys.",this,o,a,r),d=!1;break}r=a}if(void 0!==n&&$a.isTypedArray(n))for(var o=0,p=n.length,l;o!==p;++o)if(l=n[o],isNaN(l)){console.error("THREE.KeyframeTrackPrototype: Value is not a valid number.",this,o,l),d=!1;break}return d},optimize:function(){for(var u=this.times,t=this.values,e=this.getValueSize(),n=2302===this.getInterpolation(),i=1,r=u.length-1,o=1;o<r;++o){var a=!1,s=u[o];if(s!==u[o+1]&&(1!==o||s!==s[0]))if(n)a=!0;else for(var l=o*e,c=0,p;c!==e;++c)if(p=t[l+c],p!==t[l-e+c]||p!==t[l+e+c]){a=!0;break}if(a){if(o!==i){u[i]=u[o];for(var d=o*e,_=i*e,c=0;c!==e;++c)t[_+c]=t[d+c]}++i}}if(0<r){u[i]=u[r];for(var d=r*e,_=i*e,c=0;c!==e;++c)t[_+c]=t[d+c];++i}return i!==u.length&&(this.times=$a.arraySlice(u,0,i),this.values=$a.arraySlice(t,0,i*e)),this}},oi.prototype=Object.assign(Object.create(ts),{constructor:oi,ValueTypeName:"vector"}),ic.prototype=Object.assign(Object.create(ac.prototype),{constructor:ic,interpolate_:function(l,t,e,n){for(var i=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=l*o,s=a+o;a!==s;a+=4)rl.slerpFlat(i,0,r,a-o,r,a,(e-t)/(n-t));return i}}),lc.prototype=Object.assign(Object.create(ts),{constructor:lc,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(e){return new ic(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),sc.prototype=Object.assign(Object.create(ts),{constructor:sc,ValueTypeName:"number"}),cc.prototype=Object.assign(Object.create(ts),{constructor:cc,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),dc.prototype=Object.assign(Object.create(ts),{constructor:dc,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),pc.prototype=Object.assign(Object.create(ts),{constructor:pc,ValueTypeName:"color"}),uc.prototype=ts,ts.constructor=uc,Object.assign(uc,{parse:function(a){if(void 0===a.type)throw new Error("track type undefined, can not parse");var t=uc._getTrackTypeForValueTypeName(a.type);if(void 0===a.times){var e=[],o=[];$a.flattenJSON(a.keys,e,o,"value"),a.times=e,a.values=o}return void 0===t.parse?new t(a.name,a.times,a.values,a.interpolation):t.parse(a)},toJSON:function(a){var t=a.constructor,o;if(void 0!==t.toJSON)o=t.toJSON(a);else{o={name:a.name,times:$a.convertArray(a.times,Array),values:$a.convertArray(a.values,Array)};var e=a.getInterpolation();e!==a.DefaultInterpolation&&(o.interpolation=e)}return o.type=a.ValueTypeName,o},_getTrackTypeForValueTypeName:function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return sc;case"vector":case"vector2":case"vector3":case"vector4":return oi;case"color":return pc;case"quaternion":return lc;case"bool":case"boolean":return dc;case"string":return cc;}throw new Error("Unsupported typeName: "+e)}}),Object.assign(di,{parse:function(a){for(var t=[],e=a.tracks,n=1/(a.fps||1),i=0,r=e.length;i!==r;++i)t.push(uc.parse(e[i]).scale(n));return new di(a.name,a.duration,t)},toJSON:function(a){for(var t=[],l=a.tracks,n={name:a.name,duration:a.duration,tracks:t},i=0,r=l.length;i!==r;++i)t.push(uc.toJSON(l[i]));return n},CreateFromMorphTargetSequence:function(d,t,e,n){for(var i=t.length,r=[],o=0;o<i;o++){var a=[],s=[];a.push((o+i-1)%i,o,(o+1)%i),s.push(0,1,0);var l=$a.getKeyframeOrder(a);a=$a.sortedArray(a,1,l),s=$a.sortedArray(s,1,l),n||0!==a[0]||(a.push(i),s.push(s[0])),r.push(new sc(".morphTargetInfluences["+t[o].name+"]",a,s).scale(1/e))}return new di(d,-1,r)},findByName:function(a,t){var e=a;if(!Array.isArray(a)){var o=a;e=o.geometry&&o.geometry.animations||o.animations}for(var n=0;n<e.length;n++)if(e[n].name===t)return e[n];return null},CreateClipsFromMorphTargetSequences:function(d,t,e){for(var n={},i=/^([\w-]*?)([\d]+)$/,r=0,o=d.length;r<o;r++){var a=d[r],s=a.name.match(i);if(s&&1<s.length){var l=n[p=s[1]];l||(n[p]=l=[]),l.push(a)}}var c=[];for(var p in n)c.push(di.CreateFromMorphTargetSequence(p,n[p],t,e));return c},parseAnimation:function(y,b){if(!y)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var e=function(n,t,e,l,i){if(0!==e.length){var r=[],o=[];$a.flattenJSON(e,r,o,l),0!==r.length&&i.push(new n(t,r,o))}},n=[],i=y.name||"default",r=y.length||-1,o=y.fps||30,a=y.hierarchy||[],s=0,l;s<a.length;s++)if(l=a[s].keys,l&&0!==l.length)if(l[0].morphTargets){for(var c={},h=0;h<l.length;h++)if(l[h].morphTargets)for(f=0;f<l[h].morphTargets.length;f++)c[l[h].morphTargets[f]]=-1;for(var u in c){for(var p=[],d=[],f=0,m;f!==l[h].morphTargets.length;++f)m=l[h],p.push(m.time),d.push(m.morphTarget===u?1:0);n.push(new sc(".morphTargetInfluence["+u+"]",p,d))}r=c.length*(o||1)}else{var _=".bones["+b[s].name+"]";e(oi,_+".position",l,"pos",n),e(lc,_+".quaternion",l,"rot",n),e(oi,_+".scale",l,"scl",n)}return 0===n.length?null:new di(i,r,n)}}),Object.assign(di.prototype,{resetDuration:function(){for(var a=0,t=0,e=this.tracks.length,o;t!==e;++t)o=this.tracks[t],a=C(a,o.times[o.times.length-1]);this.duration=a},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}}),Object.assign(fi.prototype,{load:function(a,o,e,t){var n=this;new Bn(n.manager).load(a,function(e){o(n.parse(JSON.parse(e)))},e,t)},setTextures:function(e){this.textures=e},parse:function(a){function t(a){return void 0===e[a]&&console.warn("THREE.MaterialLoader: Undefined texture",a),e[a]}var e=this.textures,r=new Ja[a.type];if(void 0!==a.uuid&&(r.uuid=a.uuid),void 0!==a.name&&(r.name=a.name),void 0!==a.color&&r.color.setHex(a.color),void 0!==a.roughness&&(r.roughness=a.roughness),void 0!==a.metalness&&(r.metalness=a.metalness),void 0!==a.emissive&&r.emissive.setHex(a.emissive),void 0!==a.specular&&r.specular.setHex(a.specular),void 0!==a.shininess&&(r.shininess=a.shininess),void 0!==a.clearCoat&&(r.clearCoat=a.clearCoat),void 0!==a.clearCoatRoughness&&(r.clearCoatRoughness=a.clearCoatRoughness),void 0!==a.uniforms&&(r.uniforms=a.uniforms),void 0!==a.vertexShader&&(r.vertexShader=a.vertexShader),void 0!==a.fragmentShader&&(r.fragmentShader=a.fragmentShader),void 0!==a.vertexColors&&(r.vertexColors=a.vertexColors),void 0!==a.fog&&(r.fog=a.fog),void 0!==a.flatShading&&(r.flatShading=a.flatShading),void 0!==a.blending&&(r.blending=a.blending),void 0!==a.side&&(r.side=a.side),void 0!==a.opacity&&(r.opacity=a.opacity),void 0!==a.transparent&&(r.transparent=a.transparent),void 0!==a.alphaTest&&(r.alphaTest=a.alphaTest),void 0!==a.depthTest&&(r.depthTest=a.depthTest),void 0!==a.depthWrite&&(r.depthWrite=a.depthWrite),void 0!==a.colorWrite&&(r.colorWrite=a.colorWrite),void 0!==a.wireframe&&(r.wireframe=a.wireframe),void 0!==a.wireframeLinewidth&&(r.wireframeLinewidth=a.wireframeLinewidth),void 0!==a.wireframeLinecap&&(r.wireframeLinecap=a.wireframeLinecap),void 0!==a.wireframeLinejoin&&(r.wireframeLinejoin=a.wireframeLinejoin),void 0!==a.skinning&&(r.skinning=a.skinning),void 0!==a.morphTargets&&(r.morphTargets=a.morphTargets),void 0!==a.dithering&&(r.dithering=a.dithering),void 0!==a.visible&&(r.visible=a.visible),void 0!==a.userData&&(r.userData=a.userData),void 0!==a.shading&&(r.flatShading=1===a.shading),void 0!==a.size&&(r.size=a.size),void 0!==a.sizeAttenuation&&(r.sizeAttenuation=a.sizeAttenuation),void 0!==a.map&&(r.map=t(a.map)),void 0!==a.alphaMap&&(r.alphaMap=t(a.alphaMap),r.transparent=!0),void 0!==a.bumpMap&&(r.bumpMap=t(a.bumpMap)),void 0!==a.bumpScale&&(r.bumpScale=a.bumpScale),void 0!==a.normalMap&&(r.normalMap=t(a.normalMap)),void 0!==a.normalScale){var n=a.normalScale;!1===Array.isArray(n)&&(n=[n,n]),r.normalScale=new el().fromArray(n)}return void 0!==a.displacementMap&&(r.displacementMap=t(a.displacementMap)),void 0!==a.displacementScale&&(r.displacementScale=a.displacementScale),void 0!==a.displacementBias&&(r.displacementBias=a.displacementBias),void 0!==a.roughnessMap&&(r.roughnessMap=t(a.roughnessMap)),void 0!==a.metalnessMap&&(r.metalnessMap=t(a.metalnessMap)),void 0!==a.emissiveMap&&(r.emissiveMap=t(a.emissiveMap)),void 0!==a.emissiveIntensity&&(r.emissiveIntensity=a.emissiveIntensity),void 0!==a.specularMap&&(r.specularMap=t(a.specularMap)),void 0!==a.envMap&&(r.envMap=t(a.envMap)),void 0!==a.reflectivity&&(r.reflectivity=a.reflectivity),void 0!==a.lightMap&&(r.lightMap=t(a.lightMap)),void 0!==a.lightMapIntensity&&(r.lightMapIntensity=a.lightMapIntensity),void 0!==a.aoMap&&(r.aoMap=t(a.aoMap)),void 0!==a.aoMapIntensity&&(r.aoMapIntensity=a.aoMapIntensity),void 0!==a.gradientMap&&(r.gradientMap=t(a.gradientMap)),r}}),Object.assign(mi.prototype,{load:function(a,o,e,t){var n=this;new Bn(n.manager).load(a,function(e){o(n.parse(JSON.parse(e)))},e,t)},parse:function(m){var t=new bl,e=m.data.index;void 0!==e&&(o=new es[e.type](e.array),t.setIndex(new yt(o,1)));var n=m.data.attributes;for(var i in n){var r=n[i],o=new es[r.type](r.array);t.addAttribute(i,new yt(o,r.itemSize,r.normalized))}var a=m.data.groups||m.data.drawcalls||m.data.offsets;if(void 0!==a)for(var s=0,l=a.length,c;s!==l;++s)c=a[s],t.addGroup(c.start,c.count,c.materialIndex);var u=m.data.boundingSphere;if(void 0!==u){var p=new nl;void 0!==u.center&&p.fromArray(u.center),t.boundingSphere=new it(p,u.radius)}return t}});var es={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"==typeof Uint8ClampedArray?Uint8Array:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};_i.Handlers={handlers:[],add:function(a,t){this.handlers.push(a,t)},get:function(a){for(var t=this.handlers,e=0,n=t.length;e<n;e+=2){var i=t[e],r=t[e+1];if(i.test(a))return r}return null}},Object.assign(_i.prototype,{crossOrigin:void 0,extractUrlBase:function(a){var t=a.split("/");return 1===t.length?"./":(t.pop(),t.join("/")+"/")},initMaterials:function(a,t,e){for(var o=[],n=0;n<a.length;++n)o[n]=this.createMaterial(a[n],t,e);return o},createMaterial:function(){var a={NoBlending:Rc,NormalBlending:Dc,AdditiveBlending:kc,SubtractiveBlending:Fc,MultiplyBlending:Nc,CustomBlending:Uc},t=new X,d=new jn,e=new fi;return function(n,m,o){function r(a,t,e,n,r){var i=m+a,l=_i.Handlers.get(i),u;null===l?(d.setCrossOrigin(o),u=d.load(i)):u=l.load(i),void 0!==t&&(u.repeat.fromArray(t),1!==t[0]&&(u.wrapS=jc),1!==t[1]&&(u.wrapT=jc)),void 0!==e&&u.offset.fromArray(e),void 0!==n&&("repeat"===n[0]&&(u.wrapS=jc),"mirror"===n[0]&&(u.wrapS=Xc),"repeat"===n[1]&&(u.wrapT=jc),"mirror"===n[1]&&(u.wrapT=Xc)),void 0!==r&&(u.anisotropy=r);var c=rd.generateUUID();return _[c]=u,c}var _={},i={uuid:rd.generateUUID(),type:"MeshLambertMaterial"};for(var l in n){var s=n[l];switch(l){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":i.name=s;break;case"blending":i.blending=a[s];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",l,"is no longer supported.");break;case"colorDiffuse":i.color=t.fromArray(s).getHex();break;case"colorSpecular":i.specular=t.fromArray(s).getHex();break;case"colorEmissive":i.emissive=t.fromArray(s).getHex();break;case"specularCoef":i.shininess=s;break;case"shading":"basic"===s.toLowerCase()&&(i.type="MeshBasicMaterial"),"phong"===s.toLowerCase()&&(i.type="MeshPhongMaterial"),"standard"===s.toLowerCase()&&(i.type="MeshStandardMaterial");break;case"mapDiffuse":i.map=r(s,n.mapDiffuseRepeat,n.mapDiffuseOffset,n.mapDiffuseWrap,n.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":i.emissiveMap=r(s,n.mapEmissiveRepeat,n.mapEmissiveOffset,n.mapEmissiveWrap,n.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":i.lightMap=r(s,n.mapLightRepeat,n.mapLightOffset,n.mapLightWrap,n.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":i.aoMap=r(s,n.mapAORepeat,n.mapAOOffset,n.mapAOWrap,n.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":i.bumpMap=r(s,n.mapBumpRepeat,n.mapBumpOffset,n.mapBumpWrap,n.mapBumpAnisotropy);break;case"mapBumpScale":i.bumpScale=s;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":i.normalMap=r(s,n.mapNormalRepeat,n.mapNormalOffset,n.mapNormalWrap,n.mapNormalAnisotropy);break;case"mapNormalFactor":i.normalScale=[s,s];break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":i.specularMap=r(s,n.mapSpecularRepeat,n.mapSpecularOffset,n.mapSpecularWrap,n.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":i.metalnessMap=r(s,n.mapMetalnessRepeat,n.mapMetalnessOffset,n.mapMetalnessWrap,n.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":i.roughnessMap=r(s,n.mapRoughnessRepeat,n.mapRoughnessOffset,n.mapRoughnessWrap,n.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":i.alphaMap=r(s,n.mapAlphaRepeat,n.mapAlphaOffset,n.mapAlphaWrap,n.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":i.side=Fr;break;case"doubleSided":i.side=Ac;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),i.opacity=s;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":i[l]=s;break;case"vertexColors":!0===s&&(i.vertexColors=Ic),"face"===s&&(i.vertexColors=Br);break;default:console.error("THREE.Loader.createMaterial: Unsupported",l,s);}}return"MeshBasicMaterial"===i.type&&delete i.emissive,"MeshPhongMaterial"!==i.type&&delete i.specular,1>i.opacity&&(i.transparent=!0),e.setTextures(_),e.parse(i)}}()}),Object.assign(gi.prototype,{load:function(l,t,e,n){var c=this,r=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:_i.prototype.extractUrlBase(l),o=new Bn(this.manager);o.setWithCredentials(this.withCredentials),o.load(l,function(e){var o=JSON.parse(e),n=o.metadata;if(void 0!==n){var a=n.type;if(void 0!==a){if("object"===a.toLowerCase())return void console.error("THREE.JSONLoader: "+l+" should be loaded with THREE.ObjectLoader instead.");if("scene"===a.toLowerCase())return void console.error("THREE.JSONLoader: "+l+" should be loaded with THREE.SceneLoader instead.")}}var i=c.parse(o,r);t(i.geometry,i.materials)},e,n)},setTexturePath:function(e){this.texturePath=e},parse:function(){function l(r,h){function e(a,t){return a&1<<t}var n=r.faces,C=r.vertices,L=r.normals,R=r.colors,k=r.scale,D=0,F,i,o,a,s,l,c,u,p,d,f,m,_,g,y,v,b,w,x,S,E,M,T,A,P;if(void 0!==r.uvs){for(F=0;F<r.uvs.length;F++)r.uvs[F].length&&D++;for(F=0;F<D;F++)h.faceVertexUvs[F]=[]}for(a=0,s=C.length;a<s;)(w=new nl).x=C[a++]*k,w.y=C[a++]*k,w.z=C[a++]*k,h.vertices.push(w);for(a=0,s=n.length;a<s;)if(d=n[a++],f=e(d,0),m=e(d,1),_=e(d,3),g=e(d,4),y=e(d,5),v=e(d,6),b=e(d,7),f){if(S=new yl,S.a=n[a],S.b=n[a+1],S.c=n[a+3],E=new yl,E.a=n[a+1],E.b=n[a+2],E.c=n[a+3],a+=4,m&&(p=n[a++],S.materialIndex=p,E.materialIndex=p),o=h.faces.length,_)for(F=0;F<D;F++)for(A=r.uvs[F],h.faceVertexUvs[F][o]=[],h.faceVertexUvs[F][o+1]=[],i=0;4>i;i++)P=new el(A[2*(u=n[a++])],A[2*u+1]),2!==i&&h.faceVertexUvs[F][o].push(P),0!==i&&h.faceVertexUvs[F][o+1].push(P);if(g&&(c=3*n[a++],S.normal.set(L[c++],L[c++],L[c]),E.normal.copy(S.normal)),y)for(F=0;4>F;F++)c=3*n[a++],T=new nl(L[c++],L[c++],L[c]),2!==F&&S.vertexNormals.push(T),0!==F&&E.vertexNormals.push(T);if(v&&(M=R[l=n[a++]],S.color.setHex(M),E.color.setHex(M)),b)for(F=0;4>F;F++)M=R[l=n[a++]],2!==F&&S.vertexColors.push(new X(M)),0!==F&&E.vertexColors.push(new X(M));h.faces.push(S),h.faces.push(E)}else{if(x=new yl,x.a=n[a++],x.b=n[a++],x.c=n[a++],m&&(p=n[a++],x.materialIndex=p),o=h.faces.length,_)for(F=0;F<D;F++)for(A=r.uvs[F],h.faceVertexUvs[F][o]=[],i=0;3>i;i++)P=new el(A[2*(u=n[a++])],A[2*u+1]),h.faceVertexUvs[F][o].push(P);if(g&&(c=3*n[a++],x.normal.set(L[c++],L[c++],L[c])),y)for(F=0;3>F;F++)c=3*n[a++],T=new nl(L[c++],L[c++],L[c]),x.vertexNormals.push(T);if(v&&(l=n[a++],x.color.setHex(R[l])),b)for(F=0;3>F;F++)l=n[a++],x.vertexColors.push(new X(R[l]));h.faces.push(x)}}function t(a,t){var m=void 0===a.influencesPerVertex?2:a.influencesPerVertex;if(a.skinWeights)for(var n=0,i=a.skinWeights.length;n<i;n+=m){var r=a.skinWeights[n],o=1<m?a.skinWeights[n+1]:0,s=2<m?a.skinWeights[n+2]:0,l=3<m?a.skinWeights[n+3]:0;t.skinWeights.push(new al(r,o,s,l))}if(a.skinIndices)for(var n=0,i=a.skinIndices.length;n<i;n+=m){var c=a.skinIndices[n],_=1<m?a.skinIndices[n+1]:0,u=2<m?a.skinIndices[n+2]:0,p=3<m?a.skinIndices[n+3]:0;t.skinIndices.push(new al(c,_,u,p))}t.bones=a.bones,t.bones&&0<t.bones.length&&(t.skinWeights.length!==t.skinIndices.length||t.skinIndices.length!==t.vertices.length)&&console.warn("When skinning, number of vertices ("+t.vertices.length+"), skinIndices ("+t.skinIndices.length+"), and skinWeights ("+t.skinWeights.length+") should match.")}function e(d,t){var e=d.scale;if(void 0!==d.morphTargets)for(var m=0,i=d.morphTargets.length;m<i;m++){t.morphTargets[m]={},t.morphTargets[m].name=d.morphTargets[m].name,t.morphTargets[m].vertices=[];for(var r=t.morphTargets[m].vertices,o=d.morphTargets[m].vertices,a=0,s=o.length,l;a<s;a+=3)l=new nl,l.x=o[a]*e,l.y=o[a+1]*e,l.z=o[a+2]*e,r.push(l)}if(void 0!==d.morphColors&&0<d.morphColors.length){console.warn("THREE.JSONLoader: \"morphColors\" no longer supported. Using them as face colors.");for(var c=t.faces,u=d.morphColors[0].colors,m=0,i=c.length;m<i;m++)c[m].color.fromArray(u,3*m)}}function n(l,t){var e=[],n=[];void 0!==l.animation&&n.push(l.animation),void 0!==l.animations&&(l.animations.length?n=n.concat(l.animations):n.push(l.animations));for(var s=0,r;s<n.length;s++)r=di.parseAnimation(n[s],t.bones),r&&e.push(r);if(t.morphTargets){var o=di.CreateClipsFromMorphTargetSequences(t.morphTargets,10);e=e.concat(o)}0<e.length&&(t.animations=e)}return function(i,r){void 0!==i.data&&(i=i.data),i.scale=void 0===i.scale?1:1/i.scale;var o=new gt;return l(i,o),t(i,o),e(i,o),n(i,o),o.computeFaceNormals(),o.computeBoundingSphere(),void 0===i.materials||0===i.materials.length?{geometry:o}:{geometry:o,materials:_i.prototype.initMaterials(i.materials,r,this.crossOrigin)}}}()}),Object.assign(function(e){this.manager=void 0===e?Qa:e,this.texturePath=""}.prototype,{load:function(l,t,e,a){""===this.texturePath&&(this.texturePath=l.substring(0,l.lastIndexOf("/")+1));var i=this;new Bn(i.manager).load(l,function(e){var r=null;try{r=JSON.parse(e)}catch(t){return void 0!==a&&a(t),void console.error("THREE:ObjectLoader: Can't parse "+l+".",t.message)}var o=r.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?i.parse(r,t):console.error("THREE.ObjectLoader: Can't load "+l+". Use THREE.JSONLoader instead.")},e,a)},setTexturePath:function(e){this.texturePath=e},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(l,t){var e=this.parseGeometries(l.geometries),n=this.parseImages(l.images,function(){void 0!==t&&t(o)}),i=this.parseTextures(l.textures,n),r=this.parseMaterials(l.materials,i),o=this.parseObject(l.object,e,r);return l.animations&&(o.animations=this.parseAnimations(l.animations)),void 0!==l.images&&0!==l.images.length||void 0!==t&&t(o),o},parseGeometries:function(l){var t={};if(void 0!==l)for(var e=new gi,n=new mi,i=0,r=l.length;i<r;i++){var o=l[i],s;switch(o.type){case"PlaneGeometry":case"PlaneBufferGeometry":s=new Za[o.type](o.width,o.height,o.widthSegments,o.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":s=new Za[o.type](o.width,o.height,o.depth,o.widthSegments,o.heightSegments,o.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":s=new Za[o.type](o.radius,o.segments,o.thetaStart,o.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":s=new Za[o.type](o.radiusTop,o.radiusBottom,o.height,o.radialSegments,o.heightSegments,o.openEnded,o.thetaStart,o.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":s=new Za[o.type](o.radius,o.height,o.radialSegments,o.heightSegments,o.openEnded,o.thetaStart,o.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":s=new Za[o.type](o.radius,o.widthSegments,o.heightSegments,o.phiStart,o.phiLength,o.thetaStart,o.thetaLength);break;case"DodecahedronGeometry":case"IcosahedronGeometry":case"OctahedronGeometry":case"TetrahedronGeometry":s=new Za[o.type](o.radius,o.detail);break;case"RingGeometry":case"RingBufferGeometry":s=new Za[o.type](o.innerRadius,o.outerRadius,o.thetaSegments,o.phiSegments,o.thetaStart,o.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":s=new Za[o.type](o.radius,o.tube,o.radialSegments,o.tubularSegments,o.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":s=new Za[o.type](o.radius,o.tube,o.tubularSegments,o.radialSegments,o.p,o.q);break;case"LatheGeometry":case"LatheBufferGeometry":s=new Za[o.type](o.points,o.segments,o.phiStart,o.phiLength);break;case"BufferGeometry":s=n.parse(o);break;case"Geometry":s=e.parse(o,this.texturePath).geometry;break;default:console.warn("THREE.ObjectLoader: Unsupported geometry type \""+o.type+"\"");continue;}s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),t[o.uuid]=s}return t},parseMaterials:function(c,t){var e={};if(void 0!==c){var n=new fi;n.setTextures(t);for(var i=0,r=c.length,o;i<r;i++)if(o=c[i],"MultiMaterial"===o.type){for(var a=[],s=0;s<o.materials.length;s++)a.push(n.parse(o.materials[s]));e[o.uuid]=a}else e[o.uuid]=n.parse(o)}return e},parseAnimations:function(a){for(var t=[],e=0,o;e<a.length;e++)o=di.parse(a[e]),t.push(o);return t},parseImages:function(c,t){var e=this,n={};if(void 0!==c&&0<c.length){var i=new zn(new Xs(t));i.setCrossOrigin(this.crossOrigin);for(var r=0,o=c.length;r<o;r++){var a=c[r],s=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(a.url)?a.url:e.texturePath+a.url;n[a.uuid]=function(a){return e.manager.itemStart(a),i.load(a,function(){e.manager.itemEnd(a)},void 0,function(){e.manager.itemEnd(a),e.manager.itemError(a)})}(s)}}return n},parseTextures:function(o,t){function e(a,o){return"number"==typeof a?a:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",a),o[a])}var n={};if(void 0!==o)for(var i=0,r=o.length,a;i<r;i++){a=o[i],void 0===a.image&&console.warn("THREE.ObjectLoader: No \"image\" specified for",a.uuid),void 0===t[a.image]&&console.warn("THREE.ObjectLoader: Undefined image",a.image);var s=new tl(t[a.image]);s.needsUpdate=!0,s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),void 0!==a.mapping&&(s.mapping=e(a.mapping,ns)),void 0!==a.offset&&s.offset.fromArray(a.offset),void 0!==a.repeat&&s.repeat.fromArray(a.repeat),void 0!==a.wrap&&(s.wrapS=e(a.wrap[0],is),s.wrapT=e(a.wrap[1],is)),void 0!==a.minFilter&&(s.minFilter=e(a.minFilter,rs)),void 0!==a.magFilter&&(s.magFilter=e(a.magFilter,rs)),void 0!==a.anisotropy&&(s.anisotropy=a.anisotropy),void 0!==a.flipY&&(s.flipY=a.flipY),n[a.uuid]=s}return n},parseObject:function(){var m=new il;return function(t,e,_){function n(a){return void 0===e[a]&&console.warn("THREE.ObjectLoader: Undefined geometry",a),e[a]}function r(a){if(void 0!==a){if(Array.isArray(a)){for(var t=[],e=0,n=a.length,r;e<n;e++)r=a[e],void 0===_[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),t.push(_[r]);return t}return void 0===_[a]&&console.warn("THREE.ObjectLoader: Undefined material",a),_[a]}}var o;switch(t.type){case"Scene":o=new Te,void 0!==t.background&&Tc(t.background)&&(o.background=new X(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?o.fog=new Me(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(o.fog=new Ee(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":o=new fl(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(o.focus=t.focus),void 0!==t.zoom&&(o.zoom=t.zoom),void 0!==t.filmGauge&&(o.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(o.filmOffset=t.filmOffset),void 0!==t.view&&(o.view=Object.assign({},t.view));break;case"OrthographicCamera":o=new ht(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":o=new ec(t.color,t.intensity);break;case"DirectionalLight":o=new $s(t.color,t.intensity);break;case"PointLight":o=new Ks(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":o=new tc(t.color,t.intensity,t.width,t.height);break;case"SpotLight":o=new Js(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":o=new Ys(t.color,t.groundColor,t.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var a=n(t.geometry),i=r(t.material);o=a.bones&&0<a.bones.length?new Il(a,i):new Bt(a,i);break;case"LOD":o=new Ll;break;case"Line":o=new Dl(n(t.geometry),r(t.material),t.mode);break;case"LineLoop":o=new Fl(n(t.geometry),r(t.material));break;case"LineSegments":o=new kl(n(t.geometry),r(t.material));break;case"PointCloud":case"Points":o=new Ul(n(t.geometry),r(t.material));break;case"Sprite":o=new Cl(r(t.material));break;case"Group":o=new Bl;break;default:o=new ut;}if(o.uuid=t.uuid,void 0!==t.name&&(o.name=t.name),void 0===t.matrix?(void 0!==t.position&&o.position.fromArray(t.position),void 0!==t.rotation&&o.rotation.fromArray(t.rotation),void 0!==t.quaternion&&o.quaternion.fromArray(t.quaternion),void 0!==t.scale&&o.scale.fromArray(t.scale)):(m.fromArray(t.matrix),m.decompose(o.position,o.quaternion,o.scale)),void 0!==t.castShadow&&(o.castShadow=t.castShadow),void 0!==t.receiveShadow&&(o.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(o.shadow.bias=t.shadow.bias),void 0!==t.shadow.radius&&(o.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&o.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(o.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(o.visible=t.visible),void 0!==t.userData&&(o.userData=t.userData),void 0!==t.children)for(var l=t.children,s=0;s<l.length;s++)o.add(this.parseObject(l[s],e,_));if("LOD"===t.type)for(var c=t.levels,u=0;u<c.length;u++){var p=c[u],d=o.getObjectByProperty("uuid",p.object);void 0!==d&&o.addLevel(d,p.distance)}return o}}()});var ns={UVMapping:300,CubeReflectionMapping:To,CubeRefractionMapping:zc,EquirectangularReflectionMapping:Oc,EquirectangularRefractionMapping:Gc,SphericalReflectionMapping:Hc,CubeUVReflectionMapping:Vc,CubeUVRefractionMapping:Wc},is={RepeatWrapping:jc,ClampToEdgeWrapping:qc,MirroredRepeatWrapping:Xc},rs={NearestFilter:Yc,NearestMipMapNearestFilter:Zc,NearestMipMapLinearFilter:Jc,LinearFilter:Kc,LinearMipMapNearestFilter:Qc,LinearMipMapLinearFilter:$c};Object.assign(Pi.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(a){var t=this.getUtoTmapping(a);return this.getPoint(t)},getPoints:function(a){void 0===a&&(a=5);for(var t=[],e=0;e<=a;e++)t.push(this.getPoint(e/a));return t},getSpacedPoints:function(a){void 0===a&&(a=5);for(var t=[],e=0;e<=a;e++)t.push(this.getPointAt(e/a));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(a){if(void 0===a&&(a=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===a+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t=[],i=this.getPoint(0),r=0,o,e;for(t.push(0),e=1;e<=a;e++)r+=(o=this.getPoint(e/a)).distanceTo(i),t.push(r),i=o;return this.cacheArcLengths=t,t},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(d,t){var e=this.getLengths(),i=0,r=e.length,o;o=t||d*e[r-1];for(var n=0,s=r-1,l;n<=s;)if(i=z(n+(s-n)/2),0>(l=e[i]-o))n=i+1;else{if(!(0<l)){s=i;break}s=i-1}if(i=s,e[i]===o)return i/(r-1);var a=e[i];return(i+(o-a)/(e[i+1]-a))/(r-1)},getTangent:function(a){var t=a-1e-4,e=a+1e-4;0>t&&(t=0),1<e&&(e=1);var o=this.getPoint(t);return this.getPoint(e).clone().sub(o).normalize()},getTangentAt:function(a){var t=this.getUtoTmapping(a);return this.getTangent(t)},computeFrenetFrames:function(u,t){var e=new nl,o=[],h=[],g=[],y=new nl,c=new il,p,n,i;for(p=0;p<=u;p++)n=p/u,o[p]=this.getTangentAt(n),o[p].normalize();h[0]=new nl,g[0]=new nl;var x=b,d=B(o[0].x),f=B(o[0].y),m=B(o[0].z);for(d<=x&&(x=d,e.set(1,0,0)),f<=x&&(x=f,e.set(0,1,0)),m<=x&&e.set(0,0,1),y.crossVectors(o[0],e).normalize(),h[0].crossVectors(o[0],y),g[0].crossVectors(o[0],h[0]),p=1;p<=u;p++)h[p]=h[p-1].clone(),g[p]=g[p-1].clone(),y.crossVectors(o[p-1],o[p]),y.length()>Mc&&(y.normalize(),i=wc(rd.clamp(o[p-1].dot(o[p]),-1,1)),h[p].applyMatrix4(c.makeRotationAxis(y,i))),g[p].crossVectors(o[p],h[p]);if(!0===t)for(i=wc(rd.clamp(h[0].dot(h[u]),-1,1)),i/=u,0<o[0].dot(y.crossVectors(h[0],h[u]))&&(i=-i),p=1;p<=u;p++)h[p].applyMatrix4(c.makeRotationAxis(o[p],i*p)),g[p].crossVectors(o[p],h[p]);return{tangents:o,normals:h,binormals:g}}}),(Ii.prototype=Object.create(Pi.prototype)).constructor=Ii,Ii.prototype.isLineCurve=!0,Ii.prototype.getPoint=function(a){if(1===a)return this.v2.clone();var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(a).add(this.v1),t},Ii.prototype.getPointAt=function(e){return this.getPoint(e)},Ii.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},Ci.prototype=Object.assign(Object.create(Pi.prototype),{constructor:Ci,add:function(e){this.curves.push(e)},closePath:function(){var a=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);a.equals(t)||this.curves.push(new Ii(t,a))},getPoint:function(l){for(var t=l*this.getLength(),e=this.getCurveLengths(),n=0;n<e.length;){if(e[n]>=t){var i=e[n]-t,r=this.curves[n],o=r.getLength(),a=0===o?0:1-i/o;return r.getPointAt(a)}n++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var a=[],t=0,e=0,o=this.curves.length;e<o;e++)t+=this.curves[e].getLength(),a.push(t);return this.cacheLengths=a,a},getSpacedPoints:function(a){void 0===a&&(a=40);for(var t=[],e=0;e<=a;e++)t.push(this.getPoint(e/a));return this.autoClose&&t.push(t[0]),t},getPoints:function(d){d=d||12;for(var t=[],n=0,i=this.curves,r;n<i.length;n++)for(var e=i[n],o=e&&e.isEllipseCurve?2*d:e&&e.isLineCurve?1:e&&e.isSplineCurve?d*e.points.length:d,a=e.getPoints(o),s=0,l;s<a.length;s++)l=a[s],r&&r.equals(l)||(t.push(l),r=l);return this.autoClose&&1<t.length&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t},createPointsGeometry:function(a){var t=this.getPoints(a);return this.createGeometry(t)},createSpacedPointsGeometry:function(a){var t=this.getSpacedPoints(a);return this.createGeometry(t)},createGeometry:function(a){for(var t=new gt,e=0,o=a.length,n;e<o;e++)n=a[e],t.vertices.push(new nl(n.x,n.y,n.z||0));return t}}),mc.prototype=Object.create(Pi.prototype),mc.prototype.constructor=mc,mc.prototype.isEllipseCurve=!0,mc.prototype.getPoint=function(r){for(var t=2*Gn,d=this.aEndAngle-this.aStartAngle,n=B(d)<Mc;0>d;)d+=t;for(;d>t;)d-=t;d<Mc&&(d=n?0:t),!0!==this.aClockwise||n||(d===t?d=-t:d-=t);var i=this.aStartAngle+r*d,o=this.aX+this.xRadius*Cc(i),a=this.aY+this.yRadius*Pc(i);if(0!==this.aRotation){var s=Cc(this.aRotation),l=Pc(this.aRotation),c=o-this.aX,p=a-this.aY;o=c*s-p*l+this.aX,a=c*l+p*s+this.aY}return new el(o,a)},(Ri.prototype=Object.create(Pi.prototype)).constructor=Ri,Ri.prototype.isSplineCurve=!0,Ri.prototype.getPoint=function(r){var t=this.points,e=(t.length-1)*r,n=z(e),i=e-n,o=t[0===n?n:n-1],a=t[n],s=t[n>t.length-2?t.length-1:n+1],l=t[n>t.length-3?t.length-1:n+2];return new el(yi(i,o.x,a.x,s.x,l.x),yi(i,o.y,a.y,s.y,l.y))},(ki.prototype=Object.create(Pi.prototype)).constructor=ki,ki.prototype.getPoint=function(a){var t=this.v0,e=this.v1,r=this.v2,n=this.v3;return new el(Ai(a,t.x,e.x,r.x,n.x),Ai(a,t.y,e.y,r.y,n.y))},(Di.prototype=Object.create(Pi.prototype)).constructor=Di,Di.prototype.getPoint=function(a){var t=this.v0,e=this.v1,o=this.v2;return new el(xi(a,t.x,e.x,o.x),xi(a,t.y,e.y,o.y))};var os=Object.assign(Object.create(Ci.prototype),{fromPoints:function(a){this.moveTo(a[0].x,a[0].y);for(var t=1,e=a.length;t<e;t++)this.lineTo(a[t].x,a[t].y)},moveTo:function(a,t){this.currentPoint.set(a,t)},lineTo:function(a,t){var e=new Ii(this.currentPoint.clone(),new el(a,t));this.curves.push(e),this.currentPoint.set(a,t)},quadraticCurveTo:function(a,t,e,r){var n=new Di(this.currentPoint.clone(),new el(a,t),new el(e,r));this.curves.push(n),this.currentPoint.set(e,r)},bezierCurveTo:function(r,t,e,n,i,o){var a=new ki(this.currentPoint.clone(),new el(r,t),new el(e,n),new el(i,o));this.curves.push(a),this.currentPoint.set(i,o)},splineThru:function(a){var t=new Ri([this.currentPoint.clone()].concat(a));this.curves.push(t),this.currentPoint.copy(a[a.length-1])},arc:function(l,t,e,n,i,r){var o=this.currentPoint.x,a=this.currentPoint.y;this.absarc(l+o,t+a,e,n,i,r)},absarc:function(a,t,e,n,i,r){this.absellipse(a,t,e,e,n,i,r)},ellipse:function(d,t,e,n,i,r,o,a){var s=this.currentPoint.x,l=this.currentPoint.y;this.absellipse(d+s,t+l,e,n,i,r,o,a)},absellipse:function(d,t,e,n,i,r,o,a){var s=new mc(d,t,e,n,i,r,o,a);if(0<this.curves.length){var l=s.getPoint(0);l.equals(this.currentPoint)||this.lineTo(l.x,l.y)}this.curves.push(s);var c=s.getPoint(1);this.currentPoint.copy(c)}});Oi.prototype=os,os.constructor=Oi,Fi.prototype=Object.assign(Object.create(os),{constructor:Fi,getPointsHoles:function(a){for(var t=[],e=0,o=this.holes.length;e<o;e++)t[e]=this.holes[e].getPoints(a);return t},extractAllPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},extractPoints:function(e){return this.extractAllPoints(e)}}),Object.assign(_c.prototype,{moveTo:function(a,t){this.currentPath=new Oi,this.subPaths.push(this.currentPath),this.currentPath.moveTo(a,t)},lineTo:function(a,t){this.currentPath.lineTo(a,t)},quadraticCurveTo:function(a,t,e,o){this.currentPath.quadraticCurveTo(a,t,e,o)},bezierCurveTo:function(a,t,e,n,i,r){this.currentPath.bezierCurveTo(a,t,e,n,i,r)},splineThru:function(e){this.currentPath.splineThru(e)},toShapes:function(C,t){function e(a){for(var t=[],e=0,l=a.length;e<l;e++){var i=a[e],r=new Fi;r.curves=i.curves,t.push(r)}return t}var n=Ya.isClockWise,i=this.subPaths;if(0===i.length)return[];if(!0===t)return e(i);var r=[],l,L,R;if(1===i.length)return L=i[0],R=new Fi,R.curves=L.curves,r.push(R),r;var s=!n(i[0].getPoints());s=C?!s:s;var D=[],u=[],p=[],d=0,f;u[d]=void 0,p[d]=[];for(var k=0,m=i.length;k<m;k++)l=n(f=(L=i[k]).getPoints()),(l=C?!l:l)?(!s&&u[d]&&d++,u[d]={s:new Fi,p:f},u[d].s.curves=L.curves,s&&d++,p[d]=[]):p[d].push({h:L,p:f[0]});if(!u[0])return e(i);if(1<u.length){for(var _=!1,g=[],y=0,F=u.length;y<F;y++)D[y]=[];for(var y=0,F=u.length;y<F;y++)for(var b=p[y],w=0;w<b.length;w++){for(var N=b[w],S=!0,E=0;E<u.length;E++)(function(d,t){for(var e=t.length,n=!1,p=e-1,r=0;r<e;p=r++){var o=t[p],a=t[r],s=a.x-o.x,u=a.y-o.y;if(B(u)>Mc){if(0>u&&(o=t[r],s=-s,a=t[p],u=-u),d.y<o.y||d.y>a.y)continue;if(d.y!==o.y){var m=u*(d.x-o.x)-s*(d.y-o.y);if(0===m)return!0;if(0>m)continue;n=!n}else if(d.x===o.x)return!0}else{if(d.y!==o.y)continue;if(a.x<=d.x&&d.x<=o.x||o.x<=d.x&&d.x<=a.x)return!0}}return n})(N.p,u[E].p)&&(y!==E&&g.push({froms:y,tos:E,hole:w}),S?(S=!1,D[E].push(N)):_=!0);S&&D[y].push(N)}0<g.length&&(_||(p=D))}for(var k=0,U=u.length,A;k<U;k++){R=u[k].s,r.push(R);for(var T=0,P=(A=p[k]).length;T<P;T++)R.holes.push(A[T].h)}return r}}),Object.assign(Ni.prototype,{isFont:!0,generateShapes:function(c,d,e){function t(r,t,n,M){var o=T.glyphs[r]||T.glyphs["?"];if(o){var a=new _c,P=[],v,s,l,c,h,u,p,d,f,m,_;if(o.o)for(var g=o._cachedOutline||(o._cachedOutline=o.o.split(" ")),b=0,w=g.length;b<w;)switch(g[b++]){case"m":v=g[b++]*t+n,s=g[b++]*t+M,a.moveTo(v,s);break;case"l":v=g[b++]*t+n,s=g[b++]*t+M,a.lineTo(v,s);break;case"q":if(l=g[b++]*t+n,c=g[b++]*t+M,p=g[b++]*t+n,d=g[b++]*t+M,a.quadraticCurveTo(p,d,l,c),_=P[P.length-1])for(h=_.x,u=_.y,x=1;x<=e;x++)xi(S=x/e,h,p,l),xi(S,u,d,c);break;case"b":if(l=g[b++]*t+n,c=g[b++]*t+M,p=g[b++]*t+n,d=g[b++]*t+M,f=g[b++]*t+n,m=g[b++]*t+M,a.bezierCurveTo(p,d,f,m,l,c),_=P[P.length-1]){h=_.x,u=_.y;for(var x=1,S;x<=e;x++)S=x/e,Ai(S,h,p,f,l),Ai(S,u,d,m,c)}}return{offsetX:o.ha*t,path:a}}}void 0===d&&(d=100),void 0===e&&(e=4);for(var T=this.data,r=function(e){for(var r=(e+"").split(""),n=d/T.resolution,o=(T.boundingBox.yMax-T.boundingBox.yMin+T.underlineThickness)*n,a=0,i=0,l=[],s=0,c;s<r.length;s++)if(c=r[s],"\n"===c)a=0,i-=o;else{var u=t(c,n,a,i);a+=u.offsetX,l.push(u.path)}return l}(c),o=[],a=0,n=r.length;a<n;a++)Array.prototype.push.apply(o,r[a].toShapes());return o}}),Object.assign(function(e){this.manager=void 0===e?Qa:e}.prototype,{load:function(a,o,e,t){var l=this;new Bn(this.manager).load(a,function(e){var t;try{t=JSON.parse(e)}catch(a){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),t=JSON.parse(e.substring(65,e.length-2))}var a=l.parse(t);o&&o(a)},e,t)},parse:function(e){return new Ni(e)}});var as={getContext:function(){return void 0===ls&&(ls=new(window.AudioContext||window.webkitAudioContext)),ls},setContext:function(e){ls=e}},ls;Object.assign(Bi.prototype,{load:function(a,o,e,t){var n=new Bn(this.manager);n.setResponseType("arraybuffer"),n.load(a,function(e){as.getContext().decodeAudioData(e,function(e){o(e)})},e,t)}}),Object.assign(function(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new fl,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new fl,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}.prototype,{update:function(){var _=new il,l=new il,c,t,e,n,i,r,o,a;return function(g){if(c!==this||t!==g.focus||e!==g.fov||n!==g.aspect*this.aspect||i!==g.near||r!==g.far||o!==g.zoom||a!==this.eyeSep){c=this,t=g.focus,e=g.fov,n=g.aspect*this.aspect,i=g.near,r=g.far,o=g.zoom;var h=g.projectionMatrix.clone(),d=(a=this.eyeSep/2)*i/t,f=i*Pr(.5*(rd.DEG2RAD*e))/o,y,u;l.elements[12]=-a,_.elements[12]=a,y=-f*n+d,u=f*n+d,h.elements[0]=2*i/(u-y),h.elements[8]=(u+y)/(u-y),this.cameraL.projectionMatrix.copy(h),y=-f*n-d,u=f*n-d,h.elements[0]=2*i/(u-y),h.elements[8]=(u+y)/(u-y),this.cameraR.projectionMatrix.copy(h)}this.cameraL.matrixWorld.copy(g.matrixWorld).multiply(l),this.cameraR.matrixWorld.copy(g.matrixWorld).multiply(_)}}()}),(zi.prototype=Object.create(ut.prototype)).constructor=zi,Gi.prototype=Object.assign(Object.create(ut.prototype),{constructor:Gi,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(e){null===this.filter?this.gain.disconnect(this.context.destination):(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){this.gain.gain.value=e},updateMatrixWorld:function(){var l=new nl,t=new rl,e=new nl,n=new nl;return function(i){ut.prototype.updateMatrixWorld.call(this,i);var r=this.context.listener,o=this.up;this.matrixWorld.decompose(l,t,e),n.set(0,0,-1).applyQuaternion(t),r.positionX?(r.positionX.setValueAtTime(l.x,this.context.currentTime),r.positionY.setValueAtTime(l.y,this.context.currentTime),r.positionZ.setValueAtTime(l.z,this.context.currentTime),r.forwardX.setValueAtTime(n.x,this.context.currentTime),r.forwardY.setValueAtTime(n.y,this.context.currentTime),r.forwardZ.setValueAtTime(n.z,this.context.currentTime),r.upX.setValueAtTime(o.x,this.context.currentTime),r.upY.setValueAtTime(o.y,this.context.currentTime),r.upZ.setValueAtTime(o.z,this.context.currentTime)):(r.setPosition(l.x,l.y,l.z),r.setOrientation(n.x,n.y,n.z,o.x,o.y,o.z))}}()}),hc.prototype=Object.assign(Object.create(ut.prototype),{constructor:hc,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.onended=this.onEnded.bind(this),e.playbackRate.setValueAtTime(this.playbackRate,this.startTime),e.start(0,this.startTime),this.isPlaying=!0,this.source=e,this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){return!1===this.hasPlaybackControl?void console.warn("THREE.Audio: this Audio has no playback control."):(this.source.stop(),this.startTime=this.context.currentTime,this.isPlaying=!1,this)},stop:function(){return!1===this.hasPlaybackControl?void console.warn("THREE.Audio: this Audio has no playback control."):(this.source.stop(),this.startTime=0,this.isPlaying=!1,this)},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var a=1,t=this.filters.length;a<t;a++)this.filters[a-1].connect(this.filters[a]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var a=1,t=this.filters.length;a<t;a++)this.filters[a-1].disconnect(this.filters[a]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){return!1===this.hasPlaybackControl?void console.warn("THREE.Audio: this Audio has no playback control."):(this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this)},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){return!1===this.hasPlaybackControl?void console.warn("THREE.Audio: this Audio has no playback control."):(this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this)},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.value=e,this}}),gc.prototype=Object.assign(Object.create(hc.prototype),{constructor:gc,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){this.panner.refDistance=e},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){this.panner.rolloffFactor=e},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){this.panner.distanceModel=e},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){this.panner.maxDistance=e},updateMatrixWorld:function(){var a=new nl;return function(t){ut.prototype.updateMatrixWorld.call(this,t),a.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(a.x,a.y,a.z)}}()}),Object.assign(fc.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var a=0,t=this.getFrequencyData(),e=0;e<t.length;e++)a+=t[e];return a/t.length}}),Object.assign(Wi.prototype,{accumulate:function(l,t){var e=this.buffer,n=this.valueSize,i=l*n+n,r=this.cumulativeWeight;if(0===r){for(var o=0;o!==n;++o)e[i+o]=e[o];r=t}else{var a=t/(r+=t);this._mixBufferRegion(e,i,0,a,n)}this.cumulativeWeight=r},apply:function(a){var t=this.valueSize,e=this.buffer,n=a*t+t,i=this.cumulativeWeight,r=this.binding;if(this.cumulativeWeight=0,1>i){this._mixBufferRegion(e,n,3*t,1-i,t)}for(var o=t;o!==t+t;++o)if(e[o]!==e[o+t]){r.setValue(e,n);break}},saveOriginalState:function(){var a=this.binding,t=this.buffer,e=this.valueSize,o=3*e;a.getValue(t,o);for(var n=e;n!==o;++n)t[n]=t[o+n%e];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(a,t,e,n,i){if(.5<=n)for(var r=0;r!==i;++r)a[t+r]=a[e+r]},_slerp:function(a,t,e,o){rl.slerpFlat(a,t,a,t,a,e,o)},_lerp:function(o,t,e,n,i){for(var r=0,a;r!==i;++r)a=t+r,o[a]=o[a]*(1-n)+o[e+r]*n}}),Object.assign(qi.prototype,{getValue:function(a,t){this.bind();var e=this._targetGroup.nCachedObjects_,o=this._bindings[e];void 0!==o&&o.getValue(a,t)},setValue:function(a,t){for(var e=this._bindings,o=this._targetGroup.nCachedObjects_,n=e.length;o!==n;++o)e[o].setValue(a,t)},bind:function(){for(var a=this._bindings,t=this._targetGroup.nCachedObjects_,e=a.length;t!==e;++t)a[t].bind()},unbind:function(){for(var a=this._bindings,t=this._targetGroup.nCachedObjects_,e=a.length;t!==e;++t)a[t].unbind()}}),Object.assign(yc,{Composite:qi,create:function(a,t,e){return a&&a.isAnimationObjectGroup?new yc.Composite(a,t,e):new yc(a,t,e)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(/[^\w-]/g,"")},parseTrackName:function(){var a=/((?:[\w-]+[\/:])*)/,t=/([\w-\.]+)?/,e=/(?:\.([\w-]+)(?:\[(.+)\])?)?/,n=/\.([\w-]+)(?:\[(.+)\])?/,l=new RegExp("^"+a.source+t.source+e.source+n.source+"$"),r=["material","materials","bones"];return function(o){var t=l.exec(o);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+o);var s={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=s.nodeName&&s.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){var i=s.nodeName.substring(n+1);-1!==r.indexOf(i)&&(s.nodeName=s.nodeName.substring(0,n),s.objectName=i)}if(null===s.propertyName||0===s.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+o);return s}}(),findNode:function(a,l){if(!l||""===l||"root"===l||"."===l||-1===l||l===a.name||l===a.uuid)return a;if(a.skeleton){var t=function(e){for(var t=0,a;t<e.bones.length;t++)if(a=e.bones[t],a.name===l)return a;return null}(a.skeleton);if(t)return t}if(a.children){var o=function e(a){for(var t=0,n;t<a.length;t++){if(n=a[t],n.name===l||n.uuid===l)return n;var r=e(n.children);if(r)return r}return null},n=o(a.children);if(n)return n}return null}}),Object.assign(yc.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(a,t){a[t]=this.node[this.propertyName]},function(a,t){for(var e=this.resolvedProperty,o=0,n=e.length;o!==n;++o)a[t++]=e[o]},function(a,t){a[t]=this.resolvedProperty[this.propertyIndex]},function(a,t){this.resolvedProperty.toArray(a,t)}],SetterByBindingTypeAndVersioning:[[function(a,t){this.node[this.propertyName]=a[t]},function(a,t){this.node[this.propertyName]=a[t],this.targetObject.needsUpdate=!0},function(a,t){this.node[this.propertyName]=a[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,t){for(var e=this.resolvedProperty,o=0,n=e.length;o!==n;++o)e[o]=a[t++]},function(a,t){for(var e=this.resolvedProperty,o=0,n=e.length;o!==n;++o)e[o]=a[t++];this.targetObject.needsUpdate=!0},function(a,t){for(var e=this.resolvedProperty,o=0,n=e.length;o!==n;++o)e[o]=a[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,t){this.resolvedProperty[this.propertyIndex]=a[t]},function(a,t){this.resolvedProperty[this.propertyIndex]=a[t],this.targetObject.needsUpdate=!0},function(a,t){this.resolvedProperty[this.propertyIndex]=a[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,t){this.resolvedProperty.fromArray(a,t)},function(a,t){this.resolvedProperty.fromArray(a,t),this.targetObject.needsUpdate=!0},function(a,t){this.resolvedProperty.fromArray(a,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(a,t){this.bind(),this.getValue(a,t)},setValue:function(a,t){this.bind(),this.setValue(a,t)},bind:function(){var d=this.node,t=this.parsedPath,e=t.objectName,n=t.propertyName,i=t.propertyIndex;if(d||(d=yc.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=d),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,d){if(e){var r=t.objectIndex;switch(e){case"materials":if(!d.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!d.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);d=d.material.materials;break;case"bones":if(!d.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);for(d=d.skeleton.bones,l=0;l<d.length;l++)if(d[l].name===r){r=l;break}break;default:if(void 0===d[e])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);d=d[e];}if(void 0!==r){if(void 0===d[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,d);d=d[r]}}var o=d[n];if(void 0!==o){var a=this.Versioning.None;void 0===d.needsUpdate?void 0!==d.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=d):(a=this.Versioning.NeedsUpdate,this.targetObject=d);var s=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===n){if(!d.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(d.geometry.isBufferGeometry){if(!d.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(l=0;l<this.node.geometry.morphAttributes.position.length;l++)if(d.geometry.morphAttributes.position[l].name===i){i=l;break}}else{if(!d.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(var l=0;l<this.node.geometry.morphTargets.length;l++)if(d.geometry.morphTargets[l].name===i){i=l;break}}}s=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=i}else void 0!==o.fromArray&&void 0!==o.toArray?(s=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(s=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=n;this.getValue=this.GetterByBindingType[s],this.setValue=this.SetterByBindingTypeAndVersioning[s][a]}else{var c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+n+" but it wasn't found.",d)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(yc.prototype,{_getValue_unbound:yc.prototype.getValue,_setValue_unbound:yc.prototype.setValue}),Object.assign(function(){this.uuid=rd.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var e=0,a=arguments.length;e!==a;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var o=this;this.stats={objects:{get total(){return o._objects.length},get inUse(){return this.total-o.nCachedObjects_}},get bindingsPerObject(){return o._bindings.length}}}.prototype,{isAnimationObjectGroup:!0,add:function(){for(var t=this._objects,e=t.length,n=this.nCachedObjects_,i=this._indicesByUUID,r=this._paths,o=this._parsedPaths,a=this._bindings,s=a.length,l=0,c=arguments.length;l!==c;++l){var h=arguments[l],u=h.uuid,p=i[u],d=void 0;if(void 0===p){p=e++,i[u]=p,t.push(h);for(var f=0,m=s;f!==m;++f)a[f].push(new yc(h,r[f],o[f]))}else if(p<n){d=t[p];var _=--n,g=t[_];i[g.uuid]=p,t[p]=g,i[u]=_,t[_]=h;for(var f=0,m=s;f!==m;++f){var y=a[f],x=y[_],b=y[p];y[p]=x,void 0===b&&(b=new yc(h,r[f],o[f])),y[_]=b}}else t[p]!==d&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=n},remove:function(){for(var t=this._objects,e=this.nCachedObjects_,n=this._indicesByUUID,i=this._bindings,r=i.length,o=0,a=arguments.length;o!==a;++o){var s=arguments[o],l=s.uuid,c=n[l];if(void 0!==c&&c>=e){var h=e++,u=t[h];n[u.uuid]=c,t[c]=u,n[l]=h,t[h]=s;for(var p=0;p!==r;++p){var d=i[p],m=d[h],_=d[c];d[c]=m,d[h]=_}}}this.nCachedObjects_=e},uncache:function(){for(var t=this._objects,e=t.length,n=this.nCachedObjects_,i=this._indicesByUUID,r=this._bindings,o=r.length,a=0,s=arguments.length;a!==s;++a){var l=arguments[a].uuid,c=i[l];if(void 0!==c)if(delete i[l],c<n){var h=--n,u=t[h],p=t[g=--e];i[u.uuid]=c,t[c]=u,i[p.uuid]=h,t[h]=p,t.pop();for(var d=0,f=o;d!==f;++d){var m=(y=r[d])[h],_=y[g];y[c]=m,y[h]=_,y.pop()}}else{var g=--e;i[(p=t[g]).uuid]=c,t[c]=p,t.pop();for(var d=0,f=o,y;d!==f;++d)y=r[d],y[c]=y[g],y.pop()}}this.nCachedObjects_=n},subscribe_:function(m,t){var e=this._bindingsIndicesByPath,n=e[m],i=this._bindings;if(void 0!==n)return i[n];var r=this._paths,o=this._parsedPaths,a=this._objects,s=a.length,l=this.nCachedObjects_,c=Array(s);n=i.length,e[m]=n,r.push(m),o.push(t),i.push(c);for(var _=l,u=a.length,p;_!==u;++_)p=a[_],c[_]=new yc(p,m,t);return c},unsubscribe_:function(l){var t=this._bindingsIndicesByPath,e=t[l];if(void 0!==e){var n=this._paths,i=this._parsedPaths,r=this._bindings,o=r.length-1,a=r[o];t[l[o]]=e,r[e]=a,r.pop(),i[e]=i[o],i.pop(),n[e]=n[o],n.pop()}}}),Object.assign(Yi.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(a,t){return this.loop=a,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(a,t,e){if(a.fadeOut(t),this.fadeIn(t),e){var o=this._clip.duration,n=a._clip.duration;a.warp(1,n/o,t),this.warp(o/n,1,t)}return this},crossFadeTo:function(a,t,e){return a.crossFadeFrom(this,t,e)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(c,t,e){var n=this._mixer,i=n.time,r=this._timeScaleInterpolant,o=this.timeScale;null===r&&(r=n._lendControlInterpolant(),this._timeScaleInterpolant=r);var a=r.parameterPositions,s=r.sampleValues;return a[0]=i,a[1]=i+e,s[0]=c/o,s[1]=t/o,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(d,t,e,n){if(this.enabled){var i=this._startTime;if(null!==i){var r=(d-i)*e;if(0>r||0===e)return;this._startTime=null,t=e*r}t*=this._updateTimeScale(d);var o=this._updateTime(t),a=this._updateWeight(d);if(0<a)for(var s=this._interpolants,l=this._propertyBindings,c=0,p=s.length;c!==p;++c)s[c].evaluate(o),l[c].accumulate(n,a)}else this._updateWeight(d)},_updateWeight:function(a){var t=0;if(this.enabled){t=this.weight;var e=this._weightInterpolant;if(null!==e){var o=e.evaluate(a)[0];t*=o,a>e.parameterPositions[1]&&(this.stopFading(),0===o&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(a){var t=0;if(!this.paused){t=this.timeScale;var e=this._timeScaleInterpolant;null!==e&&(t*=e.evaluate(a)[0],a>e.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t},_updateTime:function(c){var t=this.time+c;if(0===c)return t;var e=this._clip.duration,n=this.loop,i=this._loopCount;if(2200===n){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(t>=e)t=e;else{if(!(0>t))break t;t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:0>c?-1:1})}}else{var r=2202===n;if(-1===i&&(0<=c?(i=0,this._setEndings(!0,0===this.repetitions,r)):this._setEndings(0===this.repetitions,!0,r)),t>=e||0>t){var o=z(t/e);t-=e*o,i+=B(o);var d=this.repetitions-i;if(0>d)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=0<c?e:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<c?1:-1});else{if(0===d){var s=0>c;this._setEndings(s,!s,r)}else this._setEndings(!1,!1,r);this._loopCount=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}if(r&&1==(1&i))return this.time=t,e-t}return this.time=t,t},_setEndings:function(a,t,e){var o=this._interpolantSettings;e?(o.endingStart=2401,o.endingEnd=2401):(o.endingStart=a?this.zeroSlopeAtStart?2401:ga:2402,o.endingEnd=t?this.zeroSlopeAtEnd?2401:ga:2402)},_scheduleFading:function(l,t,e){var n=this._mixer,i=n.time,r=this._weightInterpolant;null===r&&(r=n._lendControlInterpolant(),this._weightInterpolant=r);var o=r.parameterPositions,a=r.sampleValues;return o[0]=i,a[0]=t,o[1]=i+l,a[1]=e,this}}),Object.assign(function(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}.prototype,n.prototype,{_bindAction:function(m,t){var e=m._localRoot||this._root,n=m._clip.tracks,i=n.length,r=m._propertyBindings,o=m._interpolants,a=e.uuid,s=this._bindingsByRootAndName,l=s[a];void 0===l&&(l={},s[a]=l);for(var c=0;c!==i;++c){var _=n[c],u=_.name,p=l[u];if(void 0!==p)r[c]=p;else{if(void 0!==(p=r[c])){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,a,u));continue}var d=t&&t._propertyBindings[c].binding.parsedPath;++(p=new Wi(yc.create(e,u,d),_.ValueTypeName,_.getValueSize())).referenceCount,this._addInactiveBinding(p,a,u),r[c]=p}o[c].resultBuffer=p.buffer}},_activateAction:function(l){if(!this._isActiveAction(l)){if(null===l._cacheIndex){var t=(l._localRoot||this._root).uuid,e=l._clip.uuid,n=this._actionsByClip[e];this._bindAction(l,n&&n.knownActions[0]),this._addInactiveAction(l,e,t)}for(var i=l._propertyBindings,r=0,o=i.length,a;r!==o;++r)a=i[r],0==a.useCount++&&(this._lendBinding(a),a.saveOriginalState());this._lendAction(l)}},_deactivateAction:function(a){if(this._isActiveAction(a)){for(var t=a._propertyBindings,e=0,o=t.length,n;e!==o;++e)n=t[e],0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n));this._takeBackAction(a)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(a){var t=a._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(l,t,e){var n=this._actions,i=this._actionsByClip,r=i[t];if(void 0===r)r={knownActions:[l],actionByRoot:{}},l._byClipCacheIndex=0,i[t]=r;else{var o=r.knownActions;l._byClipCacheIndex=o.length,o.push(l)}l._cacheIndex=n.length,n.push(l),r.actionByRoot[e]=l},_removeInactiveAction:function(d){var t=this._actions,e=t[t.length-1],n=d._cacheIndex;e._cacheIndex=n,t[n]=e,t.pop(),d._cacheIndex=null;var i=d._clip.uuid,r=this._actionsByClip,o=r[i],a=o.knownActions,s=a[a.length-1],l=d._byClipCacheIndex;s._byClipCacheIndex=l,a[l]=s,a.pop(),d._byClipCacheIndex=null,delete o.actionByRoot[(d._localRoot||this._root).uuid],0===a.length&&delete r[i],this._removeInactiveBindingsForAction(d)},_removeInactiveBindingsForAction:function(a){for(var t=a._propertyBindings,e=0,o=t.length,n;e!==o;++e)n=t[e],0==--n.referenceCount&&this._removeInactiveBinding(n)},_lendAction:function(a){var t=this._actions,e=a._cacheIndex,o=this._nActiveActions++,n=t[o];a._cacheIndex=o,t[o]=a,n._cacheIndex=e,t[e]=n},_takeBackAction:function(a){var t=this._actions,e=a._cacheIndex,o=--this._nActiveActions,n=t[o];a._cacheIndex=o,t[o]=a,n._cacheIndex=e,t[e]=n},_addInactiveBinding:function(a,t,e){var n=this._bindingsByRootAndName,i=n[t],r=this._bindings;void 0===i&&(i={},n[t]=i),i[e]=a,a._cacheIndex=r.length,r.push(a)},_removeInactiveBinding:function(d){var t=this._bindings,e=d.binding,n=e.rootNode.uuid,i=e.path,r=this._bindingsByRootAndName,o=r[n],a=t[t.length-1],s=d._cacheIndex;a._cacheIndex=s,t[s]=a,t.pop(),delete o[i];t:{for(var l in o)break t;delete r[n]}},_lendBinding:function(a){var t=this._bindings,e=a._cacheIndex,o=this._nActiveBindings++,n=t[o];a._cacheIndex=o,t[o]=a,n._cacheIndex=e,t[e]=n},_takeBackBinding:function(a){var t=this._bindings,e=a._cacheIndex,o=--this._nActiveBindings,n=t[o];a._cacheIndex=o,t[o]=a,n._cacheIndex=e,t[e]=n},_lendControlInterpolant:function(){var a=this._controlInterpolants,t=this._nActiveControlInterpolants++,e=a[t];return void 0===e&&((e=new oc(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,a[t]=e),e},_takeBackControlInterpolant:function(a){var t=this._controlInterpolants,e=a.__cacheIndex,o=--this._nActiveControlInterpolants,n=t[o];a.__cacheIndex=o,t[o]=a,n.__cacheIndex=e,t[e]=n},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(d,p){var e=p||this._root,n=e.uuid,i="string"==typeof d?di.findByName(e,d):d,r=null===i?d:i.uuid,o=this._actionsByClip[r],a=null;if(void 0!==o){var s=o.actionByRoot[n];if(void 0!==s)return s;a=o.knownActions[0],null===i&&(i=a._clip)}if(null===i)return null;var l=new Yi(this,i,p);return this._bindAction(l,a),this._addInactiveAction(l,r,n),l},existingAction:function(l,s){var e=s||this._root,n=e.uuid,i="string"==typeof l?di.findByName(e,l):l,r=i?i.uuid:l,o=this._actionsByClip[r];return void 0===o?null:o.actionByRoot[n]||null},stopAllAction:function(){var a=this._actions,t=this._nActiveActions,e=this._bindings,o=this._nActiveBindings;for(this._nActiveActions=0,this._nActiveBindings=0,n=0;n!==t;++n)a[n].reset();for(var n=0;n!==o;++n)e[n].useCount=0;return this},update:function(c){c*=this.timeScale;for(var t=this._actions,e=this._nActiveActions,n=this.time+=c,i=Ec(c),r=this._accuIndex^=1,o=0;o!==e;++o)t[o]._update(n,c,i,r);for(var a=this._bindings,s=this._nActiveBindings,o=0;o!==s;++o)a[o].apply(r);return this},getRoot:function(){return this._root},uncacheClip:function(d){var t=this._actions,e=d.uuid,n=this._actionsByClip,i=n[e];if(void 0!==i){for(var r=i.knownActions,o=0,a=r.length,s;o!==a;++o){s=r[o],this._deactivateAction(s);var l=s._cacheIndex,c=t[t.length-1];s._cacheIndex=null,s._byClipCacheIndex=null,c._cacheIndex=l,t[l]=c,t.pop(),this._removeInactiveBindingsForAction(s)}delete n[e]}},uncacheRoot:function(l){var t=l.uuid,e=this._actionsByClip;for(var n in e){var i=e[n].actionByRoot[t];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var r=this._bindingsByRootAndName[t];if(void 0!==r)for(var o in r){var a=r[o];a.restoreOriginalState(),this._removeInactiveBinding(a)}},uncacheAction:function(a,t){var e=this.existingAction(a,t);null!==e&&(this._deactivateAction(e),this._removeInactiveAction(e))}}),Zi.prototype.clone=function(){return new Zi(void 0===this.value.clone?this.value:this.value.clone())},Ji.prototype=Object.assign(Object.create(bl.prototype),{constructor:Ji,isInstancedBufferGeometry:!0,addGroup:function(a,o,r){this.groups.push({start:a,count:o,materialIndex:r})},copy:function(c){var t=c.index;null!==t&&this.setIndex(t.clone());var e=c.attributes;for(var n in e){var i=e[n];this.addAttribute(n,i.clone())}for(var r=c.groups,o=0,a=r.length,s;o<a;o++)s=r[o],this.addGroup(s.start,s.count,s.materialIndex);return this}}),Object.defineProperties(bc.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(bc.prototype,{isInterleavedBufferAttribute:!0,setX:function(a,t){return this.data.array[a*this.data.stride+this.offset]=t,this},setY:function(a,t){return this.data.array[a*this.data.stride+this.offset+1]=t,this},setZ:function(a,t){return this.data.array[a*this.data.stride+this.offset+2]=t,this},setW:function(a,t){return this.data.array[a*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(a,t,e){return a=a*this.data.stride+this.offset,this.data.array[a+0]=t,this.data.array[a+1]=e,this},setXYZ:function(a,t,e,o){return a=a*this.data.stride+this.offset,this.data.array[a+0]=t,this.data.array[a+1]=e,this.data.array[a+2]=o,this},setXYZW:function(a,t,e,o,n){return a=a*this.data.stride+this.offset,this.data.array[a+0]=t,this.data.array[a+1]=e,this.data.array[a+2]=o,this.data.array[a+3]=n,this}}),Object.defineProperty(Qi.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Qi.prototype,{isInterleavedBuffer:!0,setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0===e?0:e.length/this.stride,this.array=e},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.dynamic=e.dynamic,this},copyAt:function(a,t,e){a*=this.stride,e*=t.stride;for(var o=0,n=this.stride;o<n;o++)this.array[a+o]=t.array[e+o];return this},set:function(a,t){return void 0===t&&(t=0),this.array.set(a,t),this},clone:function(){return new this.constructor().copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}}),$i.prototype=Object.assign(Object.create(Qi.prototype),{constructor:$i,isInstancedInterleavedBuffer:!0,copy:function(e){return Qi.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),xc.prototype=Object.assign(Object.create(yt.prototype),{constructor:xc,isInstancedBufferAttribute:!0,copy:function(e){return yt.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(function(a,t,e,o){this.ray=new wl(a,t),this.near=e||0,this.far=o||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}.prototype,{linePrecision:1,set:function(a,t){this.ray.set(a,t)},setFromCamera:function(a,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(a.x,a.y,.5).unproject(t).sub(this.ray.origin).normalize()):t&&t.isOrthographicCamera?(this.ray.origin.set(a.x,a.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(a,t){var e=[];return nr(a,this,e,t),e.sort(vc),e},intersectObjects:function(a,t){var e=[];if(!1===Array.isArray(a))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),e;for(var o=0,n=a.length;o<n;o++)nr(a[o],this,e,t);return e.sort(vc),e}}),Object.assign(function(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var a=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();a=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=a}return a}}),Object.assign(function(a,t,e){return this.radius=void 0===a?1:a,this.phi=void 0===t?0:t,this.theta=void 0===e?0:e,this}.prototype,{set:function(a,t,e){return this.radius=a,this.phi=t,this.theta=e,this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=C(1e-6,U(Gn-1e-6,this.phi)),this},setFromVector3:function(e){return this.radius=e.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=D(e.x,e.z),this.phi=wc(rd.clamp(e.y/this.radius,-1,1))),this}}),Object.assign(function(a,t,e){return this.radius=void 0===a?1:a,this.theta=void 0===t?0:t,this.y=void 0===e?0:e,this}.prototype,{set:function(a,t,e){return this.radius=a,this.theta=t,this.y=e,this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.radius=N(e.x*e.x+e.z*e.z),this.theta=D(e.x,e.z),this.y=e.y,this}}),(ir.prototype=Object.create(ut.prototype)).constructor=ir,ir.prototype.isImmediateRenderObject=!0,(rr.prototype=Object.create(kl.prototype)).constructor=rr,rr.prototype.update=function(){var l=new nl,t=new nl,e=new rt;return function(){var n=["a","b","c"];this.object.updateMatrixWorld(!0),e.getNormalMatrix(this.object.matrixWorld);var i=this.object.matrixWorld,r=this.geometry.attributes.position,o=this.object.geometry;if(o&&o.isGeometry)for(var a=o.vertices,s=o.faces,b=0,c=0,h=s.length;c<h;c++)for(var u=s[c],p=0,d=u.vertexNormals.length;p<d;p++){var f=a[u[n[p]]],m=u.vertexNormals[p];l.copy(f).applyMatrix4(i),t.copy(m).applyMatrix3(e).normalize().multiplyScalar(this.size).add(l),r.setXYZ(b,l.x,l.y,l.z),b+=1,r.setXYZ(b,t.x,t.y,t.z),b+=1}else if(o&&o.isBufferGeometry)for(var _=o.attributes.position,g=o.attributes.normal,b=0,p=0,d=_.count;p<d;p++)l.set(_.getX(p),_.getY(p),_.getZ(p)).applyMatrix4(i),t.set(g.getX(p),g.getY(p),g.getZ(p)),t.applyMatrix3(e).normalize().multiplyScalar(this.size).add(l),r.setXYZ(b,l.x,l.y,l.z),b+=1,r.setXYZ(b,t.x,t.y,t.z),b+=1;r.needsUpdate=!0}}(),(or.prototype=Object.create(ut.prototype)).constructor=or,or.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},or.prototype.update=function(){var a=new nl,t=new nl;return function(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,o=e*Pr(this.light.angle);this.cone.scale.set(o,o,e),a.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(a)),void 0===this.color?this.cone.material.color.copy(this.light.color):this.cone.material.color.set(this.color)}}(),(sr.prototype=Object.create(kl.prototype)).constructor=sr,sr.prototype.onBeforeRender=function(){var r=new nl,t=new il,e=new il;return function(){var n=this.bones,i=this.geometry,c=i.getAttribute("position");e.getInverse(this.root.matrixWorld);for(var o=0,a=0,s;o<n.length;o++)s=n[o],s.parent&&s.parent.isBone&&(t.multiplyMatrices(e,s.matrixWorld),r.setFromMatrixPosition(t),c.setXYZ(a,r.x,r.y,r.z),t.multiplyMatrices(e,s.parent.matrixWorld),r.setFromMatrixPosition(t),c.setXYZ(a+1,r.x,r.y,r.z),a+=2);i.getAttribute("position").needsUpdate=!0}}(),(lr.prototype=Object.create(Bt.prototype)).constructor=lr,lr.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},lr.prototype.update=function(){void 0===this.color?this.material.color.copy(this.light.color):this.material.color.set(this.color)},(cr.prototype=Object.create(ut.prototype)).constructor=cr,cr.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},cr.prototype.update=function(){var a=.5*this.light.width,o=.5*this.light.height,r=this.line.geometry.attributes.position,n=r.array;n[0]=a,n[1]=-o,n[2]=0,n[3]=a,n[4]=o,n[5]=0,n[6]=-a,n[7]=o,n[8]=0,n[9]=-a,n[10]=-o,n[11]=0,n[12]=a,n[13]=-o,n[14]=0,r.needsUpdate=!0,void 0===this.color?this.line.material.color.copy(this.light.color):this.line.material.color.set(this.color)},(hr.prototype=Object.create(ut.prototype)).constructor=hr,hr.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},hr.prototype.update=function(){var l=new nl,t=new X,e=new X;return function(){var n=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var i=n.geometry.getAttribute("color");t.copy(this.light.color),e.copy(this.light.groundColor);for(var r=0,o=i.count,a;r<o;r++)a=r<o/2?t:e,i.setXYZ(r,a.r,a.g,a.b);i.needsUpdate=!0}n.lookAt(l.setFromMatrixPosition(this.light.matrixWorld).negate())}}(),(ur.prototype=Object.create(kl.prototype)).constructor=ur,(pr.prototype=Object.create(kl.prototype)).constructor=pr,(dr.prototype=Object.create(kl.prototype)).constructor=dr,dr.prototype.update=function(){var o=new nl,t=new nl,e=new rt;return function(){this.object.updateMatrixWorld(!0),e.getNormalMatrix(this.object.matrixWorld);for(var n=this.object.matrixWorld,i=this.geometry.attributes.position,r=this.object.geometry,d=r.vertices,a=r.faces,s=0,l=0,c=a.length;l<c;l++){var m=a[l],u=m.normal;o.copy(d[m.a]).add(d[m.b]).add(d[m.c]).divideScalar(3).applyMatrix4(n),t.copy(u).applyMatrix3(e).normalize().multiplyScalar(this.size).add(o),i.setXYZ(s,o.x,o.y,o.z),s+=1,i.setXYZ(s,t.x,t.y,t.z),s+=1}i.needsUpdate=!0}}(),(fr.prototype=Object.create(ut.prototype)).constructor=fr,fr.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},fr.prototype.update=function(){var a=new nl,t=new nl,e=new nl;return function(){a.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),e.subVectors(t,a),this.lightPlane.lookAt(e),void 0===this.color?(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)):(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)),this.targetLine.lookAt(e),this.targetLine.scale.z=e.length()}}(),(mr.prototype=Object.create(kl.prototype)).constructor=mr,mr.prototype.update=function(){function a(r,n,o,a){d.set(n,o,a).unproject(i);var s=e[r];if(void 0!==s)for(var l=t.getAttribute("position"),c=0,p=s.length;c<p;c++)l.setXYZ(s[c],d.x,d.y,d.z)}var d=new nl,i=new pt,t,e;return function(){t=this.geometry,e=this.pointMap,i.projectionMatrix.copy(this.camera.projectionMatrix),a("c",0,0,-1),a("t",0,0,1),a("n1",-1,-1,-1),a("n2",1,-1,-1),a("n3",-1,1,-1),a("n4",1,1,-1),a("f1",-1,-1,1),a("f2",1,-1,1),a("f3",-1,1,1),a("f4",1,1,1),a("u1",.7,1.1,-1),a("u2",-.7,1.1,-1),a("u3",0,2,-1),a("cf1",-1,0,1),a("cf2",1,0,1),a("cf3",0,-1,1),a("cf4",0,1,1),a("cn1",-1,0,-1),a("cn2",1,0,-1),a("cn3",0,-1,-1),a("cn4",0,1,-1),t.getAttribute("position").needsUpdate=!0}}(),_r.prototype=Object.create(kl.prototype),_r.prototype.constructor=_r,_r.prototype.update=function(){var a=new hl;return function(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&a.setFromObject(this.object),!a.isEmpty()){var e=a.min,n=a.max,i=this.geometry.attributes.position,r=i.array;r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=e.x,r[4]=n.y,r[5]=n.z,r[6]=e.x,r[7]=e.y,r[8]=n.z,r[9]=n.x,r[10]=e.y,r[11]=n.z,r[12]=n.x,r[13]=n.y,r[14]=e.z,r[15]=e.x,r[16]=n.y,r[17]=e.z,r[18]=e.x,r[19]=e.y,r[20]=e.z,r[21]=n.x,r[22]=e.y,r[23]=e.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),_r.prototype.setFromObject=function(e){return this.object=e,this.update(),this},(gr.prototype=Object.create(kl.prototype)).constructor=gr,gr.prototype.onBeforeRender=function(){var e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5))},(yr.prototype=Object.create(Dl.prototype)).constructor=yr,yr.prototype.onBeforeRender=function(){var e=-this.plane.constant;1e-8>B(e)&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.lookAt(this.plane.normal),this.updateMatrixWorld()};var ss,cs;(vr.prototype=Object.create(ut.prototype)).constructor=vr,vr.prototype.setDirection=function(){var a=new nl,e;return function(t){.99999<t.y?this.quaternion.set(0,0,0,1):-.99999>t.y?this.quaternion.set(1,0,0,0):(a.set(t.z,0,-t.x).normalize(),e=wc(t.y),this.quaternion.setFromAxisAngle(a,e))}}(),vr.prototype.setLength=function(a,t,e){void 0===t&&(t=.2*a),void 0===e&&(e=.2*t),this.line.scale.set(1,C(0,a-t),1),this.line.updateMatrix(),this.cone.scale.set(e,t,e),this.cone.position.y=a,this.cone.updateMatrix()},vr.prototype.setColor=function(e){this.line.material.color.copy(e),this.cone.material.color.copy(e)},(br.prototype=Object.create(kl.prototype)).constructor=br;var hs=new nl,us=new wr,ps=new wr,ds=new wr;xr.prototype=Object.create(Pi.prototype),xr.prototype.constructor=xr,xr.prototype.getPoint=function(_){var t=this.points,e=t.length,n=(e-(this.closed?0:1))*_,i=z(n),r=n-i;this.closed?i+=0<i?0:(z(B(i)/t.length)+1)*t.length:0===r&&i===e-1&&(i=e-2,r=1);var o,a,s,l;if(this.closed||0<i?o=t[(i-1)%e]:(hs.subVectors(t[0],t[1]).add(t[0]),o=hs),a=t[i%e],s=t[(i+1)%e],this.closed||i+2<e?l=t[(i+2)%e]:(hs.subVectors(t[e-1],t[e-2]).add(t[e-1]),l=hs),void 0===this.type||"centripetal"===this.type||"chordal"===this.type){var c="chordal"===this.type?.5:.25,u=S(o.distanceToSquared(a),c),p=S(a.distanceToSquared(s),c),d=S(s.distanceToSquared(l),c);1e-4>p&&(p=1),1e-4>u&&(u=p),1e-4>d&&(d=p),us.initNonuniformCatmullRom(o.x,a.x,s.x,l.x,u,p,d),ps.initNonuniformCatmullRom(o.y,a.y,s.y,l.y,u,p,d),ds.initNonuniformCatmullRom(o.z,a.z,s.z,l.z,u,p,d)}else if("catmullrom"===this.type){var h=void 0===this.tension?.5:this.tension;us.initCatmullRom(o.x,a.x,s.x,l.x,h),ps.initCatmullRom(o.y,a.y,s.y,l.y,h),ds.initCatmullRom(o.z,a.z,s.z,l.z,h)}return new nl(us.calc(r),ps.calc(r),ds.calc(r))},(Sr.prototype=Object.create(Pi.prototype)).constructor=Sr,Sr.prototype.getPoint=function(a){var t=this.v0,e=this.v1,o=this.v2,n=this.v3;return new nl(Ai(a,t.x,e.x,o.x,n.x),Ai(a,t.y,e.y,o.y,n.y),Ai(a,t.z,e.z,o.z,n.z))},(Er.prototype=Object.create(Pi.prototype)).constructor=Er,Er.prototype.getPoint=function(a){var t=this.v0,e=this.v1,o=this.v2;return new nl(xi(a,t.x,e.x,o.x),xi(a,t.y,e.y,o.y),xi(a,t.z,e.z,o.z))},(Mr.prototype=Object.create(Pi.prototype)).constructor=Mr,Mr.prototype.getPoint=function(a){if(1===a)return this.v2.clone();var t=new nl;return t.subVectors(this.v2,this.v1),t.multiplyScalar(a),t.add(this.v1),t},(Tr.prototype=Object.create(mc.prototype)).constructor=Tr,Pi.create=function(a,t){return console.log("THREE.Curve.create() has been deprecated"),a.prototype=Object.create(Pi.prototype),a.prototype.constructor=a,a.prototype.getPoint=t,a},function(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),xr.call(this,e),this.type="catmullrom",this.closed=!0}.prototype=Object.create(xr.prototype),function(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),xr.call(this,e),this.type="catmullrom"}.prototype=Object.create(xr.prototype),Ar.prototype=Object.create(xr.prototype),Object.assign(Ar.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),ur.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},sr.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Y.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(hl.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),Ut.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},rd.random16=function(){return console.warn("THREE.Math.random16() has been deprecated. Use Math.random() instead."),Math.random()},Object.assign(rt.prototype,{flattenToArrayOffset:function(a,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(a,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(il.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(a,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(a,t)},getPosition:function(){var e;return function(){return void 0===e&&(e=new nl),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),e.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(a,t,e,n,i,r){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(a,t,n,e,i,r)}}),ot.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},rl.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(wl.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(Fi.prototype,{extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new bs(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Ls(this,e)}}),Object.assign(el.prototype,{fromAttribute:function(a,t,e){return console.error("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(a,t,e)}}),Object.assign(nl.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(a,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,a)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(a,t,e){return console.error("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(a,t,e)}}),Object.assign(al.prototype,{fromAttribute:function(a,t,e){return console.error("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(a,t,e)}}),gt.prototype.computeTangents=function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},Object.assign(ut.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(a,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,a)}}),Object.defineProperties(ut.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(Ll.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Al.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Object.defineProperty(Pi.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),fl.prototype.setLens=function(a,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(a)},Object.defineProperties(Vn.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(yt.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}}}),Object.assign(bl.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addDrawCall:function(a,t,e){void 0!==e&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(a,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(bl.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(Zi.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(K.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new X}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===THREE.FlatShading}}}),Object.defineProperties(Hs.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(Q.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(Se.prototype,{getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}}),Object.defineProperties(Se.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){return this.shadowMap.cullFace},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace."),this.shadowMap.cullFace=e}}}),Object.defineProperties(st.prototype,{cullFace:{get:function(){return this.renderReverseSided?Lr:Cr},set:function(a){var t=a!==Cr;console.warn("WebGLRenderer: .shadowMap.cullFace is deprecated. Set .shadowMap.renderReverseSided to "+t+"."),this.renderReverseSided=t}}}),Object.defineProperties(a.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),hc.prototype.load=function(a){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var o=this;return new Bi().load(a,function(e){o.setBuffer(e)}),this},fc.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},zi.prototype.updateCubeMap=function(a,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(a,t)}},function(e){var t=function(){return this}();try{t=t||Function("return this")()||(0,eval)("this")}catch(e){"object"==("undefined"===typeof window?"undefined":babelHelpers.typeof(window))&&(t=window)}e.exports=t},function(a,n){"use strict";var e="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;n.assign=function(a){for(var t=Array.prototype.slice.call(arguments,1),e;t.length;)if(e=t.shift(),e){if("object"!=("undefined"===typeof e?"undefined":babelHelpers.typeof(e)))throw new TypeError(e+"must be non-object");for(var o in e)e.hasOwnProperty(o)&&(a[o]=e[o])}return a},n.shrinkBuf=function(a,t){return a.length===t?a:a.subarray?a.subarray(0,t):(a.length=t,a)};var i={arraySet:function(a,t,e,n,i){if(t.subarray&&a.subarray)a.set(t.subarray(e,e+n),i);else for(var r=0;r<n;r++)a[i+r]=t[e+r]},flattenChunks:function(l){var t,e,n,i,r,o;for(n=0,t=0,e=l.length;t<e;t++)n+=l[t].length;for(o=new Uint8Array(n),i=0,t=0,e=l.length;t<e;t++)r=l[t],o.set(r,i),i+=r.length;return o}},r={arraySet:function(a,t,e,n,i){for(var r=0;r<n;r++)a[i+r]=t[e+r]},flattenChunks:function(e){return[].concat.apply([],e)}};n.setTyped=function(e){e?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,i)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,r))},n.setTyped(e)},function(c,t,e){"use strict";function n(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}var i=e(14),d=e(0),o="function"==typeof Symbol&&"symbol"==babelHelpers.typeof(Symbol.iterator)?function(e){return"undefined"===typeof e?"undefined":babelHelpers.typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":"undefined"===typeof e?"undefined":babelHelpers.typeof(e)},a=e(87),r=function(){function e(){n(this,e)}return e.bbox=function(a,t){return i.a.vector3(a)&&i.a.vector3(t)?0<=t.x&&0<=t.y&&0<=t.z?{min:a.clone().sub(t),max:a.clone().add(t)}:(window.console.log("halfDimensions must be >= 0."),window.console.log(t),!1):(window.console.log("Invalid center or plane halfDimensions."),!1)},e.minMax=function(){for(var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=[65535,-32768],e=a.length,o=0,n;o<e;o++)n=a[o],t[0]=U(t[0],n),t[1]=C(t[1],n);return t},e.isElement=function(e){try{return e instanceof HTMLElement}catch(t){return"object"===(void 0===e?"undefined":o(e))&&1===e.nodeType&&"object"===o(e.style)&&"object"===o(e.ownerDocument)}},e.isString=function(e){return"string"==typeof e||e instanceof String},e.parseUrl=function(o){var t={filename:"",extension:"",pathname:"",query:""},e=a.parse(o);return t.pathname=e.pathname,t.query=e.query,t.query&&(t.filename=t.query.split("&").reduce(function(a,t){var e=t.split("=");return 0<e.length&&"filename"==e[0]&&(a=e[1]),a})),t.filename||(t.filename=t.pathname.split("/").pop()),t.extension=1>=t.filename.split(".").length?"dicom":t.filename.split(".").pop(),isNaN(t.extension)||(t.extension="dicom"),t.query&&t.query.includes("contentType=application%2Fdicom")&&(t.extension="dicom"),t},e.ijk2LPS=function(o,t,e,n,i){var r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new d.c,a=new d.c;return a.set(o.x*n.y,t.x*n.x,e.x*n.z,i.x,o.y*n.y,t.y*n.x,e.y*n.z,i.y,o.z*n.y,t.z*n.x,e.z*n.z,i.z,0,0,0,1),a.premultiply(r),a},e.aabb2LPS=function(a,t,e,o){var n=new d.c;return n.set(a.x,t.x,e.x,o.x,a.y,t.y,e.y,o.y,a.z,t.z,e.z,o.z,0,0,0,1),n},e.worldToData=function(a,t){var e=new d.f().copy(t).applyMatrix4(a);return e.addScalar(.5).floor(),e},e.value=function(a,t){window.console.warn("value is deprecated, please use getPixelData instead"),this.getPixelData(a,t)},e.getPixelData=function(a,t){return 0<=t.z&&t.z<a._frame.length?a._frame[t.z].getPixelData(t.x,t.y):null},e.setPixelData=function(a,t,e){return 0<=t.z&&t.z<a._frame.length?void a._frame[t.z].setPixelData(t.x,t.y,e):null},e.rescaleSlopeIntercept=function(a,t,e){return a*t+e},e}();t.a=r},function(e){function g(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function i(e){if(c===setTimeout)return setTimeout(e,0);if((c===g||!c)&&setTimeout)return c=setTimeout,setTimeout(e,0);try{return c(e,0)}catch(t){try{return c.call(null,e,0)}catch(t){return c.call(this,e,0)}}}function r(e){if(p===clearTimeout)return clearTimeout(e);if((p===n||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(e);try{return p(e)}catch(t){try{return p.call(null,e)}catch(t){return p.call(this,e)}}}function o(){f&&_&&(f=!1,_.length?y=_.concat(y):b=-1,y.length&&a())}function a(){if(!f){var a=i(o);f=!0;for(var t=y.length;t;){for(_=y,y=[];++b<t;)_&&_[b].run();b=-1,t=y.length}_=null,f=!1,r(a)}}function s(a,t){this.fun=a,this.array=t}function t(){}var l=e.exports={},c,p;!function(){try{c="function"==typeof setTimeout?setTimeout:g}catch(e){c=g}try{p="function"==typeof clearTimeout?clearTimeout:n}catch(e){p=n}}();var y=[],f=!1,b=-1,_;l.nextTick=function(o){var t=Array(arguments.length-1);if(1<arguments.length)for(var e=1;e<arguments.length;e++)t[e-1]=arguments[e];y.push(new s(o,t)),1!==y.length||f||i(a)},s.prototype.run=function(){this.fun.apply(null,this.array)},l.title="browser",l.browser=!0,l.env={},l.argv=[],l.version="",l.versions={},l.on=t,l.addListener=t,l.once=t,l.off=t,l.removeListener=t,l.removeAllListeners=t,l.emit=t,l.prependListener=t,l.prependOnceListener=t,l.listeners=function(){return[]},l.binding=function(){throw new Error("process.binding is not supported")},l.cwd=function(){return"/"},l.chdir=function(){throw new Error("process.chdir is not supported")},l.umask=function(){return 0}},function(a,ee,e){"use strict";(function(n){function te(){return oe.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function ae(a,t){if(te()<t)throw new RangeError("Invalid typed array length");return oe.TYPED_ARRAY_SUPPORT?(a=new Uint8Array(t)).__proto__=oe.prototype:(null===a&&(a=new oe(t)),a.length=t),a}function oe(a,r,l){if(!(oe.TYPED_ARRAY_SUPPORT||this instanceof oe))return new oe(a,r,l);if("number"==typeof a){if("string"==typeof r)throw new Error("If encoding is specified then the first argument must be a string");return i(this,a)}return o(this,a,r,l)}function o(a,t,o,r){if("number"==typeof t)throw new TypeError("\"value\" argument must not be a number");return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?c(a,t,o,r):"string"==typeof t?l(a,t,o):p(a,t)}function a(e){if("number"!=typeof e)throw new TypeError("\"size\" argument must be a number");if(0>e)throw new RangeError("\"size\" argument must not be negative")}function r(o,t,e,r){return a(t),0>=t?ae(o,t):void 0===e?ae(o,t):"string"==typeof r?ae(o,t).fill(e,r):ae(o,t).fill(e)}function i(o,t){if(a(t),o=ae(o,0>t?0:0|d(t)),!oe.TYPED_ARRAY_SUPPORT)for(var e=0;e<t;++e)o[e]=0;return o}function l(o,t,e){if("string"==typeof e&&""!==e||(e="utf8"),!oe.isEncoding(e))throw new TypeError("\"encoding\" must be a valid string encoding");var r=0|u(t,e),i=(o=ae(o,r)).write(t,e);return i!==r&&(o=o.slice(0,i)),o}function s(a,t){var e=0>t.length?0:0|d(t.length);a=ae(a,e);for(var o=0;o<e;o+=1)a[o]=255&t[o];return a}function c(a,t,e,o){if(t.byteLength,0>e||t.byteLength<e)throw new RangeError("'offset' is out of bounds");if(t.byteLength<e+(o||0))throw new RangeError("'length' is out of bounds");return t=void 0===e&&void 0===o?new Uint8Array(t):void 0===o?new Uint8Array(t,e):new Uint8Array(t,e,o),oe.TYPED_ARRAY_SUPPORT?(a=t).__proto__=oe.prototype:a=s(a,t),a}function p(a,t){if(oe.isBuffer(t)){var e=0|d(t.length);return 0===(a=ae(a,e)).length?a:(t.copy(a,0,0,e),a)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||X(t.length)?ae(a,0):s(a,t);if("Buffer"===t.type&&J(t.data))return s(a,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function d(e){if(e>=te())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+te().toString(16)+" bytes");return 0|e}function u(a,o){if(oe.isBuffer(a))return a.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(a)||a instanceof ArrayBuffer))return a.byteLength;"string"!=typeof a&&(a=""+a);var e=a.length;if(0===e)return 0;for(var r=!1;;)switch(o){case"ascii":case"latin1":case"binary":return e;case"utf8":case"utf-8":case void 0:return j(a).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*e;case"hex":return e>>>1;case"base64":return W(a).length;default:if(r)return j(a).length;o=(""+o).toLowerCase(),r=!0;}}function m(a,t,e){var o=!1;if((void 0===t||0>t)&&(t=0),t>this.length)return"";if((void 0===e||e>this.length)&&(e=this.length),0>=e)return"";if(e>>>=0,t>>>=0,e<=t)return"";for(a||(a="utf8");;)switch(a){case"hex":return C(this,t,e);case"utf8":case"utf-8":return T(this,t,e);case"ascii":return P(this,t,e);case"latin1":case"binary":return A(this,t,e);case"base64":return E(this,t,e);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return L(this,t,e);default:if(o)throw new TypeError("Unknown encoding: "+a);a=(a+"").toLowerCase(),o=!0;}}function _(a,t,e){var o=a[t];a[t]=a[e],a[e]=o}function h(a,t,o,l,i){if(0===a.length)return-1;if("string"==typeof o?(l=o,o=0):2147483647<o?o=2147483647:-2147483648>o&&(o=-2147483648),o=+o,isNaN(o)&&(o=i?0:a.length-1),0>o&&(o=a.length+o),o>=a.length){if(i)return-1;o=a.length-1}else if(0>o){if(!i)return-1;o=0}if("string"==typeof t&&(t=oe.from(t,l)),oe.isBuffer(t))return 0===t.length?-1:g(a,t,o,l,i);if("number"==typeof t)return t&=255,oe.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(a,t,o):Uint8Array.prototype.lastIndexOf.call(a,t,o):g(a,[t],o,l,i);throw new TypeError("val must be string, number or Buffer")}function g(d,t,e,n,i){function r(a,t){return 1===o?a[t]:a.readUInt16BE(t*o)}var o=1,a=d.length,s=t.length;if(void 0!==n&&("ucs2"===(n=(n+"").toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(2>d.length||2>t.length)return-1;o=2,a/=2,s/=2,e/=2}var l;if(i){var c=-1;for(l=e;l<a;l++)if(!(r(d,l)===r(t,-1===c?0:l-c)))-1!==c&&(l-=l-c),c=-1;else if(-1===c&&(c=l),l-c+1===s)return c*o}else for(e+s>a&&(e=a-s),l=e;0<=l;l--){for(var m=!0,u=0;u<s;u++)if(r(d,l+u)!==r(t,u)){m=!1;break}if(m)return l}return-1}function f(l,t,e,c){e=+e||0;var d=l.length-e;c?(c=+c)>d&&(c=d):c=d;var r=t.length;if(0!=r%2)throw new TypeError("Invalid hex string");c>r/2&&(c=r/2);for(var o=0,a;o<c;++o){if(a=parseInt(t.substr(2*o,2),16),isNaN(a))return o;l[e+o]=a}return o}function y(a,t,e,o){return q(j(t,a.length-e),a,e,o)}function b(a,t,e,o){return q(H(t),a,e,o)}function x(a,t,e,o){return b(a,t,e,o)}function v(a,t,e,o){return q(W(t),a,e,o)}function w(a,t,e,o){return q(V(t,a.length-e),a,e,o)}function E(a,t,e){return 0===t&&e===a.length?Y.fromByteArray(a):Y.fromByteArray(a.slice(t,e))}function T(d,t,e){e=U(d.length,e);for(var n=[],i=t;i<e;){var r=d[i],o=null,a=239<r?4:223<r?3:191<r?2:1;if(i+a<=e){var s,l,c,p;1===a?128>r&&(o=r):2===a?128==(192&(s=d[i+1]))&&127<(p=(31&r)<<6|63&s)&&(o=p):3===a?(s=d[i+1],l=d[i+2],128==(192&s)&&128==(192&l)&&2047<(p=(15&r)<<12|(63&s)<<6|63&l)&&(55296>p||57343<p)&&(o=p)):4===a?(s=d[i+1],l=d[i+2],c=d[i+3],128==(192&s)&&128==(192&l)&&128==(192&c)&&65535<(p=(15&r)<<18|(63&s)<<12|(63&l)<<6|63&c)&&1114112>p&&(o=p)):void 0}null===o?(o=65533,a=1):65535<o&&(o-=65536,n.push(55296|1023&o>>>10),o=56320|1023&o),n.push(o),i+=a}return M(n)}function M(a){var t=a.length;if(t<=K)return F.apply(String,a);for(var e="",o=0;o<t;)e+=F.apply(String,a.slice(o,o+=K));return e}function P(a,t,e){var o="";e=U(a.length,e);for(var n=t;n<e;++n)o+=F(127&a[n]);return o}function A(a,t,e){var o="";e=U(a.length,e);for(var n=t;n<e;++n)o+=F(a[n]);return o}function C(a,t,l){var s=a.length;(!t||0>t)&&(t=0),(!l||0>l||l>s)&&(l=s);for(var i="",r=t;r<l;++r)i+=G(a[r]);return i}function L(a,t,e){for(var n=a.slice(t,e),i="",r=0;r<n.length;r+=2)i+=F(n[r]+256*n[r+1]);return i}function I(a,t,e){if(0!=a%1||0>a)throw new RangeError("offset is not uint");if(a+t>e)throw new RangeError("Trying to access beyond buffer length")}function R(o,t,e,n,i,r){if(!oe.isBuffer(o))throw new TypeError("\"buffer\" argument must be a Buffer instance");if(t>i||t<r)throw new RangeError("\"value\" argument is out of bounds");if(e+n>o.length)throw new RangeError("Index out of range")}function D(a,t,e,n){0>t&&(t=65535+t+1);for(var i=0,r=U(a.length-e,2);i<r;++i)a[e+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function k(a,t,e,n){0>t&&(t=4294967295+t+1);for(var i=0,r=U(a.length-e,4);i<r;++i)a[e+i]=255&t>>>8*(n?i:3-i)}function O(a,t,e,o){if(e+o>a.length)throw new RangeError("Index out of range");if(0>e)throw new RangeError("Index out of range")}function re(a,t,e,o,n){return n||O(a,t,e,4,3.4028234663852886e38,-3.4028234663852886e38),Z.write(a,t,e,o,23,4),e+4}function N(a,t,e,o,n){return n||O(a,t,e,8,1.7976931348623157e308,-1.7976931348623157e308),Z.write(a,t,e,o,52,8),e+8}function B(e){if(2>(e=ne(e).replace(Q,"")).length)return"";for(;0!=e.length%4;)e+="=";return e}function ne(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function G(e){return 16>e?"0"+e.toString(16):e.toString(16)}function j(l,t){t=t||1/0;for(var e=l.length,i=null,s=[],o=0,a;o<e;++o){if(55295<(a=l.charCodeAt(o))&&57344>a){if(!i){if(56319<a){-1<(t-=3)&&s.push(239,191,189);continue}if(o+1===e){-1<(t-=3)&&s.push(239,191,189);continue}i=a;continue}if(56320>a){-1<(t-=3)&&s.push(239,191,189),i=a;continue}a=65536+(i-55296<<10|a-56320)}else i&&-1<(t-=3)&&s.push(239,191,189);if(i=null,128>a){if(0>(t-=1))break;s.push(a)}else if(2048>a){if(0>(t-=2))break;s.push(192|a>>6,128|63&a)}else if(65536>a){if(0>(t-=3))break;s.push(224|a>>12,128|63&a>>6,128|63&a)}else{if(!(1114112>a))throw new Error("Invalid code point");if(0>(t-=4))break;s.push(240|a>>18,128|63&a>>12,128|63&a>>6,128|63&a)}}return s}function H(a){for(var t=[],e=0;e<a.length;++e)t.push(255&a.charCodeAt(e));return t}function V(l,t){for(var e=[],o=0,a,n,i;o<l.length&&!(0>(t-=2));++o)n=(a=l.charCodeAt(o))>>8,i=a%256,e.push(i),e.push(n);return e}function W(e){return Y.toByteArray(B(e))}function q(a,t,e,o){for(var n=0;n<o&&!(n+e>=t.length||n>=a.length);++n)t[n+e]=a[n];return n}function X(e){return e!==e}var Y=e(132),Z=e(133),J=e(134);ee.Buffer=oe,ee.SlowBuffer=function(e){return+e!=e&&(e=0),oe.alloc(+e)},ee.INSPECT_MAX_BYTES=50,oe.TYPED_ARRAY_SUPPORT=void 0===n.TYPED_ARRAY_SUPPORT?function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}():n.TYPED_ARRAY_SUPPORT,ee.kMaxLength=te(),oe.poolSize=8192,oe._augment=function(e){return e.__proto__=oe.prototype,e},oe.from=function(a,t,e){return o(null,a,t,e)},oe.TYPED_ARRAY_SUPPORT&&(oe.prototype.__proto__=Uint8Array.prototype,oe.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&oe[Symbol.species]===oe&&Object.defineProperty(oe,Symbol.species,{value:null,configurable:!0})),oe.alloc=function(a,t,e){return r(null,a,t,e)},oe.allocUnsafe=function(e){return i(null,e)},oe.allocUnsafeSlow=function(e){return i(null,e)},oe.isBuffer=function(e){return null!=e&&e._isBuffer},oe.compare=function(o,t){if(!oe.isBuffer(o)||!oe.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(o===t)return 0;for(var e=o.length,n=t.length,i=0,r=U(e,n);i<r;++i)if(o[i]!==t[i]){e=o[i],n=t[i];break}return e<n?-1:n<e?1:0},oe.isEncoding=function(e){switch((e+"").toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1;}},oe.concat=function(o,t){if(!J(o))throw new TypeError("\"list\" argument must be an Array of Buffers");if(0===o.length)return oe.alloc(0);var e;if(void 0===t)for(t=0,e=0;e<o.length;++e)t+=o[e].length;var n=oe.allocUnsafe(t),i=0;for(e=0;e<o.length;++e){var r=o[e];if(!oe.isBuffer(r))throw new TypeError("\"list\" argument must be an Array of Buffers");r.copy(n,i),i+=r.length}return n},oe.byteLength=u,oe.prototype._isBuffer=!0,oe.prototype.swap16=function(){var a=this.length;if(0!=a%2)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<a;t+=2)_(this,t,t+1);return this},oe.prototype.swap32=function(){var a=this.length;if(0!=a%4)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<a;t+=4)_(this,t,t+3),_(this,t+1,t+2);return this},oe.prototype.swap64=function(){var a=this.length;if(0!=a%8)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<a;t+=8)_(this,t,t+7),_(this,t+1,t+6),_(this,t+2,t+5),_(this,t+3,t+4);return this},oe.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?T(this,0,e):m.apply(this,arguments)},oe.prototype.equals=function(e){if(!oe.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===oe.compare(this,e)},oe.prototype.inspect=function(){var e="",t=ee.INSPECT_MAX_BYTES;return 0<this.length&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},oe.prototype.compare=function(o,t,e,n,i){if(!oe.isBuffer(o))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===e&&(e=o?o.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),0>t||e>o.length||0>n||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=e)return 0;if(n>=i)return-1;if(t>=e)return 1;if(t>>>=0,e>>>=0,n>>>=0,i>>>=0,this===o)return 0;for(var r=i-n,a=e-t,s=U(r,a),l=this.slice(n,i),c=o.slice(t,e),d=0;d<s;++d)if(l[d]!==c[d]){r=l[d],a=c[d];break}return r<a?-1:a<r?1:0},oe.prototype.includes=function(a,t,e){return-1!==this.indexOf(a,t,e)},oe.prototype.indexOf=function(a,t,e){return h(this,a,t,e,!0)},oe.prototype.lastIndexOf=function(a,t,e){return h(this,a,t,e,!1)},oe.prototype.write=function(a,t,l,n){if(void 0===t)n="utf8",l=this.length,t=0;else if(void 0===l&&"string"==typeof t)n=t,l=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(l)?(l|=0,void 0===n&&(n="utf8")):(n=l,l=void 0)}var i=this.length-t;if((void 0===l||l>i)&&(l=i),0<a.length&&(0>l||0>t)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var r=!1;;)switch(n){case"hex":return f(this,a,t,l);case"utf8":case"utf-8":return y(this,a,t,l);case"ascii":return b(this,a,t,l);case"latin1":case"binary":return x(this,a,t,l);case"base64":return v(this,a,t,l);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return w(this,a,t,l);default:if(r)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),r=!0;}},oe.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var K=4096;oe.prototype.slice=function(o,l){var s=this.length;o=~~o,l=void 0===l?s:~~l,0>o?0>(o+=s)&&(o=0):o>s&&(o=s),0>l?0>(l+=s)&&(l=0):l>s&&(l=s),l<o&&(l=o);var n;if(oe.TYPED_ARRAY_SUPPORT)(n=this.subarray(o,l)).__proto__=oe.prototype;else{var i=l-o;n=new oe(i,void 0);for(var r=0;r<i;++r)n[r]=this[r+o]}return n},oe.prototype.readUIntLE=function(a,t,e){a|=0,t|=0,e||I(a,t,this.length);for(var n=this[a],i=1,r=0;++r<t&&(i*=256);)n+=this[a+r]*i;return n},oe.prototype.readUIntBE=function(a,t,e){a|=0,t|=0,e||I(a,t,this.length);for(var o=this[a+--t],n=1;0<t&&(n*=256);)o+=this[a+--t]*n;return o},oe.prototype.readUInt8=function(a,t){return t||I(a,1,this.length),this[a]},oe.prototype.readUInt16LE=function(a,t){return t||I(a,2,this.length),this[a]|this[a+1]<<8},oe.prototype.readUInt16BE=function(a,t){return t||I(a,2,this.length),this[a]<<8|this[a+1]},oe.prototype.readUInt32LE=function(a,t){return t||I(a,4,this.length),(this[a]|this[a+1]<<8|this[a+2]<<16)+16777216*this[a+3]},oe.prototype.readUInt32BE=function(a,t){return t||I(a,4,this.length),16777216*this[a]+(this[a+1]<<16|this[a+2]<<8|this[a+3])},oe.prototype.readIntLE=function(a,t,e){a|=0,t|=0,e||I(a,t,this.length);for(var n=this[a],i=1,r=0;++r<t&&(i*=256);)n+=this[a+r]*i;return i*=128,n>=i&&(n-=S(2,8*t)),n},oe.prototype.readIntBE=function(a,t,e){a|=0,t|=0,e||I(a,t,this.length);for(var n=t,i=1,r=this[a+--n];0<n&&(i*=256);)r+=this[a+--n]*i;return i*=128,r>=i&&(r-=S(2,8*t)),r},oe.prototype.readInt8=function(a,t){return t||I(a,1,this.length),128&this[a]?-1*(255-this[a]+1):this[a]},oe.prototype.readInt16LE=function(a,t){t||I(a,2,this.length);var e=this[a]|this[a+1]<<8;return 32768&e?4294901760|e:e},oe.prototype.readInt16BE=function(a,t){t||I(a,2,this.length);var e=this[a+1]|this[a]<<8;return 32768&e?4294901760|e:e},oe.prototype.readInt32LE=function(a,t){return t||I(a,4,this.length),this[a]|this[a+1]<<8|this[a+2]<<16|this[a+3]<<24},oe.prototype.readInt32BE=function(a,t){return t||I(a,4,this.length),this[a]<<24|this[a+1]<<16|this[a+2]<<8|this[a+3]},oe.prototype.readFloatLE=function(a,t){return t||I(a,4,this.length),Z.read(this,a,!0,23,4)},oe.prototype.readFloatBE=function(a,t){return t||I(a,4,this.length),Z.read(this,a,!1,23,4)},oe.prototype.readDoubleLE=function(a,t){return t||I(a,8,this.length),Z.read(this,a,!0,52,8)},oe.prototype.readDoubleBE=function(a,t){return t||I(a,8,this.length),Z.read(this,a,!1,52,8)},oe.prototype.writeUIntLE=function(a,l,e,n){a=+a,l|=0,e|=0,n||R(this,a,l,e,S(2,8*e)-1,0);var i=1,r=0;for(this[l]=255&a;++r<e&&(i*=256);)this[l+r]=255&a/i;return l+e},oe.prototype.writeUIntBE=function(a,l,e,n){a=+a,l|=0,e|=0,n||R(this,a,l,e,S(2,8*e)-1,0);var i=e-1,r=1;for(this[l+i]=255&a;0<=--i&&(r*=256);)this[l+i]=255&a/r;return l+e},oe.prototype.writeUInt8=function(a,o,e){return a=+a,o|=0,e||R(this,a,o,1,255,0),oe.TYPED_ARRAY_SUPPORT||(a=z(a)),this[o]=255&a,o+1},oe.prototype.writeUInt16LE=function(a,o,e){return a=+a,o|=0,e||R(this,a,o,2,65535,0),oe.TYPED_ARRAY_SUPPORT?(this[o]=255&a,this[o+1]=a>>>8):D(this,a,o,!0),o+2},oe.prototype.writeUInt16BE=function(a,o,e){return a=+a,o|=0,e||R(this,a,o,2,65535,0),oe.TYPED_ARRAY_SUPPORT?(this[o]=a>>>8,this[o+1]=255&a):D(this,a,o,!1),o+2},oe.prototype.writeUInt32LE=function(a,o,e){return a=+a,o|=0,e||R(this,a,o,4,4294967295,0),oe.TYPED_ARRAY_SUPPORT?(this[o+3]=a>>>24,this[o+2]=a>>>16,this[o+1]=a>>>8,this[o]=255&a):k(this,a,o,!0),o+4},oe.prototype.writeUInt32BE=function(a,o,e){return a=+a,o|=0,e||R(this,a,o,4,4294967295,0),oe.TYPED_ARRAY_SUPPORT?(this[o]=a>>>24,this[o+1]=a>>>16,this[o+2]=a>>>8,this[o+3]=255&a):k(this,a,o,!1),o+4},oe.prototype.writeIntLE=function(l,c,e,n){if(l=+l,c|=0,!n){var d=S(2,8*e-1);R(this,l,c,e,d-1,-d)}var p=0,o=1,a=0;for(this[c]=255&l;++p<e&&(o*=256);)0>l&&0===a&&0!==this[c+p-1]&&(a=1),this[c+p]=255&(l/o>>0)-a;return c+e},oe.prototype.writeIntBE=function(l,c,e,n){if(l=+l,c|=0,!n){var d=S(2,8*e-1);R(this,l,c,e,d-1,-d)}var p=e-1,o=1,a=0;for(this[c+p]=255&l;0<=--p&&(o*=256);)0>l&&0===a&&0!==this[c+p+1]&&(a=1),this[c+p]=255&(l/o>>0)-a;return c+e},oe.prototype.writeInt8=function(a,o,e){return a=+a,o|=0,e||R(this,a,o,1,127,-128),oe.TYPED_ARRAY_SUPPORT||(a=z(a)),0>a&&(a=255+a+1),this[o]=255&a,o+1},oe.prototype.writeInt16LE=function(a,o,e){return a=+a,o|=0,e||R(this,a,o,2,32767,-32768),oe.TYPED_ARRAY_SUPPORT?(this[o]=255&a,this[o+1]=a>>>8):D(this,a,o,!0),o+2},oe.prototype.writeInt16BE=function(a,o,e){return a=+a,o|=0,e||R(this,a,o,2,32767,-32768),oe.TYPED_ARRAY_SUPPORT?(this[o]=a>>>8,this[o+1]=255&a):D(this,a,o,!1),o+2},oe.prototype.writeInt32LE=function(a,o,e){return a=+a,o|=0,e||R(this,a,o,4,2147483647,-2147483648),oe.TYPED_ARRAY_SUPPORT?(this[o]=255&a,this[o+1]=a>>>8,this[o+2]=a>>>16,this[o+3]=a>>>24):k(this,a,o,!0),o+4},oe.prototype.writeInt32BE=function(a,o,e){return a=+a,o|=0,e||R(this,a,o,4,2147483647,-2147483648),0>a&&(a=4294967295+a+1),oe.TYPED_ARRAY_SUPPORT?(this[o]=a>>>24,this[o+1]=a>>>16,this[o+2]=a>>>8,this[o+3]=255&a):k(this,a,o,!1),o+4},oe.prototype.writeFloatLE=function(a,t,e){return re(this,a,t,!0,e)},oe.prototype.writeFloatBE=function(a,t,e){return re(this,a,t,!1,e)},oe.prototype.writeDoubleLE=function(a,t,e){return N(this,a,t,!0,e)},oe.prototype.writeDoubleBE=function(a,t,e){return N(this,a,t,!1,e)},oe.prototype.copy=function(o,t,e,n){if(e||(e=0),n||0===n||(n=this.length),t>=o.length&&(t=o.length),t||(t=0),0<n&&n<e&&(n=e),n===e)return 0;if(0===o.length||0===this.length)return 0;if(0>t)throw new RangeError("targetStart out of bounds");if(0>e||e>=this.length)throw new RangeError("sourceStart out of bounds");if(0>n)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),o.length-t<n-e&&(n=o.length-t+e);var i=n-e,a;if(this===o&&e<t&&t<n)for(a=i-1;0<=a;--a)o[a+t]=this[a+e];else if(1e3>i||!oe.TYPED_ARRAY_SUPPORT)for(a=0;a<i;++a)o[a+t]=this[a+e];else Uint8Array.prototype.set.call(o,this.subarray(e,e+i),t);return i},oe.prototype.fill=function(o,c,d,p){if("string"==typeof o){if("string"==typeof c?(p=c,c=0,d=this.length):"string"==typeof d&&(p=d,d=this.length),1===o.length){var u=o.charCodeAt(0);256>u&&(o=u)}if(void 0!==p&&"string"!=typeof p)throw new TypeError("encoding must be a string");if("string"==typeof p&&!oe.isEncoding(p))throw new TypeError("Unknown encoding: "+p)}else"number"==typeof o&&(o&=255);if(0>c||this.length<c||this.length<d)throw new RangeError("Out of range index");if(d<=c)return this;c>>>=0,d=void 0===d?this.length:d>>>0,o||(o=0);var r;if("number"==typeof o)for(r=c;r<d;++r)this[r]=o;else{var a=oe.isBuffer(o)?o:j(new oe(o,p).toString()),s=a.length;for(r=0;r<d-c;++r)this[r+c]=a[r%s]}return this};var Q=/[^+\/0-9A-Za-z-_]/g}).call(ee,e(1))},function(m,t,e){"use strict";function n(e){return this instanceof n?void(l.call(this,e),c.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",i)):new n(e)}function i(){this.allowHalfOpen||this._writableState.ended||o(r,this)}function r(e){e.end()}var o=e(16),a=Object.keys||function(a){var t=[];for(var e in a)t.push(e);return t};m.exports=n;var s=e(11);s.inherits=e(12);var l=e(62),c=e(65);s.inherits(n,l);for(var _=a(c.prototype),u=0,p;u<_.length;u++)p=_[u],n.prototype[p]||(n.prototype[p]=c.prototype[p]);Object.defineProperty(n.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),n.prototype._destroy=function(a,t){this.push(null),this.end(),o(t,a)}},function(e){"use strict";var a=a||{};a.lossless=a.lossless||{},a.lossless.DataStream=a.lossless.DataStream||function(a,t,e){this.buffer=new DataView(a,t,e),this.index=0},a.lossless.DataStream.prototype.get16=function(){var e=this.buffer.getUint16(this.index,!1);return this.index+=2,e},a.lossless.DataStream.prototype.get8=function(){var e=this.buffer.getUint8(this.index);return this.index+=1,e},"undefined"!==typeof e&&e.exports&&(e.exports=a.lossless.DataStream)},function(n,t){"use strict";function l(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function i(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))||"function"==typeof o)?o:a}function r(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var o=function(){function a(a,o){for(var e=0,r;e<o.length;e++)r=o[e],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,r.key,r)}return function(t,e,o){return e&&a(t.prototype,e),o&&a(t,o),t}}(),e=function(a){function t(e){l(this,t);var r=i(this,a.call(this));return r._enabled=!0,r._selected=!1,r._hovered=!1,r._active=!1,r._colors={default:"#00B0FF",active:"#FFEB3B",hover:"#F50057",select:"#76FF03"},r._color=r._colors.default,r._dragged=!1,r._displayed=!0,r._container=e,r}return r(t,a),t.prototype.initOffsets=function(){var c=this._container.getBoundingClientRect(),t=document.body,e=document.documentElement,n=window.pageYOffset||e.scrollTop||t.scrollTop,i=window.pageXOffset||e.scrollLeft||t.scrollLeft,r=e.clientTop||t.clientTop||0,o=e.clientLeft||t.clientLeft||0,a=c.top+n-r,s=c.left+i-o;this._offsets={top:P(a),left:P(s)}},t.prototype.offsetChanged=function(){this.initOffsets(),this.update()},t.prototype.getMouseOffsets=function(a,t){return{x:2*((a.clientX-this._offsets.left)/t.offsetWidth)-1,y:2*(-(a.clientY-this._offsets.top)/t.offsetHeight)+1,screenX:a.clientX-this._offsets.left,screenY:a.clientY-this._offsets.top}},t.prototype.update=function(){window.console.log("update() should be overloaded!")},t.prototype.free=function(){this._container=null},t.prototype.updateColor=function(){this._color=this._active?this._colors.active:this._hovered?this._colors.hover:this._selected?this._colors.select:this._colors.default},o(t,[{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e,this.update()}},{key:"selected",get:function(){return this._selected},set:function(e){this._selected=e,this.update()}},{key:"hovered",get:function(){return this._hovered},set:function(e){this._hovered=e,this.update()}},{key:"dragged",get:function(){return this._dragged},set:function(e){this._dragged=e,this.update()}},{key:"displayed",get:function(){return this._displayed},set:function(e){this._displayed=e,this.update()}},{key:"active",get:function(){return this._active},set:function(e){this._active=e,this.update()}},{key:"color",get:function(){return this._color},set:function(e){this._color=e,this.update()}}]),t}(THREE.Object3D);t.a=e},function(l,t,e){"use strict";function n(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}var _=e(3),r=e(14),g=e(0),a=function(){function e(){n(this,e)}return e.aabbPlane=function(a,t){var e=[];if(!this.validateAabb(a)||!this.validatePlane(t))return window.console.log("Invalid aabb or plane provided."),!1;var r=new g.c;r.getInverse(a.toAABB);var n=t.direction.clone().applyMatrix4(a.toAABB),o=new g.f(0,0,0).applyMatrix4(a.toAABB),i=this.posdir(t.position.clone().applyMatrix4(a.toAABB),new g.f(n.x-o.x,n.y-o.y,n.z-o.z).normalize()),l=_.a.bbox(a.center,a.halfDimensions),s=new g.f(new g.f(1,0,0),new g.f(0,1,0),new g.f(0,0,1)),c=this.posdir(new g.f(a.center.x-a.halfDimensions.x,a.center.y-a.halfDimensions.y,a.center.z-a.halfDimensions.z),s.x);this.rayPlaneInBBox(c,i,l,e),c.direction=s.y,this.rayPlaneInBBox(c,i,l,e),c.direction=s.z,this.rayPlaneInBBox(c,i,l,e);var u=this.posdir(new g.f(a.center.x+a.halfDimensions.x,a.center.y+a.halfDimensions.y,a.center.z+a.halfDimensions.z),s.x);this.rayPlaneInBBox(u,i,l,e),u.direction=s.y,this.rayPlaneInBBox(u,i,l,e),u.direction=s.z,this.rayPlaneInBBox(u,i,l,e);var p=this.posdir(new g.f(a.center.x+a.halfDimensions.x,a.center.y-a.halfDimensions.y,a.center.z-a.halfDimensions.z),s.y);this.rayPlaneInBBox(p,i,l,e),p.direction=s.z,this.rayPlaneInBBox(p,i,l,e);var d=this.posdir(new g.f(a.center.x-a.halfDimensions.x,a.center.y+a.halfDimensions.y,a.center.z-a.halfDimensions.z),s.x);this.rayPlaneInBBox(d,i,l,e),d.direction=s.z,this.rayPlaneInBBox(d,i,l,e);var h=this.posdir(new g.f(a.center.x-a.halfDimensions.x,a.center.y-a.halfDimensions.y,a.center.z+a.halfDimensions.z),s.x);return this.rayPlaneInBBox(h,i,l,e),h.direction=s.y,this.rayPlaneInBBox(h,i,l,e),e.map(function(e){return e.applyMatrix4(r)}),e},e.rayPlane=function(a,t){if(0!==a.direction.dot(t.direction)){var e=(t.direction.x*(t.position.x-a.position.x)+t.direction.y*(t.position.y-a.position.y)+t.direction.z*(t.position.z-a.position.z))/(t.direction.x*a.direction.x+t.direction.y*a.direction.y+t.direction.z*a.direction.z);return new g.f(a.position.x+e*a.direction.x,a.position.y+e*a.direction.y,a.position.z+e*a.direction.z)}return null},e.rayBox=function(a,t){var e=[],r=_.a.bbox(t.center,t.halfDimensions),n=this.posdir(new g.f(r.min.x,t.center.y,t.center.z),new g.f(-1,0,0));return this.rayPlaneInBBox(a,n,r,e),n=this.posdir(new g.f(r.max.x,t.center.y,t.center.z),new g.f(1,0,0)),this.rayPlaneInBBox(a,n,r,e),n=this.posdir(new g.f(t.center.x,r.min.y,t.center.z),new g.f(0,-1,0)),this.rayPlaneInBBox(a,n,r,e),n=this.posdir(new g.f(t.center.x,r.max.y,t.center.z),new g.f(0,1,0)),this.rayPlaneInBBox(a,n,r,e),n=this.posdir(new g.f(t.center.x,t.center.y,r.min.z),new g.f(0,0,-1)),this.rayPlaneInBBox(a,n,r,e),n=this.posdir(new g.f(t.center.x,t.center.y,r.max.z),new g.f(0,0,1)),this.rayPlaneInBBox(a,n,r,e),e},e.rayPlaneInBBox=function(a,t,e,o){var n=this.rayPlane(a,t);n&&this.inBBox(n,e)&&(o.find(this.findIntersection(n))||o.push(n))},e.findIntersection=function(a){return function(t){return a.x===t.x&&a.y===t.y&&a.z===t.z}},e.inBBox=function(a,t){return!!(a&&a.x>=t.min.x-1e-4&&a.y>=t.min.y-1e-4&&a.z>=t.min.z-1e-4&&a.x<=t.max.x+1e-4&&a.y<=t.max.y+1e-4&&a.z<=t.max.z+1e-4)},e.posdir=function(a,o){return{position:a,direction:o}},e.validatePlane=function(e){return null===e?(window.console.log("Invalid plane."),window.console.log(e),!1):r.a.vector3(e.position)?!!r.a.vector3(e.direction)||(window.console.log("Invalid plane.direction."),window.console.log(e.direction),!1):(window.console.log("Invalid plane.position."),window.console.log(e.position),!1)},e.validateAabb=function(e){return null===e?(window.console.log("Invalid aabb."),window.console.log(e),!1):r.a.matrix4(e.toAABB)?r.a.vector3(e.center)?!!(r.a.vector3(e.halfDimensions)&&0<=e.halfDimensions.x&&0<=e.halfDimensions.y&&0<=e.halfDimensions.z)||(window.console.log("Invalid aabb.halfDimensions."),window.console.log(e.halfDimensions),!1):(window.console.log("Invalid aabb.center."),window.console.log(e.center),!1):(window.console.log("Invalid aabb.toAABB: "),window.console.log(e.toAABB),!1)},e}();t.a=a},function(a,t){"use strict";function e(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function a(a,o){for(var e=0,r;e<o.length;e++)r=o[e],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,r.key,r)}return function(t,e,o){return e&&a(t.prototype,e),o&&a(t,o),t}}(),r=function(){function a(){e(this,a),this._name="shadersBase",this._base={_functions:{},_uniforms:{}},this._definition=""}return n(a,[{key:"name",get:function(){return this._name},set:function(e){this._name=e}}]),a}();t.a=r},function(a,o,e){(function(e){function a(e){return Object.prototype.toString.call(e)}o.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===a(e)},o.isBoolean=function(e){return"boolean"==typeof e},o.isNull=function(e){return null===e},o.isNullOrUndefined=function(e){return null==e},o.isNumber=function(e){return"number"==typeof e},o.isString=function(e){return"string"==typeof e},o.isSymbol=function(e){return"symbol"==("undefined"===typeof e?"undefined":babelHelpers.typeof(e))},o.isUndefined=function(e){return void 0===e},o.isRegExp=function(e){return"[object RegExp]"===a(e)},o.isObject=function(e){return"object"==("undefined"===typeof e?"undefined":babelHelpers.typeof(e))&&null!==e},o.isDate=function(e){return"[object Date]"===a(e)},o.isError=function(e){return"[object Error]"===a(e)||e instanceof Error},o.isFunction=function(e){return"function"==typeof e},o.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==("undefined"===typeof e?"undefined":babelHelpers.typeof(e))||void 0===e},o.isBuffer=e.isBuffer}).call(o,e(5).Buffer)},function(e){e.exports="function"==typeof Object.create?function(a,o){a.super_=o,a.prototype=Object.create(o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:function(a,t){a.super_=t;var e=function(){};e.prototype=t.prototype,a.prototype=new e,a.prototype.constructor=a}},function(d,t,e){"use strict";function p(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function i(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))||"function"==typeof o)?o:a}function r(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var o=e(8),a=e(9),u=e(0),n=function(){function a(a,o){for(var e=0,r;e<o.length;e++)r=o[e],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,r.key,r)}return function(t,e,o){return e&&a(t.prototype,e),o&&a(t,o),t}}(),l=function(l){function t(e,r,o,a){p(this,t);var n=i(this,l.call(this,a));return n._targetMesh=e,n._controls=r,n._camera=o,n._plane={position:new u.f,direction:new u.f},n._offset=new u.f,n._raycaster=new THREE.Raycaster,n._tracking=!1,n._mouse=new u.e,n._lastEvent=null,n._worldPosition=new u.f,n._screenPosition=new u.e,n._material=null,n._geometry=null,n._mesh=null,n._meshDisplayed=!0,n._meshHovered=!1,n._meshStyle="sphere",n._dom=null,n._domDisplayed=!0,n._domHovered=!1,n._domStyle="circle",null!==n._targetMesh&&n._worldPosition.copy(n._targetMesh.position),n._screenPosition=n.worldToScreen(n._worldPosition,n._camera,n._container),n.create(),n.initOffsets(),n.onMove=n.onMove.bind(n),n.onHover=n.onHover.bind(n),n.onEndControl=n.onEndControl.bind(n),n.addEventListeners(),n}return r(t,l),t.prototype.addEventListeners=function(){this._dom.addEventListener("mouseenter",this.onHover),this._dom.addEventListener("mouseleave",this.onHover),this._container.addEventListener("mousewheel",this.onMove),this._container.addEventListener("DOMMouseScroll",this.onMove),this._controls.addEventListener("end",this.onEndControl)},t.prototype.removeEventListeners=function(){this._dom.removeEventListener("mouseenter",this.onHover),this._dom.removeEventListener("mouseleave",this.onHover),this._container.removeEventListener("mousewheel",this.onMove),this._container.removeEventListener("DOMMouseScroll",this.onMove),this._controls.removeEventListener("end",this.onEndControl)},t.prototype.create=function(){this.createMesh(),this.createDOM()},t.prototype.onStart=function(o){this._lastEvent=o,o.preventDefault();var t=this.getMouseOffsets(o,this._container);if(this._mouse.set(t.x,t.y),this._raycaster.setFromCamera(this._mouse,this._camera),this._raycaster.ray.position=this._raycaster.ray.origin,this._hovered){if(this._active=!0,this._controls.enabled=!1,this._targetMesh){var e=this._raycaster.intersectObject(this._targetMesh);0<e.length&&this._offset.copy(e[0].point).sub(this._worldPosition)}else{this._plane.position.copy(this._worldPosition),this._plane.direction.copy(this._camera.getWorldDirection());var r=a.a.rayPlane(this._raycaster.ray,this._plane);null!==r&&this._offset.copy(r).sub(this._plane.position)}this.update()}},t.prototype.onEnd=function(e){this._lastEvent=e,e.preventDefault(),!0!==this._tracking&&(!this._dragged&&this._active&&(this._selected=!this._selected),this._active=!1,this._dragged=!1,this._controls.enabled=!0,this.update())},t.prototype.onEndControl=function(){var e=this;this._lastEvent&&window.requestAnimationFrame(function(){e.onMove(e._lastEvent)})},t.prototype.onMove=function(o){this._lastEvent=o,o.preventDefault();var t=this.getMouseOffsets(o,this._container);if(!(this._mouse.set(t.x,t.y),this._raycaster.setFromCamera(this._mouse,this._camera),this._raycaster.ray.position=this._raycaster.ray.origin,this._active))this.onHover(null);else if(this._dragged=!0,null!==this._targetMesh){var e=this._raycaster.intersectObject(this._targetMesh);0<e.length&&this._worldPosition.copy(e[0].point.sub(this._offset))}else{0===this._plane.direction.length()&&(this._plane.position.copy(this._worldPosition),this._plane.direction.copy(this._camera.getWorldDirection()));var r=a.a.rayPlane(this._raycaster.ray,this._plane);null!==r&&this._worldPosition.copy(r.sub(this._offset))}this.update()},t.prototype.onHover=function(e){e&&(this._lastEvent=e,e.preventDefault(),this.hoverDom(e)),this.hoverMesh(),this._hovered=this._meshHovered||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"},t.prototype.update=function(){this.updateColor(),this._screenPosition=this.worldToScreen(this._worldPosition,this._camera,this._container),this.updateMeshColor(),this.updateMeshPosition(),this.updateDOMColor(),this.updateDOMPosition()},t.prototype.updateMeshColor=function(){this._material&&this._material.color.set(this._color)},t.prototype.updateMeshPosition=function(){this._mesh&&(this._mesh.position.x=this._worldPosition.x,this._mesh.position.y=this._worldPosition.y,this._mesh.position.z=this._worldPosition.z)},t.prototype.hoverMesh=function(){var e=this._raycaster.intersectObject(this._mesh);this._meshHovered=0<e.length},t.prototype.hoverDom=function(e){this._domHovered="mouseenter"===e.type},t.prototype.worldToScreen=function(a,t,e){var o=a.clone();return o.project(t),o.x=P((o.x+1)*e.offsetWidth/2),o.y=P((1-o.y)*e.offsetHeight/2),o.z=0,o},t.prototype.createMesh=function(){this._geometry=new THREE.SphereGeometry(1,16,16),this._material=new THREE.MeshBasicMaterial({wireframe:!0,wireframeLinewidth:2}),this._mesh=new THREE.Mesh(this._geometry,this._material),this._mesh.position.x=this._worldPosition.x,this._mesh.position.y=this._worldPosition.y,this._mesh.position.z=this._worldPosition.z,this._mesh.visible=!0,this.updateMeshColor(),this.add(this._mesh)},t.prototype.createDOM=function(){this._dom=document.createElement("div"),this._dom.setAttribute("id",this.uuid),this._dom.setAttribute("class","AMI Widget Handle"),this._dom.style.border="2px solid",this._dom.style.backgroundColor="#F9F9F9",this._dom.style.color="#F9F9F9",this._dom.style.position="absolute",this._dom.style.width="12px",this._dom.style.height="12px",this._dom.style.margin="-6px",this._dom.style.borderRadius="50%",this._dom.style.transformOrigin="0 100%";var e=this._screenPosition.y-this._container.offsetHeight;this._dom.style.transform="translate3D("+this._screenPosition.x+"px, "+e+"px, 0)",this.updateDOMColor(),this._container.appendChild(this._dom)},t.prototype.updateDOMPosition=function(){if(this._dom){var e=this._screenPosition.y-this._container.offsetHeight;this._dom.style.transform="translate3D("+this._screenPosition.x+"px, "+e+"px, 0)"}},t.prototype.updateDOMColor=function(){this._dom.style.borderColor=""+this._color},t.prototype.free=function(){this._container.removeChild(this._dom),this.removeEventListeners(),l.prototype.free.call(this)},t.prototype.hideDOM=function(){this._dom.style.display="none"},t.prototype.showDOM=function(){this._dom.style.display=""},t.prototype.hideMesh=function(){this.visible=!1},t.prototype.showMesh=function(){this.visible=!0},t.prototype.show=function(){this.showDOM(),this.showMesh()},t.prototype.hide=function(){this.hideDOM(),this.hideMesh()},n(t,[{key:"worldPosition",set:function(e){this._worldPosition.copy(e),this.update()},get:function(){return this._worldPosition}},{key:"screenPosition",set:function(e){this._screenPosition=e},get:function(){return this._screenPosition}},{key:"active",get:function(){return this._active},set:function(e){this._active=e,this._controls.enabled=!this._active,this.update()}},{key:"tracking",get:function(){return this._tracking},set:function(e){this._tracking=e,this.update()}}]),t}(o.a);t.a=l},function(a,t){"use strict";function e(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function a(){e(this,a)}return a.matrix4=function(e){return null!==e&&void 0!==e&&e.hasOwnProperty("elements")&&16===e.elements.length&&"function"==typeof e.identity&&"function"==typeof e.copy&&"function"==typeof e.determinant},a.vector3=function(e){return null!==e&&void 0!==e&&e.hasOwnProperty("x")&&e.hasOwnProperty("y")&&e.hasOwnProperty("z")&&!e.hasOwnProperty("w")},a.box=function(e){return!!(null!==e&&void 0!==e&&e.hasOwnProperty("center")&&this.vector3(e.center)&&e.hasOwnProperty("halfDimensions")&&this.vector3(e.halfDimensions)&&0<=e.halfDimensions.x&&0<=e.halfDimensions.y&&0<=e.halfDimensions.z)},a.ray=function(e){return!!(null!==e&&void 0!==e&&e.hasOwnProperty("position")&&this.vector3(e.position)&&e.hasOwnProperty("direction")&&this.vector3(e.direction))},a}();t.a=o},function(a,t){"use strict";function e(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function a(){e(this,a),this._rightHanded=!0}return a.prototype.pixelRepresentation=function(){return 0},a.prototype.modality=function(){return"unknown"},a.prototype.segmentationType=function(){return"unknown"},a.prototype.segmentationSegments=function(){return[]},a.prototype.referencedSegmentNumber=function(){return-1},a.prototype.rightHanded=function(){return this._rightHanded},a.prototype.spacingBetweenSlices=function(){return null},a.prototype.numberOfChannels=function(){return 1},a.prototype.sliceThickness=function(){return null},a.prototype.dimensionIndexValues=function(){return 0<arguments.length&&void 0!==arguments[0]&&arguments[0],null},a.prototype.instanceNumber=function(){return 0<arguments.length&&void 0!==arguments[0]?arguments[0]:0},a.prototype.windowCenter=function(){return 0<arguments.length&&void 0!==arguments[0]&&arguments[0],null},a.prototype.windowWidth=function(){return 0<arguments.length&&void 0!==arguments[0]&&arguments[0],null},a.prototype.rescaleSlope=function(){return 0<arguments.length&&void 0!==arguments[0]&&arguments[0],1},a.prototype.rescaleIntercept=function(){return 0<arguments.length&&void 0!==arguments[0]&&arguments[0],0},a.prototype._decompressUncompressed=function(){},a.prototype._swap16=function(e){return(255&e)<<8|255&e>>8},a.prototype._swap32=function(e){return(255&e)<<24|(65280&e)<<8|65280&e>>8|255&e>>24},a.prototype.invert=function(){return!1},a.prototype.transferSyntaxUID=function(){return"no value provided"},a.prototype.studyDate=function(){return"no value provided"},a.prototype.studyDescription=function(){return"no value provided"},a.prototype.seriesDate=function(){return"no value provided"},a.prototype.seriesDescription=function(){return"no value provided"},a.prototype.patientID=function(){return"no value provided"},a.prototype.patientName=function(){return"no value provided"},a.prototype.patientAge=function(){return"no value provided"},a.prototype.patientBirthdate=function(){return"no value provided"},a.prototype.patientSex=function(){return"no value provided"},a.prototype.minMaxPixelData=function(){for(var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=[s,l],e=a.length,o=0,n;o<e;o++)n=a[o],t[0]=U(t[0],n),t[1]=C(t[1],n);return t},a}();t.a=o},function(a,t,e){"use strict";(function(l){a.exports=l.version&&0!==l.version.indexOf("v0.")&&(0!==l.version.indexOf("v1.")||0===l.version.indexOf("v1.8."))?l.nextTick:function(e,c,n,i){if("function"!=typeof e)throw new TypeError("\"callback\" argument must be a function");var r=arguments.length,s,o;switch(r){case 0:case 1:return l.nextTick(e);case 2:return l.nextTick(function(){e.call(null,c)});case 3:return l.nextTick(function(){e.call(null,c,n)});case 4:return l.nextTick(function(){e.call(null,c,n,i)});default:for(s=Array(r-1),o=0;o<s.length;)s[o++]=arguments[o];return l.nextTick(function(){e.apply(null,s)});}}}).call(t,e(4))},function(a,n){"use strict";var e="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;n.assign=function(a){for(var t=Array.prototype.slice.call(arguments,1),e;t.length;)if(e=t.shift(),e){if("object"!=("undefined"===typeof e?"undefined":babelHelpers.typeof(e)))throw new TypeError(e+"must be non-object");for(var o in e)e.hasOwnProperty(o)&&(a[o]=e[o])}return a},n.shrinkBuf=function(a,t){return a.length===t?a:a.subarray?a.subarray(0,t):(a.length=t,a)};var i={arraySet:function(a,t,e,n,i){if(t.subarray&&a.subarray)a.set(t.subarray(e,e+n),i);else for(var r=0;r<n;r++)a[i+r]=t[e+r]},flattenChunks:function(l){var t,e,n,i,r,o;for(n=0,t=0,e=l.length;t<e;t++)n+=l[t].length;for(o=new Uint8Array(n),i=0,t=0,e=l.length;t<e;t++)r=l[t],o.set(r,i),i+=r.length;return o}},r={arraySet:function(a,t,e,n,i){for(var r=0;r<n;r++)a[i+r]=t[e+r]},flattenChunks:function(e){return[].concat.apply([],e)}};n.setTyped=function(e){e?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,i)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,r))},n.setTyped(e)},function(e){"use strict";var a=a||{};a.lossless=a.lossless||{},a.lossless.Utils=a.lossless.Utils||{},a.lossless.Utils.createArray=function(o){var t=Array(o||0),e=o;if(1<arguments.length)for(var n=Array.prototype.slice.call(arguments,1);e--;)t[o-1-e]=a.lossless.Utils.createArray.apply(this,n);return t},a.lossless.Utils.makeCRCTable=function(){for(var a=[],e=0,o;256>e;e++){o=e;for(var t=0;8>t;t++)o=1&o?3988292384^o>>>1:o>>>1;a[e]=o}return a},a.lossless.Utils.crc32=function(o){for(var t=a.lossless.Utils.crcTable||(a.lossless.Utils.crcTable=a.lossless.Utils.makeCRCTable()),e=-1,n=0;n<o.byteLength;n++)e=e>>>8^t[255&(e^o.getUint8(n))];return(-1^e)>>>0},"undefined"!==typeof e&&e.exports&&(e.exports=a.lossless.Utils)},function(a,t,e){"use strict";var o={};(0,e(2).assign)(o,e(112),e(115),e(56)),a.exports=o},function(e){"use strict";e.exports={0:"",1:"stream end",2:"need dictionary","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e){function l(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function d(e){return"function"==typeof e}function n(e){return"number"==typeof e}function i(e){return"object"==("undefined"===typeof e?"undefined":babelHelpers.typeof(e))&&null!==e}function o(e){return void 0===e}e.exports=l,l.EventEmitter=l,l.prototype._events=void 0,l.prototype._maxListeners=void 0,l.defaultMaxListeners=10,l.prototype.setMaxListeners=function(e){if(!n(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},l.prototype.emit=function(a){var t,e,n,r,s,l;if(this._events||(this._events={}),"error"===a&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var c=new Error("Uncaught, unspecified \"error\" event. ("+t+")");throw c.context=t,c}if(e=this._events[a],o(e))return!1;if(d(e))switch(arguments.length){case 1:e.call(this);break;case 2:e.call(this,arguments[1]);break;case 3:e.call(this,arguments[1],arguments[2]);break;default:r=Array.prototype.slice.call(arguments,1),e.apply(this,r);}else if(i(e))for(r=Array.prototype.slice.call(arguments,1),n=(l=e.slice()).length,s=0;s<n;s++)l[s].apply(this,r);return!0},l.prototype.addListener=function(a,t){var e;if(!d(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,d(t.listener)?t.listener:t),this._events[a]?i(this._events[a])?this._events[a].push(t):this._events[a]=[this._events[a],t]:this._events[a]=t,i(this._events[a])&&!this._events[a].warned&&(e=o(this._maxListeners)?l.defaultMaxListeners:this._maxListeners)&&0<e&&this._events[a].length>e&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace()),this},l.prototype.on=l.prototype.addListener,l.prototype.once=function(a,t){function e(){this.removeListener(a,e),o||(o=!0,t.apply(this,arguments))}if(!d(t))throw TypeError("listener must be a function");var o=!1;return e.listener=t,this.on(a,e),this},l.prototype.removeListener=function(o,t){var e,n,r,a;if(!d(t))throw TypeError("listener must be a function");if(!this._events||!this._events[o])return this;if(e=this._events[o],r=e.length,n=-1,e===t||d(e.listener)&&e.listener===t)delete this._events[o],this._events.removeListener&&this.emit("removeListener",o,t);else if(i(e)){for(a=r;0<a--;)if(e[a]===t||e[a].listener&&e[a].listener===t){n=a;break}if(0>n)return this;1===e.length?(e.length=0,delete this._events[o]):e.splice(n,1),this._events.removeListener&&this.emit("removeListener",o,t)}return this},l.prototype.removeAllListeners=function(a){var t,e;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(e=this._events[a],d(e))this.removeListener(a,e);else if(e)for(;e.length;)this.removeListener(a,e[e.length-1]);return delete this._events[a],this},l.prototype.listeners=function(e){return this._events&&this._events[e]?d(this._events[e])?[this._events[e]]:this._events[e].slice():[]},l.prototype.listenerCount=function(a){if(this._events){var t=this._events[a];if(d(t))return 1;if(t)return t.length}return 0},l.listenerCount=function(a,t){return a.listenerCount(t)}},function(a,t){"use strict";function e(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function a(){e(this,a),this._id=-1}return a.prototype.mergeModels=function(a,t){if(!this._validateModelArray(a)||!this._validateModelArray(t))return window.console.log("invalid inputs provided."),!1;for(var e=0;e<t.length;e++)for(var o=0;o<a.length&&!a[o].merge(t[e]);o++)o===a.length-1&&a.push(t[e]);return!0},a.prototype.merge=function(e){return!!this.validate(e)&&this._id===e._id},a.prototype.validate=function(e){return e&&null!==e&&"function"==typeof e.merge},a.prototype._validateModelArray=function(a){if(null===a||Array!==a.constructor)return window.console.log("invalid model array provided."),!1;for(var t=0;t<a.length;t++)if(!a[t]||null===a[t]||"function"!=typeof a[t].validate||!a[t].validate(a[t]))return!1;return!0},a}();t.a=o},function(d,t,e){"use strict";function m(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function i(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))||"function"==typeof o)?o:a}function r(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var _=e(0),n=e(30),o=e(3),g=e(22),c=function(){function a(a,o){for(var e=0,r;e<o.length;e++)r=o[e],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,r.key,r)}return function(t,e,o){return e&&a(t.prototype,e),o&&a(t,o),t}}(),h=e(121),u=function(d){function t(){m(this,t);var e=i(this,d.call(this));return e._uid=null,e._stackID=-1,e._frame=[],e._numberOfFrames=0,e._rows=0,e._columns=0,e._numberOfChannels=1,e._bitsAllocated=8,e._pixelType=0,e._pixelRepresentation=0,e._textureSize=4096,e._nbTextures=7,e._rawData=[],e._windowCenter=0,e._windowWidth=0,e._rescaleSlope=1,e._rescaleIntercept=0,e._minMax=[s,l],e._regMatrix=new _.c,e._ijk2LPS=null,e._lps2IJK=null,e._aabb2LPS=null,e._lps2AABB=null,e._dimensionsIJK=null,e._halfDimensionsIJK=null,e._spacing=new _.f(1,1,1),e._spacingBetweenSlices=0,e._sliceThickness=0,e._origin=null,e._rightHanded=!0,e._xCosine=new _.f(1,0,0),e._yCosine=new _.f(0,1,0),e._zCosine=new _.f(0,0,1),e._prepared=!1,e._packed=!1,e._packedPerPixel=1,e._modality="Modality not set",e._segmentationType=null,e._segmentationSegments=[],e._segmentationDefaultColor=[63,174,128],e._frameSegment=[],e._segmentationLUT=[],e._segmentationLUTO=[],e._invert=!1,e}return r(t,d),t.prototype.prepareSegmentation=function(){this._frameSegment=this._frame;var l=[];this.computeCosines(),this._frame.map(this._computeDistanceArrayMap.bind(null,this._zCosine)),this._frame.sort(this._sortDistanceArraySort);for(var t=-1,e=0;e<this._frame.length;e++){if(l[t]&&l[t]._dist==this._frame[e]._dist)for(var s=0;s<l[t]._rows*l[t]._columns;s++)l[t]._pixelData[s]+=this._frame[e].pixelData[s]*this._frame[e]._referencedSegmentNumber;else{l.push(this._frame[e]),t++;for(var i=0;i<l[t]._rows*l[t]._columns;i++)l[t]._pixelData[i]*=this._frame[e]._referencedSegmentNumber}l[t].minMax=o.a.minMax(l[t]._pixelData)}for(var r={},m=0,a=0;a<this._segmentationSegments.length;a++){m=C(m,parseInt(this._segmentationSegments[a].segmentNumber,10));var c=this._segmentationSegments[a].recommendedDisplayCIELab;r[this._segmentationSegments[a].segmentNumber]=null===c?this._segmentationDefaultColor:n.a.cielab2RGB.apply(n.a,c)}for(var _=0;_<=m;_++){var u=_/m,p=_?1:0,d=[0,0,0];r.hasOwnProperty(_.toString())&&(d=r[_.toString()]),d[0]/=255,d[1]/=255,d[2]/=255,this._segmentationLUT.push([u].concat(d)),this._segmentationLUTO.push([u,p])}this._frame=l},t.prototype.prepare=function(){if("SEG"===this._modality&&this.prepareSegmentation(),!(this._frame&&0<this._frame.length))return window.console.log("_frame doesn't contain anything...."),window.console.log(this._frame),!1;this._numberOfFrames=this._frame.length,this._rows=this._frame[0].rows,this._columns=this._frame[0].columns,this._dimensionsIJK=new _.f(this._columns,this._rows,this._numberOfFrames),this._halfDimensionsIJK=new _.f(this._dimensionsIJK.x/2,this._dimensionsIJK.y/2,this._dimensionsIJK.z/2),this._spacingBetweenSlices=this._frame[0].spacingBetweenSlices,this._sliceThickness=this._frame[0].sliceThickness,this.computeCosines(),this.orderFrames(),this.computeSpacing(),this._frame[0].imagePosition||(this._frame[0].imagePosition=[0,0,0]),this._frame[0].imageOrientation||(this._frame[0].imageOrientation=[1,0,0,0,1,0]),this._origin=this._arrayToVector3(this._frame[0].imagePosition,0),this.computeIJK2LPS(),this.computeLPS2AABB();var a=z(this._frame.length/2),t=this._frame[a];this._rescaleSlope=t.rescaleSlope||1,this._rescaleIntercept=t.rescaleIntercept||0,this.computeMinMaxIntensities(),this._minMax[0]=o.a.rescaleSlopeIntercept(this._minMax[0],this._rescaleSlope,this._rescaleIntercept),this._minMax[1]=o.a.rescaleSlopeIntercept(this._minMax[1],this._rescaleSlope,this._rescaleIntercept);var e=t.windowWidth*this._rescaleSlope||this._minMax[1]-this._minMax[0];this._windowWidth=e+this._rescaleIntercept;var r=t.windowCenter*this._rescaleSlope||this._minMax[0]+e/2;this._windowCenter=r+this._rescaleIntercept,this._bitsAllocated=t.bitsAllocated,this._prepared=!0},t.prototype.packEchos=function(){for(var a=[],t=0;t<this._frame.length;t+=4){for(var e=this._frame[t],o=0;o<this._rows*this._columns;o++){for(var n=1;4>n;n++)e.pixelData[o]+=this._frame[t+n].pixelData[o];e.pixelData[o]/=4}a.push(e)}this._frame=a,this._numberOfFrames=this._frame.length,this._dimensionsIJK=new _.f(this._columns,this._rows,this._numberOfFrames),this._halfDimensionsIJK=new _.f(this._dimensionsIJK.x/2,this._dimensionsIJK.y/2,this._dimensionsIJK.z/2)},t.prototype.computeCosines=function(){if(this._frame&&this._frame[0]){var e=this._frame[0].cosines();this._xCosine=e[0],this._yCosine=e[1],this._zCosine=e[2]}},t.prototype.orderFrames=function(){this._frame[0].dimensionIndexValues?this._frame.sort(this._orderFrameOnDimensionIndicesArraySort):this._frame[0].imagePosition&&this._frame[0].imageOrientation&&this._frame[1]&&this._frame[1].imagePosition&&this._frame[1].imageOrientation&&this._frame[0].imagePosition.join()!==this._frame[1].imagePosition.join()?(this._frame.map(this._computeDistanceArrayMap.bind(null,this._zCosine)),this._frame.sort(this._sortDistanceArraySort)):null!==this._frame[0].instanceNumber&&this._frame[1]&&null!==this._frame[1].instanceNumber&&this._frame[0].instanceNumber!==this._frame[1].instanceNumber?this._frame.sort(this._sortInstanceNumberArraySort):this._frame[0].sopInstanceUID&&this._frame[1]&&this._frame[1].sopInstanceUID&&this._frame[0].sopInstanceUID!==this._frame[1].sopInstanceUID?this._frame.sort(this._sortSopInstanceUIDArraySort):window.console.log("do not know how to order the frames...")},t.prototype.computeSpacing=function(){this.xySpacing(),this.zSpacing()},t.prototype.zSpacing=function(){1<this._numberOfFrames&&(this._frame[0].pixelSpacing&&this._frame[0].pixelSpacing[2]?this._spacing.z=this._frame[0].pixelSpacing[2]:(this._frame.map(this._computeDistanceArrayMap.bind(null,this._zCosine)),this._frame[1].dist===this._frame[0].dist?this._spacingBetweenSlices?this._spacing.z=this._spacingBetweenSlices:this._frame[0].sliceThickness&&(this._spacing.z=this._frame[0].sliceThickness):(this._frame.sort(this._sortDistanceArraySort),this._spacing.z=this._frame[1].dist-this._frame[0].dist))),0===this._spacing.z&&(this._spacing.z=1)},t.prototype.xySpacing=function(){if(this._frame&&this._frame[0]){var e=this._frame[0].spacingXY();this._spacing.x=e[0],this._spacing.y=e[1]}},t.prototype.computeMinMaxIntensities=function(){for(var o=0,t;o<this._frame.length;o++){t=this._frame[o].minMax[0],a(t)||(this._minMax[0]=U(this._minMax[0],t));var e=this._frame[o].minMax[1];a(e)||(this._minMax[1]=C(this._minMax[1],e))}},t.prototype.computeIJK2LPS=function(){this._ijk2LPS=o.a.ijk2LPS(this._xCosine,this._yCosine,this._zCosine,this._spacing,this._origin,this._regMatrix),this._lps2IJK=new _.c,this._lps2IJK.getInverse(this._ijk2LPS)},t.prototype.computeLPS2AABB=function(){this._aabb2LPS=o.a.aabb2LPS(this._xCosine,this._yCosine,this._zCosine,this._origin),this._lps2AABB=new _.c,this._lps2AABB.getInverse(this._aabb2LPS)},t.prototype.merge=function(e){return this._stackID===e.stackID&&this.mergeModels(this._frame,e.frame)},t.prototype.pack=function(){var l=this._dimensionsIJK.x*this._dimensionsIJK.y*this._dimensionsIJK.z;16===this._bitsAllocated&&1===this._numberOfChannels&&(this._packedPerPixel=2);var t=this._textureSize*this._textureSize,e=T(l/(t*this._packedPerPixel)),n=0,i=this._packedPerPixel*t;i>l&&(i=l);for(var r=0,o;r<e;r++)o=this._packTo8Bits(this._numberOfChannels,this._frame,this._textureSize,n,i),this._textureType=o.textureType,this._rawData.push(o.data),n+=this._packedPerPixel*t,(i+=this._packedPerPixel*t)>l&&(i=l);this._packed=!0},t.prototype._packTo8Bits=function(u,t,e,n,i){var r={textureType:null,data:null},o=t[0].bitsAllocated,L=t[0].pixelType,s=0;0>this._minMax[0]&&(s-=this._minMax[0]);var l=0,c=0,R=0,p=t[0].rows*t[0].columns;if(8===o&&1===u||1===o){for(var d=new Uint8Array(1*(e*e)),f=n;f<i;f++){R=f%p;var m=t[c=~~(f/p)].pixelData[R]+=s;a(m)||(d[l]=m),l++}r.textureType=THREE.LuminanceFormat,r.data=d}else if(16===o&&1===u){for(var _=new Uint8Array(4*(e*e)),g=0,y=0,v=n;v<i;v++){R=v%p;var b=t[c=~~(v/p)].pixelData[R]+s;a(b)||(_[4*g+2*y]=255&b,_[4*g+2*y+1]=255&b>>>8),l++,g=z(l/2),y=l%2}r.textureType=THREE.RGBAFormat,r.data=_}else if(32===o&&1===u&&0===L){for(var w=new Uint8Array(4*(e*e)),x=n;x<i;x++){R=x%p;var S=t[c=~~(x/p)].pixelData[R]+s;a(S)||(w[4*l]=255&S,w[4*l+1]=255&S>>>8,w[4*l+2]=255&S>>>16,w[4*l+3]=255&S>>>24),l++}r.textureType=THREE.RGBAFormat,r.data=w}else if(32===o&&1===u&&1===L){for(var E=new Uint8Array(4*(e*e)),M=n;M<i;M++){R=M%p;var T=t[c=~~(M/p)].pixelData[R]+s;if(!a(T)){var A=h(T).match(/.{1,8}/g);E[4*l]=parseInt(A[0],2),E[4*l+1]=parseInt(A[1],2),E[4*l+2]=parseInt(A[2],2),E[4*l+3]=parseInt(A[3],2)}l++}r.textureType=THREE.RGBAFormat,r.data=E}else if(8===o&&3===u){for(var P=new Uint8Array(3*(e*e)),I=n;I<i;I++)c=~~(I/p),R=I%p,P[3*l]=t[c].pixelData[3*R],P[3*l+1]=t[c].pixelData[3*R+1],P[3*l+2]=t[c].pixelData[3*R+2],l++;r.textureType=THREE.RGBFormat,r.data=P}return r},t.prototype.worldCenter=function(){return this._halfDimensionsIJK.clone().addScalar(-.5).applyMatrix4(this._ijk2LPS)},t.prototype.worldBoundingBox=function(){for(var a=[s,l,s,l,s,l],t=this._dimensionsIJK,e=0;e<=t.x;e+=t.x)for(var n=0;n<=t.y;n+=t.y)for(var i=0,r;i<=t.z;i+=t.z)r=new _.f(e,n,i).applyMatrix4(this._ijk2LPS),a=[U(a[0],r.x),C(a[1],r.x),U(a[2],r.y),C(a[3],r.y),U(a[4],r.z),C(a[5],r.z)];return a},t.prototype.AABBox=function(){var a=new _.f().addScalar(-.5).applyMatrix4(this._ijk2LPS).applyMatrix4(this._lps2AABB),t=this._dimensionsIJK.clone().addScalar(-.5).applyMatrix4(this._ijk2LPS).applyMatrix4(this._lps2AABB);return new _.f(B(a.x-t.x),B(a.y-t.y),B(a.z-t.z))},t.prototype.centerAABBox=function(){var e=this.worldCenter();return e.applyMatrix4(this._lps2AABB),e},t.indexInDimensions=function(a,t){return 0<=a.x&&0<=a.y&&0<=a.z&&a.x<t.x&&a.y<t.y&&a.z<t.z},t.prototype._arrayToVector3=function(a,t){return new _.f(a[t],a[t+1],a[t+2])},t.prototype._orderFrameOnDimensionIndicesArraySort=function(a,t){if("dimensionIndexValues"in a&&"[object Array]"===Object.prototype.toString.call(a.dimensionIndexValues)&&"dimensionIndexValues"in t&&"[object Array]"===Object.prototype.toString.call(t.dimensionIndexValues))for(var e=0;e<a.dimensionIndexValues.length;e++){if(parseInt(a.dimensionIndexValues[e],10)>parseInt(t.dimensionIndexValues[e],10))return 1;if(parseInt(a.dimensionIndexValues[e],10)<parseInt(t.dimensionIndexValues[e],10))return-1}else window.console.log("One of the frames doesn't have a dimensionIndexValues array."),window.console.log(a),window.console.log(t);return 0},t.prototype._computeDistanceArrayMap=function(a,t){return t.dist=t.imagePosition[0]*a.x+t.imagePosition[1]*a.y+t.imagePosition[2]*a.z,t},t.prototype._sortDistanceArraySort=function(a,t){return a.dist-t.dist},t.prototype._sortInstanceNumberArraySort=function(a,t){return a.instanceNumber-t.instanceNumber},t.prototype._sortSopInstanceUIDArraySort=function(a,t){return a.sopInstanceUID-t.sopInstanceUID},t.value=function(a,t){return window.console.warn("models.stack.value is deprecated.\n       Please use core.utils.value instead."),o.a.value(a,t)},t.valueRescaleSlopeIntercept=function(a,t,e){return window.console.warn("models.stack.valueRescaleSlopeIntercept is deprecated.\n       Please use core.utils.rescaleSlopeIntercept instead."),o.a.rescaleSlopeIntercept(a,t,e)},t.worldToData=function(a,t){return window.console.warn("models.stack.worldToData is deprecated.\n       Please use core.utils.worldToData instead."),o.a.worldToData(a._lps2IJK,t)},c(t,[{key:"numberOfChannels",set:function(e){this._numberOfChannels=e},get:function(){return this._numberOfChannels}},{key:"frame",set:function(e){this._frame=e},get:function(){return this._frame}},{key:"prepared",set:function(e){this._prepared=e},get:function(){return this._prepared}},{key:"packed",set:function(e){this._packed=e},get:function(){return this._packed}},{key:"packedPerPixel",set:function(e){this._packedPerPixel=e},get:function(){return this._packedPerPixel}},{key:"dimensionsIJK",set:function(e){this._dimensionsIJK=e},get:function(){return this._dimensionsIJK}},{key:"halfDimensionsIJK",set:function(e){this._halfDimensionsIJK=e},get:function(){return this._halfDimensionsIJK}},{key:"regMatrix",set:function(e){this._regMatrix=e},get:function(){return this._regMatrix}},{key:"ijk2LPS",set:function(e){this._ijk2LPS=e},get:function(){return this._ijk2LPS}},{key:"lps2IJK",set:function(e){this._lps2IJK=e},get:function(){return this._lps2IJK}},{key:"lps2AABB",set:function(e){this._lps2AABB=e},get:function(){return this._lps2AABB}},{key:"textureSize",set:function(e){this._textureSize=e},get:function(){return this._textureSize}},{key:"textureType",set:function(e){this._textureType=e},get:function(){return this._textureType}},{key:"bitsAllocated",set:function(e){this._bitsAllocated=e},get:function(){return this._bitsAllocated}},{key:"rawData",set:function(e){this._rawData=e},get:function(){return this._rawData}},{key:"windowWidth",get:function(){return this._windowWidth},set:function(e){this._windowWidth=e}},{key:"windowCenter",get:function(){return this._windowCenter},set:function(e){this._windowCenter=e}},{key:"rescaleSlope",get:function(){return this._rescaleSlope},set:function(e){this._rescaleSlope=e}},{key:"rescaleIntercept",get:function(){return this._rescaleIntercept},set:function(e){this._rescaleIntercept=e}},{key:"xCosine",get:function(){return this._xCosine},set:function(e){this._xCosine=e}},{key:"yCosine",get:function(){return this._yCosine},set:function(e){this._yCosine=e}},{key:"zCosine",get:function(){return this._zCosine},set:function(e){this._zCosine=e}},{key:"minMax",get:function(){return this._minMax},set:function(e){this._minMax=e}},{key:"stackID",get:function(){return this._stackID},set:function(e){this._stackID=e}},{key:"pixelType",get:function(){return this._pixelType},set:function(e){this._pixelType=e}},{key:"pixelRepresentation",get:function(){return this._pixelRepresentation},set:function(e){this._pixelRepresentation=e}},{key:"invert",set:function(e){this._invert=e},get:function(){return this._invert}},{key:"modality",set:function(e){this._modality=e},get:function(){return this._modality}},{key:"rightHanded",get:function(){return this._rightHanded},set:function(e){this._rightHanded=e}},{key:"spacingBetweenSlices",get:function(){return this._spacingBetweenSlices},set:function(e){this._spacingBetweenSlices=e}},{key:"segmentationSegments",set:function(e){this._segmentationSegments=e},get:function(){return this._segmentationSegments}},{key:"segmentationType",set:function(e){this._segmentationType=e},get:function(){return this._segmentationType}},{key:"segmentationLUT",set:function(e){this._segmentationLUT=e},get:function(){return this._segmentationLUT}},{key:"segmentationLUTO",set:function(e){this._segmentationLUTO=e},get:function(){return this._segmentationLUTO}}]),t}(g.a);t.a=u},function(e){"use strict";e.exports=function(e){return"string"==typeof e}},function(a,t,e){"use strict";var o=e(126);a.exports=function(e){return o(e)&&0<=e}},function(a,t,e){"use strict";var o=e(24),i=e(25);a.exports=function(r,t){var e,n;if(!o(r))throw new TypeError("invalid input argument. First argument must be a string. Value: `"+r+"`.");if(!i(t))throw new TypeError("invalid input argument. Second argument must be a nonnegative integer. Value: `"+t+"`.");if(0===r.length||0===t)return"";if(r.length*t>9007199254740991)throw new RangeError("invalid input argument. Output string length exceeds maximum allowed string length.");for(e="",n=t;1==(1&n)&&(e+=r),0!=(n>>>=1);)r+=r;return e}},function(l,t,e){function n(a,t){for(var e in a)t[e]=a[e]}function i(a,t,e){return o(a,t,e)}var r=e(5),o=r.Buffer;o.from&&o.alloc&&o.allocUnsafe&&o.allocUnsafeSlow?l.exports=r:(n(r,t),t.Buffer=i),n(o,i),i.from=function(a,r,e){if("number"==typeof a)throw new TypeError("Argument must not be a number");return o(a,r,e)},i.alloc=function(a,r,e){if("number"!=typeof a)throw new TypeError("Argument must be a number");var l=o(a);return void 0===r?l.fill(0):"string"==typeof e?l.fill(r,e):l.fill(r),l},i.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return o(e)},i.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},function(e){"use strict";var a=a||{};a.Utils=a.Utils||{},a.Utils.crcTable=null,a.Utils.GUNZIP_MAGIC_COOKIE1=31,a.Utils.GUNZIP_MAGIC_COOKIE2=139,a.Utils.getStringAt=function(a,t,e){var n="",o,i;for(o=t;o<e;o+=1)0!==(i=a.getUint8(o))&&(n+=F(i));return n},a.Utils.getByteAt=function(a,t){return a.getInt8(t)},a.Utils.getShortAt=function(a,t,e){return a.getInt16(t,e)},a.Utils.getIntAt=function(a,t,e){return a.getInt32(t,e)},a.Utils.getFloatAt=function(a,t,e){return a.getFloat32(t,e)},a.Utils.getDoubleAt=function(a,t,e){return a.getFloat64(t,e)},a.Utils.getLongAt=function(i,t,e){var n=[],o=0,l;for(l=0;8>l;l+=1)n[l]=a.Utils.getByteAt(i,t+l,e);for(l=n.length-1;0<=l;l--)o=256*o+n[l];return o},a.Utils.toArrayBuffer=function(a){var t,e,o;for(t=new ArrayBuffer(a.length),e=new Uint8Array(t),o=0;o<a.length;o+=1)e[o]=a[o];return t},a.Utils.isString=function(e){return"string"==typeof e||e instanceof String},a.Utils.formatNumber=function(o,r){var e=0;return e=a.Utils.isString(o)?+o:o,e=r?e.toPrecision(5):e.toPrecision(7),parseFloat(e)},a.Utils.makeCRCTable=function(){for(var a=[],e=0,o;256>e;e++){o=e;for(var t=0;8>t;t++)o=1&o?3988292384^o>>>1:o>>>1;a[e]=o}return a},a.Utils.crc32=function(o){for(var t=a.Utils.crcTable||(a.Utils.crcTable=a.Utils.makeCRCTable()),e=-1,n=0;n<o.byteLength;n++)e=e>>>8^t[255&(e^o.getUint8(n))];return(-1^e)>>>0},"undefined"!==typeof e&&e.exports&&(e.exports=a.Utils)},function(e){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(a,t){"use strict";function e(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function a(){e(this,a)}return a.cielab2XYZ=function(a,t,e){var n=(a+16)/116,i=t/500+n,r=n-e/200;return n=.008856<S(n,3)?S(n,3):(n-16/116)/7.787,i=.008856<S(i,3)?S(i,3):(i-16/116)/7.787,r=.008856<S(r,3)?S(r,3):(r-16/116)/7.787,[95.047*i,100*n,108.883*r]},a.xyz2RGB=function(a,t,e){var n=3.2406*(a/=100)+-1.5372*(t/=100)+-.4986*(e/=100),i=-.9689*a+1.8758*t+.0415*e,r=.0557*a+-.204*t+1.057*e;return .0031308<n?n=1.055*S(n,1/2.4)-.055:n*=12.92,.0031308<i?i=1.055*S(i,1/2.4)-.055:i*=12.92,.0031308<r?r=1.055*S(r,1/2.4)-.055:r*=12.92,n*=255,i*=255,r*=255,[n,i,r]},a.cielab2RGB=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:50,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;if(!(0<=a&&100>=a))return null;var o=this.cielab2XYZ(a,t,e);return this.xyz2RGB.apply(this,o)},a}();t.a=o},function(c,t,e){"use strict";function g(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function i(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))||"function"==typeof o)?o:a}function r(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var y=e(9),b=e(0),a=function(a){function s(e,t,r,x){var v=4<arguments.length&&void 0!==arguments[4]?arguments[4]:new b.c;g(this,s);var S={halfDimensions:e,center:t,toAABB:v},u={position:r,direction:x},p=y.a.aabbPlane(S,u);if(3>p.length)throw window.console.log("WARNING: Less than 3 intersections between AABB and Plane."),window.console.log("AABB"),window.console.log(S),window.console.log("Plane"),window.console.log(u),window.console.log("exiting..."),new Error("geometries.slice has less than 3 intersections, can not create a valid geometry.");var d=s.orderIntersections(p,x),f=s.shape(d),m=i(this,a.call(this,f));return m.type="SliceGeometry",m.vertices=d,m.verticesNeedUpdate=!0,m}return r(s,a),s.shape=function(a){var t=new THREE.Shape;t.moveTo(a[0].xy.x,a[0].xy.y);for(var e=1;e<a.length;e++)t.lineTo(a[e].xy.x,a[e].xy.y);return t.lineTo(a[0].xy.x,a[0].xy.y),t},s.centerOfMass=function(a){for(var t=new b.f(0,0,0),e=0;e<a.length;e++)t.x+=a[e].x,t.y+=a[e].y,t.z+=a[e].z;return t.divideScalar(a.length),t},s.orderIntersections=function(e,t){for(var n=s.centerOfMass(e),i=new b.f(e[0].x-n.x,e[0].y-n.y,e[0].z-n.z).normalize(),r=new b.f(0,0,0).crossVectors(i,t).normalize(),o=[],a=0,l;a<e.length;a++){l=new b.f(e[a].x,e[a].y,e[a].z),l.direction=new b.f(e[a].x-n.x,e[a].y-n.y,e[a].z-n.z).normalize();var c=i.dot(l.direction),m=r.dot(l.direction);l.xy={x:c,y:m};var _=D(m,c)*(180/Gn);l.angle=_,o.push(l)}o.sort(function(a,t){return a.angle-t.angle});for(var p=[o[0]],d=1;d<o.length;d++)1e-4<B(o[d-1].angle-o[d].angle)&&p.push(o[d]);return p},s}(THREE.ShapeGeometry);t.a=a},function(c,t,e){"use strict";function d(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function i(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))||"function"==typeof o)?o:a}function r(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var p=e(0),a=function(){function a(a,o){for(var e=0,r;e<o.length;e++)r=o[e],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,r.key,r)}return function(t,e,o){return e&&a(t.prototype,e),o&&a(t,o),t}}(),o=function(l){function t(e){d(this,t);var a=i(this,l.call(this,1,1,1));return a._location=e,a.applyMatrix(new p.c().makeTranslation(a._location.x,a._location.y,a._location.z)),a.verticesNeedUpdate=!0,a}return r(t,l),t.prototype.resetVertices=function(){this.vertices[0].set(.5,.5,.5),this.vertices[1].set(.5,.5,-.5),this.vertices[2].set(.5,-.5,.5),this.vertices[3].set(.5,-.5,-.5),this.vertices[4].set(-.5,.5,-.5),this.vertices[5].set(-.5,.5,.5),this.vertices[6].set(-.5,-.5,-.5),this.vertices[7].set(-.5,-.5,.5)},a(t,[{key:"location",set:function(e){this._location=e,this.vertices[0].set(.5,.5,.5),this.vertices[1].set(.5,.5,-.5),this.vertices[2].set(.5,-.5,.5),this.vertices[3].set(.5,-.5,-.5),this.vertices[4].set(-.5,.5,-.5),this.vertices[5].set(-.5,.5,.5),this.vertices[6].set(-.5,-.5,-.5),this.vertices[7].set(-.5,-.5,.5),this.applyMatrix(new p.c().makeTranslation(this._location.x,this._location.y,this._location.z)),this.verticesNeedUpdate=!0},get:function(){return this._location}}]),t}(THREE.BoxGeometry);t.a=o},function(n,t){"use strict";function l(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function i(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))||"function"==typeof o)?o:a}function r(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var o=function(){function a(a,o){for(var e=0,r;e<o.length;e++)r=o[e],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,r.key,r)}return function(t,e,o){return e&&a(t.prototype,e),o&&a(t,o),t}}(),e=function(a){function t(e){l(this,t);var r=i(this,a.call(this));return r._helpersSlice=e,r._visible=!0,r._color=16711680,r._material=null,r._geometry=null,r._mesh=null,r._create(),r}return r(t,a),t.prototype._create=function(){if(this._material||(this._material=new THREE.LineBasicMaterial({color:this._color,linewidth:1})),this._helpersSlice.geometry.vertices){this._geometry=new THREE.Geometry;for(var e=0;e<this._helpersSlice.geometry.vertices.length;e++)this._geometry.vertices.push(this._helpersSlice.geometry.vertices[e]);this._geometry.vertices.push(this._helpersSlice.geometry.vertices[0]),this._mesh=new THREE.Line(this._geometry,this._material),"IJK"===this._helpersSlice.aabbSpace&&this._mesh.applyMatrix(this._helpersSlice.stack.ijk2LPS),this._mesh.visible=this._visible,this.add(this._mesh)}},t.prototype._update=function(){this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh=null),this._create()},t.prototype.dispose=function(){this._mesh.material.dispose(),this._mesh.material=null,this._geometry.dispose(),this._geometry=null,this._material.dispose(),this._material=null},o(t,[{key:"helpersSlice",set:function(e){this._helpersSlice=e,this._update()},get:function(){return this._helpersSlice}},{key:"visible",set:function(e){this._visible=e,this._mesh&&(this._mesh.visible=this._visible)},get:function(){return this._visible}},{key:"color",set:function(e){this._color=e,this._material&&this._material.color.set(this._color)},get:function(){return this._color}}]),t}(THREE.Object3D);t.a=e},function(c,t,e){"use strict";function d(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function i(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))||"function"==typeof o)?o:a}function r(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var o=e(0),a=function(){function a(a,o){for(var e=0,r;e<o.length;e++)r=o[e],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,r.key,r)}return function(t,e,o){return e&&a(t.prototype,e),o&&a(t,o),t}}(),n=function(l){function t(e){d(this,t);var a=i(this,l.call(this));return a._stack=e,a._visible=!0,a._color=16777215,a._material=null,a._geometry=null,a._mesh=null,a._meshStack=null,a._create(),a}return r(t,l),t.prototype._create=function(){var a=this._stack.dimensionsIJK,t=this._stack.halfDimensionsIJK,e=new o.f(-.5,-.5,-.5),n=new THREE.BoxGeometry(a.x,a.y,a.z);n.applyMatrix(new o.c().makeTranslation(t.x+e.x,t.y+e.y,t.z+e.z)),this._geometry=n,this._material=new THREE.MeshBasicMaterial({wireframe:!0});var i=new THREE.Mesh(this._geometry,null);i.applyMatrix(this._stack.ijk2LPS),i.visible=this._visible,this._meshStack=i,this._mesh=new THREE.BoxHelper(this._meshStack,this._color),this._material=this._mesh.material,this.add(this._mesh)},t.prototype._update=function(){this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh.material.dispose(),this._mesh.material=null,this._mesh=null),this._create()},t.prototype.dispose=function(){this._mesh.material.dispose(),this._mesh.material=null,this._geometry.dispose(),this._geometry=null,this._material.dispose(),this._material=null},a(t,[{key:"visible",set:function(e){this._visible=e,this._mesh&&(this._mesh.visible=this._visible)},get:function(){return this._visible}},{key:"color",set:function(e){this._color=e,this._material&&this._material.color.set(this._color)},get:function(){return this._color}}]),t}(THREE.Object3D);t.a=n},function(a,t){"use strict";function e(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function a(){e(this,a)}return a.uniforms=function(){return{uCanvasWidth:{type:"f",value:0,typeGLSL:"float"},uCanvasHeight:{type:"f",value:0,typeGLSL:"float"},uWidth:{type:"f",value:1,typeGLSL:"float"},uOpacity:{type:"f",value:1,typeGLSL:"float"},uTextureFilled:{type:"t",value:[],typeGLSL:"sampler2D"}}},a}();t.a=o},function(a,t){"use strict";function e(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function a(){e(this,a)}return a.prototype.compute=function(){return"\nvarying vec4 vProjectedCoords;\n\n//\n// main\n//\nvoid main() {\n\n  vec4 vPos = modelMatrix * vec4(position, 1.0 );\n  mat4 vProjectionViewMatrix = projectionMatrix * viewMatrix;\n  vProjectedCoords =  projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0 );\n\n}\n        "},a}();t.a=o},function(a,t){"use strict";function o(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}var e=function(){function a(t){o(this,a),this._uniforms=t,this._functions={},this._main=""}return a.prototype.functions=function(){""===this._main&&this.main();var a="";for(var t in this._functions)a+=this._functions[t]+"\n";return a},a.prototype.uniforms=function(){var a="";for(var t in this._uniforms){var e=this._uniforms[t];a+="uniform "+e.typeGLSL+" "+t,e&&e.length&&(a+="["+e.length+"]"),a+=";\n"}return a},a.prototype.main=function(){this._main="\n\nfloat luma (vec3 rgb) {\n  return (rgb.r + rgb.g + rgb.b)/3.0;\n}\n\nconst float T = 0.04;\nconst float M = 1.0;\nconst float L = 0.002;\n\nvoid main(void) {\n\n  vec2 texCoord = vec2(((vProjectedCoords.x / vProjectedCoords.w) + 1.0 ) / 2.0,\n                ((vProjectedCoords.y / vProjectedCoords.w) + 1.0 ) / 2.0 );\n\n  float borderWidth = uWidth; // in px\n  float step_u = borderWidth * 1.0 / uCanvasWidth;\n  float step_v = borderWidth * 1.0 / uCanvasHeight;\n  vec4 centerPixel = texture2D(uTextureFilled, texCoord);\n\n  vec4 rightPixel  = texture2D(uTextureFilled, texCoord + vec2(step_u, 0.0));\n  vec4 bottomPixel = texture2D(uTextureFilled, texCoord + vec2(0.0, step_v));\n\n  // now manually compute the derivatives\n  float _dFdX = length(rightPixel - centerPixel) / step_u;\n  float _dFdY = length(bottomPixel - centerPixel) / step_v;\n\n  // gl_FragColor.r = _dFdX;\n  // gl_FragColor.g = _dFdY;\n  gl_FragColor.r = max(max(centerPixel.r, rightPixel.r), bottomPixel.r);\n  gl_FragColor.g = max(max(centerPixel.g, rightPixel.g), bottomPixel.g);\n  gl_FragColor.b = max(max(centerPixel.b, rightPixel.b), bottomPixel.b);\n  float maxDerivative = max(_dFdX, _dFdY);\n  float clampedDerivative = clamp(maxDerivative, 0., 1.);\n  gl_FragColor.a = uOpacity * clampedDerivative;\n\n  return;\n  // float h = 1./uCanvasHeight;\n  // float w = 1./uCanvasWidth;\n  // vec4 n[9];\n  // n[0] = texture2D(uTextureFilled, vProjectedTextCoords + vec2( -w, -h));\n  // n[1] = texture2D(uTextureFilled, vProjectedTextCoords + vec2(0.0, -h));\n  // n[2] = texture2D(uTextureFilled, vProjectedTextCoords + vec2(  w, -h));\n  // n[3] = texture2D(uTextureFilled, vProjectedTextCoords + vec2( -w, 0.0));\n  // n[4] = texture2D(uTextureFilled, vProjectedTextCoords);\n  // n[5] = texture2D(uTextureFilled, texCoord + vec2(  w, 0.0));\n  // n[6] = texture2D(uTextureFilled, texCoord + vec2( -w, h));\n  // n[7] = texture2D(uTextureFilled, texCoord + vec2(0.0, h));\n  // n[8] = texture2D(uTextureFilled, texCoord + vec2(  w, h));\n  // vec4 sobel_horizEdge = n[2] + (2.0*n[5]) + n[8] - (n[0] + (2.0*n[3]) + n[6]);\n  // vec4 sobel_vertEdge  = n[0] + (2.0*n[1]) + n[2] - (n[6] + (2.0*n[7]) + n[8]);\n  // vec3 sobel = sqrt((sobel_horizEdge.rgb * sobel_horizEdge.rgb) + (sobel_vertEdge.rgb * sobel_vertEdge.rgb));\n  // gl_FragColor = vec4( sobel, max(max(sobel.r, sobel.g), sobel.b) );\n\n  // return;\n}\n   "},a.prototype.compute=function(){return"\n// uniforms\n"+this.uniforms()+"\n\n// varying (should fetch it from vertex directly)\nvarying vec4      vProjectedCoords;\n\n// tailored functions\n"+this.functions()+"\n\n// main loop\n"+this._main+"\n      "},a}();t.a=e},function(a,t){"use strict";function e(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function a(){e(this,a)}return a.uniforms=function(){return{uCanvasWidth:{type:"f",value:0,typeGLSL:"float"},uCanvasHeight:{type:"f",value:0,typeGLSL:"float"},uSlice:{type:"v4",value:[0,0,0,0],typeGLSL:"vec4"},uPlane1:{type:"v4",value:[0,0,0,0],typeGLSL:"vec4"},uPlaneColor1:{type:"v3",value:[1,1,0],typeGLSL:"vec3"},uPlane2:{type:"v4",value:[0,0,0,0],typeGLSL:"vec4"},uPlaneColor2:{type:"v3",value:[1,1,0],typeGLSL:"vec3"},uPlane3:{type:"v4",value:[0,0,0,0],typeGLSL:"vec4"},uPlaneColor3:{type:"v3",value:[1,1,0],typeGLSL:"vec3"}}},a}();t.a=o},function(a,t){"use strict";function e(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function a(){e(this,a)}return a.prototype.compute=function(){return"\nvarying vec4 vPos;\nvarying mat4 vProjectionViewMatrix;\n\n//\n// main\n//\nvoid main() {\n\n  vPos = modelMatrix * vec4(position, 1.0 );\n  vProjectionViewMatrix = projectionMatrix * viewMatrix;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0 );\n\n}\n        "},a}();t.a=o},function(a,t){"use strict";function o(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}var e=function(){function a(t){o(this,a),this._uniforms=t,this._functions={},this._main=""}return a.prototype.functions=function(){""===this._main&&this.main();var a="";for(var t in this._functions)a+=this._functions[t]+"\n";return a},a.prototype.uniforms=function(){var a="";for(var t in this._uniforms){var e=this._uniforms[t];a+="uniform "+e.typeGLSL+" "+t,e&&e.length&&(a+="["+e.length+"]"),a+=";\n"}return a},a.prototype.main=function(){this._main="\nvoid intersectionProjection(\n  in vec4 plane,\n  in vec4 slice,\n  out vec3 intersectionProjection){\n\n      vec3 intersectionDirection = normalize(cross(plane.xyz, slice.xyz));\n      vec3 intersectionPoint = \n        cross(intersectionDirection,slice.xyz) * plane.w +\n        cross(plane.xyz, intersectionDirection) * slice.w;\n\n      intersectionProjection =\n        intersectionPoint.xyz +\n        (dot(vPos.xyz - intersectionPoint, intersectionDirection)\n          * intersectionDirection);\n\n}\n\nvoid main(void) {\n      vec4 c1 = vec4(0., 0., 0., 0.);\n      vec4 c2 = vec4(0., 0., 0., 0.);\n      vec4 c3 = vec4(0., 0., 0., 0.);\n\n      // localizer #1\n      // must be normalized!\n      if(length(uPlane1.xyz) > 0.5) {\n        vec3 projection1 = vec3(1.);\n        intersectionProjection(\n          uPlane1,\n          uSlice,\n          projection1\n        );\n\n        vec4 projInter1 = (vProjectionViewMatrix * vec4(projection1, 1.));\n        vec3 ndc1 = projInter1.xyz / projInter1.w;\n        vec2 screenSpace1 = (ndc1.xy * .5 + .5) * vec2(uCanvasWidth, uCanvasHeight);\n\n        float d1 = distance(gl_FragCoord.xy, screenSpace1.xy);\n        c1 = vec4(uPlaneColor1, 1. - smoothstep(.5, .7, d1));\n      }\n\n      // localizer #2\n      if(length(uPlane2.xyz) > 0.5) {\n        vec3 projection2 = vec3(1.);\n        intersectionProjection(\n          uPlane2,\n          uSlice,\n          projection2\n        );\n\n        vec4 projInter2 = (vProjectionViewMatrix * vec4(projection2, 1.));\n        vec3 ndc2 = projInter2.xyz / projInter2.w;\n        vec2 screenSpace2 = (ndc2.xy * .5 + .5) * vec2(uCanvasWidth, uCanvasHeight);\n\n        float d2 = distance(gl_FragCoord.xy, screenSpace2.xy);\n        c2 = vec4(uPlaneColor2, 1. - smoothstep(.5, .7, d2));\n      }\n\n      // localizer #3\n      if(length(uPlane3.xyz) > 0.5) {\n        vec3 projection3 = vec3(1.);\n        intersectionProjection(\n          uPlane3,\n          uSlice,\n          projection3\n        );\n\n        vec4 projInter3 = (vProjectionViewMatrix * vec4(projection3, 1.));\n        vec3 ndc3 = projInter3.xyz / projInter3.w;\n        vec2 screenSpace3 = (ndc3.xy * .5 + .5) * vec2(uCanvasWidth, uCanvasHeight);\n\n        float d3 = distance(gl_FragCoord.xy, screenSpace3.xy);\n        c3 = vec4(uPlaneColor3, 1. - smoothstep(.5, .7, d3));\n      }\n\n      // float uBorderDashLength = 10.0;\n      // float uBorderWidth = 2.0;\n      // float valueX = mod(gl_FragCoord.x, 2. * uBorderDashLength);\n      // float valueY = mod(gl_FragCoord.y, 2. * uBorderDashLength);\n      // if( valueX < uBorderDashLength || valueY < uBorderDashLength ){\n        vec3 colorMix = c1.xyz*c1.w + c2.xyz*c2.w + c3.xyz*c3.w;\n        gl_FragColor = vec4(colorMix, max(max(c1.w, c2.w),c3.w)*0.5);\n        return;\n      // }\n      \n      // gl_FragColor = vec4(0., 0., 0., 0.);\n      // return;\n}\n   "},a.prototype.compute=function(){return"\n// uniforms\n"+this.uniforms()+"\n\n// varying (should fetch it from vertex directly)\nvarying vec4 vPos;\nvarying mat4 vProjectionViewMatrix;\n\n// tailored functions\n"+this.functions()+"\n\n// main loop\n"+this._main+"\n      "},a}();t.a=e},function(a,t){"use strict";function o(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}var e=function(){function a(t){o(this,a),this._container=t,this._modes={load:{name:"load",color:"#FFF56F"},parse:{name:"parse",color:"#2196F3"}},this.requestAnimationFrameID=null,this._mode=null,this._value=null,this._total=null,this.init()}return a.prototype.free=function(){var e=this._container.getElementsByClassName("progress container");0<e.length&&e[0].parentNode.removeChild(e[0]),e=null,window.cancelAnimationFrame(this.requestAnimationFrameID)},a.prototype.init=function(){var a=this._domContainer();for(var t in this._modes)if(this._modes.hasOwnProperty(t)){var e=this._domBar(this._modes[t]);a.appendChild(e),e=null}this._container.appendChild(a),a=null,this.updateUI()},a.prototype.update=function(a,t,e){this._mode=e,this._value=a,0===t?(this._total=a,this._value=Math.random()*a):this._total=t},a.prototype.updateUI=function(){var a=this;if(this.requestAnimationFrameID=requestAnimationFrame(function(){a.updateUI()}),!(this._modes.hasOwnProperty(this._mode)&&this._modes[this._mode].hasOwnProperty("name")&&this._modes[this._mode].hasOwnProperty("color")))return!1;var t=P(100*(this._value/this._total)),e=this._modes[this._mode].color,o=this._container.getElementsByClassName("progress "+this._modes[this._mode].name);0<o.length&&(o[0].style.borderColor=e,o[0].style.width=t+"%"),o=null},a.prototype._domContainer=function(){var e=document.createElement("div");return e.classList.add("progress"),e.classList.add("container"),e.style.width="100%",e.style.height="8px",e.style.position="absolute",e.style.backgroundColor="rgba(158, 158, 158, 0.5)",e.style.top="0",e.style.zIndex="1",e},a.prototype._domBar=function(a){if(!a.hasOwnProperty("name")||!a.hasOwnProperty("color"))return window.console.log("Invalid mode provided."),window.console.log(a),!1;var t=document.createElement("div");return t.classList.add(a.name),t.classList.add("progress"),t.style.border="2px solid "+a.color,t.style.width="0%",t},a}();t.a=e},function(m,t,e){"use strict";function _(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function i(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))||"function"==typeof o)?o:a}function r(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var o=e(31),g=e(43),s=e(44),l=e(45),a=e(48),c=e(0),n=function(){function a(a,o){for(var e=0,r;e<o.length;e++)r=o[e],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,r.key,r)}return function(t,e,o){return e&&a(t.prototype,e),o&&a(t,o),t}}(),p=function(u){function t(e){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new c.f(0,0,0),a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new c.f(0,0,1),n=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"IJK";_(this,t);var p=i(this,u.call(this));return p._stack=e,p._invert=p._stack.invert,p._lut="none",p._lutTexture=null,p._intensityAuto=!0,p._interpolation=1,p._index=r,p._windowWidth=null,p._windowCenter=null,p._rescaleSlope=null,p._rescaleIntercept=null,p._canvasWidth=0,p._canvasHeight=0,p._borderColor=null,p._planePosition=o,p._planeDirection=a,p._aaBBspace=n,p._material=null,p._textures=[],p._shadersFragment=l.a,p._shadersVertex=s.a,p._uniforms=g.a.uniforms(),p._geometry=null,p._mesh=null,p._visible=!0,p._init(),p._create(),p}return r(t,u),t.prototype._init=function(){if(this._stack&&this._stack._prepared&&this._stack._packed)if("IJK"===this._aaBBspace)this._halfDimensions=this._stack.halfDimensionsIJK,this._center=new c.f(this._stack.halfDimensionsIJK.x-.5,this._stack.halfDimensionsIJK.y-.5,this._stack.halfDimensionsIJK.z-.5),this._toAABB=new c.c;else{var e=this._stack.AABBox();this._halfDimensions=e.clone().multiplyScalar(.5),this._center=this._stack.centerAABBox(),this._toAABB=this._stack.lps2AABB}},t.prototype._create=function(){if(this._stack&&this._stack.prepared&&this._stack.packed){try{this._geometry=new o.a(this._halfDimensions,this._center,this._planePosition,this._planeDirection,this._toAABB)}catch(e){return window.console.log(e),void window.console.log("invalid slice geometry - exiting...")}this._geometry.vertices&&(this._material||(this._uniforms.uTextureSize.value=this._stack.textureSize,this._uniforms.uDataDimensions.value=[this._stack.dimensionsIJK.x,this._stack.dimensionsIJK.y,this._stack.dimensionsIJK.z],this._uniforms.uWorldToData.value=this._stack.lps2IJK,this._uniforms.uNumberOfChannels.value=this._stack.numberOfChannels,this._uniforms.uPixelType.value=this._stack.pixelType,this._uniforms.uBitsAllocated.value=this._stack.bitsAllocated,this._uniforms.uPackedPerPixel.value=this._stack.packedPerPixel,this._prepareTexture(),this._uniforms.uTextureContainer.value=this._textures,this._createMaterial({side:THREE.DoubleSide})),this.updateIntensitySettings(),this.updateIntensitySettingsUniforms(),this._mesh=new THREE.Mesh(this._geometry,this._material),"IJK"===this._aaBBspace&&this._mesh.applyMatrix(this._stack.ijk2LPS),this._mesh.visible=this._visible,this.add(this._mesh))}},t.prototype.updateIntensitySettings=function(){this._intensityAuto?(this.updateIntensitySetting("windowCenter"),this.updateIntensitySetting("windowWidth"),this.updateIntensitySetting("rescaleSlope"),this.updateIntensitySetting("rescaleIntercept")):(null===this._windowCenter&&(this._windowCenter=this._stack.windowCenter),null===this.__windowWidth&&(this._windowWidth=this._stack.windowWidth),null===this._rescaleSlope&&(this._rescaleSlope=this._stack.rescaleSlope),null===this._rescaleIntercept&&(this._rescaleIntercept=this._stack.rescaleIntercept))},t.prototype.updateIntensitySettingsUniforms=function(){var e=0;0>this._stack._minMax[0]&&(e-=this._stack._minMax[0]),this._uniforms.uRescaleSlopeIntercept.value=[this._rescaleSlope,this._rescaleIntercept],this._uniforms.uWindowCenterWidth.value=[e+this._windowCenter,this._windowWidth],this._uniforms.uInvert.value=!0===this._invert?1:0,this._uniforms.uInterpolation.value=this._interpolation,"none"===this._lut?this._uniforms.uLut.value=0:(this._uniforms.uLut.value=1,this._uniforms.uTextureLUT.value=this._lutTexture)},t.prototype.updateIntensitySetting=function(e){this["_"+e]=this._stack.frame[this._index]&&this._stack.frame[this._index][e]?this._stack.frame[this._index][e]:this._stack[e]},t.prototype._update=function(){this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh=null),this._create()},t.prototype.dispose=function(){for(var e=0;e<this._textures.length;e++)this._textures[e].dispose(),this._textures[e]=null;this._textures=null,this._shadersFragment=null,this._shadersVertex=null,this._uniforms=null,this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh.material.dispose(),this._mesh.material=null,this._mesh=null,this._geometry.dispose(),this._geometry=null,this._material.vertexShader=null,this._material.fragmentShader=null,this._material.uniforms=null,this._material.dispose(),this._material=null,this._stack=null},t.prototype.cartesianEquation=function(){if(!this._geometry||!this._geometry.vertices||3>this._geometry.vertices.length)return new c.g;var l=this._geometry.vertices,t=this._stack.ijk2LPS,e=new c.f(l[0].x,l[0].y,l[0].z).applyMatrix4(t),n=new c.f(l[1].x,l[1].y,l[1].z).applyMatrix4(t),i=new c.f(l[2].x,l[2].y,l[2].z).applyMatrix4(t),r=new c.f,o=new c.f,a=r.subVectors(i,n).cross(o.subVectors(e,n)).normalize();return new c.g(a.x,a.y,a.z,-a.dot(e))},n(t,[{key:"stack",get:function(){return this._stack},set:function(e){this._stack=e}},{key:"windowWidth",get:function(){return this._windowWidth},set:function(e){this._windowWidth=e,this.updateIntensitySettingsUniforms()}},{key:"windowCenter",get:function(){return this._windowCenter},set:function(e){this._windowCenter=e,this.updateIntensitySettingsUniforms()}},{key:"rescaleSlope",get:function(){return this._rescaleSlope},set:function(e){this._rescaleSlope=e,this.updateIntensitySettingsUniforms()}},{key:"rescaleIntercept",get:function(){return this._rescaleIntercept},set:function(e){this._rescaleIntercept=e,this.updateIntensitySettingsUniforms()}},{key:"invert",get:function(){return this._invert},set:function(e){this._invert=e,this.updateIntensitySettingsUniforms()}},{key:"lut",get:function(){return this._lut},set:function(e){this._lut=e}},{key:"lutTexture",get:function(){return this._lutTexture},set:function(e){this._lutTexture=e,this.updateIntensitySettingsUniforms()}},{key:"intensityAuto",get:function(){return this._intensityAuto},set:function(e){this._intensityAuto=e,this.updateIntensitySettings(),this.updateIntensitySettingsUniforms()}},{key:"interpolation",get:function(){return this._interpolation},set:function(e){this._interpolation=e,this.updateIntensitySettingsUniforms(),this._updateMaterial()}},{key:"index",get:function(){return this._index},set:function(e){this._index=e,this._update()}},{key:"planePosition",set:function(e){this._planePosition=e,this._update()},get:function(){return this._planePosition}},{key:"planeDirection",set:function(e){this._planeDirection=e,this._update()},get:function(){return this._planeDirection}},{key:"halfDimensions",set:function(e){this._halfDimensions=e},get:function(){return this._halfDimensions}},{key:"center",set:function(e){this._center=e},get:function(){return this._center}},{key:"aabbSpace",set:function(e){this._aaBBspace=e,this._init()},get:function(){return this._aaBBspace}},{key:"mesh",set:function(e){this._mesh=e},get:function(){return this._mesh}},{key:"geometry",set:function(e){this._geometry=e},get:function(){return this._geometry}},{key:"canvasWidth",set:function(e){this._canvasWidth=e,this._uniforms.uCanvasWidth.value=this._canvasWidth},get:function(){return this._canvasWidth}},{key:"canvasHeight",set:function(e){this._canvasHeight=e,this._uniforms.uCanvasHeight.value=this._canvasHeight},get:function(){return this._canvasHeight}},{key:"borderColor",set:function(e){this._borderColor=e,this._uniforms.uBorderColor.value=new c.a(e)},get:function(){return this._borderColor}}]),t}(Object(a.a)(THREE.Object3D));t.a=p},function(a,t,e){"use strict";function n(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}var i=e(0),r=function(){function e(){n(this,e)}return e.uniforms=function(){return{uTextureSize:{type:"i",value:0,typeGLSL:"int"},uTextureContainer:{type:"tv",value:[],typeGLSL:"sampler2D",length:7},uDataDimensions:{type:"iv",value:[0,0,0],typeGLSL:"ivec3"},uWorldToData:{type:"m4",value:new i.c,typeGLSL:"mat4"},uWindowCenterWidth:{type:"fv1",value:[0,0],typeGLSL:"float",length:2},uRescaleSlopeIntercept:{type:"fv1",value:[0,0],typeGLSL:"float",length:2},uNumberOfChannels:{type:"i",value:1,typeGLSL:"int"},uBitsAllocated:{type:"i",value:8,typeGLSL:"int"},uInvert:{type:"i",value:0,typeGLSL:"int"},uLut:{type:"i",value:0,typeGLSL:"int"},uTextureLUT:{type:"t",value:[],typeGLSL:"sampler2D"},uLutSegmentation:{type:"i",value:0,typeGLSL:"int"},uTextureLUTSegmentation:{type:"t",value:[],typeGLSL:"sampler2D"},uPixelType:{type:"i",value:0,typeGLSL:"int"},uPackedPerPixel:{type:"i",value:1,typeGLSL:"int"},uInterpolation:{type:"i",value:1,typeGLSL:"int"},uCanvasWidth:{type:"f",value:0,typeGLSL:"float"},uCanvasHeight:{type:"f",value:0,typeGLSL:"float"},uBorderColor:{type:"v3",value:[1,0,0.5],typeGLSL:"vec3"},uBorderWidth:{type:"f",value:2,typeGLSL:"float"},uBorderMargin:{type:"f",value:2,typeGLSL:"float"},uBorderDashLength:{type:"f",value:10,typeGLSL:"float"}}},e}();t.a=r},function(a,t){"use strict";function e(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function a(){e(this,a)}return a.prototype.compute=function(){return"\nvarying vec4 vPos;\n\n//\n// main\n//\nvoid main() {\n\n  vPos = modelMatrix * vec4(position, 1.0 );\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0 );\n\n}\n        "},a}();t.a=o},function(a,t,e){"use strict";function n(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}var i=e(46),r=function(){function a(t){n(this,a),this._uniforms=t,this._functions={},this._main=""}return a.prototype.functions=function(){""===this._main&&this.main();var a="";for(var t in this._functions)a+=this._functions[t]+"\n";return a},a.prototype.uniforms=function(){var a="";for(var t in this._uniforms){var e=this._uniforms[t];a+="uniform "+e.typeGLSL+" "+t,e&&e.length&&(a+="["+e.length+"]"),a+=";\n"}return a},a.prototype.main=function(){this._main="\nvoid main(void) {\n\n  // draw border if slice is cropped\n  // float uBorderDashLength = 10.;\n\n  if( uCanvasWidth > 0. &&\n      ((gl_FragCoord.x > uBorderMargin && (gl_FragCoord.x - uBorderMargin) < uBorderWidth) ||\n       (gl_FragCoord.x < (uCanvasWidth - uBorderMargin) && (gl_FragCoord.x + uBorderMargin) > (uCanvasWidth - uBorderWidth) ))){\n    float valueY = mod(gl_FragCoord.y, 2. * uBorderDashLength);\n    if( valueY < uBorderDashLength && gl_FragCoord.y > uBorderMargin && gl_FragCoord.y < (uCanvasHeight - uBorderMargin) ){\n      gl_FragColor = vec4(uBorderColor, 1.);\n      return;\n    }\n  }\n\n  if( uCanvasHeight > 0. &&\n      ((gl_FragCoord.y > uBorderMargin && (gl_FragCoord.y - uBorderMargin) < uBorderWidth) ||\n       (gl_FragCoord.y < (uCanvasHeight - uBorderMargin) && (gl_FragCoord.y + uBorderMargin) > (uCanvasHeight - uBorderWidth) ))){\n    float valueX = mod(gl_FragCoord.x, 2. * uBorderDashLength);\n    if( valueX < uBorderDashLength && gl_FragCoord.x > uBorderMargin && gl_FragCoord.x < (uCanvasWidth - uBorderMargin) ){\n      gl_FragColor = vec4(uBorderColor, 1.);\n      return;\n    }\n  }\n\n  // get texture coordinates of current pixel\n  vec4 dataCoordinates = uWorldToData * vPos;\n  vec3 currentVoxel = dataCoordinates.xyz;\n  vec4 dataValue = vec4(0., 0., 0., 0.);\n  vec3 gradient = vec3(0., 0., 0.);\n  "+Object(i.a)(this,"currentVoxel","dataValue","gradient")+"\n\n  // how do we deal wil more than 1 channel?\n  float intensity = dataValue.r;\n  if(uNumberOfChannels == 1){\n    float normalizedIntensity = dataValue.r;\n\n    // rescale/slope\n    normalizedIntensity =\n      normalizedIntensity*uRescaleSlopeIntercept[0] + uRescaleSlopeIntercept[1];\n\n    float windowMin = uWindowCenterWidth[0] - uWindowCenterWidth[1] * 0.5;\n    normalizedIntensity =\n      ( normalizedIntensity - windowMin ) / uWindowCenterWidth[1];\n\n    dataValue.r = dataValue.g = dataValue.b = normalizedIntensity;\n    dataValue.a = 1.0;\n  }\n\n  // Apply LUT table...\n  //\n  if(uLut == 1){\n    // should opacity be grabbed there?\n    dataValue = texture2D( uTextureLUT, vec2( dataValue.r , 1.0) );\n  }\n\n  if(uLutSegmentation == 1){\n    // should opacity be grabbed there?\n    //\n    float textureWidth = 256.;\n    float textureHeight = 128.;\n    float min = 0.;\n    // start at 0!\n    int adjustedIntensity = int(floor(intensity + 0.5));\n\n    // Get row and column in the texture\n    int colIndex = int(mod(float(adjustedIntensity), textureWidth));\n    int rowIndex = int(floor(float(adjustedIntensity)/textureWidth));\n\n    float texWidth = 1./textureWidth;\n    float texHeight = 1./textureHeight;\n  \n    // Map row and column to uv\n    vec2 uv = vec2(0,0);\n    uv.x = 0.5 * texWidth + (texWidth * float(colIndex));\n    uv.y = 1. - (0.5 * texHeight + float(rowIndex) * texHeight);\n\n    dataValue = texture2D( uTextureLUTSegmentation, uv );\n    // uv.x = (0.5 + float(colIndex)) / textureWidth;\n    // uv.y = 1. - (0.5 + float(rowIndex)) / textureHeight;\n    // dataValue = texture2D( uTextureLUTSegmentation, uv );\n  }\n\n  if(uInvert == 1){\n    dataValue = vec4(1.) - dataValue;\n    // how do we deal with that and opacity?\n    dataValue.a = 1.;\n  }\n\n  gl_FragColor = dataValue;\n\n    // if on edge, draw line\n  // float xPos = gl_FragCoord.x/512.;\n  // float yPos = gl_FragCoord.y/512.;\n  // if( xPos < 0.05 || xPos > .95 || yPos < 0.05 || yPos > .95){\n  //   gl_FragColor = vec4(xPos, yPos, 0., 1.);//dataValue;\n  //   //return;\n  // }\n\n}\n   "},a.prototype.compute=function(){return"\n// uniforms\n"+this.uniforms()+"\n\n// varying (should fetch it from vertex directly)\nvarying vec4      vPos;\n\n// tailored functions\n"+this.functions()+"\n\n// main loop\n"+this._main+"\n      "},a}();t.a=r},function(a,t,e){"use strict";var l=e(47),i=e(106);t.a=function(a,t,e,r){switch(a._uniforms.uInterpolation.value){case 0:return l.a.api(a,t,e);case 1:return i.a.api(a,t,e,r);default:return l.a.api(a,t,e);}}},function(d,t,e){"use strict";function p(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function i(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))||"function"==typeof o)?o:a}function r(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var o=e(10),a=e(104),n=e(105),l=function(o){function t(){p(this,t);var e=i(this,o.call(this));return e.name="interpolationIdentity",e._currentVoxel="currentVoxel",e._dataValue="dataValue",e}return r(t,o),t.prototype.api=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._base,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this._currentVoxel,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this._dataValue;return this._base=a,this.compute(t,e)},t.prototype.compute=function(a,t){return this.computeDefinition(),this._base._functions[this._name]=this._definition,this._name+"("+a+", "+t+");"},t.prototype.computeDefinition=function(){this._definition="\nvoid "+this._name+"(in vec3 currentVoxel, out vec4 dataValue){\n  // lower bound\n  vec3 rcurrentVoxel = vec3(floor(currentVoxel.x + 0.5 ), floor(currentVoxel.y + 0.5 ), floor(currentVoxel.z + 0.5 ));\n  ivec3 voxel = ivec3(int(rcurrentVoxel.x), int(rcurrentVoxel.y), int(rcurrentVoxel.z));\n\n  vec4 tmp = vec4(0., 0., 0., 0.);\n  int offset = 0;\n\n  "+n.a.api(this._base,"voxel","tmp","offset")+"\n  "+a.a.api(this._base,"tmp","offset","dataValue")+"\n}\n    "},t}(o.a);t.a=new l},function(a,t){"use strict";function n(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function i(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))||"function"==typeof o)?o:a}function r(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}t.a=function(e){return function(a){function t(){return n(this,t),i(this,a.apply(this,arguments))}return r(t,a),t.prototype._createMaterial=function(a){var t=new this._shadersFragment(this._uniforms),e=new this._shadersVertex,o={uniforms:this._uniforms,vertexShader:e.compute(),fragmentShader:t.compute()},n=Object.assign(a,o);this._material=new THREE.ShaderMaterial(n),this._material.needsUpdate=!0},t.prototype._updateMaterial=function(){var a=new this._shadersFragment(this._uniforms),t=new this._shadersVertex;this._material.vertexShader=t.compute(),this._material.fragmentShader=a.compute(),this._material.needsUpdate=!0},t.prototype._prepareTexture=function(){this._textures=[];for(var a=0,t;a<this._stack._rawData.length;a++)t=new THREE.DataTexture(this._stack.rawData[a],this._stack.textureSize,this._stack.textureSize,this._stack.textureType,THREE.UnsignedByteType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.NearestFilter,THREE.NearestFilter),t.needsUpdate=!0,t.flipY=!0,this._textures.push(t)},t}(e)}},function(a,t,e){"use strict";function n(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}var i=e(0),r=function(){function e(){n(this,e)}return e.uniforms=function(){return{uTextureSize:{type:"i",value:0,typeGLSL:"int"},uTextureContainer:{type:"tv",value:[],typeGLSL:"sampler2D",length:7},uDataDimensions:{type:"iv",value:[0,0,0],typeGLSL:"ivec3"},uWorldToData:{type:"m4",value:new i.c,typeGLSL:"mat4"},uWindowCenterWidth:{type:"fv1",value:[0,0],typeGLSL:"float",length:2},uRescaleSlopeIntercept:{type:"fv1",value:[0,0],typeGLSL:"float",length:2},uNumberOfChannels:{type:"i",value:1,typeGLSL:"int"},uBitsAllocated:{type:"i",value:8,typeGLSL:"int"},uInvert:{type:"i",value:0,typeGLSL:"int"},uLut:{type:"i",value:0,typeGLSL:"int"},uTextureLUT:{type:"t",value:[],typeGLSL:"sampler2D"},uPixelType:{type:"i",value:0,typeGLSL:"int"},uPackedPerPixel:{type:"i",value:1,typeGLSL:"int"},uInterpolation:{type:"i",value:1,typeGLSL:"int"},uWorldBBox:{type:"fv1",value:[0,0,0,0,0,0],typeGLSL:"float",length:6},uSteps:{type:"i",value:256,typeGLSL:"int"},uAlphaCorrection:{type:"f",value:.5,typeGLSL:"float"},uFrequence:{type:"f",value:0,typeGLSL:"float"},uAmplitude:{type:"f",value:0,typeGLSL:"float"},uShading:{type:"i",value:1,typeGLSL:"int"},uAmbient:{type:"f",value:.1,typeGLSL:"float"},uAmbientColor:{type:"v3",value:[1,1,0],typeGLSL:"vec3"},uSampleColorToAmbient:{type:"i",value:1,typeGLSL:"int"},uSpecular:{type:"f",value:1,typeGLSL:"float"},uSpecularColor:{type:"v3",value:[1,1,1],typeGLSL:"vec3"},uDiffuse:{type:"f",value:.3,typeGLSL:"float"},uDiffuseColor:{type:"v3",value:[1,1,0],typeGLSL:"vec3"},uSampleColorToDiffuse:{type:"i",value:1,typeGLSL:"int"},uShininess:{type:"f",value:5,typeGLSL:"float"},uLightPosition:{type:"v3",value:[0,0,0],typeGLSL:"vec3"},uLightPositionInCamera:{type:"i",value:1,typeGLSL:"int"},uIntensity:{type:"v3",value:[0.8,0.8,0.8],typeGLSL:"vec3"}}},e}();t.a=r},function(a,t){"use strict";function e(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function a(){e(this,a)}return a.prototype.compute=function(){return"\nvarying vec4 vPos;\n\n//\n// main\n//\nvoid main() {\n\n  vPos = modelMatrix * vec4(position, 1.0 );\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0 );\n\n}\n        "},a}();t.a=o},function(l,t,e){"use strict";function n(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}var i=e(46),r=e(109),o=function(){function a(t){n(this,a),this._uniforms=t,this._functions={},this._main=""}return a.prototype.functions=function(){""===this._main&&this.main();var a="";for(var t in this._functions)a+=this._functions[t]+"\n";return a},a.prototype.uniforms=function(){var a="";for(var t in this._uniforms){var e=this._uniforms[t];a+="uniform "+e.typeGLSL+" "+t,e&&e.length&&(a+="["+e.length+"]"),a+=";\n"}return a},a.prototype.main=function(){this._main="\nvoid getIntensity(in vec3 dataCoordinates, out float intensity, out vec3 gradient){\n\n  vec4 dataValue = vec4(0., 0., 0., 0.);\n  "+Object(i.a)(this,"dataCoordinates","dataValue","gradient")+"\n\n  intensity = dataValue.r;\n\n  // rescale/slope\n  intensity = intensity*uRescaleSlopeIntercept[0] + uRescaleSlopeIntercept[1];\n  // window level\n  float windowMin = uWindowCenterWidth[0] - uWindowCenterWidth[1] * 0.5;\n  intensity = ( intensity - windowMin ) / uWindowCenterWidth[1];\n}\n\nmat4 inverse(mat4 m) {\n  float\n    a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n    a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n    a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n    a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n    b00 = a00 * a11 - a01 * a10,\n    b01 = a00 * a12 - a02 * a10,\n    b02 = a00 * a13 - a03 * a10,\n    b03 = a01 * a12 - a02 * a11,\n    b04 = a01 * a13 - a03 * a11,\n    b05 = a02 * a13 - a03 * a12,\n    b06 = a20 * a31 - a21 * a30,\n    b07 = a20 * a32 - a22 * a30,\n    b08 = a20 * a33 - a23 * a30,\n    b09 = a21 * a32 - a22 * a31,\n    b10 = a21 * a33 - a23 * a31,\n    b11 = a22 * a33 - a23 * a32,\n\n    det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat4(\n    a11 * b11 - a12 * b10 + a13 * b09,\n    a02 * b10 - a01 * b11 - a03 * b09,\n    a31 * b05 - a32 * b04 + a33 * b03,\n    a22 * b04 - a21 * b05 - a23 * b03,\n    a12 * b08 - a10 * b11 - a13 * b07,\n    a00 * b11 - a02 * b08 + a03 * b07,\n    a32 * b02 - a30 * b05 - a33 * b01,\n    a20 * b05 - a22 * b02 + a23 * b01,\n    a10 * b10 - a11 * b08 + a13 * b06,\n    a01 * b08 - a00 * b10 - a03 * b06,\n    a30 * b04 - a31 * b02 + a33 * b00,\n    a21 * b02 - a20 * b04 - a23 * b00,\n    a11 * b07 - a10 * b09 - a12 * b06,\n    a00 * b09 - a01 * b07 + a02 * b06,\n    a31 * b01 - a30 * b03 - a32 * b00,\n    a20 * b03 - a21 * b01 + a22 * b00) / det;\n}\n\n/**\n * Adapted from original sources\n * \n * Original code: \n * http://jamie-wong.com/2016/07/15/ray-marching-signed-distance-functions/\n * https://www.shadertoy.com/view/lt33z7\n * \n * The vec3 returned is the RGB color of the light's contribution.\n *\n * k_a: Ambient color\n * k_d: Diffuse color\n * k_s: Specular color\n * alpha: Shininess coefficient\n * p: position of point being lit\n * eye: the position of the camera\n * lightPos: the position of the light\n * lightIntensity: color/intensity of the light\n *\n * See https://en.wikipedia.org/wiki/Phong_reflection_model#Description\n */\nvec3 phongShading(vec3 k_a, vec3 k_d, vec3 k_s, float shininess, vec3 p, vec3 eye,\n  vec3 lightPos, vec3 lightIntensity, vec3 normal) {\n  vec3 N = normal;\n  vec3 L = normalize(lightPos - p);\n  vec3 V = normalize(eye - p);\n  vec3 R = normalize(reflect(-L, N));\n\n  float dotLN = dot(L, N);\n  float dotRV = dot(R, V);\n\n  if (dotLN < 0.0) {\n    // Light not visible from this point on the surface\n    return k_a;\n  } \n\n  if (dotRV < 0.0) {\n    // Light reflection in opposite direction as viewer, apply only diffuse\n    // component\n    return k_a + lightIntensity * (k_d * dotLN);\n  }\n\n  return k_a + lightIntensity * (k_d * dotLN  + k_s * pow(dotRV, shininess));\n}\n\nvoid main(void) {\n  const int maxSteps = 1024;\n\n  // the ray\n  vec3 rayOrigin = cameraPosition;\n  vec3 rayDirection = normalize(vPos.xyz - rayOrigin);\n\n  vec3 lightOrigin = uLightPositionInCamera == 1 ? cameraPosition : uLightPosition;\n\n  // the Axe-Aligned B-Box\n  vec3 AABBMin = vec3(uWorldBBox[0], uWorldBBox[2], uWorldBBox[4]);\n  vec3 AABBMax = vec3(uWorldBBox[1], uWorldBBox[3], uWorldBBox[5]);\n\n  // Intersection ray/bbox\n  float tNear, tFar;\n  bool intersect = false;\n  "+r.a.api(this,"rayOrigin","rayDirection","AABBMin","AABBMax","tNear","tFar","intersect")+"\n  if (tNear < 0.0) tNear = 0.0;\n\n  // init the ray marching\n  float tCurrent = tNear;\n  float tStep = (tFar - tNear) / float(uSteps);\n  vec4 accumulatedColor = vec4(0.0);\n  float accumulatedAlpha = 0.0;\n  mat4 dataToWorld = inverse(uWorldToData);\n\n  for(int rayStep = 0; rayStep < maxSteps; rayStep++){\n    vec3 currentPosition = rayOrigin + rayDirection * tCurrent;\n    // some non-linear FUN\n    // some occlusion issue to be fixed\n    vec3 transformedPosition = currentPosition; //transformPoint(currentPosition, uAmplitude, uFrequence);\n    // world to data coordinates\n    // rounding trick\n    // first center of first voxel in data space is CENTERED on (0,0,0)\n    vec4 dataCoordinatesRaw = uWorldToData * vec4(transformedPosition, 1.0);\n    vec3 currentVoxel = vec3(dataCoordinatesRaw.x, dataCoordinatesRaw.y, dataCoordinatesRaw.z);\n    float intensity = 0.0;\n    vec3 gradient = vec3(0., 0., 0.);\n    getIntensity(currentVoxel, intensity, gradient);\n    // map gradient to world space and normalize before using\n    // we avoid to call \"normalize\" as it may be undefined if vector length == 0.\n    gradient = (vec3(dataToWorld * vec4(gradient, 0.)));\n    if (length(gradient) > 0.0) {\n      gradient = normalize(gradient);\n    }\n\n    vec4 colorSample;\n    float alphaSample;\n    if(uLut == 1){\n      vec4 colorFromLUT = texture2D( uTextureLUT, vec2( intensity, 1.0) );\n      // 256 colors\n      colorSample = colorFromLUT;\n      alphaSample = colorFromLUT.a;\n    }\n    else{\n      alphaSample = intensity;\n      colorSample.r = colorSample.g = colorSample.b = intensity;\n    }\n\n    if (uShading == 1 && uInterpolation != 0) {\n      vec3 ambientComponent = uSampleColorToAmbient == 1 ? colorSample.xyz : uAmbientColor;\n      ambientComponent *= uAmbient;\n      vec3 diffuseComponent = uSampleColorToDiffuse == 1 ? colorSample.xyz : uDiffuseColor;\n      diffuseComponent *= uDiffuse;\n      vec3 specularComponent = uSpecular * uSpecularColor;\n      float shininess = uShininess;\n      vec3 intensity = uIntensity;\n\n      colorSample.xyz += phongShading(\n        ambientComponent,\n        diffuseComponent,\n        specularComponent,\n        shininess,\n        currentPosition.xyz,\n        rayOrigin.xyz,\n        lightOrigin.xyz,\n        intensity,\n        gradient);\n    }\n\n    alphaSample = 1.0 - pow((1.0- alphaSample),tStep*uAlphaCorrection);\n    alphaSample *= (1.0 - accumulatedAlpha);\n\n    accumulatedColor += alphaSample * colorSample;\n    accumulatedAlpha += alphaSample;\n\n    tCurrent += tStep;\n\n    if(tCurrent > tFar || accumulatedAlpha >= 1.0 ) break;\n  }\n\n  gl_FragColor = vec4(accumulatedColor.xyz, accumulatedAlpha);\n}\n   "},a.prototype.compute=function(){return"\n// uniforms\n"+this.uniforms()+"\n\n// varying (should fetch it from vertex directly)\nvarying vec4      vPos;\n\n// tailored functions\n"+this.functions()+"\n\n// main loop\n"+this._main+"\n      "},a}();t.a=o},function(e){"use strict";e.exports=function(l,t,e,n){for(var i=0|65535&l,r=0|65535&l>>>16,o=0;0!==e;){e-=o=2e3<e?2e3:e;do r=0|r+(i=0|i+t[n++]);while(--o);i%=65521,r%=65521}return 0|(i|r<<16)}},function(e){"use strict";var a=function(){for(var a=[],e=0,o;256>e;e++){o=e;for(var t=0;8>t;t++)o=1&o?3988292384^o>>>1:o>>>1;a[e]=o}return a}();e.exports=function(o,t,e,n){o^=-1;for(var r=n;r<n+e;r++)o=o>>>8^a[255&(o^t[r])];return-1^o}},function(c,t,e){"use strict";function d(a,t){if(65537>t&&(a.subarray&&o||!a.subarray&&r))return F.apply(null,p.shrinkBuf(a,t));for(var e="",n=0;n<t;n++)e+=F(a[n]);return e}var p=e(2),r=!0,o=!0;try{F.apply(null,[0])}catch(e){r=!1}try{F.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var i=new p.Buf8(256),a=0;256>a;a++)i[a]=252<=a?6:248<=a?5:240<=a?4:224<=a?3:192<=a?2:1;i[254]=i[254]=1,t.string2buf=function(r){var t=r.length,s=0,l,e,n,i,o;for(i=0;i<t;i++)55296==(64512&(e=r.charCodeAt(i)))&&i+1<t&&56320==(64512&(n=r.charCodeAt(i+1)))&&(e=65536+(e-55296<<10)+(n-56320),i++),s+=128>e?1:2048>e?2:65536>e?3:4;for(l=new p.Buf8(s),o=0,i=0;o<s;i++)55296==(64512&(e=r.charCodeAt(i)))&&i+1<t&&56320==(64512&(n=r.charCodeAt(i+1)))&&(e=65536+(e-55296<<10)+(n-56320),i++),128>e?l[o++]=e:2048>e?(l[o++]=192|e>>>6,l[o++]=128|63&e):65536>e?(l[o++]=224|e>>>12,l[o++]=128|63&e>>>6,l[o++]=128|63&e):(l[o++]=240|e>>>18,l[o++]=128|63&e>>>12,l[o++]=128|63&e>>>6,l[o++]=128|63&e);return l},t.buf2binstring=function(e){return d(e,e.length)},t.binstring2buf=function(a){for(var t=new p.Buf8(a.length),e=0,o=t.length;e<o;e++)t[e]=a.charCodeAt(e);return t},t.buf2string=function(s,t){var e=t||s.length,l=Array(2*e),c,n,r,o;for(n=0,c=0;c<e;)if(128>(r=s[c++]))l[n++]=r;else if(4<(o=i[r]))l[n++]=65533,c+=o-1;else{for(r&=2===o?31:3===o?15:7;1<o&&c<e;)r=r<<6|63&s[c++],o--;1<o?l[n++]=65533:65536>r?l[n++]=r:(r-=65536,l[n++]=55296|1023&r>>10,l[n++]=56320|1023&r)}return d(l,n)},t.utf8border=function(a,t){var e;for((t=t||a.length)>a.length&&(t=a.length),e=t-1;0<=e&&128==(192&a[e]);)e--;return 0>e?t:0===e?t:e+i[a[e]]>t?e:t}},function(e){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(c,t,e){"use strict";function d(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function i(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))||"function"==typeof o)?o:a}function r(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var o=e(22),a=function(){function a(a,o){for(var e=0,r;e<o.length;e++)r=o[e],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,r.key,r)}return function(t,e,o){return e&&a(t.prototype,e),o&&a(t,o),t}}(),n=function(o){function t(){d(this,t);var e=i(this,o.call(this));return e._concatenationUID=-1,e._seriesInstanceUID=-1,e._transferSyntaxUID="",e._seriesNumber=-1,e._seriesDescription="",e._seriesDate="",e._studyDescription="",e._studyDate="",e._accessionNumber=-1,e._modality="Modality not set",e._dimensionIndexSequence=[],e._numberOfFrames=0,e._numberOfChannels=1,e._patientID="",e._patientName="",e._patientAge="",e._patientBirthdate="",e._patientSex="",e._segmentationType=null,e._segmentationSegments=[],e._stack=[],e}return r(t,o),t.prototype.validate=function(t){return!!(o.prototype.validate.call(this,t)&&"function"==typeof t.mergeSeries&&t.hasOwnProperty("_seriesInstanceUID")&&t.hasOwnProperty("_numberOfFrames")&&t.hasOwnProperty("_numberOfChannels")&&t.hasOwnProperty("_stack")&&void 0!==t._stack&&Array===t._stack.constructor)},t.prototype.merge=function(e){return!!this.validate(e)&&this._seriesInstanceUID===e.seriesInstanceUID&&this.mergeModels(this._stack,e.stack)},t.prototype.mergeSeries=function(a){var t=[this];return this.mergeModels(t,a),t},a(t,[{key:"seriesInstanceUID",set:function(e){this._seriesInstanceUID=e},get:function(){return this._seriesInstanceUID}},{key:"transferSyntaxUID",set:function(e){this._transferSyntaxUID=e},get:function(){return this._transferSyntaxUID}},{key:"transferSyntaxUIDLabel",get:function(){switch(this._transferSyntaxUID){case"1.2.840.10008.1.2.4.90":return"JPEG 2000 Lossless";case"1.2.840.10008.1.2.4.91":return"JPEG 2000 Lossy";case"1.2.840.10008.1.2.4.57":return"JPEG Lossless, Nonhierarchical (Processes 14)";case"1.2.840.10008.1.2.4.70":return"JPEG Lossless, Nonhierarchical (Processes 14 [Selection 1])";case"1.2.840.10008.1.2.4.50":return"JPEG Baseline lossy process 1 (8 bit)";case"1.2.840.10008.1.2.4.51":return"JPEG Baseline lossy process 2 & 4 (12 bit)";case"1.2.840.10008.1.2":return"Implicit VR Little Endian";case"1.2.840.10008.1.2.1":return"Explicit VR Little Endian";case"1.2.840.10008.1.2.2":return"Explicit VR Big Endian";default:return"Unknown transfersyntax: "+this._transferSyntaxUID;}}},{key:"studyDate",set:function(e){this._studyDate=e},get:function(){return this._studyDate}},{key:"studyDescription",set:function(e){this._studyDescription=e},get:function(){return this._studyDescription}},{key:"seriesDate",set:function(e){this._seriesDate=e},get:function(){return this._seriesDate}},{key:"seriesDescription",set:function(e){this._seriesDescription=e},get:function(){return this._seriesDescription}},{key:"patientID",set:function(e){this._patientID=e},get:function(){return this._patientID}},{key:"patientName",set:function(e){this._patientName=e},get:function(){return this._patientName}},{key:"patientAge",set:function(e){this._patientAge=e},get:function(){return this._patientAge}},{key:"patientBirthdate",set:function(e){this._patientBirthdate=e},get:function(){return this._patientBirthdate}},{key:"patientSex",set:function(e){this._patientSex=e},get:function(){return this._patientSex}},{key:"numberOfFrames",set:function(e){this._numberOfFrames=e},get:function(){return this._numberOfFrames}},{key:"numberOfChannels",set:function(e){this._numberOfChannels=e},get:function(){return this._numberOfChannels}},{key:"stack",set:function(e){this._stack=e},get:function(){return this._stack}},{key:"modality",set:function(e){this._modality=e},get:function(){return this._modality}},{key:"segmentationType",set:function(e){this._segmentationType=e},get:function(){return this._segmentationType}},{key:"segmentationSegments",set:function(e){this._segmentationSegments=e},get:function(){return this._segmentationSegments}}]),t}(o.a);t.a=n},function(e){"use strict";e.exports=z},function(e){"use strict";e.exports=T},function(d,t,e){"use strict";function p(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function i(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))||"function"==typeof o)?o:a}function r(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var o=e(22),a=e(0),n=function(){function a(a,o){for(var e=0,r;e<o.length;e++)r=o[e],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,r.key,r)}return function(t,e,o){return e&&a(t.prototype,e),o&&a(t,o),t}}(),l=function(o){function t(){p(this,t);var e=i(this,o.call(this));return e._sopInstanceUID=null,e._url=null,e._stackID=-1,e._rows=0,e._columns=0,e._dimensionIndexValues=[],e._imagePosition=null,e._imageOrientation=null,e._rightHanded=!0,e._sliceThickness=1,e._spacingBetweenSlices=null,e._pixelRepresentation=0,e._pixelType=0,e._pixelSpacing=null,e._pixelAspectRatio=null,e._pixelData=null,e._instanceNumber=null,e._windowCenter=null,e._windowWidth=null,e._rescaleSlope=null,e._rescaleIntercept=null,e._bitsAllocated=8,e._minMax=null,e._dist=null,e._index=-1,e._referencedSegmentNumber=-1,e}return r(t,o),t.prototype.validate=function(t){return!!(o.prototype.validate.call(this,t)&&"function"==typeof t.cosines&&"function"==typeof t.spacingXY&&t.hasOwnProperty("_sopInstanceUID")&&t.hasOwnProperty("_dimensionIndexValues")&&t.hasOwnProperty("_imageOrientation")&&t.hasOwnProperty("_imagePosition"))},t.prototype.merge=function(e){return!!this.validate(e)&&!!(this._compareArrays(this._dimensionIndexValues,e.dimensionIndexValues)&&this._compareArrays(this._imageOrientation,e.imageOrientation)&&this._compareArrays(this._imagePosition,e.imagePosition)&&this._instanceNumber===e.instanceNumber&&this._sopInstanceUID===e.sopInstanceUID)},t.prototype.cosines=function(){var o=[new a.f(1,0,0),new a.f(0,1,0),new a.f(0,0,1)];if(this._imageOrientation&&6===this._imageOrientation.length){var t=new a.f(this._imageOrientation[0],this._imageOrientation[1],this._imageOrientation[2]),e=new a.f(this._imageOrientation[3],this._imageOrientation[4],this._imageOrientation[5]);0<t.length()&&0<e.length()&&(o[0]=t,o[1]=e,o[2]=new a.f(0,0,0).crossVectors(o[0],o[1]).normalize())}else window.console.log("No valid image orientation for frame"),window.console.log(this),window.console.log("Returning default orientation.");return this._rightHanded||o[2].negate(),o},t.prototype.spacingXY=function(){var e=[1,1];return this.pixelSpacing?(e[0]=this.pixelSpacing[0],e[1]=this.pixelSpacing[1]):this.pixelAspectRatio&&(e[0]=1,e[1]=1*this.pixelAspectRatio[1]/this.pixelAspectRatio[0]),e},t.prototype.getPixelData=function(a,t){return this.pixelData[a+this._columns*t]},t.prototype.setPixelData=function(a,t,e){this.pixelData[a+this._columns*t]=e},t.prototype._compareArrays=function(a,t){return a===t||a&&t&&a.join()===t.join()},n(t,[{key:"rows",get:function(){return this._rows},set:function(e){this._rows=e}},{key:"columns",get:function(){return this._columns},set:function(e){this._columns=e}},{key:"spacingBetweenSlices",get:function(){return this._spacingBetweenSlices},set:function(e){this._spacingBetweenSlices=e}},{key:"sliceThickness",get:function(){return this._sliceThickness},set:function(e){this._sliceThickness=e}},{key:"imagePosition",get:function(){return this._imagePosition},set:function(e){this._imagePosition=e}},{key:"imageOrientation",get:function(){return this._imageOrientation},set:function(e){this._imageOrientation=e}},{key:"windowWidth",get:function(){return this._windowWidth},set:function(e){this._windowWidth=e}},{key:"windowCenter",get:function(){return this._windowCenter},set:function(e){this._windowCenter=e}},{key:"rescaleSlope",get:function(){return this._rescaleSlope},set:function(e){this._rescaleSlope=e}},{key:"rescaleIntercept",get:function(){return this._rescaleIntercept},set:function(e){this._rescaleIntercept=e}},{key:"bitsAllocated",get:function(){return this._bitsAllocated},set:function(e){this._bitsAllocated=e}},{key:"dist",get:function(){return this._dist},set:function(e){this._dist=e}},{key:"pixelSpacing",get:function(){return this._pixelSpacing},set:function(e){this._pixelSpacing=e}},{key:"pixelAspectRatio",get:function(){return this._pixelAspectRatio},set:function(e){this._pixelAspectRatio=e}},{key:"minMax",get:function(){return this._minMax},set:function(e){this._minMax=e}},{key:"dimensionIndexValues",get:function(){return this._dimensionIndexValues},set:function(e){this._dimensionIndexValues=e}},{key:"instanceNumber",get:function(){return this._instanceNumber},set:function(e){this._instanceNumber=e}},{key:"pixelData",get:function(){return this._pixelData},set:function(e){this._pixelData=e}},{key:"sopInstanceUID",set:function(e){this._sopInstanceUID=e},get:function(){return this._sopInstanceUID}},{key:"pixelRepresentation",get:function(){return this._pixelRepresentation},set:function(e){this._pixelRepresentation=e}},{key:"pixelType",get:function(){return this._pixelType},set:function(e){this._pixelType=e}},{key:"url",get:function(){return this._url},set:function(e){this._url=e}},{key:"referencedSegmentNumber",get:function(){return this._referencedSegmentNumber},set:function(e){this._referencedSegmentNumber=e}},{key:"rightHanded",get:function(){return this._rightHanded},set:function(e){this._rightHanded=e}},{key:"index",get:function(){return this._index},set:function(e){this._index=e}}]),t}(o.a);t.a=l},function(d,t,e){"use strict";function p(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function i(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))||"function"==typeof o)?o:a}function r(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var o=e(15),m=e(131),a=e(155),l=e(157),s=e(158),n=function(c){function t(e,r){p(this,t);var o=i(this,c.call(this));o._id=r,o._arrayBuffer=e.buffer;var a=new Uint8Array(o._arrayBuffer);o._dataSet=null;try{o._dataSet=m.parseDicom(a)}catch(e){throw window.console.log(e),new Error("parsers.dicom could not parse the file")}return o}return r(t,c),t.prototype.seriesInstanceUID=function(){return this._dataSet.string("x0020000e")},t.prototype.studyInstanceUID=function(){return this._dataSet.string("x0020000d")},t.prototype.modality=function(){return this._dataSet.string("x00080060")},t.prototype.segmentationType=function(){return this._dataSet.string("x00620001")},t.prototype.segmentationSegments=function(){var l=[],t=this._dataSet.elements.x00620002;if(!t)return l;for(var c=0;c<t.items.length;c++){var n=this._recommendedDisplayCIELab(t.items[c]),d=this._segmentationCode(t.items[c]),r=t.items[c].dataSet.uint16("x00620004"),p=t.items[c].dataSet.string("x00620005"),u=t.items[c].dataSet.string("x00620008");l.push({recommendedDisplayCIELab:n,segmentationCodeDesignator:d.segmentationCodeDesignator,segmentationCodeValue:d.segmentationCodeValue,segmentationCodeMeaning:d.segmentationCodeMeaning,segmentNumber:r,segmentLabel:p,segmentAlgorithmType:u})}return l},t.prototype._segmentationCode=function(a){var t="unknown",o="unknown",l="unknown",s=a.dataSet.elements.x00082218;return s&&s.items&&0<s.items.length&&(t=s.items[0].dataSet.string("x00080102"),o=s.items[0].dataSet.string("x00080100"),l=s.items[0].dataSet.string("x00080104")),{segmentationCodeDesignator:t,segmentationCodeValue:o,segmentationCodeMeaning:l}},t.prototype._recommendedDisplayCIELab=function(a){if(!a.dataSet.elements.x0062000d)return null;for(var t=a.dataSet.elements.x0062000d.dataOffset,e=a.dataSet.elements.x0062000d.length,n=a.dataSet.byteArray.slice(t,t+e),i=new Uint16Array(e/2),r=0;r<e/2;r++)i[r]=(n[2*r+1]<<8)+n[2*r];return[100*(i[0]/65535),255*(i[1]/65535)-128,255*(i[2]/65535)-128]},t.prototype.sopInstanceUID=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=this._findStringEverywhere("x2005140f","x00080018",a);return t},t.prototype.transferSyntaxUID=function(){return this._dataSet.string("x00020010")},t.prototype.studyDate=function(){return this._dataSet.string("x00080020")},t.prototype.studyDescription=function(){return this._dataSet.string("x00081030")},t.prototype.seriesDate=function(){return this._dataSet.string("x00080021")},t.prototype.seriesDescription=function(){return this._dataSet.string("x0008103e")},t.prototype.patientName=function(){return this._dataSet.string("x00100010")},t.prototype.patientID=function(){return this._dataSet.string("x00100020")},t.prototype.patientBirthdate=function(){return this._dataSet.string("x00100030")},t.prototype.patientSex=function(){return this._dataSet.string("x00100040")},t.prototype.patientAge=function(){return this._dataSet.string("x00101010")},t.prototype.photometricInterpretation=function(){return this._dataSet.string("x00280004")},t.prototype.planarConfiguration=function(){var e=this._dataSet.uint16("x00280006");return void 0===e&&(e=null),e},t.prototype.samplesPerPixel=function(){return this._dataSet.uint16("x00280002")},t.prototype.numberOfFrames=function(){var e=this._dataSet.intString("x00280008");return void 0===e&&(e=null),e},t.prototype.numberOfChannels=function(){var a=1,t=this.photometricInterpretation();return"RGB"!==t&&"PALETTE COLOR"!==t&&"YBR_FULL"!==t&&"YBR_FULL_422"!==t&&"YBR_PARTIAL_422"!==t&&"YBR_PARTIAL_420"!==t&&"YBR_RCT"!==t||(a=3),a},t.prototype.invert=function(){return"MONOCHROME1"===this.photometricInterpretation()},t.prototype.imageOrientation=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=this._findStringEverywhere("x00209116","x00200037",a);return t&&(t=t.split("\\").map(Number)),t},t.prototype.referencedSegmentNumber=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=-1,e=this._findInGroupSequence("x52009230","x0062000a",a);return null!==e&&(t=e.uint16("x0062000b")),t},t.prototype.pixelAspectRatio=function(){var e=[this._dataSet.intString("x00280034",0),this._dataSet.intString("x00280034",1)];return void 0===e[0]&&(e=null),e},t.prototype.imagePosition=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=this._findStringEverywhere("x00209113","x00200032",a);return t&&(t=t.split("\\").map(Number)),t},t.prototype.instanceNumber=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=null,e=this._dataSet.elements.x52009230;return void 0!==e&&e.items[a].dataSet.elements.x2005140f?t=e.items[a].dataSet.elements.x2005140f.items[0].dataSet.intString("x00200013"):(t=this._dataSet.intString("x00200013"),void 0===t&&(t=null)),t},t.prototype.pixelSpacing=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=this._findStringEverywhere("x00289110","x00280030",a);return t&&(t=t.split("\\").map(Number)),t},t.prototype.rows=function(){0<arguments.length&&void 0!==arguments[0]&&arguments[0];var e=this._dataSet.uint16("x00280010");return void 0===e&&(e=null),e},t.prototype.columns=function(){0<arguments.length&&void 0!==arguments[0]&&arguments[0];var e=this._dataSet.uint16("x00280011");return void 0===e&&(e=null),e},t.prototype.pixelType=function(){return 0<arguments.length&&void 0!==arguments[0]&&arguments[0],0},t.prototype.pixelRepresentation=function(){0<arguments.length&&void 0!==arguments[0]&&arguments[0];var e=this._dataSet.uint16("x00280103");return e},t.prototype.bitsAllocated=function(){0<arguments.length&&void 0!==arguments[0]&&arguments[0];var e=this._dataSet.uint16("x00280100");return e},t.prototype.highBit=function(){0<arguments.length&&void 0!==arguments[0]&&arguments[0];var e=this._dataSet.uint16("x00280102");return e},t.prototype.rescaleIntercept=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return this._findFloatStringInFrameGroupSequence("x00289145","x00281052",e)},t.prototype.rescaleSlope=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return this._findFloatStringInFrameGroupSequence("x00289145","x00281053",e)},t.prototype.windowCenter=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return this._findFloatStringInFrameGroupSequence("x00289132","x00281050",e)},t.prototype.windowWidth=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return this._findFloatStringInFrameGroupSequence("x00289132","x00281051",e)},t.prototype.sliceThickness=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return this._findFloatStringInFrameGroupSequence("x00289110","x00180050",e)},t.prototype.spacingBetweenSlices=function(){0<arguments.length&&void 0!==arguments[0]&&arguments[0];var e=this._dataSet.intString("x00180088");return void 0===e&&(e=null),e},t.prototype.dimensionIndexValues=function(){var l=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=null,e=this._dataSet.elements.x52009230;if(void 0!==e){var n=e.items[l].dataSet.elements.x00209111;if(void 0!==n&&null!==n){var i=(n=n.items[0].dataSet).elements.x00209157;if(void 0!==i&&null!==i){var r=i.length/4;t=[];for(var o=0;o<r;o++)t.push(n.uint32("x00209157",o))}}}return t},t.prototype.inStackPositionNumber=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=null,e=this._dataSet.elements.x52009230;return t=void 0===e?null:e.items[a].dataSet.elements.x00209111.items[0].dataSet.uint32("x00209057"),t},t.prototype.stackID=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=null,e=this._dataSet.elements.x52009230;return t=void 0===e?null:e.items[a].dataSet.elements.x00209111.items[0].dataSet.intString("x00209056"),t},t.prototype.extractPixelData=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=this._decodePixelData(a);return 1<this.numberOfChannels()?this._convertColorSpace(t):t},t.prototype._findInGroupSequence=function(a,t,e){var o=this._dataSet.elements[a];if(void 0!==o){var n=o.items[e].dataSet.elements[t];if(void 0!==n)return n.items[0].dataSet}return null},t.prototype._findStringInGroupSequence=function(a,t,e,o){var n=this._findInGroupSequence(a,t,o);return null===n?null:n.string(e)},t.prototype._findStringInFrameGroupSequence=function(a,t,e){return this._findStringInGroupSequence("x52009229",a,t,0)||this._findStringInGroupSequence("x52009230",a,t,e)},t.prototype._findStringEverywhere=function(a,t,e){var o=this._findStringInFrameGroupSequence(a,t,e);return null===o&&(o=this._dataSet.string(t)),void 0===o&&(o=null),o},t.prototype._findFloatStringInGroupSequence=function(a,t,e,o){var n=this._dataSet.floatString(e);return void 0===n?null===(n=this._findInGroupSequence(a,t,o))?null:n.floatString(e):n},t.prototype._findFloatStringInFrameGroupSequence=function(a,t,e){return this._findFloatStringInGroupSequence("x52009229",a,t,0)||this._findFloatStringInGroupSequence("x52009230",a,t,e)},t.prototype._decodePixelData=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=this.transferSyntaxUID();if("1.2.840.10008.1.2.4.90"===t||"1.2.840.10008.1.2.4.91"===t)return this._decodeJ2K(a);if("1.2.840.10008.1.2.4.57"===t||"1.2.840.10008.1.2.4.70"===t)return this._decodeJPEGLossless(a);if("1.2.840.10008.1.2.4.50"===t||"1.2.840.10008.1.2.4.51"===t)return this._decodeJPEGBaseline(a);if("1.2.840.10008.1.2"===t||"1.2.840.10008.1.2.1"===t)return this._decodeUncompressed(a);if("1.2.840.10008.1.2.2"===t){var e=this._decodeUncompressed(a);return this._swapFrame(e)}throw{error:"no decoder for transfer syntax "+t}},t.prototype.framesAreFragmented=function(e){return e.intString("x00280008")!==e.elements.x7fe00010.fragments.length},t.prototype._decodeJ2K=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=null;if(this._dataSet.elements.x7fe00010.basicOffsetTable.length)t=m.readEncapsulatedImageFrame(this._dataSet,this._dataSet.elements.x7fe00010,a);else if(this.framesAreFragmented(this._dataSet)){var e=m.createJPEGBasicOffsetTable(this._dataSet,this._dataSet.elements.x7fe00010);t=m.readEncapsulatedImageFrame(this._dataSet,this._dataSet.elements.x7fe00010,a,e)}else t=m.readEncapsulatedPixelDataFromFragments(this._dataSet,this._dataSet.elements.x7fe00010,a);var o=new s;if(o.parse(t),1!==o.componentsCount)throw new Error("JPEG2000 decoder returned a componentCount of ${componentsCount}, when 1 is expected");if(1!==o.tiles.length)throw new Error("JPEG2000 decoder returned a tileCount of ${tileCount}, when 1 is expected");return o.tiles[0].items},t.prototype._decodeJPEGLossless=function(){var o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=m.readEncapsulatedPixelData(this._dataSet,this._dataSet.elements.x7fe00010,o),e=this.pixelRepresentation(o),n=8>=this.bitsAllocated(o)?1:2,i=new a.lossless.Decoder().decode(t.buffer,t.byteOffset,t.length,n);return 0===e?2===n?new Uint16Array(i.buffer):new Uint8Array(i.buffer):new Int16Array(i.buffer)},t.prototype._decodeJPEGBaseline=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=m.readEncapsulatedPixelData(this._dataSet,this._dataSet.elements.x7fe00010,a),e=this.rows(a),n=this.columns(a),i=this.bitsAllocated(a),r=new l;return r.parse(t),8===i?r.getData(n,e):16===i?r.getData16(n,e):void 0},t.prototype._decodeUncompressed=function(){var p=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=this.pixelRepresentation(p),e=this.bitsAllocated(p),n=this._dataSet.elements.x7fe00010.dataOffset,i=this.numberOfChannels(),r=this.rows(p)*this.columns(p)*i,o=0,a=this._dataSet.byteArray.buffer;if(0===t&&8===e)return o=n+p*r,new Uint8Array(a,o,r);if(0===t&&16===e)return o=n+2*(p*r),new Uint16Array(a,o,r);if(1===t&&16===e)return o=n+2*(p*r),new Int16Array(a,o,r);if(0===t&&32===e)return o=n+4*(p*r),new Uint32Array(a,o,r);if(0===t&&1===e){var s=new ArrayBuffer(r),l=new Uint8Array(s);o=n+p*r;for(var c=0,h=p*r,u=z(h/8),d=h-8*u,f=T((p*r+r)/8),m=new Uint8Array(a,n),_=u;_<=f;_++){for(;8>d;)if(0===d?l[c]=1&m[_]:1===d?l[c]=1&m[_]>>>1:2===d?l[c]=1&m[_]>>>2:3===d?l[c]=1&m[_]>>>3:4===d?l[c]=1&m[_]>>>4:5===d?l[c]=1&m[_]>>>5:6===d?l[c]=1&m[_]>>>6:7===d?l[c]=1&m[_]>>>7:void 0,d++,++c>=r)return l;d=0}}},t.prototype._convertColorSpace=function(g){var t=null,e=this.photometricInterpretation(),n=this.planarConfiguration();if("RGB"===e&&0===n)t=g;else if("RGB"===e&&1===n){if(g instanceof Int8Array)t=new Int8Array(g.length);else if(g instanceof Uint8Array)t=new Uint8Array(g.length);else if(g instanceof Int16Array)t=new Int16Array(g.length);else{if(!(g instanceof Uint16Array))throw new Error("unsuported typed array: "+g);t=new Uint16Array(g.length)}for(var i=g.length/3,r=0,o=0,a=i,s=2*i,l=0;l<i;l++)t[r++]=g[o++],t[r++]=g[a++],t[r++]=g[s++]}else{if("YBR_FULL"!==e)throw new Error("photometric interpolation not supported: "+e);if(g instanceof Int8Array)t=new Int8Array(g.length);else if(g instanceof Uint8Array)t=new Uint8Array(g.length);else if(g instanceof Int16Array)t=new Int16Array(g.length);else{if(!(g instanceof Uint16Array))throw new Error("unsuported typed array: "+g);t=new Uint16Array(g.length)}for(var c=g.length/3,h=0,u=0,p=0;p<c;p++){var d=g[h++],f=g[h++],m=g[h++];t[u++]=d+1.402*(m-128),t[u++]=d-.34414*(f-128)-.71414*(m-128),t[u++]=d+1.772*(f-128)}}return t},t.prototype._swapFrame=function(a){var t=this.bitsAllocated();if(16===t)for(var e=0;e<a.length;e++)a[e]=this._swap16(a[e]);else if(32===t)for(var o=0;o<a.length;o++)a[o]=this._swap32(a[o]);return a},t}(o.a);t.a=n},function(X,t,Y){"use strict";(function(t,Z){function J(e){return D.from(e)}function r(e){return D.isBuffer(e)||e instanceof k}function i(a,t,e){return"function"==typeof a.prependListener?a.prependListener(t,e):void(a._events&&a._events[t]?L(a._events[t])?a._events[t].unshift(e):a._events[t]=[e,a._events[t]]:a.on(t,e))}function e(a,t){A=A||Y(6),a=a||{},this.objectMode=!!a.objectMode,t instanceof A&&(this.objectMode=this.objectMode||!!a.readableObjectMode);var e=a.highWaterMark,o=this.objectMode?16:16384;this.highWaterMark=e||0===e?e:o,this.highWaterMark=z(this.highWaterMark),this.buffer=new B,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=a.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,a.encoding&&(G||(G=Y(66).StringDecoder),this.decoder=new G(a.encoding),this.encoding=a.encoding)}function a(o){return(A=A||Y(6),!(this instanceof a))?new a(o):void(this._readableState=new e(o,this),this.readable=!0,o&&("function"==typeof o.read&&(this._read=o.read),"function"==typeof o.destroy&&(this._destroy=o.destroy)),R.call(this))}function o(r,t,p,m,i){var o=r._readableState;if(null===t)o.reading=!1,d(r,o);else{var a;i||(a=c(o,t)),a?r.emit("error",a):o.objectMode||t&&0<t.length?("string"==typeof t||o.objectMode||Object.getPrototypeOf(t)===D.prototype||(t=J(t)),m?o.endEmitted?r.emit("error",new Error("stream.unshift() after end event")):l(r,o,t,!0):o.ended?r.emit("error",new Error("stream.push() after EOF")):(o.reading=!1,o.decoder&&!p?(t=o.decoder.write(t),o.objectMode||0!==t.length?l(r,o,t,!1):_(r,o)):l(r,o,t,!1))):m||(o.reading=!1)}return u(o)}function l(a,t,e,o){t.flowing&&0===t.length&&!t.sync?(a.emit("data",e),a.read(0)):(t.length+=t.objectMode?1:e.length,o?t.buffer.unshift(e):t.buffer.push(e),t.needReadable&&p(a)),_(a,t)}function c(a,t){var o;return r(t)||"string"==typeof t||void 0===t||a.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o}function u(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}function n(e){return e>=V?e=V:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function s(a,t){return 0>=a||0===t.length&&t.ended?0:t.objectMode?1:a===a?(a>t.highWaterMark&&(t.highWaterMark=n(a)),a<=t.length?a:t.ended?t.length:(t.needReadable=!0,0)):t.flowing&&t.length?t.buffer.head.data.length:t.length}function d(a,t){if(!t.ended){if(t.decoder){var e=t.decoder.end();e&&e.length&&(t.buffer.push(e),t.length+=t.objectMode?1:e.length)}t.ended=!0,p(a)}}function p(a){var t=a._readableState;t.needReadable=!1,t.emittedReadable||(U("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?C(m,a):m(a))}function m(e){U("emit readable"),e.emit("readable"),x(e)}function _(a,t){t.readingMore||(t.readingMore=!0,C(h,a,t))}function h(a,t){for(var e=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(U("maybeReadMore read 0"),a.read(0),e!==t.length);)e=t.length;t.readingMore=!1}function y(a){return function(){var t=a._readableState;U("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&I(a,"data")&&(t.flowing=!0,x(a))}}function g(e){U("readable nexttick read 0"),e.read(0)}function f(a,t){t.resumeScheduled||(t.resumeScheduled=!0,C(b,a,t))}function b(a,t){t.reading||(U("resume read 0"),a.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,a.emit("resume"),x(a),t.flowing&&!t.reading&&a.read(0)}function x(a){var t=a._readableState;for(U("flow",t.flowing);t.flowing&&null!==a.read(););}function v(a,o){if(0===o.length)return null;var e;return o.objectMode?e=o.buffer.shift():!a||a>=o.length?(e=o.decoder?o.buffer.join(""):1===o.buffer.length?o.buffer.head.data:o.buffer.concat(o.length),o.buffer.clear()):e=S(a,o.buffer,o.decoder),e}function S(a,t,e){var o;return a<t.head.data.length?(o=t.head.data.slice(0,a),t.head.data=t.head.data.slice(a)):o=a===t.head.data.length?t.shift():e?w(a,t):E(a,t),o}function w(l,t){var e=t.head,n=1,i=e.data;for(l-=i.length;e=e.next;){var r=e.data,o=l>r.length?r.length:l;if(i+=o===r.length?r:r.slice(0,l),0===(l-=o)){o===r.length?(++n,t.head=e.next?e.next:t.tail=null):(t.head=e,e.data=r.slice(o));break}++n}return t.length-=n,i}function E(l,t){var e=D.allocUnsafe(l),n=t.head,i=1;for(n.data.copy(e),l-=n.data.length;n=n.next;){var r=n.data,o=l>r.length?r.length:l;if(r.copy(e,e.length-l,0,o),0===(l-=o)){o===r.length?(++i,t.head=n.next?n.next:t.tail=null):(t.head=n,n.data=r.slice(o));break}++i}return t.length-=i,e}function T(a){var t=a._readableState;if(0<t.length)throw new Error("\"endReadable()\" called on non-empty stream");t.endEmitted||(t.ended=!0,C(M,t,a))}function M(a,t){a.endEmitted||0!==a.length||(a.endEmitted=!0,t.readable=!1,t.emit("end"))}function P(a,t){for(var e=0,o=a.length;e<o;e++)if(a[e]===t)return e;return-1}var C=Y(16);X.exports=a;var L=Y(138),A;a.ReadableState=e,Y(21).EventEmitter;var I=function(a,t){return a.listeners(t).length},R=Y(63),D=Y(27).Buffer,k=t.Uint8Array||function(){},F=Y(11);F.inherits=Y(12);var N=Y(139),U;U=N&&N.debuglog?N.debuglog("stream"):function(){};var B=Y(140),O=Y(64),G;F.inherits(a,R);var H=["error","close","destroy","pause","resume"];Object.defineProperty(a.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),a.prototype.destroy=O.destroy,a.prototype._undestroy=O.undestroy,a.prototype._destroy=function(a,t){this.push(null),t(a)},a.prototype.push=function(a,r){var e=this._readableState,i;return e.objectMode?i=!0:"string"==typeof a&&((r=r||e.defaultEncoding)!==e.encoding&&(a=D.from(a,r),r=""),i=!0),o(this,a,r,!1,i)},a.prototype.unshift=function(e){return o(this,e,null,!0,!1)},a.prototype.isPaused=function(){return!1===this._readableState.flowing},a.prototype.setEncoding=function(e){return G||(G=Y(66).StringDecoder),this._readableState.decoder=new G(e),this._readableState.encoding=e,this};var V=8388608;a.prototype.read=function(a){U("read",a),a=parseInt(a,10);var t=this._readableState,e=a;if(0!==a&&(t.emittedReadable=!1),0===a&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return U("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?T(this):p(this),null;if(0===(a=s(a,t))&&t.ended)return 0===t.length&&T(this),null;var o=t.needReadable;U("need readable",o),(0===t.length||t.length-a<t.highWaterMark)&&U("length less than watermark",o=!0),t.ended||t.reading?U("reading or ended",o=!1):o&&(U("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(a=s(e,t)));var n;return null===(n=0<a?v(a,t):null)?(t.needReadable=!0,a=0):t.length-=a,0===t.length&&(t.ended||(t.needReadable=!0),e!==a&&t.ended&&T(this)),null!==n&&this.emit("data",n),n},a.prototype._read=function(){this.emit("error",new Error("_read() is not implemented"))},a.prototype.pipe=function(a,t){function e(a,t){U("onunpipe"),a===u&&t&&!1===t.hasUnpiped&&(t.hasUnpiped=!0,r())}function n(){U("onend"),a.end()}function r(){U("cleanup"),a.removeListener("close",l),a.removeListener("finish",c),a.removeListener("drain",f),a.removeListener("error",s),a.removeListener("unpipe",e),u.removeListener("end",n),u.removeListener("end",h),u.removeListener("data",o),m=!0,p.awaitDrain&&(!a._writableState||a._writableState.needDrain)&&f()}function o(t){U("ondata"),b=!1,!1!==a.write(t)||b||((1===p.pipesCount&&p.pipes===a||1<p.pipesCount&&-1!==P(p.pipes,a))&&!m&&(U("false write response, pause",u._readableState.awaitDrain),u._readableState.awaitDrain++,b=!0),u.pause())}function s(t){U("onerror",t),h(),a.removeListener("error",s),0===I(a,"error")&&a.emit("error",t)}function l(){a.removeListener("finish",c),h()}function c(){U("onfinish"),a.removeListener("close",l),h()}function h(){U("unpipe"),u.unpipe(a)}var u=this,p=this._readableState;switch(p.pipesCount){case 0:p.pipes=a;break;case 1:p.pipes=[p.pipes,a];break;default:p.pipes.push(a);}p.pipesCount+=1,U("pipe count=%d opts=%j",p.pipesCount,t);var d=t&&!1===t.end||a===Z.stdout||a===Z.stderr?h:n;p.endEmitted?C(d):u.once("end",d),a.on("unpipe",e);var f=y(u);a.on("drain",f);var m=!1,b=!1;return u.on("data",o),i(a,"error",s),a.once("close",l),a.once("finish",c),a.emit("pipe",u),p.flowing||(U("pipe resume"),u.resume()),a},a.prototype.unpipe=function(l){var s=this._readableState,e={hasUnpiped:!1};if(0===s.pipesCount)return this;if(1===s.pipesCount)return l&&l!==s.pipes?this:(l||(l=s.pipes),s.pipes=null,s.pipesCount=0,s.flowing=!1,l&&l.emit("unpipe",this,e),this);if(!l){var n=s.pipes,i=s.pipesCount;s.pipes=null,s.pipesCount=0,s.flowing=!1;for(var r=0;r<i;r++)n[r].emit("unpipe",this,e);return this}var o=P(s.pipes,l);return-1===o?this:(s.pipes.splice(o,1),s.pipesCount-=1,1===s.pipesCount&&(s.pipes=s.pipes[0]),l.emit("unpipe",this,e),this)},a.prototype.on=function(a,t){var e=R.prototype.on.call(this,a,t);if("data"===a)!1!==this._readableState.flowing&&this.resume();else if("readable"===a){var o=this._readableState;o.endEmitted||o.readableListening||(o.readableListening=o.needReadable=!0,o.emittedReadable=!1,o.reading?o.length&&p(this):C(g,this))}return e},a.prototype.addListener=a.prototype.on,a.prototype.resume=function(){var e=this._readableState;return e.flowing||(U("resume"),e.flowing=!0,f(this,e)),this},a.prototype.pause=function(){return U("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(U("pause"),this._readableState.flowing=!1,this.emit("pause")),this},a.prototype.wrap=function(a){var l=this._readableState,t=!1,e=this;for(var n in a.on("end",function(){if(U("wrapped end"),l.decoder&&!l.ended){var a=l.decoder.end();a&&a.length&&e.push(a)}e.push(null)}),a.on("data",function(o){U("wrapped data"),l.decoder&&(o=l.decoder.write(o)),(!l.objectMode||null!==o&&void 0!==o)&&(l.objectMode||o&&o.length)&&(e.push(o)||(t=!0,a.pause()))}),a)void 0===this[n]&&"function"==typeof a[n]&&(this[n]=function(t){return function(){return a[t].apply(a,arguments)}}(n));for(var r=0;r<H.length;r++)a.on(H[r],e.emit.bind(e,H[r]));return e._read=function(o){U("wrapped _read",o),t&&(t=!1,a.resume())},e},a._fromList=v}).call(t,Y(1),Y(4))},function(a,t,e){a.exports=e(21).EventEmitter},function(a,t,e){"use strict";function l(a,t){a.emit("error",t)}var i=e(16);a.exports={destroy:function(r,s){var c=this,n=this._readableState&&this._readableState.destroyed,o=this._writableState&&this._writableState.destroyed;n||o?s?s(r):!r||this._writableState&&this._writableState.errorEmitted||i(l,this,r):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(r||null,function(a){!s&&a?(i(l,c,a),c._writableState&&(c._writableState.errorEmitted=!0)):s&&s(a)}))},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(N,t,B){"use strict";(function(t,e,n){function G(a){var t=this;this.next=null,this.entry=null,this.finish=function(){w(t,a)}}function H(e){return A.from(e)}function a(e){return A.isBuffer(e)||e instanceof I}function s(){}function o(o,n){M=M||B(6),o=o||{},this.objectMode=!!o.objectMode,n instanceof M&&(this.objectMode=this.objectMode||!!o.writableObjectMode);var e=o.highWaterMark,t=this.objectMode?16:16384;this.highWaterMark=e||0===e?e:t,this.highWaterMark=z(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var r=!1===o.decodeStrings;this.decodeStrings=!r,this.defaultEncoding=o.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){i(n,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new G(this)}function r(e){return(M=M||B(6),!(D.call(r,this)||this instanceof M))?new r(e):void(this._writableState=new o(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),L.call(this))}function l(a,t){var e=new Error("write after end");a.emit("error",e),E(t,e)}function c(a,t,e,l){var i=!0,r=!1;return null===e?r=new TypeError("May not write null values to stream"):"string"==typeof e||void 0===e||t.objectMode||(r=new TypeError("Invalid non-string/buffer chunk")),r&&(a.emit("error",r),E(l,r),i=!1),i}function p(a,t,o){return a.objectMode||!1===a.decodeStrings||"string"!=typeof t||(t=A.from(t,o)),t}function d(d,t,e,u,m,_){if(!e){var h=p(t,u,m);u!==h&&(e=!0,m="buffer",u=h)}var a=t.objectMode?1:u.length;t.length+=a;var s=t.length<t.highWaterMark;if(s||(t.needDrain=!0),t.writing||t.corked){var l=t.lastBufferedRequest;t.lastBufferedRequest={chunk:u,encoding:m,isBuf:e,callback:_,next:null},l?l.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else f(d,t,!1,a,u,m,_);return s}function f(l,t,e,n,i,r,o){t.writelen=n,t.writecb=o,t.writing=!0,t.sync=!0,e?l._writev(i,t.onwrite):l._write(i,r,t.onwrite),t.sync=!1}function u(a,t,e,o,n){--t.pendingcb,e?(E(n,o),E(v,a,t),a._writableState.errorEmitted=!0,a.emit("error",o)):(n(o),a._writableState.errorEmitted=!0,a.emit("error",o),v(a,t))}function m(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function i(a,t){var e=a._writableState,n=e.sync,i=e.writecb;if(m(e),t)u(a,e,n,t,i);else{var r=y(e);r||e.corked||e.bufferProcessing||!e.bufferedRequest||g(a,e),n?T(_,a,e,r,i):_(a,e,r,i)}}function _(a,t,e,o){e||h(a,t),t.pendingcb--,o(),v(a,t)}function h(a,t){0===t.length&&t.needDrain&&(t.needDrain=!1,a.emit("drain"))}function g(o,t){t.bufferProcessing=!0;var e=t.bufferedRequest;if(o._writev&&e&&e.next){var n=t.bufferedRequestCount,i=Array(n),r=t.corkedRequestsFree;r.entry=e;for(var a=0,s=!0;e;)i[a]=e,e.isBuf||(s=!1),e=e.next,a+=1;i.allBuffers=s,f(o,t,!0,t.length,i,"",r.finish),t.pendingcb++,t.lastBufferedRequest=null,r.next?(t.corkedRequestsFree=r.next,r.next=null):t.corkedRequestsFree=new G(t)}else{for(;e;){var l=e.chunk,c=e.encoding,d=e.callback;if(f(o,t,!1,t.objectMode?1:l.length,l,c,d),e=e.next,t.writing)break}null===e&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=e,t.bufferProcessing=!1}function y(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function b(a,t){a._final(function(e){t.pendingcb--,e&&a.emit("error",e),t.prefinished=!0,a.emit("prefinish"),v(a,t)})}function x(a,t){t.prefinished||t.finalCalled||("function"==typeof a._final?(t.pendingcb++,t.finalCalled=!0,E(b,a,t)):(t.prefinished=!0,a.emit("prefinish")))}function v(a,t){var e=y(t);return e&&(x(a,t),0===t.pendingcb&&(t.finished=!0,a.emit("finish"))),e}function S(a,t,e){t.ending=!0,v(a,t),e&&(t.finished?E(e):a.once("finish",e)),t.ended=!0,a.writable=!1}function w(a,t,e){var o=a.entry;for(a.entry=null;o;){var n=o.callback;t.pendingcb--,n(e),o=o.next}t.corkedRequestsFree?t.corkedRequestsFree.next=a:t.corkedRequestsFree=a}var E=B(16);N.exports=r;var T=!t.browser&&-1<["v0.10","v0.9."].indexOf(t.version.slice(0,5))?e:E,M;r.WritableState=o;var P=B(11);P.inherits=B(12);var C={deprecate:B(143)},L=B(63),A=B(27).Buffer,I=n.Uint8Array||function(){},R=B(64);P.inherits(r,L),o.prototype.getBuffer=function(){for(var a=this.bufferedRequest,t=[];a;)t.push(a),a=a.next;return t},function(){try{Object.defineProperty(o.prototype,"buffer",{get:C.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}();var D;"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(D=Function.prototype[Symbol.hasInstance],Object.defineProperty(r,Symbol.hasInstance,{value:function(e){return!!D.call(this,e)||e&&e._writableState instanceof o}})):D=function(e){return e instanceof this},r.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},r.prototype.write=function(p,t,u){var m=this._writableState,i=!1,r=a(p)&&!m.objectMode;return r&&!A.isBuffer(p)&&(p=H(p)),"function"==typeof t&&(u=t,t=null),r?t="buffer":t||(t=m.defaultEncoding),"function"!=typeof u&&(u=s),m.ended?l(this,u):(r||c(this,m,p,u))&&(m.pendingcb++,i=d(this,m,r,p,t,u)),i},r.prototype.cork=function(){this._writableState.corked++},r.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||g(this,e))},r.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},r.prototype._write=function(a,t,e){e(new Error("_write() is not implemented"))},r.prototype._writev=null,r.prototype.end=function(a,o,r){var n=this._writableState;"function"==typeof a?(r=a,a=null,o=null):"function"==typeof o&&(r=o,o=null),null!==a&&void 0!==a&&this.write(a,o),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||S(this,n,r)},Object.defineProperty(r.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),r.prototype.destroy=R.destroy,r.prototype._undestroy=R.undestroy,r.prototype._destroy=function(a,t){this.end(),t(a)}}).call(t,B(4),B(141).setImmediate,B(1))},function(d,t,e){function n(e){if(e&&!s(e))throw new Error("Unknown encoding: "+e)}function i(e){return e.toString(this.encoding)}function r(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function o(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}var a=e(5).Buffer,s=a.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1;}},l=t.StringDecoder=function(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),n(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=r;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=o;break;default:return void(this.write=i);}this.charBuffer=new a(6),this.charReceived=0,this.charLength=0};l.prototype.write=function(a){for(var t="",e;this.charLength;){if(e=a.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:a.length,a.copy(this.charBuffer,this.charReceived,0,e),this.charReceived+=e,this.charReceived<this.charLength)return"";if(a=a.slice(e,a.length),!(55296<=(i=(t=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(t.length-1))&&56319>=i)){if(this.charReceived=this.charLength=0,0===a.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(a),n=a.length,this.charLength&&(a.copy(this.charBuffer,0,a.length-this.charReceived,n),n-=this.charReceived);var n=(t+=a.toString(this.encoding,0,n)).length-1,i=t.charCodeAt(n);if(55296<=i&&56319>=i){var r=this.surrogateSize;return this.charLength+=r,this.charReceived+=r,this.charBuffer.copy(this.charBuffer,r,0,r),a.copy(this.charBuffer,0,0,r),t.substring(0,n)}return t},l.prototype.detectIncompleteChar=function(a){for(var t=3<=a.length?3:a.length,e;0<t;t--){if(e=a[a.length-t],1==t&&6==e>>5){this.charLength=2;break}if(2>=t&&14==e>>4){this.charLength=3;break}if(3>=t&&30==e>>3){this.charLength=4;break}}this.charReceived=t},l.prototype.end=function(a){var t="";if(a&&a.length&&(t=this.write(a)),this.charReceived){var e=this.charReceived,o=this.charBuffer,n=this.encoding;t+=o.slice(0,e).toString(n)}return t}},function(c,t,e){"use strict";function n(a){this.afterTransform=function(t,e){return i(a,t,e)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function i(a,t,e){var n=a._transformState;n.transforming=!1;var i=n.writecb;if(!i)return a.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!==e&&void 0!==e&&a.push(e),i(t);var l=a._readableState;l.reading=!1,(l.needReadable||l.length<l.highWaterMark)&&a._read(l.highWaterMark)}function r(i){if(!(this instanceof r))return new r(i);a.call(this,i),this._transformState=new n(this);var l=this;this._readableState.needReadable=!0,this._readableState.sync=!1,i&&("function"==typeof i.transform&&(this._transform=i.transform),"function"==typeof i.flush&&(this._flush=i.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(e,t){o(l,e,t)}):o(l)})}function o(a,t,e){if(t)return a.emit("error",t);null!==e&&void 0!==e&&a.push(e);var o=a._writableState,n=a._transformState;if(o.length)throw new Error("Calling transform done when ws.length != 0");if(n.transforming)throw new Error("Calling transform done when still transforming");return a.push(null)}c.exports=r;var a=e(6),s=e(11);s.inherits=e(12),s.inherits(r,a),r.prototype.push=function(o,t){return this._transformState.needTransform=!1,a.prototype.push.call(this,o,t)},r.prototype._transform=function(){throw new Error("_transform() is not implemented")},r.prototype._write=function(a,t,e){var o=this._transformState;if(o.writecb=e,o.writechunk=a,o.writeencoding=t,!o.transforming){var n=this._readableState;(o.needTransform||n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}},r.prototype._read=function(){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},r.prototype._destroy=function(o,r){var e=this;a.prototype._destroy.call(this,o,function(a){r(a),e.emit("close")})}},function(e){"use strict";e.exports={0:"",1:"stream end",2:"need dictionary","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e){"use strict";e.exports=function(l,t,e,n){for(var i=0|65535&l,r=0|65535&l>>>16,o=0;0!==e;){e-=o=2e3<e?2e3:e;do r=0|r+(i=0|i+t[n++]);while(--o);i%=65521,r%=65521}return 0|(i|r<<16)}},function(e){"use strict";var a=function(){for(var a=[],e=0,o;256>e;e++){o=e;for(var t=0;8>t;t++)o=1&o?3988292384^o>>>1:o>>>1;a[e]=o}return a}();e.exports=function(o,t,e,n){o^=-1;for(var r=n;r<n+e;r++)o=o>>>8^a[255&(o^t[r])];return-1^o}},function(a,D,e){(function(k,F){function N(e,t){var n={seen:[],stylize:o};return 3<=arguments.length&&(n.depth=arguments[2]),4<=arguments.length&&(n.colors=arguments[3]),h(t)?n.showHidden=t:t&&D._extend(n,t),g(n.showHidden)&&(n.showHidden=!1),g(n.depth)&&(n.depth=2),g(n.colors)&&(n.colors=!1),g(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=r),B(n,e,n.depth)}function r(a,t){var e=N.styles[t];return e?"\x1B["+N.colors[e][0]+"m"+a+"\x1B["+N.colors[e][1]+"m":a}function o(e){return e}function U(a){var o={};return a.forEach(function(e){o[e]=!0}),o}function B(h,t,n){if(h.customInspect&&t&&S(t.inspect)&&t.inspect!==D.inspect&&(!t.constructor||t.constructor.prototype!==t)){var e=t.inspect(n,h);return _(e)||(e=B(h,e,n)),e}var r=l(h,t);if(r)return r;var o=Object.keys(t),a=U(o);if(h.showHidden&&(o=Object.getOwnPropertyNames(t)),x(t)&&(0<=o.indexOf("message")||0<=o.indexOf("description")))return s(t);if(0===o.length){if(S(t)){var i=t.name?": "+t.name:"";return h.stylize("[Function"+i+"]","special")}if(f(t))return h.stylize(RegExp.prototype.toString.call(t),"regexp");if(b(t))return h.stylize(Date.prototype.toString.call(t),"date");if(x(t))return s(t)}var m="",g=!1,y=["{","}"];if(d(t)&&(g=!0,y=["[","]"]),S(t)&&(m=" [Function"+(t.name?": "+t.name:"")+"]"),f(t)&&(m=" "+RegExp.prototype.toString.call(t)),b(t)&&(m=" "+Date.prototype.toUTCString.call(t)),x(t)&&(m=" "+s(t)),0===o.length&&(!g||0==t.length))return y[0]+m+y[1];if(0>n)return f(t)?h.stylize(RegExp.prototype.toString.call(t),"regexp"):h.stylize("[Object]","special");h.seen.push(t);var w;return w=g?c(h,t,n,a,o):o.map(function(o){return u(h,t,n,a,o,g)}),h.seen.pop(),p(w,m,y)}function l(a,t){if(g(t))return a.stylize("undefined","undefined");if(_(t)){var e="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,"\"")+"'";return a.stylize(e,"string")}return i(t)?a.stylize(""+t,"number"):h(t)?a.stylize(""+t,"boolean"):m(t)?a.stylize("null","null"):void 0}function s(e){return"["+Error.prototype.toString.call(e)+"]"}function c(l,t,e,n,i){for(var c=[],o=0,a=t.length;o<a;++o)w(t,o+"")?c.push(u(l,t,e,n,o+"",!0)):c.push("");return i.forEach(function(a){a.match(/^\d+$/)||c.push(u(l,t,e,n,a,!0))}),c}function u(l,t,e,n,i,r){var o,a,s;if((s=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?a=s.set?l.stylize("[Getter/Setter]","special"):l.stylize("[Getter]","special"):s.set&&(a=l.stylize("[Setter]","special")),w(n,i)||(o="["+i+"]"),a||(0>l.seen.indexOf(s.value)?-1<(a=m(e)?B(l,s.value,null):B(l,s.value,e-1)).indexOf("\n")&&(a=r?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n")):a=l.stylize("[Circular]","special")),g(o)){if(r&&i.match(/^\d+$/))return a;(o=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=l.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,"\"").replace(/(^"|"$)/g,"'"),o=l.stylize(o,"string"))}return o+": "+a}function p(a,t,e){var o=0;return 60<a.reduce(function(a,t){return o++,0<=t.indexOf("\n")&&o++,a+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)?e[0]+(""===t?"":t+"\n ")+" "+a.join(",\n  ")+" "+e[1]:e[0]+t+" "+a.join(", ")+" "+e[1]}function d(e){return Array.isArray(e)}function h(e){return"boolean"==typeof e}function m(e){return null===e}function i(e){return"number"==typeof e}function _(e){return"string"==typeof e}function g(e){return void 0===e}function f(e){return y(e)&&"[object RegExp]"===n(e)}function y(e){return"object"==("undefined"===typeof e?"undefined":babelHelpers.typeof(e))&&null!==e}function b(e){return y(e)&&"[object Date]"===n(e)}function x(e){return y(e)&&("[object Error]"===n(e)||e instanceof Error)}function S(e){return"function"==typeof e}function n(e){return Object.prototype.toString.call(e)}function v(e){return 10>e?"0"+e.toString(10):e.toString(10)}function t(){var a=new Date,t=[v(a.getHours()),v(a.getMinutes()),v(a.getSeconds())].join(":");return[a.getDate(),P[a.getMonth()],t].join(" ")}function w(a,t){return Object.prototype.hasOwnProperty.call(a,t)}var E=/%[sdj%]/g;D.format=function(r){if(!_(r)){for(var t=[],e=0;e<arguments.length;e++)t.push(N(arguments[e]));return t.join(" ")}for(var e=1,n=arguments,i=n.length,o=(r+"").replace(E,function(a){if("%%"===a)return"%";if(e>=i)return a;switch(a){case"%s":return n[e++]+"";case"%d":return+n[e++];case"%j":try{return JSON.stringify(n[e++])}catch(e){return"[Circular]"}default:return a;}}),a=n[e];e<i;a=n[++e])o+=m(a)||!y(a)?" "+a:" "+N(a);return o},D.deprecate=function(e,t){if(g(k.process))return function(){return D.deprecate(e,t).apply(this,arguments)};if(!0===F.noDeprecation)return e;var a=!1;return function(){if(!a){if(F.throwDeprecation)throw new Error(t);F.traceDeprecation?console.trace(t):console.error(t),a=!0}return e.apply(this,arguments)}};var T={},M;D.debuglog=function(e){if(g(M)&&(M={NODE_ENV:"production"}.NODE_DEBUG||""),e=e.toUpperCase(),!T[e])if(new RegExp("\\b"+e+"\\b","i").test(M)){var t=F.pid;T[e]=function(){var a=D.format.apply(D,arguments);console.error("%s %d: %s",e,t,a)}}else T[e]=function(){};return T[e]},D.inspect=N,N.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},N.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},D.isArray=d,D.isBoolean=h,D.isNull=m,D.isNullOrUndefined=function(e){return null==e},D.isNumber=i,D.isString=_,D.isSymbol=function(e){return"symbol"==("undefined"===typeof e?"undefined":babelHelpers.typeof(e))},D.isUndefined=g,D.isRegExp=f,D.isObject=y,D.isDate=b,D.isError=x,D.isFunction=S,D.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==("undefined"===typeof e?"undefined":babelHelpers.typeof(e))||void 0===e},D.isBuffer=e(153);var P=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];D.log=function(){console.log("%s - %s",t(),D.format.apply(D,arguments))},D.inherits=e(154),D._extend=function(a,t){if(!t||!y(t))return a;for(var o=Object.keys(t),r=o.length;r--;)a[o[r]]=t[o[r]];return a}}).call(D,e(1),e(4))},function(P,t,C){"use strict";(function(n){function L(a,t){if(a===t)return 0;for(var e=a.length,n=t.length,l=0,r=U(e,n);l<r;++l)if(a[l]!==t[l]){e=a[l],n=t[l];break}return e<n?-1:n<e?1:0}function i(e){return n.Buffer&&"function"==typeof n.Buffer.isBuffer?n.Buffer.isBuffer(e):null!=e&&e._isBuffer}function r(e){return Object.prototype.toString.call(e)}function o(e){return!i(e)&&"function"==typeof n.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer)))}function A(a){if(g.isFunction(a)){if(b)return a.name;var t=a.toString().match(v);return t&&t[1]}}function e(a,o){return"string"==typeof a?a.length<o?a:a.slice(0,o):a}function a(a){if(b||!g.isFunction(a))return g.inspect(a);var t=A(a);return"[Function"+(t?": "+t:"")+"]"}function l(o){return e(a(o.actual),128)+" "+o.operator+" "+e(a(o.expected),128)}function c(a,o,l,s,c){throw new x.AssertionError({message:l,actual:a,expected:o,operator:s,stackStartFunction:c})}function t(a,t){a||c(a,!0,t,"==",x.ok)}function p(a,c,d,n){if(a===c)return!0;if(i(a)&&i(c))return 0===L(a,c);if(g.isDate(a)&&g.isDate(c))return a.getTime()===c.getTime();if(g.isRegExp(a)&&g.isRegExp(c))return a.source===c.source&&a.global===c.global&&a.multiline===c.multiline&&a.lastIndex===c.lastIndex&&a.ignoreCase===c.ignoreCase;if(null!==a&&"object"==("undefined"===typeof a?"undefined":babelHelpers.typeof(a))||null!==c&&"object"==("undefined"===typeof c?"undefined":babelHelpers.typeof(c))){if(o(a)&&o(c)&&r(a)===r(c)&&!(a instanceof Float32Array||a instanceof Float64Array))return 0===L(new Uint8Array(a.buffer),new Uint8Array(c.buffer));if(i(a)!==i(c))return!1;var s=(n=n||{actual:[],expected:[]}).actual.indexOf(a);return-1!==s&&s===n.expected.indexOf(c)||(n.actual.push(a),n.expected.push(c),u(a,c,d,n))}return d?a===c:a==c}function d(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function u(u,t,e,n){if(null===u||void 0===u||null===t||void 0===t)return!1;if(g.isPrimitive(u)||g.isPrimitive(t))return u===t;if(e&&Object.getPrototypeOf(u)!==Object.getPrototypeOf(t))return!1;var i=d(u),m=d(t);if(i&&!m||!i&&m)return!1;if(i)return u=y.call(u),t=y.call(t),p(u,t,e);var _=S(u),l=S(t),c,a;if(_.length!==l.length)return!1;for(_.sort(),l.sort(),a=_.length-1;0<=a;a--)if(_[a]!==l[a])return!1;for(a=_.length-1;0<=a;a--)if(c=_[a],!p(u[c],t[c],e,n))return!1;return!0}function s(a,t,e){p(a,t,!0)&&c(a,t,e,"notDeepStrictEqual",s)}function m(a,o){if(!a||!o)return!1;if("[object RegExp]"==Object.prototype.toString.call(o))return o.test(a);try{if(a instanceof o)return!0}catch(e){}return!Error.isPrototypeOf(o)&&!0===o.call({},a)}function _(a){var o;try{a()}catch(e){o=e}return o}function h(l,d,p,u){var h;if("function"!=typeof d)throw new TypeError("\"block\" argument must be a function");"string"==typeof p&&(u=p,p=null),h=_(d),u=(p&&p.name?" ("+p.name+").":".")+(u?" "+u:"."),l&&!h&&c(h,p,"Missing expected exception"+u);var f="string"==typeof u,o=!l&&g.isError(h),a=!l&&h&&!p;if((o&&f&&m(h,p)||a)&&c(h,p,"Got unwanted exception"+u),l&&h&&p&&!m(h,p)||!l&&h)throw h}var g=C(71),f=Object.prototype.hasOwnProperty,y=Array.prototype.slice,b="foo"===function(){}.name,x=P.exports=t,v=/\s*function\s+([^\(\s]*)\s*/;x.AssertionError=function(s){this.name="AssertionError",this.actual=s.actual,this.expected=s.expected,this.operator=s.operator,s.message?(this.message=s.message,this.generatedMessage=!1):(this.message=l(this),this.generatedMessage=!0);var t=s.stackStartFunction||c;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var e=new Error;if(e.stack){var n=e.stack,i=A(t),r=n.indexOf("\n"+i);if(0<=r){var o=n.indexOf("\n",r+1);n=n.substring(o+1)}this.stack=n}}},g.inherits(x.AssertionError,Error),x.fail=c,x.ok=t,x.equal=function(a,t,e){a!=t&&c(a,t,e,"==",x.equal)},x.notEqual=function(a,t,e){a==t&&c(a,t,e,"!=",x.notEqual)},x.deepEqual=function(a,t,e){p(a,t,!1)||c(a,t,e,"deepEqual",x.deepEqual)},x.deepStrictEqual=function(a,t,e){p(a,t,!0)||c(a,t,e,"deepStrictEqual",x.deepStrictEqual)},x.notDeepEqual=function(a,t,e){p(a,t,!1)&&c(a,t,e,"notDeepEqual",x.notDeepEqual)},x.notDeepStrictEqual=s,x.strictEqual=function(a,t,e){a!==t&&c(a,t,e,"===",x.strictEqual)},x.notStrictEqual=function(a,t,e){a===t&&c(a,t,e,"!==",x.notStrictEqual)},x.throws=function(a,t,e){h(!0,a,t,e)},x.doesNotThrow=function(a,t,e){h(!1,a,t,e)},x.ifError=function(e){if(e)throw e};var S=Object.keys||function(a){var t=[];for(var e in a)f.call(a,e)&&t.push(e);return t}}).call(t,C(1))},function(e){"use strict";var a=a||{};a.lossless=a.lossless||{},a.lossless.ComponentSpec=a.lossless.ComponentSpec||function(){this.hSamp=0,this.quantTableSel=0,this.vSamp=0},"undefined"!==typeof e&&e.exports&&(e.exports=a.lossless.ComponentSpec)},function(a,o,e){"use strict";var r=r||{};r.lossless=r.lossless||{},r.lossless.DataStream=r.lossless.DataStream||e(7),r.lossless.Utils=r.lossless.Utils||e(18),r.lossless.HuffmanTable=r.lossless.HuffmanTable||function(){this.l=r.lossless.Utils.createArray(4,2,16),this.th=[],this.v=r.lossless.Utils.createArray(4,2,16,200),this.tc=r.lossless.Utils.createArray(4,2),this.tc[0][0]=0,this.tc[1][0]=0,this.tc[2][0]=0,this.tc[3][0]=0,this.tc[0][1]=0,this.tc[1][1]=0,this.tc[2][1]=0,this.tc[3][1]=0,this.th[0]=0,this.th[1]=0,this.th[2]=0,this.th[3]=0},r.lossless.HuffmanTable.MSB=2147483648,r.lossless.HuffmanTable.prototype.read=function(c,t){var e=0,l,n,i,r,o,a;for(l=c.get16(),e+=2;e<l;){if(n=c.get8(),e+=1,3<(i=15&n))throw new Error("ERROR: Huffman table ID > 3");if(2<(r=n>>4))throw new Error("ERROR: Huffman table [Table class > 2 ]");for(this.th[i]=1,this.tc[i][r]=1,o=0;16>o;o+=1)this.l[i][r][o]=c.get8(),e+=1;for(o=0;16>o;o+=1)for(a=0;a<this.l[i][r][o];a+=1){if(e>l)throw new Error("ERROR: Huffman table format error [count>Lh]");this.v[i][r][o][a]=c.get8(),e+=1}}if(e!==l)throw new Error("ERROR: Huffman table format error [count!=Lf]");for(o=0;4>o;o+=1)for(a=0;2>a;a+=1)0!==this.tc[o][a]&&this.buildHuffTable(t[o][a],this.l[o][a],this.v[o][a]);return 1},r.lossless.HuffmanTable.prototype.buildHuffTable=function(i,t,e){var n,c,o,a,s;for(256,c=0,o=0;8>o;o+=1)for(a=0;a<t[o];a+=1)for(s=0;s<256>>o+1;s+=1)i[c]=e[o][a]|o+1<<8,c+=1;for(o=1;256>c;o+=1,c+=1)i[c]=o|r.lossless.HuffmanTable.MSB;for(n=1,c=0,o=8;16>o;o+=1)for(a=0;a<t[o];a+=1){for(s=0;s<256>>o-7;s+=1)i[256*n+c]=e[o][a]|o+1<<8,c+=1;if(256<=c){if(256<c)throw new Error("ERROR: Huffman table error(1)!");c=0,n+=1}}},"undefined"!==typeof a&&a.exports&&(a.exports=r.lossless.HuffmanTable)},function(a,o,e){"use strict";var r=r||{};r.lossless=r.lossless||{},r.lossless.DataStream=r.lossless.DataStream||e(7),r.lossless.Utils=r.lossless.Utils||e(18),r.lossless.QuantizationTable=r.lossless.QuantizationTable||function(){this.precision=[],this.tq=[],this.quantTables=r.lossless.Utils.createArray(4,64),this.tq[0]=0,this.tq[1]=0,this.tq[2]=0,this.tq[3]=0},r.lossless.QuantizationTable.enhanceQuantizationTable=function(a,t){var e;for(e=0;8>e;e+=1)a[t[0+e]]*=90,a[t[32+e]]*=90,a[t[16+e]]*=118,a[t[48+e]]*=49,a[t[40+e]]*=71,a[t[8+e]]*=126,a[t[56+e]]*=25,a[t[24+e]]*=106;for(e=0;8>e;e+=1)a[t[0+8*e]]*=90,a[t[4+8*e]]*=90,a[t[2+8*e]]*=118,a[t[6+8*e]]*=49,a[t[5+8*e]]*=71,a[t[1+8*e]]*=126,a[t[7+8*e]]*=25,a[t[3+8*e]]*=106;for(e=0;64>e;e+=1)a[e]>>=6},r.lossless.QuantizationTable.prototype.read=function(i,t){var e=0,l,n,s,o;for(l=i.get16(),e+=2;e<l;){if(n=i.get8(),e+=1,3<(s=15&n))throw new Error("ERROR: Quantization table ID > 3");if(this.precision[s]=n>>4,0===this.precision[s])this.precision[s]=8;else{if(1!==this.precision[s])throw new Error("ERROR: Quantization table precision error");this.precision[s]=16}if(this.tq[s]=1,8===this.precision[s]){for(o=0;64>o;o+=1){if(e>l)throw new Error("ERROR: Quantization table format error");this.quantTables[s][o]=i.get8(),e+=1}r.lossless.QuantizationTable.enhanceQuantizationTable(this.quantTables[s],t)}else{for(o=0;64>o;o+=1){if(e>l)throw new Error("ERROR: Quantization table format error");this.quantTables[s][o]=i.get16(),e+=2}r.lossless.QuantizationTable.enhanceQuantizationTable(this.quantTables[s],t)}}if(e!==l)throw new Error("ERROR: Quantization table error [count!=Lq]");return 1},"undefined"!==typeof a&&a.exports&&(a.exports=r.lossless.QuantizationTable)},function(a,o,e){"use strict";var l=l||{};l.lossless=l.lossless||{},l.lossless.DataStream=l.lossless.DataStream||e(7),l.lossless.ScanComponent=l.lossless.ScanComponent||e(77),l.lossless.ScanHeader=l.lossless.ScanHeader||function(){this.ah=0,this.al=0,this.numComp=0,this.selection=0,this.spectralEnd=0,this.components=[]},l.lossless.ScanHeader.prototype.read=function(a){var t=0,o,e,n;for(o=a.get16(),t+=2,this.numComp=a.get8(),t+=1,e=0;e<this.numComp;e+=1){if(this.components[e]=new l.lossless.ScanComponent,t>o)throw new Error("ERROR: scan header format error");this.components[e].scanCompSel=a.get8(),t+=1,n=a.get8(),t+=1,this.components[e].dcTabSel=n>>4,this.components[e].acTabSel=15&n}if(this.selection=a.get8(),t+=1,this.spectralEnd=a.get8(),t+=1,n=a.get8(),this.ah=n>>4,this.al=15&n,(t+=1)!==o)throw new Error("ERROR: scan header format error [count!=Ns]");return 1},"undefined"!==typeof a&&a.exports&&(a.exports=l.lossless.ScanHeader)},function(e){"use strict";var a=a||{};a.lossless=a.lossless||{},a.lossless.ScanComponent=a.lossless.ScanComponent||function(){this.acTabSel=0,this.dcTabSel=0,this.scanCompSel=0},"undefined"!==typeof e&&e.exports&&(e.exports=a.lossless.ScanComponent)},function(a,o,e){"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.ComponentSpec=n.lossless.ComponentSpec||e(73),n.lossless.DataStream=n.lossless.DataStream||e(7),n.lossless.FrameHeader=n.lossless.FrameHeader||function(){this.components=[],this.dimX=0,this.dimY=0,this.numComp=0,this.precision=0},n.lossless.FrameHeader.prototype.read=function(i){var t=0,a,e,l,r;for(a=i.get16(),t+=2,this.precision=i.get8(),t+=1,this.dimY=i.get16(),t+=2,this.dimX=i.get16(),t+=2,this.numComp=i.get8(),t+=1,e=1;e<=this.numComp;e+=1){if(t>a)throw new Error("ERROR: frame format error");if(l=i.get8(),(t+=1)>=a)throw new Error("ERROR: frame format error [c>=Lf]");r=i.get8(),t+=1,this.components[l]||(this.components[l]=new n.lossless.ComponentSpec),this.components[l].hSamp=r>>4,this.components[l].vSamp=15&r,this.components[l].quantTableSel=i.get8(),t+=1}if(t!==a)throw new Error("ERROR: frame format error [Lf!=count]");return 1},"undefined"!==typeof a&&a.exports&&(a.exports=n.lossless.FrameHeader)},function(c,t,e){"use strict";function d(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function i(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))||"function"==typeof o)?o:a}function r(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var o=e(15),p=e(160),a=function(l){function t(e,r){d(this,t);var o=i(this,l.call(this));if(o._id=r,o._arrayBuffer=e.buffer,o._url=e.url,o._dataSet=null,o._niftiHeader=null,o._niftiImage=null,o._ordered=!0,o._orderedData=null,o._qfac=1,!p.isNIFTI(o._arrayBuffer))throw new Error("parsers.nifti could not parse the file");return o._dataSet=p.readHeader(o._arrayBuffer),o._niftiImage=p.readImage(o._dataSet,o._arrayBuffer),o}return r(t,l),t.prototype.seriesInstanceUID=function(){return this._url},t.prototype.numberOfFrames=function(){return this._dataSet.dims[3]},t.prototype.numberOfChannels=function(){var e=1;return 5<=this._dataSet.dims[0]?(e=this._dataSet.dims[5],this._ordered=!1):128===this._dataSet.datatypeCode?e=3:2304===this._dataSet.datatypeCode&&(e=4),e},t.prototype.sopInstanceUID=function(){return 0<arguments.length&&void 0!==arguments[0]?arguments[0]:0},t.prototype.rows=function(){return 0<arguments.length&&void 0!==arguments[0]&&arguments[0],this._dataSet.dims[2]},t.prototype.columns=function(){return 0<arguments.length&&void 0!==arguments[0]&&arguments[0],this._dataSet.dims[1]},t.prototype.pixelType=function(){0<arguments.length&&void 0!==arguments[0]&&arguments[0];var e=0;return 16!==this._dataSet.datatypeCode&&64!==this._dataSet.datatypeCode&&1536!==this._dataSet.datatypeCode||(e=1),e},t.prototype.bitsAllocated=function(){return 0<arguments.length&&void 0!==arguments[0]&&arguments[0],this._dataSet.numBitsPerVoxel},t.prototype.pixelSpacing=function(){return 0<arguments.length&&void 0!==arguments[0]&&arguments[0],[this._dataSet.pixDims[1],this._dataSet.pixDims[2],this._dataSet.pixDims[3]]},t.prototype.sliceThickness=function(){return null},t.prototype.imageOrientation=function(){if(0<arguments.length&&void 0!==arguments[0]&&arguments[0],0<this._dataSet.qform_code){var a=0,t=this._dataSet.quatern_b,e=this._dataSet.quatern_c,o=this._dataSet.quatern_d;return 1e-7>(a=1-(t*t+e*e+o*o))?(t*=a=1/N(t*t+e*e+o*o),e*=a,o*=a,a=0):a=N(a),0>this._dataSet.pixDims[0]&&(this._rightHanded=!1),[-(a*a+t*t-e*e-o*o),-2*(t*e+a*o),2*(t*o-a*e),-2*(t*e-a*o),-(a*a+e*e-t*t-o*o),2*(e*o+a*t)]}return 0<this._dataSet.sform_code||this._dataSet.qform_code,[1,0,0,0,1,0]},t.prototype.imagePosition=function(){return 0<arguments.length&&void 0!==arguments[0]&&arguments[0],[-this._dataSet.qoffset_x,-this._dataSet.qoffset_y,this._dataSet.qoffset_z]},t.prototype.dimensionIndexValues=function(){return 0<arguments.length&&void 0!==arguments[0]&&arguments[0],null},t.prototype.instanceNumber=function(){return 0<arguments.length&&void 0!==arguments[0]?arguments[0]:0},t.prototype.windowCenter=function(){return 0<arguments.length&&void 0!==arguments[0]&&arguments[0],null},t.prototype.windowWidth=function(){return 0<arguments.length&&void 0!==arguments[0]&&arguments[0],null},t.prototype.rescaleSlope=function(){return 0<arguments.length&&void 0!==arguments[0]&&arguments[0],this._dataSet.scl_slope},t.prototype.rescaleIntercept=function(){return 0<arguments.length&&void 0!==arguments[0]&&arguments[0],this._dataSet.scl_intercept},t.prototype.extractPixelData=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return this._decompressUncompressed(e)},t.prototype._decompressUncompressed=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=this.numberOfChannels(),e=this.rows(a)*this.columns(a)*t,o=a*e,n=this._niftiImage;return this._ordered||null!==this._orderedData||this._reorderData(),null===this._orderedData?2===this._dataSet.datatypeCode?new Uint8Array(n,o,e):256===this._dataSet.datatypeCode?new Int8Array(n,o,e):512===this._dataSet.datatypeCode?(o*=2,new Uint16Array(n,o,e)):4===this._dataSet.datatypeCode?(o*=2,new Int16Array(n,o,e)):8===this._dataSet.datatypeCode?(o*=4,new Int32Array(n,o,e)):16===this._dataSet.datatypeCode?(o*=4,new Float32Array(n,o,e)):void window.console.warning("Unknown data type: datatypeCode : "+this._dataSet.datatypeCode):this._orderedData.slice(o,o+e)},t.prototype._reorderData=function(){var d=this.numberOfChannels(),t=this.rows()*this.columns()*d,e=this._niftiImage,n=t*this.numberOfFrames(),i=null;this._orderedData=null,2===this._dataSet.datatypeCode?(i=new Uint8Array(e,0,n),this._orderedData=new Uint8Array(i.length)):256===this._dataSet.datatypeCode?(i=new Int8Array(e,0,n),this._orderedData=new Int8Array(i.length)):512===this._dataSet.datatypeCode?(i=new Uint16Array(e,0,n),this._orderedData=new Uint16Array(i.length)):4===this._dataSet.datatypeCode?(i=new Int16Array(e,0,n),this._orderedData=new Int16Array(i.length)):16===this._dataSet.datatypeCode&&(i=new Float32Array(e,0,n),this._orderedData=new Float32Array(i.length));for(var r=i.length/3,o=0,a=0,s=r,l=2*r,c=0;c<r;c++)this._orderedData[o++]=i[a++],this._orderedData[o++]=i[s++],this._orderedData[o++]=i[l++];this._ordered=!0},t}(o.a);t.a=a},function(a,o,e){"use strict";var l=l||{};l.Utils=l.Utils||e(28),l.NIFTI1=l.NIFTI1||function(){this.littleEndian=!1,this.dim_info=0,this.dims=[],this.intent_p1=0,this.intent_p2=0,this.intent_p3=0,this.intent_code=0,this.datatypeCode=0,this.numBitsPerVoxel=0,this.slice_start=0,this.slice_end=0,this.slice_code=0,this.pixDims=[],this.vox_offset=0,this.scl_slope=1,this.scl_inter=0,this.xyzt_units=0,this.cal_max=0,this.cal_min=0,this.slice_duration=0,this.toffset=0,this.description="",this.aux_file="",this.intent_name="",this.qform_code=0,this.sform_code=0,this.quatern_b=0,this.quatern_c=0,this.quatern_d=0,this.qoffset_x=0,this.qoffset_y=0,this.qoffset_z=0,this.affine=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.magic=0,this.isHDR=!1,this.extensionFlag=[0,0,0,0],this.extensionSize=0,this.extensionCode=0},l.NIFTI1.TYPE_NONE=0,l.NIFTI1.TYPE_BINARY=1,l.NIFTI1.TYPE_UINT8=2,l.NIFTI1.TYPE_INT16=4,l.NIFTI1.TYPE_INT32=8,l.NIFTI1.TYPE_FLOAT32=16,l.NIFTI1.TYPE_COMPLEX64=32,l.NIFTI1.TYPE_FLOAT64=64,l.NIFTI1.TYPE_RGB24=128,l.NIFTI1.TYPE_INT8=256,l.NIFTI1.TYPE_UINT16=512,l.NIFTI1.TYPE_UINT32=768,l.NIFTI1.TYPE_INT64=1024,l.NIFTI1.TYPE_UINT64=1280,l.NIFTI1.TYPE_FLOAT128=1536,l.NIFTI1.TYPE_COMPLEX128=1792,l.NIFTI1.TYPE_COMPLEX256=2048,l.NIFTI1.XFORM_UNKNOWN=0,l.NIFTI1.XFORM_SCANNER_ANAT=1,l.NIFTI1.XFORM_ALIGNED_ANAT=2,l.NIFTI1.XFORM_TALAIRACH=3,l.NIFTI1.XFORM_MNI_152=4,l.NIFTI1.SPATIAL_UNITS_MASK=7,l.NIFTI1.TEMPORAL_UNITS_MASK=56,l.NIFTI1.UNITS_UNKNOWN=0,l.NIFTI1.UNITS_METER=1,l.NIFTI1.UNITS_MM=2,l.NIFTI1.UNITS_MICRON=3,l.NIFTI1.UNITS_SEC=8,l.NIFTI1.UNITS_MSEC=16,l.NIFTI1.UNITS_USEC=24,l.NIFTI1.UNITS_HZ=32,l.NIFTI1.UNITS_PPM=40,l.NIFTI1.UNITS_RADS=48,l.NIFTI1.MAGIC_COOKIE=348,l.NIFTI1.MAGIC_NUMBER_LOCATION=344,l.NIFTI1.MAGIC_NUMBER=[110,43,49],l.NIFTI1.MAGIC_NUMBER2=[110,105,49],l.NIFTI1.EXTENSION_HEADER_SIZE=8,l.NIFTI1.prototype.readHeader=function(i){var t=new DataView(i),a=l.Utils.getIntAt(t,0,this.littleEndian),s,e,n,r;if(a!==l.NIFTI1.MAGIC_COOKIE&&(this.littleEndian=!0,a=l.Utils.getIntAt(t,0,this.littleEndian)),a!==l.NIFTI1.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.dim_info=l.Utils.getByteAt(t,39),s=0;8>s;s+=1)r=40+2*s,this.dims[s]=l.Utils.getShortAt(t,r,this.littleEndian);for(this.intent_p1=l.Utils.getFloatAt(t,56,this.littleEndian),this.intent_p2=l.Utils.getFloatAt(t,60,this.littleEndian),this.intent_p3=l.Utils.getFloatAt(t,64,this.littleEndian),this.intent_code=l.Utils.getShortAt(t,68,this.littleEndian),this.datatypeCode=l.Utils.getShortAt(t,70,this.littleEndian),this.numBitsPerVoxel=l.Utils.getShortAt(t,72,this.littleEndian),this.slice_start=l.Utils.getShortAt(t,74,this.littleEndian),s=0;8>s;s+=1)r=76+4*s,this.pixDims[s]=l.Utils.getFloatAt(t,r,this.littleEndian);for(this.vox_offset=l.Utils.getFloatAt(t,108,this.littleEndian),this.scl_slope=l.Utils.getFloatAt(t,112,this.littleEndian),this.scl_inter=l.Utils.getFloatAt(t,116,this.littleEndian),this.slice_end=l.Utils.getShortAt(t,120,this.littleEndian),this.slice_code=l.Utils.getByteAt(t,122),this.xyzt_units=l.Utils.getByteAt(t,123),this.cal_max=l.Utils.getFloatAt(t,124,this.littleEndian),this.cal_min=l.Utils.getFloatAt(t,128,this.littleEndian),this.slice_duration=l.Utils.getFloatAt(t,132,this.littleEndian),this.toffset=l.Utils.getFloatAt(t,136,this.littleEndian),this.description=l.Utils.getStringAt(t,148,228),this.aux_file=l.Utils.getStringAt(t,228,252),this.qform_code=l.Utils.getShortAt(t,252,this.littleEndian),this.sform_code=l.Utils.getShortAt(t,254,this.littleEndian),this.quatern_b=l.Utils.getFloatAt(t,256,this.littleEndian),this.quatern_c=l.Utils.getFloatAt(t,260,this.littleEndian),this.quatern_d=l.Utils.getFloatAt(t,264,this.littleEndian),this.qoffset_x=l.Utils.getFloatAt(t,268,this.littleEndian),this.qoffset_y=l.Utils.getFloatAt(t,272,this.littleEndian),this.qoffset_z=l.Utils.getFloatAt(t,276,this.littleEndian),e=0;3>e;e+=1)for(n=0;4>n;n+=1)r=280+4*(4*e+n),this.affine[e][n]=l.Utils.getFloatAt(t,r,this.littleEndian);this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.intent_name=l.Utils.getStringAt(t,328,344),this.magic=l.Utils.getStringAt(t,344,348),this.isHDR=this.magic===l.NIFTI1.MAGIC_NUMBER2,t.byteLength>l.NIFTI1.MAGIC_COOKIE&&(this.extensionFlag[0]=l.Utils.getByteAt(t,348),this.extensionFlag[1]=l.Utils.getByteAt(t,349),this.extensionFlag[2]=l.Utils.getByteAt(t,350),this.extensionFlag[3]=l.Utils.getByteAt(t,351),this.extensionFlag[0]&&(this.extensionSize=this.getExtensionSize(t),this.extensionCode=this.getExtensionCode(t)))},l.NIFTI1.prototype.toFormattedString=function(){var a=l.Utils.formatNumber,t="";return t+="Dim Info = "+this.dim_info+"\n",t+="Image Dimensions (1-8): "+this.dims[0]+", "+this.dims[1]+", "+this.dims[2]+", "+this.dims[3]+", "+this.dims[4]+", "+this.dims[5]+", "+this.dims[6]+", "+this.dims[7]+"\n",t+="Intent Parameters (1-3): "+this.intent_p1+", "+this.intent_p2+", "+this.intent_p3+"\n",t+="Intent Code = "+this.intent_code+"\n",t+="Datatype = "+this.datatypeCode+" ("+this.getDatatypeCodeString(this.datatypeCode)+")\n",t+="Bits Per Voxel = "+this.numBitsPerVoxel+"\n",t+="Slice Start = "+this.slice_start+"\n",t+="Voxel Dimensions (1-8): "+a(this.pixDims[0])+", "+a(this.pixDims[1])+", "+a(this.pixDims[2])+", "+a(this.pixDims[3])+", "+a(this.pixDims[4])+", "+a(this.pixDims[5])+", "+a(this.pixDims[6])+", "+a(this.pixDims[7])+"\n",t+="Image Offset = "+this.vox_offset+"\n",t+="Data Scale:  Slope = "+a(this.scl_slope)+"  Intercept = "+a(this.scl_inter)+"\n",t+="Slice End = "+this.slice_end+"\n",t+="Slice Code = "+this.slice_code+"\n",t+="Units Code = "+this.xyzt_units+" ("+this.getUnitsCodeString(l.NIFTI1.SPATIAL_UNITS_MASK&this.xyzt_units)+", "+this.getUnitsCodeString(l.NIFTI1.TEMPORAL_UNITS_MASK&this.xyzt_units)+")\n",t+="Display Range:  Max = "+a(this.cal_max)+"  Min = "+a(this.cal_min)+"\n",t+="Slice Duration = "+this.slice_duration+"\n",t+="Time Axis Shift = "+this.toffset+"\n",t+="Description: \""+this.description+"\"\n",t+="Auxiliary File: \""+this.aux_file+"\"\n",t+="Q-Form Code = "+this.qform_code+" ("+this.getTransformCodeString(this.qform_code)+")\n",t+="S-Form Code = "+this.sform_code+" ("+this.getTransformCodeString(this.sform_code)+")\n",t+="Quaternion Parameters:  b = "+a(this.quatern_b)+"  c = "+a(this.quatern_c)+"  d = "+a(this.quatern_d)+"\n",t+="Quaternion Offsets:  x = "+this.qoffset_x+"  y = "+this.qoffset_y+"  z = "+this.qoffset_z+"\n",t+="S-Form Parameters X: "+a(this.affine[0][0])+", "+a(this.affine[0][1])+", "+a(this.affine[0][2])+", "+a(this.affine[0][3])+"\n",t+="S-Form Parameters Y: "+a(this.affine[1][0])+", "+a(this.affine[1][1])+", "+a(this.affine[1][2])+", "+a(this.affine[1][3])+"\n",t+="S-Form Parameters Z: "+a(this.affine[2][0])+", "+a(this.affine[2][1])+", "+a(this.affine[2][2])+", "+a(this.affine[2][3])+"\n",t+="Intent Name: \""+this.intent_name+"\"\n",this.extensionFlag[0]&&(t+="Extension: Size = "+this.extensionSize+"  Code = "+this.extensionCode+"\n"),t},l.NIFTI1.prototype.getDatatypeCodeString=function(e){return e===l.NIFTI1.TYPE_UINT8?"1-Byte Unsigned Integer":e===l.NIFTI1.TYPE_INT16?"2-Byte Signed Integer":e===l.NIFTI1.TYPE_INT32?"4-Byte Signed Integer":e===l.NIFTI1.TYPE_FLOAT32?"4-Byte Float":e===l.NIFTI1.TYPE_FLOAT64?"8-Byte Float":e===l.NIFTI1.TYPE_RGB24?"RGB":e===l.NIFTI1.TYPE_INT8?"1-Byte Signed Integer":e===l.NIFTI1.TYPE_UINT16?"2-Byte Unsigned Integer":e===l.NIFTI1.TYPE_UINT32?"4-Byte Unsigned Integer":e===l.NIFTI1.TYPE_INT64?"8-Byte Signed Integer":e===l.NIFTI1.TYPE_UINT64?"8-Byte Unsigned Integer":"Unknown"},l.NIFTI1.prototype.getTransformCodeString=function(e){return e===l.NIFTI1.XFORM_SCANNER_ANAT?"Scanner":e===l.NIFTI1.XFORM_ALIGNED_ANAT?"Aligned":e===l.NIFTI1.XFORM_TALAIRACH?"Talairach":e===l.NIFTI1.XFORM_MNI_152?"MNI":"Unknown"},l.NIFTI1.prototype.getUnitsCodeString=function(e){return e===l.NIFTI1.UNITS_METER?"Meters":e===l.NIFTI1.UNITS_MM?"Millimeters":e===l.NIFTI1.UNITS_MICRON?"Microns":e===l.NIFTI1.UNITS_SEC?"Seconds":e===l.NIFTI1.UNITS_MSEC?"Milliseconds":e===l.NIFTI1.UNITS_USEC?"Microseconds":e===l.NIFTI1.UNITS_HZ?"Hz":e===l.NIFTI1.UNITS_PPM?"PPM":e===l.NIFTI1.UNITS_RADS?"Rads":"Unknown"},l.NIFTI1.prototype.getQformMat=function(){return this.convertNiftiQFormToNiftiSForm(this.quatern_b,this.quatern_c,this.quatern_d,this.qoffset_x,this.qoffset_y,this.qoffset_z,this.pixDims[1],this.pixDims[2],this.pixDims[3],this.pixDims[0])},l.NIFTI1.prototype.convertNiftiQFormToNiftiSForm=function(y,t,e,n,i,r,o,a,s,l){var c=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],f=y,m=t,_=e,g,h,u,p;return c[3][0]=c[3][1]=c[3][2]=0,c[3][3]=1,1e-7>(g=1-(f*f+m*m+_*_))?(f*=g=1/N(f*f+m*m+_*_),m*=g,_*=g,g=0):g=N(g),h=0<o?o:1,u=0<a?a:1,p=0<s?s:1,0>l&&(p=-p),c[0][0]=(g*g+f*f-m*m-_*_)*h,c[0][1]=2*(f*m-g*_)*u,c[0][2]=2*(f*_+g*m)*p,c[1][0]=2*(f*m+g*_)*h,c[1][1]=(g*g+m*m-f*f-_*_)*u,c[1][2]=2*(m*_-g*f)*p,c[2][0]=2*(f*_-g*m)*h,c[2][1]=2*(m*_+g*f)*u,c[2][2]=(g*g+_*_-m*m-f*f)*p,c[0][3]=n,c[1][3]=i,c[2][3]=r,c},l.NIFTI1.prototype.convertNiftiSFormToNEMA=function(D){var t,e,n,i,r,o,a,s,l,c,h,u,p,d,f,m,_,g,y,v,b,w,x,S,E,M,T,A,P,I,C,L,R;if(d=0,M=[[0,0,0],[0,0,0],[0,0,0]],T=[[0,0,0],[0,0,0],[0,0,0]],t=D[0][0],e=D[0][1],n=D[0][2],i=D[1][0],r=D[1][1],o=D[1][2],a=D[2][0],s=D[2][1],l=D[2][2],0===(c=N(t*t+i*i+a*a)))return null;if(t/=c,i/=c,a/=c,0===(c=N(e*e+r*r+s*s)))return null;if(e/=c,r/=c,s/=c,c=t*e+i*r+a*s,1e-4<B(c)){if(e-=c*t,r-=c*i,s-=c*a,0===(c=N(e*e+r*r+s*s)))return null;e/=c,r/=c,s/=c}if(0===(c=N(n*n+o*o+l*l))?(n=i*s-a*r,o=a*e-s*t,l=t*r-i*e):(n/=c,o/=c,l/=c),c=t*n+i*o+a*l,1e-4<B(c)){if(n-=c*t,o-=c*i,l-=c*a,0===(c=N(n*n+o*o+l*l)))return null;n/=c,o/=c,l/=c}if(c=e*n+r*o+s*l,1e-4<B(c)){if(n-=c*e,o-=c*r,l-=c*s,0===(c=N(n*n+o*o+l*l)))return null;n/=c,o/=c,l/=c}if(M[0][0]=t,M[0][1]=e,M[0][2]=n,M[1][0]=i,M[1][1]=r,M[1][2]=o,M[2][0]=a,M[2][1]=s,M[2][2]=l,0===(h=this.nifti_mat33_determ(M)))return null;for(E=-666,g=b=w=x=1,y=2,v=3,u=1;3>=u;u+=1)for(p=1;3>=p;p+=1)if(u!==p)for(d=1;3>=d;d+=1)if(u!==d&&p!==d)for(T[0][0]=T[0][1]=T[0][2]=T[1][0]=T[1][1]=T[1][2]=T[2][0]=T[2][1]=T[2][2]=0,f=-1;1>=f;f+=2)for(m=-1;1>=m;m+=2)for(_=-1;1>=_;_+=2)T[0][u-1]=f,T[1][p-1]=m,T[2][d-1]=_,0<this.nifti_mat33_determ(T)*h&&(c=(S=this.nifti_mat33_mul(T,M))[0][0]+S[1][1]+S[2][2])>E&&(E=c,g=u,y=p,v=d,b=f,w=m,x=_);switch(A=P=I=C=L=R=0,g*b){case 1:A="X",C="+";break;case-1:A="X",C="-";break;case 2:A="Y",C="+";break;case-2:A="Y",C="-";break;case 3:A="Z",C="+";break;case-3:A="Z",C="-";}switch(y*w){case 1:P="X",L="+";break;case-1:P="X",L="-";break;case 2:P="Y",L="+";break;case-2:P="Y",L="-";break;case 3:P="Z",L="+";break;case-3:P="Z",L="-";}switch(v*x){case 1:I="X",R="+";break;case-1:I="X",R="-";break;case 2:I="Y",R="+";break;case-2:I="Y",R="-";break;case 3:I="Z",R="+";break;case-3:I="Z",R="-";}return A+P+I+C+L+R},l.NIFTI1.prototype.nifti_mat33_mul=function(a,t){var e=[[0,0,0],[0,0,0],[0,0,0]],o,r;for(o=0;3>o;o+=1)for(r=0;3>r;r+=1)e[o][r]=a[o][0]*t[0][r]+a[o][1]*t[1][r]+a[o][2]*t[2][r];return e},l.NIFTI1.prototype.nifti_mat33_determ=function(d){var t,e,n,i,r,o,a,s,l;return t=d[0][0],e=d[0][1],n=d[0][2],i=d[1][0],r=d[1][1],o=d[1][2],a=d[2][0],s=d[2][1],l=d[2][2],t*r*l-t*s*o-i*e*l+i*s*n+a*e*o-a*r*n},l.NIFTI1.prototype.getExtensionLocation=function(){return l.NIFTI1.MAGIC_COOKIE+4},l.NIFTI1.prototype.getExtensionSize=function(e){return l.Utils.getIntAt(e,this.getExtensionLocation(),this.littleEndian)},l.NIFTI1.prototype.getExtensionCode=function(e){return l.Utils.getIntAt(e,this.getExtensionLocation()+4,this.littleEndian)},"undefined"!==typeof a&&a.exports&&(a.exports=l.NIFTI1)},function(d,t,e){"use strict";function p(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function i(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))||"function"==typeof o)?o:a}function r(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var o=e(15),a=e(0),n=e(19),l=e(162),s=function(s){function t(e,r){p(this,t);var o=i(this,s.call(this));o._id=r,o._arrayBuffer=e.buffer,o._url=e.url,o._dataSet=null,o._unpackedData=null;try{o._dataSet=l.parse(o._arrayBuffer)}catch(e){window.console.log("ooops... :(")}return o}return r(t,s),t.prototype.rightHanded=function(){return this._rightHanded=this._dataSet.space.match(/^right-anterior-superior/)||this._dataSet.space.match(/^left-posterior-superior/),this._rightHanded},t.prototype.seriesInstanceUID=function(){return this._url},t.prototype.numberOfFrames=function(){return this._dataSet.sizes[2]},t.prototype.numberOfChannels=function(){return 1},t.prototype.sopInstanceUID=function(){return 0<arguments.length&&void 0!==arguments[0]?arguments[0]:0},t.prototype.rows=function(){return 0<arguments.length&&void 0!==arguments[0]&&arguments[0],this._dataSet.sizes[1]},t.prototype.columns=function(){return 0<arguments.length&&void 0!==arguments[0]&&arguments[0],this._dataSet.sizes[0]},t.prototype.pixelType=function(){0<arguments.length&&void 0!==arguments[0]&&arguments[0];var e=0;return"float"===this._dataSet.type&&(e=1),e},t.prototype.bitsAllocated=function(){0<arguments.length&&void 0!==arguments[0]&&arguments[0];var e=1;return"int8"===this._dataSet.type||"uint8"===this._dataSet.type||"char"===this._dataSet.type?e=8:"int16"===this._dataSet.type||"uint16"===this._dataSet.type||"short"===this._dataSet.type?e=16:"int32"!==this._dataSet.type&&"uint32"!==this._dataSet.type&&"float"!==this._dataSet.type||(e=32),e},t.prototype.pixelSpacing=function(){0<arguments.length&&void 0!==arguments[0]&&arguments[0];var o=new a.f(this._dataSet.spaceDirections[0][0],this._dataSet.spaceDirections[0][1],this._dataSet.spaceDirections[0][2]),t=new a.f(this._dataSet.spaceDirections[1][0],this._dataSet.spaceDirections[1][1],this._dataSet.spaceDirections[1][2]),e=new a.f(this._dataSet.spaceDirections[2][0],this._dataSet.spaceDirections[2][1],this._dataSet.spaceDirections[2][2]);return[o.length(),t.length(),e.length()]},t.prototype.imageOrientation=function(){0<arguments.length&&void 0!==arguments[0]&&arguments[0];var o=this._dataSet.space.match(/right/)?-1:1,t=this._dataSet.space.match(/anterior/)?-1:1,e=new a.f(this._dataSet.spaceDirections[0][0]*o,this._dataSet.spaceDirections[0][1]*t,this._dataSet.spaceDirections[0][2]);e.normalize();var r=new a.f(this._dataSet.spaceDirections[1][0]*o,this._dataSet.spaceDirections[1][1]*t,this._dataSet.spaceDirections[1][2]);return r.normalize(),[e.x,e.y,e.z,r.x,r.y,r.z]},t.prototype.imagePosition=function(){return 0<arguments.length&&void 0!==arguments[0]&&arguments[0],[this._dataSet.spaceOrigin[0],this._dataSet.spaceOrigin[1],this._dataSet.spaceOrigin[2]]},t.prototype.extractPixelData=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return this._decompressUncompressed(e)},t.prototype._decompressUncompressed=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=this._dataSet.buffer,e=this.numberOfChannels(),l=this.rows(a)*this.columns(a)*e;this.rightHanded()||(a=this.numberOfFrames()-1-a);var i=a*l;if(null===this._unpackedData&&"gzip"===this._dataSet.encoding){var r=n.inflate(this._dataSet.buffer);this._unpackedData=r.buffer,t=this._unpackedData}else"gzip"===this._dataSet.encoding&&(t=this._unpackedData);return"int8"===this._dataSet.type||"char"===this._dataSet.type?new Int8Array(t,i,l):"uint8"===this._dataSet.type?new Uint8Array(t,i,l):"int16"===this._dataSet.type||"short"===this._dataSet.type?(i*=2,new Int16Array(t,i,l)):"uint16"===this._dataSet.type?(i*=2,new Uint16Array(t,i,l)):"int32"===this._dataSet.type?(i*=4,new Int32Array(t,i,l)):"uint32"===this._dataSet.type?(i*=4,new Uint32Array(t,i,l)):"float"===this._dataSet.type?(i*=4,new Float32Array(t,i,l)):void 0},t}(o.a);t.a=s},function(a,t){"use strict";function e(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function a(a,o){for(var e=0,r;e<o.length;e++)r=o[e],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,r.key,r)}return function(t,e,o){return e&&a(t.prototype,e),o&&a(t,o),t}}(),r=function(){function a(){e(this,a),this._id=-1,this._worldCoordinates=null,this._dataCoordinates=null,this._screenCoordinates=null,this._value=null}return n(a,[{key:"worldCoordinates",set:function(e){this._worldCoordinates=e},get:function(){return this._worldCoordinates}},{key:"dataCoordinates",set:function(e){this._dataCoordinates=e},get:function(){return this._dataCoordinates}},{key:"screenCoordinates",set:function(e){this._screenCoordinates=e},get:function(){return this._screenCoordinates}},{key:"value",set:function(e){this._value=e},get:function(){return this._value}},{key:"id",set:function(e){this._id=e},get:function(){return this._id}}]),a}();t.a=r},function(a,t,e){a.exports=e(84)},function(m,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e(85);e.d(t,"OrthographicCamera",function(){return n.a});var i=e(93);e.d(t,"TrackballControl",function(){return i.a}),e.d(t,"TrackballOrthoControl",function(){return i.b});var r=e(96);e.d(t,"ColorsCore",function(){return r.a}),e.d(t,"IntersectionsCore",function(){return r.b}),e.d(t,"UtilsCore",function(){return r.c}),e.d(t,"ValidatorsCore",function(){return r.d});var o=e(97);e.d(t,"SliceGeometry",function(){return o.a}),e.d(t,"VoxelGeometry",function(){return o.b});var a=e(98);e.d(t,"BorderHelper",function(){return a.a}),e.d(t,"BoundingBoxHelper",function(){return a.b}),e.d(t,"ContourHelper",function(){return a.c}),e.d(t,"LocalizerHelper",function(){return a.d}),e.d(t,"LutHelper",function(){return a.e}),e.d(t,"SegmentationLutHelper",function(){return a.h}),e.d(t,"ProgressBarHelper",function(){return a.g}),e.d(t,"ProgressBarEventBasedHelper",function(){return a.f}),e.d(t,"SliceHelper",function(){return a.i}),e.d(t,"StackHelper",function(){return a.j}),e.d(t,"VolumeRenderingHelper",function(){return a.k});var s=e(110);e.d(t,"VolumeLoader",function(){return s.a});var l=e(163);e.d(t,"FrameModel",function(){return l.a}),e.d(t,"StackModel",function(){return l.c}),e.d(t,"SeriesModel",function(){return l.b}),e.d(t,"VoxelModel",function(){return l.d});var c=e(164);e.d(t,"DicomParser",function(){return c.a}),e.d(t,"NiftiParser",function(){return c.b}),e.d(t,"NrrdParser",function(){return c.c});var _=e(165);e.d(t,"SegmentationPreset",function(){return _.a});var u=e(168);e.d(t,"ContourUniformShader",function(){return u.b}),e.d(t,"ContourFragmentShader",function(){return u.a}),e.d(t,"ContourVertexShader",function(){return u.c}),e.d(t,"DataUniformShader",function(){return u.e}),e.d(t,"DataFragmentShader",function(){return u.d}),e.d(t,"DataVertexShader",function(){return u.f}),e.d(t,"VRUniformShader",function(){return u.n}),e.d(t,"VRFragmentShader",function(){return u.m}),e.d(t,"VRVertexShader",function(){return u.o}),e.d(t,"LayerUniformShader",function(){return u.h}),e.d(t,"LayerFragmentShader",function(){return u.g}),e.d(t,"LayerVertexShader",function(){return u.i}),e.d(t,"LocalizerUniformShader",function(){return u.k}),e.d(t,"LocalizerFragmentShader",function(){return u.j}),e.d(t,"LocalizerVertexShader",function(){return u.l});var p=e(172);e.d(t,"AnnotationWidget",function(){return p.a}),e.d(t,"BiRulerWidget",function(){return p.b}),e.d(t,"HandleWidget",function(){return p.c}),e.d(t,"RoiWidget",function(){return p.d}),e.d(t,"RulerWidget",function(){return p.e}),e.d(t,"VoxelProbeWidget",function(){return p.f});var d=e(178);window.console.log("AMI "+d.version+" ( ThreeJS "+d.config.threeVersion+")")},function(a,t,e){"use strict";var o=e(86);e.d(t,"a",function(){return o.a})},function(d,t,e){"use strict";function p(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function i(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))||"function"==typeof o)?o:a}function r(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var u=e(9),a=e(14),m=e(0),o=function(){function a(a,o){for(var e=0,r;e<o.length;e++)r=o[e],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,r.key,r)}return function(t,e,o){return e&&a(t.prototype,e),o&&a(t,o),t}}(),n=function(l){function t(e,r,o,a,n,s){p(this,t);var c=i(this,l.call(this,e,r,o,a,n,s));return c._front=null,c._back=null,c._directions=[new m.f(1,0,0),new m.f(0,1,0),new m.f(0,0,1)],c._directionsLabel=["A","P","L","R","I","S"],c._orientation="default",c._convention="radio",c._stackOrientation=0,c._right=null,c._up=null,c._direction=null,c._controls=null,c._box=null,c._canvas={width:null,height:null},c._fromFront=!0,c._angle=0,c}return r(t,l),t.prototype.init=function(l,t,e,n,i,r){if(window.console.warn("cameras.orthographic.init(...) is deprecated.\n      Use .cosines, .controls, .box and .canvas instead."),!(a.a.vector3(l)&&a.a.vector3(t)&&a.a.vector3(e)&&a.a.box(i)&&n))return window.console.log("Invalid input provided."),!1;this._right=l,this._up=this._adjustTopDirection(l,t),this._direction=new m.f().crossVectors(this._right,this._up),this._controls=n,this._box=i,this._canvas=r;var o={position:this._box.center,direction:this._direction},s=this._orderIntersections(u.a.rayBox(o,this._box),this._direction);this._front=s[0],this._back=s[1],this.up.set(this._up.x,this._up.y,this._up.z),this._updateCanvas(),this._updatePositionAndTarget(this._front,this._back),this._updateMatrices(),this._updateDirections()},t.prototype.update=function(){if("default"===this._orientation)switch(this._getMaxIndex(this._directions[2])){case 0:this._orientation="sagittal";break;case 1:this._orientation="coronal";break;case 2:this._orientation="axial";break;default:this._orientation="free";}if("free"===this._orientation)this._right=this._directions[0],this._up=this._directions[1],this._direction=this._directions[2];else{var a=this.leftDirection(),t=this._directions[a],e=this.posteriorDirection(),n=this._directions[e],i=this.superiorDirection(),r=this._directions[i];if("radio"===this._convention)switch(this._orientation){case"axial":0<n.y&&n.negate(),0>r.z&&r.negate(),this._right=t,this._up=n,this._direction=r;break;case"coronal":0>r.z&&r.negate(),0>n.y&&n.negate(),this._right=t,this._up=r,this._direction=n;break;case"sagittal":0>r.z&&r.negate(),0<t.x&&t.negate(),this._right=n,this._up=r,this._direction=t;break;default:window.console.warn("\""+this._orientation+"\" orientation is not valid.\n                (choices: axial, coronal, sagittal)");}else if("neuro"===this._convention)switch(this._orientation){case"axial":0<n.y&&n.negate(),0<r.z&&r.negate(),this._right=t,this._up=n,this._direction=r;break;case"coronal":0>r.z&&r.negate(),0<n.y&&n.negate(),this._right=t,this._up=r,this._direction=n;break;case"sagittal":0>r.z&&r.negate(),0<t.x&&t.negate(),this._right=n,this._up=r,this._direction=t;break;default:window.console.warn("\""+this._orientation+"\" orientation is not valid.\n                (choices: axial, coronal, sagittal)");}else window.console.warn(this._convention+" is not valid (choices: radio, neuro)")}var o={position:this._box.center,direction:this._direction},s=this._orderIntersections(u.a.rayBox(o,this._box),this._direction);this._front=s[0],this._back=s[1],this.up.set(this._up.x,this._up.y,this._up.z),this._updateCanvas(),this._updatePositionAndTarget(this._front,this._back),this._updateMatrices(),this._updateDirections()},t.prototype.leftDirection=function(){return this._findMaxIndex(this._directions,0)},t.prototype.posteriorDirection=function(){return this._findMaxIndex(this._directions,1)},t.prototype.superiorDirection=function(){return this._findMaxIndex(this._directions,2)},t.prototype.invertRows=function(){this.up.multiplyScalar(-1),this.invertColumns(),this._updateDirections()},t.prototype.invertColumns=function(){this.center();var e=this._oppositePosition(this.position);this._updatePositionAndTarget(e,this.position.clone()),this._updateMatrices(),this._fromFront=!this._fromFront,this._angle%=360,this._angle=360-this._angle,this._updateDirections()},t.prototype.center=function(){this._fromFront?this._updatePositionAndTarget(this._front,this._back):this._updatePositionAndTarget(this._back,this._front),this._updateMatrices(),this._updateDirections()},t.prototype.rotate=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;this.center();var t=90,e=1;this._fromFront||(e=-1),null===a?(t*=-e,this._angle+=90):(t=360-e*(a-this._angle),this._angle=a),this._angle%=360;var o=new m.c().makeRotationAxis(this._direction,t*Gn/180);this.up.applyMatrix4(o),this._updateMatrices(),this._updateDirections()},t.prototype.fitBox=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1.5,e=1;return 0===a?e=t*this._computeZoom(this._canvas.width,this._right):1===a?e=t*this._computeZoom(this._canvas.height,this._up):2===a?e=t*U(this._computeZoom(this._canvas.width,this._right),this._computeZoom(this._canvas.height,this._up)):void 0,!!e&&void(this.zoom=e,this.center())},t.prototype._adjustTopDirection=function(a,t){var e=this._getMaxIndex(t);return(2===e&&0>t.getComponent(e)||1===e&&0<t.getComponent(e)||0===e&&0<t.getComponent(e))&&t.negate(),t},t.prototype._getMaxIndex=function(a){var t=B(a.x),e=0;return B(a.y)>t&&(t=B(a.y),e=1),B(a.z)>t&&(e=2),e},t.prototype._findMaxIndex=function(a,t){for(var e=this._getMaxIndices(a),o=0;o<e.length;o++)if(e[o]===t)return o},t.prototype._getMaxIndices=function(a){var t=[];return t.push(this._getMaxIndex(a[0])),t.push(this._getMaxIndex(a[1])),t.push(this._getMaxIndex(a[2])),t},t.prototype._orderIntersections=function(a,t){return a[0].dot(t)<a[1].dot(t)?a:[a[1],a[0]]},t.prototype._updateCanvas=function(){this.left=-this._canvas.width/2,this.right=this._canvas.width/2,this.top=this._canvas.height/2,this.bottom=-this._canvas.height/2,this._updateMatrices(),this.controls.handleResize()},t.prototype._oppositePosition=function(a){var t=a.clone();t.sub(this._box.center);var e=new m.c().makeRotationAxis(this.up,Math.PI);return t.applyMatrix4(e),t.add(this._box.center),t},t.prototype._computeZoom=function(a,t){if(!(a&&0<a))return window.console.log("Invalid dimension provided."),window.console.log(a),!1;var o={position:this._box.center.clone(),direction:t},r=u.a.rayBox(o,this._box);return 2>r.length?(window.console.log("Can not adjust the camera ( < 2 intersections)."),window.console.log(o),window.console.log(this._box),!1):a/r[0].distanceTo(r[1])},t.prototype._updatePositionAndTarget=function(a,t){this.position.set(a.x,a.y,a.z),this.lookAt(t.x,t.y,t.z),this._controls.target.set(t.x,t.y,t.z)},t.prototype._updateMatrices=function(){this._controls.update(),this.updateProjectionMatrix(),this.updateMatrixWorld()},t.prototype._updateLabels=function(){this._directionsLabel=[this._vector2Label(this._up),this._vector2Label(this._up.clone().negate()),this._vector2Label(this._right),this._vector2Label(this._right.clone().negate()),this._vector2Label(this._direction),this._vector2Label(this._direction.clone().negate())]},t.prototype._vector2Label=function(a){for(var t=this._getMaxIndex(a),e=a.clone().divideScalar(B(a.getComponent(t))),o="",n=0;3>n;n++)0===n&&(1<=e.getComponent(n)+.2?o+="L":-1>=e.getComponent(n)-.2&&(o+="R")),1===n&&(1<=e.getComponent(n)+.2?o+="P":-1>=e.getComponent(n)-.2&&(o+="A")),2===n&&(1<=e.getComponent(n)+.2?o+="S":-1>=e.getComponent(n)-.2&&(o+="I"));return o},t.prototype._updateDirections=function(){this._up=this.up.clone();var e=new m.f(0,0,-1).applyMatrix4(this.matrixWorld);this._direction=e.sub(this.position).normalize(),this._right=new m.f().crossVectors(this._direction,this.up),this._updateLabels()},o(t,[{key:"controls",set:function(e){this._controls=e},get:function(){return this._controls}},{key:"box",set:function(e){this._box=e},get:function(){return this._box}},{key:"canvas",set:function(e){this._canvas=e,this._updateCanvas()},get:function(){return this._canvas}},{key:"angle",set:function(e){this.rotate(e)},get:function(){return this._angle}},{key:"directions",set:function(e){this._directions=e},get:function(){return this._directions}},{key:"convention",set:function(e){this._convention=e},get:function(){return this._convention}},{key:"orientation",set:function(e){this._orientation=e},get:function(){return this._orientation}},{key:"directionsLabel",set:function(e){this._directionsLabel=e},get:function(){return this._directionsLabel}},{key:"stackOrientation",set:function(a){if(this._stackOrientation=a,0===this._stackOrientation)this._orientation="default";else{var t=this._getMaxIndex(this._directions[(this._stackOrientation+2)%3]);0===t?this._orientation="sagittal":1===t?this._orientation="coronal":2===t&&(this._orientation="axial")}},get:function(){if("default"===this._orientation)this._stackOrientation=0;else{var e=this._getMaxIndex(this._direction);e===this._getMaxIndex(this._directions[2])?this._stackOrientation=0:e===this._getMaxIndex(this._directions[0])?this._stackOrientation=1:e===this._getMaxIndex(this._directions[1])&&(this._stackOrientation=2)}return this._stackOrientation}}]),t}(THREE.OrthographicCamera);t.a=n},function(h,t,e){"use strict";function x(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function n(a,t,e){if(a&&X.isObject(a)&&a instanceof x)return a;var o=new x;return o.parse(a,t,e),o}var r=e(88),X=e(89);t.parse=n,t.resolve=function(a,t){return n(a,!1,!0).resolve(t)},t.resolveObject=function(a,t){return a?n(a,!1,!0).resolveObject(t):t},t.format=function(e){return X.isString(e)&&(e=n(e)),e instanceof x?e.format():x.prototype.format.call(e)},t.Url=x;var a=/^([a-z0-9.+-]+:)/i,o=/:[0-9]*$/,i=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,l=["{","}","|","\\","^","`"].concat(["<",">","\"","`"," ","\r","\n","\t"]),s=["'"].concat(l),c=["%","/","?",";","#"].concat(s),d=["/","?","#"],p=/^[+a-z0-9A-Z_-]{0,63}$/,m=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,_={javascript:!0,"javascript:":!0},g={javascript:!0,"javascript:":!0},y={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},f=e(90);x.prototype.parse=function(o,b,e){if(!X.isString(o))throw new TypeError("Parameter 'url' must be a string, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));var v=o.indexOf("?"),Y=-1!==v&&v<o.indexOf("#")?"?":"#",Z=o.split(Y),l=/\\/g;Z[0]=Z[0].replace(l,"/");var h=o=Z.join(Y);if(h=h.trim(),!e&&1===o.split("#").length){var u=i.exec(h);if(u)return this.path=h,this.href=h,this.pathname=u[1],u[2]?(this.search=u[2],this.query=b?f.parse(this.search.substr(1)):this.search.substr(1)):b&&(this.search="",this.query={}),this}var w=a.exec(h);if(w){var x=(w=w[0]).toLowerCase();this.protocol=x,h=h.substr(w.length)}if(e||w||h.match(/^\/\/[^@\/]+@[^@\/]+/)){var S="//"===h.substr(0,2);!S||w&&g[w]||(h=h.substr(2),this.slashes=!0)}if(!g[w]&&(S||w&&!y[w])){for(var J=-1,M=0;M<d.length;M++)-1!==(P=h.indexOf(d[M]))&&(-1===J||P<J)&&(J=P);var T,A;for(-1!==(A=-1===J?h.lastIndexOf("@"):h.lastIndexOf("@",J))&&(T=h.slice(0,A),h=h.slice(A+1),this.auth=decodeURIComponent(T)),J=-1,M=0;M<c.length;M++){var P=h.indexOf(c[M]);-1!==P&&(-1===J||P<J)&&(J=P)}-1===J&&(J=h.length),this.host=h.slice(0,J),h=h.slice(J),this.parseHost(),this.hostname=this.hostname||"";var I="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!I)for(var K=this.hostname.split(/\./),M=0,L=K.length,R;M<L;M++)if(R=K[M],R&&!R.match(p)){for(var k="",D=0,O=R.length;D<O;D++)k+=127<R.charCodeAt(D)?"x":R[D];if(!k.match(p)){var F=K.slice(0,M),U=K.slice(M+1),N=R.match(m);N&&(F.push(N[1]),U.unshift(N[2])),U.length&&(h="/"+U.join(".")+h),this.hostname=F.join(".");break}}this.hostname=255<this.hostname.length?"":this.hostname.toLowerCase(),I||(this.hostname=r.toASCII(this.hostname));var B=this.port?":"+this.port:"",z=this.hostname||"";this.host=z+B,this.href+=this.host,I&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==h[0]&&(h="/"+h))}if(!_[x])for(var M=0,L=s.length,G;M<L;M++)if(G=s[M],-1!==h.indexOf(G)){var j=encodeURIComponent(G);j===G&&(j=escape(G)),h=h.split(G).join(j)}var H=h.indexOf("#");-1!==H&&(this.hash=h.substr(H),h=h.slice(0,H));var V=h.indexOf("?");if(-1===V?b&&(this.search="",this.query={}):(this.search=h.substr(V),this.query=h.substr(V+1),b&&(this.query=f.parse(this.query)),h=h.slice(0,V)),h&&(this.pathname=h),y[x]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var B=this.pathname||"",W=this.search||"";this.path=B+W}return this.href=this.format(),this},x.prototype.format=function(){var a=this.auth||"";a&&(a=(a=encodeURIComponent(a)).replace(/%3A/i,":"),a+="@");var t=this.protocol||"",l=this.pathname||"",n=this.hash||"",i=!1,r="";this.host?i=a+this.host:this.hostname&&(i=a+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&X.isObject(this.query)&&Object.keys(this.query).length&&(r=f.stringify(this.query));var o=this.search||r&&"?"+r||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||y[t])&&!1!==i?(i="//"+(i||""),l&&"/"!==l.charAt(0)&&(l="/"+l)):i||(i=""),n&&"#"!==n.charAt(0)&&(n="#"+n),o&&"?"!==o.charAt(0)&&(o="?"+o),l=l.replace(/[?#]/g,function(e){return encodeURIComponent(e)}),o=o.replace("#","%23"),t+i+l+o+n},x.prototype.resolve=function(e){return this.resolveObject(n(e,!1,!0)).format()},x.prototype.resolveObject=function(a){if(X.isString(a)){var t=new x;t.parse(a,!1,!0),a=t}for(var e=new x,n=Object.keys(this),r=0,o;r<n.length;r++)o=n[r],e[o]=this[o];if(e.hash=a.hash,""===a.href)return e.href=e.format(),e;if(a.slashes&&!a.protocol){for(var i=Object.keys(a),l=0,s;l<i.length;l++)s=i[l],"protocol"!==s&&(e[s]=a[s]);return y[e.protocol]&&e.hostname&&!e.pathname&&(e.path=e.pathname="/"),e.href=e.format(),e}if(a.protocol&&a.protocol!==e.protocol){if(!y[a.protocol]){for(var c=Object.keys(a),u=0,p;u<c.length;u++)p=c[u],e[p]=a[p];return e.href=e.format(),e}if(e.protocol=a.protocol,a.host||g[a.protocol])e.pathname=a.pathname;else{for(R=(a.pathname||"").split("/");R.length&&!(a.host=R.shift()););a.host||(a.host=""),a.hostname||(a.hostname=""),""!==R[0]&&R.unshift(""),2>R.length&&R.unshift(""),e.pathname=R.join("/")}if(e.search=a.search,e.query=a.query,e.host=a.host||"",e.auth=a.auth,e.hostname=a.hostname||a.host,e.port=a.port,e.pathname||e.search){var d=e.pathname||"",h=e.search||"";e.path=d+h}return e.slashes=e.slashes||a.slashes,e.href=e.format(),e}var m=e.pathname&&"/"===e.pathname.charAt(0),_=a.host||a.pathname&&"/"===a.pathname.charAt(0),f=_||m||e.host&&a.pathname,v=f,L=e.pathname&&e.pathname.split("/")||[],R=a.pathname&&a.pathname.split("/")||[],S=e.protocol&&!y[e.protocol];if(S&&(e.hostname="",e.port=null,e.host&&(""===L[0]?L[0]=e.host:L.unshift(e.host)),e.host="",a.protocol&&(a.hostname=null,a.port=null,a.host&&(""===R[0]?R[0]=a.host:R.unshift(a.host)),a.host=null),f=f&&(""===R[0]||""===L[0])),_)e.host=a.host||""===a.host?a.host:e.host,e.hostname=a.hostname||""===a.hostname?a.hostname:e.hostname,e.search=a.search,e.query=a.query,L=R;else if(R.length)L||(L=[]),L.pop(),L=L.concat(R),e.search=a.search,e.query=a.query;else if(!X.isNullOrUndefined(a.search))return S&&(e.hostname=e.host=L.shift(),(D=!!(e.host&&0<e.host.indexOf("@"))&&e.host.split("@"))&&(e.auth=D.shift(),e.host=e.hostname=D.shift())),e.search=a.search,e.query=a.query,X.isNull(e.pathname)&&X.isNull(e.search)||(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.href=e.format(),e;if(!L.length)return e.pathname=null,e.path=e.search?"/"+e.search:null,e.href=e.format(),e;for(var E=L.slice(-1)[0],M=(e.host||a.host||1<L.length)&&("."===E||".."===E)||""===E,T=0,A=L.length;0<=A;A--)"."===(E=L[A])?L.splice(A,1):".."===E?(L.splice(A,1),T++):T&&(L.splice(A,1),T--);if(!f&&!v)for(;T--;T)L.unshift("..");!f||""===L[0]||L[0]&&"/"===L[0].charAt(0)||L.unshift(""),M&&"/"!==L.join("/").substr(-1)&&L.push("");var P=""===L[0]||L[0]&&"/"===L[0].charAt(0);if(S){e.hostname=e.host=P?"":L.length?L.shift():"";var D=!!(e.host&&0<e.host.indexOf("@"))&&e.host.split("@");D&&(e.auth=D.shift(),e.host=e.hostname=D.shift())}return(f=f||e.host&&L.length)&&!P&&L.unshift(""),L.length?e.pathname=L.join("/"):(e.pathname=null,e.path=null),X.isNull(e.pathname)&&X.isNull(e.search)||(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.auth=a.auth||e.auth,e.slashes=e.slashes||a.slashes,e.href=e.format(),e},x.prototype.parseHost=function(){var a=this.host,t=o.exec(a);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),a=a.substr(0,a.length-t.length)),a&&(this.hostname=a)}},function(a,o,D){(function(n,N){var U;!function(){function B(e){throw new RangeError(A[e])}function a(a,t){for(var e=a.length,o=[];e--;)o[e]=t(a[e]);return o}function r(o,t){var e=o.split("@"),r="";return 1<e.length&&(r=e[0]+"@",o=e[1]),r+a((o=o.replace(P,".")).split("."),t).join(".")}function l(a){for(var t=[],i=0,r=a.length,o,e;i<r;)55296<=(o=a.charCodeAt(i++))&&56319>=o&&i<r?56320==(64512&(e=a.charCodeAt(i++)))?t.push(((1023&o)<<10)+(1023&e)+65536):(t.push(o),i--):t.push(o);return t}function O(e){return a(e,function(a){var t="";return 65535<a&&(t+=I(55296|1023&(a-=65536)>>>10),a=56320|1023&a),t+=I(a)}).join("")}function G(e){return 10>e-48?e-22:26>e-65?e-65:26>e-97?e-97:y}function s(a,t){return a+22+75*(26>a)-((0!=t)<<5)}function H(a,t,e){var o=0;for(a=e?L(a/x):a>>1,a+=L(a/t);a>C*b>>1;o+=y)a=L(a/C);return L(o+(C+1)*a/(a+_))}function d(a){var t=[],d=a.length,u=0,m=E,_=w,h,e,n,i,r,o,s,l,c,p;for(0>(e=a.lastIndexOf(M))&&(e=0),n=0;n<e;++n)128<=a.charCodeAt(n)&&B("not-basic"),t.push(a.charCodeAt(n));for(i=0<e?e+1:0;i<d;){for(r=u,o=1,s=y;i>=d&&B("invalid-input"),((l=G(a.charCodeAt(i++)))>=y||l>L((V-u)/o))&&B("overflow"),u+=l*o,c=s<=_?v:s>=_+b?b:s-_,!(l<c);s+=y)o>L(V/(p=y-c))&&B("overflow"),o*=p;_=H(u-r,h=t.length+1,0==r),L(u/h)>V-m&&B("overflow"),m+=L(u/h),u%=h,t.splice(u++,0,m)}return O(t)}function p(a){var t=[],c,e,n,i,r,o,d,p,h,u,f,T,_,g,x;for(T=(a=l(a)).length,c=E,e=0,r=w,o=0;o<T;++o)128>(f=a[o])&&t.push(I(f));for(n=i=t.length,i&&t.push(M);n<T;){for(d=V,o=0;o<T;++o)(f=a[o])>=c&&f<d&&(d=f);for(d-c>L((V-e)/(_=n+1))&&B("overflow"),e+=(d-c)*_,c=d,o=0;o<T;++o)if((f=a[o])<c&&++e>V&&B("overflow"),f==c){for(p=e,h=y;u=h<=r?v:h>=r+b?b:h-r,!(p<u);h+=y)x=p-u,g=y-u,t.push(I(s(u+x%g,0))),p=L(x/g);t.push(I(s(p,0))),r=H(e,_,n==i),e=0,++n}++e,++c}return t.join("")}"object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))&&o&&o.nodeType,"object"==("undefined"===typeof n?"undefined":babelHelpers.typeof(n))&&n&&n.nodeType;var u="object"==("undefined"===typeof N?"undefined":babelHelpers.typeof(N))&&N,V=2147483647,y=36,v=1,b=26,_=38,x=700,w=72,E=128,M="-",S=/^xn--/,T=/[^\x20-\x7E]/,P=/[\x2E\u3002\uFF0E\uFF61]/g,A={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},C=y-v,L=z,I=F,R;R={version:"1.4.1",ucs2:{decode:l,encode:O},decode:d,encode:p,toASCII:function(e){return r(e,function(e){return T.test(e)?"xn--"+p(e):e})},toUnicode:function(e){return r(e,function(e){return S.test(e)?d(e.slice(4).toLowerCase()):e})}},void 0!==(U=function(){return R}.call(o,D,o,n))&&(n.exports=U)}()}).call(o,D(29)(a),D(1))},function(e){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==("undefined"===typeof e?"undefined":babelHelpers.typeof(e))&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},function(a,t,e){"use strict";t.decode=t.parse=e(91),t.encode=t.stringify=e(92)},function(e){"use strict";function o(a,t){return Object.prototype.hasOwnProperty.call(a,t)}e.exports=function(r,g,e,n){g=g||"&",e=e||"=";var y={};if("string"!=typeof r||0===r.length)return y;var a=/\+/g;r=r.split(g);var s=1e3;n&&"number"==typeof n.maxKeys&&(s=n.maxKeys);var l=r.length;0<s&&l>s&&(l=s);for(var c=0;c<l;++c){var h=r[c].replace(a,"%20"),m=h.indexOf(e),_,u,p,d;0<=m?(_=h.substr(0,m),u=h.substr(m+1)):(_=h,u=""),p=decodeURIComponent(_),d=decodeURIComponent(u),o(y,p)?i(y[p])?y[p].push(d):y[p]=[y[p],d]:y[p]=d}return y};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},function(e){"use strict";function l(a,t){if(a.map)return a.map(t);for(var e=[],o=0;o<a.length;o++)e.push(t(a[o],o));return e}var i=function(e){switch("undefined"===typeof e?"undefined":babelHelpers.typeof(e)){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return"";}};e.exports=function(c,d,e,a){return d=d||"&",e=e||"=",null===c&&(c=void 0),"object"==("undefined"===typeof c?"undefined":babelHelpers.typeof(c))?l(o(c),function(t){var a=encodeURIComponent(i(t))+e;return r(c[t])?l(c[t],function(e){return a+encodeURIComponent(i(e))}).join(d):a+encodeURIComponent(i(c[t]))}).join(d):a?encodeURIComponent(i(a))+e+encodeURIComponent(i(c)):""};var r=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},o=Object.keys||function(a){var t=[];for(var e in a)Object.prototype.hasOwnProperty.call(a,e)&&t.push(e);return t}},function(a,t,e){"use strict";var o=e(94),n=e(95);e.d(t,"a",function(){return o.a}),e.d(t,"b",function(){return n.a})},function(l,t,e){"use strict";function F(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function i(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))||"function"==typeof o)?o:a}function r(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var U=e(0),a=function(a){function t(e,r){function o(e){!1!==u.enabled&&(window.removeEventListener("keydown",o),m=h,h===p.NONE&&(e.keyCode!==u.keys[p.ROTATE]||u.noRotate?e.keyCode!==u.keys[p.ZOOM]||u.noZoom?e.keyCode!==u.keys[p.PAN]||u.noPan||(h=p.PAN):h=p.ZOOM:h=p.ROTATE))}function n(e){!1!==u.enabled&&(e.preventDefault(),e.stopPropagation(),h!==p.ROTATE||u.noRotate?h!==p.ZOOM||u.noZoom?h!==p.PAN||u.noPan?h!==p.CUSTOM||u.noCustom||P.copy(I(e.pageX,e.pageY)):T.copy(I(e.pageX,e.pageY)):x.copy(I(e.pageX,e.pageY)):(g.copy(f),f.copy(R(e.pageX,e.pageY))))}function l(e){!1!==u.enabled&&(e.preventDefault(),e.stopPropagation(),-1===u.forceState&&(h=p.NONE),document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",l),u.dispatchEvent(L))}function s(a){if(!1!==u.enabled){a.preventDefault(),a.stopPropagation();var t=0;a.wheelDelta?t=a.wheelDelta/40:a.detail&&(t=-a.detail/3),h===p.CUSTOM?h===p.CUSTOM&&(M.y+=.01*t):v.y+=.01*t,u.dispatchEvent(C),u.dispatchEvent(L)}}F(this,t);var c=i(this,a.call(this)),u=c,p={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5,CUSTOM:99};c.object=e,c.domElement=void 0===r?document:r,c.enabled=!0,c.screen={left:0,top:0,width:0,height:0},c.rotateSpeed=1,c.zoomSpeed=1.2,c.panSpeed=.3,c.noRotate=!1,c.noZoom=!1,c.noPan=!1,c.noCustom=!1,c.forceState=-1,c.staticMoving=!1,c.dynamicDampingFactor=.2,c.minDistance=0,c.maxDistance=1/0,c.keys=[65,83,68],c.target=new U.f;var d=new U.f,h=p.NONE,m=p.NONE,_=new U.f,g=new U.e,f=new U.e,y=new U.f,b=0,v=new U.e,x=new U.e,S=0,w=0,E=new U.e,T=new U.e,M=new U.e,P=new U.e;c.target0=c.target.clone(),c.position0=c.object.position.clone(),c.up0=c.object.up.clone();var A={type:"change"},C={type:"start"},L={type:"end"};c.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var a=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=a.left+window.pageXOffset-t.clientLeft,this.screen.top=a.top+window.pageYOffset-t.clientTop,this.screen.width=a.width,this.screen.height=a.height}},c.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var I=function(){var a=new U.e;return function(t,e){return a.set((t-u.screen.left)/u.screen.width,(e-u.screen.top)/u.screen.height),a}}(),R=function(){var a=new U.e;return function(t,e){return a.set((t-.5*u.screen.width-u.screen.left)/(.5*u.screen.width),(u.screen.height+2*(u.screen.top-e))/u.screen.width),a}}();return c.rotateCamera=function(){var a=new U.f,t=new U.d,e=new U.f,n=new U.f,i=new U.f,r=new U.f,o;return function(){r.set(f.x-g.x,f.y-g.y,0),(o=r.length())?(_.copy(u.object.position).sub(u.target),e.copy(_).normalize(),n.copy(u.object.up).normalize(),i.crossVectors(n,e).normalize(),n.setLength(f.y-g.y),i.setLength(f.x-g.x),r.copy(n.add(i)),a.crossVectors(r,_).normalize(),o*=u.rotateSpeed,t.setFromAxisAngle(a,o),_.applyQuaternion(t),u.object.up.applyQuaternion(t),y.copy(a),b=o):!u.staticMoving&&b&&(b*=N(1-u.dynamicDampingFactor),_.copy(u.object.position).sub(u.target),t.setFromAxisAngle(y,b),_.applyQuaternion(t),u.object.up.applyQuaternion(t)),g.copy(f)}}(),c.zoomCamera=function(){var e;h===p.TOUCH_ZOOM?(e=S/w,S=w,_.multiplyScalar(e)):1!==(e=1+(x.y-v.y)*u.zoomSpeed)&&0<e&&(_.multiplyScalar(e),u.staticMoving?v.copy(x):v.y+=(x.y-v.y)*this.dynamicDampingFactor)},c.panCamera=function(){var a=new U.e,t=new U.f,e=new U.f;return function(){a.copy(T).sub(E),a.lengthSq()&&(a.multiplyScalar(_.length()*u.panSpeed),e.copy(_).cross(u.object.up).setLength(a.x),e.add(t.copy(u.object.up).setLength(a.y)),u.object.position.add(e),u.target.add(e),u.staticMoving?E.copy(T):E.add(a.subVectors(T,E).multiplyScalar(u.dynamicDampingFactor)))}}(),c.checkDistances=function(){u.noZoom&&u.noPan||(_.lengthSq()>u.maxDistance*u.maxDistance&&u.object.position.addVectors(u.target,_.setLength(u.maxDistance)),_.lengthSq()<u.minDistance*u.minDistance&&u.object.position.addVectors(u.target,_.setLength(u.minDistance)))},c.update=function(){_.subVectors(u.object.position,u.target),u.noRotate||u.rotateCamera(),u.noZoom||u.zoomCamera(),u.noPan||u.panCamera(),u.noCustom||u.custom(M,P),u.object.position.addVectors(u.target,_),u.checkDistances(),u.object.lookAt(u.target),1e-6<d.distanceToSquared(u.object.position)&&(u.dispatchEvent(A),d.copy(u.object.position))},c.reset=function(){h=p.NONE,m=p.NONE,u.target.copy(u.target0),u.object.position.copy(u.position0),u.object.up.copy(u.up0),_.subVectors(u.object.position,u.target),u.object.lookAt(u.target),u.dispatchEvent(A),d.copy(u.object.position)},c.setState=function(e){u.forceState=e,m=e,h=e},c.custom=function(){},c.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),c.domElement.addEventListener("mousedown",function(e){!1!==u.enabled&&(e.preventDefault(),e.stopPropagation(),h===p.NONE&&(h=e.button),h!==p.ROTATE||u.noRotate?h!==p.ZOOM||u.noZoom?h!==p.PAN||u.noPan?h!==p.CUSTOM||u.noCustom||(M.copy(I(e.pageX,e.pageY)),P.copy(E)):(E.copy(I(e.pageX,e.pageY)),T.copy(E)):(v.copy(I(e.pageX,e.pageY)),x.copy(v)):(f.copy(R(e.pageX,e.pageY)),g.copy(f)),document.addEventListener("mousemove",n,!1),document.addEventListener("mouseup",l,!1),u.dispatchEvent(C))},!1),c.domElement.addEventListener("mousewheel",s,!1),c.domElement.addEventListener("DOMMouseScroll",s,!1),c.domElement.addEventListener("touchstart",function(a){if(!1!==u.enabled){if(-1===u.forceState)switch(a.touches.length){case 1:h=p.TOUCH_ROTATE,f.copy(R(a.touches[0].pageX,a.touches[0].pageY)),g.copy(f);break;case 2:h=p.TOUCH_ZOOM;var t=a.touches[0].pageX-a.touches[1].pageX,e=a.touches[0].pageY-a.touches[1].pageY;w=S=N(t*t+e*e);var o=(a.touches[0].pageX+a.touches[1].pageX)/2,n=(a.touches[0].pageY+a.touches[1].pageY)/2;E.copy(I(o,n)),T.copy(E);break;default:h=p.NONE;}else switch(h){case 0:h=p.TOUCH_ROTATE,f.copy(R(a.touches[0].pageX,a.touches[0].pageY)),g.copy(f);break;case 1:case 4:if(2<=a.touches.length){h=p.TOUCH_ZOOM;var t=a.touches[0].pageX-a.touches[1].pageX,e=a.touches[0].pageY-a.touches[1].pageY;w=S=N(t*t+e*e)}else h=p.ZOOM,v.copy(I(a.touches[0].pageX,a.touches[0].pageY)),x.copy(v);break;case 2:case 5:if(2<=a.touches.length){h=p.TOUCH_PAN;var o=(a.touches[0].pageX+a.touches[1].pageX)/2,n=(a.touches[0].pageY+a.touches[1].pageY)/2;E.copy(I(o,n)),T.copy(E)}else h=p.PAN,E.copy(I(a.touches[0].pageX,a.touches[0].pageY)),T.copy(E);break;case 99:h=p.CUSTOM;var o=(a.touches[0].pageX+a.touches[1].pageX)/2,n=(a.touches[0].pageY+a.touches[1].pageY)/2;M.copy(I(o,n)),P.copy(M);break;default:h=p.NONE;}u.dispatchEvent(C)}},!1),c.domElement.addEventListener("touchend",function(a){if(!1!==u.enabled){if(-1===u.forceState){switch(a.touches.length){case 1:g.copy(f),f.copy(R(a.touches[0].pageX,a.touches[0].pageY));break;case 2:S=w=0;var t=(a.touches[0].pageX+a.touches[1].pageX)/2,e=(a.touches[0].pageY+a.touches[1].pageY)/2;T.copy(I(t,e)),E.copy(T);}h=p.NONE}else switch(h){case 0:g.copy(f),f.copy(R(a.touches[0].pageX,a.touches[0].pageY));break;case 1:case 2:break;case 4:S=w=0,h=p.ZOOM;break;case 5:if(2<=a.touches.length){var t=(a.touches[0].pageX+a.touches[1].pageX)/2,e=(a.touches[0].pageY+a.touches[1].pageY)/2;T.copy(I(t,e)),E.copy(T)}h=p.PAN;break;case 99:var t=(a.touches[0].pageX+a.touches[1].pageX)/2,e=(a.touches[0].pageY+a.touches[1].pageY)/2;P.copy(I(t,e)),M.copy(P);break;default:h=p.NONE;}u.dispatchEvent(L)}},!1),c.domElement.addEventListener("touchmove",function(a){if(!1!==u.enabled)if(a.preventDefault(),a.stopPropagation(),-1===u.forceState)switch(a.touches.length){case 1:g.copy(f),f.copy(R(a.touches[0].pageX,a.touches[0].pageY));break;case 2:var t=a.touches[0].pageX-a.touches[1].pageX,e=a.touches[0].pageY-a.touches[1].pageY;w=N(t*t+e*e);var o=(a.touches[0].pageX+a.touches[1].pageX)/2,n=(a.touches[0].pageY+a.touches[1].pageY)/2;T.copy(I(o,n));break;default:h=p.NONE;}else switch(h){case 0:g.copy(f),f.copy(R(a.touches[0].pageX,a.touches[0].pageY));break;case 1:x.copy(I(a.touches[0].pageX,a.touches[0].pageY));break;case 2:T.copy(I(a.touches[0].pageX,a.touches[0].pageY));break;case 4:var t=a.touches[0].pageX-a.touches[1].pageX,e=a.touches[0].pageY-a.touches[1].pageY;w=N(t*t+e*e);break;case 5:var o=(a.touches[0].pageX+a.touches[1].pageX)/2,n=(a.touches[0].pageY+a.touches[1].pageY)/2;T.copy(I(o,n));break;case 99:var o=(a.touches[0].pageX+a.touches[1].pageX)/2,n=(a.touches[0].pageY+a.touches[1].pageY)/2;P.copy(I(o,n));break;default:h=p.NONE;}},!1),window.addEventListener("keydown",o,!1),window.addEventListener("keyup",function(){!1!==u.enabled&&(h=m,window.addEventListener("keydown",o,!1))},!1),c.handleResize(),c.update(),c}return r(t,a),t}(U.b);t.a=a},function(l,t,e){"use strict";function F(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function i(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))||"function"==typeof o)?o:a}function r(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var z=e(0),a=function(a){function t(e,r){function o(e){!1!==f.enabled&&(window.removeEventListener("keydown",o),x=v,v===y.NONE&&(e.keyCode!==f.keys[y.ROTATE]||f.noRotate?e.keyCode!==f.keys[y.ZOOM]||f.noZoom?e.keyCode!==f.keys[y.PAN]||f.noPan||(v=y.PAN):v=y.ZOOM:v=y.ROTATE))}function n(){!1!==f.enabled&&(v=x,window.addEventListener("keydown",o,!1))}function l(e){!1!==f.enabled&&(e.preventDefault(),e.stopPropagation(),v===y.NONE&&(v=e.button),(v!==y.ROTATE||f.noRotate)&&(v!==y.ZOOM||f.noZoom?v!==y.PAN||f.noPan||(P.copy(R(e.pageX,e.pageY)),A.copy(P)):(w.copy(R(e.pageX,e.pageY)),E.copy(w))),document.addEventListener("mousemove",s,!1),document.addEventListener("mouseup",c,!1),f.dispatchEvent(L))}function s(e){!1!==f.enabled&&(e.preventDefault(),e.stopPropagation(),(v!==y.ROTATE||f.noRotate)&&(v!==y.ZOOM||f.noZoom?v!==y.PAN||f.noPan||A.copy(R(e.pageX,e.pageY)):E.copy(R(e.pageX,e.pageY))))}function c(e){!1!==f.enabled&&(e.preventDefault(),e.stopPropagation(),v=y.NONE,document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",c),f.dispatchEvent(I))}function u(a){if(!1!==f.enabled){a.preventDefault(),a.stopPropagation();var t=0;a.wheelDelta?t=a.wheelDelta/40:a.detail&&(t=-a.detail/3),f.dispatchEvent({type:"OnScroll",delta:t}),f.dispatchEvent(L),f.dispatchEvent(I)}}function p(a){if(!1!==f.enabled){switch(a.touches.length){case 1:v=y.TOUCH_ROTATE;break;case 2:v=y.TOUCH_ZOOM_PAN;var t=a.touches[0].pageX-a.touches[1].pageX,e=a.touches[0].pageY-a.touches[1].pageY;M=T=N(t*t+e*e);var o=(a.touches[0].pageX+a.touches[1].pageX)/2,n=(a.touches[0].pageY+a.touches[1].pageY)/2;P.copy(R(o,n)),A.copy(P);break;default:v=y.NONE;}f.dispatchEvent(L)}}function d(a){if(!1!==f.enabled)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:break;case 2:var t=a.touches[0].pageX-a.touches[1].pageX,e=a.touches[0].pageY-a.touches[1].pageY;M=N(t*t+e*e);var o=(a.touches[0].pageX+a.touches[1].pageX)/2,n=(a.touches[0].pageY+a.touches[1].pageY)/2;A.copy(R(o,n));break;default:v=y.NONE;}}function h(a){if(!1!==f.enabled){switch(a.touches.length){case 1:break;case 2:T=M=0;var t=(a.touches[0].pageX+a.touches[1].pageX)/2,e=(a.touches[0].pageY+a.touches[1].pageY)/2;A.copy(R(t,e)),P.copy(A);}v=y.NONE,f.dispatchEvent(I)}}function m(e){e.preventDefault()}var _=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{NONE:-1,ROTATE:1,ZOOM:2,PAN:0,SCROLL:4,TOUCH_ROTATE:4,TOUCH_ZOOM_PAN:5};F(this,t);var g=i(this,a.call(this)),f=g,y=_;g.object=e,g.domElement=void 0===r?document:r,g.enabled=!0,g.screen={left:0,top:0,width:0,height:0},g.radius=0,g.zoomSpeed=1.2,g.noZoom=!1,g.noPan=!1,g.staticMoving=!1,g.dynamicDampingFactor=.2,g.keys=[65,83,68],g.target=new z.f;var b=!0,v=y.NONE,x=y.NONE,S=new z.f,w=new z.e,E=new z.e,T=0,M=0,P=new z.e,A=new z.e;g.target0=g.target.clone(),g.position0=g.object.position.clone(),g.up0=g.object.up.clone(),g.left0=g.object.left,g.right0=g.object.right,g.top0=g.object.top,g.bottom0=g.object.bottom;var C={type:"change"},L={type:"start"},I={type:"end"};g.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var a=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=a.left+window.pageXOffset-t.clientLeft,this.screen.top=a.top+window.pageYOffset-t.clientTop,this.screen.width=a.width,this.screen.height=a.height}this.radius=.5*U(this.screen.width,this.screen.height),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom},g.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var R=function(){var a=new z.e;return function(t,e){return a.set((t-f.screen.left)/f.screen.width,(e-f.screen.top)/f.screen.height),a}}();return g.zoomCamera=function(){if(v===y.TOUCH_ZOOM_PAN)e=M/T,T=M,f.object.zoom*=e,b=!0;else{var e=1+(E.y-w.y)*f.zoomSpeed;1e-6<B(e-1)&&0<e&&(f.object.zoom/=e,f.staticMoving?w.copy(E):w.y+=(E.y-w.y)*this.dynamicDampingFactor,b=!0)}},g.panCamera=function(){var a=new z.e,t=new z.f,e=new z.f;return function(){if(a.copy(A).sub(P),a.lengthSq()){var o=(f.object.right-f.object.left)/f.object.zoom,n=(f.object.top-f.object.bottom)/f.object.zoom;a.x*=o,a.y*=n,e.copy(S).cross(f.object.up).setLength(a.x),e.add(t.copy(f.object.up).setLength(a.y)),f.object.position.add(e),f.target.add(e),f.staticMoving?P.copy(A):P.add(a.subVectors(A,P).multiplyScalar(f.dynamicDampingFactor)),b=!0}}}(),g.update=function(){S.subVectors(f.object.position,f.target),f.noZoom||(f.zoomCamera(),b&&f.object.updateProjectionMatrix()),f.noPan||f.panCamera(),f.object.position.addVectors(f.target,S),f.object.lookAt(f.target),b&&(f.dispatchEvent(C),b=!1)},g.reset=function(){v=y.NONE,x=y.NONE,f.target.copy(f.target0),f.object.position.copy(f.position0),f.object.up.copy(f.up0),S.subVectors(f.object.position,f.target),f.object.left=f.left0,f.object.right=f.right0,f.object.top=f.top0,f.object.bottom=f.bottom0,f.object.lookAt(f.target),f.dispatchEvent(C),b=!1},g.dispose=function(){this.domElement.removeEventListener("contextmenu",m,!1),this.domElement.removeEventListener("mousedown",l,!1),this.domElement.removeEventListener("mousewheel",u,!1),this.domElement.removeEventListener("MozMousePixelScroll",u,!1),this.domElement.removeEventListener("touchstart",p,!1),this.domElement.removeEventListener("touchend",h,!1),this.domElement.removeEventListener("touchmove",d,!1),document.removeEventListener("mousemove",s,!1),document.removeEventListener("mouseup",c,!1),window.removeEventListener("keydown",o,!1),window.removeEventListener("keyup",n,!1)},g.domElement.addEventListener("contextmenu",m,!1),g.domElement.addEventListener("mousedown",l,!1),g.domElement.addEventListener("mousewheel",u,!1),g.domElement.addEventListener("MozMousePixelScroll",u,!1),g.domElement.addEventListener("touchstart",p,!1),g.domElement.addEventListener("touchend",h,!1),g.domElement.addEventListener("touchmove",d,!1),window.addEventListener("keydown",o,!1),window.addEventListener("keyup",n,!1),g.handleResize(),g.update(),g}return r(t,a),t}(z.b);t.a=a},function(l,t,e){"use strict";var n=e(30),i=e(9),r=e(14),o=e(3);e.d(t,"a",function(){return n.a}),e.d(t,"b",function(){return i.a}),e.d(t,"c",function(){return o.a}),e.d(t,"d",function(){return r.a})},function(a,t,e){"use strict";var o=e(31),n=e(32);e.d(t,"a",function(){return o.a}),e.d(t,"b",function(){return n.a})},function(m,t,e){"use strict";var n=e(33),i=e(34),r=e(99),o=e(100),a=e(101),s=e(102),l=e(41),c=e(103),_=e(42),u=e(107),p=e(108);e.d(t,"a",function(){return n.a}),e.d(t,"b",function(){return i.a}),e.d(t,"c",function(){return r.a}),e.d(t,"d",function(){return o.a}),e.d(t,"e",function(){return a.a}),e.d(t,"h",function(){return s.a}),e.d(t,"g",function(){return l.a}),e.d(t,"f",function(){return c.a}),e.d(t,"i",function(){return _.a}),e.d(t,"j",function(){return u.a}),e.d(t,"k",function(){return p.a})},function(d,t,e){"use strict";function p(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function i(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))||"function"==typeof o)?o:a}function r(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var u=e(35),a=e(36),s=e(37),o=function(){function a(a,o){for(var e=0,r;e<o.length;e++)r=o[e],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,r.key,r)}return function(t,e,o){return e&&a(t.prototype,e),o&&a(t,o),t}}(),n=function(l){function t(e,r,o){p(this,t);var n=i(this,l.call(this));return n._stack=e,n._textureToFilter=o,n._contourWidth=1,n._contourOpacity=1,n._canvasWidth=0,n._canvasHeight=0,n._shadersFragment=s.a,n._shadersVertex=a.a,n._uniforms=u.a.uniforms(),n._material=null,n._geometry=r,n._create(),n}return r(t,l),t.prototype._create=function(){this._prepareMaterial(),this._mesh=new THREE.Mesh(this._geometry,this._material),this._mesh.applyMatrix(this._stack._ijk2LPS),this.add(this._mesh)},t.prototype._prepareMaterial=function(){if(!this._material){this._uniforms.uWidth.value=this._contourWidth,this._uniforms.uOpacity.value=this._contourOpacity,this._uniforms.uCanvasWidth.value=this._canvasWidth,this._uniforms.uCanvasHeight.value=this._canvasHeight;var o=new s.a(this._uniforms),t=new a.a;this._material=new THREE.ShaderMaterial({side:THREE.DoubleSide,uniforms:this._uniforms,vertexShader:t.compute(),fragmentShader:o.compute(),transparent:!0})}},t.prototype.update=function(){this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh=null),this._create()},t.prototype.dispose=function(){null!==this._textureToFilter&&(this._textureToFilter.dispose(),this._textureToFilter=null),this._shadersFragment=null,this._shadersVertex=null,this._uniforms=null,this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh.material.dispose(),this._mesh.material=null,this._mesh=null,this._geometry.dispose(),this._geometry=null,this._material.vertexShader=null,this._material.fragmentShader=null,this._material.uniforms=null,this._material.dispose(),this._material=null,this._stack=null},o(t,[{key:"geometry",get:function(){return this._geometry},set:function(e){this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh=null,this._geometry.dispose(),this._geometry=null),this._geometry=e,this._create()}},{key:"textureToFilter",get:function(){return this._textureToFilter},set:function(e){this._textureToFilter=e,this._uniforms.uTextureFilled.value=e,this._material.needsUpdate=!0}},{key:"contourOpacity",get:function(){return this._contourOpacity},set:function(e){this._contourOpacity=e,this._uniforms.uOpacity.value=this._contourOpacity}},{key:"contourWidth",get:function(){return this._contourWidth},set:function(e){this._contourWidth=e,this._uniforms.uWidth.value=this._contourWidth}},{key:"canvasWidth",get:function(){return this._canvasWidth},set:function(e){this._canvasWidth=e,this._uniforms.uCanvasWidth.value=this._canvasWidth}},{key:"canvasHeight",get:function(){return this._canvasHeight},set:function(e){this._canvasHeight=e,this._uniforms.uCanvasHeight.value=this._canvasHeight}}]),t}(THREE.Object3D);t.a=n},function(d,t,e){"use strict";function p(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function i(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))||"function"==typeof o)?o:a}function r(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var u=e(38),a=e(39),s=e(40),o=function(){function a(a,o){for(var e=0,r;e<o.length;e++)r=o[e],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,r.key,r)}return function(t,e,o){return e&&a(t.prototype,e),o&&a(t,o),t}}(),n=function(l){function t(e,r,o){p(this,t);var n=i(this,l.call(this));return n._stack=e,n._referencePlane=o,n._plane1=null,n._color1=null,n._plane2=null,n._color2=null,n._plane3=null,n._color3=null,n._canvasWidth=0,n._canvasHeight=0,n._shadersFragment=s.a,n._shadersVertex=a.a,n._uniforms=u.a.uniforms(),n._material=null,n._geometry=r,n._create(),n}return r(t,l),t.prototype._create=function(){this._prepareMaterial(),this._mesh=new THREE.Mesh(this._geometry,this._material),this._mesh.applyMatrix(this._stack._ijk2LPS),this.add(this._mesh)},t.prototype._prepareMaterial=function(){if(!this._material){this._uniforms.uSlice.value=this._referencePlane,this._plane1&&(this._uniforms.uPlane1.value=this._plane1,this._uniforms.uPlaneColor1.value=this._color1),this._plane2&&(this._uniforms.uPlane2.value=this._plane2,this._uniforms.uPlaneColor2.value=this._color2),this._plane3&&(this._uniforms.uPlane3.value=this._plane3,this._uniforms.uPlaneColor3.value=this._color3),this._uniforms.uCanvasWidth.value=this._canvasWidth,this._uniforms.uCanvasHeight.value=this._canvasHeight;var o=new s.a(this._uniforms),t=new a.a;this._material=new THREE.ShaderMaterial({side:THREE.DoubleSide,uniforms:this._uniforms,vertexShader:t.compute(),fragmentShader:o.compute()}),this._material.transparent=!0}},t.prototype.update=function(){this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh=null),this._create()},t.prototype.dispose=function(){this._referencePlane=null,this._plane1=null,this._color1=null,this._plane2=null,this._color2=null,this._plane3=null,this._color3=null,this._shadersFragment=null,this._shadersVertex=null,this._uniforms=null,this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh.material.dispose(),this._mesh.material=null,this._mesh=null,this._geometry.dispose(),this._geometry=null,this._material.vertexShader=null,this._material.fragmentShader=null,this._material.uniforms=null,this._material.dispose(),this._material=null,this._stack=null},o(t,[{key:"geometry",get:function(){return this._geometry},set:function(e){this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh=null,this._geometry.dispose(),this._geometry=null),this._geometry=e,this._create()}},{key:"referencePlane",get:function(){return this._referencePlane},set:function(e){this._referencePlane=e,this._uniforms.uSlice.value=this._referencePlane}},{key:"plane1",get:function(){return this._plane1},set:function(e){this._plane1=e,this._uniforms.uPlane1.value=this._plane1}},{key:"color1",get:function(){return this._color1},set:function(e){this._color1=e,this._uniforms.uPlaneColor1.value=this._color1}},{key:"plane2",get:function(){return this._plane2},set:function(e){this._plane2=e,this._uniforms.uPlane2.value=this._plane2}},{key:"color2",get:function(){return this._color2},set:function(e){this._color2=e,this._uniforms.uPlaneColor2.value=this._color2}},{key:"plane3",get:function(){return this._plane3},set:function(e){this._plane3=e,this._uniforms.uPlane3.value=this._plane3}},{key:"color3",get:function(){return this._color3},set:function(e){this._color3=e,this._uniforms.uPlaneColor3.value=this._color3}},{key:"canvasWidth",get:function(){return this._canvasWidth},set:function(e){this._canvasWidth=e,this._uniforms.uCanvasWidth.value=this._canvasWidth}},{key:"canvasHeight",get:function(){return this._canvasHeight},set:function(e){this._canvasHeight=e,this._uniforms.uCanvasHeight.value=this._canvasHeight}}]),t}(THREE.Object3D);t.a=n},function(l,t,e){"use strict";function d(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}var i=e(3),r=function(){function a(a,o){for(var e=0,r;e<o.length;e++)r=o[e],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,r.key,r)}return function(t,e,o){return e&&a(t.prototype,e),o&&a(t,o),t}}(),o=function(){function p(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"default",a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"linear",r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[[0,0,0,0],[1,1,1,1]],l=4<arguments.length&&void 0!==arguments[4]?arguments[4]:[[0,0],[1,1]],s=5<arguments.length&&void 0!==arguments[5]&&arguments[5],c,n;d(this,p),this._dom=i.a.isString(t)?document.getElementById(t):t,this._discrete=s,this._color=r,this._lut=e,this._luts=(c={},c[e]=r,c),this._opacity=l,this._lutO=a,this._lutsO=(n={},n[a]=l,n),this.initCanvas(),this.paintCanvas()}return p.prototype.initCanvas=function(){this._canvasContainer=this.initCanvasContainer(this._dom),this._canvasBg=this.createCanvas(),this._canvasContainer.appendChild(this._canvasBg),this._canvas=this.createCanvas(),this._canvasContainer.appendChild(this._canvas)},p.prototype.initCanvasContainer=function(a){var t=a;return t.style.border="1px solid #F9F9F9",t},p.prototype.createCanvas=function(){var e=document.createElement("canvas");return e.height=1,e.width=256,e.style.width="256px",e.style.height="16px",e},p.prototype.paintCanvas=function(){var d=this._canvas.getContext("2d");if(d.clearRect(0,0,this._canvas.width,this._canvas.height),d.globalCompositeOperation="source-over",this._discrete){d.lineWidth=2*this._canvas.height;for(var t=0;t<this._color.length;t++){var e=this._color[t][0],n=1;t<this._color.length-1&&(n=this._color[t+1][0]);var i=0;0<t&&(i=this._color[t-1][0]);var r=i+(e-i)/2,o=e+(n-e)/2,a=this._color[t],s=this._opacity[t]?this._opacity[t][1]:1;d.beginPath(),d.strokeStyle="rgba( "+P(255*a[1])+", "+P(255*a[2])+", "+P(255*a[3])+", "+s+")",d.moveTo(r*this._canvas.width,0),d.lineTo(o*this._canvas.width,0),d.stroke(),d.closePath()}}else{for(var l=d.createLinearGradient(0,0,this._canvas.width,0),c=0;c<this._color.length;c++)l.addColorStop(this._color[c][0],"rgba( "+P(255*this._color[c][1])+", "+P(255*this._color[c][2])+", "+P(255*this._color[c][3])+", 1)");d.fillStyle=l,d.fillRect(0,0,this._canvas.width,this._canvas.height),d.globalCompositeOperation="destination-in";for(var m=d.createLinearGradient(0,0,this._canvas.width,0),u=0;u<this._opacity.length;u++)m.addColorStop(this._opacity[u][0],"rgba(255, 255, 255, "+this._opacity[u][1]+")");d.fillStyle=m,d.fillRect(0,0,this._canvas.width,this._canvas.height)}},p.prototype.lutsAvailable=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"color",t=[],e=this._luts;for(var o in"color"!==a&&(e=this._lutsO),e)t.push(o);return t},p.presetLuts=function(){return{default:[[0,0,0,0],[1,1,1,1]],spectrum:[[0,0,0,0],[0.1,0,0,1],[0.33,0,1,1],[0.5,0,1,0],[0.66,1,1,0],[0.9,1,0,0],[1,1,1,1]],hot_and_cold:[[0,0,0,1],[0.15,0,1,1],[0.3,0,1,0],[0.45,0,0,0],[0.5,0,0,0],[0.55,0,0,0],[0.7,1,1,0],[0.85,1,0,0],[1,1,1,1]],gold:[[0,0,0,0],[0.13,0.19,0.03,0],[0.25,0.39,0.12,0],[0.38,0.59,0.26,0],[0.5,0.8,0.46,0.08],[0.63,0.99,0.71,0.21],[0.75,0.99,0.88,0.34],[0.88,0.99,0.99,0.48],[1,0.9,0.95,0.61]],red:[[0,0.75,0,0],[0.5,1,0.5,0],[0.95,1,1,0],[1,1,1,1]],green:[[0,0,0.75,0],[0.5,0.5,1,0],[0.95,1,1,0],[1,1,1,1]],blue:[[0,0,0,1],[0.5,0,0.5,1],[0.95,0,1,1],[1,1,1,1]],walking_dead:[[0,0.1,1,1],[1,1,1,1]],random:[[0,0,0,0],[0.27,0.18,0.18,0.18],[0.41,1,1,1],[0.7,1,0,0],[1,1,1,1]],muscle_bone:[[0,0,0,0],[0.00392156862745098,0.00784313725490196,0,0],[0.00784313725490196,0.0196078431372549,0,0],[0.011764705882352941,0.03137254901960784,0,0],[0.01568627450980392,0.0392156862745098,0,0.00392156862745098],[0.0196078431372549,0.050980392156862744,0.00392156862745098,0.00392156862745098],[0.023529411764705882,0.06274509803921569,0.00392156862745098,0.00392156862745098],[0.027450980392156862,0.07058823529411765,0.00392156862745098,0.00784313725490196],[0.03137254901960784,0.08235294117647059,0.00392156862745098,0.00784313725490196],[0.03529411764705882,0.09411764705882353,0.00784313725490196,0.00784313725490196],[0.0392156862745098,0.10196078431372549,0.00784313725490196,0.00784313725490196],[0.043137254901960784,0.11372549019607843,0.00784313725490196,0.011764705882352941],[0.047058823529411764,0.12549019607843137,0.00784313725490196,0.011764705882352941],[0.050980392156862744,0.13333333333333333,0.011764705882352941,0.011764705882352941],[0.054901960784313725,0.1450980392156863,0.011764705882352941,0.01568627450980392],[0.058823529411764705,0.1568627450980392,0.011764705882352941,0.01568627450980392],[0.06274509803921569,0.16470588235294117,0.011764705882352941,0.01568627450980392],[0.06666666666666667,0.17647058823529413,0.011764705882352941,0.0196078431372549],[0.07058823529411765,0.18823529411764706,0.01568627450980392,0.0196078431372549],[0.07450980392156863,0.2,0.01568627450980392,0.0196078431372549],[0.0784313725490196,0.20784313725490197,0.01568627450980392,0.0196078431372549],[0.08235294117647059,0.2196078431372549,0.01568627450980392,0.023529411764705882],[0.08627450980392157,0.23137254901960785,0.0196078431372549,0.023529411764705882],[0.09019607843137255,0.23921568627450981,0.0196078431372549,0.023529411764705882],[0.09411764705882353,0.25098039215686274,0.0196078431372549,0.027450980392156862],[0.09803921568627451,0.2627450980392157,0.0196078431372549,0.027450980392156862],[0.10196078431372549,0.27058823529411763,0.023529411764705882,0.027450980392156862],[0.10588235294117647,0.2823529411764706,0.023529411764705882,0.027450980392156862],[0.10980392156862745,0.29411764705882354,0.023529411764705882,0.03137254901960784],[0.11372549019607843,0.30196078431372547,0.023529411764705882,0.03137254901960784],[0.11764705882352941,0.3137254901960784,0.023529411764705882,0.03137254901960784],[0.12156862745098039,0.3254901960784314,0.027450980392156862,0.03529411764705882],[0.12549019607843137,0.3333333333333333,0.027450980392156862,0.03529411764705882],[0.12941176470588237,0.34509803921568627,0.027450980392156862,0.03529411764705882],[0.13333333333333333,0.3568627450980392,0.027450980392156862,0.0392156862745098],[0.13725490196078433,0.36470588235294116,0.03137254901960784,0.0392156862745098],[0.1411764705882353,0.3764705882352941,0.03137254901960784,0.0392156862745098],[0.1450980392156863,0.38823529411764707,0.03137254901960784,0.0392156862745098],[0.14901960784313725,0.4,0.03137254901960784,0.043137254901960784],[0.15294117647058825,0.40784313725490196,0.03529411764705882,0.043137254901960784],[0.1568627450980392,0.4196078431372549,0.03529411764705882,0.043137254901960784],[0.1607843137254902,0.43137254901960786,0.03529411764705882,0.047058823529411764],[0.16470588235294117,0.4392156862745098,0.03529411764705882,0.047058823529411764],[0.16862745098039217,0.45098039215686275,0.03529411764705882,0.047058823529411764],[0.17254901960784313,0.4627450980392157,0.0392156862745098,0.047058823529411764],[0.17647058823529413,0.47058823529411764,0.0392156862745098,0.050980392156862744],[0.1803921568627451,0.4823529411764706,0.0392156862745098,0.050980392156862744],[0.1843137254901961,0.49411764705882355,0.0392156862745098,0.050980392156862744],[0.18823529411764706,0.5019607843137255,0.043137254901960784,0.054901960784313725],[0.19215686274509805,0.5137254901960784,0.043137254901960784,0.054901960784313725],[0.19607843137254902,0.5254901960784314,0.043137254901960784,0.054901960784313725],[0.2,0.5333333333333333,0.043137254901960784,0.058823529411764705],[0.20392156862745098,0.5450980392156862,0.047058823529411764,0.058823529411764705],[0.20784313725490197,0.5568627450980392,0.047058823529411764,0.058823529411764705],[0.21176470588235294,0.5647058823529412,0.047058823529411764,0.058823529411764705],[0.21568627450980393,0.5764705882352941,0.047058823529411764,0.06274509803921569],[0.2196078431372549,0.5882352941176471,0.047058823529411764,0.06274509803921569],[0.2235294117647059,0.6,0.050980392156862744,0.06274509803921569],[0.22745098039215686,0.6078431372549019,0.050980392156862744,0.06666666666666667],[0.23137254901960785,0.6196078431372549,0.050980392156862744,0.06666666666666667],[0.23529411764705882,0.6313725490196078,0.050980392156862744,0.06666666666666667],[0.23921568627450981,0.6392156862745098,0.054901960784313725,0.06666666666666667],[0.24313725490196078,0.6509803921568628,0.054901960784313725,0.07058823529411765],[0.24705882352941178,0.6627450980392157,0.054901960784313725,0.07058823529411765],[0.25098039215686274,0.6705882352941176,0.054901960784313725,0.07058823529411765],[0.2549019607843137,0.6823529411764706,0.058823529411764705,0.07450980392156863],[0.25882352941176473,0.6941176470588235,0.058823529411764705,0.07450980392156863],[0.2627450980392157,0.7019607843137254,0.058823529411764705,0.07450980392156863],[0.26666666666666666,0.7137254901960784,0.058823529411764705,0.0784313725490196],[0.27058823529411763,0.7254901960784313,0.058823529411764705,0.0784313725490196],[0.27450980392156865,0.7333333333333333,0.06274509803921569,0.0784313725490196],[0.2784313725490196,0.7450980392156863,0.06274509803921569,0.0784313725490196],[0.2823529411764706,0.7568627450980392,0.06274509803921569,0.08235294117647059],[0.28627450980392155,0.7647058823529411,0.06274509803921569,0.08235294117647059],[0.2901960784313726,0.7764705882352941,0.06666666666666667,0.08235294117647059],[0.29411764705882354,0.788235294117647,0.06666666666666667,0.08627450980392157],[0.2980392156862745,0.8,0.06666666666666667,0.08627450980392157],[0.30196078431372547,0.807843137254902,0.06666666666666667,0.08627450980392157],[0.3058823529411765,0.8196078431372549,0.07058823529411765,0.08627450980392157],[0.30980392156862746,0.8313725490196079,0.07058823529411765,0.09019607843137255],[0.3137254901960784,0.8392156862745098,0.07058823529411765,0.09019607843137255],[0.3176470588235294,0.8509803921568627,0.07058823529411765,0.09019607843137255],[0.3215686274509804,0.8627450980392157,0.07058823529411765,0.09411764705882353],[0.3254901960784314,0.8705882352941177,0.07450980392156863,0.09411764705882353],[0.32941176470588235,0.8823529411764706,0.07450980392156863,0.09411764705882353],[0.3333333333333333,0.8941176470588236,0.07450980392156863,0.09803921568627451],[0.33725490196078434,0.9019607843137255,0.07450980392156863,0.09803921568627451],[0.3411764705882353,0.9137254901960784,0.0784313725490196,0.09803921568627451],[0.34509803921568627,0.9254901960784314,0.0784313725490196,0.09803921568627451],[0.34901960784313724,0.9333333333333333,0.0784313725490196,0.10196078431372549],[0.35294117647058826,0.9450980392156862,0.0784313725490196,0.10196078431372549],[0.3568627450980392,0.9568627450980393,0.08235294117647059,0.10196078431372549],[0.3607843137254902,0.9647058823529412,0.08235294117647059,0.10588235294117647],[0.36470588235294116,0.9764705882352941,0.08235294117647059,0.10588235294117647],[0.3686274509803922,0.9882352941176471,0.08235294117647059,0.10588235294117647],[0.37254901960784315,1,0.08235294117647059,0.10588235294117647],[0.3764705882352941,1,0.09411764705882353,0.10588235294117647],[0.3803921568627451,1,0.10588235294117647,0.10588235294117647],[0.3843137254901961,1,0.11764705882352941,0.10196078431372549],[0.38823529411764707,1,0.12941176470588237,0.10196078431372549],[0.39215686274509803,1,0.1411764705882353,0.10196078431372549],[0.396078431372549,1,0.15294117647058825,0.09803921568627451],[0.4,1,0.16470588235294117,0.09803921568627451],[0.403921568627451,1,0.17647058823529413,0.09803921568627451],[0.40784313725490196,1,0.18823529411764706,0.09411764705882353],[0.4117647058823529,1,0.2,0.09411764705882353],[0.41568627450980394,1,0.21176470588235294,0.09411764705882353],[0.4196078431372549,1,0.2235294117647059,0.09019607843137255],[0.4235294117647059,1,0.23529411764705882,0.09019607843137255],[0.42745098039215684,1,0.24705882352941178,0.08627450980392157],[0.43137254901960786,1,0.25882352941176473,0.08627450980392157],[0.43529411764705883,1,0.27058823529411763,0.08627450980392157],[0.4392156862745098,1,0.2823529411764706,0.08235294117647059],[0.44313725490196076,1,0.29411764705882354,0.08235294117647059],[0.4470588235294118,1,0.3058823529411765,0.08235294117647059],[0.45098039215686275,1,0.3176470588235294,0.0784313725490196],[0.4549019607843137,1,0.32941176470588235,0.0784313725490196],[0.4588235294117647,1,0.3411764705882353,0.0784313725490196],[0.4627450980392157,1,0.35294117647058826,0.07450980392156863],[0.4666666666666667,1,0.36470588235294116,0.07450980392156863],[0.47058823529411764,1,0.3764705882352941,0.07450980392156863],[0.4745098039215686,1,0.38823529411764707,0.07058823529411765],[0.47843137254901963,1,0.4,0.07058823529411765],[0.4823529411764706,1,0.4117647058823529,0.07058823529411765],[0.48627450980392156,1,0.4235294117647059,0.06666666666666667],[0.49019607843137253,1,0.43529411764705883,0.06666666666666667],[0.49411764705882355,1,0.4470588235294118,0.06274509803921569],[0.4980392156862745,1,0.4588235294117647,0.06274509803921569],[0.5019607843137255,1,0.47058823529411764,0.06274509803921569],[0.5058823529411764,1,0.4823529411764706,0.058823529411764705],[0.5098039215686274,1,0.49411764705882355,0.058823529411764705],[0.5137254901960784,1,0.5058823529411764,0.058823529411764705],[0.5176470588235295,1,0.5137254901960784,0.054901960784313725],[0.5215686274509804,1,0.5254901960784314,0.054901960784313725],[0.5254901960784314,1,0.5372549019607843,0.054901960784313725],[0.5294117647058824,1,0.5490196078431373,0.050980392156862744],[0.5333333333333333,1,0.5607843137254902,0.050980392156862744],[0.5372549019607843,1,0.5725490196078431,0.050980392156862744],[0.5411764705882353,1,0.5843137254901961,0.047058823529411764],[0.5450980392156862,1,0.596078431372549,0.047058823529411764],[0.5490196078431373,1,0.6078431372549019,0.043137254901960784],[0.5529411764705883,1,0.6196078431372549,0.043137254901960784],[0.5568627450980392,1,0.6313725490196078,0.043137254901960784],[0.5607843137254902,1,0.6431372549019608,0.0392156862745098],[0.5647058823529412,1,0.6549019607843137,0.0392156862745098],[0.5686274509803921,1,0.6666666666666666,0.0392156862745098],[0.5725490196078431,1,0.6784313725490196,0.03529411764705882],[0.5764705882352941,1,0.6901960784313725,0.03529411764705882],[0.5803921568627451,1,0.6941176470588235,0.0392156862745098],[0.5843137254901961,1,0.7019607843137254,0.0392156862745098],[0.5882352941176471,1,0.7058823529411765,0.043137254901960784],[0.592156862745098,1,0.7098039215686275,0.043137254901960784],[0.596078431372549,1,0.7137254901960784,0.047058823529411764],[0.6,1,0.7176470588235294,0.047058823529411764],[0.6039215686274509,1,0.7254901960784313,0.050980392156862744],[0.6078431372549019,1,0.7294117647058823,0.050980392156862744],[0.611764705882353,1,0.7333333333333333,0.054901960784313725],[0.615686274509804,1,0.7372549019607844,0.058823529411764705],[0.6196078431372549,1,0.7411764705882353,0.058823529411764705],[0.6235294117647059,1,0.7490196078431373,0.06274509803921569],[0.6274509803921569,1,0.7529411764705882,0.06274509803921569],[0.6313725490196078,1,0.7568627450980392,0.06666666666666667],[0.6352941176470588,1,0.7607843137254902,0.06666666666666667],[0.6392156862745098,1,0.7647058823529411,0.07058823529411765],[0.6431372549019608,1,0.7725490196078432,0.07058823529411765],[0.6470588235294118,1,0.7764705882352941,0.07450980392156863],[0.6509803921568628,1,0.7803921568627451,0.07450980392156863],[0.6549019607843137,1,0.7843137254901961,0.0784313725490196],[0.6588235294117647,1,0.788235294117647,0.08235294117647059],[0.6627450980392157,1,0.796078431372549,0.08235294117647059],[0.6666666666666666,1,0.8,0.08627450980392157],[0.6705882352941176,1,0.803921568627451,0.08627450980392157],[0.6745098039215687,1,0.807843137254902,0.09019607843137255],[0.6784313725490196,1,0.8117647058823529,0.09019607843137255],[0.6823529411764706,1,0.8196078431372549,0.09411764705882353],[0.6862745098039216,1,0.8235294117647058,0.09411764705882353],[0.6901960784313725,1,0.8274509803921568,0.09803921568627451],[0.6941176470588235,1,0.8313725490196079,0.10196078431372549],[0.6980392156862745,1,0.8352941176470589,0.10196078431372549],[0.7019607843137254,1,0.8431372549019608,0.10588235294117647],[0.7058823529411765,1,0.8470588235294118,0.10588235294117647],[0.7098039215686275,1,0.8509803921568627,0.10980392156862745],[0.7137254901960784,1,0.8549019607843137,0.10980392156862745],[0.7176470588235294,1,0.8627450980392157,0.11372549019607843],[0.7215686274509804,1,0.8666666666666667,0.11372549019607843],[0.7254901960784313,1,0.8705882352941177,0.11764705882352941],[0.7294117647058823,1,0.8745098039215686,0.12156862745098039],[0.7333333333333333,1,0.8784313725490196,0.12156862745098039],[0.7372549019607844,1,0.8862745098039215,0.12549019607843137],[0.7411764705882353,1,0.8901960784313725,0.12549019607843137],[0.7450980392156863,1,0.8941176470588236,0.12941176470588237],[0.7490196078431373,1,0.8980392156862745,0.12941176470588237],[0.7529411764705882,1,0.9019607843137255,0.13333333333333333],[0.7568627450980392,1,0.9098039215686274,0.13333333333333333],[0.7607843137254902,1,0.9137254901960784,0.13725490196078433],[0.7647058823529411,1,0.9176470588235294,0.1411764705882353],[0.7686274509803922,1,0.9215686274509803,0.1411764705882353],[0.7725490196078432,1,0.9254901960784314,0.1450980392156863],[0.7764705882352941,1,0.9333333333333333,0.1450980392156863],[0.7803921568627451,1,0.9372549019607843,0.14901960784313725],[0.7843137254901961,1,0.9411764705882353,0.14901960784313725],[0.788235294117647,1,0.9450980392156862,0.15294117647058825],[0.792156862745098,1,0.9450980392156862,0.16862745098039217],[0.796078431372549,1,0.9490196078431372,0.1843137254901961],[0.8,1,0.9490196078431372,0.2],[0.803921568627451,1,0.9490196078431372,0.21568627450980393],[0.807843137254902,1,0.9490196078431372,0.22745098039215686],[0.8117647058823529,1,0.9529411764705882,0.24313725490196078],[0.8156862745098039,1,0.9529411764705882,0.25882352941176473],[0.8196078431372549,1,0.9529411764705882,0.27450980392156865],[0.8235294117647058,1,0.9529411764705882,0.2901960784313726],[0.8274509803921568,1,0.9568627450980393,0.3058823529411765],[0.8313725490196079,1,0.9568627450980393,0.3215686274509804],[0.8352941176470589,1,0.9568627450980393,0.33725490196078434],[0.8392156862745098,1,0.9568627450980393,0.35294117647058826],[0.8431372549019608,1,0.9607843137254902,0.3686274509803922],[0.8470588235294118,1,0.9607843137254902,0.3843137254901961],[0.8509803921568627,1,0.9607843137254902,0.4],[0.8549019607843137,1,0.9607843137254902,0.4117647058823529],[0.8588235294117647,1,0.9647058823529412,0.42745098039215684],[0.8627450980392157,1,0.9647058823529412,0.44313725490196076],[0.8666666666666667,1,0.9647058823529412,0.4588235294117647],[0.8705882352941177,1,0.9647058823529412,0.4745098039215686],[0.8745098039215686,1,0.9686274509803922,0.49019607843137253],[0.8784313725490196,1,0.9686274509803922,0.5058823529411764],[0.8823529411764706,1,0.9686274509803922,0.5215686274509804],[0.8862745098039215,1,0.9686274509803922,0.5372549019607843],[0.8901960784313725,1,0.9725490196078431,0.5529411764705883],[0.8941176470588236,1,0.9725490196078431,0.5686274509803921],[0.8980392156862745,1,0.9725490196078431,0.5843137254901961],[0.9019607843137255,1,0.9725490196078431,0.6],[0.9058823529411765,1,0.9725490196078431,0.611764705882353],[0.9098039215686274,1,0.9764705882352941,0.6274509803921569],[0.9137254901960784,1,0.9764705882352941,0.6431372549019608],[0.9176470588235294,1,0.9764705882352941,0.6588235294117647],[0.9215686274509803,1,0.9764705882352941,0.6745098039215687],[0.9254901960784314,1,0.9803921568627451,0.6901960784313725],[0.9294117647058824,1,0.9803921568627451,0.7058823529411765],[0.9333333333333333,1,0.9803921568627451,0.7215686274509804],[0.9372549019607843,1,0.9803921568627451,0.7372549019607844],[0.9411764705882353,1,0.984313725490196,0.7529411764705882],[0.9450980392156862,1,0.984313725490196,0.7686274509803922],[0.9490196078431372,1,0.984313725490196,0.7843137254901961],[0.9529411764705882,1,0.984313725490196,0.8],[0.9568627450980393,1,0.9882352941176471,0.8117647058823529],[0.9607843137254902,1,0.9882352941176471,0.8274509803921568],[0.9647058823529412,1,0.9882352941176471,0.8431372549019608],[0.9686274509803922,1,0.9882352941176471,0.8588235294117647],[0.9725490196078431,1,0.9921568627450981,0.8745098039215686],[0.9764705882352941,1,0.9921568627450981,0.8901960784313725],[0.9803921568627451,1,0.9921568627450981,0.9058823529411765],[0.984313725490196,1,0.9921568627450981,0.9215686274509803],[0.9882352941176471,1,0.996078431372549,0.9372549019607843],[0.9921568627450981,1,0.996078431372549,0.9529411764705882],[0.996078431372549,1,0.996078431372549,0.9686274509803922],[1,1,0.996078431372549,0.984313725490196]]}},p.presetLutsO=function(){return{linear:[[0,0],[1,1]],lowpass:[[0,0.8],[0.2,0.6],[0.3,0.1],[1,0]],bandpass:[[0,0],[0.4,0.8],[0.6,0.8],[1,0]],highpass:[[0,0],[0.7,0.1],[0.8,0.6],[1,0.8]],flat:[[0,0.7],[1,1]],random:[[0,0],[0.38,0],[0.55,1],[0.72,1],[1,0.05]],linear_full:[[0,0],[0.00392156862745098,0.00392156862745098],[0.00784313725490196,0.00784313725490196],[0.011764705882352941,0.011764705882352941],[0.01568627450980392,0.01568627450980392],[0.0196078431372549,0.0196078431372549],[0.023529411764705882,0.023529411764705882],[0.027450980392156862,0.027450980392156862],[0.03137254901960784,0.03137254901960784],[0.03529411764705882,0.03529411764705882],[0.0392156862745098,0.0392156862745098],[0.043137254901960784,0.043137254901960784],[0.047058823529411764,0.047058823529411764],[0.050980392156862744,0.050980392156862744],[0.054901960784313725,0.054901960784313725],[0.058823529411764705,0.058823529411764705],[0.06274509803921569,0.06274509803921569],[0.06666666666666667,0.06666666666666667],[0.07058823529411765,0.07058823529411765],[0.07450980392156863,0.07450980392156863],[0.0784313725490196,0.0784313725490196],[0.08235294117647059,0.08235294117647059],[0.08627450980392157,0.08627450980392157],[0.09019607843137255,0.09019607843137255],[0.09411764705882353,0.09411764705882353],[0.09803921568627451,0.09803921568627451],[0.10196078431372549,0.10196078431372549],[0.10588235294117647,0.10588235294117647],[0.10980392156862745,0.10980392156862745],[0.11372549019607843,0.11372549019607843],[0.11764705882352941,0.11764705882352941],[0.12156862745098039,0.12156862745098039],[0.12549019607843137,0.12549019607843137],[0.12941176470588237,0.12941176470588237],[0.13333333333333333,0.13333333333333333],[0.13725490196078433,0.13725490196078433],[0.1411764705882353,0.1411764705882353],[0.1450980392156863,0.1450980392156863],[0.14901960784313725,0.14901960784313725],[0.15294117647058825,0.15294117647058825],[0.1568627450980392,0.1568627450980392],[0.1607843137254902,0.1607843137254902],[0.16470588235294117,0.16470588235294117],[0.16862745098039217,0.16862745098039217],[0.17254901960784313,0.17254901960784313],[0.17647058823529413,0.17647058823529413],[0.1803921568627451,0.1803921568627451],[0.1843137254901961,0.1843137254901961],[0.18823529411764706,0.18823529411764706],[0.19215686274509805,0.19215686274509805],[0.19607843137254902,0.19607843137254902],[0.2,0.2],[0.20392156862745098,0.20392156862745098],[0.20784313725490197,0.20784313725490197],[0.21176470588235294,0.21176470588235294],[0.21568627450980393,0.21568627450980393],[0.2196078431372549,0.2196078431372549],[0.2235294117647059,0.2235294117647059],[0.22745098039215686,0.22745098039215686],[0.23137254901960785,0.23137254901960785],[0.23529411764705882,0.23529411764705882],[0.23921568627450981,0.23921568627450981],[0.24313725490196078,0.24313725490196078],[0.24705882352941178,0.24705882352941178],[0.25098039215686274,0.25098039215686274],[0.2549019607843137,0.2549019607843137],[0.25882352941176473,0.25882352941176473],[0.2627450980392157,0.2627450980392157],[0.26666666666666666,0.26666666666666666],[0.27058823529411763,0.27058823529411763],[0.27450980392156865,0.27450980392156865],[0.2784313725490196,0.2784313725490196],[0.2823529411764706,0.2823529411764706],[0.28627450980392155,0.28627450980392155],[0.2901960784313726,0.2901960784313726],[0.29411764705882354,0.29411764705882354],[0.2980392156862745,0.2980392156862745],[0.30196078431372547,0.30196078431372547],[0.3058823529411765,0.3058823529411765],[0.30980392156862746,0.30980392156862746],[0.3137254901960784,0.3137254901960784],[0.3176470588235294,0.3176470588235294],[0.3215686274509804,0.3215686274509804],[0.3254901960784314,0.3254901960784314],[0.32941176470588235,0.32941176470588235],[0.3333333333333333,0.3333333333333333],[0.33725490196078434,0.33725490196078434],[0.3411764705882353,0.3411764705882353],[0.34509803921568627,0.34509803921568627],[0.34901960784313724,0.34901960784313724],[0.35294117647058826,0.35294117647058826],[0.3568627450980392,0.3568627450980392],[0.3607843137254902,0.3607843137254902],[0.36470588235294116,0.36470588235294116],[0.3686274509803922,0.3686274509803922],[0.37254901960784315,0.37254901960784315],[0.3764705882352941,0.3764705882352941],[0.3803921568627451,0.3803921568627451],[0.3843137254901961,0.3843137254901961],[0.38823529411764707,0.38823529411764707],[0.39215686274509803,0.39215686274509803],[0.396078431372549,0.396078431372549],[0.4,0.4],[0.403921568627451,0.403921568627451],[0.40784313725490196,0.40784313725490196],[0.4117647058823529,0.4117647058823529],[0.41568627450980394,0.41568627450980394],[0.4196078431372549,0.4196078431372549],[0.4235294117647059,0.4235294117647059],[0.42745098039215684,0.42745098039215684],[0.43137254901960786,0.43137254901960786],[0.43529411764705883,0.43529411764705883],[0.4392156862745098,0.4392156862745098],[0.44313725490196076,0.44313725490196076],[0.4470588235294118,0.4470588235294118],[0.45098039215686275,0.45098039215686275],[0.4549019607843137,0.4549019607843137],[0.4588235294117647,0.4588235294117647],[0.4627450980392157,0.4627450980392157],[0.4666666666666667,0.4666666666666667],[0.47058823529411764,0.47058823529411764],[0.4745098039215686,0.4745098039215686],[0.47843137254901963,0.47843137254901963],[0.4823529411764706,0.4823529411764706],[0.48627450980392156,0.48627450980392156],[0.49019607843137253,0.49019607843137253],[0.49411764705882355,0.49411764705882355],[0.4980392156862745,0.4980392156862745],[0.5019607843137255,0.5019607843137255],[0.5058823529411764,0.5058823529411764],[0.5098039215686274,0.5098039215686274],[0.5137254901960784,0.5137254901960784],[0.5176470588235295,0.5176470588235295],[0.5215686274509804,0.5215686274509804],[0.5254901960784314,0.5254901960784314],[0.5294117647058824,0.5294117647058824],[0.5333333333333333,0.5333333333333333],[0.5372549019607843,0.5372549019607843],[0.5411764705882353,0.5411764705882353],[0.5450980392156862,0.5450980392156862],[0.5490196078431373,0.5490196078431373],[0.5529411764705883,0.5529411764705883],[0.5568627450980392,0.5568627450980392],[0.5607843137254902,0.5607843137254902],[0.5647058823529412,0.5647058823529412],[0.5686274509803921,0.5686274509803921],[0.5725490196078431,0.5725490196078431],[0.5764705882352941,0.5764705882352941],[0.5803921568627451,0.5803921568627451],[0.5843137254901961,0.5843137254901961],[0.5882352941176471,0.5882352941176471],[0.592156862745098,0.592156862745098],[0.596078431372549,0.596078431372549],[0.6,0.6],[0.6039215686274509,0.6039215686274509],[0.6078431372549019,0.6078431372549019],[0.611764705882353,0.611764705882353],[0.615686274509804,0.615686274509804],[0.6196078431372549,0.6196078431372549],[0.6235294117647059,0.6235294117647059],[0.6274509803921569,0.6274509803921569],[0.6313725490196078,0.6313725490196078],[0.6352941176470588,0.6352941176470588],[0.6392156862745098,0.6392156862745098],[0.6431372549019608,0.6431372549019608],[0.6470588235294118,0.6470588235294118],[0.6509803921568628,0.6509803921568628],[0.6549019607843137,0.6549019607843137],[0.6588235294117647,0.6588235294117647],[0.6627450980392157,0.6627450980392157],[0.6666666666666666,0.6666666666666666],[0.6705882352941176,0.6705882352941176],[0.6745098039215687,0.6745098039215687],[0.6784313725490196,0.6784313725490196],[0.6823529411764706,0.6823529411764706],[0.6862745098039216,0.6862745098039216],[0.6901960784313725,0.6901960784313725],[0.6941176470588235,0.6941176470588235],[0.6980392156862745,0.6980392156862745],[0.7019607843137254,0.7019607843137254],[0.7058823529411765,0.7058823529411765],[0.7098039215686275,0.7098039215686275],[0.7137254901960784,0.7137254901960784],[0.7176470588235294,0.7176470588235294],[0.7215686274509804,0.7215686274509804],[0.7254901960784313,0.7254901960784313],[0.7294117647058823,0.7294117647058823],[0.7333333333333333,0.7333333333333333],[0.7372549019607844,0.7372549019607844],[0.7411764705882353,0.7411764705882353],[0.7450980392156863,0.7450980392156863],[0.7490196078431373,0.7490196078431373],[0.7529411764705882,0.7529411764705882],[0.7568627450980392,0.7568627450980392],[0.7607843137254902,0.7607843137254902],[0.7647058823529411,0.7647058823529411],[0.7686274509803922,0.7686274509803922],[0.7725490196078432,0.7725490196078432],[0.7764705882352941,0.7764705882352941],[0.7803921568627451,0.7803921568627451],[0.7843137254901961,0.7843137254901961],[0.788235294117647,0.788235294117647],[0.792156862745098,0.792156862745098],[0.796078431372549,0.796078431372549],[0.8,0.8],[0.803921568627451,0.803921568627451],[0.807843137254902,0.807843137254902],[0.8117647058823529,0.8117647058823529],[0.8156862745098039,0.8156862745098039],[0.8196078431372549,0.8196078431372549],[0.8235294117647058,0.8235294117647058],[0.8274509803921568,0.8274509803921568],[0.8313725490196079,0.8313725490196079],[0.8352941176470589,0.8352941176470589],[0.8392156862745098,0.8392156862745098],[0.8431372549019608,0.8431372549019608],[0.8470588235294118,0.8470588235294118],[0.8509803921568627,0.8509803921568627],[0.8549019607843137,0.8549019607843137],[0.8588235294117647,0.8588235294117647],[0.8627450980392157,0.8627450980392157],[0.8666666666666667,0.8666666666666667],[0.8705882352941177,0.8705882352941177],[0.8745098039215686,0.8745098039215686],[0.8784313725490196,0.8784313725490196],[0.8823529411764706,0.8823529411764706],[0.8862745098039215,0.8862745098039215],[0.8901960784313725,0.8901960784313725],[0.8941176470588236,0.8941176470588236],[0.8980392156862745,0.8980392156862745],[0.9019607843137255,0.9019607843137255],[0.9058823529411765,0.9058823529411765],[0.9098039215686274,0.9098039215686274],[0.9137254901960784,0.9137254901960784],[0.9176470588235294,0.9176470588235294],[0.9215686274509803,0.9215686274509803],[0.9254901960784314,0.9254901960784314],[0.9294117647058824,0.9294117647058824],[0.9333333333333333,0.9333333333333333],[0.9372549019607843,0.9372549019607843],[0.9411764705882353,0.9411764705882353],[0.9450980392156862,0.9450980392156862],[0.9490196078431372,0.9490196078431372],[0.9529411764705882,0.9529411764705882],[0.9568627450980393,0.9568627450980393],[0.9607843137254902,0.9607843137254902],[0.9647058823529412,0.9647058823529412],[0.9686274509803922,0.9686274509803922],[0.9725490196078431,0.9725490196078431],[0.9764705882352941,0.9764705882352941],[0.9803921568627451,0.9803921568627451],[0.984313725490196,0.984313725490196],[0.9882352941176471,0.9882352941176471],[0.9921568627450981,0.9921568627450981],[0.996078431372549,0.996078431372549],[1,1]]}},r(p,[{key:"texture",get:function(){var e=new THREE.Texture(this._canvas);return e.mapping=THREE.UVMapping,e.wrapS=e.wrapT=THREE.ClampToEdgeWrapping,e.magFilter=e.minFilter=THREE.NearestFilter,e.premultiplyAlpha=!0,e.needsUpdate=!0,e}},{key:"lut",set:function(e){this._color=this._luts[e],this._lut=e,this.paintCanvas()},get:function(){return this._lut}},{key:"luts",set:function(e){this._luts=e},get:function(){return this._luts}},{key:"lutO",set:function(e){this._opacity=this._lutsO[e],this._lutO=e,this.paintCanvas()},get:function(){return this._lutO}},{key:"lutsO",set:function(e){this._lutsO=e},get:function(){return this._lutsO}},{key:"discrete",set:function(e){this._discrete=e,this.paintCanvas()},get:function(){return this._discrete}}]),p}();t.a=o},function(l,t,e){"use strict";function c(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}var i=e(3),r=function(){function a(a,o){for(var e=0,r;e<o.length;e++)r=o[e],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,r.key,r)}return function(t,e,o){return e&&a(t.prototype,e),o&&a(t,o),t}}(),o={0:{color:[0,0,0],opacity:0,label:"background"},1:{color:[255,0,0],opacity:1,label:"white matter"}},a=function(){function a(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:o;c(this,a),this._dom=i.a.isString(t)?document.getElementById(t):t,this._segmentation=e,this.initCanvas(),this.paintCanvas()}return a.prototype.initCanvas=function(){this._canvasContainer=this.initCanvasContainer(this._dom),this._canvasBg=this.createCanvas(),this._canvasContainer.appendChild(this._canvasBg),this._canvas=this.createCanvas(),this._canvasContainer.appendChild(this._canvas)},a.prototype.initCanvasContainer=function(a){var t=a;return t.style.width="256 px",t.style.height="128 px",t.style.border="1px solid #F9F9F9",t},a.prototype.createCanvas=function(){var e=document.createElement("canvas");return e.height=128,e.width=256,e},a.prototype.paintCanvas=function(){var a=this._canvas.getContext("2d");for(var t in a.clearRect(0,0,this._canvas.width,this._canvas.height),a.globalCompositeOperation="source-over",a.lineWidth=1,this._segmentation){var e=t%this._canvas.width,n=z(t/this._canvas.width),i=void 0===this._segmentation[t].opacity?1:this._segmentation[t].opacity,r=this._segmentation[t].color;a.fillStyle="rgba( "+P(r[0])+", "+P(r[1])+", "+P(r[2])+", "+i+")",a.fillRect(e,n,1,1)}},r(a,[{key:"texture",get:function(){var e=new THREE.Texture(this._canvas);return e.mapping=THREE.UVMapping,e.wrapS=e.wrapT=THREE.ClampToEdgeWrapping,e.magFilter=e.minFilter=THREE.NearestFilter,e.premultiplyAlpha=!0,e.needsUpdate=!0,e}},{key:"segmentation",set:function(e){this._segmentation=e,this.paintCanvas()},get:function(){return this._segmentation}}]),a}();t.a=a},function(a,t,e){"use strict";function l(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}var i=e(3),r=function(){function a(t,e){l(this,a),t&&this._isFunction(t.emit)?(this._dom=i.a.isString(e)?document.getElementById(e):e,i.a.isElement(this._dom)?(this._emitter=t,this.initContainerDom(),this.initEventListenner(),this.loaded=0,this.totalFile=0):window.console.error("please give the id of container dom or directly a dom instance")):window.console.error("please give the this._emitter instance")}return a.prototype._isFunction=function(e){return"[object Function]"===Object.prototype.toString.call(e)},a.prototype.initEventListenner=function(){var a=this;this._emitter.on("load-start",function(t){var e=t.totalFiles;a.totalFile=e,a._domTotalFile.innerHTML=e}),this._emitter.on("fetch-start",function(t){var e=document.createElement("li"),o=document.createElement("div");o.innerHTML="file: "+t.file,o.style.color="#ffffff",e.append(o),e.className="fetch-file",e.id="file-"+t.file,e.style.marginBottom="7px",e.style.border="1px solid #ffffff;",e.style.width="60%";var n=document.createElement("div");n.id="file-fetch-"+t.file,n.style.width="0%",e.append(n),a._domProcessList.append(e)}),this._emitter.on("fetch-progress",function(a){var t="file-fetch-"+a.file,e=document.getElementById(t);e.style.width=100*(a.loaded/a.total)+"%",e.style.border="1px solid red"}),this._emitter.on("fetch-success",function(a){var t=document.getElementById("file-"+a.file),e=document.createElement("div");e.id="file-result-"+a.file,e.innerHTML="fetch-success",e.style.color="#ffffff",t.append(e)}),this._emitter.on("fetch-error",function(){}),this._emitter.on("fetch-abort",function(){}),this._emitter.on("fetch-end",function(){}),this._emitter.on("fetch-timeout",function(){}),this._emitter.on("parse-start",function(a){var t=document.getElementById("file-"+a.file),e=document.createElement("div");e.id="file-parse-"+a.file,e.style.width="0%",t.append(e)}),this._emitter.on("parsing",function(a){var t="file-parse-"+a.file,e=document.getElementById(t);e.style.width=100*(a.parsed/a.total)+"%",e.style.border="1px solid yellow"}),this._emitter.on("parse-success",function(t){a.loaded+=1,a._domCurrentFile.innerHTML=a.loaded,a._domCurrentProgress.style.width=100*(a.loaded/a.totalFile)+"%";var e=document.getElementById("file-"+t.file),o=document.createElement("div");o.id="file-result-"+t.file,o.innerHTML="parse-success",o.style.color="#ffffff",e.append(o)})},a.prototype.initContainerDom=function(){var e=document.createElement("div");e.innerHTML="\n      <div id=\"ami-progress-bar-container\" style=\"background-color: rgb(33, 33, 33); color: #ffffff;\">\n      <div>\n      <label for=\"progress-bar\" id=\"progress-label\" style=\"width: 60%; border: 1px solid #ffffff; text-align: center;\">\n      <span id=\"current-file-index\">0</span>\n      <span id=\"total-file\">0</span>\n      </label>\n      <div id=\"progress-bar\" style=\"width: 60%; border: 1px solid #ffffff; text-align: center;\">\n      <div id=\"current-progress\" style=\"border: 1px solid red; width: 0%;\"></div>\n      </div>\n      </div>\n      <ul id=\"process-list\" style=\"list-style-type: none; padding: 0; overflow-y: auto;\">\n      </ul>\n      </div>",this._dom.append(e),this._domCurrentFile=document.getElementById("current-file-index"),this._domTotalFile=document.getElementById("total-file"),this._domProcessList=document.getElementById("process-list"),this._domCurrentProgress=document.getElementById("current-progress")},a}();t.a=r},function(l,t,e){"use strict";function s(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function i(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))||"function"==typeof o)?o:a}function r(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var o=function(a){function t(){s(this,t);var e=i(this,a.call(this));return e.name="unpack",e._packedData="packedData",e._offset="offset",e._unpackedData="unpackedData",e._base._uniforms={uNumberOfChannels:{value:1},uBitsAllocated:{value:16},uPixelType:{value:0}},e}return r(t,a),t.prototype.api=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._base,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this._packedData,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this._offset,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:this._unpackedData;return this._base=a,this.compute(t,e,o)},t.prototype.compute=function(a,t,e){return this.computeDefinition(),this._base._functions[this._name]=this._definition,this._name+"("+a+", "+t+", "+e+");"},t.prototype.computeDefinition=function(){var e="";if(1===this._base._uniforms.uNumberOfChannels.value)switch(this._base._uniforms.uBitsAllocated.value){case 1:case 8:e=this.upack8();break;case 16:e=this.upack16();break;case 32:e=this.upack32();break;default:e=this.upackIdentity();}else e=this.upackIdentity();this._definition="\nvoid "+this._name+"(in vec4 packedData, in int offset, out vec4 unpackedData){\n\n"+e+"\n\n}  \n    "},t.prototype.upack8=function(){return this._base._functions.uInt8=this.uInt8(),"\nuInt8(\n  packedData.r,\n  unpackedData.x);\n    "},t.prototype.upack16=function(){return this._base._functions.uInt16=this.uInt16(),"\nuInt16(\n  packedData.r * float( 1 - offset) + packedData.b * float(offset),\n  packedData.g * float( 1 - offset) + packedData.a * float(offset),\n  unpackedData.x);\n    "},t.prototype.upack32=function(){return 0===this._base._uniforms.uPixelType.value?(this._base._functions.uInt32=this.uInt32(),"\nuInt32(\n  packedData.r,\n  packedData.g,\n  packedData.b,\n  packedData.a,\n  unpackedData.x);\n      "):(this._base._functions.uFloat32=this.uFloat32(),"\nuFloat32(\n  packedData.r,\n  packedData.g,\n  packedData.b,\n  packedData.a,\n  unpackedData.x);\n      ")},t.prototype.upackIdentity=function(){return"\nunpackedData = packedData;\n      "},t.prototype.uInt8=function(){return"\nvoid uInt8(in float r, out float value){\n  value = r * 255.;\n}\n    "},t.prototype.uInt16=function(){return"\nvoid uInt16(in float r, in float a, out float value){\n  value = r * 255. + a * 255. * 256.;\n}\n    "},t.prototype.uInt32=function(){return"\nvoid uInt32(in float r, in float g, in float b, in float a, out float value){\n  value = r * 255. + g * 255. * 256. + b * 255. * 256. * 256. + a * 255. * 256. * 256. * 256.;\n  // value = r * 255. + g * 65025. + b * 16581375. + a * 4228250625.;\n}\n    "},t.prototype.uFloat32=function(){return"\nvoid uFloat32(in float r, in float g, in float b, in float a, out float value){\n\n  // create arrays containing bits for rgba values\n  // value between 0 and 255\n  value = r * 255.;\n  int bytemeR[8];\n  bytemeR[0] = int(floor(value / 128.));\n  value -= float(bytemeR[0] * 128);\n  bytemeR[1] = int(floor(value / 64.));\n  value -= float(bytemeR[1] * 64);\n  bytemeR[2] = int(floor(value / 32.));\n  value -= float(bytemeR[2] * 32);\n  bytemeR[3] = int(floor(value / 16.));\n  value -= float(bytemeR[3] * 16);\n  bytemeR[4] = int(floor(value / 8.));\n  value -= float(bytemeR[4] * 8);\n  bytemeR[5] = int(floor(value / 4.));\n  value -= float(bytemeR[5] * 4);\n  bytemeR[6] = int(floor(value / 2.));\n  value -= float(bytemeR[6] * 2);\n  bytemeR[7] = int(floor(value));\n\n  value = g * 255.;\n  int bytemeG[8];\n  bytemeG[0] = int(floor(value / 128.));\n  value -= float(bytemeG[0] * 128);\n  bytemeG[1] = int(floor(value / 64.));\n  value -= float(bytemeG[1] * 64);\n  bytemeG[2] = int(floor(value / 32.));\n  value -= float(bytemeG[2] * 32);\n  bytemeG[3] = int(floor(value / 16.));\n  value -= float(bytemeG[3] * 16);\n  bytemeG[4] = int(floor(value / 8.));\n  value -= float(bytemeG[4] * 8);\n  bytemeG[5] = int(floor(value / 4.));\n  value -= float(bytemeG[5] * 4);\n  bytemeG[6] = int(floor(value / 2.));\n  value -= float(bytemeG[6] * 2);\n  bytemeG[7] = int(floor(value));\n\n  value = b * 255.;\n  int bytemeB[8];\n  bytemeB[0] = int(floor(value / 128.));\n  value -= float(bytemeB[0] * 128);\n  bytemeB[1] = int(floor(value / 64.));\n  value -= float(bytemeB[1] * 64);\n  bytemeB[2] = int(floor(value / 32.));\n  value -= float(bytemeB[2] * 32);\n  bytemeB[3] = int(floor(value / 16.));\n  value -= float(bytemeB[3] * 16);\n  bytemeB[4] = int(floor(value / 8.));\n  value -= float(bytemeB[4] * 8);\n  bytemeB[5] = int(floor(value / 4.));\n  value -= float(bytemeB[5] * 4);\n  bytemeB[6] = int(floor(value / 2.));\n  value -= float(bytemeB[6] * 2);\n  bytemeB[7] = int(floor(value));\n\n  value = a * 255.;\n  int bytemeA[8];\n  bytemeA[0] = int(floor(value / 128.));\n  value -= float(bytemeA[0] * 128);\n  bytemeA[1] = int(floor(value / 64.));\n  value -= float(bytemeA[1] * 64);\n  bytemeA[2] = int(floor(value / 32.));\n  value -= float(bytemeA[2] * 32);\n  bytemeA[3] = int(floor(value / 16.));\n  value -= float(bytemeA[3] * 16);\n  bytemeA[4] = int(floor(value / 8.));\n  value -= float(bytemeA[4] * 8);\n  bytemeA[5] = int(floor(value / 4.));\n  value -= float(bytemeA[5] * 4);\n  bytemeA[6] = int(floor(value / 2.));\n  value -= float(bytemeA[6] * 2);\n  bytemeA[7] = int(floor(value));\n\n  // compute float32 value from bit arrays\n\n  // sign\n  int issigned = 1 - 2 * bytemeR[0];\n  //   issigned = int(pow(-1., float(bytemeR[0])));\n\n  // exponent\n  int exponent = 0;\n\n  exponent += bytemeR[1] * int(pow(2., 7.));\n  exponent += bytemeR[2] * int(pow(2., 6.));\n  exponent += bytemeR[3] * int(pow(2., 5.));\n  exponent += bytemeR[4] * int(pow(2., 4.));\n  exponent += bytemeR[5] * int(pow(2., 3.));\n  exponent += bytemeR[6] * int(pow(2., 2.));\n  exponent += bytemeR[7] * int(pow(2., 1.));\n\n  exponent += bytemeG[0];\n\n\n  // fraction\n  float fraction = 0.;\n\n  fraction = float(bytemeG[1]) * pow(2., -1.);\n  fraction += float(bytemeG[2]) * pow(2., -2.);\n  fraction += float(bytemeG[3]) * pow(2., -3.);\n  fraction += float(bytemeG[4]) * pow(2., -4.);\n  fraction += float(bytemeG[5]) * pow(2., -5.);\n  fraction += float(bytemeG[6]) * pow(2., -6.);\n  fraction += float(bytemeG[7]) * pow(2., -7.);\n\n  fraction += float(bytemeB[0]) * pow(2., -8.);\n  fraction += float(bytemeB[1]) * pow(2., -9.);\n  fraction += float(bytemeB[2]) * pow(2., -10.);\n  fraction += float(bytemeB[3]) * pow(2., -11.);\n  fraction += float(bytemeB[4]) * pow(2., -12.);\n  fraction += float(bytemeB[5]) * pow(2., -13.);\n  fraction += float(bytemeB[6]) * pow(2., -14.);\n  fraction += float(bytemeB[7]) * pow(2., -15.);\n\n  fraction += float(bytemeA[0]) * pow(2., -16.);\n  fraction += float(bytemeA[1]) * pow(2., -17.);\n  fraction += float(bytemeA[2]) * pow(2., -18.);\n  fraction += float(bytemeA[3]) * pow(2., -19.);\n  fraction += float(bytemeA[4]) * pow(2., -20.);\n  fraction += float(bytemeA[5]) * pow(2., -21.);\n  fraction += float(bytemeA[6]) * pow(2., -22.);\n  fraction += float(bytemeA[7]) * pow(2., -23.);\n\n  value = float(issigned) * pow( 2., float(exponent - 127)) * (1. + fraction);\n}\n    "},t}(e(10).a);t.a=new o},function(l,t,e){"use strict";function s(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function i(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))||"function"==typeof o)?o:a}function r(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var o=function(a){function t(){s(this,t);var e=i(this,a.call(this));return e.name="texture3d",e._dataCoordinates="dataCoordinates",e._dataValue="dataValue",e._offset="offset",e}return r(t,a),t.prototype.api=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._base,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this._dataCoordinates,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this._dataValue,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:this._offset;return this._base=a,this.compute(t,e,o)},t.prototype.compute=function(a,t,e){return this.computeDefinition(),this._base._functions[this._name]=this._definition,this._name+"("+a+", "+t+", "+e+");"},t.prototype.computeDefinition=function(){this._definition="\nvoid "+this._name+"(in ivec3 dataCoordinates, out vec4 dataValue, out int offset){\n    \n  int index = dataCoordinates.x\n            + dataCoordinates.y * uDataDimensions.x\n            + dataCoordinates.z * uDataDimensions.y * uDataDimensions.x;\n  int indexP = int(index/uPackedPerPixel);\n  offset = index - 2*indexP;\n\n  // Map data index to right sampler2D texture\n  int voxelsPerTexture = uTextureSize*uTextureSize;\n  int textureIndex = int(floor(float(indexP) / float(voxelsPerTexture)));\n  // modulo seems incorrect sometimes...\n  // int inTextureIndex = int(mod(float(index), float(textureSize*textureSize)));\n  int inTextureIndex = indexP - voxelsPerTexture*textureIndex;\n\n  // Get row and column in the texture\n  int colIndex = int(mod(float(inTextureIndex), float(uTextureSize)));\n  int rowIndex = int(floor(float(inTextureIndex)/float(uTextureSize)));\n\n  // Map row and column to uv\n  vec2 uv = vec2(0,0);\n  uv.x = (0.5 + float(colIndex)) / float(uTextureSize);\n  uv.y = 1. - (0.5 + float(rowIndex)) / float(uTextureSize);\n\n  //\n  if(textureIndex == 0){ dataValue = texture2D(uTextureContainer[0], uv); }\n  else if(textureIndex == 1){dataValue = texture2D(uTextureContainer[1], uv);}\n  else if(textureIndex == 2){ dataValue = texture2D(uTextureContainer[2], uv); }\n  else if(textureIndex == 3){ dataValue = texture2D(uTextureContainer[3], uv); }\n  else if(textureIndex == 4){ dataValue = texture2D(uTextureContainer[4], uv); }\n  else if(textureIndex == 5){ dataValue = texture2D(uTextureContainer[5], uv); }\n  else if(textureIndex == 6){ dataValue = texture2D(uTextureContainer[6], uv); }\n  else {\n    dataValue = vec4(0.);\n  }\n\n}\n    "},t}(e(10).a);t.a=new o},function(c,t,e){"use strict";function d(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function i(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))||"function"==typeof o)?o:a}function r(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var o=e(10),a=e(47),n=function(o){function t(){d(this,t);var e=i(this,o.call(this));return e.name="interpolationTrilinear",e._currentVoxel="currentVoxel",e._dataValue="dataValue",e._gradient="gradient",e}return r(t,o),t.prototype.api=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._base,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this._currentVoxel,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this._dataValue,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:this._gradient;return this._base=a,this.compute(t,e,o)},t.prototype.compute=function(a,t,e){return this.computeDefinition(),this._base._functions[this._name]=this._definition,this._name+"("+a+", "+t+", "+e+");"},t.prototype.computeDefinition=function(){this._definition="\nvoid trilinearInterpolation(\n  in vec3 normalizedPosition,\n  out vec4 interpolatedValue,\n  in vec4 v000, in vec4 v100,\n  in vec4 v001, in vec4 v101,\n  in vec4 v010, in vec4 v110,\n  in vec4 v011, in vec4 v111) {\n\n  // https://en.wikipedia.org/wiki/Trilinear_interpolation\n\n  vec4 c00 = v000 * ( 1.0 - normalizedPosition.x ) + v100 * normalizedPosition.x;\n  vec4 c01 = v001 * ( 1.0 - normalizedPosition.x ) + v101 * normalizedPosition.x;\n  vec4 c10 = v010 * ( 1.0 - normalizedPosition.x ) + v110 * normalizedPosition.x;\n  vec4 c11 = v011 * ( 1.0 - normalizedPosition.x ) + v111 * normalizedPosition.x;\n\n  // c0 and c1\n  vec4 c0 = c00 * ( 1.0 - normalizedPosition.y) + c10 * normalizedPosition.y;\n  vec4 c1 = c01 * ( 1.0 - normalizedPosition.y) + c11 * normalizedPosition.y;\n\n  // c\n  vec4 c = c0 * ( 1.0 - normalizedPosition.z) + c1 * normalizedPosition.z;\n  interpolatedValue = c;\n}\n\nvoid "+this._name+"(in vec3 currentVoxel, out vec4 dataValue, out vec3 gradient){\n\n  vec3 lower_bound = floor(currentVoxel);\n  if(lower_bound.x < 0.){\n    lower_bound.x = 0.;\n  }\n  if(lower_bound.y < 0.){\n    lower_bound.y = 0.;\n  }\n  if(lower_bound.z < 0.){\n    lower_bound.z = 0.;\n  }\n  \n  vec3 higher_bound = lower_bound + vec3(1.);\n  vec3 normalizedPosition = (currentVoxel - lower_bound);\n  vec4 interpolatedValue = vec4(0.);\n\n  //\n  // fetch values required for interpolation\n  //\n  vec4 v000 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c000 = vec3(lower_bound.x, lower_bound.y, lower_bound.z);\n  "+a.a.api(this._base,"c000","v000")+"\n\n  //\n  vec4 v100 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c100 = vec3(higher_bound.x, lower_bound.y, lower_bound.z);\n  "+a.a.api(this._base,"c100","v100")+"\n\n  //\n  vec4 v001 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c001 = vec3(lower_bound.x, lower_bound.y, higher_bound.z);\n  "+a.a.api(this._base,"c001","v001")+"\n\n  //\n  vec4 v101 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c101 = vec3(higher_bound.x, lower_bound.y, higher_bound.z);\n  "+a.a.api(this._base,"c101","v101")+"\n  \n  //\n  vec4 v010 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c010 = vec3(lower_bound.x, higher_bound.y, lower_bound.z);\n  "+a.a.api(this._base,"c010","v010")+"\n\n  vec4 v110 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c110 = vec3(higher_bound.x, higher_bound.y, lower_bound.z);\n  "+a.a.api(this._base,"c110","v110")+"\n\n  //\n  vec4 v011 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c011 = vec3(lower_bound.x, higher_bound.y, higher_bound.z);\n  "+a.a.api(this._base,"c011","v011")+"\n\n  vec4 v111 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c111 = vec3(higher_bound.x, higher_bound.y, higher_bound.z);\n  "+a.a.api(this._base,"c111","v111")+"\n\n  // compute interpolation at position\n  trilinearInterpolation(normalizedPosition, interpolatedValue ,v000, v100, v001, v101, v010,v110, v011,v111);\n  dataValue = interpolatedValue;\n\n  // compute gradient\n  float gradientStep = 0.005;\n\n  // x axis\n  vec3 g100 = vec3(1., 0., 0.);\n  vec3 ng100 = normalizedPosition + g100 * gradientStep;\n  if (ng100.x > 1.) {\n    ng100.x = 1.;\n  }\n  vec4 vg100 = vec4(0.);\n  trilinearInterpolation(ng100, vg100 ,v000, v100, v001, v101, v010,v110, v011,v111);\n\n  vec3 go100 = -g100;\n  vec3 ngo100 = normalizedPosition + go100 * gradientStep;\n  if (ngo100.x < 0.) {\n    ngo100.x = 0.;\n  }\n  vec4 vgo100 = vec4(0.);\n  trilinearInterpolation(ngo100, vgo100 ,v000, v100, v001, v101, v010,v110, v011,v111);\n\n  gradient.x = (g100.x * vg100.x + go100.x * vgo100.x);\n\n  // y axis\n  vec3 g010 = vec3(0., 1., 0.);\n  vec3 ng010 = normalizedPosition + g010 * gradientStep;\n  if (ng010.y > 1.) {\n    ng010.y = 1.;\n  }\n  vec4 vg010 = vec4(0.);\n  trilinearInterpolation(ng010, vg010 ,v000, v100, v001, v101, v010,v110, v011,v111);\n\n  vec3 go010 = -g010;\n  vec3 ngo010 = normalizedPosition + go010 * gradientStep;\n  if (ngo010.y < 0.) {\n    ngo010.y = 0.;\n  }\n  vec4 vgo010 = vec4(0.);\n  trilinearInterpolation(ngo010, vgo010 ,v000, v100, v001, v101, v010,v110, v011,v111);\n\n  gradient.y = (g010.y * vg010.x + go010.y * vgo010.x);\n\n  // z axis\n  vec3 g001 = vec3(0., 0., 1.);\n  vec3 ng001 = normalizedPosition + g001 * gradientStep;\n  if (ng001.z > 1.) {\n    ng001.z = 1.;\n  }\n  vec4 vg001 = vec4(0.);\n  trilinearInterpolation(ng001, vg001 ,v000, v100, v001, v101, v010,v110, v011,v111);\n\n  vec3 go001 = -g001;\n  vec3 ngo001 = normalizedPosition + go001 * gradientStep;\n  if (ngo001.z < 0.) {\n    ngo001.z = 0.;\n  }\n  vec4 vgo001 = vec4(0.);\n  trilinearInterpolation(ngo001, vgo001 ,v000, v100, v001, v101, v010,v110, v011,v111);\n\n  gradient.z = (g001.z * vg001.x + go001.z * vgo001.x);\n\n  // normalize gradient\n  float gradientMagnitude = length(gradient);\n  if (gradientMagnitude > 0.0) {\n    gradient = -(1. / gradientMagnitude) * gradient;\n  }\n}\n    "},t}(o.a);t.a=new n},function(d,t,e){"use strict";function p(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function i(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))||"function"==typeof o)?o:a}function r(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var o=e(33),a=e(34),s=e(42),l=e(0),n=function(){function a(a,o){for(var e=0,r;e<o.length;e++)r=o[e],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,r.key,r)}return function(t,e,o){return e&&a(t.prototype,e),o&&a(t,o),t}}(),c=function(c){function t(e){p(this,t);var a=i(this,c.call(this));return a._stack=e,a._bBox=null,a._slice=null,a._border=null,a._dummy=null,a._orientation=0,a._index=0,a._uniforms=null,a._autoWindowLevel=!1,a._outOfBounds=!1,a._orientationMaxIndex=0,a._canvasWidth=0,a._canvasHeight=0,a._borderColor=null,a._create(),a}return r(t,c),t.prototype._create=function(){this._stack?(this._prepareStack(),this._prepareBBox(),this._prepareSlice(),this._prepareBorder()):window.console.log("no stack to be prepared...")},t.prototype._computeOrientationMaxIndex=function(){var e=this._stack.dimensionsIJK;switch(this._orientationMaxIndex=0,this._orientation){case 0:this._orientationMaxIndex=e.z-1;break;case 1:this._orientationMaxIndex=e.x-1;break;case 2:this._orientationMaxIndex=e.y-1;}},t.prototype._isIndexOutOfBounds=function(){this._computeOrientationMaxIndex(),this._outOfBounds=this._index>=this._orientationMaxIndex||0>this._index},t.prototype._prepareStack=function(){this._stack.prepared||this._stack.prepare(),this._stack.packed||this._stack.pack()},t.prototype._prepareBBox=function(){this._bBox=new a.a(this._stack),this.add(this._bBox)},t.prototype._prepareBorder=function(){this._border=new o.a(this._slice),this.add(this._border)},t.prototype._prepareSlice=function(){var a=this._stack.halfDimensionsIJK;this._index=this._prepareSliceIndex(a);var t=this._prepareSlicePosition(a,this._index),e=this._prepareDirection(this._orientation);this._slice=new s.a(this._stack,this._index,t,e),this.add(this._slice)},t.prototype._prepareSliceIndex=function(a){var t=0;switch(this._orientation){case 0:t=z(a.z);break;case 1:t=z(a.x);break;case 2:t=z(a.y);}return t},t.prototype._prepareSlicePosition=function(a,t){var e=new l.f(0,0,0);switch(this._orientation){case 0:e=new l.f(z(a.x),z(a.y),t);break;case 1:e=new l.f(t,z(a.y),z(a.z));break;case 2:e=new l.f(z(a.x),t,z(a.z));}return e},t.prototype._prepareDirection=function(a){var t=new l.f(0,0,1);return 0===a?t=new l.f(0,0,1):1===a?t=new l.f(1,0,0):2===a?t=new l.f(0,1,0):void 0,t},t.prototype.dispose=function(){this.remove(this._slice),this._slice.dispose(),this._slice=null,this._bBox.dispose(),this._bBox=null,this._border.dispose(),this._border=null},n(t,[{key:"stack",get:function(){return this._stack},set:function(e){this._stack=e}},{key:"bbox",get:function(){return this._bBox}},{key:"slice",get:function(){return this._slice}},{key:"border",get:function(){return this._border}},{key:"index",get:function(){return this._index},set:function(a){this._index=a,this._slice.index=a;var t=this._stack.halfDimensionsIJK;this._slice.planePosition=this._prepareSlicePosition(t,this._index),this._border.helpersSlice=this._slice,this._isIndexOutOfBounds()}},{key:"orientation",set:function(e){this._orientation=e,this._computeOrientationMaxIndex(),this._slice.planeDirection=this._prepareDirection(this._orientation),this._border.helpersSlice=this._slice},get:function(){return this._orientation}},{key:"outOfBounds",set:function(e){this._outOfBounds=e},get:function(){return this._outOfBounds}},{key:"orientationMaxIndex",set:function(e){this._orientationMaxIndex=e},get:function(){return this._orientationMaxIndex}},{key:"canvasWidth",set:function(e){this._canvasWidth=e,this._slice.canvasWidth=this._canvasWidth},get:function(){return this._canvasWidth}},{key:"canvasHeight",set:function(e){this._canvasHeight=e,this._slice.canvasHeight=this._canvasHeight},get:function(){return this._canvasHeight}},{key:"borderColor",set:function(e){this._borderColor=e,this._border.color=e,this._slice.borderColor=this._borderColor},get:function(){return this._borderColor}}]),t}(THREE.Object3D);t.a=c},function(d,t,e){"use strict";function m(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function i(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))||"function"==typeof o)?o:a}function r(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var _=e(49),a=e(50),s=e(51),o=e(48),n=e(0),l=function(){function a(a,o){for(var e=0,r;e<o.length;e++)r=o[e],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,r.key,r)}return function(t,e,o){return e&&a(t.prototype,e),o&&a(t,o),t}}(),c=function(c){function t(e){m(this,t);var r=i(this,c.call(this));return r._stack=e,r._textures=[],r._shadersFragment=s.a,r._shadersVertex=a.a,r._uniforms=_.a.uniforms(),r._material=null,r._geometry=null,r._interpolation=1,r._shading=1,r._shininess=10,r._create(),r}return r(t,c),t.prototype._create=function(){this._prepareStack(),this._prepareTexture(),this._prepareMaterial(),this._prepareGeometry(),this._mesh=new THREE.Mesh(this._geometry,this._material),this.add(this._mesh)},t.prototype._prepareStack=function(){this._stack.prepared||this._stack.prepare(),this._stack.packed||this._stack.pack()},t.prototype._prepareMaterial=function(){var e=0;0>this._stack._minMax[0]&&(e=this._stack._minMax[0]),this._uniforms=_.a.uniforms(),this._uniforms.uWorldBBox.value=this._stack.worldBoundingBox(),this._uniforms.uTextureSize.value=this._stack.textureSize,this._uniforms.uTextureContainer.value=this._textures,this._uniforms.uWorldToData.value=this._stack.lps2IJK,this._uniforms.uNumberOfChannels.value=this._stack.numberOfChannels,this._uniforms.uPixelType.value=this._stack.pixelType,this._uniforms.uBitsAllocated.value=this._stack.bitsAllocated,this._uniforms.uPackedPerPixel.value=this._stack.packedPerPixel,this._uniforms.uWindowCenterWidth.value=[e+this._stack.windowCenter,.8*this._stack.windowWidth],this._uniforms.uRescaleSlopeIntercept.value=[this._stack.rescaleSlope,this._stack.rescaleIntercept],this._uniforms.uDataDimensions.value=[this._stack.dimensionsIJK.x,this._stack.dimensionsIJK.y,this._stack.dimensionsIJK.z],this._uniforms.uInterpolation.value=this._interpolation,this._uniforms.uShading.value=this._shading,this._uniforms.uShininess.value=this._shininess,this._createMaterial({side:THREE.BackSide,transparent:!0})},t.prototype._prepareGeometry=function(){var a=this._stack.worldBoundingBox(),t=this._stack.worldCenter();this._geometry=new THREE.BoxGeometry(a[1]-a[0],a[3]-a[2],a[5]-a[4]),this._geometry.applyMatrix(new n.c().makeTranslation(t.x,t.y,t.z))},l(t,[{key:"uniforms",get:function(){return this._uniforms},set:function(e){this._uniforms=e}},{key:"stack",get:function(){return this._stack},set:function(e){this._stack=e}},{key:"interpolation",get:function(){return this._interpolation},set:function(e){this._interpolation=e,this._uniforms.uInterpolation.value=this._interpolation,this._updateMaterial()}},{key:"shading",get:function(){return this._shading},set:function(e){this._shading=e,this._uniforms.uShading.value=this._shading}},{key:"shininess",get:function(){return this._shininess},set:function(e){this._shininess=e,this._uniforms.uShininess.value=this._shininess}}]),t}(Object(o.a)(THREE.Object3D));t.a=c},function(l,t,e){"use strict";function s(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function i(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))||"function"==typeof o)?o:a}function r(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var o=function(a){function t(){s(this,t);var e=i(this,a.call(this));return e.name="intersectBox",e._rayOrigin="rayOrigin",e._rayDirection="rayDirection",e._aabbMin="aabbMin",e._aabbMax="aabbMax",e._tNear="tNear",e._tFar="tFar",e._intersect="intersect",e}return r(t,a),t.prototype.api=function(){var l=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._base,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this._rayOrigin,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this._rayDirection,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:this._aabbMin,i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:this._aabbMax,r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:this._tNear,o=6<arguments.length&&void 0!==arguments[6]?arguments[6]:this._tFar,a=7<arguments.length&&void 0!==arguments[7]?arguments[7]:this._intersect;return this._base=l,this.compute(t,e,n,i,r,o,a)},t.prototype.compute=function(l,t,e,n,i,r,o){return this.computeDefinition(),this._base._functions[this._name]=this._definition,this._name+"("+l+", "+t+", "+e+", "+n+", "+i+", "+r+", "+o+");"},t.prototype.computeDefinition=function(){this._definition="\nvoid "+this._name+"(vec3 rayOrigin, vec3 rayDirection, vec3 boxMin, vec3 boxMax, out float tNear, out float tFar, out bool intersect){\n  // compute intersection of ray with all six bbox planes\n  vec3 invRay = vec3(1.) / rayDirection;\n  vec3 tBot = invRay * (boxMin - rayOrigin);\n  vec3 tTop = invRay * (boxMax - rayOrigin);\n  // re-order intersections to find smallest and largest on each axis\n  vec3 tMin = min(tTop, tBot);\n  vec3 tMax = max(tTop, tBot);\n  // find the largest tMin and the smallest tMax\n  float largest_tMin = max(max(tMin.x, tMin.y), max(tMin.x, tMin.z));\n  float smallest_tMax = min(min(tMax.x, tMax.y), min(tMax.x, tMax.z));\n  tNear = largest_tMin;\n  tFar = smallest_tMax;\n  intersect = smallest_tMax > largest_tMin;\n}\n\n    "},t}(e(10).a);t.a=new o},function(a,t,e){"use strict";var o=e(111);e.d(t,"a",function(){return o.a})},function(g,t,e){"use strict";function n(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function i(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))||"function"==typeof o)?o:a}function r(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var o=e(120),a=e(3),y=e(57),l=e(23),c=e(60),s=e(61),u=e(159),p=e(79),d=e(81),h=e(19),m=function(o){function t(){return n(this,t),i(this,o.apply(this,arguments))}return r(t,o),t.prototype.parse=function(c){var d=this;return this.emit("parse-start",{file:c.url,time:new Date}),this._progressBar&&this._progressBar.update(0,100,"parse"),new Promise(function(e){window.setTimeout(function(){e(new Promise(function(e,t){var n=c;if(Array.isArray(n)||(n=[n]),n.forEach(function(e){d._preprocess(e)}),1===n.length)n=n[0];else{var r=n.filter(d._filterByExtension.bind(null,"MHD")),o=n.filter(d._filterByExtension.bind(null,"RAW"));2===n.length&&1===r.length&&1===o.length&&(n.url=r[0].url,n.extension=r[0].extension,n.mhdBuffer=r[0].buffer,n.rawBuffer=o[0].buffer)}var a=d._parser(n.extension);a||(d.emit("parse-error",{file:c.url,time:new Date,error:n.filename+"can not be parsed."}),t(n.filename+" can not be parsed."));var i=null;try{i=new a(n,0)}catch(e){window.console.log(e),d.emit("parse-error",{file:c.url,time:new Date,error:e}),t(e)}var s=new y.a;s.seriesInstanceUID=i.seriesInstanceUID(),s.transferSyntaxUID=i.transferSyntaxUID(),s.seriesDate=i.seriesDate(),s.seriesDescription=i.seriesDescription(),s.studyDate=i.studyDate(),s.studyDescription=i.studyDescription(),s.numberOfFrames=i.numberOfFrames(),s.numberOfFrames||(s.numberOfFrames=1),s.numberOfChannels=i.numberOfChannels(),s.modality=i.modality(),"SEG"===s.modality&&(s.segmentationType=i.segmentationType(),s.segmentationSegments=i.segmentationSegments()),s.patientID=i.patientID(),s.patientName=i.patientName(),s.patientAge=i.patientAge(),s.patientBirthdate=i.patientBirthdate(),s.patientSex=i.patientSex();var u=new l.a;u.numberOfChannels=i.numberOfChannels(),u.pixelRepresentation=i.pixelRepresentation(),u.pixelType=i.pixelType(),u.invert=i.invert(),u.spacingBetweenSlices=i.spacingBetweenSlices(),u.modality=s.modality,"SEG"===u.modality&&(u.segmentationType=s.segmentationType,u.segmentationSegments=s.segmentationSegments),s.stack.push(u),setTimeout(d.parseFrame(s,u,c.url,0,i,e,t),0)}))},10)})},t.prototype.parseFrame=function(l,t,e,d,i,r,o){var a=new c.a;a.sopInstanceUID=i.sopInstanceUID(d),a.url=e,a.index=d,a.rows=i.rows(d),a.columns=i.columns(d),a.numberOfChannels=t.numberOfChannels,a.pixelRepresentation=t.pixelRepresentation,a.pixelType=t.pixelType,a.pixelData=i.extractPixelData(d),a.pixelSpacing=i.pixelSpacing(d),a.spacingBetweenSlices=i.spacingBetweenSlices(d),a.sliceThickness=i.sliceThickness(d),a.imageOrientation=i.imageOrientation(d),a.rightHanded=i.rightHanded(),t.rightHanded=a.rightHanded,null===a.imageOrientation&&(a.imageOrientation=[1,0,0,0,1,0]),a.imagePosition=i.imagePosition(d),null===a.imagePosition&&(a.imagePosition=[0,0,d]),a.dimensionIndexValues=i.dimensionIndexValues(d),a.bitsAllocated=i.bitsAllocated(d),a.instanceNumber=i.instanceNumber(d),a.windowCenter=i.windowCenter(d),a.windowWidth=i.windowWidth(d),a.rescaleSlope=i.rescaleSlope(d),a.rescaleIntercept=i.rescaleIntercept(d),a.minMax=i.minMaxPixelData(a.pixelData),"SEG"===l.modality&&(a.referencedSegmentNumber=i.referencedSegmentNumber(d)),t.frame.push(a),this._parsed=d+1,this._totalParsed=l.numberOfFrames,this._progressBar&&this._progressBar.update(this._parsed,this._totalParsed,"parse"),this.emit("parsing",{file:e,total:this._totalParsed,parsed:this._parsed,time:new Date}),this._parsed===this._totalParsed?(this.emit("parse-success",{file:e,total:this._totalParsed,parsed:this._parsed,time:new Date}),r(l)):setTimeout(this.parseFrame(l,t,e,this._parsed,i,r,o),0)},t.prototype._parser=function(a){var t=null;switch(a.toUpperCase()){case"NII":case"NII_":t=p.a;break;case"DCM":case"DICOM":case"IMA":case"":t=s.a;break;case"MHD":t=u.a;break;case"NRRD":t=d.a;break;default:return window.console.log("unsupported extension: "+a),!1;}return t},t.prototype._preprocess=function(o){var t=a.a.parseUrl(o.url);if(o.filename=t.filename,o.extension=t.extension,o.pathname=t.pathname,o.query=t.query,"gz"===o.extension){o.gzcompressed=!0,o.extension=o.filename.split(".gz").shift().split(".").pop();var e=h.inflate(o.buffer);o.buffer=e.buffer}else o.gzcompressed=!1},t.prototype._filterByExtension=function(a,t){return t.extension.toUpperCase()===a.toUpperCase()},t}(o.a);t.a=m},function(m,t,e){"use strict";function _(m){if(!(this instanceof _))return new _(m);this.options=o.assign({level:u,method:y,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},m||{});var t=this.options;t.raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&16>t.windowBits&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var e=g.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(e!==c)throw new Error(i[e]);if(t.header&&g.deflateSetHeader(this.strm,t.header),t.dictionary){var n;if(n="string"==typeof t.dictionary?a.string2buf(t.dictionary):"[object ArrayBuffer]"===s.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(e=g.deflateSetDictionary(this.strm,n))!==c)throw new Error(i[e]);this._dict_set=!0}}function n(a,t){var e=new _(t);if(e.push(a,!0),e.err)throw e.msg;return e.result}var g=e(113),o=e(2),a=e(54),i=e(20),l=e(55),s=Object.prototype.toString,c=0,u=-1,h=0,y=8;_.prototype.push=function(d,p){var u=this.strm,r=this.options.chunkSize,l,n;if(this.ended)return!1;n=p===~~p?p:!0===p?4:0,u.input="string"==typeof d?a.string2buf(d):"[object ArrayBuffer]"===s.call(d)?new Uint8Array(d):d,u.next_in=0,u.avail_in=u.input.length;do{if(0===u.avail_out&&(u.output=new o.Buf8(r),u.next_out=0,u.avail_out=r),1!==(l=g.deflate(u,n))&&l!==c)return this.onEnd(l),this.ended=!0,!1;0!==u.avail_out&&(0!==u.avail_in||4!==n&&2!==n)||("string"===this.options.to?this.onData(a.buf2binstring(o.shrinkBuf(u.output,u.next_out))):this.onData(o.shrinkBuf(u.output,u.next_out)))}while((0<u.avail_in||0===u.avail_out)&&1!==l);return 4===n?(l=g.deflateEnd(this.strm),this.onEnd(l),this.ended=!0,l===c):2!==n||(this.onEnd(c),u.avail_out=0,!0)},_.prototype.onData=function(e){this.chunks.push(e)},_.prototype.onEnd=function(e){e===c&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=_,t.deflate=n,t.deflateRaw=function(a,t){return t=t||{},t.raw=!0,n(a,t)},t.gzip=function(a,t){return t=t||{},t.gzip=!0,n(a,t)}},function(C,t,e){"use strict";function L(a,t){return a.msg=w[t],t}function i(e){return(e<<1)-(4<e?9:0)}function U(a){for(var t=a.length;0<=--t;)a[t]=0}function o(a){var t=a.state,e=t.pending;e>a.avail_out&&(e=a.avail_out),0!==e&&(y.arraySet(a.output,t.pending_buf,t.pending_out,e,a.next_out),a.next_out+=e,t.pending_out+=e,a.total_out+=e,a.avail_out-=e,t.pending-=e,0===t.pending&&(t.pending_out=0))}function V(a,t){b._tr_flush_block(a,0<=a.block_start?a.block_start:-1,a.strstart-a.block_start,t),a.block_start=a.strstart,o(a.strm)}function a(a,t){a.pending_buf[a.pending++]=t}function r(a,t){a.pending_buf[a.pending++]=255&t>>>8,a.pending_buf[a.pending++]=255&t}function l(a,t,e,o){var n=a.avail_in;return n>o&&(n=o),0===n?0:(a.avail_in-=n,y.arraySet(t,a.input,a.next_in,n,e),1===a.state.wrap?a.adler=x(a.adler,t,n,e):2===a.state.wrap&&(a.adler=v(a.adler,t,n,e)),a.next_in+=n,a.total_in+=n,n)}function s(m,t){var e=m.max_chain_length,r=m.strstart,o=m.prev_length,a=m.nice_match,s=m.strstart>m.w_size-J?m.strstart-(m.w_size-J):0,l=m.window,c=m.w_mask,_=m.prev,h=m.strstart+Z,p=l[r+o-1],d=l[r+o],g,n;m.prev_length>=m.good_match&&(e>>=2),a>m.lookahead&&(a=m.lookahead);do if(g=t,l[g+o]===d&&l[g+o-1]===p&&l[g]===l[r]&&l[++g]===l[r+1]){r+=2,g++;do;while(l[++r]===l[++g]&&l[++r]===l[++g]&&l[++r]===l[++g]&&l[++r]===l[++g]&&l[++r]===l[++g]&&l[++r]===l[++g]&&l[++r]===l[++g]&&l[++r]===l[++g]&&r<h);if(n=Z-(h-r),r=h-Z,n>o){if(m.match_start=t,o=n,n>=a)break;p=l[r+o-1],d=l[r+o]}}while((t=_[t&c])>s&&0!=--e);return o<=m.lookahead?o:m.lookahead}function j(s){var t=s.w_size,a,e,n,i,r;do{if(i=s.window_size-s.lookahead-s.strstart,s.strstart>=t+(t-J)){y.arraySet(s.window,s.window,t,t,0),s.match_start-=t,s.strstart-=t,s.block_start-=t,a=e=s.hash_size;do n=s.head[--a],s.head[a]=n>=t?n-t:0;while(--e);a=e=t;do n=s.prev[--a],s.prev[a]=n>=t?n-t:0;while(--e);i+=t}if(0===s.strm.avail_in)break;if(e=l(s.strm,s.window,s.strstart+s.lookahead,i),s.lookahead+=e,s.lookahead+s.insert>=Y)for(r=s.strstart-s.insert,s.ins_h=s.window[r],s.ins_h=(s.ins_h<<s.hash_shift^s.window[r+1])&s.hash_mask;s.insert&&(s.ins_h=(s.ins_h<<s.hash_shift^s.window[r+Y-1])&s.hash_mask,s.prev[r&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=r,r++,s.insert--,!(s.lookahead+s.insert<Y)););}while(s.lookahead<J&&0!==s.strm.avail_in)}function n(a,t){for(var e,o;;){if(a.lookahead<J){if(j(a),a.lookahead<J&&t===E)return re;if(0===a.lookahead)break}if(e=0,a.lookahead>=Y&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+Y-1])&a.hash_mask,e=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),0!==e&&a.strstart-e<=a.w_size-J&&(a.match_length=s(a,e)),!(a.match_length>=Y))o=b._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;else if(o=b._tr_tally(a,a.strstart-a.match_start,a.match_length-Y),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&a.lookahead>=Y){a.match_length--;do a.strstart++,a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+Y-1])&a.hash_mask,e=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart;while(0!=--a.match_length);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+1])&a.hash_mask;if(o&&(V(a,!1),0===a.strm.avail_out))return re}return a.insert=a.strstart<Y-1?a.strstart:Y-1,t===T?(V(a,!0),0===a.strm.avail_out?ie:le):a.last_lit&&(V(a,!1),0===a.strm.avail_out)?re:ne}function c(a,t){for(var e,o,n;;){if(a.lookahead<J){if(j(a),a.lookahead<J&&t===E)return re;if(0===a.lookahead)break}if(e=0,a.lookahead>=Y&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+Y-1])&a.hash_mask,e=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,a.match_length=Y-1,0!==e&&a.prev_length<a.max_lazy_match&&a.strstart-e<=a.w_size-J&&(a.match_length=s(a,e),5>=a.match_length&&(a.strategy===k||a.match_length===Y&&4096<a.strstart-a.match_start)&&(a.match_length=Y-1)),a.prev_length>=Y&&a.match_length<=a.prev_length){n=a.strstart+a.lookahead-Y,o=b._tr_tally(a,a.strstart-1-a.prev_match,a.prev_length-Y),a.lookahead-=a.prev_length-1,a.prev_length-=2;do++a.strstart<=n&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+Y-1])&a.hash_mask,e=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);while(0!=--a.prev_length);if(a.match_available=0,a.match_length=Y-1,a.strstart++,o&&(V(a,!1),0===a.strm.avail_out))return re}else if(!a.match_available)a.match_available=1,a.strstart++,a.lookahead--;else if((o=b._tr_tally(a,0,a.window[a.strstart-1]))&&V(a,!1),a.strstart++,a.lookahead--,0===a.strm.avail_out)return re}return a.match_available&&(o=b._tr_tally(a,0,a.window[a.strstart-1]),a.match_available=0),a.insert=a.strstart<Y-1?a.strstart:Y-1,t===T?(V(a,!0),0===a.strm.avail_out?ie:le):a.last_lit&&(V(a,!1),0===a.strm.avail_out)?re:ne}function p(l,t){for(var e=l.window,a,n,i,r;;){if(l.lookahead<=Z){if(j(l),l.lookahead<=Z&&t===E)return re;if(0===l.lookahead)break}if(l.match_length=0,l.lookahead>=Y&&0<l.strstart&&(i=l.strstart-1,(n=e[i])===e[++i]&&n===e[++i]&&n===e[++i])){r=l.strstart+Z;do;while(n===e[++i]&&n===e[++i]&&n===e[++i]&&n===e[++i]&&n===e[++i]&&n===e[++i]&&n===e[++i]&&n===e[++i]&&i<r);l.match_length=Z-(r-i),l.match_length>l.lookahead&&(l.match_length=l.lookahead)}if(l.match_length>=Y?(a=b._tr_tally(l,1,l.match_length-Y),l.lookahead-=l.match_length,l.strstart+=l.match_length,l.match_length=0):(a=b._tr_tally(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++),a&&(V(l,!1),0===l.strm.avail_out))return re}return l.insert=0,t===T?(V(l,!0),0===l.strm.avail_out?ie:le):l.last_lit&&(V(l,!1),0===l.strm.avail_out)?re:ne}function u(a,t){for(var e;;){if(0===a.lookahead&&(j(a),0===a.lookahead)){if(t===E)return re;break}if(a.match_length=0,e=b._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++,e&&(V(a,!1),0===a.strm.avail_out))return re}return a.insert=0,t===T?(V(a,!0),0===a.strm.avail_out?ie:le):a.last_lit&&(V(a,!1),0===a.strm.avail_out)?re:ne}function d(a,t,e,o,n){this.good_length=a,this.max_lazy=t,this.nice_length=e,this.max_chain=o,this.func=n}function m(e){e.window_size=2*e.w_size,U(e.head),e.max_lazy_match=se[e.level].max_lazy,e.good_match=se[e.level].good_length,e.nice_match=se[e.level].nice_length,e.max_chain_length=se[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=Y-1,e.match_available=0,e.ins_h=0}function _(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=z,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new y.Buf16(2*q),this.dyn_dtree=new y.Buf16(2*(2*H+1)),this.bl_tree=new y.Buf16(2*(2*W+1)),U(this.dyn_ltree),U(this.dyn_dtree),U(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new y.Buf16(X+1),this.heap=new y.Buf16(2*G+1),U(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new y.Buf16(2*G+1),U(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function h(a){var t;return a&&a.state?(a.total_in=a.total_out=0,a.data_type=B,t=a.state,t.pending=0,t.pending_out=0,0>t.wrap&&(t.wrap=-t.wrap),t.status=t.wrap?K:ae,a.adler=2===t.wrap?0:1,t.last_flush=E,b._tr_init(t),P):L(a,I)}function g(a){var t=h(a);return t===P&&m(a.state),t}function f(i,c,e,n,d,o){if(!i)return I;var a=1;if(c===D&&(c=6),0>n?(a=0,n=-n):15<n&&(a=2,n-=16),1>d||d>O||e!==z||8>n||15<n||0>c||9<c||0>o||o>N)return L(i,I);8===n&&(n=9);var s=new _;return i.state=s,s.strm=i,s.wrap=a,s.gzhead=null,s.w_bits=n,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=d+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+Y-1)/Y),s.window=new y.Buf8(2*s.w_size),s.head=new y.Buf16(s.hash_size),s.prev=new y.Buf16(s.w_size),s.lit_bufsize=1<<d+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new y.Buf8(s.pending_buf_size),s.d_buf=s.lit_bufsize>>1,s.l_buf=3*s.lit_bufsize,s.level=c,s.strategy=o,s.method=e,g(i)}var y=e(2),b=e(114),x=e(52),v=e(53),w=e(20),E=0,T=4,M=5,P=0,A=1,I=-2,R=-5,D=-1,k=1,F=2,N=4,B=2,z=8,O=9,G=286,H=30,W=19,q=2*G+1,X=15,Y=3,Z=258,J=Z+Y+1,K=42,Q=69,$=73,ee=91,te=103,ae=113,oe=666,re=1,ne=2,ie=3,le=4,se;se=[new d(0,0,0,0,function(a,t){var e=65535;for(e>a.pending_buf_size-5&&(e=a.pending_buf_size-5);;){if(1>=a.lookahead){if(j(a),0===a.lookahead&&t===E)return re;if(0===a.lookahead)break}a.strstart+=a.lookahead,a.lookahead=0;var o=a.block_start+e;if((0===a.strstart||a.strstart>=o)&&(a.lookahead=a.strstart-o,a.strstart=o,V(a,!1),0===a.strm.avail_out))return re;if(a.strstart-a.block_start>=a.w_size-J&&(V(a,!1),0===a.strm.avail_out))return re}return a.insert=0,t===T?(V(a,!0),0===a.strm.avail_out?ie:le):(a.strstart>a.block_start&&(V(a,!1),a.strm.avail_out),re)}),new d(4,4,8,4,n),new d(4,5,16,8,n),new d(4,6,32,32,n),new d(4,4,16,16,c),new d(8,16,32,32,c),new d(8,16,128,128,c),new d(8,32,128,256,c),new d(32,128,258,1024,c),new d(32,258,258,4096,c)],t.deflateInit=function(a,t){return f(a,t,z,15,8,0)},t.deflateInit2=f,t.deflateReset=g,t.deflateResetKeep=h,t.deflateSetHeader=function(a,t){return a&&a.state?2===a.state.wrap?(a.state.gzhead=t,P):I:I},t.deflate=function(l,c){var e,n,s,m;if(!l||!l.state||c>M||0>c)return l?L(l,I):I;if(n=l.state,!l.output||!l.input&&0!==l.avail_in||n.status===oe&&c!==T)return L(l,0===l.avail_out?R:I);if(n.strm=l,e=n.last_flush,n.last_flush=c,n.status===K)if(2===n.wrap)l.adler=0,a(n,31),a(n,139),a(n,8),n.gzhead?(a(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),a(n,255&n.gzhead.time),a(n,255&n.gzhead.time>>8),a(n,255&n.gzhead.time>>16),a(n,255&n.gzhead.time>>24),a(n,9===n.level?2:n.strategy>=F||2>n.level?4:0),a(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(a(n,255&n.gzhead.extra.length),a(n,255&n.gzhead.extra.length>>8)),n.gzhead.hcrc&&(l.adler=v(l.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=Q):(a(n,0),a(n,0),a(n,0),a(n,0),a(n,0),a(n,9===n.level?2:n.strategy>=F||2>n.level?4:0),a(n,3),n.status=ae);else{var _=z+(n.w_bits-8<<4)<<8;_|=(n.strategy>=F||2>n.level?0:6>n.level?1:6===n.level?2:3)<<6,0!==n.strstart&&(_|=32),_+=31-_%31,n.status=ae,r(n,_),0!==n.strstart&&(r(n,l.adler>>>16),r(n,65535&l.adler)),l.adler=1}if(n.status===Q)if(n.gzhead.extra){for(s=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>s&&(l.adler=v(l.adler,n.pending_buf,n.pending-s,s)),o(l),s=n.pending,n.pending!==n.pending_buf_size));)a(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>s&&(l.adler=v(l.adler,n.pending_buf,n.pending-s,s)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=$)}else n.status=$;if(n.status===$)if(n.gzhead.name){s=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>s&&(l.adler=v(l.adler,n.pending_buf,n.pending-s,s)),o(l),s=n.pending,n.pending===n.pending_buf_size)){m=1;break}m=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,a(n,m)}while(0!==m);n.gzhead.hcrc&&n.pending>s&&(l.adler=v(l.adler,n.pending_buf,n.pending-s,s)),0===m&&(n.gzindex=0,n.status=ee)}else n.status=ee;if(n.status===ee)if(n.gzhead.comment){s=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>s&&(l.adler=v(l.adler,n.pending_buf,n.pending-s,s)),o(l),s=n.pending,n.pending===n.pending_buf_size)){m=1;break}m=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,a(n,m)}while(0!==m);n.gzhead.hcrc&&n.pending>s&&(l.adler=v(l.adler,n.pending_buf,n.pending-s,s)),0===m&&(n.status=te)}else n.status=te;if(n.status===te&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&o(l),n.pending+2<=n.pending_buf_size&&(a(n,255&l.adler),a(n,255&l.adler>>8),l.adler=0,n.status=ae)):n.status=ae),0!==n.pending){if(o(l),0===l.avail_out)return n.last_flush=-1,P;}else if(0===l.avail_in&&i(c)<=i(e)&&c!==T)return L(l,R);if(n.status===oe&&0!==l.avail_in)return L(l,R);if(0!==l.avail_in||0!==n.lookahead||c!==E&&n.status!==oe){var h=n.strategy===F?u(n,c):n.strategy===3?p(n,c):se[n.level].func(n,c);if(h!==ie&&h!==le||(n.status=oe),h===re||h===ie)return 0===l.avail_out&&(n.last_flush=-1),P;if(h===ne&&(c===1?b._tr_align(n):c!==M&&(b._tr_stored_block(n,0,0,!1),c===3&&(U(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),o(l),0===l.avail_out))return n.last_flush=-1,P}return c===T?0>=n.wrap?A:(2===n.wrap?(a(n,255&l.adler),a(n,255&l.adler>>8),a(n,255&l.adler>>16),a(n,255&l.adler>>24),a(n,255&l.total_in),a(n,255&l.total_in>>8),a(n,255&l.total_in>>16),a(n,255&l.total_in>>24)):(r(n,l.adler>>>16),r(n,65535&l.adler)),o(l),0<n.wrap&&(n.wrap=-n.wrap),0===n.pending?A:P):P},t.deflateEnd=function(a){var t;return a&&a.state?(t=a.state.status)!==K&&t!==Q&&t!==$&&t!==ee&&t!==te&&t!==ae&&t!==oe?L(a,I):(a.state=null,t===ae?L(a,-3):P):I},t.deflateSetDictionary=function(o,d){var e=d.length,p,n,i,r,a,s,l,c;if(!o||!o.state)return I;if(p=o.state,2===(r=p.wrap)||1===r&&p.status!==K||p.lookahead)return I;for(1===r&&(o.adler=x(o.adler,d,e,0)),p.wrap=0,e>=p.w_size&&(0===r&&(U(p.head),p.strstart=0,p.block_start=0,p.insert=0),c=new y.Buf8(p.w_size),y.arraySet(c,d,e-p.w_size,p.w_size,0),d=c,e=p.w_size),a=o.avail_in,s=o.next_in,l=o.input,o.avail_in=e,o.next_in=0,o.input=d,j(p);p.lookahead>=Y;){n=p.strstart,i=p.lookahead-(Y-1);do p.ins_h=(p.ins_h<<p.hash_shift^p.window[n+Y-1])&p.hash_mask,p.prev[n&p.w_mask]=p.head[p.ins_h],p.head[p.ins_h]=n,n++;while(--i);p.strstart=n,p.lookahead=Y-1,j(p)}return p.strstart+=p.lookahead,p.block_start=p.strstart,p.insert=p.lookahead,p.lookahead=0,p.match_length=p.prev_length=Y-1,p.match_available=0,o.next_in=s,o.input=l,o.avail_in=a,p.wrap=r,P},t.deflateInfo="pako deflate (from Nodeca project)"},function(I,t,e){"use strict";function n(a){for(var t=a.length;0<=--t;)a[t]=0}function R(a,t,e,o,n){this.static_tree=a,this.extra_bits=t,this.extra_base=e,this.elems=o,this.max_length=n,this.has_stree=a&&a.length}function r(a,t){this.dyn_tree=a,this.max_code=0,this.stat_desc=t}function O(e){return 256>e?K[e]:K[256+(e>>>7)]}function a(a,t){a.pending_buf[a.pending++]=255&t,a.pending_buf[a.pending++]=255&t>>>8}function ee(o,t,e){o.bi_valid>B-e?(o.bi_buf|=65535&t<<o.bi_valid,a(o,o.bi_buf),o.bi_buf=t>>B-o.bi_valid,o.bi_valid+=e-B):(o.bi_buf|=65535&t<<o.bi_valid,o.bi_valid+=e)}function l(a,t,e){ee(a,e[2*t],e[2*t+1])}function i(a,t){var e=0;do e|=1&a,a>>>=1,e<<=1;while(0<--t);return e>>>1}function o(e){16===e.bi_valid?(a(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}function u(_,t){var e=t.dyn_tree,l=t.max_code,c=t.stat_desc.static_tree,h=t.stat_desc.has_stree,u=t.stat_desc.extra_bits,g=t.stat_desc.extra_base,d=t.stat_desc.max_length,f=0,m,n,i,r,o,a;for(r=0;r<=U;r++)_.bl_count[r]=0;for(e[2*_.heap[_.heap_max]+1]=0,m=_.heap_max+1;m<N;m++)(r=e[2*e[2*(n=_.heap[m])+1]+1]+1)>d&&(r=d,f++),e[2*n+1]=r,n>l||(_.bl_count[r]++,o=0,n>=g&&(o=u[n-g]),a=e[2*n],_.opt_len+=a*(r+o),h&&(_.static_len+=a*(c[2*n+1]+o)));if(0!==f){do{for(r=d-1;0===_.bl_count[r];)r--;_.bl_count[r]--,_.bl_count[r+1]+=2,_.bl_count[d]--,f-=2}while(0<f);for(r=d;0!==r;r--)for(n=_.bl_count[r];0!==n;)(i=_.heap[--m])>l||(e[2*i+1]!==r&&(_.opt_len+=(r-e[2*i+1])*e[2*i],e[2*i+1]=r),n--)}}function p(l,t,e){var n=Array(U+1),o=0,a,c;for(a=1;a<=U;a++)n[a]=o=o+e[a-1]<<1;for(c=0;c<=t;c++){var r=l[2*c+1];0!==r&&(l[2*c]=i(n[r]++,r))}}function s(){var r=Array(U+1),a,t,e,n,l;for(e=0,n=0;n<L-1;n++)for($[n]=e,a=0;a<1<<j[n];a++)Q[e++]=n;for(Q[e-1]=n,l=0,n=0;16>n;n++)for(te[n]=l,a=0;a<1<<q[n];a++)K[l++]=n;for(l>>=7;n<k;n++)for(te[n]=l<<7,a=0;a<1<<q[n]-7;a++)K[256+l++]=n;for(t=0;t<=U;t++)r[t]=0;for(a=0;143>=a;)Z[2*a+1]=8,a++,r[8]++;for(;255>=a;)Z[2*a+1]=9,a++,r[9]++;for(;279>=a;)Z[2*a+1]=7,a++,r[7]++;for(;287>=a;)Z[2*a+1]=8,a++,r[8]++;for(p(Z,D+1,r),a=0;a<k;a++)J[2*a+1]=5,J[2*a]=i(a,5);oe=new R(Z,j,A+1,D,U),re=new R(J,q,0,k,U),ne=new R([],X,0,F,z)}function c(a){var t;for(t=0;t<D;t++)a.dyn_ltree[2*t]=0;for(t=0;t<k;t++)a.dyn_dtree[2*t]=0;for(t=0;t<F;t++)a.bl_tree[2*t]=0;a.dyn_ltree[2*G]=1,a.opt_len=a.static_len=0,a.last_lit=a.matches=0}function d(e){8<e.bi_valid?a(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function m(o,t,e,r){d(o),r&&(a(o,e),a(o,~e)),E.arraySet(o.pending_buf,o.window,t,e,o.pending),o.pending+=e}function _(a,t,e,n){var i=2*t,r=2*e;return a[i]<a[r]||a[i]===a[r]&&n[t]<=n[e]}function h(a,t,e){for(var o=a.heap[e],n=e<<1;n<=a.heap_len&&(n<a.heap_len&&_(t,a.heap[n+1],a.heap[n],a.depth)&&n++,!_(t,o,a.heap[n],a.depth));)a.heap[e]=a.heap[n],e=n,n<<=1;a.heap[e]=o}function g(a,t,e){var n=0,c,i,r,o;if(0!==a.last_lit)do c=a.pending_buf[a.d_buf+2*n]<<8|a.pending_buf[a.d_buf+2*n+1],i=a.pending_buf[a.l_buf+n],n++,0===c?l(a,i,t):(l(a,(r=Q[i])+A+1,t),0!==(o=j[r])&&ee(a,i-=$[r],o),l(a,r=O(--c),e),0!==(o=q[r])&&ee(a,c-=te[r],o));while(n<a.last_lit);l(a,G,t)}function f(d,t){var e=t.dyn_tree,o=t.stat_desc.static_tree,a=t.stat_desc.has_stree,s=t.stat_desc.elems,l=-1,c,n,i;for(d.heap_len=0,d.heap_max=N,c=0;c<s;c++)0===e[2*c]?e[2*c+1]=0:(d.heap[++d.heap_len]=l=c,d.depth[c]=0);for(;2>d.heap_len;)e[2*(i=d.heap[++d.heap_len]=2>l?++l:0)]=1,d.depth[i]=0,d.opt_len--,a&&(d.static_len-=o[2*i+1]);for(t.max_code=l,c=d.heap_len>>1;1<=c;c--)h(d,e,c);i=s;do c=d.heap[1],d.heap[1]=d.heap[d.heap_len--],h(d,e,1),n=d.heap[1],d.heap[--d.heap_max]=c,d.heap[--d.heap_max]=n,e[2*i]=e[2*c]+e[2*n],d.depth[i]=(d.depth[c]>=d.depth[n]?d.depth[c]:d.depth[n])+1,e[2*c+1]=e[2*n+1]=i,d.heap[1]=i++,h(d,e,1);while(2<=d.heap_len);d.heap[--d.heap_max]=d.heap[1],u(d,t),p(e,l,d.bl_count)}function y(d,t,e){var n=-1,o=t[1],a=0,s=7,l=4,c,i;for(0===o&&(s=138,l=3),t[2*(e+1)+1]=65535,c=0;c<=e;c++)i=o,o=t[2*(c+1)+1],++a<s&&i===o||(a<l?d.bl_tree[2*i]+=a:0===i?10>=a?d.bl_tree[2*V]++:d.bl_tree[2*W]++:(i!==n&&d.bl_tree[2*i]++,d.bl_tree[2*H]++),a=0,n=i,0===o?(s=138,l=3):i===o?(s=6,l=3):(s=7,l=4))}function b(c,t,e){var n=-1,o=t[1],a=0,s=7,d=4,p,i;for(0===o&&(s=138,d=3),p=0;p<=e;p++)if(i=o,o=t[2*(p+1)+1],!(++a<s&&i===o)){if(a<d)do l(c,i,c.bl_tree);while(0!=--a);else 0===i?10>=a?(l(c,V,c.bl_tree),ee(c,a-3,3)):(l(c,W,c.bl_tree),ee(c,a-11,7)):(i!==n&&(l(c,i,c.bl_tree),a--),l(c,H,c.bl_tree),ee(c,a-3,2));a=0,n=i,0===o?(s=138,d=3):i===o?(s=6,d=3):(s=7,d=4)}}function x(a){var t;for(y(a,a.dyn_ltree,a.l_desc.max_code),y(a,a.dyn_dtree,a.d_desc.max_code),f(a,a.bl_desc),t=F-1;3<=t&&0===a.bl_tree[2*Y[t]+1];t--);return a.opt_len+=3*(t+1)+5+5+4,t}function v(a,t,e,o){var n;for(ee(a,t-257,5),ee(a,e-1,5),ee(a,o-4,4),n=0;n<o;n++)ee(a,a.bl_tree[2*Y[n]+1],3);b(a,a.dyn_ltree,t-1),b(a,a.dyn_dtree,e-1)}function S(a){var t=4093624447,o;for(o=0;31>=o;o++,t>>>=1)if(1&t&&0!==a.dyn_ltree[2*o])return T;if(0!==a.dyn_ltree[18]||0!==a.dyn_ltree[20]||0!==a.dyn_ltree[26])return M;for(o=32;o<A;o++)if(0!==a.dyn_ltree[2*o])return M;return T}function w(a,t,e,o){ee(a,(P<<1)+(o?1:0),3),m(a,t,e,!0)}var E=e(2),T=0,M=1,P=0,C=1,L=29,A=256,D=A+1+L,k=30,F=19,N=2*D+1,U=15,B=16,z=7,G=256,H=16,V=17,W=18,j=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],q=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],X=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Y=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Z=Array(2*(D+2));n(Z);var J=Array(2*k);n(J);var K=Array(512);n(K);var Q=Array(256);n(Q);var $=Array(L);n($);var te=Array(k);n(te);var ae=!1,oe,re,ne;t._tr_init=function(e){ae||(s(),ae=!0),e.l_desc=new r(e.dyn_ltree,oe),e.d_desc=new r(e.dyn_dtree,re),e.bl_desc=new r(e.bl_tree,ne),e.bi_buf=0,e.bi_valid=0,c(e)},t._tr_stored_block=w,t._tr_flush_block=function(l,t,e,n){var i=0,a,r;0<l.level?(l.strm.data_type===2&&(l.strm.data_type=S(l)),f(l,l.l_desc),f(l,l.d_desc),i=x(l),a=l.opt_len+3+7>>>3,(r=l.static_len+3+7>>>3)<=a&&(a=r)):a=r=e+5,e+4<=a&&-1!==t?w(l,t,e,n):l.strategy===4||r===a?(ee(l,(C<<1)+(n?1:0),3),g(l,Z,J)):(ee(l,(2<<1)+(n?1:0),3),v(l,l.l_desc.max_code+1,l.d_desc.max_code+1,i+1),g(l,l.dyn_ltree,l.dyn_dtree)),c(l),n&&d(l)},t._tr_tally=function(a,t,e){return a.pending_buf[a.d_buf+2*a.last_lit]=255&t>>>8,a.pending_buf[a.d_buf+2*a.last_lit+1]=255&t,a.pending_buf[a.l_buf+a.last_lit]=255&e,a.last_lit++,0===t?a.dyn_ltree[2*e]++:(a.matches++,t--,a.dyn_ltree[2*(Q[e]+A+1)]++,a.dyn_dtree[2*O(t)]++),a.last_lit===a.lit_bufsize-1},t._tr_align=function(e){ee(e,C<<1,3),l(e,G,Z),o(e)}},function(d,t,e){"use strict";function m(a){if(!(this instanceof m))return new m(a);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},a||{});var t=this.options;t.raw&&0<=t.windowBits&&16>t.windowBits&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(0<=t.windowBits&&16>t.windowBits)||a&&a.windowBits||(t.windowBits+=32),15<t.windowBits&&48>t.windowBits&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new i,this.strm.avail_out=0;var e=g.inflateInit2(this.strm,t.windowBits);if(e!==s.Z_OK)throw new Error(r[e]);this.header=new l,g.inflateGetHeader(this.strm,this.header)}function n(a,t){var e=new m(t);if(e.push(a,!0),e.err)throw e.msg;return e.result}var g=e(116),o=e(2),a=e(54),s=e(56),r=e(20),i=e(55),l=e(119),y=Object.prototype.toString;m.prototype.push=function(l,p){var b=this.strm,d=this.options.chunkSize,f=this.options.dictionary,x=!1,_,n,i,r,c,h;if(this.ended)return!1;n=p===~~p?p:!0===p?s.Z_FINISH:s.Z_NO_FLUSH,b.input="string"==typeof l?a.binstring2buf(l):"[object ArrayBuffer]"===y.call(l)?new Uint8Array(l):l,b.next_in=0,b.avail_in=b.input.length;do{if(0===b.avail_out&&(b.output=new o.Buf8(d),b.next_out=0,b.avail_out=d),(_=g.inflate(b,s.Z_NO_FLUSH))===s.Z_NEED_DICT&&f&&(h="string"==typeof f?a.string2buf(f):"[object ArrayBuffer]"===y.call(f)?new Uint8Array(f):f,_=g.inflateSetDictionary(this.strm,h)),_===s.Z_BUF_ERROR&&!0===x&&(_=s.Z_OK,x=!1),_!==s.Z_STREAM_END&&_!==s.Z_OK)return this.onEnd(_),this.ended=!0,!1;b.next_out&&(0!==b.avail_out&&_!==s.Z_STREAM_END&&(0!==b.avail_in||n!==s.Z_FINISH&&n!==s.Z_SYNC_FLUSH)||("string"===this.options.to?(i=a.utf8border(b.output,b.next_out),r=b.next_out-i,c=a.buf2string(b.output,i),b.next_out=r,b.avail_out=d-r,r&&o.arraySet(b.output,b.output,i,r,0),this.onData(c)):this.onData(o.shrinkBuf(b.output,b.next_out)))),0===b.avail_in&&0===b.avail_out&&(x=!0)}while((0<b.avail_in||0===b.avail_out)&&_!==s.Z_STREAM_END);return _===s.Z_STREAM_END&&(n=s.Z_FINISH),n===s.Z_FINISH?(_=g.inflateEnd(this.strm),this.onEnd(_),this.ended=!0,_===s.Z_OK):n!==s.Z_SYNC_FLUSH||(this.onEnd(s.Z_OK),b.avail_out=0,!0)},m.prototype.onData=function(e){this.chunks.push(e)},m.prototype.onEnd=function(e){e===s.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=m,t.inflate=n,t.inflateRaw=function(a,t){return t=t||{},t.raw=!0,n(a,t)},t.ungzip=n},function(y,t,e){"use strict";function x(e){return(255&e>>>24)+(65280&e>>>8)+((65280&e)<<8)+((255&e)<<24)}function T(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new h.Buf16(320),this.work=new h.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function r(a){var t;return a&&a.state?(t=a.state,a.total_in=a.total_out=t.total=0,a.msg="",t.wrap&&(a.adler=1&t.wrap),t.mode=L,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new h.Buf32(l),t.distcode=t.distdyn=new h.Buf32(s),t.sane=1,t.back=-1,S):E}function o(a){var t;return a&&a.state?(t=a.state,t.wsize=0,t.whave=0,t.wnext=0,r(a)):E}function a(a,t){var r,n;return a&&a.state?(n=a.state,0>t?(r=0,t=-t):(r=1+(t>>4),48>t&&(t&=15)),t&&(8>t||15<t)?E:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,o(a))):E}function n(o,t){var e,r;return o?(r=new T,o.state=r,r.window=null,(e=a(o,t))!==S&&(o.state=null),e):E}function i(a){if(le){var t;for(se=new h.Buf32(512),u=new h.Buf32(32),t=0;144>t;)a.lens[t++]=8;for(;256>t;)a.lens[t++]=9;for(;280>t;)a.lens[t++]=7;for(;288>t;)a.lens[t++]=8;for(_(g,a.lens,0,288,se,0,a.work,{bits:9}),t=0;32>t;)a.lens[t++]=5;_(v,a.lens,0,32,u,0,a.work,{bits:5}),le=!1}a.lencode=se,a.lenbits=9,a.distcode=u,a.distbits=5}function c(a,t,e,n){var i=a.state,o;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new h.Buf8(i.wsize)),n>=i.wsize?(h.arraySet(i.window,t,e-i.wsize,i.wsize,0),i.wnext=0,i.whave=i.wsize):((o=i.wsize-i.wnext)>n&&(o=n),h.arraySet(i.window,t,e-n,o,i.wnext),(n-=o)?(h.arraySet(i.window,t,e-n,n,0),i.wnext=n,i.whave=i.wsize):(i.wnext+=o,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=o))),0}var h=e(2),d=e(52),f=e(53),m=e(117),_=e(118),g=1,v=2,b=4,w=6,S=0,E=-2,M=-3,P=-4,C=8,L=1,A=2,I=3,R=4,D=5,k=6,U=7,N=8,B=9,z=10,O=11,G=12,H=13,V=14,W=15,j=16,q=17,X=18,Y=19,Z=20,J=21,K=22,Q=23,$=24,ee=25,te=26,ae=27,oe=28,re=29,ne=30,ie=31,l=852,s=592,le=!0,se,u;t.inflateReset=o,t.inflateReset2=a,t.inflateResetKeep=r,t.inflateInit=function(e){return n(e,15)},t.inflateInit2=n,t.inflate=function(y,T){var e=0,le=new h.Buf8(4),se=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ce,n,r,o,a,s,l,u,p,de,pe,ue,me,_e,he,ge,fe,ye,be,xe,ve,Se,we,Ee;if(!y||!y.state||!y.output||!y.input&&0!==y.avail_in)return E;(ce=y.state).mode===G&&(ce.mode=H),a=y.next_out,r=y.output,l=y.avail_out,o=y.next_in,n=y.input,s=y.avail_in,u=ce.hold,p=ce.bits,de=s,pe=l,Se=S;t:for(;;)switch(ce.mode){case L:if(0===ce.wrap){ce.mode=H;break}for(;16>p;){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}if(2&ce.wrap&&35615===u){ce.check=0,le[0]=255&u,le[1]=255&u>>>8,ce.check=f(ce.check,le,2,0),u=0,p=0,ce.mode=A;break}if(ce.flags=0,ce.head&&(ce.head.done=!1),!(1&ce.wrap)||(((255&u)<<8)+(u>>8))%31){y.msg="incorrect header check",ce.mode=ne;break}if((15&u)!==C){y.msg="unknown compression method",ce.mode=ne;break}if(u>>>=4,p-=4,ve=8+(15&u),0===ce.wbits)ce.wbits=ve;else if(ve>ce.wbits){y.msg="invalid window size",ce.mode=ne;break}ce.dmax=1<<ve,y.adler=ce.check=1,ce.mode=512&u?z:G,u=0,p=0;break;case A:for(;16>p;){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}if(ce.flags=u,(255&ce.flags)!==C){y.msg="unknown compression method",ce.mode=ne;break}if(57344&ce.flags){y.msg="unknown header flags set",ce.mode=ne;break}ce.head&&(ce.head.text=1&u>>8),512&ce.flags&&(le[0]=255&u,le[1]=255&u>>>8,ce.check=f(ce.check,le,2,0)),u=0,p=0,ce.mode=I;case I:for(;32>p;){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}ce.head&&(ce.head.time=u),512&ce.flags&&(le[0]=255&u,le[1]=255&u>>>8,le[2]=255&u>>>16,le[3]=255&u>>>24,ce.check=f(ce.check,le,4,0)),u=0,p=0,ce.mode=R;case R:for(;16>p;){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}ce.head&&(ce.head.xflags=255&u,ce.head.os=u>>8),512&ce.flags&&(le[0]=255&u,le[1]=255&u>>>8,ce.check=f(ce.check,le,2,0)),u=0,p=0,ce.mode=D;case D:if(1024&ce.flags){for(;16>p;){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}ce.length=u,ce.head&&(ce.head.extra_len=u),512&ce.flags&&(le[0]=255&u,le[1]=255&u>>>8,ce.check=f(ce.check,le,2,0)),u=0,p=0}else ce.head&&(ce.head.extra=null);ce.mode=k;case k:if(1024&ce.flags&&((ue=ce.length)>s&&(ue=s),ue&&(ce.head&&(ve=ce.head.extra_len-ce.length,ce.head.extra||(ce.head.extra=Array(ce.head.extra_len)),h.arraySet(ce.head.extra,n,o,ue,ve)),512&ce.flags&&(ce.check=f(ce.check,n,ue,o)),s-=ue,o+=ue,ce.length-=ue),ce.length))break t;ce.length=0,ce.mode=U;case U:if(2048&ce.flags){if(0===s)break t;ue=0;do ve=n[o+ue++],ce.head&&ve&&65536>ce.length&&(ce.head.name+=F(ve));while(ve&&ue<s);if(512&ce.flags&&(ce.check=f(ce.check,n,ue,o)),s-=ue,o+=ue,ve)break t}else ce.head&&(ce.head.name=null);ce.length=0,ce.mode=N;case N:if(4096&ce.flags){if(0===s)break t;ue=0;do ve=n[o+ue++],ce.head&&ve&&65536>ce.length&&(ce.head.comment+=F(ve));while(ve&&ue<s);if(512&ce.flags&&(ce.check=f(ce.check,n,ue,o)),s-=ue,o+=ue,ve)break t}else ce.head&&(ce.head.comment=null);ce.mode=B;case B:if(512&ce.flags){for(;16>p;){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}if(u!==(65535&ce.check)){y.msg="header crc mismatch",ce.mode=ne;break}u=0,p=0}ce.head&&(ce.head.hcrc=1&ce.flags>>9,ce.head.done=!0),y.adler=ce.check=0,ce.mode=G;break;case z:for(;32>p;){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}y.adler=ce.check=x(u),u=0,p=0,ce.mode=O;case O:if(0===ce.havedict)return y.next_out=a,y.avail_out=l,y.next_in=o,y.avail_in=s,ce.hold=u,ce.bits=p,2;y.adler=ce.check=1,ce.mode=G;case G:if(T===5||T===w)break t;case H:if(ce.last){u>>>=7&p,p-=7&p,ce.mode=ae;break}for(;3>p;){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}switch(ce.last=1&u,u>>>=1,p-=1,3&u){case 0:ce.mode=V;break;case 1:if(i(ce),ce.mode=Z,T===w){u>>>=2,p-=2;break t}break;case 2:ce.mode=q;break;case 3:y.msg="invalid block type",ce.mode=ne;}u>>>=2,p-=2;break;case V:for(u>>>=7&p,p-=7&p;32>p;){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}if((65535&u)!=(65535^u>>>16)){y.msg="invalid stored block lengths",ce.mode=ne;break}if(ce.length=65535&u,u=0,p=0,ce.mode=W,T===w)break t;case W:ce.mode=j;case j:if(ue=ce.length){if(ue>s&&(ue=s),ue>l&&(ue=l),0===ue)break t;h.arraySet(r,n,o,ue,a),s-=ue,o+=ue,l-=ue,a+=ue,ce.length-=ue;break}ce.mode=G;break;case q:for(;14>p;){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}if(ce.nlen=257+(31&u),u>>>=5,p-=5,ce.ndist=1+(31&u),u>>>=5,p-=5,ce.ncode=4+(15&u),u>>>=4,p-=4,286<ce.nlen||30<ce.ndist){y.msg="too many length or distance symbols",ce.mode=ne;break}ce.have=0,ce.mode=X;case X:for(;ce.have<ce.ncode;){for(;3>p;){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}ce.lens[se[ce.have++]]=7&u,u>>>=3,p-=3}for(;19>ce.have;)ce.lens[se[ce.have++]]=0;if(ce.lencode=ce.lendyn,ce.lenbits=7,we={bits:ce.lenbits},Se=_(0,ce.lens,0,19,ce.lencode,0,ce.work,we),ce.lenbits=we.bits,Se){y.msg="invalid code lengths set",ce.mode=ne;break}ce.have=0,ce.mode=Y;case Y:for(;ce.have<ce.nlen+ce.ndist;){for(;e=ce.lencode[u&(1<<ce.lenbits)-1],he=e>>>24,ge=255&e>>>16,fe=65535&e,!(he<=p);){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}if(16>fe)u>>>=he,p-=he,ce.lens[ce.have++]=fe;else{if(16===fe){for(Ee=he+2;p<Ee;){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}if(u>>>=he,p-=he,0===ce.have){y.msg="invalid bit length repeat",ce.mode=ne;break}ve=ce.lens[ce.have-1],ue=3+(3&u),u>>>=2,p-=2}else if(17===fe){for(Ee=he+3;p<Ee;){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}p-=he,ve=0,ue=3+(7&(u>>>=he)),u>>>=3,p-=3}else{for(Ee=he+7;p<Ee;){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}p-=he,ve=0,ue=11+(127&(u>>>=he)),u>>>=7,p-=7}if(ce.have+ue>ce.nlen+ce.ndist){y.msg="invalid bit length repeat",ce.mode=ne;break}for(;ue--;)ce.lens[ce.have++]=ve}}if(ce.mode===ne)break;if(0===ce.lens[256]){y.msg="invalid code -- missing end-of-block",ce.mode=ne;break}if(ce.lenbits=9,we={bits:ce.lenbits},Se=_(g,ce.lens,0,ce.nlen,ce.lencode,0,ce.work,we),ce.lenbits=we.bits,Se){y.msg="invalid literal/lengths set",ce.mode=ne;break}if(ce.distbits=6,ce.distcode=ce.distdyn,we={bits:ce.distbits},Se=_(v,ce.lens,ce.nlen,ce.ndist,ce.distcode,0,ce.work,we),ce.distbits=we.bits,Se){y.msg="invalid distances set",ce.mode=ne;break}if(ce.mode=Z,T===w)break t;case Z:ce.mode=J;case J:if(6<=s&&258<=l){y.next_out=a,y.avail_out=l,y.next_in=o,y.avail_in=s,ce.hold=u,ce.bits=p,m(y,pe),a=y.next_out,r=y.output,l=y.avail_out,o=y.next_in,n=y.input,s=y.avail_in,u=ce.hold,p=ce.bits,ce.mode===G&&(ce.back=-1);break}for(ce.back=0;e=ce.lencode[u&(1<<ce.lenbits)-1],he=e>>>24,ge=255&e>>>16,fe=65535&e,!(he<=p);){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}if(ge&&0==(240&ge)){for(ye=he,be=ge,xe=fe;e=ce.lencode[xe+((u&(1<<ye+be)-1)>>ye)],he=e>>>24,ge=255&e>>>16,fe=65535&e,!(ye+he<=p);){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}u>>>=ye,p-=ye,ce.back+=ye}if(u>>>=he,p-=he,ce.back+=he,ce.length=fe,0===ge){ce.mode=te;break}if(32&ge){ce.back=-1,ce.mode=G;break}if(64&ge){y.msg="invalid literal/length code",ce.mode=ne;break}ce.extra=15&ge,ce.mode=K;case K:if(ce.extra){for(Ee=ce.extra;p<Ee;){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}ce.length+=u&(1<<ce.extra)-1,u>>>=ce.extra,p-=ce.extra,ce.back+=ce.extra}ce.was=ce.length,ce.mode=Q;case Q:for(;e=ce.distcode[u&(1<<ce.distbits)-1],he=e>>>24,ge=255&e>>>16,fe=65535&e,!(he<=p);){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}if(0==(240&ge)){for(ye=he,be=ge,xe=fe;e=ce.distcode[xe+((u&(1<<ye+be)-1)>>ye)],he=e>>>24,ge=255&e>>>16,fe=65535&e,!(ye+he<=p);){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}u>>>=ye,p-=ye,ce.back+=ye}if(u>>>=he,p-=he,ce.back+=he,64&ge){y.msg="invalid distance code",ce.mode=ne;break}ce.offset=fe,ce.extra=15&ge,ce.mode=$;case $:if(ce.extra){for(Ee=ce.extra;p<Ee;){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}ce.offset+=u&(1<<ce.extra)-1,u>>>=ce.extra,p-=ce.extra,ce.back+=ce.extra}if(ce.offset>ce.dmax){y.msg="invalid distance too far back",ce.mode=ne;break}ce.mode=ee;case ee:if(0===l)break t;if(ue=pe-l,ce.offset>ue){if((ue=ce.offset-ue)>ce.whave&&ce.sane){y.msg="invalid distance too far back",ce.mode=ne;break}ue>ce.wnext?(ue-=ce.wnext,me=ce.wsize-ue):me=ce.wnext-ue,ue>ce.length&&(ue=ce.length),_e=ce.window}else _e=r,me=a-ce.offset,ue=ce.length;ue>l&&(ue=l),l-=ue,ce.length-=ue;do r[a++]=_e[me++];while(--ue);0===ce.length&&(ce.mode=J);break;case te:if(0===l)break t;r[a++]=ce.length,l--,ce.mode=J;break;case ae:if(ce.wrap){for(;32>p;){if(0===s)break t;s--,u|=n[o++]<<p,p+=8}if(pe-=l,y.total_out+=pe,ce.total+=pe,pe&&(y.adler=ce.check=ce.flags?f(ce.check,r,pe,a-pe):d(ce.check,r,pe,a-pe)),pe=l,(ce.flags?u:x(u))!==ce.check){y.msg="incorrect data check",ce.mode=ne;break}u=0,p=0}ce.mode=oe;case oe:if(ce.wrap&&ce.flags){for(;32>p;){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}if(u!==(4294967295&ce.total)){y.msg="incorrect length check",ce.mode=ne;break}u=0,p=0}ce.mode=re;case re:Se=1;break t;case ne:Se=M;break t;case ie:return P;case 32:default:return E;}return y.next_out=a,y.avail_out=l,y.next_in=o,y.avail_in=s,ce.hold=u,ce.bits=p,(ce.wsize||pe!==y.avail_out&&ce.mode<ne&&(ce.mode<ae||T!==b))&&c(y,y.output,y.next_out,pe-y.avail_out)?(ce.mode=ie,P):(de-=y.avail_in,pe-=y.avail_out,y.total_in+=de,y.total_out+=pe,ce.total+=pe,ce.wrap&&pe&&(y.adler=ce.check=ce.flags?f(ce.check,r,pe,y.next_out-pe):d(ce.check,r,pe,y.next_out-pe)),y.data_type=ce.bits+(ce.last?64:0)+(ce.mode===G?128:0)+(ce.mode===Z||ce.mode===W?256:0),(0===de&&0===pe||T===b)&&Se===S&&(Se=-5),Se)},t.inflateEnd=function(a){if(!a||!a.state)return E;var o=a.state;return o.window&&(o.window=null),a.state=null,S},t.inflateGetHeader=function(a,t){var e;return a&&a.state?0==(2&(e=a.state).wrap)?E:(e.head=t,t.done=!1,S):E},t.inflateSetDictionary=function(a,t){var e=t.length,o,r;return a&&a.state?0!==(o=a.state).wrap&&o.mode!==O?E:o.mode===O&&(r=1,(r=d(r,t,e,0))!==o.check)?M:c(a,t,e,e)?(o.mode=ie,P):(o.havedict=1,S):E},t.inflateInfo="pako inflate (from Nodeca project)"},function(e){"use strict";e.exports=function(P,t){var e,n,i,r,o,a,s,l,c,h,u,p,d,f,m,_,g,y,v,b,w,x,S,E,M;e=P.state,n=P.next_in,E=P.input,i=n+(P.avail_in-5),r=P.next_out,M=P.output,o=r-(t-P.avail_out),a=r+(P.avail_out-257),s=e.dmax,l=e.wsize,c=e.whave,h=e.wnext,u=e.window,p=e.hold,d=e.bits,f=e.lencode,m=e.distcode,_=(1<<e.lenbits)-1,g=(1<<e.distbits)-1;t:do{15>d&&(p+=E[n++]<<d,d+=8,p+=E[n++]<<d,d+=8),y=f[p&_];e:for(;;){if(v=y>>>24,p>>>=v,d-=v,0===(v=255&y>>>16))M[r++]=65535&y;else{if(!(16&v)){if(0==(64&v)){y=f[(65535&y)+(p&(1<<v)-1)];continue e}if(32&v){e.mode=12;break t}P.msg="invalid literal/length code",e.mode=30;break t}b=65535&y,(v&=15)&&(d<v&&(p+=E[n++]<<d,d+=8),b+=p&(1<<v)-1,p>>>=v,d-=v),15>d&&(p+=E[n++]<<d,d+=8,p+=E[n++]<<d,d+=8),y=m[p&g];n:for(;;){if(v=y>>>24,p>>>=v,d-=v,!(16&(v=255&y>>>16))){if(0==(64&v)){y=m[(65535&y)+(p&(1<<v)-1)];continue n}P.msg="invalid distance code",e.mode=30;break t}if(w=65535&y,v&=15,d<v&&(p+=E[n++]<<d,(d+=8)<v&&(p+=E[n++]<<d,d+=8)),(w+=p&(1<<v)-1)>s){P.msg="invalid distance too far back",e.mode=30;break t}if(p>>>=v,d-=v,v=r-o,w>v){if((v=w-v)>c&&e.sane){P.msg="invalid distance too far back",e.mode=30;break t}if(x=0,S=u,0===h){if(x+=l-v,v<b){b-=v;do M[r++]=u[x++];while(--v);x=r-w,S=M}}else if(h<v){if(x+=l+h-v,(v-=h)<b){b-=v;do M[r++]=u[x++];while(--v);if(x=0,h<b){b-=v=h;do M[r++]=u[x++];while(--v);x=r-w,S=M}}}else if(x+=h-v,v<b){b-=v;do M[r++]=u[x++];while(--v);x=r-w,S=M}for(;2<b;)M[r++]=S[x++],M[r++]=S[x++],M[r++]=S[x++],b-=3;b&&(M[r++]=S[x++],1<b&&(M[r++]=S[x++]))}else{x=r-w;do M[r++]=M[x++],M[r++]=M[x++],M[r++]=M[x++],b-=3;while(2<b);b&&(M[r++]=M[x++],1<b&&(M[r++]=M[x++]))}break}}break}}while(n<i&&r<a);n-=b=d>>3,p&=(1<<(d-=b<<3))-1,P.next_in=n,P.next_out=r,P.avail_in=n<i?i-n+5:5-(n-i),P.avail_out=r<a?a-r+257:257-(r-a),e.hold=p,e.bits=d}},function(l,t,e){"use strict";var B=e(2),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],r=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],a=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];l.exports=function(s,t,e,n,l,c,h,u){var p=u.bits,x=0,S=0,E=0,M=0,T=0,A=0,P=0,I=0,C=0,L=0,R=null,k=0,D=new B.Buf16(16),z=new B.Buf16(16),F=null,U=0,N,d,f,m,_,g,y,v,b;for(x=0;15>=x;x++)D[x]=0;for(S=0;S<n;S++)D[t[e+S]]++;for(T=p,M=15;1<=M&&0===D[M];M--);if(T>M&&(T=M),0===M)return l[c++]=20971520,l[c++]=20971520,u.bits=1,0;for(E=1;E<M&&0===D[E];E++);for(T<E&&(T=E),I=1,x=1;15>=x;x++)if(I<<=1,0>(I-=D[x]))return-1;if(0<I&&(0===s||1!==M))return-1;for(z[1]=0,x=1;15>x;x++)z[x+1]=z[x]+D[x];for(S=0;S<n;S++)0!==t[e+S]&&(h[z[t[e+S]]++]=S);if(0===s?(R=F=h,g=19):1===s?(R=i,k-=257,F=r,U-=257,g=256):(R=o,F=a,g=-1),L=0,S=0,x=E,_=c,A=T,P=0,f=-1,C=1<<T,m=C-1,1===s&&852<C||2===s&&592<C)return 1;for(;;){0,y=x-P,h[S]<g?(v=0,b=h[S]):h[S]>g?(v=F[U+h[S]],b=R[k+h[S]]):(v=96,b=0),N=1<<x-P,E=d=1<<A;do l[_+(L>>P)+(d-=N)]=0|(y<<24|v<<16|b);while(0!==d);for(N=1<<x-1;L&N;)N>>=1;if(0===N?L=0:(L&=N-1,L+=N),S++,0==--D[x]){if(x===M)break;x=t[e+h[S]]}if(x>T&&(L&m)!==f){for(0===P&&(P=T),_+=E,I=1<<(A=x-P);A+P<M&&!(0>=(I-=D[A+P]));)A++,I<<=1;if(C+=1<<A,1===s&&852<C||2===s&&592<C)return 1;l[f=L&m]=0|(T<<24|A<<16|_-c)}}return 0!==L&&(l[_+L]=0|(x-P<<24|4194304)),u.bits=T,0}},function(e){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(d,t,e){"use strict";function p(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function i(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))||"function"==typeof o)?o:a}function r(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var u=e(41),a=e(21),o=e.n(a),n=function(){function a(a,o){for(var e=0,r;e<o.length;e++)r=o[e],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,r.key,r)}return function(t,e,o){return e&&a(t.prototype,e),o&&a(t,o),t}}(),l=function(a){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:u.a;p(this,t);var o=i(this,a.call(this));return o._loaded=-1,o._totalLoaded=-1,o._parsed=-1,o._totalParsed=-1,o._data=[],o._container=e,o._progressBar=null,o._container&&r&&(o._progressBar=new r(o._container)),o}return r(t,a),t.prototype.free=function(){this._container=null,this._progressBar&&(this._progressBar.free(),this._progressBar=null)},t.prototype.fetch=function(l){var s=this;return new Promise(function(e,n){var i=new XMLHttpRequest;i.open("GET",l),i.crossOrigin=!0,i.responseType="arraybuffer",i.onloadstart=function(){s.emit("fetch-start",{file:l,time:new Date})},i.onload=function(r){if(200===i.status){s._loaded=r.loaded,s._totalLoaded=r.total,s._progressBar&&s._progressBar.update(s._loaded,s._totalLoaded,"load");var o=i.response;s.emit("fetch-success",{file:l,time:new Date,totalLoaded:r.total}),e({url:l,buffer:o})}else n(i.statusText)},i.onerror=function(){s.emit("fetch-error",{file:l,time:new Date}),n(i.statusText)},i.onabort=function(){s.emit("fetch-abort",{file:l,time:new Date}),n(i.statusText)},i.ontimeout=function(){s.emit("fetch-timeout",{file:l,time:new Date}),n(i.statusText)},i.onprogress=function(e){s._loaded=e.loaded,s._totalLoaded=e.total,s.emit("fetch-progress",{file:l,total:e.total,loaded:e.loaded,time:new Date}),s._progressBar&&s._progressBar.update(s._loaded,s._totalLoaded,"load")},i.onloadend=function(){s.emit("fetch-end",{file:l,time:new Date})},i.send()})},t.prototype.parse=function(a){return new Promise(function(t){t(a)})},t.prototype.loadSequenceGroup=function(a){var o=this,e=[];return a.forEach(function(a){e.push(o.fetch(a))}),Promise.all(e).then(function(e){return o.parse(e)}).then(function(e){return o._data.push(e),e}).catch(function(e){window.console.log("oops... something went wrong..."),window.console.log(e)})},t.prototype.loadSequence=function(a){var o=this;return this.fetch(a).then(function(e){return o.parse(e)}).then(function(e){return o._data.push(e),e}).catch(function(e){window.console.log("oops... something went wrong..."),window.console.log(e)})},t.prototype.load=function(a){var o=this;Array.isArray(a)||(a=[a]),this.emit("load-start",{files:a,time:new Date});var e=[];return a.forEach(function(a){Array.isArray(a)?e.push(o.loadSequenceGroup(a)):e.push(o.loadSequence(a))}),Promise.all(e)},n(t,[{key:"data",set:function(e){this._data=e},get:function(){return this._data}}]),t}(o.a);t.a=l},function(d,t,e){"use strict";var y=e(122),i=e(123),r=e(124),o=e(58),a=e(125),s=e(128),l=e(26),c=e(129),h=e(130),u=127;d.exports=function(b){var t,x,n,d,f,m,_;if(x=0>b||1/b===i?"1":"0",b===y||b===i)return d=l("1",8),n=l("0",23),x+d+n;if(b!==b)return d=l("1",8),n="1"+l("0",22),x+d+n;if(0===b)return d=l("0",8),n=l("0",23),x+d+n;if(b=r(b),f=o(b),m=b-f,f=c(f),m=h(m),f)d=f.length-1;else{for(_=0;_<m.length;_++)if("1"===m[_]){t=_+1;break}d=-t}return n=f+m,0>d?(d<=-u&&(t=u-1),n=n.substring(t)):n=n.substring(1),d=c(d+u),d=s(d,8,"0"),n=a(n,23,"0").substring(0,23),x+d+n}},function(e){"use strict";var t=new Float32Array(1);new Uint32Array(t.buffer)[0]=2139095040,e.exports=t[0]},function(e){"use strict";var t=new Float32Array(1);new Uint32Array(t.buffer)[0]=4286578688,e.exports=t[0]},function(e){"use strict";e.exports=function(e){return 0>e?-e:0===e?0:e}},function(l,t,e){"use strict";var s=e(24),i=e(25),r=e(59),o=e(26);l.exports=function(a,t,e){var n,l;if(!s(a))throw new TypeError("invalid input argument. First argument must be a string. Value: `"+a+"`.");if(!i(t))throw new TypeError("invalid input argument. Second argument must be a nonnegative integer. Value: `"+t+"`.");if(2<arguments.length){if(l=e,!s(l))throw new TypeError("invalid input argument. Third argument must be a string. Value: `"+l+"`.");if(0===l.length)throw new RangeError("invalid input argument. Pad string must not be an empty string.")}else l=" ";if(t>9007199254740991)throw new RangeError("invalid input argument. Output string length exceeds maximum allowed string length.");return 0>=(n=(t-a.length)/l.length)?a:(n=r(n),a+o(l,n))}},function(a,t,e){"use strict";var o=e(127);a.exports=function(e){return o(e)&&0==e%1}},function(e){"use strict";e.exports=function(e){return("number"==typeof e||"[object Number]"===Object.prototype.toString.call(e))&&e.valueOf()===e.valueOf()}},function(l,t,e){"use strict";var s=e(24),i=e(25),r=e(59),o=e(26);l.exports=function(a,t,e){var n,l;if(!s(a))throw new TypeError("invalid input argument. First argument must be a string. Value: `"+a+"`.");if(!i(t))throw new TypeError("invalid input argument. Second argument must be a nonnegative integer. Value: `"+t+"`.");if(2<arguments.length){if(l=e,!s(l))throw new TypeError("invalid input argument. Third argument must be a string. Value: `"+l+"`.");if(0===l.length)throw new RangeError("invalid input argument. Pad string must not be an empty string.")}else l=" ";if(t>9007199254740991)throw new RangeError("invalid input argument. Output string length exceeds maximum allowed string length.");return 0>=(n=(t-a.length)/l.length)?a:(n=r(n),o(l,n)+a)}},function(a,t,e){"use strict";var o=e(58);a.exports=function(a){for(var t="",r;0<a;)t=(r=a/2)===(a=o(r))?"0"+t:"1"+t;return t}},function(e){"use strict";var r=149;e.exports=function(i){var t,e,n,o;if(t="",0===i)return t;for(o=r,n=0;n<r&&(1<=(e=2*i)?(i=e-1,t+="1",o===r&&(o=n)):(i=e,t+="0"),!(1===e||n-o>24));n++);return t}},function(a,l,t){(function(m,s){var e,r,o;!function(t,a){void 0!==m&&m.exports?m.exports=a():(r=[],void 0!==(o="function"==typeof(e=a)?e.apply(l,r):e)&&(m.exports=o))}(0,function(){var a=function(_){return void 0===_&&(_={}),_.parseDicom=function(e,n){function r(a){if(void 0===a.elements.x00020010)throw"dicomParser.parseDicom: missing required meta header attribute 0002,0010";var t=a.elements.x00020010;return _.readFixedString(e,t.dataOffset,t.length)}function o(e){return"1.2.840.10008.1.2"!==e}function a(r,o){if("1.2.840.10008.1.2.1.99"===r){if(n&&n.inflater){var a=n.inflater(e,o);return new _.ByteStream(_.littleEndianByteArrayParser,a,0)}if(void 0!==m&&this.module!==m){var i=t(135),l=_.sharedCopy(e,o,e.length-o),c=i.inflateRawSync(l),h=_.alloc(e,c.length+o);return e.copy(h,0,0,o),c.copy(h,o),new _.ByteStream(_.littleEndianByteArrayParser,h,0)}if("undefined"!=typeof pako){var u=e.slice(o),p=pako.inflateRaw(u),d=_.alloc(e,p.length+o);return d.set(e.slice(0,o),0),d.set(p,o),new _.ByteStream(_.littleEndianByteArrayParser,d,0)}throw"dicomParser.parseDicom: no inflater available to handle deflate transfer syntax"}return"1.2.840.10008.1.2.2"===r?new _.ByteStream(_.bigEndianByteArrayParser,e,o):new _.ByteStream(_.littleEndianByteArrayParser,e,o)}function i(a,t){for(var e in a.elements)a.elements.hasOwnProperty(e)&&(t.elements[e]=a.elements[e]);return void 0!==a.warnings&&(t.warnings=a.warnings.concat(t.warnings)),t}function l(e){var t=r(e),s=o(t),i=a(t,e.position),l=new _.DataSet(i.byteArrayParser,i.byteArray,{});l.warnings=i.warnings;try{s?_.parseDicomDataSetExplicit(l,i,i.byteArray.length,n):_.parseDicomDataSetImplicit(l,i,i.byteArray.length,n)}catch(e){throw{exception:e,dataSet:l}}return l}if(void 0===e)throw"dicomParser.parseDicom: missing required parameter 'byteArray'";return function(){var a=_.readPart10Header(e,n);return i(a,l(a))}()},_}(a);return a=function(e){"use strict";return void 0===e&&(e={}),e.version="1.7.3",e}(a=function(e){"use strict";return void 0===e&&(e={}),e.sharedCopy=function(a,t,e){if(void 0!==s&&a instanceof s)return a.slice(t,t+e);if(a instanceof Uint8Array)return new Uint8Array(a.buffer,a.byteOffset+t,e);throw"dicomParser.from: unknown type for byteArray"},e}(a=function(e){"use strict";return void 0===e&&(e={}),e.readTag=function(e){if(void 0===e)throw"dicomParser.readTag: missing required parameter 'byteStream'";return"x"+("00000000"+(256*(256*e.readUint16())+e.readUint16()).toString(16)).substr(-8)},e}(a=function(a){"use strict";return void 0===a&&(a={}),a.readSequenceItem=function(t){if(void 0===t)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";var e={tag:a.readTag(t),length:t.readUint32(),dataOffset:t.position};if("xfffee000"!==e.tag)throw"dicomParser.readSequenceItem: item tag (FFFE,E000) not found at offset "+t.position;return e},a}(a=function(l){"use strict";function t(t,a){for(var o={},n;t.position<t.byteArray.length;)if(n=l.readDicomElementImplicit(t,void 0,a),o[n.tag]=n,"xfffee00d"===n.tag)return new l.DataSet(t.byteArrayParser,t.byteArray,o);return t.warnings.push("eof encountered before finding sequence item delimiter in sequence item of undefined length"),new l.DataSet(t.byteArrayParser,t.byteArray,o)}function s(e,a){var o=l.readSequenceItem(e);return 4294967295===o.length?(o.hadUndefinedLength=!0,o.dataSet=t(e,a),o.length=e.position-o.dataOffset):(o.dataSet=new l.DataSet(e.byteArrayParser,e.byteArray,{}),l.parseDicomDataSetImplicit(o.dataSet,e,e.position+o.length,{vrCallback:a})),o}function a(t,e,n){for(;t.position+4<=t.byteArray.length;){var r=l.readTag(t);if(t.seek(-4),"xfffee0dd"===r)return e.length=t.position-e.dataOffset,t.seek(8),e;var o=s(t,n);e.items.push(o)}t.warnings.push("eof encountered before finding sequence delimiter in sequence of undefined length"),e.length=t.byteArray.length-e.dataOffset}function o(a,t,e){for(var n=t.dataOffset+t.length,i;a.position<n;)i=s(a,e),t.items.push(i)}return void 0===l&&(l={}),l.readSequenceItemsImplicit=function(r,t,e){if(void 0===r)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";t.items=[],4294967295===t.length?a(r,t,e):o(r,t,e)},l}(a=function(l){"use strict";function t(t,a){for(var o={},n;t.position<t.byteArray.length;)if(n=l.readDicomElementExplicit(t,a),o[n.tag]=n,"xfffee00d"===n.tag)return new l.DataSet(t.byteArrayParser,t.byteArray,o);return a.push("eof encountered before finding item delimiter tag while reading sequence item of undefined length"),new l.DataSet(t.byteArrayParser,t.byteArray,o)}function s(e,a){var o=l.readSequenceItem(e);return 4294967295===o.length?(o.hadUndefinedLength=!0,o.dataSet=t(e,a),o.length=e.position-o.dataOffset):(o.dataSet=new l.DataSet(e.byteArrayParser,e.byteArray,{}),l.parseDicomDataSetExplicit(o.dataSet,e,e.position+o.length)),o}function a(t,e,n){for(;t.position+4<=t.byteArray.length;){var r=l.readTag(t);if(t.seek(-4),"xfffee0dd"===r)return e.length=t.position-e.dataOffset,t.seek(8),e;var o=s(t,n);e.items.push(o)}n.push("eof encountered before finding sequence delimitation tag while reading sequence of undefined length"),e.length=t.position-e.dataOffset}function o(a,t,e){for(var n=t.dataOffset+t.length,i;a.position<n;)i=s(a,e),t.items.push(i)}return void 0===l&&(l={}),l.readSequenceItemsExplicit=function(r,t,e){if(void 0===r)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";t.items=[],4294967295===t.length?a(r,t,e):o(r,t,e)},l}(a=function(l){return void 0===l&&(l={}),l.readPart10Header=function(t){function c(){if(i.seek(128),"DICM"!==i.readFixedString(4))throw"dicomParser.readPart10Header: DICM prefix not found at location 132 - this is not a valid DICOM P10 file."}if(void 0===t)throw"dicomParser.readPart10Header: missing required parameter 'byteArray'";var i=new l.ByteStream(l.littleEndianByteArrayParser,t);return function(){c();for(var t=[],e={};i.position<i.byteArray.length;){var r=i.position,o=l.readDicomElementExplicit(i,t);if("x0002ffff"<o.tag){i.position=r;break}o.parser=l.littleEndianByteArrayParser,e[o.tag]=o}var a=new l.DataSet(i.byteArrayParser,i.byteArray,e);return a.warnings=i.warnings,a.position=i.position,a}()},l}(a=function(_){"use strict";function t(a,t,o){for(var n=0,i=t;i<t+o;i++)n+=a[i].length;return n}return void 0===_&&(_={}),_.readEncapsulatedPixelDataFromFragments=function(e,n,i,r,o){if(r=r||1,o=o||n.fragments,void 0===e)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'dataSet'";if(void 0===n)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'pixelDataElement'";if(void 0===i)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'startFragmentIndex'";if(void 0===r)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'numFragments'";if("x7fe00010"!==n.tag)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(!0!==n.encapsulatedPixelData)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==n.hadUndefinedLength)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===n.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===n.fragments)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(0>=n.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(0>i)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be >= 0";if(i>=n.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be < number of fragments";if(1>r)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'numFragments' must be > 0";if(i+r>n.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragment' + 'numFragments' < number of fragments";var a=new _.ByteStream(e.byteArrayParser,e.byteArray,n.dataOffset),s=_.readSequenceItem(a);if("xfffee000"!==s.tag)throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";a.seek(s.length);var l=a.position;if(1===r)return _.sharedCopy(a.byteArray,l+o[i].offset+8,o[i].length);for(var c=t(o,i,r),h=_.alloc(a.byteArray,c),u=0,p=i;p<i+r;p++)for(var d=l+o[p].offset+8,g=0;g<o[p].length;g++)h[u++]=a.byteArray[d++];return h},_}(a=function(d){"use strict";function t(a,t){for(var o=0;o<a.length;o++)if(a[o].offset===t)return o}function e(a,t,e,l){if(a===t.length-1)return e.length-l;for(var i=t[a+1],r=l+1;r<e.length;r++)if(e[r].offset===i)return r-l;throw"dicomParser.calculateNumberOfFragmentsForFrame: could not find fragment with offset matching basic offset table"}return void 0===d&&(d={}),d.readEncapsulatedImageFrame=function(n,i,r,o,a){if(o=o||i.basicOffsetTable,a=a||i.fragments,void 0===n)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'dataSet'";if(void 0===i)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'pixelDataElement'";if(void 0===r)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'frameIndex'";if(void 0===o)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' does not have basicOffsetTable";if("x7fe00010"!==i.tag)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(!0!==i.encapsulatedPixelData)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==i.hadUndefinedLength)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have undefined length";if(void 0===i.fragments)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have fragments";if(0===o.length)throw"dicomParser.readEncapsulatedImageFrame: basicOffsetTable has zero entries";if(0>r)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be >= 0";if(r>=o.length)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be < basicOffsetTable.length";var s=t(a,o[r]);if(void 0===s)throw"dicomParser.readEncapsulatedImageFrame: unable to find fragment that matches basic offset table entry";var l=e(r,o,a,s);return d.readEncapsulatedPixelDataFromFragments(n,i,s,l,a)},d}(a=function(a){"use strict";function t(t,o,n){if(void 0!==n)return"SQ"===n(t.tag);if(o.position+4<=o.byteArray.length){var i=a.readTag(o);return o.seek(-4),"xfffee000"===i||"xfffee0dd"===i}return o.warnings.push("eof encountered before finding sequence item tag or sequence delimiter tag in peeking to determine VR"),!1}return void 0===a&&(a={}),a.readDicomElementImplicit=function(e,n,i){if(void 0===e)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var r={tag:a.readTag(e),length:e.readUint32(),dataOffset:e.position};return 4294967295===r.length&&(r.hadUndefinedLength=!0),r.tag===n?r:t(r,e,i)?(a.readSequenceItemsImplicit(e,r),r):r.hadUndefinedLength?(a.findItemDelimitationItemAndSetElementLength(e,r),r):(e.seek(r.length),r)},a}(a=function(a){"use strict";function t(e){return"OB"===e||"OW"===e||"SQ"===e||"OF"===e||"UT"===e||"UN"===e?4:2}return void 0===a&&(a={}),a.readDicomElementExplicit=function(e,n,i){if(void 0===e)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var r={tag:a.readTag(e),vr:e.readFixedString(2)};return 2===t(r.vr)?(r.length=e.readUint16(),r.dataOffset=e.position):(e.seek(2),r.length=e.readUint32(),r.dataOffset=e.position),4294967295===r.length&&(r.hadUndefinedLength=!0),r.tag===i?r:"SQ"===r.vr?(a.readSequenceItemsExplicit(e,r,n),r):4294967295===r.length?"x7fe00010"===r.tag?(a.findEndOfEncapsulatedElement(e,r,n),r):"UN"===r.vr?(a.findAndSetUNElementLength(e,r),r):(a.readSequenceItemsImplicit(e,r),r):(e.seek(r.length),r)},a}(a=function(l){"use strict";return void 0===l&&(l={}),l.parseDicomDataSetExplicit=function(t,e,n,i){if(n=void 0===n?e.byteArray.length:n,i=i||{},void 0===e)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if(n<e.position||n>e.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxPosition'";for(var r=t.elements,o;e.position<n;)if(o=l.readDicomElementExplicit(e,t.warnings,i.untilTag),r[o.tag]=o,o.tag===i.untilTag)return;if(e.position>n)throw"dicomParser:parseDicomDataSetExplicit: buffer overrun"},l.parseDicomDataSetImplicit=function(t,e,n,i){if(n=void 0===n?t.byteArray.length:n,i=i||{},void 0===e)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if(n<e.position||n>e.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";for(var r=t.elements,o;e.position<n;)if(o=l.readDicomElementImplicit(e,i.untilTag,i.vrCallback),r[o.tag]=o,o.tag===i.untilTag)return},l}(a=function(e){"use strict";return void 0===e&&(e={}),e.littleEndianByteArrayParser={readUint16:function(a,t){if(0>t)throw"littleEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>a.length)throw"littleEndianByteArrayParser.readUint16: attempt to read past end of buffer";return a[t]+256*a[t+1]},readInt16:function(a,t){if(0>t)throw"littleEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>a.length)throw"littleEndianByteArrayParser.readInt16: attempt to read past end of buffer";var e=a[t]+(a[t+1]<<8);return 32768&e&&(e=e-65535-1),e},readUint32:function(a,t){if(0>t)throw"littleEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>a.length)throw"littleEndianByteArrayParser.readUint32: attempt to read past end of buffer";return a[t]+256*a[t+1]+256*(256*a[t+2])+256*(256*(256*a[t+3]))},readInt32:function(a,t){if(0>t)throw"littleEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>a.length)throw"littleEndianByteArrayParser.readInt32: attempt to read past end of buffer";return a[t]+(a[t+1]<<8)+(a[t+2]<<16)+(a[t+3]<<24)},readFloat:function(a,t){if(0>t)throw"littleEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>a.length)throw"littleEndianByteArrayParser.readFloat: attempt to read past end of buffer";var e=new Uint8Array(4);return e[0]=a[t],e[1]=a[t+1],e[2]=a[t+2],e[3]=a[t+3],new Float32Array(e.buffer)[0]},readDouble:function(a,t){if(0>t)throw"littleEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>a.length)throw"littleEndianByteArrayParser.readDouble: attempt to read past end of buffer";var e=new Uint8Array(8);return e[0]=a[t],e[1]=a[t+1],e[2]=a[t+2],e[3]=a[t+3],e[4]=a[t+4],e[5]=a[t+5],e[6]=a[t+6],e[7]=a[t+7],new Float64Array(e.buffer)[0]}},e}(a=function(e){"use strict";return void 0===e&&(e={}),e.findItemDelimitationItemAndSetElementLength=function(a,t){if(void 0===a)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";for(var e=a.byteArray.length-8;a.position<=e;)if(65534===a.readUint16()&&57357===a.readUint16())return 0!==a.readUint32()&&a.warnings("encountered non zero length following item delimiter at position"+a.position-4+" while reading element of undefined length with tag ' + element.tag"),void(t.length=a.position-t.dataOffset);t.length=a.byteArray.length-t.dataOffset,a.seek(a.byteArray.length-a.position)},e}(a=function(d){"use strict";return void 0===d&&(d={}),d.findEndOfEncapsulatedElement=function(t,e,n){if(void 0===t)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'";if(void 0===e)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'";if(e.encapsulatedPixelData=!0,e.basicOffsetTable=[],e.fragments=[],"xfffee000"!==d.readTag(t))throw"dicomParser.findEndOfEncapsulatedElement: basic offset table not found";for(var i=t.readUint32()/4,r=0,o;r<i;r++)o=t.readUint32(),e.basicOffsetTable.push(o);for(var a=t.position;t.position<t.byteArray.length;){var s=d.readTag(t),l=t.readUint32();if("xfffee0dd"===s)return t.seek(l),void(e.length=t.position-e.dataOffset);if("xfffee000"!==s)return n&&n.push("unexpected tag "+s+" while searching for end of pixel data element with undefined length"),l>t.byteArray.length-t.position&&(l=t.byteArray.length-t.position),e.fragments.push({offset:t.position-a-8,position:t.position,length:l}),t.seek(l),void(e.length=t.position-e.dataOffset);e.fragments.push({offset:t.position-a-8,position:t.position,length:l}),t.seek(l)}n&&n.push("pixel data element "+e.tag+" missing sequence delimiter tag xfffee0dd")},d}(a=function(e){"use strict";return void 0===e&&(e={}),e.findAndSetUNElementLength=function(a,t){if(void 0===a)throw"dicomParser.findAndSetUNElementLength: missing required parameter 'byteStream'";for(var e=a.byteArray.length-8;a.position<=e;)if(65534===a.readUint16()&&57565===a.readUint16())return 0!==a.readUint32()&&a.warnings("encountered non zero length following item delimiter at position"+a.position-4+" while reading element of undefined length with tag ' + element.tag"),void(t.length=a.position-t.dataOffset);t.length=a.byteArray.length-t.dataOffset,a.seek(a.byteArray.length-a.position)},e}(a=function(a){"use strict";function o(a,t){return void 0===a.parser?t:a.parser}return void 0===a&&(a={}),a.DataSet=function(a,t,e){this.byteArrayParser=a,this.byteArray=t,this.elements=e},a.DataSet.prototype.uint16=function(e,t){var a=this.elements[e];if(t=void 0===t?0:t,a&&0!==a.length)return o(a,this.byteArrayParser).readUint16(this.byteArray,a.dataOffset+2*t)},a.DataSet.prototype.int16=function(e,t){var a=this.elements[e];if(t=void 0===t?0:t,a&&0!==a.length)return o(a,this.byteArrayParser).readInt16(this.byteArray,a.dataOffset+2*t)},a.DataSet.prototype.uint32=function(e,t){var a=this.elements[e];if(t=void 0===t?0:t,a&&0!==a.length)return o(a,this.byteArrayParser).readUint32(this.byteArray,a.dataOffset+4*t)},a.DataSet.prototype.int32=function(e,t){var a=this.elements[e];if(t=void 0===t?0:t,a&&0!==a.length)return o(a,this.byteArrayParser).readInt32(this.byteArray,a.dataOffset+4*t)},a.DataSet.prototype.float=function(e,t){var a=this.elements[e];if(t=void 0===t?0:t,a&&0!==a.length)return o(a,this.byteArrayParser).readFloat(this.byteArray,a.dataOffset+4*t)},a.DataSet.prototype.double=function(e,t){var a=this.elements[e];if(t=void 0===t?0:t,a&&0!==a.length)return o(a,this.byteArrayParser).readDouble(this.byteArray,a.dataOffset+8*t)},a.DataSet.prototype.numStringValues=function(t){var e=this.elements[t];if(e&&0<e.length){var o=a.readFixedString(this.byteArray,e.dataOffset,e.length).match(/\\/g);return null===o?1:o.length+1}},a.DataSet.prototype.string=function(t,e){var o=this.elements[t];if(o&&0<o.length){var n=a.readFixedString(this.byteArray,o.dataOffset,o.length);return 0<=e?n.split("\\")[e].trim():n.trim()}},a.DataSet.prototype.text=function(t,e){var o=this.elements[t];if(o&&0<o.length){var n=a.readFixedString(this.byteArray,o.dataOffset,o.length);return 0<=e?n.split("\\")[e].replace(/ +$/,""):n.replace(/ +$/,"")}},a.DataSet.prototype.floatString=function(a,t){var e=this.elements[a];if(e&&0<e.length){t=void 0===t?0:t;var o=this.string(a,t);if(void 0!==o)return parseFloat(o)}},a.DataSet.prototype.intString=function(a,t){var e=this.elements[a];if(e&&0<e.length){t=void 0===t?0:t;var o=this.string(a,t);if(void 0!==o)return parseInt(o)}},a}(a=function(a){"use strict";return void 0===a&&(a={}),a.ByteStream=function(a,t,e){if(void 0===a)throw"dicomParser.ByteStream: missing required parameter 'byteArrayParser'";if(void 0===t)throw"dicomParser.ByteStream: missing required parameter 'byteArray'";if(!1==t instanceof Uint8Array&&!1==t instanceof s)throw"dicomParser.ByteStream: parameter byteArray is not of type Uint8Array or Buffer";if(0>e)throw"dicomParser.ByteStream: parameter 'position' cannot be less than 0";if(e>=t.length)throw"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArrayParser=a,this.byteArray=t,this.position=e||0,this.warnings=[]},a.ByteStream.prototype.seek=function(e){if(0>this.position+e)throw"dicomParser.ByteStream.prototype.seek: cannot seek to position < 0";this.position+=e},a.ByteStream.prototype.readByteStream=function(t){if(this.position+t>this.byteArray.length)throw"dicomParser.ByteStream.prototype.readByteStream: readByteStream - buffer overread";var e=a.sharedCopy(this.byteArray,this.position,t);return this.position+=t,new a.ByteStream(this.byteArrayParser,e)},a.ByteStream.prototype.readUint16=function(){var e=this.byteArrayParser.readUint16(this.byteArray,this.position);return this.position+=2,e},a.ByteStream.prototype.readUint32=function(){var e=this.byteArrayParser.readUint32(this.byteArray,this.position);return this.position+=4,e},a.ByteStream.prototype.readFixedString=function(t){var e=a.readFixedString(this.byteArray,this.position,t);return this.position+=t,e},a}(a=function(e){"use strict";return void 0===e&&(e={}),e.readFixedString=function(a,t,e){if(0>e)throw"dicomParser.readFixedString - length cannot be less than 0";if(t+e>a.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var n="",r=0,o;r<e;r++){if(0===(o=a[t+r]))return t+=e,n;n+=F(o)}return n},e}(a=function(e){"use strict";return void 0===e&&(e={}),e.bigEndianByteArrayParser={readUint16:function(a,t){if(0>t)throw"bigEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>a.length)throw"bigEndianByteArrayParser.readUint16: attempt to read past end of buffer";return(a[t]<<8)+a[t+1]},readInt16:function(a,t){if(0>t)throw"bigEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>a.length)throw"bigEndianByteArrayParser.readInt16: attempt to read past end of buffer";var e=(a[t]<<8)+a[t+1];return 32768&e&&(e=e-65535-1),e},readUint32:function(a,t){if(0>t)throw"bigEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>a.length)throw"bigEndianByteArrayParser.readUint32: attempt to read past end of buffer";return 256*(256*(256*a[t]+a[t+1])+a[t+2])+a[t+3]},readInt32:function(a,t){if(0>t)throw"bigEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>a.length)throw"bigEndianByteArrayParser.readInt32: attempt to read past end of buffer";return(a[t]<<24)+(a[t+1]<<16)+(a[t+2]<<8)+a[t+3]},readFloat:function(a,t){if(0>t)throw"bigEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>a.length)throw"bigEndianByteArrayParser.readFloat: attempt to read past end of buffer";var e=new Uint8Array(4);return e[3]=a[t],e[2]=a[t+1],e[1]=a[t+2],e[0]=a[t+3],new Float32Array(e.buffer)[0]},readDouble:function(a,t){if(0>t)throw"bigEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>a.length)throw"bigEndianByteArrayParser.readDouble: attempt to read past end of buffer";var e=new Uint8Array(8);return e[7]=a[t],e[6]=a[t+1],e[5]=a[t+2],e[4]=a[t+3],e[3]=a[t+4],e[2]=a[t+5],e[1]=a[t+6],e[0]=a[t+7],new Float64Array(e.buffer)[0]}},e}(a=function(e){"use strict";return void 0===e&&(e={}),e.alloc=function(a,t){if(void 0!==s&&a instanceof s)return s.alloc(t);if(a instanceof Uint8Array)return new Uint8Array(t);throw"dicomParser.alloc: unknown type for byteArray"},e}(a=function(a){"use strict";void 0===a&&(a={});var t=!1;return a.readEncapsulatedPixelData=function(e,o,n){if(t||(t=!0,console&&console.log&&console.log("WARNING: dicomParser.readEncapsulatedPixelData() has been deprecated")),void 0===e)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if(void 0===o)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'";if(void 0===n)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";if("x7fe00010"!==o.tag)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010'";if(!0!==o.encapsulatedPixelData)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(!0!==o.hadUndefinedLength)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===o.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===o.fragments)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(0>n)throw"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0";return 0===o.basicOffsetTable.length?a.readEncapsulatedPixelDataFromFragments(e,o,0,o.fragments.length):a.readEncapsulatedImageFrame(e,o,n)},a}(a=function(a){"use strict";void 0===a&&(a={});var o={AE:!0,AS:!0,AT:!1,CS:!0,DA:!0,DS:!0,DT:!0,FL:!1,FD:!1,IS:!0,LO:!0,LT:!0,OB:!1,OD:!1,OF:!1,OW:!1,PN:!0,SH:!0,SL:!1,SQ:!1,SS:!1,ST:!0,TM:!0,UI:!0,UL:!1,UN:void 0,UR:!0,US:!1,UT:!0};return a.isStringVr=function(e){return o[e]},a.isPrivateTag=function(e){return 1==parseInt(e[4])%2},a.parsePN=function(a){if(void 0!==a){var t=a.split("^");return{familyName:t[0],givenName:t[1],middleName:t[2],prefix:t[3],suffix:t[4]}}},a}(a=function(e){"use strict";return void 0===e&&(e={}),e.parseTM=function(a,t){if(2<=a.length){var e=parseInt(a.substring(0,2),10),l=4<=a.length?parseInt(a.substring(2,4),10):void 0,s=6<=a.length?parseInt(a.substring(4,6),10):void 0,c=8<=a.length?parseInt(a.substring(7,13),10):void 0;if(t&&(isNaN(e)||void 0!==l&&isNaN(l)||void 0!==s&&isNaN(s)||void 0!==c&&isNaN(c)||0>e||23<e||l&&(0>l||59<l)||s&&(0>s||59<s)||c&&(0>c||999999<c)))throw"invalid TM '"+a+"'";return{hours:e,minutes:l,seconds:s,fractionalSeconds:c}}if(t)throw"invalid TM '"+a+"'"},e}(a=function(a){"use strict";function o(a,t){return 2===a?0==t%4&&t%100||0==t%400?29:28:9===a||4===a||6===a||11===a?30:31}function l(e,t,a){return!isNaN(a)&&0<t&&12>=t&&0<e&&e<=o(t,a)}return void 0===a&&(a={}),a.parseDA=function(a,t){if(a&&8===a.length){var e=parseInt(a.substring(0,4),10),n=parseInt(a.substring(4,6),10),s=parseInt(a.substring(6,8),10);if(t&&!0!==l(s,n,e))throw"invalid DA '"+a+"'";return{year:e,month:n,day:s}}if(t)throw"invalid DA '"+a+"'"},a}(a=function(l){"use strict";return void 0===l&&(l={}),l.explicitElementToString=function(c,e){function t(e,t){for(var a="",n=0;n<e;n++)0!==n&&(a+="/"),a+=t.call(c,o,n).toString();return a}if(void 0===c||void 0===e)throw"dicomParser.explicitElementToString: missing required parameters";if(void 0===e.vr)throw"dicomParser.explicitElementToString: cannot convert implicit element to string";var n=e.vr,o=e.tag,a;if(!0===l.isStringVr(n))a=c.string(o);else{if("AT"==n){var r=c.uint32(o);return void 0===r?void 0:(0>r&&(r=4294967295+r+1),"x"+r.toString(16).toUpperCase())}"US"==n?a=t(e.length/2,c.uint16):"SS"===n?a=t(e.length/2,c.int16):"UL"==n?a=t(e.length/4,c.uint32):"SL"===n?a=t(e.length/4,c.int32):"FD"==n?a=t(e.length/8,c.double):"FL"==n&&(a=t(e.length/4,c.float))}return a},l}(a=function(c){"use strict";return void 0===c&&(c={}),c.explicitDataSetToJS=function(t,e){if(void 0===t)throw"dicomParser.explicitDataSetToJS: missing required parameter dataSet";e=e||{omitPrivateAttibutes:!0,maxElementLength:128};var n={};for(var i in t.elements){var r=t.elements[i];if(!0!==e.omitPrivateAttibutes||!c.isPrivateTag(i))if(r.items){for(var o=[],a=0;a<r.items.length;a++)o.push(c.explicitDataSetToJS(r.items[a].dataSet,e));n[i]=o}else{var s;s=void 0,r.length<e.maxElementLength&&(s=c.explicitElementToString(t,r)),n[i]=void 0===s?{dataOffset:r.dataOffset,length:r.length}:s}}return n},c}(a=function(a){"use strict";function o(a,t){return 255===a.byteArray[t]&&217===a.byteArray[t+1]}function l(e,t,a){var i=t.fragments[a];return o(e,i.position+i.length-2)||o(e,i.position+i.length-3)}function n(a,t,e){for(var o=e;o<t.fragments.length;o++)if(l(a,t,o))return o}return void 0===a&&(a={}),a.createJPEGBasicOffsetTable=function(i,t,e){if(void 0===i)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter dataSet";if(void 0===t)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter pixelDataElement";if("x7fe00010"!==t.tag)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(!0!==t.encapsulatedPixelData)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.basicOffsetTable)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===t.fragments)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(0>=t.fragments.length)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(e&&0>=e.length)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'fragments' must not be zero length";e=e||t.fragments;for(var l=[],r=0;;){l.push(t.fragments[r].offset);var o=n(i,t,r);if(void 0===o||o===t.fragments.length-1)return l;r=o+1}},a}(a))))))))))))))))))))))))))))})}).call(l,t(29)(a),t(5).Buffer)},function(n,t){"use strict";function d(a){var t=a.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");return"="===a[t-2]?2:"="===a[t-1]?1:0}function p(e){return o[63&e>>18]+o[63&e>>12]+o[63&e>>6]+o[63&e]}function e(r,t,e){for(var n=[],l=t,a;l<e;l+=3)a=(r[l]<<16)+(r[l+1]<<8)+r[l+2],n.push(p(a));return n.join("")}t.byteLength=function(e){return 3*e.length/4-d(e)},t.toByteArray=function(l){var t=l.length,c,e,n,r,o;r=d(l),o=new s(3*t/4-r),e=0<r?t-4:t;var a=0;for(c=0;c<e;c+=4)n=i[l.charCodeAt(c)]<<18|i[l.charCodeAt(c+1)]<<12|i[l.charCodeAt(c+2)]<<6|i[l.charCodeAt(c+3)],o[a++]=255&n>>16,o[a++]=255&n>>8,o[a++]=255&n;return 2===r?(n=i[l.charCodeAt(c)]<<2|i[l.charCodeAt(c+1)]>>4,o[a++]=255&n):1===r&&(n=i[l.charCodeAt(c)]<<10|i[l.charCodeAt(c+1)]<<4|i[l.charCodeAt(c+2)]>>2,o[a++]=255&n>>8,o[a++]=255&n),o},t.fromByteArray=function(a){for(var t=a.length,n=t%3,i="",r=[],s=0,l=t-n,c;s<l;s+=16383)r.push(e(a,s,s+16383>l?l:s+16383));return 1===n?(c=a[t-1],i+=o[c>>2],i+=o[63&c<<4],i+="=="):2===n&&(c=(a[t-2]<<8)+a[t-1],i+=o[c>>10],i+=o[63&c>>4],i+=o[63&c<<2],i+="="),r.push(i),r.join("")};for(var o=[],i=[],s="undefined"==typeof Uint8Array?Array:Uint8Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=0,l=a.length;r<l;++r)o[r]=a[r],i[a.charCodeAt(r)]=r;i[45]=62,i[95]=63},function(a,t){t.read=function(m,t,e,n,i){var r=8*i-n-1,s=(1<<r)-1,l=s>>1,c=-7,_=e?i-1:0,u=e?-1:1,p=m[t+_],d,o;for(_+=u,d=p&(1<<-c)-1,p>>=-c,c+=r;0<c;d=256*d+m[t+_],_+=u,c-=8);for(o=d&(1<<-c)-1,d>>=-c,c+=n;0<c;o=256*o+m[t+_],_+=u,c-=8);if(0===d)d=1-l;else{if(d===s)return o?NaN:1/0*(p?-1:1);o+=S(2,n),d-=l}return(p?-1:1)*o*S(2,d-n)},t.write=function(_,t,e,n,g,r){var y=8*r-g-1,c=(1<<y)-1,h=c>>1,u=23===g?5.960464477539063e-8-6.617444900424222e-24:0,p=n?0:r-1,d=n?1:-1,f=0>t||0===t&&0>1/t?1:0,m,b,s;for(t=B(t),isNaN(t)||t===1/0?(b=isNaN(t)?1:0,m=c):(m=z(i(t)/o),1>t*(s=S(2,-m))&&(m--,s*=2),2<=(t+=1<=m+h?u/s:u*S(2,1-h))*s&&(m++,s/=2),m+h>=c?(b=0,m=c):1<=m+h?(b=(t*s-1)*S(2,g),m+=h):(b=t*S(2,h-1)*S(2,g),m=0));8<=g;_[e+p]=255&b,p+=d,b/=256,g-=8);for(m=m<<g|b,y+=g;0<y;_[e+p]=255&m,p+=d,m/=256,y-=8);_[e+p-d]|=128*f}},function(e){var a={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==a.call(e)}},function(a,y,e){(function(b,x){function i(l,e,c){function n(){for(var e;null!==(e=l.read());)o.push(e),a+=e.length;l.once("readable",n)}function i(){var e=b.concat(o,a);o=[],c(null,e),l.close()}var o=[],a=0;l.on("error",function(e){l.removeListener("end",i),l.removeListener("readable",n),c(e)}),l.on("end",i),l.end(e),n()}function r(t,e){if("string"==typeof e&&(e=new b(e)),!b.isBuffer(e))throw new TypeError("Not a string or buffer");var a=d.Z_FINISH;return t._processChunk(e,a)}function o(e){return this instanceof o?void n.call(this,e,d.DEFLATE):new o(e)}function a(e){return this instanceof a?void n.call(this,e,d.INFLATE):new a(e)}function s(e){return this instanceof s?void n.call(this,e,d.GZIP):new s(e)}function l(e){return this instanceof l?void n.call(this,e,d.GUNZIP):new l(e)}function c(e){return this instanceof c?void n.call(this,e,d.DEFLATERAW):new c(e)}function h(e){return this instanceof h?void n.call(this,e,d.INFLATERAW):new h(e)}function u(e){return this instanceof u?void n.call(this,e,d.UNZIP):new u(e)}function n(e,n){if(this._opts=e=e||{},this._chunkSize=e.chunkSize||y.Z_DEFAULT_CHUNK,t.call(this,e),e.flush&&e.flush!==d.Z_NO_FLUSH&&e.flush!==d.Z_PARTIAL_FLUSH&&e.flush!==d.Z_SYNC_FLUSH&&e.flush!==d.Z_FULL_FLUSH&&e.flush!==d.Z_FINISH&&e.flush!==d.Z_BLOCK)throw new Error("Invalid flush flag: "+e.flush);if(this._flushFlag=e.flush||d.Z_NO_FLUSH,e.chunkSize&&(e.chunkSize<y.Z_MIN_CHUNK||e.chunkSize>y.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+e.chunkSize);if(e.windowBits&&(e.windowBits<y.Z_MIN_WINDOWBITS||e.windowBits>y.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+e.windowBits);if(e.level&&(e.level<y.Z_MIN_LEVEL||e.level>y.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+e.level);if(e.memLevel&&(e.memLevel<y.Z_MIN_MEMLEVEL||e.memLevel>y.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+e.memLevel);if(e.strategy&&e.strategy!=y.Z_FILTERED&&e.strategy!=y.Z_HUFFMAN_ONLY&&e.strategy!=y.Z_RLE&&e.strategy!=y.Z_FIXED&&e.strategy!=y.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+e.strategy);if(e.dictionary&&!b.isBuffer(e.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._binding=new d.Zlib(n);var l=this;this._hadError=!1,this._binding.onerror=function(e,t){l._binding=null,l._hadError=!0;var a=new Error(e);a.errno=t,a.code=y.codes[t],l.emit("error",a)};var r=y.Z_DEFAULT_COMPRESSION;"number"==typeof e.level&&(r=e.level);var o=y.Z_DEFAULT_STRATEGY;"number"==typeof e.strategy&&(o=e.strategy),this._binding.init(e.windowBits||y.Z_DEFAULT_WINDOWBITS,r,e.memLevel||y.Z_DEFAULT_MEMLEVEL,o,e.dictionary),this._buffer=new b(this._chunkSize),this._offset=0,this._closed=!1,this._level=r,this._strategy=o,this.once("end",this.close)}var t=e(136),d=e(145),p=e(71),v=e(72).ok;d.Z_MIN_WINDOWBITS=8,d.Z_MAX_WINDOWBITS=15,d.Z_DEFAULT_WINDOWBITS=15,d.Z_MIN_CHUNK=64,d.Z_MAX_CHUNK=1/0,d.Z_DEFAULT_CHUNK=16384,d.Z_MIN_MEMLEVEL=1,d.Z_MAX_MEMLEVEL=9,d.Z_DEFAULT_MEMLEVEL=8,d.Z_MIN_LEVEL=-1,d.Z_MAX_LEVEL=9,d.Z_DEFAULT_LEVEL=d.Z_DEFAULT_COMPRESSION,Object.keys(d).forEach(function(e){e.match(/^Z/)&&(y[e]=d[e])}),y.codes={Z_OK:d.Z_OK,Z_STREAM_END:d.Z_STREAM_END,Z_NEED_DICT:d.Z_NEED_DICT,Z_ERRNO:d.Z_ERRNO,Z_STREAM_ERROR:d.Z_STREAM_ERROR,Z_DATA_ERROR:d.Z_DATA_ERROR,Z_MEM_ERROR:d.Z_MEM_ERROR,Z_BUF_ERROR:d.Z_BUF_ERROR,Z_VERSION_ERROR:d.Z_VERSION_ERROR},Object.keys(y.codes).forEach(function(e){y.codes[y.codes[e]]=e}),y.Deflate=o,y.Inflate=a,y.Gzip=s,y.Gunzip=l,y.DeflateRaw=c,y.InflateRaw=h,y.Unzip=u,y.createDeflate=function(e){return new o(e)},y.createInflate=function(e){return new a(e)},y.createDeflateRaw=function(e){return new c(e)},y.createInflateRaw=function(e){return new h(e)},y.createGzip=function(e){return new s(e)},y.createGunzip=function(e){return new l(e)},y.createUnzip=function(e){return new u(e)},y.deflate=function(a,t,r){return"function"==typeof t&&(r=t,t={}),i(new o(t),a,r)},y.deflateSync=function(a,t){return r(new o(t),a)},y.gzip=function(a,t,o){return"function"==typeof t&&(o=t,t={}),i(new s(t),a,o)},y.gzipSync=function(a,t){return r(new s(t),a)},y.deflateRaw=function(a,t,o){return"function"==typeof t&&(o=t,t={}),i(new c(t),a,o)},y.deflateRawSync=function(a,t){return r(new c(t),a)},y.unzip=function(a,t,o){return"function"==typeof t&&(o=t,t={}),i(new u(t),a,o)},y.unzipSync=function(a,t){return r(new u(t),a)},y.inflate=function(o,t,r){return"function"==typeof t&&(r=t,t={}),i(new a(t),o,r)},y.inflateSync=function(o,t){return r(new a(t),o)},y.gunzip=function(a,t,o){return"function"==typeof t&&(o=t,t={}),i(new l(t),a,o)},y.gunzipSync=function(a,t){return r(new l(t),a)},y.inflateRaw=function(a,t,o){return"function"==typeof t&&(o=t,t={}),i(new h(t),a,o)},y.inflateRawSync=function(a,t){return r(new h(t),a)},p.inherits(n,t),n.prototype.params=function(e,t,a){if(e<y.Z_MIN_LEVEL||e>y.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+e);if(t!=y.Z_FILTERED&&t!=y.Z_HUFFMAN_ONLY&&t!=y.Z_RLE&&t!=y.Z_FIXED&&t!=y.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+t);if(this._level!==e||this._strategy!==t){var r=this;this.flush(d.Z_SYNC_FLUSH,function(){r._binding.params(e,t),r._hadError||(r._level=e,r._strategy=t,a&&a())})}else x.nextTick(a)},n.prototype.reset=function(){return this._binding.reset()},n.prototype._flush=function(t){this._transform(new b(0),"",t)},n.prototype.flush=function(t,a){var i=this._writableState;if(("function"==typeof t||void 0===t&&!a)&&(a=t,t=d.Z_FULL_FLUSH),i.ended)a&&x.nextTick(a);else if(i.ending)a&&this.once("end",a);else if(i.needDrain){var r=this;this.once("drain",function(){r.flush(a)})}else this._flushFlag=t,this.write(new b(0),"",a)},n.prototype.close=function(a){if(a&&x.nextTick(a),!this._closed){this._closed=!0,this._binding.close();var t=this;x.nextTick(function(){t.emit("close")})}},n.prototype._transform=function(t,l,n){var i=this._writableState,o=(i.ending||i.ended)&&(!t||i.length===t.length),a;return null!==!t||b.isBuffer(t)?void(o?a=d.Z_FINISH:(a=this._flushFlag,t.length>=i.length&&(this._flushFlag=this._opts.flush||d.Z_NO_FLUSH)),this._processChunk(t,a,n)):n(new Error("invalid input"))},n.prototype._processChunk=function(t,e,n){function g(i,p){if(!s._hadError){var d=o-p;if(v(0<=d,"have should not go down"),0<d){var h=s._buffer.slice(s._offset,s._offset+d);s._offset+=d,l?s.push(h):(_.push(h),u+=h.length)}if((0===p||s._offset>=s._chunkSize)&&(o=s._chunkSize,s._offset=0,s._buffer=new b(s._chunkSize)),0===p){if(a+=r-i,r=i,!l)return!0;var m=s._binding.write(e,t,a,r,s._buffer,s._offset,s._chunkSize);return m.callback=g,void(m.buffer=t)}if(!l)return!1;n()}}var r=t&&t.length,o=this._chunkSize-this._offset,a=0,s=this,l="function"==typeof n;if(!l){var _=[],u=0,p;this.on("error",function(e){p=e});do var h=this._binding.writeSync(e,t,a,r,this._buffer,this._offset,o);while(!this._hadError&&g(h[0],h[1]));if(this._hadError)throw p;var d=b.concat(_,u);return this.close(),d}var f=this._binding.write(e,t,a,r,this._buffer,this._offset,o);f.buffer=t,f.callback=g},p.inherits(o,n),p.inherits(a,n),p.inherits(s,n),p.inherits(l,n),p.inherits(c,n),p.inherits(h,n),p.inherits(u,n)}).call(y,e(5).Buffer,e(4))},function(a,t,e){a.exports=e(137).Transform},function(a,t,e){(t=a.exports=e(62)).Stream=t,t.Readable=t,t.Writable=e(65),t.Duplex=e(6),t.Transform=e(67),t.PassThrough=e(144)},function(e){var a={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==a.call(e)}},function(){},function(a,t,e){"use strict";function n(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function l(a,t,e){a.copy(t,e)}var r=e(27).Buffer;a.exports=function(){function e(){n(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(a){var o={data:a,next:null};0<this.length?this.tail.next=o:this.head=o,this.tail=o,++this.length},e.prototype.unshift=function(a){var o={data:a,next:this.head};0===this.length&&(this.tail=o),this.head=o,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return this.head=1===this.length?this.tail=null:this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(a){if(0===this.length)return"";for(var t=this.head,e=""+t.data;t=t.next;)e+=a+t.data;return e},e.prototype.concat=function(a){if(0===this.length)return r.alloc(0);if(1===this.length)return this.head.data;for(var t=r.allocUnsafe(a>>>0),e=this.head,o=0;e;)l(e.data,t,o),o+=e.data.length,e=e.next;return t},e}()},function(a,t,e){function o(a,t){this._id=a,this._clearFn=t}var n=Function.prototype.apply;t.setTimeout=function(){return new o(n.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new o(n.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(a,t){clearTimeout(a._idleTimeoutId),a._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(a){clearTimeout(a._idleTimeoutId);var t=a._idleTimeout;0<=t&&(a._idleTimeoutId=setTimeout(function(){a._onTimeout&&a._onTimeout()},t))},e(142),t.setImmediate=setImmediate,t.clearImmediate=clearImmediate},function(a,t,e){(function(a,r){!function(d,t){"use strict";function e(e){delete s[e]}function n(a){var o=a.callback,e=a.args;switch(e.length){case 0:o();break;case 1:o(e[0]);break;case 2:o(e[0],e[1]);break;case 3:o(e[0],e[1],e[2]);break;default:o.apply(t,e);}}function i(a){if(l)setTimeout(i,0,a);else{var t=s[a];if(t){l=!0;try{n(t)}finally{e(a),l=!1}}}}if(!d.setImmediate){var o=1,s={},l=!1,c=d.document,p=Object.getPrototypeOf&&Object.getPrototypeOf(d),u;p=p&&p.setTimeout?p:d,"[object process]"==={}.toString.call(d.process)?u=function(e){r.nextTick(function(){i(e)})}:function(){if(d.postMessage&&!d.importScripts){var t=!0,e=d.onmessage;return d.onmessage=function(){t=!1},d.postMessage("","*"),d.onmessage=e,t}}()?function(){var t="setImmediate$"+Math.random()+"$",e=function(e){e.source===d&&"string"==typeof e.data&&0===e.data.indexOf(t)&&i(+e.data.slice(t.length))};d.addEventListener?d.addEventListener("message",e,!1):d.attachEvent("onmessage",e),u=function(e){d.postMessage(t+e,"*")}}():d.MessageChannel?function(){var a=new MessageChannel;a.port1.onmessage=function(e){i(e.data)},u=function(t){a.port2.postMessage(t)}}():c&&"onreadystatechange"in c.createElement("script")?function(){var a=c.documentElement;u=function(t){var e=c.createElement("script");e.onreadystatechange=function(){i(t),e.onreadystatechange=null,a.removeChild(e),e=null},a.appendChild(e)}}():u=function(e){setTimeout(i,0,e)},p.setImmediate=function(a){"function"!=typeof a&&(a=new Function(""+a));for(var r=Array(arguments.length-1),l=0;l<r.length;l++)r[l]=arguments[l+1];var n={callback:a,args:r};return s[o]=n,u(o),o++},p.clearImmediate=e}}("undefined"==typeof self?void 0===a?this:a:self)}).call(t,e(1),e(4))},function(a,t,e){(function(o){function r(e){try{if(!o.localStorage)return!1}catch(e){return!1}var t=o.localStorage[e];return null!=t&&"true"===(t+"").toLowerCase()}a.exports=function(a,t){if(r("noDeprecation"))return a;var e=!1;return function(){if(!e){if(r("throwDeprecation"))throw new Error(t);r("traceDeprecation")?console.trace(t):console.warn(t),e=!0}return a.apply(this,arguments)}}}).call(t,e(1))},function(a,t,e){"use strict";function n(e){return this instanceof n?void i.call(this,e):new n(e)}a.exports=n;var i=e(67),r=e(11);r.inherits=e(12),r.inherits(n,i),n.prototype._transform=function(a,t,e){e(null,a)}},function(a,m,e){(function(d,_){function t(e){if(e<m.DEFLATE||e>m.UNZIP)throw new TypeError("Bad argument");this.mode=e,this.init_done=!1,this.write_in_progress=!1,this.pending_close=!1,this.windowBits=0,this.level=0,this.memLevel=0,this.strategy=0,this.dictionary=null}function i(a,t){for(var e=0;e<a.length;e++)this[t+e]=a[e]}var o=e(68),p=e(146),g=e(147),l=e(149),a=e(152);for(var r in a)m[r]=a[r];m.NONE=0,m.DEFLATE=1,m.INFLATE=2,m.GZIP=3,m.GUNZIP=4,m.DEFLATERAW=5,m.INFLATERAW=6,m.UNZIP=7,t.prototype.init=function(e,t,o,n){switch(this.windowBits=e,this.level=t,this.memLevel=o,this.strategy=n,this.mode!==m.GZIP&&this.mode!==m.GUNZIP||(this.windowBits+=16),this.mode===m.UNZIP&&(this.windowBits+=32),this.mode!==m.DEFLATERAW&&this.mode!==m.INFLATERAW||(this.windowBits=-this.windowBits),this.strm=new p,this.mode){case m.DEFLATE:case m.GZIP:case m.DEFLATERAW:r=g.deflateInit2(this.strm,this.level,m.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case m.INFLATE:case m.GUNZIP:case m.INFLATERAW:case m.UNZIP:var r=l.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode);}r===m.Z_OK?(this.write_in_progress=!1,this.init_done=!0):this._error(r)},t.prototype.params=function(){throw new Error("deflateParams Not supported")},t.prototype._writeCheck=function(){if(!this.init_done)throw new Error("write before init");if(this.mode===m.NONE)throw new Error("already finalized");if(this.write_in_progress)throw new Error("write already in progress");if(this.pending_close)throw new Error("close is pending")},t.prototype.write=function(c,e,n,i,r,o,a){this._writeCheck(),this.write_in_progress=!0;var s=this;return d.nextTick(function(){s.write_in_progress=!1;var l=s._write(c,e,n,i,r,o,a);s.callback(l[0],l[1]),s.pending_close&&s.close()}),this},t.prototype.writeSync=function(l,t,e,n,i,r,o){return this._writeCheck(),this._write(l,t,e,n,i,r,o)},t.prototype._write=function(e,t,o,r,a,n,s){if(this.write_in_progress=!0,e!==m.Z_NO_FLUSH&&e!==m.Z_PARTIAL_FLUSH&&e!==m.Z_SYNC_FLUSH&&e!==m.Z_FULL_FLUSH&&e!==m.Z_FINISH&&e!==m.Z_BLOCK)throw new Error("Invalid flush value");null==t&&(t=new _(0),r=0,o=0),a.set=a._set?a._set:i;var c=this.strm;switch(c.avail_in=r,c.input=t,c.next_in=o,c.avail_out=s,c.output=a,c.next_out=n,this.mode){case m.DEFLATE:case m.GZIP:case m.DEFLATERAW:p=g.deflate(c,e);break;case m.UNZIP:case m.INFLATE:case m.GUNZIP:case m.INFLATERAW:var p=l.inflate(c,e);break;default:throw new Error("Unknown mode "+this.mode);}return p!==m.Z_STREAM_END&&p!==m.Z_OK&&this._error(p),this.write_in_progress=!1,[c.avail_in,c.avail_out]},t.prototype.close=function(){this.write_in_progress?this.pending_close=!0:(this.pending_close=!1,this.mode===m.DEFLATE||this.mode===m.GZIP||this.mode===m.DEFLATERAW?g.deflateEnd(this.strm):l.inflateEnd(this.strm),this.mode=m.NONE)},t.prototype.reset=function(){switch(this.mode){case m.DEFLATE:case m.DEFLATERAW:e=g.deflateReset(this.strm);break;case m.INFLATE:case m.INFLATERAW:var e=l.inflateReset(this.strm);}e!==m.Z_OK&&this._error(e)},t.prototype._error=function(e){this.onerror(o[e]+": "+this.strm.msg,e),this.write_in_progress=!1,this.pending_close&&this.close()},m.Zlib=t}).call(m,e(4),e(5).Buffer)},function(e){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(C,t,e){"use strict";function L(a,t){return a.msg=w[t],t}function i(e){return(e<<1)-(4<e?9:0)}function U(a){for(var t=a.length;0<=--t;)a[t]=0}function o(a){var t=a.state,e=t.pending;e>a.avail_out&&(e=a.avail_out),0!==e&&(y.arraySet(a.output,t.pending_buf,t.pending_out,e,a.next_out),a.next_out+=e,t.pending_out+=e,a.total_out+=e,a.avail_out-=e,t.pending-=e,0===t.pending&&(t.pending_out=0))}function V(a,t){b._tr_flush_block(a,0<=a.block_start?a.block_start:-1,a.strstart-a.block_start,t),a.block_start=a.strstart,o(a.strm)}function a(a,t){a.pending_buf[a.pending++]=t}function r(a,t){a.pending_buf[a.pending++]=255&t>>>8,a.pending_buf[a.pending++]=255&t}function l(a,t,e,o){var n=a.avail_in;return n>o&&(n=o),0===n?0:(a.avail_in-=n,y.arraySet(t,a.input,a.next_in,n,e),1===a.state.wrap?a.adler=x(a.adler,t,n,e):2===a.state.wrap&&(a.adler=v(a.adler,t,n,e)),a.next_in+=n,a.total_in+=n,n)}function s(m,t){var e=m.max_chain_length,r=m.strstart,o=m.prev_length,a=m.nice_match,s=m.strstart>m.w_size-J?m.strstart-(m.w_size-J):0,l=m.window,c=m.w_mask,_=m.prev,h=m.strstart+Z,p=l[r+o-1],d=l[r+o],g,n;m.prev_length>=m.good_match&&(e>>=2),a>m.lookahead&&(a=m.lookahead);do if(g=t,l[g+o]===d&&l[g+o-1]===p&&l[g]===l[r]&&l[++g]===l[r+1]){r+=2,g++;do;while(l[++r]===l[++g]&&l[++r]===l[++g]&&l[++r]===l[++g]&&l[++r]===l[++g]&&l[++r]===l[++g]&&l[++r]===l[++g]&&l[++r]===l[++g]&&l[++r]===l[++g]&&r<h);if(n=Z-(h-r),r=h-Z,n>o){if(m.match_start=t,o=n,n>=a)break;p=l[r+o-1],d=l[r+o]}}while((t=_[t&c])>s&&0!=--e);return o<=m.lookahead?o:m.lookahead}function j(s){var t=s.w_size,a,e,n,i,r;do{if(i=s.window_size-s.lookahead-s.strstart,s.strstart>=t+(t-J)){y.arraySet(s.window,s.window,t,t,0),s.match_start-=t,s.strstart-=t,s.block_start-=t,a=e=s.hash_size;do n=s.head[--a],s.head[a]=n>=t?n-t:0;while(--e);a=e=t;do n=s.prev[--a],s.prev[a]=n>=t?n-t:0;while(--e);i+=t}if(0===s.strm.avail_in)break;if(e=l(s.strm,s.window,s.strstart+s.lookahead,i),s.lookahead+=e,s.lookahead+s.insert>=Y)for(r=s.strstart-s.insert,s.ins_h=s.window[r],s.ins_h=(s.ins_h<<s.hash_shift^s.window[r+1])&s.hash_mask;s.insert&&(s.ins_h=(s.ins_h<<s.hash_shift^s.window[r+Y-1])&s.hash_mask,s.prev[r&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=r,r++,s.insert--,!(s.lookahead+s.insert<Y)););}while(s.lookahead<J&&0!==s.strm.avail_in)}function n(a,t){for(var e,o;;){if(a.lookahead<J){if(j(a),a.lookahead<J&&t===E)return re;if(0===a.lookahead)break}if(e=0,a.lookahead>=Y&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+Y-1])&a.hash_mask,e=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),0!==e&&a.strstart-e<=a.w_size-J&&(a.match_length=s(a,e)),!(a.match_length>=Y))o=b._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;else if(o=b._tr_tally(a,a.strstart-a.match_start,a.match_length-Y),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&a.lookahead>=Y){a.match_length--;do a.strstart++,a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+Y-1])&a.hash_mask,e=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart;while(0!=--a.match_length);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+1])&a.hash_mask;if(o&&(V(a,!1),0===a.strm.avail_out))return re}return a.insert=a.strstart<Y-1?a.strstart:Y-1,t===T?(V(a,!0),0===a.strm.avail_out?ie:le):a.last_lit&&(V(a,!1),0===a.strm.avail_out)?re:ne}function c(a,t){for(var e,o,n;;){if(a.lookahead<J){if(j(a),a.lookahead<J&&t===E)return re;if(0===a.lookahead)break}if(e=0,a.lookahead>=Y&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+Y-1])&a.hash_mask,e=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,a.match_length=Y-1,0!==e&&a.prev_length<a.max_lazy_match&&a.strstart-e<=a.w_size-J&&(a.match_length=s(a,e),5>=a.match_length&&(a.strategy===k||a.match_length===Y&&4096<a.strstart-a.match_start)&&(a.match_length=Y-1)),a.prev_length>=Y&&a.match_length<=a.prev_length){n=a.strstart+a.lookahead-Y,o=b._tr_tally(a,a.strstart-1-a.prev_match,a.prev_length-Y),a.lookahead-=a.prev_length-1,a.prev_length-=2;do++a.strstart<=n&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+Y-1])&a.hash_mask,e=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);while(0!=--a.prev_length);if(a.match_available=0,a.match_length=Y-1,a.strstart++,o&&(V(a,!1),0===a.strm.avail_out))return re}else if(!a.match_available)a.match_available=1,a.strstart++,a.lookahead--;else if((o=b._tr_tally(a,0,a.window[a.strstart-1]))&&V(a,!1),a.strstart++,a.lookahead--,0===a.strm.avail_out)return re}return a.match_available&&(o=b._tr_tally(a,0,a.window[a.strstart-1]),a.match_available=0),a.insert=a.strstart<Y-1?a.strstart:Y-1,t===T?(V(a,!0),0===a.strm.avail_out?ie:le):a.last_lit&&(V(a,!1),0===a.strm.avail_out)?re:ne}function p(l,t){for(var e=l.window,a,n,i,r;;){if(l.lookahead<=Z){if(j(l),l.lookahead<=Z&&t===E)return re;if(0===l.lookahead)break}if(l.match_length=0,l.lookahead>=Y&&0<l.strstart&&(i=l.strstart-1,(n=e[i])===e[++i]&&n===e[++i]&&n===e[++i])){r=l.strstart+Z;do;while(n===e[++i]&&n===e[++i]&&n===e[++i]&&n===e[++i]&&n===e[++i]&&n===e[++i]&&n===e[++i]&&n===e[++i]&&i<r);l.match_length=Z-(r-i),l.match_length>l.lookahead&&(l.match_length=l.lookahead)}if(l.match_length>=Y?(a=b._tr_tally(l,1,l.match_length-Y),l.lookahead-=l.match_length,l.strstart+=l.match_length,l.match_length=0):(a=b._tr_tally(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++),a&&(V(l,!1),0===l.strm.avail_out))return re}return l.insert=0,t===T?(V(l,!0),0===l.strm.avail_out?ie:le):l.last_lit&&(V(l,!1),0===l.strm.avail_out)?re:ne}function u(a,t){for(var e;;){if(0===a.lookahead&&(j(a),0===a.lookahead)){if(t===E)return re;break}if(a.match_length=0,e=b._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++,e&&(V(a,!1),0===a.strm.avail_out))return re}return a.insert=0,t===T?(V(a,!0),0===a.strm.avail_out?ie:le):a.last_lit&&(V(a,!1),0===a.strm.avail_out)?re:ne}function d(a,t,e,o,n){this.good_length=a,this.max_lazy=t,this.nice_length=e,this.max_chain=o,this.func=n}function m(e){e.window_size=2*e.w_size,U(e.head),e.max_lazy_match=se[e.level].max_lazy,e.good_match=se[e.level].good_length,e.nice_match=se[e.level].nice_length,e.max_chain_length=se[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=Y-1,e.match_available=0,e.ins_h=0}function _(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=z,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new y.Buf16(2*q),this.dyn_dtree=new y.Buf16(2*(2*H+1)),this.bl_tree=new y.Buf16(2*(2*W+1)),U(this.dyn_ltree),U(this.dyn_dtree),U(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new y.Buf16(X+1),this.heap=new y.Buf16(2*G+1),U(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new y.Buf16(2*G+1),U(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function h(a){var t;return a&&a.state?(a.total_in=a.total_out=0,a.data_type=B,t=a.state,t.pending=0,t.pending_out=0,0>t.wrap&&(t.wrap=-t.wrap),t.status=t.wrap?K:ae,a.adler=2===t.wrap?0:1,t.last_flush=E,b._tr_init(t),P):L(a,I)}function g(a){var t=h(a);return t===P&&m(a.state),t}function f(i,c,e,n,d,o){if(!i)return I;var a=1;if(c===D&&(c=6),0>n?(a=0,n=-n):15<n&&(a=2,n-=16),1>d||d>O||e!==z||8>n||15<n||0>c||9<c||0>o||o>N)return L(i,I);8===n&&(n=9);var s=new _;return i.state=s,s.strm=i,s.wrap=a,s.gzhead=null,s.w_bits=n,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=d+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+Y-1)/Y),s.window=new y.Buf8(2*s.w_size),s.head=new y.Buf16(s.hash_size),s.prev=new y.Buf16(s.w_size),s.lit_bufsize=1<<d+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new y.Buf8(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=c,s.strategy=o,s.method=e,g(i)}var y=e(17),b=e(148),x=e(69),v=e(70),w=e(68),E=0,T=4,M=5,P=0,A=1,I=-2,R=-5,D=-1,k=1,F=2,N=4,B=2,z=8,O=9,G=286,H=30,W=19,q=2*G+1,X=15,Y=3,Z=258,J=Z+Y+1,K=42,Q=69,$=73,ee=91,te=103,ae=113,oe=666,re=1,ne=2,ie=3,le=4,se;se=[new d(0,0,0,0,function(a,t){var e=65535;for(e>a.pending_buf_size-5&&(e=a.pending_buf_size-5);;){if(1>=a.lookahead){if(j(a),0===a.lookahead&&t===E)return re;if(0===a.lookahead)break}a.strstart+=a.lookahead,a.lookahead=0;var o=a.block_start+e;if((0===a.strstart||a.strstart>=o)&&(a.lookahead=a.strstart-o,a.strstart=o,V(a,!1),0===a.strm.avail_out))return re;if(a.strstart-a.block_start>=a.w_size-J&&(V(a,!1),0===a.strm.avail_out))return re}return a.insert=0,t===T?(V(a,!0),0===a.strm.avail_out?ie:le):(a.strstart>a.block_start&&(V(a,!1),a.strm.avail_out),re)}),new d(4,4,8,4,n),new d(4,5,16,8,n),new d(4,6,32,32,n),new d(4,4,16,16,c),new d(8,16,32,32,c),new d(8,16,128,128,c),new d(8,32,128,256,c),new d(32,128,258,1024,c),new d(32,258,258,4096,c)],t.deflateInit=function(a,t){return f(a,t,z,15,8,0)},t.deflateInit2=f,t.deflateReset=g,t.deflateResetKeep=h,t.deflateSetHeader=function(a,t){return a&&a.state?2===a.state.wrap?(a.state.gzhead=t,P):I:I},t.deflate=function(l,c){var e,n,s,m;if(!l||!l.state||c>M||0>c)return l?L(l,I):I;if(n=l.state,!l.output||!l.input&&0!==l.avail_in||n.status===oe&&c!==T)return L(l,0===l.avail_out?R:I);if(n.strm=l,e=n.last_flush,n.last_flush=c,n.status===K)if(2===n.wrap)l.adler=0,a(n,31),a(n,139),a(n,8),n.gzhead?(a(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),a(n,255&n.gzhead.time),a(n,255&n.gzhead.time>>8),a(n,255&n.gzhead.time>>16),a(n,255&n.gzhead.time>>24),a(n,9===n.level?2:n.strategy>=F||2>n.level?4:0),a(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(a(n,255&n.gzhead.extra.length),a(n,255&n.gzhead.extra.length>>8)),n.gzhead.hcrc&&(l.adler=v(l.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=Q):(a(n,0),a(n,0),a(n,0),a(n,0),a(n,0),a(n,9===n.level?2:n.strategy>=F||2>n.level?4:0),a(n,3),n.status=ae);else{var _=z+(n.w_bits-8<<4)<<8;_|=(n.strategy>=F||2>n.level?0:6>n.level?1:6===n.level?2:3)<<6,0!==n.strstart&&(_|=32),_+=31-_%31,n.status=ae,r(n,_),0!==n.strstart&&(r(n,l.adler>>>16),r(n,65535&l.adler)),l.adler=1}if(n.status===Q)if(n.gzhead.extra){for(s=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>s&&(l.adler=v(l.adler,n.pending_buf,n.pending-s,s)),o(l),s=n.pending,n.pending!==n.pending_buf_size));)a(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>s&&(l.adler=v(l.adler,n.pending_buf,n.pending-s,s)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=$)}else n.status=$;if(n.status===$)if(n.gzhead.name){s=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>s&&(l.adler=v(l.adler,n.pending_buf,n.pending-s,s)),o(l),s=n.pending,n.pending===n.pending_buf_size)){m=1;break}m=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,a(n,m)}while(0!==m);n.gzhead.hcrc&&n.pending>s&&(l.adler=v(l.adler,n.pending_buf,n.pending-s,s)),0===m&&(n.gzindex=0,n.status=ee)}else n.status=ee;if(n.status===ee)if(n.gzhead.comment){s=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>s&&(l.adler=v(l.adler,n.pending_buf,n.pending-s,s)),o(l),s=n.pending,n.pending===n.pending_buf_size)){m=1;break}m=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,a(n,m)}while(0!==m);n.gzhead.hcrc&&n.pending>s&&(l.adler=v(l.adler,n.pending_buf,n.pending-s,s)),0===m&&(n.status=te)}else n.status=te;if(n.status===te&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&o(l),n.pending+2<=n.pending_buf_size&&(a(n,255&l.adler),a(n,255&l.adler>>8),l.adler=0,n.status=ae)):n.status=ae),0!==n.pending){if(o(l),0===l.avail_out)return n.last_flush=-1,P;}else if(0===l.avail_in&&i(c)<=i(e)&&c!==T)return L(l,R);if(n.status===oe&&0!==l.avail_in)return L(l,R);if(0!==l.avail_in||0!==n.lookahead||c!==E&&n.status!==oe){var h=n.strategy===F?u(n,c):n.strategy===3?p(n,c):se[n.level].func(n,c);if(h!==ie&&h!==le||(n.status=oe),h===re||h===ie)return 0===l.avail_out&&(n.last_flush=-1),P;if(h===ne&&(c===1?b._tr_align(n):c!==M&&(b._tr_stored_block(n,0,0,!1),c===3&&(U(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),o(l),0===l.avail_out))return n.last_flush=-1,P}return c===T?0>=n.wrap?A:(2===n.wrap?(a(n,255&l.adler),a(n,255&l.adler>>8),a(n,255&l.adler>>16),a(n,255&l.adler>>24),a(n,255&l.total_in),a(n,255&l.total_in>>8),a(n,255&l.total_in>>16),a(n,255&l.total_in>>24)):(r(n,l.adler>>>16),r(n,65535&l.adler)),o(l),0<n.wrap&&(n.wrap=-n.wrap),0===n.pending?A:P):P},t.deflateEnd=function(a){var t;return a&&a.state?(t=a.state.status)!==K&&t!==Q&&t!==$&&t!==ee&&t!==te&&t!==ae&&t!==oe?L(a,I):(a.state=null,t===ae?L(a,-3):P):I},t.deflateSetDictionary=function(o,d){var e=d.length,p,n,i,r,a,s,l,c;if(!o||!o.state)return I;if(p=o.state,2===(r=p.wrap)||1===r&&p.status!==K||p.lookahead)return I;for(1===r&&(o.adler=x(o.adler,d,e,0)),p.wrap=0,e>=p.w_size&&(0===r&&(U(p.head),p.strstart=0,p.block_start=0,p.insert=0),c=new y.Buf8(p.w_size),y.arraySet(c,d,e-p.w_size,p.w_size,0),d=c,e=p.w_size),a=o.avail_in,s=o.next_in,l=o.input,o.avail_in=e,o.next_in=0,o.input=d,j(p);p.lookahead>=Y;){n=p.strstart,i=p.lookahead-(Y-1);do p.ins_h=(p.ins_h<<p.hash_shift^p.window[n+Y-1])&p.hash_mask,p.prev[n&p.w_mask]=p.head[p.ins_h],p.head[p.ins_h]=n,n++;while(--i);p.strstart=n,p.lookahead=Y-1,j(p)}return p.strstart+=p.lookahead,p.block_start=p.strstart,p.insert=p.lookahead,p.lookahead=0,p.match_length=p.prev_length=Y-1,p.match_available=0,o.next_in=s,o.input=l,o.avail_in=a,p.wrap=r,P},t.deflateInfo="pako deflate (from Nodeca project)"},function(I,t,e){"use strict";function n(a){for(var t=a.length;0<=--t;)a[t]=0}function R(a,t,e,o,n){this.static_tree=a,this.extra_bits=t,this.extra_base=e,this.elems=o,this.max_length=n,this.has_stree=a&&a.length}function r(a,t){this.dyn_tree=a,this.max_code=0,this.stat_desc=t}function O(e){return 256>e?K[e]:K[256+(e>>>7)]}function a(a,t){a.pending_buf[a.pending++]=255&t,a.pending_buf[a.pending++]=255&t>>>8}function ee(o,t,e){o.bi_valid>B-e?(o.bi_buf|=65535&t<<o.bi_valid,a(o,o.bi_buf),o.bi_buf=t>>B-o.bi_valid,o.bi_valid+=e-B):(o.bi_buf|=65535&t<<o.bi_valid,o.bi_valid+=e)}function l(a,t,e){ee(a,e[2*t],e[2*t+1])}function i(a,t){var e=0;do e|=1&a,a>>>=1,e<<=1;while(0<--t);return e>>>1}function o(e){16===e.bi_valid?(a(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}function u(_,t){var e=t.dyn_tree,l=t.max_code,c=t.stat_desc.static_tree,h=t.stat_desc.has_stree,u=t.stat_desc.extra_bits,g=t.stat_desc.extra_base,d=t.stat_desc.max_length,f=0,m,n,i,r,o,a;for(r=0;r<=U;r++)_.bl_count[r]=0;for(e[2*_.heap[_.heap_max]+1]=0,m=_.heap_max+1;m<N;m++)(r=e[2*e[2*(n=_.heap[m])+1]+1]+1)>d&&(r=d,f++),e[2*n+1]=r,n>l||(_.bl_count[r]++,o=0,n>=g&&(o=u[n-g]),a=e[2*n],_.opt_len+=a*(r+o),h&&(_.static_len+=a*(c[2*n+1]+o)));if(0!==f){do{for(r=d-1;0===_.bl_count[r];)r--;_.bl_count[r]--,_.bl_count[r+1]+=2,_.bl_count[d]--,f-=2}while(0<f);for(r=d;0!==r;r--)for(n=_.bl_count[r];0!==n;)(i=_.heap[--m])>l||(e[2*i+1]!==r&&(_.opt_len+=(r-e[2*i+1])*e[2*i],e[2*i+1]=r),n--)}}function p(l,t,e){var n=Array(U+1),o=0,a,c;for(a=1;a<=U;a++)n[a]=o=o+e[a-1]<<1;for(c=0;c<=t;c++){var r=l[2*c+1];0!==r&&(l[2*c]=i(n[r]++,r))}}function s(){var r=Array(U+1),a,t,e,n,l;for(e=0,n=0;n<L-1;n++)for($[n]=e,a=0;a<1<<j[n];a++)Q[e++]=n;for(Q[e-1]=n,l=0,n=0;16>n;n++)for(te[n]=l,a=0;a<1<<q[n];a++)K[l++]=n;for(l>>=7;n<k;n++)for(te[n]=l<<7,a=0;a<1<<q[n]-7;a++)K[256+l++]=n;for(t=0;t<=U;t++)r[t]=0;for(a=0;143>=a;)Z[2*a+1]=8,a++,r[8]++;for(;255>=a;)Z[2*a+1]=9,a++,r[9]++;for(;279>=a;)Z[2*a+1]=7,a++,r[7]++;for(;287>=a;)Z[2*a+1]=8,a++,r[8]++;for(p(Z,D+1,r),a=0;a<k;a++)J[2*a+1]=5,J[2*a]=i(a,5);oe=new R(Z,j,A+1,D,U),re=new R(J,q,0,k,U),ne=new R([],X,0,F,z)}function c(a){var t;for(t=0;t<D;t++)a.dyn_ltree[2*t]=0;for(t=0;t<k;t++)a.dyn_dtree[2*t]=0;for(t=0;t<F;t++)a.bl_tree[2*t]=0;a.dyn_ltree[2*G]=1,a.opt_len=a.static_len=0,a.last_lit=a.matches=0}function d(e){8<e.bi_valid?a(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function m(o,t,e,r){d(o),r&&(a(o,e),a(o,~e)),E.arraySet(o.pending_buf,o.window,t,e,o.pending),o.pending+=e}function _(a,t,e,n){var i=2*t,r=2*e;return a[i]<a[r]||a[i]===a[r]&&n[t]<=n[e]}function h(a,t,e){for(var o=a.heap[e],n=e<<1;n<=a.heap_len&&(n<a.heap_len&&_(t,a.heap[n+1],a.heap[n],a.depth)&&n++,!_(t,o,a.heap[n],a.depth));)a.heap[e]=a.heap[n],e=n,n<<=1;a.heap[e]=o}function g(a,t,e){var n=0,c,i,r,o;if(0!==a.last_lit)do c=a.pending_buf[a.d_buf+2*n]<<8|a.pending_buf[a.d_buf+2*n+1],i=a.pending_buf[a.l_buf+n],n++,0===c?l(a,i,t):(l(a,(r=Q[i])+A+1,t),0!==(o=j[r])&&ee(a,i-=$[r],o),l(a,r=O(--c),e),0!==(o=q[r])&&ee(a,c-=te[r],o));while(n<a.last_lit);l(a,G,t)}function f(d,t){var e=t.dyn_tree,o=t.stat_desc.static_tree,a=t.stat_desc.has_stree,s=t.stat_desc.elems,l=-1,c,n,i;for(d.heap_len=0,d.heap_max=N,c=0;c<s;c++)0===e[2*c]?e[2*c+1]=0:(d.heap[++d.heap_len]=l=c,d.depth[c]=0);for(;2>d.heap_len;)e[2*(i=d.heap[++d.heap_len]=2>l?++l:0)]=1,d.depth[i]=0,d.opt_len--,a&&(d.static_len-=o[2*i+1]);for(t.max_code=l,c=d.heap_len>>1;1<=c;c--)h(d,e,c);i=s;do c=d.heap[1],d.heap[1]=d.heap[d.heap_len--],h(d,e,1),n=d.heap[1],d.heap[--d.heap_max]=c,d.heap[--d.heap_max]=n,e[2*i]=e[2*c]+e[2*n],d.depth[i]=(d.depth[c]>=d.depth[n]?d.depth[c]:d.depth[n])+1,e[2*c+1]=e[2*n+1]=i,d.heap[1]=i++,h(d,e,1);while(2<=d.heap_len);d.heap[--d.heap_max]=d.heap[1],u(d,t),p(e,l,d.bl_count)}function y(d,t,e){var n=-1,o=t[1],a=0,s=7,l=4,c,i;for(0===o&&(s=138,l=3),t[2*(e+1)+1]=65535,c=0;c<=e;c++)i=o,o=t[2*(c+1)+1],++a<s&&i===o||(a<l?d.bl_tree[2*i]+=a:0===i?10>=a?d.bl_tree[2*V]++:d.bl_tree[2*W]++:(i!==n&&d.bl_tree[2*i]++,d.bl_tree[2*H]++),a=0,n=i,0===o?(s=138,l=3):i===o?(s=6,l=3):(s=7,l=4))}function b(c,t,e){var n=-1,o=t[1],a=0,s=7,d=4,p,i;for(0===o&&(s=138,d=3),p=0;p<=e;p++)if(i=o,o=t[2*(p+1)+1],!(++a<s&&i===o)){if(a<d)do l(c,i,c.bl_tree);while(0!=--a);else 0===i?10>=a?(l(c,V,c.bl_tree),ee(c,a-3,3)):(l(c,W,c.bl_tree),ee(c,a-11,7)):(i!==n&&(l(c,i,c.bl_tree),a--),l(c,H,c.bl_tree),ee(c,a-3,2));a=0,n=i,0===o?(s=138,d=3):i===o?(s=6,d=3):(s=7,d=4)}}function x(a){var t;for(y(a,a.dyn_ltree,a.l_desc.max_code),y(a,a.dyn_dtree,a.d_desc.max_code),f(a,a.bl_desc),t=F-1;3<=t&&0===a.bl_tree[2*Y[t]+1];t--);return a.opt_len+=3*(t+1)+5+5+4,t}function v(a,t,e,o){var n;for(ee(a,t-257,5),ee(a,e-1,5),ee(a,o-4,4),n=0;n<o;n++)ee(a,a.bl_tree[2*Y[n]+1],3);b(a,a.dyn_ltree,t-1),b(a,a.dyn_dtree,e-1)}function S(a){var t=4093624447,o;for(o=0;31>=o;o++,t>>>=1)if(1&t&&0!==a.dyn_ltree[2*o])return T;if(0!==a.dyn_ltree[18]||0!==a.dyn_ltree[20]||0!==a.dyn_ltree[26])return M;for(o=32;o<A;o++)if(0!==a.dyn_ltree[2*o])return M;return T}function w(a,t,e,o){ee(a,(P<<1)+(o?1:0),3),m(a,t,e,!0)}var E=e(17),T=0,M=1,P=0,C=1,L=29,A=256,D=A+1+L,k=30,F=19,N=2*D+1,U=15,B=16,z=7,G=256,H=16,V=17,W=18,j=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],q=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],X=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Y=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Z=Array(2*(D+2));n(Z);var J=Array(2*k);n(J);var K=Array(512);n(K);var Q=Array(256);n(Q);var $=Array(L);n($);var te=Array(k);n(te);var ae=!1,oe,re,ne;t._tr_init=function(e){ae||(s(),ae=!0),e.l_desc=new r(e.dyn_ltree,oe),e.d_desc=new r(e.dyn_dtree,re),e.bl_desc=new r(e.bl_tree,ne),e.bi_buf=0,e.bi_valid=0,c(e)},t._tr_stored_block=w,t._tr_flush_block=function(l,t,e,n){var i=0,a,r;0<l.level?(l.strm.data_type===2&&(l.strm.data_type=S(l)),f(l,l.l_desc),f(l,l.d_desc),i=x(l),a=l.opt_len+3+7>>>3,(r=l.static_len+3+7>>>3)<=a&&(a=r)):a=r=e+5,e+4<=a&&-1!==t?w(l,t,e,n):l.strategy===4||r===a?(ee(l,(C<<1)+(n?1:0),3),g(l,Z,J)):(ee(l,(2<<1)+(n?1:0),3),v(l,l.l_desc.max_code+1,l.d_desc.max_code+1,i+1),g(l,l.dyn_ltree,l.dyn_dtree)),c(l),n&&d(l)},t._tr_tally=function(a,t,e){return a.pending_buf[a.d_buf+2*a.last_lit]=255&t>>>8,a.pending_buf[a.d_buf+2*a.last_lit+1]=255&t,a.pending_buf[a.l_buf+a.last_lit]=255&e,a.last_lit++,0===t?a.dyn_ltree[2*e]++:(a.matches++,t--,a.dyn_ltree[2*(Q[e]+A+1)]++,a.dyn_dtree[2*O(t)]++),a.last_lit===a.lit_bufsize-1},t._tr_align=function(e){ee(e,C<<1,3),l(e,G,Z),o(e)}},function(y,t,e){"use strict";function x(e){return(255&e>>>24)+(65280&e>>>8)+((65280&e)<<8)+((255&e)<<24)}function T(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new h.Buf16(320),this.work=new h.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function r(a){var t;return a&&a.state?(t=a.state,a.total_in=a.total_out=t.total=0,a.msg="",t.wrap&&(a.adler=1&t.wrap),t.mode=L,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new h.Buf32(l),t.distcode=t.distdyn=new h.Buf32(s),t.sane=1,t.back=-1,S):E}function o(a){var t;return a&&a.state?(t=a.state,t.wsize=0,t.whave=0,t.wnext=0,r(a)):E}function a(a,t){var r,n;return a&&a.state?(n=a.state,0>t?(r=0,t=-t):(r=1+(t>>4),48>t&&(t&=15)),t&&(8>t||15<t)?E:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,o(a))):E}function n(o,t){var e,r;return o?(r=new T,o.state=r,r.window=null,(e=a(o,t))!==S&&(o.state=null),e):E}function i(a){if(le){var t;for(se=new h.Buf32(512),u=new h.Buf32(32),t=0;144>t;)a.lens[t++]=8;for(;256>t;)a.lens[t++]=9;for(;280>t;)a.lens[t++]=7;for(;288>t;)a.lens[t++]=8;for(_(g,a.lens,0,288,se,0,a.work,{bits:9}),t=0;32>t;)a.lens[t++]=5;_(v,a.lens,0,32,u,0,a.work,{bits:5}),le=!1}a.lencode=se,a.lenbits=9,a.distcode=u,a.distbits=5}function c(a,t,e,n){var i=a.state,o;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new h.Buf8(i.wsize)),n>=i.wsize?(h.arraySet(i.window,t,e-i.wsize,i.wsize,0),i.wnext=0,i.whave=i.wsize):((o=i.wsize-i.wnext)>n&&(o=n),h.arraySet(i.window,t,e-n,o,i.wnext),(n-=o)?(h.arraySet(i.window,t,e-n,n,0),i.wnext=n,i.whave=i.wsize):(i.wnext+=o,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=o))),0}var h=e(17),d=e(69),f=e(70),m=e(150),_=e(151),g=1,v=2,b=4,w=6,S=0,E=-2,M=-3,P=-4,C=8,L=1,A=2,I=3,R=4,D=5,k=6,U=7,N=8,B=9,z=10,O=11,G=12,H=13,V=14,W=15,j=16,q=17,X=18,Y=19,Z=20,J=21,K=22,Q=23,$=24,ee=25,te=26,ae=27,oe=28,re=29,ne=30,ie=31,l=852,s=592,le=!0,se,u;t.inflateReset=o,t.inflateReset2=a,t.inflateResetKeep=r,t.inflateInit=function(e){return n(e,15)},t.inflateInit2=n,t.inflate=function(y,T){var e=0,le=new h.Buf8(4),se=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ce,n,r,o,a,s,l,u,p,de,pe,ue,me,_e,he,ge,fe,ye,be,xe,ve,Se,we,Ee;if(!y||!y.state||!y.output||!y.input&&0!==y.avail_in)return E;(ce=y.state).mode===G&&(ce.mode=H),a=y.next_out,r=y.output,l=y.avail_out,o=y.next_in,n=y.input,s=y.avail_in,u=ce.hold,p=ce.bits,de=s,pe=l,Se=S;t:for(;;)switch(ce.mode){case L:if(0===ce.wrap){ce.mode=H;break}for(;16>p;){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}if(2&ce.wrap&&35615===u){ce.check=0,le[0]=255&u,le[1]=255&u>>>8,ce.check=f(ce.check,le,2,0),u=0,p=0,ce.mode=A;break}if(ce.flags=0,ce.head&&(ce.head.done=!1),!(1&ce.wrap)||(((255&u)<<8)+(u>>8))%31){y.msg="incorrect header check",ce.mode=ne;break}if((15&u)!==C){y.msg="unknown compression method",ce.mode=ne;break}if(u>>>=4,p-=4,ve=8+(15&u),0===ce.wbits)ce.wbits=ve;else if(ve>ce.wbits){y.msg="invalid window size",ce.mode=ne;break}ce.dmax=1<<ve,y.adler=ce.check=1,ce.mode=512&u?z:G,u=0,p=0;break;case A:for(;16>p;){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}if(ce.flags=u,(255&ce.flags)!==C){y.msg="unknown compression method",ce.mode=ne;break}if(57344&ce.flags){y.msg="unknown header flags set",ce.mode=ne;break}ce.head&&(ce.head.text=1&u>>8),512&ce.flags&&(le[0]=255&u,le[1]=255&u>>>8,ce.check=f(ce.check,le,2,0)),u=0,p=0,ce.mode=I;case I:for(;32>p;){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}ce.head&&(ce.head.time=u),512&ce.flags&&(le[0]=255&u,le[1]=255&u>>>8,le[2]=255&u>>>16,le[3]=255&u>>>24,ce.check=f(ce.check,le,4,0)),u=0,p=0,ce.mode=R;case R:for(;16>p;){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}ce.head&&(ce.head.xflags=255&u,ce.head.os=u>>8),512&ce.flags&&(le[0]=255&u,le[1]=255&u>>>8,ce.check=f(ce.check,le,2,0)),u=0,p=0,ce.mode=D;case D:if(1024&ce.flags){for(;16>p;){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}ce.length=u,ce.head&&(ce.head.extra_len=u),512&ce.flags&&(le[0]=255&u,le[1]=255&u>>>8,ce.check=f(ce.check,le,2,0)),u=0,p=0}else ce.head&&(ce.head.extra=null);ce.mode=k;case k:if(1024&ce.flags&&((ue=ce.length)>s&&(ue=s),ue&&(ce.head&&(ve=ce.head.extra_len-ce.length,ce.head.extra||(ce.head.extra=Array(ce.head.extra_len)),h.arraySet(ce.head.extra,n,o,ue,ve)),512&ce.flags&&(ce.check=f(ce.check,n,ue,o)),s-=ue,o+=ue,ce.length-=ue),ce.length))break t;ce.length=0,ce.mode=U;case U:if(2048&ce.flags){if(0===s)break t;ue=0;do ve=n[o+ue++],ce.head&&ve&&65536>ce.length&&(ce.head.name+=F(ve));while(ve&&ue<s);if(512&ce.flags&&(ce.check=f(ce.check,n,ue,o)),s-=ue,o+=ue,ve)break t}else ce.head&&(ce.head.name=null);ce.length=0,ce.mode=N;case N:if(4096&ce.flags){if(0===s)break t;ue=0;do ve=n[o+ue++],ce.head&&ve&&65536>ce.length&&(ce.head.comment+=F(ve));while(ve&&ue<s);if(512&ce.flags&&(ce.check=f(ce.check,n,ue,o)),s-=ue,o+=ue,ve)break t}else ce.head&&(ce.head.comment=null);ce.mode=B;case B:if(512&ce.flags){for(;16>p;){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}if(u!==(65535&ce.check)){y.msg="header crc mismatch",ce.mode=ne;break}u=0,p=0}ce.head&&(ce.head.hcrc=1&ce.flags>>9,ce.head.done=!0),y.adler=ce.check=0,ce.mode=G;break;case z:for(;32>p;){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}y.adler=ce.check=x(u),u=0,p=0,ce.mode=O;case O:if(0===ce.havedict)return y.next_out=a,y.avail_out=l,y.next_in=o,y.avail_in=s,ce.hold=u,ce.bits=p,2;y.adler=ce.check=1,ce.mode=G;case G:if(T===5||T===w)break t;case H:if(ce.last){u>>>=7&p,p-=7&p,ce.mode=ae;break}for(;3>p;){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}switch(ce.last=1&u,u>>>=1,p-=1,3&u){case 0:ce.mode=V;break;case 1:if(i(ce),ce.mode=Z,T===w){u>>>=2,p-=2;break t}break;case 2:ce.mode=q;break;case 3:y.msg="invalid block type",ce.mode=ne;}u>>>=2,p-=2;break;case V:for(u>>>=7&p,p-=7&p;32>p;){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}if((65535&u)!=(65535^u>>>16)){y.msg="invalid stored block lengths",ce.mode=ne;break}if(ce.length=65535&u,u=0,p=0,ce.mode=W,T===w)break t;case W:ce.mode=j;case j:if(ue=ce.length){if(ue>s&&(ue=s),ue>l&&(ue=l),0===ue)break t;h.arraySet(r,n,o,ue,a),s-=ue,o+=ue,l-=ue,a+=ue,ce.length-=ue;break}ce.mode=G;break;case q:for(;14>p;){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}if(ce.nlen=257+(31&u),u>>>=5,p-=5,ce.ndist=1+(31&u),u>>>=5,p-=5,ce.ncode=4+(15&u),u>>>=4,p-=4,286<ce.nlen||30<ce.ndist){y.msg="too many length or distance symbols",ce.mode=ne;break}ce.have=0,ce.mode=X;case X:for(;ce.have<ce.ncode;){for(;3>p;){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}ce.lens[se[ce.have++]]=7&u,u>>>=3,p-=3}for(;19>ce.have;)ce.lens[se[ce.have++]]=0;if(ce.lencode=ce.lendyn,ce.lenbits=7,we={bits:ce.lenbits},Se=_(0,ce.lens,0,19,ce.lencode,0,ce.work,we),ce.lenbits=we.bits,Se){y.msg="invalid code lengths set",ce.mode=ne;break}ce.have=0,ce.mode=Y;case Y:for(;ce.have<ce.nlen+ce.ndist;){for(;e=ce.lencode[u&(1<<ce.lenbits)-1],he=e>>>24,ge=255&e>>>16,fe=65535&e,!(he<=p);){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}if(16>fe)u>>>=he,p-=he,ce.lens[ce.have++]=fe;else{if(16===fe){for(Ee=he+2;p<Ee;){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}if(u>>>=he,p-=he,0===ce.have){y.msg="invalid bit length repeat",ce.mode=ne;break}ve=ce.lens[ce.have-1],ue=3+(3&u),u>>>=2,p-=2}else if(17===fe){for(Ee=he+3;p<Ee;){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}p-=he,ve=0,ue=3+(7&(u>>>=he)),u>>>=3,p-=3}else{for(Ee=he+7;p<Ee;){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}p-=he,ve=0,ue=11+(127&(u>>>=he)),u>>>=7,p-=7}if(ce.have+ue>ce.nlen+ce.ndist){y.msg="invalid bit length repeat",ce.mode=ne;break}for(;ue--;)ce.lens[ce.have++]=ve}}if(ce.mode===ne)break;if(0===ce.lens[256]){y.msg="invalid code -- missing end-of-block",ce.mode=ne;break}if(ce.lenbits=9,we={bits:ce.lenbits},Se=_(g,ce.lens,0,ce.nlen,ce.lencode,0,ce.work,we),ce.lenbits=we.bits,Se){y.msg="invalid literal/lengths set",ce.mode=ne;break}if(ce.distbits=6,ce.distcode=ce.distdyn,we={bits:ce.distbits},Se=_(v,ce.lens,ce.nlen,ce.ndist,ce.distcode,0,ce.work,we),ce.distbits=we.bits,Se){y.msg="invalid distances set",ce.mode=ne;break}if(ce.mode=Z,T===w)break t;case Z:ce.mode=J;case J:if(6<=s&&258<=l){y.next_out=a,y.avail_out=l,y.next_in=o,y.avail_in=s,ce.hold=u,ce.bits=p,m(y,pe),a=y.next_out,r=y.output,l=y.avail_out,o=y.next_in,n=y.input,s=y.avail_in,u=ce.hold,p=ce.bits,ce.mode===G&&(ce.back=-1);break}for(ce.back=0;e=ce.lencode[u&(1<<ce.lenbits)-1],he=e>>>24,ge=255&e>>>16,fe=65535&e,!(he<=p);){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}if(ge&&0==(240&ge)){for(ye=he,be=ge,xe=fe;e=ce.lencode[xe+((u&(1<<ye+be)-1)>>ye)],he=e>>>24,ge=255&e>>>16,fe=65535&e,!(ye+he<=p);){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}u>>>=ye,p-=ye,ce.back+=ye}if(u>>>=he,p-=he,ce.back+=he,ce.length=fe,0===ge){ce.mode=te;break}if(32&ge){ce.back=-1,ce.mode=G;break}if(64&ge){y.msg="invalid literal/length code",ce.mode=ne;break}ce.extra=15&ge,ce.mode=K;case K:if(ce.extra){for(Ee=ce.extra;p<Ee;){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}ce.length+=u&(1<<ce.extra)-1,u>>>=ce.extra,p-=ce.extra,ce.back+=ce.extra}ce.was=ce.length,ce.mode=Q;case Q:for(;e=ce.distcode[u&(1<<ce.distbits)-1],he=e>>>24,ge=255&e>>>16,fe=65535&e,!(he<=p);){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}if(0==(240&ge)){for(ye=he,be=ge,xe=fe;e=ce.distcode[xe+((u&(1<<ye+be)-1)>>ye)],he=e>>>24,ge=255&e>>>16,fe=65535&e,!(ye+he<=p);){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}u>>>=ye,p-=ye,ce.back+=ye}if(u>>>=he,p-=he,ce.back+=he,64&ge){y.msg="invalid distance code",ce.mode=ne;break}ce.offset=fe,ce.extra=15&ge,ce.mode=$;case $:if(ce.extra){for(Ee=ce.extra;p<Ee;){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}ce.offset+=u&(1<<ce.extra)-1,u>>>=ce.extra,p-=ce.extra,ce.back+=ce.extra}if(ce.offset>ce.dmax){y.msg="invalid distance too far back",ce.mode=ne;break}ce.mode=ee;case ee:if(0===l)break t;if(ue=pe-l,ce.offset>ue){if((ue=ce.offset-ue)>ce.whave&&ce.sane){y.msg="invalid distance too far back",ce.mode=ne;break}ue>ce.wnext?(ue-=ce.wnext,me=ce.wsize-ue):me=ce.wnext-ue,ue>ce.length&&(ue=ce.length),_e=ce.window}else _e=r,me=a-ce.offset,ue=ce.length;ue>l&&(ue=l),l-=ue,ce.length-=ue;do r[a++]=_e[me++];while(--ue);0===ce.length&&(ce.mode=J);break;case te:if(0===l)break t;r[a++]=ce.length,l--,ce.mode=J;break;case ae:if(ce.wrap){for(;32>p;){if(0===s)break t;s--,u|=n[o++]<<p,p+=8}if(pe-=l,y.total_out+=pe,ce.total+=pe,pe&&(y.adler=ce.check=ce.flags?f(ce.check,r,pe,a-pe):d(ce.check,r,pe,a-pe)),pe=l,(ce.flags?u:x(u))!==ce.check){y.msg="incorrect data check",ce.mode=ne;break}u=0,p=0}ce.mode=oe;case oe:if(ce.wrap&&ce.flags){for(;32>p;){if(0===s)break t;s--,u+=n[o++]<<p,p+=8}if(u!==(4294967295&ce.total)){y.msg="incorrect length check",ce.mode=ne;break}u=0,p=0}ce.mode=re;case re:Se=1;break t;case ne:Se=M;break t;case ie:return P;case 32:default:return E;}return y.next_out=a,y.avail_out=l,y.next_in=o,y.avail_in=s,ce.hold=u,ce.bits=p,(ce.wsize||pe!==y.avail_out&&ce.mode<ne&&(ce.mode<ae||T!==b))&&c(y,y.output,y.next_out,pe-y.avail_out)?(ce.mode=ie,P):(de-=y.avail_in,pe-=y.avail_out,y.total_in+=de,y.total_out+=pe,ce.total+=pe,ce.wrap&&pe&&(y.adler=ce.check=ce.flags?f(ce.check,r,pe,y.next_out-pe):d(ce.check,r,pe,y.next_out-pe)),y.data_type=ce.bits+(ce.last?64:0)+(ce.mode===G?128:0)+(ce.mode===Z||ce.mode===W?256:0),(0===de&&0===pe||T===b)&&Se===S&&(Se=-5),Se)},t.inflateEnd=function(a){if(!a||!a.state)return E;var o=a.state;return o.window&&(o.window=null),a.state=null,S},t.inflateGetHeader=function(a,t){var e;return a&&a.state?0==(2&(e=a.state).wrap)?E:(e.head=t,t.done=!1,S):E},t.inflateSetDictionary=function(a,t){var e=t.length,o,r;return a&&a.state?0!==(o=a.state).wrap&&o.mode!==O?E:o.mode===O&&(r=1,(r=d(r,t,e,0))!==o.check)?M:c(a,t,e,e)?(o.mode=ie,P):(o.havedict=1,S):E},t.inflateInfo="pako inflate (from Nodeca project)"},function(e){"use strict";e.exports=function(P,t){var e,n,i,r,o,a,s,l,c,h,u,p,d,f,m,_,g,y,v,b,w,x,S,E,M;e=P.state,n=P.next_in,E=P.input,i=n+(P.avail_in-5),r=P.next_out,M=P.output,o=r-(t-P.avail_out),a=r+(P.avail_out-257),s=e.dmax,l=e.wsize,c=e.whave,h=e.wnext,u=e.window,p=e.hold,d=e.bits,f=e.lencode,m=e.distcode,_=(1<<e.lenbits)-1,g=(1<<e.distbits)-1;t:do{15>d&&(p+=E[n++]<<d,d+=8,p+=E[n++]<<d,d+=8),y=f[p&_];e:for(;;){if(v=y>>>24,p>>>=v,d-=v,0===(v=255&y>>>16))M[r++]=65535&y;else{if(!(16&v)){if(0==(64&v)){y=f[(65535&y)+(p&(1<<v)-1)];continue e}if(32&v){e.mode=12;break t}P.msg="invalid literal/length code",e.mode=30;break t}b=65535&y,(v&=15)&&(d<v&&(p+=E[n++]<<d,d+=8),b+=p&(1<<v)-1,p>>>=v,d-=v),15>d&&(p+=E[n++]<<d,d+=8,p+=E[n++]<<d,d+=8),y=m[p&g];n:for(;;){if(v=y>>>24,p>>>=v,d-=v,!(16&(v=255&y>>>16))){if(0==(64&v)){y=m[(65535&y)+(p&(1<<v)-1)];continue n}P.msg="invalid distance code",e.mode=30;break t}if(w=65535&y,v&=15,d<v&&(p+=E[n++]<<d,(d+=8)<v&&(p+=E[n++]<<d,d+=8)),(w+=p&(1<<v)-1)>s){P.msg="invalid distance too far back",e.mode=30;break t}if(p>>>=v,d-=v,v=r-o,w>v){if((v=w-v)>c&&e.sane){P.msg="invalid distance too far back",e.mode=30;break t}if(x=0,S=u,0===h){if(x+=l-v,v<b){b-=v;do M[r++]=u[x++];while(--v);x=r-w,S=M}}else if(h<v){if(x+=l+h-v,(v-=h)<b){b-=v;do M[r++]=u[x++];while(--v);if(x=0,h<b){b-=v=h;do M[r++]=u[x++];while(--v);x=r-w,S=M}}}else if(x+=h-v,v<b){b-=v;do M[r++]=u[x++];while(--v);x=r-w,S=M}for(;2<b;)M[r++]=S[x++],M[r++]=S[x++],M[r++]=S[x++],b-=3;b&&(M[r++]=S[x++],1<b&&(M[r++]=S[x++]))}else{x=r-w;do M[r++]=M[x++],M[r++]=M[x++],M[r++]=M[x++],b-=3;while(2<b);b&&(M[r++]=M[x++],1<b&&(M[r++]=M[x++]))}break}}break}}while(n<i&&r<a);n-=b=d>>3,p&=(1<<(d-=b<<3))-1,P.next_in=n,P.next_out=r,P.avail_in=n<i?i-n+5:5-(n-i),P.avail_out=r<a?a-r+257:257-(r-a),e.hold=p,e.bits=d}},function(l,t,e){"use strict";var B=e(17),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],r=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],a=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];l.exports=function(s,t,e,n,l,c,h,u){var p=u.bits,x=0,S=0,E=0,M=0,T=0,A=0,P=0,I=0,C=0,L=0,R=null,k=0,D=new B.Buf16(16),z=new B.Buf16(16),F=null,U=0,N,d,f,m,_,g,y,v,b;for(x=0;15>=x;x++)D[x]=0;for(S=0;S<n;S++)D[t[e+S]]++;for(T=p,M=15;1<=M&&0===D[M];M--);if(T>M&&(T=M),0===M)return l[c++]=20971520,l[c++]=20971520,u.bits=1,0;for(E=1;E<M&&0===D[E];E++);for(T<E&&(T=E),I=1,x=1;15>=x;x++)if(I<<=1,0>(I-=D[x]))return-1;if(0<I&&(0===s||1!==M))return-1;for(z[1]=0,x=1;15>x;x++)z[x+1]=z[x]+D[x];for(S=0;S<n;S++)0!==t[e+S]&&(h[z[t[e+S]]++]=S);if(0===s?(R=F=h,g=19):1===s?(R=i,k-=257,F=r,U-=257,g=256):(R=o,F=a,g=-1),L=0,S=0,x=E,_=c,A=T,P=0,f=-1,C=1<<T,m=C-1,1===s&&852<C||2===s&&592<C)return 1;for(;;){0,y=x-P,h[S]<g?(v=0,b=h[S]):h[S]>g?(v=F[U+h[S]],b=R[k+h[S]]):(v=96,b=0),N=1<<x-P,E=d=1<<A;do l[_+(L>>P)+(d-=N)]=0|(y<<24|v<<16|b);while(0!==d);for(N=1<<x-1;L&N;)N>>=1;if(0===N?L=0:(L&=N-1,L+=N),S++,0==--D[x]){if(x===M)break;x=t[e+h[S]]}if(x>T&&(L&m)!==f){for(0===P&&(P=T),_+=E,I=1<<(A=x-P);A+P<M&&!(0>=(I-=D[A+P]));)A++,I<<=1;if(C+=1<<A,1===s&&852<C||2===s&&592<C)return 1;l[f=L&m]=0|(T<<24|A<<16|_-c)}}return 0!==L&&(l[_+L]=0|(x-P<<24|4194304)),u.bits=T,0}},function(e){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e){e.exports=function(e){return e&&"object"==("undefined"===typeof e?"undefined":babelHelpers.typeof(e))&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e){e.exports="function"==typeof Object.create?function(a,o){a.super_=o,a.prototype=Object.create(o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:function(a,t){a.super_=t;var e=function(){};e.prototype=t.prototype,a.prototype=new e,a.prototype.constructor=a}},function(a,o,e){"use strict";var r=r||{};r.lossless=r.lossless||{},r.lossless.ComponentSpec=r.lossless.ComponentSpec||e(73),r.lossless.DataStream=r.lossless.DataStream||e(7),r.lossless.Decoder=r.lossless.Decoder||e(156),r.lossless.FrameHeader=r.lossless.FrameHeader||e(78),r.lossless.HuffmanTable=r.lossless.HuffmanTable||e(74),r.lossless.QuantizationTable=r.lossless.QuantizationTable||e(75),r.lossless.ScanComponent=r.lossless.ScanComponent||e(77),r.lossless.ScanHeader=r.lossless.ScanHeader||e(76),r.lossless.Utils=r.lossless.Utils||e(18),"undefined"!==typeof a&&a.exports&&(a.exports=r)},function(a,o,e){"use strict";var d=d||{};d.lossless=d.lossless||{},d.lossless.DataStream=d.lossless.DataStream||e(7),d.lossless.HuffmanTable=d.lossless.HuffmanTable||e(74),d.lossless.QuantizationTable=d.lossless.QuantizationTable||e(75),d.lossless.ScanHeader=d.lossless.ScanHeader||e(76),d.lossless.FrameHeader=d.lossless.FrameHeader||e(78),d.lossless.Utils=d.lossless.Utils||e(18),d.lossless.Decoder=d.lossless.Decoder||function(a,t){this.buffer=a,this.frame=new d.lossless.FrameHeader,this.huffTable=new d.lossless.HuffmanTable,this.quantTable=new d.lossless.QuantizationTable,this.scan=new d.lossless.ScanHeader,this.DU=d.lossless.Utils.createArray(10,4,64),this.HuffTab=d.lossless.Utils.createArray(4,2,12800),this.IDCT_Source=[],this.nBlock=[],this.acTab=d.lossless.Utils.createArray(10,1),this.dcTab=d.lossless.Utils.createArray(10,1),this.qTab=d.lossless.Utils.createArray(10,1),this.marker=0,this.markerIndex=0,this.numComp=0,this.restartInterval=0,this.selection=0,this.xDim=0,this.yDim=0,this.xLoc=0,this.yLoc=0,this.numBytes=0,this.outputData=null,this.restarting=!1,this.mask=0,void 0!==t&&(this.numBytes=t)},d.lossless.Decoder.IDCT_P=[0,5,40,16,45,2,7,42,21,56,8,61,18,47,1,4,41,23,58,13,32,24,37,10,63,17,44,3,6,43,20,57,15,34,29,48,53,26,39,9,60,19,46,22,59,12,33,31,50,55,25,36,11,62,14,35,28,49,52,27,38,30,51,54],d.lossless.Decoder.TABLE=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],d.lossless.Decoder.MAX_HUFFMAN_SUBTREE=50,d.lossless.Decoder.MSB=2147483648,d.lossless.Decoder.RESTART_MARKER_BEGIN=65488,d.lossless.Decoder.RESTART_MARKER_END=65495,d.lossless.Decoder.prototype.decompress=function(a,t,e){return this.decode(a,t,e).buffer},d.lossless.Decoder.prototype.decode=function(i,t,e,n){var r=0,c=[],m=[],u=[],p,o,a,s;if(void 0!==i&&(this.buffer=i),void 0!==n&&(this.numBytes=n),this.stream=new d.lossless.DataStream(this.buffer,t,e),this.buffer=null,this.xLoc=0,this.yLoc=0,65496!==(p=this.stream.get16()))throw new Error("Not a JPEG file");for(p=this.stream.get16();4092!=p>>4||65476===p;){switch(p){case 65476:this.huffTable.read(this.stream,this.HuffTab);break;case 65484:throw new Error("Program doesn't support arithmetic coding. (format throw new IOException)");case 65499:this.quantTable.read(this.stream,d.lossless.Decoder.TABLE);break;case 65501:this.restartInterval=this.readNumber();break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:this.readApp();break;case 65534:this.readComment();break;default:if(255!=p>>8)throw new Error("ERROR: format throw new IOException! (decode)");}p=this.stream.get16()}if(65472>p||65479<p)throw new Error("ERROR: could not handle arithmetic code!");this.frame.read(this.stream),p=this.stream.get16();do{for(;65498!==p;){switch(p){case 65476:this.huffTable.read(this.stream,this.HuffTab);break;case 65484:throw new Error("Program doesn't support arithmetic coding. (format throw new IOException)");case 65499:this.quantTable.read(this.stream,d.lossless.Decoder.TABLE);break;case 65501:this.restartInterval=this.readNumber();break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:this.readApp();break;case 65534:this.readComment();break;default:if(255!=p>>8)throw new Error("ERROR: format throw new IOException! (Parser.decode)");}p=this.stream.get16()}switch(this.precision=this.frame.precision,this.components=this.frame.components,this.numBytes||(this.numBytes=parseInt(T(this.precision/8))),this.mask=1==this.numBytes?255:65535,this.scan.read(this.stream),this.numComp=this.scan.numComp,this.selection=this.scan.selection,1===this.numBytes?3===this.numComp?(this.getter=this.getValueRGB,this.setter=this.setValueRGB,this.output=this.outputRGB):(this.getter=this.getValue8,this.setter=this.setValue8,this.output=this.outputSingle):(this.getter=this.getValue16,this.setter=this.setValue16,this.output=this.outputSingle),this.selection){case 2:this.selector=this.select2;break;case 3:this.selector=this.select3;break;case 4:this.selector=this.select4;break;case 5:this.selector=this.select5;break;case 6:this.selector=this.select6;break;case 7:this.selector=this.select7;break;default:this.selector=this.select1;}for(this.scanComps=this.scan.components,this.quantTables=this.quantTable.quantTables,o=0;o<this.numComp;o+=1)a=this.scanComps[o].scanCompSel,this.qTab[o]=this.quantTables[this.components[a].quantTableSel],this.nBlock[o]=this.components[a].vSamp*this.components[a].hSamp,this.dcTab[o]=this.HuffTab[this.scanComps[o].dcTabSel][0],this.acTab[o]=this.HuffTab[this.scanComps[o].acTabSel][1];for(this.xDim=this.frame.dimX,this.yDim=this.frame.dimY,this.outputData=new DataView(new ArrayBuffer(this.xDim*this.yDim*this.numBytes*this.numComp)),r+=1;;){for(m[0]=0,u[0]=0,o=0;10>o;o+=1)c[o]=1<<this.precision-1;if(0===this.restartInterval){for(p=this.decodeUnit(c,m,u);0===p&&this.xLoc<this.xDim&&this.yLoc<this.yDim;)this.output(c),p=this.decodeUnit(c,m,u);break}for(s=0;s<this.restartInterval&&(this.restarting=0==s,p=this.decodeUnit(c,m,u),this.output(c),0===p);s+=1);if(0===p&&(0===this.markerIndex?p=this.stream.get16():(p=65280|this.marker,this.markerIndex=0)),!(p>=d.lossless.Decoder.RESTART_MARKER_BEGIN&&p<=d.lossless.Decoder.RESTART_MARKER_END))break}65500===p&&1===r&&(this.readNumber(),p=this.stream.get16())}while(65497!==p&&this.xLoc<this.xDim&&this.yLoc<this.yDim&&0===r);return this.outputData},d.lossless.Decoder.prototype.decodeUnit=function(a,t,e){return 1==this.numComp?this.decodeSingle(a,t,e):3==this.numComp?this.decodeRGB(a,t,e):-1},d.lossless.Decoder.prototype.select1=function(e){return this.getPreviousX(e)},d.lossless.Decoder.prototype.select2=function(e){return this.getPreviousY(e)},d.lossless.Decoder.prototype.select3=function(e){return this.getPreviousXY(e)},d.lossless.Decoder.prototype.select4=function(e){return this.getPreviousX(e)+this.getPreviousY(e)-this.getPreviousXY(e)},d.lossless.Decoder.prototype.select5=function(e){return this.getPreviousX(e)+(this.getPreviousY(e)-this.getPreviousXY(e)>>1)},d.lossless.Decoder.prototype.select6=function(e){return this.getPreviousY(e)+(this.getPreviousX(e)-this.getPreviousXY(e)>>1)},d.lossless.Decoder.prototype.select7=function(e){return(this.getPreviousX(e)+this.getPreviousY(e))/2},d.lossless.Decoder.prototype.decodeRGB=function(i,t,e){var n,r,o,a,s,l,c,p;for(i[0]=this.selector(0),i[1]=this.selector(1),i[2]=this.selector(2),s=0;s<this.numComp;s+=1)for(a=this.qTab[s],r=this.acTab[s],o=this.dcTab[s],l=0;l<this.nBlock[s];l+=1){for(c=0;c<this.IDCT_Source.length;c+=1)this.IDCT_Source[c]=0;if(65280<=(n=this.getHuffmanValue(o,t,e)))return n;for(i[s]=this.IDCT_Source[0]=i[s]+this.getn(e,n,t,e),this.IDCT_Source[0]*=a[0],p=1;64>p;p+=1){if(65280<=(n=this.getHuffmanValue(r,t,e)))return n;if(p+=n>>4,0!=(15&n))this.IDCT_Source[d.lossless.Decoder.IDCT_P[p]]=this.getn(e,15&n,t,e)*a[p];else if(0==n>>4)break}}return 0},d.lossless.Decoder.prototype.decodeSingle=function(i,t,e){var n,r,o,a;for(this.restarting?(this.restarting=!1,i[0]=1<<this.frame.precision-1):i[0]=this.selector(),r=0;r<this.nBlock[0];r+=1){if(65280<=(n=this.getHuffmanValue(this.dcTab[0],t,e)))return n;if(o=this.getn(i,n,t,e),(a=o>>8)>=d.lossless.Decoder.RESTART_MARKER_BEGIN&&a<=d.lossless.Decoder.RESTART_MARKER_END)return a;i[0]+=o}return 0},d.lossless.Decoder.prototype.getHuffmanValue=function(a,t,e){var n,r;if(65535,8>e[0]?(t[0]<<=8,255===(r=this.stream.get8())&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),t[0]|=r):e[0]-=8,0!=((n=a[t[0]>>e[0]])&d.lossless.Decoder.MSB)){if(0!==this.markerIndex)return this.markerIndex=0,65280|this.marker;t[0]&=65535>>16-e[0],t[0]<<=8,255===(r=this.stream.get8())&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),t[0]|=r,n=a[256*(255&n)+(t[0]>>e[0])],e[0]+=8}if(e[0]+=8-(n>>8),0>e[0])throw new Error("index="+e[0]+" temp="+t[0]+" code="+n+" in HuffmanValue()");return e[0]<this.markerIndex?(this.markerIndex=0,65280|this.marker):(t[0]&=65535>>16-e[0],255&n)},d.lossless.Decoder.prototype.getn=function(a,t,e,n){var i,r;if(1,-1,65535,0===t)return 0;if(16===t)return 0<=a[0]?-32768:32768;if(n[0]-=t,0<=n[0]){if(n[0]<this.markerIndex&&!this.isLastPixel())return this.markerIndex=0,(65280|this.marker)<<8;i=e[0]>>n[0],e[0]&=65535>>16-n[0]}else{if(e[0]<<=8,255===(r=this.stream.get8())&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),e[0]|=r,n[0]+=8,0>n[0]){if(0!==this.markerIndex)return this.markerIndex=0,(65280|this.marker)<<8;e[0]<<=8,255===(r=this.stream.get8())&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),e[0]|=r,n[0]+=8}if(0>n[0])throw new Error("index="+n[0]+" in getn()");if(n[0]<this.markerIndex)return this.markerIndex=0,(65280|this.marker)<<8;i=e[0]>>n[0],e[0]&=65535>>16-n[0]}return i<1<<t-1&&(i+=1+(-1<<t)),i},d.lossless.Decoder.prototype.getPreviousX=function(e){return 0<this.xLoc?this.getter(this.yLoc*this.xDim+this.xLoc-1,e):0<this.yLoc?this.getPreviousY(e):1<<this.frame.precision-1},d.lossless.Decoder.prototype.getPreviousXY=function(e){return 0<this.xLoc&&0<this.yLoc?this.getter((this.yLoc-1)*this.xDim+this.xLoc-1,e):this.getPreviousY(e)},d.lossless.Decoder.prototype.getPreviousY=function(e){return 0<this.yLoc?this.getter((this.yLoc-1)*this.xDim+this.xLoc,e):this.getPreviousX(e)},d.lossless.Decoder.prototype.isLastPixel=function(){return this.xLoc===this.xDim-1&&this.yLoc===this.yDim-1},d.lossless.Decoder.prototype.outputSingle=function(e){this.xLoc<this.xDim&&this.yLoc<this.yDim&&(this.setter(this.yLoc*this.xDim+this.xLoc,this.mask&e[0]),this.xLoc+=1,this.xLoc>=this.xDim&&(this.yLoc+=1,this.xLoc=0))},d.lossless.Decoder.prototype.outputRGB=function(a){var t=this.yLoc*this.xDim+this.xLoc;this.xLoc<this.xDim&&this.yLoc<this.yDim&&(this.setter(t,a[0],0),this.setter(t,a[1],1),this.setter(t,a[2],2),this.xLoc+=1,this.xLoc>=this.xDim&&(this.yLoc+=1,this.xLoc=0))},d.lossless.Decoder.prototype.setValue16=function(a,t){this.outputData.setInt16(2*a,t,!0)},d.lossless.Decoder.prototype.getValue16=function(e){return this.outputData.getInt16(2*e,!0)},d.lossless.Decoder.prototype.setValue8=function(a,t){this.outputData.setInt8(a,t)},d.lossless.Decoder.prototype.getValue8=function(e){return this.outputData.getInt8(e)},d.lossless.Decoder.prototype.setValueRGB=function(a,t,e){this.outputData.setUint8(3*a+e,t)},d.lossless.Decoder.prototype.getValueRGB=function(a,t){return this.outputData.getUint8(3*a+t)},d.lossless.Decoder.prototype.readApp=function(){var a=0,t=this.stream.get16();for(a+=2;a<t;)this.stream.get8(),a+=1;return t},d.lossless.Decoder.prototype.readComment=function(){var a="",e=0,o;for(o=this.stream.get16(),e+=2;e<o;)a+=this.stream.get8(),e+=1;return a},d.lossless.Decoder.prototype.readNumber=function(){if(4!==this.stream.get16())throw new Error("ERROR: Define number format throw new IOException [Ld!=4]");return this.stream.get16()},"undefined"!==typeof a&&a.exports&&(a.exports=d.lossless.Decoder)},function(e){var a={Unkown:0,Grayscale:1,AdobeRGB:2,RGB:3,CYMK:4},o=function(){"use strict";function n(){}function g(c,t){for(var d=0,r=[],o=16,a,n;0<o&&!c[o-1];)o--;r.push({children:[],index:0});var i=r[0],l;for(a=0;a<o;a++){for(n=0;n<c[a];n++){for((i=r.pop()).children[i.index]=t[d];0<i.index;)i=r.pop();for(i.index++,r.push(i);r.length<=a;)r.push(l={children:[],index:0}),i.children[i.index]=l.children,i=l;d++}a+1<o&&(r.push(l={children:[],index:0}),i.children[i.index]=l.children,i=l)}return r[0].children}function y(a,t,e){return 64*((a.blocksPerLine+1)*t+e)}function e(i,t,e,n,l,F,a,o,s){function h(){if(0<S)return S--,1&x>>S;if(255==(x=i[t++])){var e=i[t++];if(e)throw"unexpected marker: "+(x<<8|e).toString(16)}return S=7,x>>>7}function N(a){for(var t=a,o;null!==(o=h());){if("number"==typeof(t=t[o]))return t;if("object"!=("undefined"===typeof t?"undefined":babelHelpers.typeof(t)))throw"invalid huffman sequence"}return null}function p(a){for(var t=0,e;0<a;){if(e=h(),null===e)return;t=t<<1|e,a--}return t}function d(a){var t=p(a);return t>=1<<a-1?t:t+(-1<<a)+1}e.precision,e.samplesPerLine,e.scanLines;var c=e.mcusPerLine,u=e.progressive,f=(e.maxH,e.maxV,t),x=0,S=0,E=0,T=0,M=n.length,P,m,_,g,A,v,I;I=u?0===F?0===o?function(a,t){var e=N(a.huffmanTableDC),o=0===e?0:d(e)<<s;a.blockData[t]=a.pred+=o}:function(a,t){a.blockData[t]|=h()<<s}:0===o?function(i,t){if(0<E)E--;else for(var e=F;e<=a;){var n=N(i.huffmanTableAC),r=15&n,o=n>>4;if(0!==r){var l=b[e+=o];i.blockData[t+l]=d(r)*(1<<s),e++}else{if(15>o){E=p(o)+(1<<o)-1;break}e+=16}}}:function(i,t){for(var e=F,n=0,r;e<=a;){switch(r=b[e],T){case 0:var o=N(i.huffmanTableAC),l=15&o;if(n=o>>4,0===l)15>n?(E=p(n)+(1<<n),T=4):(n=16,T=1);else{if(1!==l)throw"invalid ACn encoding";P=d(l),T=n?2:3}continue;case 1:case 2:i.blockData[t+r]?i.blockData[t+r]+=h()<<s:0==--n&&(T=2==T?3:0);break;case 3:i.blockData[t+r]?i.blockData[t+r]+=h()<<s:(i.blockData[t+r]=P<<s,T=0);break;case 4:i.blockData[t+r]&&(i.blockData[t+r]+=h()<<s);}e++}4===T&&0==--E&&(T=0)}:function(l,t){var e=N(l.huffmanTableDC),n=0===e?0:d(e);l.blockData[t]=l.pred+=n;for(var i=1;64>i;){var r=N(l.huffmanTableAC),o=15&r,a=r>>4;if(0!==o){var s=b[i+=a];l.blockData[t+s]=d(o),i++}else{if(15>a)break;i+=16}}};var w=0,R,C;C=1==M?n[0].blocksPerLine*n[0].blocksPerColumn:c*e.mcusPerColumn,l||(l=C);for(var L,k;w<C;){for(_=0;_<M;_++)n[_].pred=0;if(E=0,1==M)for(m=n[0],v=0;v<l;v++)!function(a,t,e){t(a,y(a,0|e/a.blocksPerLine,e%a.blocksPerLine))}(m,I,w),w++;else for(v=0;v<l;v++){for(_=0;_<M;_++)for(L=(m=n[_]).h,k=m.v,g=0;g<k;g++)for(A=0;A<L;A++)!function(a,t,e,n,r){t(a,y(a,(0|e/c)*a.v+n,e%c*a.h+r))}(m,I,w,g,A);w++}if(S=0,65280>=(R=i[t]<<8|i[t+1]))throw"marker was not found";if(!(65488<=R&&65495>=R))break;t+=2}return t-f}function t(_,t,e){var n=_.quantizationTable,T,i,r,P,a,s,l,g,y,v;for(v=0;64>v;v++)e[v]=_.blockData[t+v]*n[v];for(v=0;8>v;++v){var b=8*v;0!==e[1+b]||0!==e[2+b]||0!==e[3+b]||0!==e[4+b]||0!==e[5+b]||0!==e[6+b]||0!==e[7+b]?(T=f*e[0+b]+128>>8,i=f*e[4+b]+128>>8,r=e[2+b],P=e[6+b],a=m*(e[1+b]-e[7+b])+128>>8,g=m*(e[1+b]+e[7+b])+128>>8,s=e[3+b]<<4,l=e[5+b]<<4,y=T-i+1>>1,T=T+i+1>>1,i=y,y=r*d+P*p+128>>8,r=r*p-P*d+128>>8,P=y,y=a-l+1>>1,a=a+l+1>>1,l=y,y=g+s+1>>1,s=g-s+1>>1,g=y,y=T-P+1>>1,T=T+P+1>>1,P=y,y=i-r+1>>1,i=i+r+1>>1,r=y,y=a*u+g*h+2048>>12,a=a*h-g*u+2048>>12,g=y,y=s*c+l*w+2048>>12,s=s*w-l*c+2048>>12,l=y,e[0+b]=T+g,e[7+b]=T-g,e[1+b]=i+l,e[6+b]=i-l,e[2+b]=r+s,e[5+b]=r-s,e[3+b]=P+a,e[4+b]=P-a):(y=f*e[0+b]+512>>10,e[0+b]=y,e[1+b]=y,e[2+b]=y,e[3+b]=y,e[4+b]=y,e[5+b]=y,e[6+b]=y,e[7+b]=y)}for(v=0;8>v;++v){var x=v;0!==e[8+x]||0!==e[16+x]||0!==e[24+x]||0!==e[32+x]||0!==e[40+x]||0!==e[48+x]||0!==e[56+x]?(T=f*e[0+x]+2048>>12,i=f*e[32+x]+2048>>12,r=e[16+x],P=e[48+x],a=m*(e[8+x]-e[56+x])+2048>>12,g=m*(e[8+x]+e[56+x])+2048>>12,s=e[24+x],l=e[40+x],y=T-i+1>>1,T=T+i+1>>1,i=y,y=r*d+P*p+2048>>12,r=r*p-P*d+2048>>12,P=y,y=a-l+1>>1,a=a+l+1>>1,l=y,y=g+s+1>>1,s=g-s+1>>1,g=y,y=T-P+1>>1,T=T+P+1>>1,P=y,y=i-r+1>>1,i=i+r+1>>1,r=y,y=a*u+g*h+2048>>12,a=a*h-g*u+2048>>12,g=y,y=s*c+l*w+2048>>12,s=s*w-l*c+2048>>12,l=y,e[0+x]=T+g,e[56+x]=T-g,e[8+x]=i+l,e[48+x]=i-l,e[16+x]=r+s,e[40+x]=r-s,e[24+x]=P+a,e[32+x]=P-a):(y=f*e[v+0]+8192>>14,e[0+x]=y,e[8+x]=y,e[16+x]=y,e[24+x]=y,e[32+x]=y,e[40+x]=y,e[48+x]=y,e[56+x]=y)}for(v=0;64>v;++v){var S=t+v,E=e[v];E=E<=-2056/_.bitConversion?0:E>=2024/_.bitConversion?255/_.bitConversion:E+2056/_.bitConversion>>4,_.blockData[S]=E}}function r(o,i){for(var e=i.blocksPerLine,n=i.blocksPerColumn,r=new Int32Array(64),c=0;c<n;c++)for(var s=0;s<e;s++)t(i,y(i,c,s),r);return i.blockData}function o(e){return 0>=e?0:255<=e?255:0|e}var b=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),w=4017,c=799,h=3406,u=2276,p=1567,d=3784,f=5793,m=2896;return n.prototype={load:function(l){var s=function(e){this.parse(e),this.onload&&this.onload()}.bind(this);if(-1<l.indexOf("data:")){for(var e=l.indexOf("base64,")+7,t=atob(l.substring(e)),n=new Uint8Array(t.length),r=t.length-1;0<=r;r--)n[r]=t.charCodeAt(r);s(t)}else{var o=new XMLHttpRequest;o.open("GET",l,!0),o.responseType="arraybuffer",o.onload=function(){var e=new Uint8Array(o.response);s(e)}.bind(this),o.send(null)}},parse:function(l){function t(){var t=l[i]<<8|l[i+1];return i+=2,t}var i=0,n=(l.length,null),c=null,u=[],p=[],d=[],h=t(),m,o;if(65496!=h)throw"SOI not found";for(h=t();65497!=h;){var s,_;switch(h){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var f=function(){var a=t(),e=l.subarray(i,i+a-2);return i+=e.length,e}();65504===h&&74===f[0]&&70===f[1]&&73===f[2]&&70===f[3]&&0===f[4]&&(n={version:{major:f[5],minor:f[6]},densityUnits:f[7],xDensity:f[8]<<8|f[9],yDensity:f[10]<<8|f[11],thumbWidth:f[12],thumbHeight:f[13],thumbData:f.subarray(14,14+3*f[12]*f[13])}),65518===h&&65===f[0]&&100===f[1]&&111===f[2]&&98===f[3]&&101===f[4]&&0===f[5]&&(c={version:f[6],flags0:f[7]<<8|f[8],flags1:f[9]<<8|f[10],transformCode:f[11]});break;case 65499:for(var y=t()+i-2;i<y;){var v=l[i++],V=new Int32Array(64);if(0==v>>4)for(s=0;64>s;s++)V[b[s]]=l[i++];else{if(1!=v>>4)throw"DQT: invalid table spec";for(s=0;64>s;s++)V[b[s]]=t()}u[15&v]=V}break;case 65472:case 65473:case 65474:if(m)throw"Only single frame JPEGs supported";t(),(m={}).extended=65473===h,m.progressive=65474===h,m.precision=l[i++],m.scanLines=t(),m.samplesPerLine=t(),m.components=[],m.componentIds={};var w=l[i++],S=0,E=0,M;for(j=0;j<w;j++){M=l[i];var x=l[i+1]>>4,W=15&l[i+1];S<x&&(S=x),E<W&&(E=W);var q=l[i+2];_=m.components.push({h:x,v:W,quantizationTable:u[q],quantizationTableId:q,bitConversion:255/((1<<m.precision)-1)}),m.componentIds[M]=_-1,i+=3}m.maxH=S,m.maxV=E,function(l){for(var t=T(l.samplesPerLine/8/l.maxH),e=T(l.scanLines/8/l.maxV),n=0;n<l.components.length;n++){F=l.components[n];var i=T(T(l.samplesPerLine/8)*F.h/l.maxH),r=T(T(l.scanLines/8)*F.v/l.maxV),o=t*F.h,a=64*(e*F.v)*(o+1);F.blockData=new Int16Array(a),F.blocksPerLine=i,F.blocksPerColumn=r}l.mcusPerLine=t,l.mcusPerColumn=e}(m);break;case 65476:var X=t();for(j=2;j<X;){var I=l[i++],C=new Uint8Array(16),L=0;for(s=0;16>s;s++,i++)L+=C[s]=l[i];var R=new Uint8Array(L);for(s=0;s<L;s++,i++)R[s]=l[i];j+=17+L,(0==I>>4?d:p)[15&I]=g(C,R)}break;case 65501:t(),o=t();break;case 65498:t();var k=l[i++],O=[],F;for(j=0;j<k;j++){var D=m.componentIds[l[i++]];F=m.components[D];var U=l[i++];F.huffmanTableDC=d[U>>4],F.huffmanTableAC=p[15&U],O.push(F)}var N=l[i++],B=l[i++],z=l[i++],G=e(l,i,m,O,o,N,B,z>>4,15&z);i+=G;break;default:if(255==l[i-3]&&192<=l[i-2]&&254>=l[i-2]){i-=3;break}throw"unknown JPEG marker "+h.toString(16);}h=t()}switch(this.width=m.samplesPerLine,this.height=m.scanLines,this.jfif=n,this.adobe=c,this.components=[],m.components.length){case 1:this.colorspace=a.Grayscale;break;case 3:this.colorspace=this.adobe?a.AdobeRGB:a.RGB;break;case 4:this.colorspace=a.CYMK;break;default:this.colorspace=a.Unknown;}for(var j=0;j<m.components.length;j++)(F=m.components[j]).quantizationTable||null===F.quantizationTableId||(F.quantizationTable=u[F.quantizationTableId]),this.components.push({output:r(0,F),scaleX:F.h/m.maxH,scaleY:F.v/m.maxV,blocksPerLine:F.blocksPerLine,blocksPerColumn:F.blocksPerColumn,bitConversion:F.bitConversion})},getData16:function(i,t){if(1!==this.components.length)throw"Unsupported color mode";var e=this.width/i,c=this.height/t,d=0,u=this.components.length,p=new Uint16Array(i*t*u),h=new Uint16Array(8*((this.components[0].blocksPerLine<<3)*this.components[0].blocksPerColumn)),m,n,r,o,a,s;for(s=0;s<u;s++){for(var l=(m=this.components[s]).blocksPerLine,f=m.blocksPerColumn,v=l<<3,b=0,w=0,x,_;w<f;w++)for(var g=w<<3,S=0;S<l;S++){var E=y(m,w,S),d=0,M=S<<3;for(x=0;8>x;x++)for(b=(g+x)*v,_=0;8>_;_++)h[b+M+_]=m.output[E+d++]}n=m.scaleX*e,r=m.scaleY*c,d=s;var T;for(a=0;a<t;a++)for(o=0;o<i;o++)T=(0|a*r)*v+(0|o*n),p[d]=h[T],d+=u}return p},getData:function(i,t){var e=this.width/i,s=this.height/t,b=0,v=this.components.length,x=i*t*v,S=new Uint8Array(x),w=new Uint8Array(8*((this.components[0].blocksPerLine<<3)*this.components[0].blocksPerColumn)),E,n,r,M,a,l,c,h,u,p,d,f,m,_,g;for(l=0;l<v;l++){for(var N=(E=this.components[l]).blocksPerLine,P=E.blocksPerColumn,I=N<<3,C=0,L=0,R,T;L<P;L++)for(var A=L<<3,k=0;k<N;k++){var D=y(E,L,k),b=0,B=k<<3;for(R=0;8>R;R++)for(C=(A+R)*I,T=0;8>T;T++)w[C+B+T]=E.output[D+b++]*E.bitConversion}n=E.scaleX*e,r=E.scaleY*s,b=l;var F;for(a=0;a<t;a++)for(M=0;M<i;M++)F=(0|a*r)*I+(0|M*n),S[b]=w[F],b+=v}switch(v){case 1:case 2:break;case 3:if(g=!0,this.adobe&&this.adobe.transformCode?g=!0:void 0!==this.colorTransform&&(g=!!this.colorTransform),g)for(l=0;l<x;l+=v)c=S[l],h=S[l+1],f=o(c-179.456+1.402*(u=S[l+2])),m=o(c+135.459-.344*h-.714*u),_=o(c-226.816+1.772*h),S[l]=f,S[l+1]=m,S[l+2]=_;break;case 4:if(!this.adobe)throw"Unsupported color mode (4 components)";if(g=!1,this.adobe&&this.adobe.transformCode?g=!0:void 0!==this.colorTransform&&(g=!!this.colorTransform),g)for(l=0;l<x;l+=v)c=S[l],h=S[l+1],p=o(434.456-c-1.402*(u=S[l+2])),d=o(119.541-c+.344*h+.714*u),c=o(481.816-c-1.772*h),S[l]=p,S[l+1]=d,S[l+2]=c;break;default:throw"Unsupported color mode";}return S}},n}();"undefined"!==typeof e&&e.exports&&(e.exports=o)},function(e){"use strict";function n(e){PDFJS.verbosity>=PDFJS.VERBOSITY_LEVELS.infos&&console.log("Info: "+e)}function M(e){PDFJS.verbosity>=PDFJS.VERBOSITY_LEVELS.warnings&&console.log("Warning: "+e)}function P(a){if(1<arguments.length){var t=["Error:"];t.push.apply(t,arguments),console.log.apply(console,t),a=[].join.call(arguments," ")}else console.log("Error: "+a);throw console.log(o()),_.notify(m.unknown),new Error(a)}function o(){try{throw new Error}catch(e){return e.stack?e.stack.split("\n").slice(2).join("\n"):""}}function a(a,t,e){return Object.defineProperty(a,t,{value:e,enumerable:!0,configurable:!0,writable:!1}),e}function L(a){for(var t=1,e=0;a>t;)t<<=1,e++;return e}function r(a,t){return a[t]<<8|a[t+1]}function i(a,t){return(a[t]<<24|a[t+1]<<16|a[t+2]<<8|a[t+3])>>>0}function l(){var e=new Uint8Array(2);return e[0]=1,1===new Uint16Array(e.buffer)[0]}function s(){var e=document.createElement("canvas");return e.width=e.height=1,void 0!==e.getContext("2d").createImageData(1,1).data.buffer}function c(){var a={};return a.promise=new Promise(function(t,e){a.resolve=t,a.reject=e}),a}var d=function(){function l(){this.failOnCorruptedImage=!1}function c(a,t){a.x0=T(t.XOsiz/a.XRsiz),a.x1=T(t.Xsiz/a.XRsiz),a.y0=T(t.YOsiz/a.YRsiz),a.y1=T(t.Ysiz/a.YRsiz),a.width=a.x1-a.x0,a.height=a.y1-a.y0}function e(m,t){for(var e=m.SIZ,i=[],r=T((e.Xsiz-e.XTOsiz)/e.XTsiz),o=T((e.Ysiz-e.YTOsiz)/e.YTsiz),a=0,s;a<o;a++)for(var _=0;_<r;_++)(s={}).tx0=C(e.XTOsiz+_*e.XTsiz,e.XOsiz),s.ty0=C(e.YTOsiz+a*e.YTsiz,e.YOsiz),s.tx1=U(e.XTOsiz+(_+1)*e.XTsiz,e.Xsiz),s.ty1=U(e.YTOsiz+(a+1)*e.YTsiz,e.Ysiz),s.width=s.tx1-s.tx0,s.height=s.ty1-s.ty0,s.components=[],i.push(s);m.tiles=i;for(var l=0,c=e.Csiz;l<c;l++)for(var h=t[l],u=0,p=i.length,d;u<p;u++)d={},s=i[u],d.tcx0=T(s.tx0/h.XRsiz),d.tcy0=T(s.ty0/h.YRsiz),d.tcx1=T(s.tx1/h.XRsiz),d.tcy1=T(s.ty1/h.YRsiz),d.width=d.tcx1-d.tcx0,d.height=d.tcy1-d.tcy0,s.components[l]=d}function D(a,t,e){var o=t.codingStyleParameters,n={};return o.entropyCoderWithCustomPrecincts?(n.PPx=o.precinctsSizes[e].PPx,n.PPy=o.precinctsSizes[e].PPy):(n.PPx=15,n.PPy=15),n.xcb_=0<e?U(o.xcb,n.PPx-1):U(o.xcb,n.PPx),n.ycb_=0<e?U(o.ycb,n.PPy-1):U(o.ycb,n.PPy),n}function o(d,t,e){var n=1<<e.PPx,p=1<<e.PPy,u=0===t.resLevel,o=1<<e.PPx+(u?0:-1),m=1<<e.PPy+(u?0:-1),_=t.trx1>t.trx0?T(t.trx1/n)-z(t.trx0/n):0,h=t.try1>t.try0?T(t.try1/p)-z(t.try0/p):0;t.precinctParameters={precinctWidth:n,precinctHeight:p,numprecinctswide:_,numprecinctshigh:h,numprecincts:_*h,precinctWidthInSubband:o,precinctHeightInSubband:m}}function a(b,t,e){var n=e.xcb_,x=e.ycb_,v=1<<n,c=1<<x,h=t.tbx0>>n,u=t.tby0>>x,p=t.tbx1+v-1>>n,d=t.tby1+c-1>>x,f=t.resolution.precinctParameters,m=[],_=[],g,S,w,o;for(S=u;S<d;S++)for(g=h;g<p;g++)if((w={cbx:g,cby:S,tbx0:v*g,tby0:c*S,tbx1:v*(g+1),tby1:c*(S+1)}).tbx0_=C(t.tbx0,w.tbx0),w.tby0_=C(t.tby0,w.tby0),w.tbx1_=U(t.tbx1,w.tbx1),w.tby1_=U(t.tby1,w.tby1),o=z((w.tbx0_-t.tbx0)/f.precinctWidthInSubband)+z((w.tby0_-t.tby0)/f.precinctHeightInSubband)*f.numprecinctswide,w.precinctNumber=o,w.subbandType=t.type,w.Lblock=3,!(w.tbx1_<=w.tbx0_||w.tby1_<=w.tby0_)){m.push(w);var a=_[o];void 0===a?_[o]=a={cbxMin:g,cbyMin:S,cbxMax:g,cbyMax:S}:(g<a.cbxMin?a.cbxMin=g:g>a.cbxMax&&(a.cbxMax=g),S<a.cbyMin?a.cbxMin=S:S>a.cbyMax&&(a.cbyMax=S)),w.precinct=a}t.codeblockParameters={codeblockWidth:n,codeblockHeight:x,numcodeblockwide:p-h+1,numcodeblockhigh:d-u+1},t.codeblocks=m,t.precincts=_}function h(d,t,e){for(var p=[],u=d.subbands,r=0,o=u.length;r<o;r++)for(var a=u[r].codeblocks,s=0,l=a.length,c;s<l;s++)c=a[s],c.precinctNumber===t&&p.push(c);return{layerNumber:e,codeblocks:p}}function s(d){for(var t=d.SIZ,e=d.currentTile.index,u=d.tiles[e],i=u.codingStyleDefaultParameters.layersCount,r=t.Csiz,o=0,a=0;a<r;a++)o=C(o,u.components[a].codingStyleParameters.decompositionLevelsCount);var m=0,l=0,c=0,_=0;this.nextPacket=function(){for(;m<i;m++){for(;l<=o;l++){for(;c<r;c++){var a=u.components[c];if(!(l>a.codingStyleParameters.decompositionLevelsCount)){for(var t=a.resolutions[l],e=t.precinctParameters.numprecincts,n;_<e;)return n=h(t,_,m),_++,n;_=0}}c=0}l=0}}}function p(d){for(var t=d.SIZ,e=d.currentTile.index,u=d.tiles[e],i=u.codingStyleDefaultParameters.layersCount,r=t.Csiz,o=0,a=0;a<r;a++)o=C(o,u.components[a].codingStyleParameters.decompositionLevelsCount);var m=0,l=0,c=0,_=0;this.nextPacket=function(){for(;m<=o;m++){for(;l<i;l++){for(;c<r;c++){var a=u.components[c];if(!(m>a.codingStyleParameters.decompositionLevelsCount)){for(var t=a.resolutions[m],e=t.precinctParameters.numprecincts,n;_<e;)return n=h(t,_,l),_++,n;_=0}}c=0}l=0}}}function d(u){var t=u.SIZ,o=u.currentTile.index,_=u.tiles[o],a=_.codingStyleDefaultParameters.layersCount,l=t.Csiz,s=0,c,e,n,i;for(n=0;n<l;n++){var r=_.components[n];s=C(s,r.codingStyleParameters.decompositionLevelsCount)}var g=new Int32Array(s+1);for(e=0;e<=s;++e){var d=0;for(n=0;n<l;++n){var p=_.components[n].resolutions;e<p.length&&(d=C(d,p[e].precinctParameters.numprecincts))}g[e]=d}c=0,e=0,n=0,i=0,this.nextPacket=function(){for(;e<=s;e++){for(;i<g[e];i++){for(;n<l;n++){var r=_.components[n];if(!(e>r.codingStyleParameters.decompositionLevelsCount)){var t=r.resolutions[e],o=t.precinctParameters.numprecincts;if(!(i>=o)){for(;c<a;){var d=h(t,i,c);return c++,d}c=0}}}n=0}i=0}}}function m(u){var t=u.SIZ,e=u.currentTile.index,y=u.tiles[e],i=y.codingStyleDefaultParameters.layersCount,r=t.Csiz,o=f(y),a=o,s=0,l=0,c=0,b=0,p=0;this.nextPacket=function(){for(;p<a.maxNumHigh;p++){for(;b<a.maxNumWide;b++){for(;c<r;c++){for(var d=y.components[c],t=d.codingStyleParameters.decompositionLevelsCount;l<=t;l++){var e=d.resolutions[l],n=o.components[c].resolutions[l],u=g(b,p,n,a,e);if(null!==u){for(;s<i;){var m=h(e,u,s);return s++,m}s=0}}l=0}c=0}b=0}}}function _(d){var t=d.SIZ,e=d.currentTile.index,u=d.tiles[e],n=u.codingStyleDefaultParameters.layersCount,r=t.Csiz,o=f(u),a=0,i=0,l=0,s=0,c=0;this.nextPacket=function(){for(;l<r;++l){for(var p=u.components[l],t=o.components[l],e=p.codingStyleParameters.decompositionLevelsCount;c<t.maxNumHigh;c++){for(;s<t.maxNumWide;s++){for(;i<=e;i++){var y=p.resolutions[i],d=t.resolutions[i],f=g(s,c,d,t,y);if(null!==f){for(;a<n;){var m=h(y,f,a);return a++,m}a=0}}i=0}s=0}c=0}}}function g(l,t,e,n,i){var r=l*n.minWidth,o=t*n.minHeight;if(0!=r%e.width||0!=o%e.height)return null;var a=o/e.width*i.precinctParameters.numprecinctswide;return r/e.height+a}function f(x){for(var t=x.components.length,e=b,S=b,w=0,E=0,T=Array(t),M=0;M<t;M++){for(var s=x.components[M],l=s.codingStyleParameters.decompositionLevelsCount,c=Array(l+1),P=b,L=b,A=0,I=0,R=1,m=l;0<=m;--m){var _=s.resolutions[m],g=R*_.precinctParameters.precinctWidth,D=R*_.precinctParameters.precinctHeight;P=U(P,g),L=U(L,D),A=C(A,_.precinctParameters.numprecinctswide),I=C(I,_.precinctParameters.numprecinctshigh),c[m]={width:g,height:D},R<<=1}e=U(e,P),S=U(S,L),w=C(w,A),E=C(E,I),T[M]={resolutions:c,minWidth:P,minHeight:L,maxNumWide:A,maxNumHigh:I}}return{components:T,minWidth:e,minHeight:S,maxNumWide:w,maxNumHigh:E}}function N(g){for(var t=g.SIZ,e=g.currentTile.index,n=g.tiles[e],i=t.Csiz,r=0;r<i;r++){for(var l=n.components[r],c=l.codingStyleParameters.decompositionLevelsCount,h=[],u=[],f=0;f<=c;f++){var y=D(g,l,f),v={},P=1<<c-f;v.trx0=T(l.tcx0/P),v.try0=T(l.tcy0/P),v.trx1=T(l.tcx1/P),v.try1=T(l.tcy1/P),v.resLevel=f,o(g,v,y),h.push(v);var w;if(0===f)(w={}).type="LL",w.tbx0=T(l.tcx0/P),w.tby0=T(l.tcy0/P),w.tbx1=T(l.tcx1/P),w.tby1=T(l.tcy1/P),w.resolution=v,a(g,w,y),u.push(w),v.subbands=[w];else{var x=1<<c-f+1,S=[];(w={}).type="HL",w.tbx0=T(l.tcx0/x-.5),w.tby0=T(l.tcy0/x),w.tbx1=T(l.tcx1/x-.5),w.tby1=T(l.tcy1/x),w.resolution=v,a(g,w,y),u.push(w),S.push(w),(w={}).type="LH",w.tbx0=T(l.tcx0/x),w.tby0=T(l.tcy0/x-.5),w.tbx1=T(l.tcx1/x),w.tby1=T(l.tcy1/x-.5),w.resolution=v,a(g,w,y),u.push(w),S.push(w),(w={}).type="HH",w.tbx0=T(l.tcx0/x-.5),w.tby0=T(l.tcy0/x-.5),w.tbx1=T(l.tcx1/x-.5),w.tby1=T(l.tcy1/x-.5),w.resolution=v,a(g,w,y),u.push(w),S.push(w),v.subbands=S}}l.resolutions=h,l.subbands=u}var E=n.codingStyleDefaultParameters.progressionOrder;switch(E){case 0:n.packetsIterator=new s(g);break;case 1:n.packetsIterator=new p(g);break;case 2:n.packetsIterator=new d(g);break;case 3:n.packetsIterator=new m(g);break;case 4:n.packetsIterator=new _(g);break;default:throw new Error("JPX Error: Unsupported progression order "+E);}}function B(l,P,B,t){function n(e){for(;h<e;){if(B+s>=P.length)throw new Error("Unexpected EOF");var t=P[B+s];s++,u?(g=g<<7|t,h+=7,u=!1):(g=g<<8|t,h+=8),255===t&&(u=!0)}return h-=e,g>>>h&(1<<e)-1}function r(e){return 255===P[B+s-1]&&P[B+s]===e?(o(1),!0):255===P[B+s]&&P[B+s+1]===e&&(o(2),!0)}function o(e){s+=e}function a(){h=0,u&&(s++,u=!1)}for(var s=0,h=0,u=!1,i=l.currentTile.index,d=l.tiles[i],p=l.COD.sopMarkerUsed,m=l.COD.ephMarkerUsed,_=d.packetsIterator,g;s<t;)try{a(),p&&r(145)&&o(4);var c=_.nextPacket();if(void 0===c)return;if(!n(1))continue;for(var f=c.layerNumber,y=[],b=0,x=c.codeblocks.length,S;b<x;b++){var z=(S=c.codeblocks[b]).precinct,E=S.cbx-z.cbxMin,M=S.cby-z.cbyMin,T=!1,I=!1;if(void 0!==S.included)T=!!n(1);else{var C,G;if(void 0!==(z=S.precinct).inclusionTree)C=z.inclusionTree;else{var R=z.cbxMax-z.cbxMin+1,k=z.cbyMax-z.cbyMin+1;C=new A(R,k),G=new v(R,k),z.inclusionTree=C,z.zeroBitPlanesTree=G}for(C.reset(E,M,f);;){if(s>=P.length)return;if(C.isAboveThreshold())break;if(C.isKnown())C.nextLevel();else if(n(1)){if(C.setKnown(),C.isLeaf()){S.included=!0,T=I=!0;break}C.nextLevel()}else C.incrementValue()}}if(T){if(I){for((G=z.zeroBitPlanesTree).reset(E,M);;){if(s>=P.length)return;if(!n(1))G.incrementValue();else if(!G.nextLevel())break}S.zeroBitPlanes=G.value}for(var D=function(){if(0===n(1))return 1;if(0===n(1))return 2;var e=n(2);return 3>e?e+3:31>(e=n(5))?e+6:(e=n(7))+37}();n(1);)S.Lblock++;var H=L(D),F=n((D<1<<H?H-1:H)+S.Lblock);y.push({codeblock:S,codingpasses:D,dataLength:F})}}for(a(),m&&r(146);0<y.length;){var V=y.shift();void 0===(S=V.codeblock).data&&(S.data=[]),S.data.push({data:P,start:B+s,end:B+s+V.dataLength,codingpasses:V.codingpasses}),s+=V.dataLength}}catch(e){return}return s}function t(m,t,e,n,i,r,o,a){for(var s=n.tbx0,l=n.tby0,c=n.tbx1-n.tbx0,h=n.codeblocks,I="H"===n.type.charAt(0)?1:0,p="H"===n.type.charAt(1)?t:0,d=0,f=h.length;d<f;++d){var _=h[d],g=_.tbx1_-_.tbx0_,y=_.tby1_-_.tby0_;if(0!==g&&0!==y&&void 0!==_.data){var v,b;v=new V(g,y,_.subbandType,_.zeroBitPlanes,r),b=2;var w=_.data,M=0,T=0,A,W,S;for(A=0,W=w.length;A<W;A++)M+=(S=w[A]).end-S.start,T+=S.codingpasses;var E=new Int16Array(M),P=0;for(A=0,W=w.length;A<W;A++){var C=(S=w[A]).data.subarray(S.start,S.end);E.set(C,P),P+=C.length}var L=new u(E,0,M);for(v.setDecoder(L),A=0;A<T;A++)0===b?v.runSignificancePropogationPass():1===b?v.runMagnitudeRefinementPass():2===b?(v.runCleanupPass(),a&&v.checkSegmentationSymbol()):void 0,b=(b+1)%3;var R=_.tbx0_-s+(_.tby0_-l)*c,F=v.coefficentsSign,U=v.coefficentsMagnitude,N=v.bitsDecoded,B=o?0:.5,z,k,q;P=0;var O="LL"!==n.type;for(A=0;A<y;A++){var G=2*(0|R/c)*(t-c)+I+p;for(z=0;z<g;z++){if(0!==(k=U[P])){k=(k+B)*i,0!==F[P]&&(k=-k),q=N[P];var j=O?G+(R<<1):R;m[j]=o&&q>=r?k:k*(1<<r-q)}R++,P++}R+=c-g}}}}function y(T,C,e){for(var n=C.components[e],i=n.codingStyleParameters,r=n.quantizationParameters,o=i.decompositionLevelsCount,a=r.SPqcds,s=r.scalarExpounded,l=r.guardBits,c=i.segmentationSymbolUsed,h=T.components[e].precision,u=i.reversibleTransformation,p=u?new k:new I,d=[],f=0,m=0;m<=o;m++){for(var _=n.resolutions[m],g=_.trx1-_.trx0,L=_.try1-_.try0,R=new Float32Array(g*L),D=0,w=_.subbands.length;D<w;D++){var F,E;s?(F=a[f].mu,E=a[f].epsilon,f++):(F=a[0].mu,E=a[0].epsilon+(0<m?1-m:0));var M=_.subbands[D],A=x[M.type];t(R,g,L,M,u?1:S(2,h+A-E)*(1+F/2048),l+E-1,u,c)}d.push({width:g,height:L,items:R})}var P=p.calculate(d,n.tcx0,n.tcy0);return{left:n.tcx0,top:n.tcy0,width:P.width,height:P.height,items:P.items}}function w(z){for(var t=z.SIZ,e=z.components,n=t.Csiz,i=[],r=0,o=z.tiles.length;r<o;r++){var a=z.tiles[r],l=[],c;for(c=0;c<n;c++)l[c]=y(z,a,c);var s=l[0];if(F=e[0].isSigned)h=new Int16Array(s.items.length*n);else var h=new Uint16Array(s.items.length*n);var G={left:s.left,top:s.top,width:s.width,height:s.height,items:h},P=0,I,p,d,f,m,_,g,H,v,b,w,x,V,M,T;if(a.codingStyleDefaultParameters.multipleComponentTransform){var A=4===n,W=l[0].items,L=l[1].items,R=l[2].items,k=A?l[3].items:null;p=.5+(128<<(I=e[0].precision-8)),f=-(m=.5*(d=255*(1<<I)));var D=a.components[0],O=n-3;if(g=W.length,D.codingStyleParameters.reversibleTransformation)for(_=0;_<g;_++,P+=O)H=W[_]+p,v=L[_],w=(x=H-((b=R[_])+v>>2))+b,V=x+v,h[P++]=0>=w?0:w>=d?255:w>>I,h[P++]=0>=x?0:x>=d?255:x>>I,h[P++]=0>=V?0:V>=d?255:V>>I;else for(_=0;_<g;_++,P+=O)H=W[_]+p,v=L[_],w=H+1.402*(b=R[_]),x=H-.34413*v-.71414*b,V=H+1.772*v,h[P++]=0>=w?0:w>=d?255:w>>I,h[P++]=0>=x?0:x>=d?255:x>>I,h[P++]=0>=V?0:V>=d?255:V>>I;if(A)for(_=0,P=3;_<g;_++,P+=4)M=k[_],h[P]=M<=f?0:M>=m?255:M+p>>I}else for(c=0;c<n;c++)if(8===e[c].precision)for(j=l[c].items,p=.5+(128<<(I=e[c].precision-8)),f=-(d=127.5*(1<<I)),P=c,_=0,g=j.length;_<g;_++)T=j[_],h[P]=T<=f?0:T>=d?255:T+p>>I,P+=n;else{var F=e[c].isSigned,j=l[c].items;if(F)for(P=c,_=0,g=j.length;_<g;_++)h[P]=j[_],P+=n;else{p=.5+(128<<(I=e[c].precision-8));var N=S(2,e[c].precision)-1;for(P=c,_=0,g=j.length;_<g;_++)T=j[_],h[P]=C(U(T+p,N),0),P+=n}}i.push(G)}return i}function E(l,t){for(var e=l.SIZ.Csiz,n=l.tiles[t],i=0;i<e;i++){var r=n.components[i],o=void 0===l.currentTile.QCC[i]?l.currentTile.QCD:l.currentTile.QCC[i];r.quantizationParameters=o;var a=void 0===l.currentTile.COC[i]?l.currentTile.COD:l.currentTile.COC[i];r.codingStyleParameters=a}n.codingStyleDefaultParameters=l.currentTile.COD}var x={LL:0,LH:1,HL:1,HH:2};l.prototype={parse:function(c){if(65359!==r(c,0))for(var t=0,e=c.length;t<e;){var m=8,o=i(c,t),a=i(c,t+4);if(t+=m,1===o&&(o=4294967296*i(c,t)+i(c,t+4),t+=8,m+=8),0===o&&(o=e-t+m),o<m)throw new Error("JPX Error: Invalid box field size");var s=o-m,l=!0;switch(a){case 1785737832:l=!1;break;case 1668246642:var u=c[t];if(c[t+1],c[t+2],1===u){var p=i(c,t+3);switch(p){case 16:case 17:case 18:break;default:M("Unknown colorspace "+p);}}else 2===u&&n("ICC profile not supported");break;case 1785737827:this.parseCodestream(c,t,t+s);break;case 1783636e3:218793738!==i(c,t)&&M("Invalid JP2 signature");break;case 1783634458:case 1718909296:case 1920099697:case 1919251232:case 1768449138:break;default:M("Unsupported header type "+a+" ("+F(255&a>>24,255&a>>16,255&a>>8,255&a)+")");}l&&(t+=s)}else this.parseCodestream(c,0,c.length)},parseImageProperties:function(l){for(var t=l.getByte();0<=t;)if(65361===(t<<8|(t=l.getByte()))){l.skip(4);var e=l.getInt32()>>>0,n=l.getInt32()>>>0,i=l.getInt32()>>>0,r=l.getInt32()>>>0;l.skip(16);var o=l.getUint16();return this.width=e-i,this.height=n-r,this.componentsCount=o,void(this.bitsPerComponent=8)}throw new Error("JPX Error: No size marker found in JPX stream")},parseCodestream:function(n,t,h){var o={};try{for(var a=!1,s=t,l;s+1<h;){l=r(n,s),s+=2;var u=0,y,p,d,f,m,_;switch(l){case 65359:o.mainHeader=!0;break;case 65497:break;case 65361:u=r(n,s);var g={};g.Xsiz=i(n,s+4),g.Ysiz=i(n,s+8),g.XOsiz=i(n,s+12),g.YOsiz=i(n,s+16),g.XTsiz=i(n,s+20),g.YTsiz=i(n,s+24),g.XTOsiz=i(n,s+28),g.YTOsiz=i(n,s+32);var b=r(n,s+36);g.Csiz=b;var x=[];y=s+38;for(var v=0,S;v<b;v++)S={precision:1+(127&n[y]),isSigned:!!(128&n[y]),XRsiz:n[y+1],YRsiz:n[y+1]},c(S,g),x.push(S);o.SIZ=g,o.components=x,e(o,x),o.QCC=[],o.COC=[];break;case 65372:u=r(n,s);var T={};switch(y=s+2,31&(p=n[y++])){case 0:f=8,m=!0;break;case 1:f=16,m=!1;break;case 2:f=16,m=!0;break;default:throw new Error("JPX Error: Invalid SQcd value "+p);}for(T.noQuantization=8===f,T.scalarExpounded=m,T.guardBits=p>>5,d=[];y<u+s;){var P={};8===f?(P.epsilon=n[y++]>>3,P.mu=0):(P.epsilon=n[y]>>3,P.mu=(7&n[y])<<8|n[y+1],y+=2),d.push(P)}T.SPqcds=d,o.mainHeader?o.QCD=T:(o.currentTile.QCD=T,o.currentTile.QCC=[]);break;case 65373:u=r(n,s);var A={};y=s+2;var C;switch(257>o.SIZ.Csiz?C=n[y++]:(C=r(n,y),y+=2),31&(p=n[y++])){case 0:f=8,m=!0;break;case 1:f=16,m=!1;break;case 2:f=16,m=!0;break;default:throw new Error("JPX Error: Invalid SQcd value "+p);}for(A.noQuantization=8===f,A.scalarExpounded=m,A.guardBits=p>>5,d=[];y<u+s;)P={},8===f?(P.epsilon=n[y++]>>3,P.mu=0):(P.epsilon=n[y]>>3,P.mu=(7&n[y])<<8|n[y+1],y+=2),d.push(P);A.SPqcds=d,o.mainHeader?o.QCC[C]=A:o.currentTile.QCC[C]=A;break;case 65362:u=r(n,s);var L={};y=s+2;var I=n[y++];L.entropyCoderWithCustomPrecincts=!!(1&I),L.sopMarkerUsed=!!(2&I),L.ephMarkerUsed=!!(4&I),L.progressionOrder=n[y++],L.layersCount=r(n,y),y+=2,L.multipleComponentTransform=n[y++],L.decompositionLevelsCount=n[y++],L.xcb=2+(15&n[y++]),L.ycb=2+(15&n[y++]);var R=n[y++];if(L.selectiveArithmeticCodingBypass=!!(1&R),L.resetContextProbabilities=!!(2&R),L.terminationOnEachCodingPass=!!(4&R),L.verticalyStripe=!!(8&R),L.predictableTermination=!!(16&R),L.segmentationSymbolUsed=!!(32&R),L.reversibleTransformation=n[y++],L.entropyCoderWithCustomPrecincts){for(var D=[],k;y<u+s;)k=n[y++],D.push({PPx:15&k,PPy:k>>4});L.precinctsSizes=D}var F=[];if(L.selectiveArithmeticCodingBypass&&F.push("selectiveArithmeticCodingBypass"),L.resetContextProbabilities&&F.push("resetContextProbabilities"),L.terminationOnEachCodingPass&&F.push("terminationOnEachCodingPass"),L.verticalyStripe&&F.push("verticalyStripe"),L.predictableTermination&&F.push("predictableTermination"),0<F.length)throw a=!0,new Error("JPX Error: Unsupported COD options ("+F.join(", ")+")");o.mainHeader?o.COD=L:(o.currentTile.COD=L,o.currentTile.COC=[]);break;case 65424:u=r(n,s),(_={}).index=r(n,s+2),_.length=i(n,s+4),_.dataEnd=_.length+s-2,_.partIndex=n[s+8],_.partsCount=n[s+9],o.mainHeader=!1,0===_.partIndex&&(_.COD=o.COD,_.COC=o.COC.slice(0),_.QCD=o.QCD,_.QCC=o.QCC.slice(0)),o.currentTile=_;break;case 65427:0===(_=o.currentTile).partIndex&&(E(o,_.index),N(o)),B(o,n,s,u=_.dataEnd-s);break;case 65365:case 65367:case 65368:case 65380:u=r(n,s);break;case 65363:throw new Error("JPX Error: Codestream code 0xFF53 (COC) is not implemented");default:throw new Error("JPX Error: Unknown codestream code: "+l.toString(16));}s+=u}}catch(e){if(a||this.failOnCorruptedImage)throw e;M("Trying to recover from "+e.message)}this.tiles=w(o),this.width=o.SIZ.Xsiz-o.SIZ.XOsiz,this.height=o.SIZ.Ysiz-o.SIZ.YOsiz,this.componentsCount=o.SIZ.Csiz}};var v=function(){function e(a,o){var l=L(C(a,o))+1;this.levels=[];for(var n=0,i;n<l;n++)i={width:a,height:o,items:[]},this.levels.push(i),a=T(a/2),o=T(o/2)}return e.prototype={reset:function(a,t){for(var e=0,i=0,r,n;e<this.levels.length;){if(n=a+t*(r=this.levels[e]).width,void 0!==r.items[n]){i=r.items[n];break}r.index=n,a>>=1,t>>=1,e++}e--,(r=this.levels[e]).items[r.index]=i,this.currentLevel=e,delete this.value},incrementValue:function(){var e=this.levels[this.currentLevel];e.items[e.index]++},nextLevel:function(){var a=this.currentLevel,t=this.levels[a],e=t.items[t.index];return 0>--a?(this.value=e,!1):(this.currentLevel=a,t=this.levels[a],t.items[t.index]=e,!0)}},e}(),A=function(){function e(l,d){var p=L(C(l,d))+1;this.levels=[];for(var n=0;n<p;n++){for(var i=new Uint8Array(l*d),u=new Uint8Array(l*d),m=0,a=i.length;m<a;m++)i[m]=0,u[m]=0;var s={width:l,height:d,items:i,status:u};this.levels.push(s),l=T(l/2),d=T(d/2)}}return e.prototype={reset:function(a,t,e){this.currentStopValue=e;for(var n=0;n<this.levels.length;){var i=this.levels[n],r=a+t*i.width;i.index=r,a>>=1,t>>=1,n++}this.currentLevel=this.levels.length-1,this.minValue=this.levels[this.currentLevel].items[0]},incrementValue:function(){var e=this.levels[this.currentLevel];e.items[e.index]=e.items[e.index]+1,e.items[e.index]>this.minValue&&(this.minValue=e.items[e.index])},nextLevel:function(){var a=this.currentLevel;if(0>--a)return!1;this.currentLevel=a;var t=this.levels[a];return t.items[t.index]<this.minValue?t.items[t.index]=this.minValue:t.items[t.index]>this.minValue&&(this.minValue=t.items[t.index]),!0},isLeaf:function(){return 0===this.currentLevel},isAboveThreshold:function(){var a=this.currentLevel,t=this.levels[a];return t.items[t.index]>this.currentStopValue},isKnown:function(){var a=this.currentLevel,t=this.levels[a];return 0<t.status[t.index]},setKnown:function(){var a=this.currentLevel,t=this.levels[a];t.status[t.index]=1}},e}(),V=function(){function a(i,p,r,o,a){this.width=i,this.height=p,this.contextLabelTable="HH"===r?n:"HL"===r?e:d;var s=i*p;this.neighborsSignificance=new Uint8Array(s),this.coefficentsSign=new Uint8Array(s),this.coefficentsMagnitude=14<a?new Uint32Array(s):6<a?new Uint16Array(s):new Uint8Array(s),this.processingFlags=new Uint8Array(s);var l=new Uint8Array(s);if(0!==o)for(var c=0;c<s;c++)l[c]=o;this.bitsDecoded=l,this.reset()}var d=new Uint8Array([0,5,8,0,3,7,8,0,4,7,8,0,0,0,0,0,1,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8]),e=new Uint8Array([0,3,4,0,5,7,7,0,8,8,8,0,0,0,0,0,1,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8]),n=new Uint8Array([0,1,2,0,1,2,2,0,2,2,2,0,0,0,0,0,3,4,5,0,4,5,5,0,5,5,5,0,0,0,0,0,6,7,7,0,7,7,7,0,7,7,7,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8]);return a.prototype={setDecoder:function(e){this.decoder=e},reset:function(){this.contexts=new Int8Array(19),this.contexts[0]=8,this.contexts[17]=92,this.contexts[18]=6},setNeighborsSignificance:function(c,t,e){var n=this.neighborsSignificance,r=this.width,o=this.height,a=0<t,s=t+1<r,l;0<c&&(l=e-r,a&&(n[l-1]+=16),s&&(n[l+1]+=16),n[l]+=4),c+1<o&&(l=e+r,a&&(n[l-1]+=16),s&&(n[l+1]+=16),n[l]+=4),a&&(n[e-1]+=1),s&&(n[e+1]+=1),n[e]|=128},runSignificancePropogationPass:function(){for(var g=this.decoder,t=this.width,e=this.height,n=this.coefficentsMagnitude,i=this.coefficentsSign,r=this.neighborsSignificance,o=this.processingFlags,a=this.contexts,s=this.contextLabelTable,l=this.bitsDecoded,c=0;c<e;c+=4)for(var h=0;h<t;h++)for(var u=c*t+h,p=0,d;4>p&&(d=c+p,!(d>=e));p++,u+=t)if(o[u]&=-2,!n[u]&&r[u]){var f=s[r[u]];if(g.readBit(a,f)){var m=this.decodeSignBit(d,h,u);i[u]=m,n[u]=1,this.setNeighborsSignificance(d,h,u),o[u]|=2}l[u]++,o[u]|=1}},decodeSignBit:function(m,t,e){var n=this.width,c=this.height,_=this.coefficentsMagnitude,u=this.coefficentsSign,p,i,r,o,a,s;o=0<t&&0!==_[e-1],t+1<n&&0!==_[e+1]?(r=u[e+1],p=o?1-r-(i=u[e-1]):1-r-r):p=o?1-(i=u[e-1])-i:0;var l=3*p;return o=0<m&&0!==_[e-n],m+1<c&&0!==_[e+n]?(r=u[e+n],p=o?1-r-(i=u[e-n])+l:1-r-r+l):p=o?1-(i=u[e-n])-i+l:l,0<=p?(a=9+p,s=this.decoder.readBit(this.contexts,a)):(a=9-p,s=1^this.decoder.readBit(this.contexts,a)),s},runMagnitudeRefinementPass:function(){for(var _=this.decoder,e=this.width,n=this.height,i=this.coefficentsMagnitude,r=this.neighborsSignificance,o=this.contexts,a=this.bitsDecoded,s=this.processingFlags,l=e*n,c=0,u;c<l;c=u){u=U(l,c+4*e);for(var t=0;t<e;t++)for(var p=c+t;p<u;p+=e)if(i[p]&&0==(1&s[p])){var d=16;0!=(2&s[p])&&(s[p]^=2,d=0===(127&r[p])?15:14);var h=_.readBit(o,d);i[p]=i[p]<<1|h,a[p]++,s[p]|=1}}},runCleanupPass:function(){for(var T=this.decoder,e=this.width,n=this.height,i=this.neighborsSignificance,r=this.coefficentsMagnitude,o=this.coefficentsSign,a=this.contexts,s=this.contextLabelTable,l=this.bitsDecoded,c=this.processingFlags,h=e,u=2*e,p=3*e,d=0,f;d<n;d=f){f=U(d+4,n);for(var t=d*e,m=d+3<n,_=0;_<e;_++){var g=t+_,v=0,b=g,w=d,x;if(m&&0===c[g]&&0===c[g+h]&&0===c[g+u]&&0===c[g+p]&&0===i[g]&&0===i[g+h]&&0===i[g+u]&&0===i[g+p]){if(!T.readBit(a,18)){l[g]++,l[g+h]++,l[g+u]++,l[g+p]++;continue}0!==(v=T.readBit(a,17)<<1|T.readBit(a,17))&&(w=d+v,b+=v*e),x=this.decodeSignBit(w,_,b),o[b]=x,r[b]=1,this.setNeighborsSignificance(w,_,b),c[b]|=2,b=g;for(var y=d;y<=w;y++,b+=e)l[b]++;v++}for(w=d+v;w<f;w++,b+=e)if(!r[b]&&0==(1&c[b])){var S=s[i[b]];1===T.readBit(a,S)&&(x=this.decodeSignBit(w,_,b),o[b]=x,r[b]=1,this.setNeighborsSignificance(w,_,b),c[b]|=2),l[b]++}}}},checkSegmentationSymbol:function(){var a=this.decoder,t=this.contexts;if(10!==(a.readBit(t,17)<<3|a.readBit(t,17)<<2|a.readBit(t,17)<<1|a.readBit(t,17)))throw new Error("JPX Error: Invalid segmentation symbol")}},a}(),P=function(){function e(){}return e.prototype.calculate=function(a,t,e){for(var n=a[0],i=1,r=a.length;i<r;i++)n=this.iterate(n,a[i],t,e);return n},e.prototype.extend=function(l,t,e){var n=t-1,i=t+1,r=t+e-2,o=t+e;l[n--]=l[i++],l[o++]=l[r--],l[n--]=l[i++],l[o++]=l[r--],l[n--]=l[i++],l[o++]=l[r--],l[n]=l[i],l[o]=l[r]},e.prototype.iterate=function(x,t,e,n){var i=x.width,h=x.height,u=x.items,p=t.width,S=t.height,E=t.items,T,r,o,a,s,l;for(o=0,T=0;T<h;T++)for(a=2*T*p,r=0;r<i;r++,o++,a+=2)E[a]=u[o];u=x.items=null;var c=new Float32Array(p+8);if(!(1===p))for(l=0,o=0;l<S;l++,o+=p)c.set(E.subarray(o,o+p),4),this.extend(c,4,p),this.filter(c,4,p),E.set(c.subarray(4,4+p),o);else if(0!=(1&e))for(l=0,o=0;l<S;l++,o+=p)E[o]*=.5;var _=16,g=[];for(T=0;T<_;T++)g.push(new Float32Array(S+8));var y=0,b;if(!(x=4+S,1===S))for(s=0;s<p;s++){if(0===y){for(_=U(p-s,_),o=s,a=4;a<x;o+=p,a++)for(b=0;b<_;b++)g[b][a]=E[o+b];y=_}var v=g[--y];if(this.extend(v,4,S),this.filter(v,4,S),0===y)for(o=s-_+1,a=4;a<x;o+=p,a++)for(b=0;b<_;b++)E[o+b]=g[b][a]}else if(0!=(1&n))for(s=0;s<p;s++)E[s]*=.5;return{width:p,height:S,items:E}},e}(),I=function(){function e(){P.call(this)}return e.prototype=Object.create(P.prototype),e.prototype.filter=function(d,t,e){var n=e>>1,s=-1.586134342059924,l=-.052980118572961,c=.882911075530934,m=.443506852043971,u=1.230174104914001,p,i,r,o;for(p=(t|=0)-3,i=n+4;i--;p+=2)d[p]*=.8128930661159609;for(r=m*d[(p=t-2)-1],i=n+3;i--&&(o=m*d[p+1],d[p]=u*d[p]-r-o,i--);p+=2)r=m*d[(p+=2)+1],d[p]=u*d[p]-r-o;for(r=c*d[(p=t-1)-1],i=n+2;i--&&(o=c*d[p+1],d[p]-=r+o,i--);p+=2)r=c*d[(p+=2)+1],d[p]-=r+o;for(r=l*d[(p=t)-1],i=n+1;i--&&(o=l*d[p+1],d[p]-=r+o,i--);p+=2)r=l*d[(p+=2)+1],d[p]-=r+o;if(0!==n)for(r=s*d[(p=t+1)-1],i=n;i--&&(o=s*d[p+1],d[p]-=r+o,i--);p+=2)r=s*d[(p+=2)+1],d[p]-=r+o},e}(),k=function(){function e(){P.call(this)}return e.prototype=Object.create(P.prototype),e.prototype.filter=function(a,t,e){var n=e>>1,o,i;for(o=t|=0,i=n+1;i--;o+=2)a[o]-=a[o-1]+a[o+1]+2>>2;for(o=t+1,i=n;i--;o+=2)a[o]+=a[o-1]+a[o+1]>>1},e}();return l}(),u=function(){function a(a,o,e){this.data=a,this.bp=o,this.dataEnd=e,this.chigh=a[o],this.clow=0,this.byteIn(),this.chigh=65535&this.chigh<<7|127&this.clow>>9,this.clow=65535&this.clow<<7,this.ct-=7,this.a=32768}var c=[{qe:22017,nmps:1,nlps:1,switchFlag:1},{qe:13313,nmps:2,nlps:6,switchFlag:0},{qe:6145,nmps:3,nlps:9,switchFlag:0},{qe:2753,nmps:4,nlps:12,switchFlag:0},{qe:1313,nmps:5,nlps:29,switchFlag:0},{qe:545,nmps:38,nlps:33,switchFlag:0},{qe:22017,nmps:7,nlps:6,switchFlag:1},{qe:21505,nmps:8,nlps:14,switchFlag:0},{qe:18433,nmps:9,nlps:14,switchFlag:0},{qe:14337,nmps:10,nlps:14,switchFlag:0},{qe:12289,nmps:11,nlps:17,switchFlag:0},{qe:9217,nmps:12,nlps:18,switchFlag:0},{qe:7169,nmps:13,nlps:20,switchFlag:0},{qe:5633,nmps:29,nlps:21,switchFlag:0},{qe:22017,nmps:15,nlps:14,switchFlag:1},{qe:21505,nmps:16,nlps:14,switchFlag:0},{qe:20737,nmps:17,nlps:15,switchFlag:0},{qe:18433,nmps:18,nlps:16,switchFlag:0},{qe:14337,nmps:19,nlps:17,switchFlag:0},{qe:13313,nmps:20,nlps:18,switchFlag:0},{qe:12289,nmps:21,nlps:19,switchFlag:0},{qe:10241,nmps:22,nlps:19,switchFlag:0},{qe:9217,nmps:23,nlps:20,switchFlag:0},{qe:8705,nmps:24,nlps:21,switchFlag:0},{qe:7169,nmps:25,nlps:22,switchFlag:0},{qe:6145,nmps:26,nlps:23,switchFlag:0},{qe:5633,nmps:27,nlps:24,switchFlag:0},{qe:5121,nmps:28,nlps:25,switchFlag:0},{qe:4609,nmps:29,nlps:26,switchFlag:0},{qe:4353,nmps:30,nlps:27,switchFlag:0},{qe:2753,nmps:31,nlps:28,switchFlag:0},{qe:2497,nmps:32,nlps:29,switchFlag:0},{qe:2209,nmps:33,nlps:30,switchFlag:0},{qe:1313,nmps:34,nlps:31,switchFlag:0},{qe:1089,nmps:35,nlps:32,switchFlag:0},{qe:673,nmps:36,nlps:33,switchFlag:0},{qe:545,nmps:37,nlps:34,switchFlag:0},{qe:321,nmps:38,nlps:35,switchFlag:0},{qe:273,nmps:39,nlps:36,switchFlag:0},{qe:133,nmps:40,nlps:37,switchFlag:0},{qe:73,nmps:41,nlps:38,switchFlag:0},{qe:37,nmps:42,nlps:39,switchFlag:0},{qe:21,nmps:43,nlps:40,switchFlag:0},{qe:9,nmps:44,nlps:41,switchFlag:0},{qe:5,nmps:45,nlps:42,switchFlag:0},{qe:1,nmps:45,nlps:43,switchFlag:0},{qe:22017,nmps:46,nlps:46,switchFlag:0}];return a.prototype={byteIn:function(){var a=this.data,t=this.bp;255===a[t]?143<a[t+1]?(this.clow+=65280,this.ct=8):(t++,this.clow+=a[t]<<9,this.ct=7,this.bp=t):(t++,this.clow+=t<this.dataEnd?a[t]<<8:65280,this.ct=8,this.bp=t),65535<this.clow&&(this.chigh+=this.clow>>16,this.clow&=65535)},readBit:function(e,t){var n=e[t]>>1,r=1&e[t],o=c[n],a=o.qe,s=this.a-a,l;if(this.chigh<a)s<a?(s=a,l=r,n=o.nmps):(s=a,l=1^r,1===o.switchFlag&&(r=l),n=o.nlps);else{if(this.chigh-=a,0!=(32768&s))return this.a=s,r;s<a?(l=1^r,1===o.switchFlag&&(r=l),n=o.nlps):(l=r,n=o.nmps)}do 0===this.ct&&this.byteIn(),s<<=1,this.chigh=65535&this.chigh<<1|1&this.clow>>15,this.clow=65535&this.clow<<1,this.ct--;while(0==(32768&s));return this.a=s,e[t]=n<<1|r,l}},a}(),p="undefined"==typeof window?this:window;p.PDFJS||(p.PDFJS={}),p.PDFJS.pdfBug=!1,PDFJS.VERBOSITY_LEVELS={errors:0,warnings:1,infos:5},PDFJS.OPS={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotations:78,endAnnotations:79,beginAnnotation:80,endAnnotation:81,paintJpegXObject:82,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};var m=PDFJS.UNSUPPORTED_FEATURES={unknown:"unknown",forms:"forms",javaScript:"javaScript",smask:"smask",shadingPattern:"shadingPattern",font:"font"},_=PDFJS.UnsupportedManager=function(){var a=[];return{listen:function(t){a.push(t)},notify:function(t){M("Unsupported feature \""+t+"\"");for(var e=0,o=a.length;e<o;e++)a[e](t)}}}();PDFJS.isValidUrl=function(a,o){if(!a)return!1;var e=/^[a-z][a-z0-9+\-.]*(?=:)/i.exec(a);if(!e)return o;switch(e=e[0].toLowerCase()){case"http":case"https":case"ftp":case"mailto":case"tel":return!0;default:return!1;}},PDFJS.shadow=a,PDFJS.PasswordResponses={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};var h=function(){function e(a,o){this.name="PasswordException",this.message=a,this.code=o}return e.prototype=new Error,e.constructor=e,e}();PDFJS.PasswordException=h;var g=function(){function e(a,o){this.name="UnknownErrorException",this.message=a,this.details=o}return e.prototype=new Error,e.constructor=e,e}();PDFJS.UnknownErrorException=g;var f=function(){function e(e){this.name="InvalidPDFException",this.message=e}return e.prototype=new Error,e.constructor=e,e}();PDFJS.InvalidPDFException=f;var y=function(){function e(e){this.name="MissingPDFException",this.message=e}return e.prototype=new Error,e.constructor=e,e}();PDFJS.MissingPDFException=y;var x=function(){function e(a,o){this.name="UnexpectedResponseException",this.message=a,this.status=o}return e.prototype=new Error,e.constructor=e,e}();PDFJS.UnexpectedResponseException=x,function(){function e(e){this.message=e}e.prototype=new Error,e.prototype.name="NotImplementedException",e.constructor=e}(),function(){function e(a,o){this.begin=a,this.end=o,this.message="Missing data ["+a+", "+o+")"}e.prototype=new Error,e.prototype.name="MissingDataException",e.constructor=e}(),function(){function e(e){this.message=e}e.prototype=new Error,e.prototype.name="XRefParseException",e.constructor=e}(),Object.defineProperty(PDFJS,"isLittleEndian",{configurable:!0,get:function(){return a(PDFJS,"isLittleEndian",l())}}),Object.defineProperty(PDFJS,"hasCanvasTypedArrays",{configurable:!0,get:function(){return a(PDFJS,"hasCanvasTypedArrays",s())}}),!function(){function a(a,r){this.buffer=a,this.byteLength=a.length,this.length=void 0===r?this.byteLength>>2:r,o(this.length)}function t(a){return{get:function(){var t=this.buffer,e=a<<2;return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0},set:function(t){var e=this.buffer,o=a<<2;e[o]=255&t,e[o+1]=255&t>>8,e[o+2]=255&t>>16,e[o+3]=255&t>>>24}}}function o(o){for(;e<o;)Object.defineProperty(a.prototype,e,t(e)),e++}a.prototype=Object.create(null);var e=0}();var v=PDFJS.Util=function(){function l(){}var a=["rgb(",0,",",0,",",0,")"];return l.makeCssRgb=function(e,t,o){return a[1]=e,a[3]=t,a[5]=o,a.join("")},l.transform=function(a,t){return[a[0]*t[0]+a[2]*t[1],a[1]*t[0]+a[3]*t[1],a[0]*t[2]+a[2]*t[3],a[1]*t[2]+a[3]*t[3],a[0]*t[4]+a[2]*t[5]+a[4],a[1]*t[4]+a[3]*t[5]+a[5]]},l.applyTransform=function(a,t){return[a[0]*t[0]+a[1]*t[2]+t[4],a[0]*t[1]+a[1]*t[3]+t[5]]},l.applyInverseTransform=function(a,t){var e=t[0]*t[3]-t[1]*t[2];return[(a[0]*t[3]-a[1]*t[2]+t[2]*t[5]-t[4]*t[3])/e,(-a[0]*t[1]+a[1]*t[0]+t[4]*t[1]-t[5]*t[0])/e]},l.getAxialAlignedBoundingBox=function(t,e){var n=l.applyTransform(t,e),i=l.applyTransform(t.slice(2,4),e),r=l.applyTransform([t[0],t[3]],e),o=l.applyTransform([t[2],t[1]],e);return[U(n[0],i[0],r[0],o[0]),U(n[1],i[1],r[1],o[1]),C(n[0],i[0],r[0],o[0]),C(n[1],i[1],r[1],o[1])]},l.inverseTransform=function(a){var t=a[0]*a[3]-a[1]*a[2];return[a[3]/t,-a[1]/t,-a[2]/t,a[0]/t,(a[2]*a[5]-a[4]*a[3])/t,(a[4]*a[1]-a[5]*a[0])/t]},l.apply3dTransform=function(a,t){return[a[0]*t[0]+a[1]*t[1]+a[2]*t[2],a[3]*t[0]+a[4]*t[1]+a[5]*t[2],a[6]*t[0]+a[7]*t[1]+a[8]*t[2]]},l.singularValueDecompose2dScale=function(l){var t=[l[0],l[2],l[1],l[3]],e=l[0]*t[0]+l[1]*t[2],n=l[0]*t[1]+l[1]*t[3],i=l[2]*t[0]+l[3]*t[2],r=l[2]*t[1]+l[3]*t[3],o=(e+r)/2,a=N((e+r)*(e+r)-4*(e*r-i*n))/2;return[N(o+a||1),N(o-a||1)]},l.normalizeRect=function(a){var t=a.slice(0);return a[0]>a[2]&&(t[0]=a[2],t[2]=a[0]),a[1]>a[3]&&(t[1]=a[3],t[3]=a[1]),t},l.intersect=function(t,e){function n(a,t){return a-t}var i=[t[0],t[2],e[0],e[2]].sort(n),r=[t[1],t[3],e[1],e[3]].sort(n),o=[];return t=l.normalizeRect(t),e=l.normalizeRect(e),(i[0]===t[0]&&i[1]===e[0]||i[0]===e[0]&&i[1]===t[0])&&(o[0]=i[1],o[2]=i[2],(r[0]===t[1]&&r[1]===e[1]||r[0]===e[1]&&r[1]===t[1])&&(o[1]=r[1],o[3]=r[2],o))},l.sign=function(e){return 0>e?-1:1},l.appendToArray=function(a,t){Array.prototype.push.apply(a,t)},l.prependToArray=function(a,t){Array.prototype.unshift.apply(a,t)},l.extendObj=function(a,t){for(var e in t)a[e]=t[e]},l.getInheritableProperty=function(a,t){for(;a&&!a.has(t);)a=a.get("Parent");return a?a.get(t):null},l.inherit=function(a,t,e){for(var o in a.prototype=Object.create(t.prototype),a.prototype.constructor=a,e)a.prototype[o]=e[o]},l.loadScript=function(a,t){var e=document.createElement("script"),o=!1;e.setAttribute("src",a),t&&(e.onload=function(){o||t(),o=!0}),document.getElementsByTagName("head")[0].appendChild(e)},l}();PDFJS.PageViewport=function(){function a(_,g,e,n,i,r){this.viewBox=_,this.scale=g,this.rotation=e,this.offsetX=n,this.offsetY=i;var o=(_[2]+_[0])/2,h=(_[3]+_[1])/2,u,a,s,y;switch(e%=360,e=0>e?e+360:e){case 180:u=-1,a=0,s=0,y=1;break;case 90:u=0,a=1,s=1,y=0;break;case 270:u=0,a=-1,s=-1,y=0;break;default:u=1,a=0,s=0,y=-1;}r&&(s=-s,y=-y);var b,p,d,f;0===u?(b=B(h-_[1])*g+n,p=B(o-_[0])*g+i,d=B(_[3]-_[1])*g,f=B(_[2]-_[0])*g):(b=B(o-_[0])*g+n,p=B(h-_[1])*g+i,d=B(_[2]-_[0])*g,f=B(_[3]-_[1])*g),this.transform=[u*g,a*g,s*g,y*g,b-u*g*o-s*g*h,p-a*g*o-y*g*h],this.width=d,this.height=f,this.fontScale=g}return a.prototype={clone:function(t){var e="scale"in(t=t||{})?t.scale:this.scale,o="rotation"in t?t.rotation:this.rotation;return new a(this.viewBox.slice(),e,o,this.offsetX,this.offsetY,t.dontFlip)},convertToViewportPoint:function(a,t){return v.applyTransform([a,t],this.transform)},convertToViewportRectangle:function(a){var t=v.applyTransform([a[0],a[1]],this.transform),e=v.applyTransform([a[2],a[3]],this.transform);return[t[0],t[1],e[0],e[1]]},convertToPdfPoint:function(a,t){return v.applyInverseTransform([a,t],this.transform)}},a}(),PDFJS.createPromiseCapability=c,function(){function d(e){this._status=a,this._handlers=[];try{e.call(this,this._resolve.bind(this),this._reject.bind(this))}catch(e){this._reject(e)}}if(p.Promise)return"function"!=typeof p.Promise.all&&(p.Promise.all=function(a){var l=0,i=[],t=new p.Promise(function(a,t){r=a,e=t}),r,e;return a.forEach(function(a,n){l++,a.then(function(e){i[n]=e,0===--l&&r(i)},e)}),0===l&&r(i),t}),"function"!=typeof p.Promise.resolve&&(p.Promise.resolve=function(a){return new p.Promise(function(t){t(a)})}),"function"!=typeof p.Promise.reject&&(p.Promise.reject=function(a){return new p.Promise(function(t,e){e(a)})}),void("function"!=typeof p.Promise.prototype.catch&&(p.Promise.prototype.catch=function(e){return p.Promise.prototype.then(void 0,e)}));var a=0,l=2,t={handlers:[],running:!1,unhandledRejections:[],pendingRejectionCheck:!1,scheduleHandlers:function(e){e._status!==a&&(this.handlers=this.handlers.concat(e._handlers),e._handlers=[],this.running||(this.running=!0,setTimeout(this.runHandlers.bind(this),0)))},runHandlers:function(){for(var a=Date.now()+1;0<this.handlers.length;){var t=this.handlers.shift(),e=t.thisPromise._status,o=t.thisPromise._value;try{1===e?"function"==typeof t.onResolve&&(o=t.onResolve(o)):"function"==typeof t.onReject&&(o=t.onReject(o),e=1,t.thisPromise._unhandledRejection&&this.removeUnhandeledRejection(t.thisPromise))}catch(a){e=l,o=a}if(t.nextPromise._updateStatus(e,o),Date.now()>=a)break}0<this.handlers.length?setTimeout(this.runHandlers.bind(this),0):this.running=!1},addUnhandledRejection:function(e){this.unhandledRejections.push({promise:e,time:Date.now()}),this.scheduleRejectionCheck()},removeUnhandeledRejection:function(a){a._unhandledRejection=!1;for(var t=0;t<this.unhandledRejections.length;t++)this.unhandledRejections[t].promise===a&&(this.unhandledRejections.splice(t),t--)},scheduleRejectionCheck:function(){this.pendingRejectionCheck||(this.pendingRejectionCheck=!0,setTimeout(function(){this.pendingRejectionCheck=!1;for(var a=Date.now(),t=0;t<this.unhandledRejections.length;t++)if(500<a-this.unhandledRejections[t].time){var e=this.unhandledRejections[t].promise._value,o="Unhandled rejection: "+e;e.stack&&(o+="\n"+e.stack),M(o),this.unhandledRejections.splice(t),t--}this.unhandledRejections.length&&this.scheduleRejectionCheck()}.bind(this),500))}};d.all=function(t){var n=new d(function(a,t){s=a,i=t}),o=t.length,a=[],s,i;if(0===o)return s(a),n;for(var e=0,r=t.length;e<r;++e){var c=t[e],p=function(r){return function(t){n._status!==l&&(a[r]=t,0===--o&&s(a))}}(e);d.isPromise(c)?c.then(p,function(e){n._status!==l&&(a=[],i(e))}):p(c)}return n},d.isPromise=function(e){return e&&"function"==typeof e.then},d.resolve=function(a){return new d(function(e){e(a)})},d.reject=function(a){return new d(function(e,t){t(a)})},d.prototype={_status:null,_value:null,_handlers:null,_unhandledRejection:null,_updateStatus:function(a,e){1!==this._status&&this._status!==l&&(1===a&&d.isPromise(e)?e.then(this._updateStatus.bind(this,1),this._updateStatus.bind(this,l)):(this._status=a,this._value=e,a===l&&0===this._handlers.length&&(this._unhandledRejection=!0,t.addUnhandledRejection(this)),t.scheduleHandlers(this)))},_resolve:function(e){this._updateStatus(1,e)},_reject:function(e){this._updateStatus(l,e)},then:function(a,o){var i=new d(function(a,t){this.resolve=a,this.reject=t});return this._handlers.push({thisPromise:this,onResolve:a,onReject:o,nextPromise:i}),t.scheduleHandlers(this),i},catch:function(e){return this.then(void 0,e)}},p.Promise=d}(),!function(){function a(a,o,e){for(;a.length<e;)a+=o;return a}(function(){this.started={},this.times=[],this.enabled=!0}).prototype={time:function(e){this.enabled&&(e in this.started&&M("Timer is already running for "+e),this.started[e]=Date.now())},timeEnd:function(e){this.enabled&&(e in this.started||M("Timer has not been started for "+e),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e])},toString:function(){var t=this.times,i="",r=0,o,e;for(o=0,e=t.length;o<e;++o){var n=t[o].name;n.length>r&&(r=n.length)}for(o=0,e=t.length;o<e;++o){var c=t[o],s=c.end-c.start;i+=a(c.name," ",r)+" "+s+"ms\n"}return i}}}(),PDFJS.createBlob=function(a,t){if("undefined"!=typeof Blob)return new Blob([a],{type:t});var o=new MozBlobBuilder;return o.append(a),o.getBlob(t)},PDFJS.createObjectURL=function(){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return function(t,e){if(!PDFJS.disableCreateObjectURL&&"undefined"!=typeof URL&&URL.createObjectURL){var u=PDFJS.createBlob(t,e);return URL.createObjectURL(u)}for(var i="data:"+e+";base64,",r=0,o=t.length;r<o;r+=3){var a=255&t[r],s=255&t[r+1],l=255&t[r+2],c=r+1<o?(15&s)<<2|l>>6:64,p=r+2<o?63&l:64;i+=n[a>>2]+n[(3&a)<<4|s>>4]+n[c]+n[p]}return i}}(),function(a,o){this.name=a,this.comObj=o,this.callbackIndex=1,this.postMessageTransfers=!0;var e=this.callbacksCapabilities={},n=this.actionHandler={};n.console_log=[function(e){console.log.apply(console,e)}],n.console_error=[function(e){console.error.apply(console,e)}],n._unsupported_feature=[function(e){_.notify(e)}],o.onmessage=function(i){var c=i.data;if(c.isReply){var t=c.callbackId;if(c.callbackId in e){var a=e[t];delete e[t],"error"in c?a.reject(c.error):a.resolve(c.data)}else P("Cannot resolve callback "+t)}else if(c.action in n){var r=n[c.action];c.callbackId?Promise.resolve().then(function(){return r[0].call(r[1],c.data)}).then(function(e){o.postMessage({isReply:!0,callbackId:c.callbackId,data:e})},function(e){o.postMessage({isReply:!0,callbackId:c.callbackId,error:e})}):r[0].call(r[1],c.data)}else P("Unknown action from worker: "+c.action)}}.prototype={on:function(a,t,e){var o=this.actionHandler;o[a]&&P("There is already an actionName called \""+a+"\""),o[a]=[t,e]},send:function(a,o,r){this.postMessage({action:a,data:o},r)},sendWithPromise:function(a,r,l){var n=this.callbackIndex++,s=c();this.callbacksCapabilities[n]=s;try{this.postMessage({action:a,data:r,callbackId:n},l)}catch(e){s.reject(e)}return s.promise},postMessage:function(a,t){t&&this.postMessageTransfers?this.comObj.postMessage(a,t):this.comObj.postMessage(a)}},"undefined"!==typeof e&&e.exports&&(e.exports=d)},function(c,t,e){"use strict";function d(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function i(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))||"function"==typeof o)?o:a}function r(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var o=e(15),a=e(0),n=function(l){function t(e,r){d(this,t);var o=i(this,l.call(this));o._id=r,o._url=e.url,o._header={},o._buffer=null;try{new TextDecoder().decode(e.mhdBuffer).split("\n").forEach(function(a){var t=a.split("=");2===t.length&&(o._header[t[0].trim()]=t[1].trim())}),o._header.DimSize=o._header.DimSize.split(" "),o._header.ElementSpacing=o._header.ElementSpacing.split(" "),o._header.TransformMatrix=o._header.TransformMatrix.split(" "),o._header.Offset=o._header.Offset.split(" "),o._buffer=e.rawBuffer}catch(e){window.console.log("ooops... :(")}return o}return r(t,l),t.prototype.rightHanded=function(){var e=this._header.AnatomicalOrientation;return this._rightHanded="RAS"===e||"RPI"===e||"LPS"===e||"LAI"===e,this._rightHanded},t.prototype.seriesInstanceUID=function(){return this._url},t.prototype.numberOfFrames=function(){return parseInt(this._header.DimSize[2],10)},t.prototype.sopInstanceUID=function(){return 0<arguments.length&&void 0!==arguments[0]?arguments[0]:0},t.prototype.rows=function(){return 0<arguments.length&&void 0!==arguments[0]&&arguments[0],parseInt(this._header.DimSize[1],10)},t.prototype.columns=function(){return 0<arguments.length&&void 0!==arguments[0]&&arguments[0],parseInt(this._header.DimSize[0],10)},t.prototype.pixelType=function(){return 0<arguments.length&&void 0!==arguments[0]&&arguments[0],0},t.prototype.bitsAllocated=function(){0<arguments.length&&void 0!==arguments[0]&&arguments[0];var e=1;return"MET_UCHAR"===this._header.ElementType||"MET_CHAR"===this._header.ElementType?e=8:"MET_USHORT"===this._header.ElementType||"MET_SHORT"===this._header.ElementType?e=16:"MET_UFLOAT"!==this._header.ElementType&&"MET_FLOAT"!==this._header.ElementType||(e=32),e},t.prototype.pixelSpacing=function(){return 0<arguments.length&&void 0!==arguments[0]&&arguments[0],[parseFloat(this._header.ElementSpacing[1],10),parseFloat(this._header.ElementSpacing[0],10),parseFloat(this._header.ElementSpacing[2],10)]},t.prototype.imageOrientation=function(){0<arguments.length&&void 0!==arguments[0]&&arguments[0];var o=this._header.AnatomicalOrientation.match(/L/)?-1:1,t=this._header.AnatomicalOrientation.match(/P/)?-1:1,e=new a.f(parseFloat(this._header.TransformMatrix[0])*o,parseFloat(this._header.TransformMatrix[1])*t,parseFloat(this._header.TransformMatrix[2]));e.normalize();var r=new a.f(parseFloat(this._header.TransformMatrix[3])*o,parseFloat(this._header.TransformMatrix[4])*t,parseFloat(this._header.TransformMatrix[5]));return r.normalize(),[e.x,e.y,e.z,r.x,r.y,r.z]},t.prototype.imagePosition=function(){return 0<arguments.length&&void 0!==arguments[0]&&arguments[0],[parseFloat(this._header.Offset[0]),parseFloat(this._header.Offset[1]),parseFloat(this._header.Offset[2])]},t.prototype.extractPixelData=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return this._decompressUncompressed(e)},t.prototype._decompressUncompressed=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=this._buffer,e=this.numberOfChannels(),o=this.rows(a)*this.columns(a)*e;this.rightHanded()||(a=this.numberOfFrames()-1-a);var n=a*o;return"MET_CHAR"===this._header.ElementType?new Int8Array(t,n,o):"MET_UCHAR"===this._header.ElementType?new Uint8Array(t,n,o):"MET_SHORT"===this._header.ElementType?(n*=2,new Int16Array(t,n,o)):"MET_USHORT"===this._header.ElementType?(n*=2,new Uint16Array(t,n,o)):"MET_FLOAT"===this._header.ElementType?(n*=4,new Float32Array(t,n,o)):void 0},t}(o.a);t.a=n},function(a,o,e){"use strict";var l=l||{};l.NIFTI1=l.NIFTI1||e(80),l.NIFTI2=l.NIFTI2||e(161),l.Utils=l.Utils||e(28);var n=n||e(19);l.isNIFTI1=function(a){var t,e,n,r;return t=new DataView(a),e=t.getUint8(l.NIFTI1.MAGIC_NUMBER_LOCATION),n=t.getUint8(l.NIFTI1.MAGIC_NUMBER_LOCATION+1),r=t.getUint8(l.NIFTI1.MAGIC_NUMBER_LOCATION+2),e===l.NIFTI1.MAGIC_NUMBER[0]&&n===l.NIFTI1.MAGIC_NUMBER[1]&&r===l.NIFTI1.MAGIC_NUMBER[2]},l.isNIFTI2=function(a){var t,e,n,r;return t=new DataView(a),e=t.getUint8(l.NIFTI2.MAGIC_NUMBER_LOCATION),n=t.getUint8(l.NIFTI2.MAGIC_NUMBER_LOCATION+1),r=t.getUint8(l.NIFTI2.MAGIC_NUMBER_LOCATION+2),e===l.NIFTI2.MAGIC_NUMBER[0]&&n===l.NIFTI2.MAGIC_NUMBER[1]&&r===l.NIFTI2.MAGIC_NUMBER[2]},l.isNIFTI=function(e){return l.isNIFTI1(e)||l.isNIFTI2(e)},l.isCompressed=function(a){var t,e,o;if(a){if(t=new DataView(a),e=t.getUint8(0),o=t.getUint8(1),e===l.Utils.GUNZIP_MAGIC_COOKIE1)return!0;if(o===l.Utils.GUNZIP_MAGIC_COOKIE2)return!0}return!1},l.decompress=function(e){return n.inflate(e).buffer},l.readHeader=function(a){var t=null;return l.isCompressed(a)&&(a=l.decompress(a)),l.isNIFTI1(a)?t=new l.NIFTI1:l.isNIFTI2(a)&&(t=new l.NIFTI2),t?t.readHeader(a):console.error("That file does not appear to be NIFTI!"),t},l.hasExtension=function(e){return 0!=e.extensionFlag[0]},l.readImage=function(a,t){var e=a.vox_offset,n=1,i=1;a.dims[4]&&(n=a.dims[4]),a.dims[5]&&(i=a.dims[5]);var r=a.dims[1]*a.dims[2]*a.dims[3]*n*i*(a.numBitsPerVoxel/8);return t.slice(e,e+r)},l.readExtension=function(a,t){var e=a.getExtensionLocation(),o=a.extensionSize;return t.slice(e,e+o)},l.readExtensionData=function(a,t){var e=a.getExtensionLocation(),o=a.extensionSize;return t.slice(e+8,e+o-8)},"undefined"!==typeof a&&a.exports&&(a.exports=l)},function(a,o,e){"use strict";var l=l||{};l.Utils=l.Utils||e(28),l.NIFTI1=l.NIFTI1||e(80),l.NIFTI2=l.NIFTI2||function(){this.littleEndian=!1,this.dim_info=0,this.dims=[],this.intent_p1=0,this.intent_p2=0,this.intent_p3=0,this.intent_code=0,this.datatypeCode=0,this.numBitsPerVoxel=0,this.slice_start=0,this.slice_end=0,this.slice_code=0,this.pixDims=[],this.vox_offset=0,this.scl_slope=1,this.scl_inter=0,this.xyzt_units=0,this.cal_max=0,this.cal_min=0,this.slice_duration=0,this.toffset=0,this.description="",this.aux_file="",this.intent_name="",this.qform_code=0,this.sform_code=0,this.quatern_b=0,this.quatern_c=0,this.quatern_d=0,this.qoffset_x=0,this.qoffset_y=0,this.qoffset_z=0,this.affine=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.magic=0,this.extensionFlag=[0,0,0,0]},l.NIFTI2.MAGIC_COOKIE=540,l.NIFTI2.MAGIC_NUMBER_LOCATION=4,l.NIFTI2.MAGIC_NUMBER=[110,43,50,0,13,10,26,10],l.NIFTI2.prototype.readHeader=function(i){var t=new DataView(i),a=l.Utils.getIntAt(t,0,this.littleEndian),s,e,n,r;if(a!==l.NIFTI2.MAGIC_COOKIE&&(this.littleEndian=!0,a=l.Utils.getIntAt(t,0,this.littleEndian)),a!==l.NIFTI2.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.datatypeCode=l.Utils.getShortAt(t,12,this.littleEndian),this.numBitsPerVoxel=l.Utils.getShortAt(t,14,this.littleEndian),s=0;8>s;s+=1)r=16+8*s,this.dims[s]=l.Utils.getLongAt(t,r,this.littleEndian);for(this.intent_p1=l.Utils.getDoubleAt(t,80,this.littleEndian),this.intent_p2=l.Utils.getDoubleAt(t,88,this.littleEndian),this.intent_p3=l.Utils.getDoubleAt(t,96,this.littleEndian),s=0;8>s;s+=1)r=104+8*s,this.pixDims[s]=l.Utils.getDoubleAt(t,r,this.littleEndian);for(this.vox_offset=l.Utils.getLongAt(t,168,this.littleEndian),this.scl_slope=l.Utils.getDoubleAt(t,176,this.littleEndian),this.scl_inter=l.Utils.getDoubleAt(t,184,this.littleEndian),this.cal_max=l.Utils.getDoubleAt(t,192,this.littleEndian),this.cal_min=l.Utils.getDoubleAt(t,200,this.littleEndian),this.slice_duration=l.Utils.getDoubleAt(t,208,this.littleEndian),this.toffset=l.Utils.getDoubleAt(t,216,this.littleEndian),this.slice_start=l.Utils.getLongAt(t,224,this.littleEndian),this.slice_end=l.Utils.getLongAt(t,232,this.littleEndian),this.description=l.Utils.getStringAt(t,240,320),this.aux_file=l.Utils.getStringAt(t,320,344),this.qform_code=l.Utils.getIntAt(t,344,this.littleEndian),this.sform_code=l.Utils.getIntAt(t,348,this.littleEndian),this.quatern_b=l.Utils.getDoubleAt(t,352,this.littleEndian),this.quatern_c=l.Utils.getDoubleAt(t,360,this.littleEndian),this.quatern_d=l.Utils.getDoubleAt(t,368,this.littleEndian),this.qoffset_x=l.Utils.getDoubleAt(t,376,this.littleEndian),this.qoffset_y=l.Utils.getDoubleAt(t,384,this.littleEndian),this.qoffset_z=l.Utils.getDoubleAt(t,392,this.littleEndian),e=0;3>e;e+=1)for(n=0;4>n;n+=1)r=400+8*(4*e+n),this.affine[e][n]=l.Utils.getDoubleAt(t,r,this.littleEndian);this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.slice_code=l.Utils.getIntAt(t,496,this.littleEndian),this.xyzt_units=l.Utils.getIntAt(t,500,this.littleEndian),this.intent_code=l.Utils.getIntAt(t,504,this.littleEndian),this.intent_name=l.Utils.getStringAt(t,508,524),this.dim_info=l.Utils.getByteAt(t,524),t.byteLength>l.NIFTI2.MAGIC_COOKIE&&(this.extensionFlag[0]=l.Utils.getByteAt(t,540),this.extensionFlag[1]=l.Utils.getByteAt(t,541),this.extensionFlag[2]=l.Utils.getByteAt(t,542),this.extensionFlag[3]=l.Utils.getByteAt(t,543),this.extensionFlag[0]&&(this.extensionSize=this.getExtensionSize(t),this.extensionCode=this.getExtensionCode(t)))},l.NIFTI2.prototype.toFormattedString=function(){var a=l.Utils.formatNumber,t="";return t+="Datatype = "+ +this.datatypeCode+" ("+this.getDatatypeCodeString(this.datatypeCode)+")\n",t+="Bits Per Voxel =  = "+this.numBitsPerVoxel+"\n",t+="Image Dimensions (1-8): "+this.dims[0]+", "+this.dims[1]+", "+this.dims[2]+", "+this.dims[3]+", "+this.dims[4]+", "+this.dims[5]+", "+this.dims[6]+", "+this.dims[7]+"\n",t+="Intent Parameters (1-3): "+this.intent_p1+", "+this.intent_p2+", "+this.intent_p3+"\n",t+="Voxel Dimensions (1-8): "+a(this.pixDims[0])+", "+a(this.pixDims[1])+", "+a(this.pixDims[2])+", "+a(this.pixDims[3])+", "+a(this.pixDims[4])+", "+a(this.pixDims[5])+", "+a(this.pixDims[6])+", "+a(this.pixDims[7])+"\n",t+="Image Offset = "+this.vox_offset+"\n",t+="Data Scale:  Slope = "+a(this.scl_slope)+"  Intercept = "+a(this.scl_inter)+"\n",t+="Display Range:  Max = "+a(this.cal_max)+"  Min = "+a(this.cal_min)+"\n",t+="Slice Duration = "+this.slice_duration+"\n",t+="Time Axis Shift = "+this.toffset+"\n",t+="Slice Start = "+this.slice_start+"\n",t+="Slice End = "+this.slice_end+"\n",t+="Description: \""+this.description+"\"\n",t+="Auxiliary File: \""+this.aux_file+"\"\n",t+="Q-Form Code = "+this.qform_code+" ("+this.getTransformCodeString(this.qform_code)+")\n",t+="S-Form Code = "+this.sform_code+" ("+this.getTransformCodeString(this.sform_code)+")\n",t+="Quaternion Parameters:  b = "+a(this.quatern_b)+"  c = "+a(this.quatern_c)+"  d = "+a(this.quatern_d)+"\n",t+="Quaternion Offsets:  x = "+this.qoffset_x+"  y = "+this.qoffset_y+"  z = "+this.qoffset_z+"\n",t+="S-Form Parameters X: "+a(this.affine[0][0])+", "+a(this.affine[0][1])+", "+a(this.affine[0][2])+", "+a(this.affine[0][3])+"\n",t+="S-Form Parameters Y: "+a(this.affine[1][0])+", "+a(this.affine[1][1])+", "+a(this.affine[1][2])+", "+a(this.affine[1][3])+"\n",t+="S-Form Parameters Z: "+a(this.affine[2][0])+", "+a(this.affine[2][1])+", "+a(this.affine[2][2])+", "+a(this.affine[2][3])+"\n",t+="Slice Code = "+this.slice_code+"\n",t+="Units Code = "+this.xyzt_units+" ("+this.getUnitsCodeString(l.NIFTI1.SPATIAL_UNITS_MASK&this.xyzt_units)+", "+this.getUnitsCodeString(l.NIFTI1.TEMPORAL_UNITS_MASK&this.xyzt_units)+")\n",t+="Intent Code = "+this.intent_code+"\n",t+="Intent Name: \""+this.intent_name+"\"\n",t+="Dim Info = "+this.dim_info+"\n"},l.NIFTI2.prototype.getExtensionLocation=function(){return l.NIFTI2.MAGIC_COOKIE+4},l.NIFTI2.prototype.getExtensionSize=l.NIFTI1.prototype.getExtensionSize,l.NIFTI2.prototype.getExtensionCode=l.NIFTI1.prototype.getExtensionCode,l.NIFTI2.prototype.getDatatypeCodeString=l.NIFTI1.prototype.getDatatypeCodeString,l.NIFTI2.prototype.getTransformCodeString=l.NIFTI1.prototype.getTransformCodeString,l.NIFTI2.prototype.getUnitsCodeString=l.NIFTI1.prototype.getUnitsCodeString,l.NIFTI2.prototype.getQformMat=l.NIFTI1.prototype.getQformMat,l.NIFTI2.prototype.convertNiftiQFormToNiftiSForm=l.NIFTI1.prototype.convertNiftiQFormToNiftiSForm,l.NIFTI2.prototype.convertNiftiSFormToNEMA=l.NIFTI1.prototype.convertNiftiSFormToNEMA,l.NIFTI2.prototype.nifti_mat33_mul=l.NIFTI1.prototype.nifti_mat33_mul,l.NIFTI2.prototype.nifti_mat33_determ=l.NIFTI1.prototype.nifti_mat33_determ,"undefined"!==typeof a&&a.exports&&(a.exports=l.NIFTI2)},function(H,t,e){"use strict";function n(e){return e.replace("\\","\\\\").replace("\n","\\n")}function i(e){return e.split("\\\\").map(function(e){return e.replace("\\n","\n")}).join("\\")}function r(a,t,l,n){var i=s(a),c;switch(a){case"data":case"buffer":case"keys":case"version":break;case"content":case"number":case"sampleUnits":case"space":c=i+": "+t;break;case"blockSize":case"lineSkip":case"byteSkip":case"dimension":case"spaceDimension":P("number"==typeof t||t instanceof Number,"Field "+a+" should at least contain a number!"),c=i+": "+t;break;case"min":case"max":case"oldMin":case"oldMax":P("number"==typeof t||t instanceof Number,"Field "+a+" should contain a number!"),c=i+": "+t;break;case"spaceOrigin":P(t.length===n,"Field "+a+" should be a list with length equal to the space dimension!"),t.forEach(function(t){P("number"==typeof t||t instanceof Number,"Field "+a+" should be a list of numbers!")}),c=i+": ("+t.join(",")+")";break;case"labels":case"units":case"spaceUnits":P(void 0!==t.length&&t.length==l,"Field "+a+" should be a list with length equal to the dimension!"),t.forEach(function(t){P("string"==typeof t||t instanceof String,"Field "+a+" should be a list of numbers!")}),c=i+": "+t.map(p).join(" ");break;case"sizes":P(void 0!==t.length&&t.length==l,"Field "+a+" should be a list with length equal to the dimension!"),t.forEach(function(t){P("number"==typeof t||t instanceof Number,"Field "+a+" should be a list of numbers!")}),c=i+": "+t.join(" ");break;case"spacings":case"thicknesses":case"axisMins":case"axisMaxs":P(void 0!==t.length&&t.length==l,"Field "+a+" should be a list with length equal to the dimension!"),t.forEach(function(t){P("number"==typeof t||t instanceof Number,"Field "+a+" should be a list of numbers!")}),c=i+": "+t.join(" ");break;case"spaceDirections":P(void 0!==t.length&&t.length===l,"Field "+a+" should be a list with length equal to the dimension!"),t.forEach(function(t){P(null===t||void 0!==t.length&&t.length===n,"The elements of field "+a+" should be lists with length equal to the space dimension!"),null!==t&&t.forEach(function(t){P("number"==typeof t||t instanceof Number,"The elements of field "+a+" should be lists of numbers!")})}),c=i+": "+t.map(function(e){return null===e?"none":"("+e.join(",")+")"}).join(" ");break;case"measurementFrame":P(void 0!==t.length&&t.length===n,"Field "+a+" should be a list with length equal to the space dimension!"),t.forEach(function(t){P(null===t||void 0!==t.length&&t.length===n,"The elements of field "+a+" should be lists with length equal to the space dimension!"),null!==t&&t.forEach(function(t){P("number"==typeof t||t instanceof Number,"The elements of field "+a+" should be lists of numbers!")})}),c=i+": "+t.map(function(e){return null===e?"none":"("+e.join(",")+")"}).join(" ");break;case"type":case"encoding":case"endian":P("string"==typeof t||t instanceof String,"Field "+a+" should contain a string!"),c=i+": "+t;break;case"dataFile":t.length||t.files&&"subdim"in t||(c=i+": "+g(t));break;case"centers":case"kinds":P(void 0!==t.length&&t.length==l,"Field "+a+" should be a list with length equal to the dimension!"),c=i+": "+t.map(b).join(" ");break;default:console.warn("Unrecognized NRRD field: "+a+", skipping.");}return c}function V(a,t){switch(a){case"content":case"number":case"sampleUnits":break;case"dimension":case"blockSize":case"lineSkip":case"byteSkip":case"spaceDimension":t=q(t);break;case"min":case"max":case"oldMin":case"oldMax":t=o(t);break;case"spaceOrigin":t=l(t);break;case"labels":case"units":case"spaceUnits":t=d(t,c);break;case"sizes":t=d(t,q);break;case"spacings":case"thicknesses":case"axisMins":case"axisMaxs":t=d(t,o);break;case"spaceDirections":case"measurementFrame":t=d(t,l);break;case"type":t=u(t);break;case"encoding":t=m(t);break;case"endian":t=X(t);break;case"dataFile":t=h(t);break;case"centers":t=d(t,f);break;case"kinds":t=d(t,y);break;case"space":t=_(t);break;default:console.warn("Unrecognized NRRD field: "+a);}return t}function W(e){return(e=e.toLowerCase())in R?R[e]:e}function s(e){return e in D?D[e]:e}function q(o){var t=parseInt(o,10);if(a(t))throw new Error("Malformed NRRD integer: "+o);return t}function o(o){if(0<=(o=o.toLowerCase()).indexOf("nan"))return NaN;if(0<=o.indexOf("-inf"))return-1/0;if(0<=o.indexOf("inf"))return 1/0;var t=parseFloat(o);if(a(t))throw new Error("Malformed NRRD float: "+o);return t}function l(e){if("none"==e)return null;if(2>e.length||"("!==e[0]||")"!==e[e.length-1])throw new Error("Malformed NRRD vector: "+e);return e.slice(1,-1).split(",").map(o)}function c(e){if(2>length||"\""!=e[0]||"\""!=e[e.length-1])throw new Error("Invalid NRRD quoted string: "+e);return e.slice(1,-1).replace("\\\"","\"")}function p(e){return"\""+e.replace("\"","\\\"")+"\""}function d(a,t){return a.split(k).map(t)}function u(e){switch(e.toLowerCase()){case"signed char":case"int8":case"int8_t":return"int8";case"uchar":case"unsigned char":case"uint8":case"uint8_t":return"uint8";case"short":case"short int":case"signed short":case"signed short int":case"int16":case"int16_t":return"int16";case"ushort":case"unsigned short":case"unsigned short int":case"uint16":case"uint16_t":return"uint16";case"int":case"signed int":case"int32":case"int32_t":return"int32";case"uint":case"unsigned int":case"uint32":case"uint32_t":return"uint32";case"longlong":case"long long":case"long long int":case"signed long long":case"signed long long int":case"int64":case"int64_t":return"int64";case"ulonglong":case"unsigned long long":case"unsigned long long int":case"uint64":case"uint64_t":return"uint64";case"float":return"float";case"double":return"double";case"block":return"block";default:return console.warn("Unrecognized NRRD type: "+e),e;}}function m(e){switch(e.toLowerCase()){case"raw":return"raw";case"txt":case"text":case"ascii":return"ascii";case"hex":return"hex";case"gz":case"gzip":return"gzip";case"bz2":case"bzip2":return"bzip2";default:return console.warn("Unrecognized NRRD encoding: "+e),e;}}function _(e){switch(e.toLowerCase()){case"right-anterior-superior":case"ras":return"right-anterior-superior";case"left-anterior-superior":case"las":return"left-anterior-superior";case"left-posterior-superior":case"lps":return"left-posterior-superior";case"right-anterior-superior-time":case"rast":return"right-anterior-superior-time";case"left-anterior-superior-time":case"last":return"left-anterior-superior-time";case"left-posterior-superior-time":case"lpst":return"left-posterior-superior-time";case"scanner-xyz":return"scanner-xyz";case"scanner-xyz-time":return"scanner-xyz-time";case"3d-right-handed":return"3D-right-handed";case"3d-left-handed":return"3D-left-handed";case"3d-right-handed-time":return"3D-right-handed-time";case"3d-left-handed-time":return"3D-left-handed-time";default:return console.warn("Unrecognized space: "+e),e;}}function X(e){switch(e.toLowerCase()){case"little":return"little";case"big":return"big";default:return console.warn("Unrecognized NRRD endianness: "+e),e;}}function h(a){var t=N.exec(a);return t?5==t.length&&t[4]?{format:a.substring(0,t.index),min:q(t[1]),max:q(t[2]),step:q(t[3]),subdim:q(t[4])}:{format:a.substring(0,t.index),min:q(t[1]),max:q(t[2]),step:q(t[3])}:a}function g(e){if("string"==typeof e||e instanceof String)return e;if("format"in e&&"min"in e&&"max"in e&&"step"in e)return"subdim"in e?e.format+" "+e.min+" "+e.max+" "+e.step+" "+e.subdim:e.format+" "+e.min+" "+e.max+" "+e.step;throw new Error("Unrecognized data file format!")}function f(e){switch(e.toLowerCase()){case"cell":return"cell";case"node":return"node";case"???":case"none":return null;default:return console.warn("Unrecognized NRRD center: "+e),e;}}function y(a){var t=a.toLowerCase();return t in U?U[t]:(console.warn("Unrecognized NRRD kind: "+a),a)}function b(e){return null===e?"???":e}function x(c,t,e,n){function i(t){if(c.byteLength<r*t)throw new Error("NRRD file does not contain enough data!")}var r=1,l,o,a;for(l=0;l<e.length;l++){if(0>=e[l])throw new Error("Sizes should be a list of positive (>0) integers!");r*=e[l]}if("block"==t)return c.slice(0,r*n.blockSize);if("int8"==t||"uint8"==t||n.endian==B)return"int8"===t?(i(1),new Int8Array(c.slice(0,r))):"uint8"===t?(i(1),new Uint8Array(c.slice(0,r))):"int16"===t?(i(2),new Int16Array(c.slice(0,2*r))):"uint16"===t?(i(2),new Uint16Array(c.slice(0,2*r))):"int32"===t?(i(4),new Int32Array(c.slice(0,4*r))):"uint32"===t?(i(4),new Uint32Array(c.slice(0,4*r))):"float"===t?(i(4),new Float32Array(c.slice(0,4*r))):"double"===t?(i(8),new Float64Array(c.slice(0,8*r))):void console.warn("Unsupported NRRD type: "+t+", returning raw buffer.");switch(n.endian){case"big":break;case"little":break;default:return void console.warn("Unsupported endianness in NRRD file: "+n.endian);}switch(a=new DataView(c),t){case"int8":for(o=new Int8Array(r),l=0;l<r;l++)o[l]=a.getInt8(l);return o;case"uint8":for(o=new Uint8Array(r),l=0;l<r;l++)o[l]=a.getUint8(l);return o;case"int16":for(o=new Int16Array(r),l=0;l<r;l++)o[l]=a.getInt16(2*l);return o;case"uint16":for(o=new Uint16Array(r),l=0;l<r;l++)o[l]=a.getUint16(2*l);return o;case"int32":for(o=new Int32Array(r),l=0;l<r;l++)o[l]=a.getInt32(4*l);return o;case"uint32":for(o=new Uint32Array(r),l=0;l<r;l++)o[l]=a.getUint32(4*l);return o;case"float":for(o=new Float32Array(r),l=0;l<r;l++)o[l]=a.getFloat32(4*l);return o;case"double":for(o=new Float64Array(r),l=0;l<r;l++)o[l]=a.getFloat64(8*l);return o;default:return void console.warn("Unsupported NRRD type: "+t+", returning raw buffer.");}}function v(l,t,e){var n=1,s,i,r,c;for(s=0;s<e.length;s++){if(0>=e[s])throw new Error("Sizes should be a list of positive (>0) integers!");n*=e[s]}if(i=new Uint8Array(l),r=F.apply(null,i),(c=r.split(z)).length<n)throw new Error("Not enough data in NRRD file!");switch(c.length>n&&(""===c[0]&&(c=c.slice(1)),c=c.slice(0,n)),t){case"int8":return new Int8Array(c.map(q));case"uint8":return new Uint8Array(c.map(q));case"int16":return new Int16Array(c.map(q));case"uint16":return new Uint16Array(c.map(q));case"int32":return new Int32Array(c.map(q));case"uint32":return new Uint32Array(c.map(q));case"float":return new Float32Array(c.map(o));case"double":return new Float64Array(c.map(o));default:return void console.warn("Unsupported NRRD type: "+t+".");}}function S(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":return 4;case"int64":case"uint64":return 8;case"float":return 4;case"double":return 8;default:throw new Error("Do not know the size of NRRD type: "+e);}}function w(e){if(void 0===e.dimension)throw new Error("Dimension missing from NRRD file!");if(void 0===e.type)throw new Error("Type missing from NRRD file!");if(void 0===e.encoding)throw new Error("Encoding missing from NRRD file!");if(void 0===e.sizes)throw new Error("Sizes missing from NRRD file!");if("block"!=e.type&&"int8"!=e.type&&"uint8"!=e.type&&"ascii"!=e.encoding&&void 0===e.endian)throw new Error("Endianness missing from NRRD file!");if("block"==e.type&&void 0===e.blockSize)throw new Error("Missing block size in NRRD file!");if(0===e.dimension)throw new Error("Zero-dimensional NRRD file?");if(e.dimension!=e.sizes.length)throw new Error("Length of 'sizes' is different from 'dimension' in an NRRD file!");if(e.spacings&&e.dimension!=e.spacings.length)throw new Error("Length of 'spacings' is different from 'dimension' in an NRRD file!");if(e.thicknesses&&e.dimension!=e.thicknesses.length)throw new Error("Length of 'thicknesses' is different from 'dimension' in an NRRD file!");if(e.axisMins&&e.dimension!=e.axisMins.length)throw new Error("Length of 'axis mins' is different from 'dimension' in an NRRD file!");if(e.axisMaxs&&e.dimension!=e.axisMaxs.length)throw new Error("Length of 'axis maxs' is different from 'dimension' in an NRRD file!");if(e.centers&&e.dimension!=e.centers.length)throw new Error("Length of 'centers' is different from 'dimension' in an NRRD file!");if(e.labels&&e.dimension!=e.labels.length)throw new Error("Length of 'labels' is different from 'dimension' in an NRRD file!");if(e.units&&e.dimension!=e.units.length)throw new Error("Length of 'units' is different from 'dimension' in an NRRD file!");if(e.kinds&&e.dimension!=e.kinds.length)throw new Error("Length of 'kinds' is different from 'dimension' in an NRRD file!");if((void 0===e.data||0===e.data.length)&&(void 0===e.buffer||0===e.buffer.byteLength)&&void 0===e.dataFile)throw new Error("NRRD file has neither inline or external data!")}function E(a,t){switch(t){case"int8":return new Int8Array(a);case"uint8":return new Uint8Array(a);case"int16":return new Int16Array(a);case"uint16":return new Uint16Array(a);case"int32":return new Int32Array(a);case"uint32":return new Uint32Array(a);case"float":return new Float32Array(a);case"double":return new Float64Array(a);default:throw new Error("Cannot cast to NRRD type: "+t);}}function T(l,t,e){var n=S(t),a=new ArrayBuffer(l.length*n),s,i,r;switch(e){case"big":i=!1;break;case"little":i=!0;break;default:return void console.warn("Unsupported endianness in NRRD file: "+e);}switch(r=new DataView(a),t){case"int8":for(s=0;s<l.length;s++)r.setInt8(s,l[s],i);return a;case"uint8":for(s=0;s<l.length;s++)r.setUint8(s,l[s],i);return a;case"int16":for(s=0;s<l.length;s++)r.setInt16(2*s,l[s],i);return a;case"uint16":for(s=0;s<l.length;s++)r.setUint16(2*s,l[s],i);return a;case"int32":for(s=0;s<l.length;s++)r.setInt32(4*s,l[s],i);return a;case"uint32":for(s=0;s<l.length;s++)r.setUint32(4*s,l[s],i);return a;case"float":for(s=0;s<l.length;s++)r.setFloat32(4*s,l[s],i);return a;case"double":for(s=0;s<l.length;s++)r.setFloat64(8*s,l[s],i);return a;default:return void console.warn("Cannot serialize NRRD type: "+t+".");}}function M(a){var t=Array(a.length),o,e,n,i;for(o=0;o<a.length;o++)t[o]=""+a[o];for(e=t.join(" "),n=new ArrayBuffer(e.length),i=new Uint8Array(n),o=0;o<i.length;o++)i[o]=e.charCodeAt(o);return n}var P=e(72),C=/[ \f\t\v]*\r?\n/,L=/^NRRD\d{4}$/,A=/^([^:]*)(:[ =])(.*)$/,I=/^LIST(?: (\d+))?$/;H.exports.serialize=function(o){var t=1,i={},d=[],_,e,g,f,a,s,l,y,h,x;for(f in o)i[f]=o[f];if(void 0===i.sizes)throw new Error("Sizes missing from NRRD file!");if(void 0===i.dimension&&(i.dimension=i.sizes.length),i.data instanceof Int8Array?a="int8":i.data instanceof Uint8Array?a="uint8":i.data instanceof Int16Array?a="int16":i.data instanceof Uint16Array?a="uint16":i.data instanceof Int32Array?a="int32":i.data instanceof Uint32Array?a="uint32":i.data instanceof Float32Array?a="float":i.data instanceof Float64Array&&(a="double"),void 0===i.type&&void 0!==a)i.type=a;else{if(void 0===i.type)throw new Error("Type of data is not given and cannot be inferred!");("string"==typeof i.type||i.type instanceof String)&&(i.type=u(i.type))}void 0===i.encoding?i.encoding="raw":("string"==typeof i.encoding||i.encoding instanceof String)&&(i.encoding=m(i.encoding)),i.data&&"block"!=i.type&&"int8"!=i.type&&"uint8"!=i.type&&"ascii"!=i.encoding?i.endian=B:"block"==i.type||"int8"==i.type||"uint8"==i.type||"ascii"==i.encoding?i.endian=void 0:("string"==typeof i.endian||i.endian instanceof String)&&(i.endian=X(i.endian));var p;if(void 0!==i.spaceDimension)p=i.spaceDimension;else if(void 0!==i.space)switch(i.space){case"right-anterior-superior":case"RAS":p=3;break;case"left-anterior-superior":case"LAS":p=3;break;case"left-posterior-superior":case"LPS":p=3;break;case"right-anterior-superior-time":case"RAST":p=4;break;case"left-anterior-superior-time":case"LAST":p=4;break;case"left-posterior-superior-time":case"LPST":p=4;break;case"scanner-xyz":p=3;break;case"scanner-xyz-time":p=4;break;case"3D-right-handed":case"3D-left-handed":p=3;break;case"3D-right-handed-time":case"3D-left-handed-time":p=4;break;default:console.warn("Unrecognized space: "+i.space);}for(w(i),_=0;_<i.sizes.length;_++){if(0>=i.sizes[_])throw new Error("Sizes should be a list of positive (>0) integers!");t*=i.sizes[_]}if(i.data){if(i.data.length<t)throw new Error("Missing data to serialize!");}else if(i.buffer){if("raw"==i.encoding&&(s="block"==i.type&&void 0!==i.blockSize?i.blockSize:S(i.type),i.buffer.byteLength<t*s))throw new Error("Missing data to serialize!");}else if(!i.dataFile)throw new Error("Will not serialize an empty NRRD file!");if(i.data)switch(i.encoding){case"raw":l=i.type==a&&i.endian==B?i.data.buffer.slice(i.data.byteOffset,i.data.byteOffset+i.data.byteLength):i.endian==B?(l=E(i.data,i.type)).buffer.slice(l.byteOffset,l.byteOffset+l.byteLength):T(i.data,i.type,i.endian);break;case"ascii":l=M(i.type==a?i.data:E(i.data,i.type));break;default:throw new Error("Unsupported NRRD encoding: "+i.encoding);}else i.buffer&&(l=i.buffer);d.push("NRRD0005"),d.push("# Generated by nrrd-js");var v=["dimension","spaceDimension","space"];for(_=0;_<v.length;_++)void 0!==i[f=v[_]]&&void 0!==(h=r(f,i[f],i.dimension,p))&&d.push(h);for(f in i)void 0!==i[f]&&(0<=v.indexOf(f)||void 0!==(h=r(f,i[f],i.dimension,p))&&d.push(h));if(i.keys)for(f in i.keys){if(0<=f.indexOf(":="))throw new Error("The combination ':=' is not allowed in an NRRD key!");d.push(f+":="+n(i[f]))}if(i.dataFile&&i.dataFile.length?(d.push("data file: LIST"),Array.prototype.push.apply(d,i.dataFile)):i.dataFile&&i.dataFile.files&&"subdim"in i.dataFile&&(d.push("data file: LIST "+i.dataFile.subdim),Array.prototype.push.apply(d,i.dataFile.files)),!l||"dataFile"in i)for(d.push(""),x=d.join("\n"),e=new ArrayBuffer(x.length),g=new Uint8Array(e),_=0;_<x.length;_++)g[_]=x.charCodeAt(_);else{for(d.push(""),d.push(""),x=d.join("\n"),e=new ArrayBuffer(x.length+l.byteLength),g=new Uint8Array(e),_=0;_<x.length;_++)g[_]=x.charCodeAt(_);y=new Uint8Array(l),g.set(y,x.length)}return e},H.exports.parse=function(a){var t={data:void 0,buffer:void 0,keys:{},version:void 0},r=new Uint8Array(a),s,e,n,c,o,l;for(r.buffer!==a&&(a=r.buffer),s=2;s<r.length;)if(10==r[s]){if(10==r[s-1]||13==r[s-1]&&10==r[s-2]){n=s+1;break}s++}else 13==r[s]?s++:s+=2;if(void 0===n?e=F.apply(null,r):(e=F.apply(null,r.subarray(0,n)),t.buffer=a.slice(n)),c=e.split(C),c=c.filter(function(e){return 0<e.length&&"#"!=e[0]}),!L.test(c[0]))throw new Error("File is not an NRRD file!");for(t.version=parseInt(c[0].substring(4,8),10),5<t.version&&console.warn("Reading an unsupported version of the NRRD format; things may go haywire."),s=1;s<c.length;s++)if(!(o=A.exec(c[s])))console.warn("Unrecognized line in NRRD header: "+c[s]);else if(": "==o[2])o[1]=W(o[1]),"dataFile"==o[1]&&(l=I.exec(o[3]))?(t[o[1]]=2==l.length&&l[1]?{files:c.slice(s+1),subdim:q(l[1])}:c.slice(s+1),c.length=s):t[o[1]]=V(o[1],o[3]);else{if(":="!=o[2])throw new Error("Logic error in NRRD parser.");t.keys[o[1]]=i(o[3])}if(w(t),"dataFile"in t)console.warn("No support for external data yet!");else switch(t.encoding){case"raw":t.data=x(t.buffer,t.type,t.sizes,{endian:t.endian,blockSize:t.blockSize});break;case"ascii":t.data=v(t.buffer,t.type,t.sizes);break;default:console.warn("Unsupported NRRD encoding: "+t.encoding);}return t};var R={"block size":"blockSize",blocksize:"blockSize","old min":"oldMin",oldmin:"oldMin","old max":"oldMax",oldmax:"oldMax","data file":"dataFile",datafile:"dataFile","line skip":"lineSkip",lineskip:"lineSkip","byte skip":"byteSkip",byteskip:"byteSkip","sample units":"sampleUnits",sampleunits:"sampleUnits","axis mins":"axisMins","axis maxs":"axisMaxs",centers:"centers",centerings:"centers","space dimension":"spaceDimension","space units":"spaceUnits","space origin":"spaceOrigin","space directions":"spaceDirections","measurement frame":"measurementFrame"},D=function(){var a={},e;for(e in R)a[R[e]]=e;return a}(),k=/[ \t]+/,N=/ (-?\d+) (-?\d+) (-?\d+)(?: (\d+))?$/,U={domain:"domain",space:"space",time:"time",list:"list",point:"point",vector:"vector","covariant-vector":"covariant-vector",normal:"normal",stub:"stub",scalar:"scalar",complex:"complex","2-vector":"2-vector","3-color":"3-color","rgb-color":"RGB-color","hsv-color":"HSV-color","xyz-color":"XYZ-color","4-color":"4-color","rgba-color":"RGBA-color","3-vector":"3-vector","3-gradient":"3-gradient","3-normal":"3-normal","4-vector":"4-vector",quaternion:"quaternion","2d-symmetric-matrix":"2D-symmetric-matrix","2d-masked-symmetric-matrix":"2D-masked-symmetric-matrix","2d-matrix":"2D-matrix","2d-masked-matrix":"2D-masked-matrix","3d-symmetric-matrix":"3D-symmetric-matrix","3d-masked-symmetric-matrix":"3D-masked-symmetric-matrix","3d-matrix":"3D-matrix","3d-masked-matrix":"3D-masked-matrix","???":null,none:null},B=function(){var a=new ArrayBuffer(4),t=new Uint32Array(a),e=new Uint8Array(a);return t[0]=16909060,1==e[0]&&2==e[1]&&3==e[2]&&4==e[3]?"big":4==e[0]&&3==e[1]&&2==e[2]&&1==e[3]?"little":void console.warn("Unrecognized system endianness!")}(),z=/[ \t\n\r\v\f]+/},function(l,t,e){"use strict";var n=e(60),i=e(23),r=e(57),o=e(82);e.d(t,"a",function(){return n.a}),e.d(t,"c",function(){return i.a}),e.d(t,"b",function(){return r.a}),e.d(t,"d",function(){return o.a})},function(a,t,e){"use strict";var n=e(61),i=e(79),r=e(81);e.d(t,"a",function(){return n.a}),e.d(t,"b",function(){return i.a}),e.d(t,"c",function(){return r.a})},function(a,t,e){"use strict";var o=e(166);e.d(t,"a",function(){return o.a})},function(l,t,e){"use strict";function n(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}var i=e(167),r=function(){function a(a,o){for(var e=0,r;e<o.length;e++)r=o[e],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,r.key,r)}return function(t,e,o){return e&&a(t.prototype,e),o&&a(t,o),t}}(),o=function(){function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"Freesurfer";n(this,a),this._presetID=t,this._presets=this.presetSegs()}return a.prototype.fetchPreset=function(e){return this._presets[e]},a.prototype.addPreset=function(e){this._presets.push(e)},a.prototype.presetsAvailable=function(){0<arguments.length&&void 0!==arguments[0]&&arguments[0];var a=[],t=this._presets;for(var e in t)a.push(e);return a},a.prototype.presetSegs=function(){return{Freesurfer:i.a}},r(a,[{key:"preset",set:function(e){this._presetID=e},get:function(){return this.fetchPreset(this._presetID)}}]),a}();t.a=o},function(a,t){"use strict";t.a={0:{color:[0,0,0],opacity:0,label:"Unknown"},1:{color:[70,130,180],opacity:1,label:"Left-Cerebral-Exterior"},2:{color:[245,245,245],opacity:1,label:"Left-Cerebral-White-Matter"},3:{color:[205,62,78],opacity:1,label:"Left-Cerebral-Cortex"},4:{color:[120,18,134],opacity:1,label:"Left-Lateral-Ventricle"},5:{color:[196,58,250],opacity:1,label:"Left-Inf-Lat-Vent"},6:{color:[0,148,0],opacity:1,label:"Left-Cerebellum-Exterior"},7:{color:[220,248,164],opacity:1,label:"Left-Cerebellum-White-Matter"},8:{color:[230,148,34],opacity:1,label:"Left-Cerebellum-Cortex"},9:{color:[0,118,14],opacity:1,label:"Left-Thalamus"},10:{color:[0,118,14],opacity:1,label:"Left-Thalamus-Proper"},11:{color:[122,186,220],opacity:1,label:"Left-Caudate"},12:{color:[236,13,176],opacity:1,label:"Left-Putamen"},13:{color:[12,48,255],opacity:1,label:"Left-Pallidum"},14:{color:[204,182,142],opacity:1,label:"3rd-Ventricle"},15:{color:[42,204,164],opacity:1,label:"4th-Ventricle"},16:{color:[119,159,176],opacity:1,label:"Brain-Stem"},17:{color:[220,216,20],opacity:1,label:"Left-Hippocampus"},18:{color:[103,255,255],opacity:1,label:"Left-Amygdala"},19:{color:[80,196,98],opacity:1,label:"Left-Insula"},20:{color:[60,58,210],opacity:1,label:"Left-Operculum"},21:{color:[60,58,210],opacity:1,label:"Line-1"},22:{color:[60,58,210],opacity:1,label:"Line-2"},23:{color:[60,58,210],opacity:1,label:"Line-3"},24:{color:[60,60,60],opacity:1,label:"CSF"},25:{color:[255,165,0],opacity:1,label:"Left-Lesion"},26:{color:[255,165,0],opacity:1,label:"Left-Accumbens-area"},27:{color:[0,255,127],opacity:1,label:"Left-Substancia-Nigra"},28:{color:[165,42,42],opacity:1,label:"Left-VentralDC"},29:{color:[135,206,235],opacity:1,label:"Left-undetermined"},30:{color:[160,32,240],opacity:1,label:"Left-vessel"},31:{color:[0,200,200],opacity:1,label:"Left-choroid-plexus"},32:{color:[100,50,100],opacity:1,label:"Left-F3orb"},33:{color:[135,50,74],opacity:1,label:"Left-lOg"},34:{color:[122,135,50],opacity:1,label:"Left-aOg"},35:{color:[51,50,135],opacity:1,label:"Left-mOg"},36:{color:[74,155,60],opacity:1,label:"Left-pOg"},37:{color:[120,62,43],opacity:1,label:"Left-Stellate"},38:{color:[74,155,60],opacity:1,label:"Left-Porg"},39:{color:[122,135,50],opacity:1,label:"Left-Aorg"},40:{color:[70,130,180],opacity:1,label:"Right-Cerebral-Exterior"},41:{color:[245,245,245],opacity:1,label:"Right-Cerebral-White-Matter"},42:{color:[205,62,78],opacity:1,label:"Right-Cerebral-Cortex"},43:{color:[120,18,134],opacity:1,label:"Right-Lateral-Ventricle"},44:{color:[196,58,250],opacity:1,label:"Right-Inf-Lat-Vent"},45:{color:[0,148,0],opacity:1,label:"Right-Cerebellum-Exterior"},46:{color:[220,248,164],opacity:1,label:"Right-Cerebellum-White-Matter"},47:{color:[230,148,34],opacity:1,label:"Right-Cerebellum-Cortex"},48:{color:[0,118,14],opacity:1,label:"Right-Thalamus"},49:{color:[0,118,14],opacity:1,label:"Right-Thalamus-Proper"},50:{color:[122,186,220],opacity:1,label:"Right-Caudate"},51:{color:[236,13,176],opacity:1,label:"Right-Putamen"},52:{color:[13,48,255],opacity:1,label:"Right-Pallidum"},53:{color:[220,216,20],opacity:1,label:"Right-Hippocampus"},54:{color:[103,255,255],opacity:1,label:"Right-Amygdala"},55:{color:[80,196,98],opacity:1,label:"Right-Insula"},56:{color:[60,58,210],opacity:1,label:"Right-Operculum"},57:{color:[255,165,0],opacity:1,label:"Right-Lesion"},58:{color:[255,165,0],opacity:1,label:"Right-Accumbens-area"},59:{color:[0,255,127],opacity:1,label:"Right-Substancia-Nigra"},60:{color:[165,42,42],opacity:1,label:"Right-VentralDC"},61:{color:[135,206,235],opacity:1,label:"Right-undetermined"},62:{color:[160,32,240],opacity:1,label:"Right-vessel"},63:{color:[0,200,221],opacity:1,label:"Right-choroid-plexus"},64:{color:[100,50,100],opacity:1,label:"Right-F3orb"},65:{color:[135,50,74],opacity:1,label:"Right-lOg"},66:{color:[122,135,50],opacity:1,label:"Right-aOg"},67:{color:[51,50,135],opacity:1,label:"Right-mOg"},68:{color:[74,155,60],opacity:1,label:"Right-pOg"},69:{color:[120,62,43],opacity:1,label:"Right-Stellate"},70:{color:[74,155,60],opacity:1,label:"Right-Porg"},71:{color:[122,135,50],opacity:1,label:"Right-Aorg"},72:{color:[120,190,150],opacity:1,label:"5th-Ventricle"},73:{color:[122,135,50],opacity:1,label:"Left-Interior"},74:{color:[122,135,50],opacity:1,label:"Right-Interior"},77:{color:[200,70,255],opacity:1,label:"WM-hypointensities"},78:{color:[255,148,10],opacity:1,label:"Left-WM-hypointensities"},79:{color:[255,148,10],opacity:1,label:"Right-WM-hypointensities"},80:{color:[164,108,226],opacity:1,label:"non-WM-hypointensities"},81:{color:[164,108,226],opacity:1,label:"Left-non-WM-hypointensities"},82:{color:[164,108,226],opacity:1,label:"Right-non-WM-hypointensities"},83:{color:[255,218,185],opacity:1,label:"Left-F1"},84:{color:[255,218,185],opacity:1,label:"Right-F1"},85:{color:[234,169,30],opacity:1,label:"Optic-Chiasm"},192:{color:[250,255,50],opacity:1,label:"Corpus_Callosum"},86:{color:[200,120,255],opacity:1,label:"Left_future_WMSA"},87:{color:[200,121,255],opacity:1,label:"Right_future_WMSA"},88:{color:[200,122,255],opacity:1,label:"future_WMSA"},96:{color:[205,10,125],opacity:1,label:"Left-Amygdala-Anterior"},97:{color:[205,10,125],opacity:1,label:"Right-Amygdala-Anterior"},98:{color:[160,32,240],opacity:1,label:"Dura"},100:{color:[124,140,178],opacity:1,label:"Left-wm-intensity-abnormality"},101:{color:[125,140,178],opacity:1,label:"Left-caudate-intensity-abnormality"},102:{color:[126,140,178],opacity:1,label:"Left-putamen-intensity-abnormality"},103:{color:[127,140,178],opacity:1,label:"Left-accumbens-intensity-abnormality"},104:{color:[124,141,178],opacity:1,label:"Left-pallidum-intensity-abnormality"},105:{color:[124,142,178],opacity:1,label:"Left-amygdala-intensity-abnormality"},106:{color:[124,143,178],opacity:1,label:"Left-hippocampus-intensity-abnormality"},107:{color:[124,144,178],opacity:1,label:"Left-thalamus-intensity-abnormality"},108:{color:[124,140,179],opacity:1,label:"Left-VDC-intensity-abnormality"},109:{color:[124,140,178],opacity:1,label:"Right-wm-intensity-abnormality"},110:{color:[125,140,178],opacity:1,label:"Right-caudate-intensity-abnormality"},111:{color:[126,140,178],opacity:1,label:"Right-putamen-intensity-abnormality"},112:{color:[127,140,178],opacity:1,label:"Right-accumbens-intensity-abnormality"},113:{color:[124,141,178],opacity:1,label:"Right-pallidum-intensity-abnormality"},114:{color:[124,142,178],opacity:1,label:"Right-amygdala-intensity-abnormality"},115:{color:[124,143,178],opacity:1,label:"Right-hippocampus-intensity-abnormality"},116:{color:[124,144,178],opacity:1,label:"Right-thalamus-intensity-abnormality"},117:{color:[124,140,179],opacity:1,label:"Right-VDC-intensity-abnormality"},118:{color:[255,20,147],opacity:1,label:"Epidermis"},119:{color:[205,179,139],opacity:1,label:"Conn-Tissue"},120:{color:[238,238,209],opacity:1,label:"SC-Fat-Muscle"},121:{color:[200,200,200],opacity:1,label:"Cranium"},122:{color:[74,255,74],opacity:1,label:"CSF-SA"},123:{color:[238,0,0],opacity:1,label:"Muscle"},124:{color:[0,0,139],opacity:1,label:"Ear"},125:{color:[173,255,47],opacity:1,label:"Adipose"},126:{color:[133,203,229],opacity:1,label:"Spinal-Cord"},127:{color:[26,237,57],opacity:1,label:"Soft-Tissue"},128:{color:[34,139,34],opacity:1,label:"Nerve"},129:{color:[30,144,255],opacity:1,label:"Bone"},130:{color:[147,19,173],opacity:1,label:"Air"},131:{color:[238,59,59],opacity:1,label:"Orbital-Fat"},132:{color:[221,39,200],opacity:1,label:"Tongue"},133:{color:[238,174,238],opacity:1,label:"Nasal-Structures"},134:{color:[255,0,0],opacity:1,label:"Globe"},135:{color:[72,61,139],opacity:1,label:"Teeth"},136:{color:[21,39,132],opacity:1,label:"Left-Caudate-Putamen"},137:{color:[21,39,132],opacity:1,label:"Right-Caudate-Putamen"},138:{color:[65,135,20],opacity:1,label:"Left-Claustrum"},139:{color:[65,135,20],opacity:1,label:"Right-Claustrum"},140:{color:[134,4,160],opacity:1,label:"Cornea"},142:{color:[221,226,68],opacity:1,label:"Diploe"},143:{color:[255,255,254],opacity:1,label:"Vitreous-Humor"},144:{color:[52,209,226],opacity:1,label:"Lens"},145:{color:[239,160,223],opacity:1,label:"Aqueous-Humor"},146:{color:[70,130,180],opacity:1,label:"Outer-Table"},147:{color:[70,130,181],opacity:1,label:"Inner-Table"},148:{color:[139,121,94],opacity:1,label:"Periosteum"},149:{color:[224,224,224],opacity:1,label:"Endosteum"},150:{color:[255,0,0],opacity:1,label:"R-C-S"},151:{color:[205,205,0],opacity:1,label:"Iris"},152:{color:[238,238,209],opacity:1,label:"SC-Adipose-Muscle"},153:{color:[139,121,94],opacity:1,label:"SC-Tissue"},154:{color:[238,59,59],opacity:1,label:"Orbital-Adipose"},155:{color:[238,59,59],opacity:1,label:"Left-IntCapsule-Ant"},156:{color:[238,59,59],opacity:1,label:"Right-IntCapsule-Ant"},157:{color:[62,10,205],opacity:1,label:"Left-IntCapsule-Pos"},158:{color:[62,10,205],opacity:1,label:"Right-IntCapsule-Pos"},159:{color:[0,118,14],opacity:1,label:"Left-Cerebral-WM-unmyelinated"},160:{color:[0,118,14],opacity:1,label:"Right-Cerebral-WM-unmyelinated"},161:{color:[220,216,21],opacity:1,label:"Left-Cerebral-WM-myelinated"},162:{color:[220,216,21],opacity:1,label:"Right-Cerebral-WM-myelinated"},163:{color:[122,186,220],opacity:1,label:"Left-Subcortical-Gray-Matter"},164:{color:[122,186,220],opacity:1,label:"Right-Subcortical-Gray-Matter"},165:{color:[120,120,120],opacity:1,label:"Skull"},166:{color:[14,48,255],opacity:1,label:"Posterior-fossa"},167:{color:[166,42,42],opacity:1,label:"Scalp"},168:{color:[121,18,134],opacity:1,label:"Hematoma"},169:{color:[236,13,127],opacity:1,label:"Left-Basal-Ganglia"},176:{color:[236,13,126],opacity:1,label:"Right-Basal-Ganglia"},170:{color:[119,159,176],opacity:1,label:"brainstem"},171:{color:[119,0,176],opacity:1,label:"DCG"},172:{color:[119,100,176],opacity:1,label:"Vermis"},173:{color:[242,104,76],opacity:1,label:"Midbrain"},174:{color:[206,195,58],opacity:1,label:"Pons"},175:{color:[119,159,176],opacity:1,label:"Medulla"},177:{color:[119,50,176],opacity:1,label:"Vermis-White-Matter"},178:{color:[142,182,0],opacity:1,label:"SCP"},179:{color:[19,100,176],opacity:1,label:"Floculus"},180:{color:[73,61,139],opacity:1,label:"Left-Cortical-Dysplasia"},181:{color:[73,62,139],opacity:1,label:"Right-Cortical-Dysplasia"},182:{color:[10,100,176],opacity:1,label:"CblumNodulus"},193:{color:[0,196,255],opacity:1,label:"Left-hippocampal_fissure"},194:{color:[255,164,164],opacity:1,label:"Left-CADG-head"},195:{color:[196,196,0],opacity:1,label:"Left-subiculum"},196:{color:[0,100,255],opacity:1,label:"Left-fimbria"},197:{color:[128,196,164],opacity:1,label:"Right-hippocampal_fissure"},198:{color:[0,126,75],opacity:1,label:"Right-CADG-head"},199:{color:[128,96,64],opacity:1,label:"Right-subiculum"},200:{color:[0,50,128],opacity:1,label:"Right-fimbria"},201:{color:[255,204,153],opacity:1,label:"alveus"},202:{color:[255,128,128],opacity:1,label:"perforant_pathway"},203:{color:[255,255,0],opacity:1,label:"parasubiculum"},204:{color:[64,0,64],opacity:1,label:"presubiculum"},205:{color:[0,0,255],opacity:1,label:"subiculum"},206:{color:[255,0,0],opacity:1,label:"CA1"},207:{color:[128,128,255],opacity:1,label:"CA2"},208:{color:[0,128,0],opacity:1,label:"CA3"},209:{color:[196,160,128],opacity:1,label:"CA4"},210:{color:[32,200,255],opacity:1,label:"GC-DG"},211:{color:[128,255,128],opacity:1,label:"HATA"},212:{color:[204,153,204],opacity:1,label:"fimbria"},213:{color:[121,17,136],opacity:1,label:"lateral_ventricle"},214:{color:[128,0,0],opacity:1,label:"molecular_layer_HP"},215:{color:[128,32,255],opacity:1,label:"hippocampal_fissure"},216:{color:[255,204,102],opacity:1,label:"entorhinal_cortex"},217:{color:[128,128,128],opacity:1,label:"molecular_layer_subiculum"},218:{color:[104,255,255],opacity:1,label:"Amygdala"},219:{color:[0,226,0],opacity:1,label:"Cerebral_White_Matter"},220:{color:[205,63,78],opacity:1,label:"Cerebral_Cortex"},221:{color:[197,58,250],opacity:1,label:"Inf_Lat_Vent"},222:{color:[33,150,250],opacity:1,label:"Perirhinal"},223:{color:[226,0,0],opacity:1,label:"Cerebral_White_Matter_Edge"},224:{color:[100,100,100],opacity:1,label:"Background"},225:{color:[197,150,250],opacity:1,label:"Ectorhinal"},226:{color:[170,170,255],opacity:1,label:"HP_tail"},250:{color:[255,0,0],opacity:1,label:"Fornix"},251:{color:[0,0,64],opacity:1,label:"CC_Posterior"},252:{color:[0,0,112],opacity:1,label:"CC_Mid_Posterior"},253:{color:[0,0,160],opacity:1,label:"CC_Central"},254:{color:[0,0,208],opacity:1,label:"CC_Mid_Anterior"},255:{color:[0,0,255],opacity:1,label:"CC_Anterior"},256:{color:[0,0,0],opacity:1,label:"Voxel-Unchanged"},257:{color:[60,60,60],opacity:1,label:"CSF-ExtraCerebral"},258:{color:[150,150,200],opacity:1,label:"Head-ExtraCerebral"},259:{color:[120,120,120],opacity:1,label:"SkullApprox"},260:{color:[119,159,176],opacity:1,label:"BoneOrAir"},261:{color:[120,18,134],opacity:1,label:"PossibleFluid"},262:{color:[119,159,176],opacity:1,label:"Sinus"},263:{color:[119,159,176],opacity:1,label:"Left-Eustachian"},264:{color:[119,159,176],opacity:1,label:"Right-Eustachian"},331:{color:[255,0,0],opacity:1,label:"Aorta"},332:{color:[255,80,0],opacity:1,label:"Left-Common-IliacA"},333:{color:[255,160,0],opacity:1,label:"Right-Common-IliacA"},334:{color:[255,255,0],opacity:1,label:"Left-External-IliacA"},335:{color:[0,255,0],opacity:1,label:"Right-External-IliacA"},336:{color:[255,0,160],opacity:1,label:"Left-Internal-IliacA"},337:{color:[255,0,255],opacity:1,label:"Right-Internal-IliacA"},338:{color:[255,50,80],opacity:1,label:"Left-Lateral-SacralA"},339:{color:[80,255,50],opacity:1,label:"Right-Lateral-SacralA"},340:{color:[160,255,50],opacity:1,label:"Left-ObturatorA"},341:{color:[160,200,255],opacity:1,label:"Right-ObturatorA"},342:{color:[0,255,160],opacity:1,label:"Left-Internal-PudendalA"},343:{color:[0,0,255],opacity:1,label:"Right-Internal-PudendalA"},344:{color:[80,50,255],opacity:1,label:"Left-UmbilicalA"},345:{color:[160,0,255],opacity:1,label:"Right-UmbilicalA"},346:{color:[255,210,0],opacity:1,label:"Left-Inf-RectalA"},347:{color:[0,160,255],opacity:1,label:"Right-Inf-RectalA"},348:{color:[255,200,80],opacity:1,label:"Left-Common-IliacV"},349:{color:[255,200,160],opacity:1,label:"Right-Common-IliacV"},350:{color:[255,80,200],opacity:1,label:"Left-External-IliacV"},351:{color:[255,160,200],opacity:1,label:"Right-External-IliacV"},352:{color:[30,255,80],opacity:1,label:"Left-Internal-IliacV"},353:{color:[80,200,255],opacity:1,label:"Right-Internal-IliacV"},354:{color:[80,255,200],opacity:1,label:"Left-ObturatorV"},355:{color:[195,255,200],opacity:1,label:"Right-ObturatorV"},356:{color:[120,200,20],opacity:1,label:"Left-Internal-PudendalV"},357:{color:[170,10,200],opacity:1,label:"Right-Internal-PudendalV"},358:{color:[20,130,180],opacity:1,label:"Pos-Lymph"},359:{color:[20,180,130],opacity:1,label:"Neg-Lymph"},400:{color:[206,62,78],opacity:1,label:"V1"},401:{color:[121,18,134],opacity:1,label:"V2"},402:{color:[199,58,250],opacity:1,label:"BA44"},403:{color:[1,148,0],opacity:1,label:"BA45"},404:{color:[221,248,164],opacity:1,label:"BA4a"},405:{color:[231,148,34],opacity:1,label:"BA4p"},406:{color:[1,118,14],opacity:1,label:"BA6"},407:{color:[120,118,14],opacity:1,label:"BA2"},408:{color:[123,186,221],opacity:1,label:"BA1_old"},409:{color:[238,13,177],opacity:1,label:"BAun2"},410:{color:[123,186,220],opacity:1,label:"BA1"},411:{color:[138,13,206],opacity:1,label:"BA2b"},412:{color:[238,130,176],opacity:1,label:"BA3a"},413:{color:[218,230,76],opacity:1,label:"BA3b"},414:{color:[38,213,176],opacity:1,label:"MT"},415:{color:[1,225,176],opacity:1,label:"AIPS_AIP_l"},416:{color:[1,225,176],opacity:1,label:"AIPS_AIP_r"},417:{color:[200,2,100],opacity:1,label:"AIPS_VIP_l"},418:{color:[200,2,100],opacity:1,label:"AIPS_VIP_r"},419:{color:[5,200,90],opacity:1,label:"IPL_PFcm_l"},420:{color:[5,200,90],opacity:1,label:"IPL_PFcm_r"},421:{color:[100,5,200],opacity:1,label:"IPL_PF_l"},422:{color:[25,255,100],opacity:1,label:"IPL_PFm_l"},423:{color:[25,255,100],opacity:1,label:"IPL_PFm_r"},424:{color:[230,7,100],opacity:1,label:"IPL_PFop_l"},425:{color:[230,7,100],opacity:1,label:"IPL_PFop_r"},426:{color:[100,5,200],opacity:1,label:"IPL_PF_r"},427:{color:[150,10,200],opacity:1,label:"IPL_PFt_l"},428:{color:[150,10,200],opacity:1,label:"IPL_PFt_r"},429:{color:[175,10,176],opacity:1,label:"IPL_PGa_l"},430:{color:[175,10,176],opacity:1,label:"IPL_PGa_r"},431:{color:[10,100,255],opacity:1,label:"IPL_PGp_l"},432:{color:[10,100,255],opacity:1,label:"IPL_PGp_r"},433:{color:[150,45,70],opacity:1,label:"Visual_V3d_l"},434:{color:[150,45,70],opacity:1,label:"Visual_V3d_r"},435:{color:[45,200,15],opacity:1,label:"Visual_V4_l"},436:{color:[45,200,15],opacity:1,label:"Visual_V4_r"},437:{color:[227,45,100],opacity:1,label:"Visual_V5_b"},438:{color:[227,45,100],opacity:1,label:"Visual_VP_l"},439:{color:[227,45,100],opacity:1,label:"Visual_VP_r"},498:{color:[143,188,143],opacity:1,label:"wmsa"},499:{color:[255,248,220],opacity:1,label:"other_wmsa"},500:{color:[17,85,136],opacity:1,label:"right_CA2_3"},501:{color:[119,187,102],opacity:1,label:"right_alveus"},502:{color:[204,68,34],opacity:1,label:"right_CA1"},503:{color:[204,0,255],opacity:1,label:"right_fimbria"},504:{color:[221,187,17],opacity:1,label:"right_presubiculum"},505:{color:[153,221,238],opacity:1,label:"right_hippocampal_fissure"},506:{color:[51,17,17],opacity:1,label:"right_CA4_DG"},507:{color:[0,119,85],opacity:1,label:"right_subiculum"},508:{color:[20,100,200],opacity:1,label:"right_fornix"},550:{color:[17,85,137],opacity:1,label:"left_CA2_3"},551:{color:[119,187,103],opacity:1,label:"left_alveus"},552:{color:[204,68,35],opacity:1,label:"left_CA1"},553:{color:[204,0,254],opacity:1,label:"left_fimbria"},554:{color:[221,187,16],opacity:1,label:"left_presubiculum"},555:{color:[153,221,239],opacity:1,label:"left_hippocampal_fissure"},556:{color:[51,17,18],opacity:1,label:"left_CA4_DG"},557:{color:[0,119,86],opacity:1,label:"left_subiculum"},558:{color:[20,100,201],opacity:1,label:"left_fornix"},600:{color:[254,254,254],opacity:1,label:"Tumor"},601:{color:[70,130,180],opacity:1,label:"Cbm_Left_I_IV"},602:{color:[245,245,245],opacity:1,label:"Cbm_Right_I_IV"},603:{color:[205,62,78],opacity:1,label:"Cbm_Left_V"},604:{color:[120,18,134],opacity:1,label:"Cbm_Right_V"},605:{color:[196,58,250],opacity:1,label:"Cbm_Left_VI"},606:{color:[0,148,0],opacity:1,label:"Cbm_Vermis_VI"},607:{color:[220,248,164],opacity:1,label:"Cbm_Right_VI"},608:{color:[230,148,34],opacity:1,label:"Cbm_Left_CrusI"},609:{color:[0,118,14],opacity:1,label:"Cbm_Vermis_CrusI"},610:{color:[0,118,14],opacity:1,label:"Cbm_Right_CrusI"},611:{color:[122,186,220],opacity:1,label:"Cbm_Left_CrusII"},612:{color:[236,13,176],opacity:1,label:"Cbm_Vermis_CrusII"},613:{color:[12,48,255],opacity:1,label:"Cbm_Right_CrusII"},614:{color:[204,182,142],opacity:1,label:"Cbm_Left_VIIb"},615:{color:[42,204,164],opacity:1,label:"Cbm_Vermis_VIIb"},616:{color:[119,159,176],opacity:1,label:"Cbm_Right_VIIb"},617:{color:[220,216,20],opacity:1,label:"Cbm_Left_VIIIa"},618:{color:[103,255,255],opacity:1,label:"Cbm_Vermis_VIIIa"},619:{color:[80,196,98],opacity:1,label:"Cbm_Right_VIIIa"},620:{color:[60,58,210],opacity:1,label:"Cbm_Left_VIIIb"},621:{color:[60,58,210],opacity:1,label:"Cbm_Vermis_VIIIb"},622:{color:[60,58,210],opacity:1,label:"Cbm_Right_VIIIb"},623:{color:[60,58,210],opacity:1,label:"Cbm_Left_IX"},624:{color:[60,60,60],opacity:1,label:"Cbm_Vermis_IX"},625:{color:[255,165,0],opacity:1,label:"Cbm_Right_IX"},626:{color:[255,165,0],opacity:1,label:"Cbm_Left_X"},627:{color:[0,255,127],opacity:1,label:"Cbm_Vermis_X"},628:{color:[165,42,42],opacity:1,label:"Cbm_Right_X"},640:{color:[204,0,0],opacity:1,label:"Cbm_Right_I_V_med"},641:{color:[255,0,0],opacity:1,label:"Cbm_Right_I_V_mid"},642:{color:[0,0,255],opacity:1,label:"Cbm_Right_VI_med"},643:{color:[30,144,255],opacity:1,label:"Cbm_Right_VI_mid"},644:{color:[100,212,237],opacity:1,label:"Cbm_Right_VI_lat"},645:{color:[218,165,32],opacity:1,label:"Cbm_Right_CrusI_med"},646:{color:[255,215,0],opacity:1,label:"Cbm_Right_CrusI_mid"},647:{color:[255,255,166],opacity:1,label:"Cbm_Right_CrusI_lat"},648:{color:[153,0,204],opacity:1,label:"Cbm_Right_CrusII_med"},649:{color:[153,141,209],opacity:1,label:"Cbm_Right_CrusII_mid"},650:{color:[204,204,255],opacity:1,label:"Cbm_Right_CrusII_lat"},651:{color:[31,212,194],opacity:1,label:"Cbm_Right_7med"},652:{color:[3,255,237],opacity:1,label:"Cbm_Right_7mid"},653:{color:[204,255,255],opacity:1,label:"Cbm_Right_7lat"},654:{color:[86,74,147],opacity:1,label:"Cbm_Right_8med"},655:{color:[114,114,190],opacity:1,label:"Cbm_Right_8mid"},656:{color:[184,178,255],opacity:1,label:"Cbm_Right_8lat"},657:{color:[126,138,37],opacity:1,label:"Cbm_Right_PUNs"},658:{color:[189,197,117],opacity:1,label:"Cbm_Right_TONs"},659:{color:[240,230,140],opacity:1,label:"Cbm_Right_FLOs"},660:{color:[204,0,0],opacity:1,label:"Cbm_Left_I_V_med"},661:{color:[255,0,0],opacity:1,label:"Cbm_Left_I_V_mid"},662:{color:[0,0,255],opacity:1,label:"Cbm_Left_VI_med"},663:{color:[30,144,255],opacity:1,label:"Cbm_Left_VI_mid"},664:{color:[100,212,237],opacity:1,label:"Cbm_Left_VI_lat"},665:{color:[218,165,32],opacity:1,label:"Cbm_Left_CrusI_med"},666:{color:[255,215,0],opacity:1,label:"Cbm_Left_CrusI_mid"},667:{color:[255,255,166],opacity:1,label:"Cbm_Left_CrusI_lat"},668:{color:[153,0,204],opacity:1,label:"Cbm_Left_CrusII_med"},669:{color:[153,141,209],opacity:1,label:"Cbm_Left_CrusII_mid"},670:{color:[204,204,255],opacity:1,label:"Cbm_Left_CrusII_lat"},671:{color:[31,212,194],opacity:1,label:"Cbm_Left_7med"},672:{color:[3,255,237],opacity:1,label:"Cbm_Left_7mid"},673:{color:[204,255,255],opacity:1,label:"Cbm_Left_7lat"},674:{color:[86,74,147],opacity:1,label:"Cbm_Left_8med"},675:{color:[114,114,190],opacity:1,label:"Cbm_Left_8mid"},676:{color:[184,178,255],opacity:1,label:"Cbm_Left_8lat"},677:{color:[126,138,37],opacity:1,label:"Cbm_Left_PUNs"},678:{color:[189,197,117],opacity:1,label:"Cbm_Left_TONs"},679:{color:[240,230,140],opacity:1,label:"Cbm_Left_FLOs"},690:{color:[122,135,50],opacity:1,label:"CbmWM_Gyri_Left"},691:{color:[122,135,50],opacity:1,label:"CbmWM_Gyri_Right"},701:{color:[120,18,134],opacity:1,label:"CSF-FSL-FAST"},702:{color:[205,62,78],opacity:1,label:"GrayMatter-FSL-FAST"},703:{color:[0,225,0],opacity:1,label:"WhiteMatter-FSL-FAST"},999:{color:[255,100,100],opacity:1,label:"SUSPICIOUS"},1e3:{color:[25,5,25],opacity:1,label:"ctx-lh-unknown"},1001:{color:[25,100,40],opacity:1,label:"ctx-lh-bankssts"},1002:{color:[125,100,160],opacity:1,label:"ctx-lh-caudalanteriorcingulate"},1003:{color:[100,25,0],opacity:1,label:"ctx-lh-caudalmiddlefrontal"},1004:{color:[120,70,50],opacity:1,label:"ctx-lh-corpuscallosum"},1005:{color:[220,20,100],opacity:1,label:"ctx-lh-cuneus"},1006:{color:[220,20,10],opacity:1,label:"ctx-lh-entorhinal"},1007:{color:[180,220,140],opacity:1,label:"ctx-lh-fusiform"},1008:{color:[220,60,220],opacity:1,label:"ctx-lh-inferiorparietal"},1009:{color:[180,40,120],opacity:1,label:"ctx-lh-inferiortemporal"},1010:{color:[140,20,140],opacity:1,label:"ctx-lh-isthmuscingulate"},1011:{color:[20,30,140],opacity:1,label:"ctx-lh-lateraloccipital"},1012:{color:[35,75,50],opacity:1,label:"ctx-lh-lateralorbitofrontal"},1013:{color:[225,140,140],opacity:1,label:"ctx-lh-lingual"},1014:{color:[200,35,75],opacity:1,label:"ctx-lh-medialorbitofrontal"},1015:{color:[160,100,50],opacity:1,label:"ctx-lh-middletemporal"},1016:{color:[20,220,60],opacity:1,label:"ctx-lh-parahippocampal"},1017:{color:[60,220,60],opacity:1,label:"ctx-lh-paracentral"},1018:{color:[220,180,140],opacity:1,label:"ctx-lh-parsopercularis"},1019:{color:[20,100,50],opacity:1,label:"ctx-lh-parsorbitalis"},1020:{color:[220,60,20],opacity:1,label:"ctx-lh-parstriangularis"},1021:{color:[120,100,60],opacity:1,label:"ctx-lh-pericalcarine"},1022:{color:[220,20,20],opacity:1,label:"ctx-lh-postcentral"},1023:{color:[220,180,220],opacity:1,label:"ctx-lh-posteriorcingulate"},1024:{color:[60,20,220],opacity:1,label:"ctx-lh-precentral"},1025:{color:[160,140,180],opacity:1,label:"ctx-lh-precuneus"},1026:{color:[80,20,140],opacity:1,label:"ctx-lh-rostralanteriorcingulate"},1027:{color:[75,50,125],opacity:1,label:"ctx-lh-rostralmiddlefrontal"},1028:{color:[20,220,160],opacity:1,label:"ctx-lh-superiorfrontal"},1029:{color:[20,180,140],opacity:1,label:"ctx-lh-superiorparietal"},1030:{color:[140,220,220],opacity:1,label:"ctx-lh-superiortemporal"},1031:{color:[80,160,20],opacity:1,label:"ctx-lh-supramarginal"},1032:{color:[100,0,100],opacity:1,label:"ctx-lh-frontalpole"},1033:{color:[70,70,70],opacity:1,label:"ctx-lh-temporalpole"},1034:{color:[150,150,200],opacity:1,label:"ctx-lh-transversetemporal"},1035:{color:[255,192,32],opacity:1,label:"ctx-lh-insula"},2e3:{color:[25,5,25],opacity:1,label:"ctx-rh-unknown"},2001:{color:[25,100,40],opacity:1,label:"ctx-rh-bankssts"},2002:{color:[125,100,160],opacity:1,label:"ctx-rh-caudalanteriorcingulate"},2003:{color:[100,25,0],opacity:1,label:"ctx-rh-caudalmiddlefrontal"},2004:{color:[120,70,50],opacity:1,label:"ctx-rh-corpuscallosum"},2005:{color:[220,20,100],opacity:1,label:"ctx-rh-cuneus"},2006:{color:[220,20,10],opacity:1,label:"ctx-rh-entorhinal"},2007:{color:[180,220,140],opacity:1,label:"ctx-rh-fusiform"},2008:{color:[220,60,220],opacity:1,label:"ctx-rh-inferiorparietal"},2009:{color:[180,40,120],opacity:1,label:"ctx-rh-inferiortemporal"},2010:{color:[140,20,140],opacity:1,label:"ctx-rh-isthmuscingulate"},2011:{color:[20,30,140],opacity:1,label:"ctx-rh-lateraloccipital"},2012:{color:[35,75,50],opacity:1,label:"ctx-rh-lateralorbitofrontal"},2013:{color:[225,140,140],opacity:1,label:"ctx-rh-lingual"},2014:{color:[200,35,75],opacity:1,label:"ctx-rh-medialorbitofrontal"},2015:{color:[160,100,50],opacity:1,label:"ctx-rh-middletemporal"},2016:{color:[20,220,60],opacity:1,label:"ctx-rh-parahippocampal"},2017:{color:[60,220,60],opacity:1,label:"ctx-rh-paracentral"},2018:{color:[220,180,140],opacity:1,label:"ctx-rh-parsopercularis"},2019:{color:[20,100,50],opacity:1,label:"ctx-rh-parsorbitalis"},2020:{color:[220,60,20],opacity:1,label:"ctx-rh-parstriangularis"},2021:{color:[120,100,60],opacity:1,label:"ctx-rh-pericalcarine"},2022:{color:[220,20,20],opacity:1,label:"ctx-rh-postcentral"},2023:{color:[220,180,220],opacity:1,label:"ctx-rh-posteriorcingulate"},2024:{color:[60,20,220],opacity:1,label:"ctx-rh-precentral"},2025:{color:[160,140,180],opacity:1,label:"ctx-rh-precuneus"},2026:{color:[80,20,140],opacity:1,label:"ctx-rh-rostralanteriorcingulate"},2027:{color:[75,50,125],opacity:1,label:"ctx-rh-rostralmiddlefrontal"},2028:{color:[20,220,160],opacity:1,label:"ctx-rh-superiorfrontal"},2029:{color:[20,180,140],opacity:1,label:"ctx-rh-superiorparietal"},2030:{color:[140,220,220],opacity:1,label:"ctx-rh-superiortemporal"},2031:{color:[80,160,20],opacity:1,label:"ctx-rh-supramarginal"},2032:{color:[100,0,100],opacity:1,label:"ctx-rh-frontalpole"},2033:{color:[70,70,70],opacity:1,label:"ctx-rh-temporalpole"},2034:{color:[150,150,200],opacity:1,label:"ctx-rh-transversetemporal"},2035:{color:[255,192,32],opacity:1,label:"ctx-rh-insula"},3e3:{color:[230,250,230],opacity:1,label:"wm-lh-unknown"},3001:{color:[230,155,215],opacity:1,label:"wm-lh-bankssts"},3002:{color:[130,155,95],opacity:1,label:"wm-lh-caudalanteriorcingulate"},3003:{color:[155,230,255],opacity:1,label:"wm-lh-caudalmiddlefrontal"},3004:{color:[135,185,205],opacity:1,label:"wm-lh-corpuscallosum"},3005:{color:[35,235,155],opacity:1,label:"wm-lh-cuneus"},3006:{color:[35,235,245],opacity:1,label:"wm-lh-entorhinal"},3007:{color:[75,35,115],opacity:1,label:"wm-lh-fusiform"},3008:{color:[35,195,35],opacity:1,label:"wm-lh-inferiorparietal"},3009:{color:[75,215,135],opacity:1,label:"wm-lh-inferiortemporal"},3010:{color:[115,235,115],opacity:1,label:"wm-lh-isthmuscingulate"},3011:{color:[235,225,115],opacity:1,label:"wm-lh-lateraloccipital"},3012:{color:[220,180,205],opacity:1,label:"wm-lh-lateralorbitofrontal"},3013:{color:[30,115,115],opacity:1,label:"wm-lh-lingual"},3014:{color:[55,220,180],opacity:1,label:"wm-lh-medialorbitofrontal"},3015:{color:[95,155,205],opacity:1,label:"wm-lh-middletemporal"},3016:{color:[235,35,195],opacity:1,label:"wm-lh-parahippocampal"},3017:{color:[195,35,195],opacity:1,label:"wm-lh-paracentral"},3018:{color:[35,75,115],opacity:1,label:"wm-lh-parsopercularis"},3019:{color:[235,155,205],opacity:1,label:"wm-lh-parsorbitalis"},3020:{color:[35,195,235],opacity:1,label:"wm-lh-parstriangularis"},3021:{color:[135,155,195],opacity:1,label:"wm-lh-pericalcarine"},3022:{color:[35,235,235],opacity:1,label:"wm-lh-postcentral"},3023:{color:[35,75,35],opacity:1,label:"wm-lh-posteriorcingulate"},3024:{color:[195,235,35],opacity:1,label:"wm-lh-precentral"},3025:{color:[95,115,75],opacity:1,label:"wm-lh-precuneus"},3026:{color:[175,235,115],opacity:1,label:"wm-lh-rostralanteriorcingulate"},3027:{color:[180,205,130],opacity:1,label:"wm-lh-rostralmiddlefrontal"},3028:{color:[235,35,95],opacity:1,label:"wm-lh-superiorfrontal"},3029:{color:[235,75,115],opacity:1,label:"wm-lh-superiorparietal"},3030:{color:[115,35,35],opacity:1,label:"wm-lh-superiortemporal"},3031:{color:[175,95,235],opacity:1,label:"wm-lh-supramarginal"},3032:{color:[155,255,155],opacity:1,label:"wm-lh-frontalpole"},3033:{color:[185,185,185],opacity:1,label:"wm-lh-temporalpole"},3034:{color:[105,105,55],opacity:1,label:"wm-lh-transversetemporal"},3035:{color:[20,220,160],opacity:1,label:"wm-lh-insula"},4e3:{color:[230,250,230],opacity:1,label:"wm-rh-unknown"},4001:{color:[230,155,215],opacity:1,label:"wm-rh-bankssts"},4002:{color:[130,155,95],opacity:1,label:"wm-rh-caudalanteriorcingulate"},4003:{color:[155,230,255],opacity:1,label:"wm-rh-caudalmiddlefrontal"},4004:{color:[135,185,205],opacity:1,label:"wm-rh-corpuscallosum"},4005:{color:[35,235,155],opacity:1,label:"wm-rh-cuneus"},4006:{color:[35,235,245],opacity:1,label:"wm-rh-entorhinal"},4007:{color:[75,35,115],opacity:1,label:"wm-rh-fusiform"},4008:{color:[35,195,35],opacity:1,label:"wm-rh-inferiorparietal"},4009:{color:[75,215,135],opacity:1,label:"wm-rh-inferiortemporal"},4010:{color:[115,235,115],opacity:1,label:"wm-rh-isthmuscingulate"},4011:{color:[235,225,115],opacity:1,label:"wm-rh-lateraloccipital"},4012:{color:[220,180,205],opacity:1,label:"wm-rh-lateralorbitofrontal"},4013:{color:[30,115,115],opacity:1,label:"wm-rh-lingual"},4014:{color:[55,220,180],opacity:1,label:"wm-rh-medialorbitofrontal"},4015:{color:[95,155,205],opacity:1,label:"wm-rh-middletemporal"},4016:{color:[235,35,195],opacity:1,label:"wm-rh-parahippocampal"},4017:{color:[195,35,195],opacity:1,label:"wm-rh-paracentral"},4018:{color:[35,75,115],opacity:1,label:"wm-rh-parsopercularis"},4019:{color:[235,155,205],opacity:1,label:"wm-rh-parsorbitalis"},4020:{color:[35,195,235],opacity:1,label:"wm-rh-parstriangularis"},4021:{color:[135,155,195],opacity:1,label:"wm-rh-pericalcarine"},4022:{color:[35,235,235],opacity:1,label:"wm-rh-postcentral"},4023:{color:[35,75,35],opacity:1,label:"wm-rh-posteriorcingulate"},4024:{color:[195,235,35],opacity:1,label:"wm-rh-precentral"},4025:{color:[95,115,75],opacity:1,label:"wm-rh-precuneus"},4026:{color:[175,235,115],opacity:1,label:"wm-rh-rostralanteriorcingulate"},4027:{color:[180,205,130],opacity:1,label:"wm-rh-rostralmiddlefrontal"},4028:{color:[235,35,95],opacity:1,label:"wm-rh-superiorfrontal"},4029:{color:[235,75,115],opacity:1,label:"wm-rh-superiorparietal"},4030:{color:[115,35,35],opacity:1,label:"wm-rh-superiortemporal"},4031:{color:[175,95,235],opacity:1,label:"wm-rh-supramarginal"},4032:{color:[155,255,155],opacity:1,label:"wm-rh-frontalpole"},4033:{color:[185,185,185],opacity:1,label:"wm-rh-temporalpole"},4034:{color:[105,105,55],opacity:1,label:"wm-rh-transversetemporal"},4035:{color:[20,220,160],opacity:1,label:"wm-rh-insula"},3201:{color:[235,35,95],opacity:1,label:"wm-lh-frontal-lobe"},3203:{color:[35,75,35],opacity:1,label:"wm-lh-cingulate-lobe"},3204:{color:[135,155,195],opacity:1,label:"wm-lh-occiptal-lobe"},3205:{color:[115,35,35],opacity:1,label:"wm-lh-temporal-lobe"},3206:{color:[35,195,35],opacity:1,label:"wm-lh-parietal-lobe"},3207:{color:[20,220,160],opacity:1,label:"wm-lh-insula-lobe"},4201:{color:[235,35,95],opacity:1,label:"wm-rh-frontal-lobe"},4203:{color:[35,75,35],opacity:1,label:"wm-rh-cingulate-lobe"},4204:{color:[135,155,195],opacity:1,label:"wm-rh-occiptal-lobe"},4205:{color:[115,35,35],opacity:1,label:"wm-rh-temporal-lobe"},4206:{color:[35,195,35],opacity:1,label:"wm-rh-parietal-lobe"},4207:{color:[20,220,160],opacity:1,label:"wm-rh-insula-lobe"},1100:{color:[0,0,0],opacity:1,label:"ctx-lh-Unknown"},1101:{color:[50,50,50],opacity:1,label:"ctx-lh-Corpus_callosum"},1102:{color:[180,20,30],opacity:1,label:"ctx-lh-G_and_S_Insula_ONLY_AVERAGE"},1103:{color:[60,25,25],opacity:1,label:"ctx-lh-G_cingulate-Isthmus"},1104:{color:[25,60,60],opacity:1,label:"ctx-lh-G_cingulate-Main_part"},1200:{color:[25,60,61],opacity:1,label:"ctx-lh-G_cingulate-caudal_ACC"},1201:{color:[25,90,60],opacity:1,label:"ctx-lh-G_cingulate-rostral_ACC"},1202:{color:[25,120,60],opacity:1,label:"ctx-lh-G_cingulate-posterior"},1205:{color:[25,150,60],opacity:1,label:"ctx-lh-S_cingulate-caudal_ACC"},1206:{color:[25,180,60],opacity:1,label:"ctx-lh-S_cingulate-rostral_ACC"},1207:{color:[25,210,60],opacity:1,label:"ctx-lh-S_cingulate-posterior"},1210:{color:[25,150,90],opacity:1,label:"ctx-lh-S_pericallosal-caudal"},1211:{color:[25,180,90],opacity:1,label:"ctx-lh-S_pericallosal-rostral"},1212:{color:[25,210,90],opacity:1,label:"ctx-lh-S_pericallosal-posterior"},1105:{color:[180,20,20],opacity:1,label:"ctx-lh-G_cuneus"},1106:{color:[220,20,100],opacity:1,label:"ctx-lh-G_frontal_inf-Opercular_part"},1107:{color:[140,60,60],opacity:1,label:"ctx-lh-G_frontal_inf-Orbital_part"},1108:{color:[180,220,140],opacity:1,label:"ctx-lh-G_frontal_inf-Triangular_part"},1109:{color:[140,100,180],opacity:1,label:"ctx-lh-G_frontal_middle"},1110:{color:[180,20,140],opacity:1,label:"ctx-lh-G_frontal_superior"},1111:{color:[140,20,140],opacity:1,label:"ctx-lh-G_frontomarginal"},1112:{color:[21,10,10],opacity:1,label:"ctx-lh-G_insular_long"},1113:{color:[225,140,140],opacity:1,label:"ctx-lh-G_insular_short"},1114:{color:[23,60,180],opacity:1,label:"ctx-lh-G_and_S_occipital_inferior"},1115:{color:[180,60,180],opacity:1,label:"ctx-lh-G_occipital_middle"},1116:{color:[20,220,60],opacity:1,label:"ctx-lh-G_occipital_superior"},1117:{color:[60,20,140],opacity:1,label:"ctx-lh-G_occipit-temp_lat-Or_fusiform"},1118:{color:[220,180,140],opacity:1,label:"ctx-lh-G_occipit-temp_med-Lingual_part"},1119:{color:[65,100,20],opacity:1,label:"ctx-lh-G_occipit-temp_med-Parahippocampal_part"},1120:{color:[220,60,20],opacity:1,label:"ctx-lh-G_orbital"},1121:{color:[60,100,60],opacity:1,label:"ctx-lh-G_paracentral"},1122:{color:[20,60,220],opacity:1,label:"ctx-lh-G_parietal_inferior-Angular_part"},1123:{color:[100,100,60],opacity:1,label:"ctx-lh-G_parietal_inferior-Supramarginal_part"},1124:{color:[220,180,220],opacity:1,label:"ctx-lh-G_parietal_superior"},1125:{color:[20,180,140],opacity:1,label:"ctx-lh-G_postcentral"},1126:{color:[60,140,180],opacity:1,label:"ctx-lh-G_precentral"},1127:{color:[25,20,140],opacity:1,label:"ctx-lh-G_precuneus"},1128:{color:[20,60,100],opacity:1,label:"ctx-lh-G_rectus"},1129:{color:[60,220,20],opacity:1,label:"ctx-lh-G_subcallosal"},1130:{color:[60,20,220],opacity:1,label:"ctx-lh-G_subcentral"},1131:{color:[220,220,100],opacity:1,label:"ctx-lh-G_temporal_inferior"},1132:{color:[180,60,60],opacity:1,label:"ctx-lh-G_temporal_middle"},1133:{color:[60,60,220],opacity:1,label:"ctx-lh-G_temp_sup-G_temp_transv_and_interm_S"},1134:{color:[220,60,220],opacity:1,label:"ctx-lh-G_temp_sup-Lateral_aspect"},1135:{color:[65,220,60],opacity:1,label:"ctx-lh-G_temp_sup-Planum_polare"},1136:{color:[25,140,20],opacity:1,label:"ctx-lh-G_temp_sup-Planum_tempolare"},1137:{color:[13,0,250],opacity:1,label:"ctx-lh-G_and_S_transverse_frontopolar"},1138:{color:[61,20,220],opacity:1,label:"ctx-lh-Lat_Fissure-ant_sgt-ramus_horizontal"},1139:{color:[61,20,60],opacity:1,label:"ctx-lh-Lat_Fissure-ant_sgt-ramus_vertical"},1140:{color:[61,60,100],opacity:1,label:"ctx-lh-Lat_Fissure-post_sgt"},1141:{color:[25,25,25],opacity:1,label:"ctx-lh-Medial_wall"},1142:{color:[140,20,60],opacity:1,label:"ctx-lh-Pole_occipital"},1143:{color:[220,180,20],opacity:1,label:"ctx-lh-Pole_temporal"},1144:{color:[63,180,180],opacity:1,label:"ctx-lh-S_calcarine"},1145:{color:[221,20,10],opacity:1,label:"ctx-lh-S_central"},1146:{color:[21,220,20],opacity:1,label:"ctx-lh-S_central_insula"},1147:{color:[183,100,20],opacity:1,label:"ctx-lh-S_cingulate-Main_part_and_Intracingulate"},1148:{color:[221,20,100],opacity:1,label:"ctx-lh-S_cingulate-Marginalis_part"},1149:{color:[221,60,140],opacity:1,label:"ctx-lh-S_circular_insula_anterior"},1150:{color:[221,20,220],opacity:1,label:"ctx-lh-S_circular_insula_inferior"},1151:{color:[61,220,220],opacity:1,label:"ctx-lh-S_circular_insula_superior"},1152:{color:[100,200,200],opacity:1,label:"ctx-lh-S_collateral_transverse_ant"},1153:{color:[10,200,200],opacity:1,label:"ctx-lh-S_collateral_transverse_post"},1154:{color:[221,220,20],opacity:1,label:"ctx-lh-S_frontal_inferior"},1155:{color:[141,20,100],opacity:1,label:"ctx-lh-S_frontal_middle"},1156:{color:[61,220,100],opacity:1,label:"ctx-lh-S_frontal_superior"},1157:{color:[21,220,60],opacity:1,label:"ctx-lh-S_frontomarginal"},1158:{color:[141,60,20],opacity:1,label:"ctx-lh-S_intermedius_primus-Jensen"},1159:{color:[143,20,220],opacity:1,label:"ctx-lh-S_intraparietal-and_Parietal_transverse"},1160:{color:[61,20,180],opacity:1,label:"ctx-lh-S_occipital_anterior"},1161:{color:[101,60,220],opacity:1,label:"ctx-lh-S_occipital_middle_and_Lunatus"},1162:{color:[21,20,140],opacity:1,label:"ctx-lh-S_occipital_superior_and_transversalis"},1163:{color:[221,140,20],opacity:1,label:"ctx-lh-S_occipito-temporal_lateral"},1164:{color:[141,100,220],opacity:1,label:"ctx-lh-S_occipito-temporal_medial_and_S_Lingual"},1165:{color:[101,20,20],opacity:1,label:"ctx-lh-S_orbital-H_shapped"},1166:{color:[221,100,20],opacity:1,label:"ctx-lh-S_orbital_lateral"},1167:{color:[181,200,20],opacity:1,label:"ctx-lh-S_orbital_medial-Or_olfactory"},1168:{color:[21,180,140],opacity:1,label:"ctx-lh-S_paracentral"},1169:{color:[101,100,180],opacity:1,label:"ctx-lh-S_parieto_occipital"},1170:{color:[181,220,20],opacity:1,label:"ctx-lh-S_pericallosal"},1171:{color:[21,140,200],opacity:1,label:"ctx-lh-S_postcentral"},1172:{color:[21,20,240],opacity:1,label:"ctx-lh-S_precentral-Inferior-part"},1173:{color:[21,20,200],opacity:1,label:"ctx-lh-S_precentral-Superior-part"},1174:{color:[61,180,60],opacity:1,label:"ctx-lh-S_subcentral_ant"},1175:{color:[61,180,250],opacity:1,label:"ctx-lh-S_subcentral_post"},1176:{color:[21,20,60],opacity:1,label:"ctx-lh-S_suborbital"},1177:{color:[101,60,60],opacity:1,label:"ctx-lh-S_subparietal"},1178:{color:[21,220,220],opacity:1,label:"ctx-lh-S_supracingulate"},1179:{color:[21,180,180],opacity:1,label:"ctx-lh-S_temporal_inferior"},1180:{color:[223,220,60],opacity:1,label:"ctx-lh-S_temporal_superior"},1181:{color:[221,60,60],opacity:1,label:"ctx-lh-S_temporal_transverse"},2100:{color:[0,0,0],opacity:1,label:"ctx-rh-Unknown"},2101:{color:[50,50,50],opacity:1,label:"ctx-rh-Corpus_callosum"},2102:{color:[180,20,30],opacity:1,label:"ctx-rh-G_and_S_Insula_ONLY_AVERAGE"},2103:{color:[60,25,25],opacity:1,label:"ctx-rh-G_cingulate-Isthmus"},2104:{color:[25,60,60],opacity:1,label:"ctx-rh-G_cingulate-Main_part"},2105:{color:[180,20,20],opacity:1,label:"ctx-rh-G_cuneus"},2106:{color:[220,20,100],opacity:1,label:"ctx-rh-G_frontal_inf-Opercular_part"},2107:{color:[140,60,60],opacity:1,label:"ctx-rh-G_frontal_inf-Orbital_part"},2108:{color:[180,220,140],opacity:1,label:"ctx-rh-G_frontal_inf-Triangular_part"},2109:{color:[140,100,180],opacity:1,label:"ctx-rh-G_frontal_middle"},2110:{color:[180,20,140],opacity:1,label:"ctx-rh-G_frontal_superior"},2111:{color:[140,20,140],opacity:1,label:"ctx-rh-G_frontomarginal"},2112:{color:[21,10,10],opacity:1,label:"ctx-rh-G_insular_long"},2113:{color:[225,140,140],opacity:1,label:"ctx-rh-G_insular_short"},2114:{color:[23,60,180],opacity:1,label:"ctx-rh-G_and_S_occipital_inferior"},2115:{color:[180,60,180],opacity:1,label:"ctx-rh-G_occipital_middle"},2116:{color:[20,220,60],opacity:1,label:"ctx-rh-G_occipital_superior"},2117:{color:[60,20,140],opacity:1,label:"ctx-rh-G_occipit-temp_lat-Or_fusiform"},2118:{color:[220,180,140],opacity:1,label:"ctx-rh-G_occipit-temp_med-Lingual_part"},2119:{color:[65,100,20],opacity:1,label:"ctx-rh-G_occipit-temp_med-Parahippocampal_part"},2120:{color:[220,60,20],opacity:1,label:"ctx-rh-G_orbital"},2121:{color:[60,100,60],opacity:1,label:"ctx-rh-G_paracentral"},2122:{color:[20,60,220],opacity:1,label:"ctx-rh-G_parietal_inferior-Angular_part"},2123:{color:[100,100,60],opacity:1,label:"ctx-rh-G_parietal_inferior-Supramarginal_part"},2124:{color:[220,180,220],opacity:1,label:"ctx-rh-G_parietal_superior"},2125:{color:[20,180,140],opacity:1,label:"ctx-rh-G_postcentral"},2126:{color:[60,140,180],opacity:1,label:"ctx-rh-G_precentral"},2127:{color:[25,20,140],opacity:1,label:"ctx-rh-G_precuneus"},2128:{color:[20,60,100],opacity:1,label:"ctx-rh-G_rectus"},2129:{color:[60,220,20],opacity:1,label:"ctx-rh-G_subcallosal"},2130:{color:[60,20,220],opacity:1,label:"ctx-rh-G_subcentral"},2131:{color:[220,220,100],opacity:1,label:"ctx-rh-G_temporal_inferior"},2132:{color:[180,60,60],opacity:1,label:"ctx-rh-G_temporal_middle"},2133:{color:[60,60,220],opacity:1,label:"ctx-rh-G_temp_sup-G_temp_transv_and_interm_S"},2134:{color:[220,60,220],opacity:1,label:"ctx-rh-G_temp_sup-Lateral_aspect"},2135:{color:[65,220,60],opacity:1,label:"ctx-rh-G_temp_sup-Planum_polare"},2136:{color:[25,140,20],opacity:1,label:"ctx-rh-G_temp_sup-Planum_tempolare"},2137:{color:[13,0,250],opacity:1,label:"ctx-rh-G_and_S_transverse_frontopolar"},2138:{color:[61,20,220],opacity:1,label:"ctx-rh-Lat_Fissure-ant_sgt-ramus_horizontal"},2139:{color:[61,20,60],opacity:1,label:"ctx-rh-Lat_Fissure-ant_sgt-ramus_vertical"},2140:{color:[61,60,100],opacity:1,label:"ctx-rh-Lat_Fissure-post_sgt"},2141:{color:[25,25,25],opacity:1,label:"ctx-rh-Medial_wall"},2142:{color:[140,20,60],opacity:1,label:"ctx-rh-Pole_occipital"},2143:{color:[220,180,20],opacity:1,label:"ctx-rh-Pole_temporal"},2144:{color:[63,180,180],opacity:1,label:"ctx-rh-S_calcarine"},2145:{color:[221,20,10],opacity:1,label:"ctx-rh-S_central"},2146:{color:[21,220,20],opacity:1,label:"ctx-rh-S_central_insula"},2147:{color:[183,100,20],opacity:1,label:"ctx-rh-S_cingulate-Main_part_and_Intracingulate"},2148:{color:[221,20,100],opacity:1,label:"ctx-rh-S_cingulate-Marginalis_part"},2149:{color:[221,60,140],opacity:1,label:"ctx-rh-S_circular_insula_anterior"},2150:{color:[221,20,220],opacity:1,label:"ctx-rh-S_circular_insula_inferior"},2151:{color:[61,220,220],opacity:1,label:"ctx-rh-S_circular_insula_superior"},2152:{color:[100,200,200],opacity:1,label:"ctx-rh-S_collateral_transverse_ant"},2153:{color:[10,200,200],opacity:1,label:"ctx-rh-S_collateral_transverse_post"},2154:{color:[221,220,20],opacity:1,label:"ctx-rh-S_frontal_inferior"},2155:{color:[141,20,100],opacity:1,label:"ctx-rh-S_frontal_middle"},2156:{color:[61,220,100],opacity:1,label:"ctx-rh-S_frontal_superior"},2157:{color:[21,220,60],opacity:1,label:"ctx-rh-S_frontomarginal"},2158:{color:[141,60,20],opacity:1,label:"ctx-rh-S_intermedius_primus-Jensen"},2159:{color:[143,20,220],opacity:1,label:"ctx-rh-S_intraparietal-and_Parietal_transverse"},2160:{color:[61,20,180],opacity:1,label:"ctx-rh-S_occipital_anterior"},2161:{color:[101,60,220],opacity:1,label:"ctx-rh-S_occipital_middle_and_Lunatus"},2162:{color:[21,20,140],opacity:1,label:"ctx-rh-S_occipital_superior_and_transversalis"},2163:{color:[221,140,20],opacity:1,label:"ctx-rh-S_occipito-temporal_lateral"},2164:{color:[141,100,220],opacity:1,label:"ctx-rh-S_occipito-temporal_medial_and_S_Lingual"},2165:{color:[101,20,20],opacity:1,label:"ctx-rh-S_orbital-H_shapped"},2166:{color:[221,100,20],opacity:1,label:"ctx-rh-S_orbital_lateral"},2167:{color:[181,200,20],opacity:1,label:"ctx-rh-S_orbital_medial-Or_olfactory"},2168:{color:[21,180,140],opacity:1,label:"ctx-rh-S_paracentral"},2169:{color:[101,100,180],opacity:1,label:"ctx-rh-S_parieto_occipital"},2170:{color:[181,220,20],opacity:1,label:"ctx-rh-S_pericallosal"},2171:{color:[21,140,200],opacity:1,label:"ctx-rh-S_postcentral"},2172:{color:[21,20,240],opacity:1,label:"ctx-rh-S_precentral-Inferior-part"},2173:{color:[21,20,200],opacity:1,label:"ctx-rh-S_precentral-Superior-part"},2174:{color:[61,180,60],opacity:1,label:"ctx-rh-S_subcentral_ant"},2175:{color:[61,180,250],opacity:1,label:"ctx-rh-S_subcentral_post"},2176:{color:[21,20,60],opacity:1,label:"ctx-rh-S_suborbital"},2177:{color:[101,60,60],opacity:1,label:"ctx-rh-S_subparietal"},2178:{color:[21,220,220],opacity:1,label:"ctx-rh-S_supracingulate"},2179:{color:[21,180,180],opacity:1,label:"ctx-rh-S_temporal_inferior"},2180:{color:[223,220,60],opacity:1,label:"ctx-rh-S_temporal_superior"},2181:{color:[221,60,60],opacity:1,label:"ctx-rh-S_temporal_transverse"},2200:{color:[25,60,61],opacity:1,label:"ctx-rh-G_cingulate-caudal_ACC"},2201:{color:[25,90,60],opacity:1,label:"ctx-rh-G_cingulate-rostral_ACC"},2202:{color:[25,120,60],opacity:1,label:"ctx-rh-G_cingulate-posterior"},2205:{color:[25,150,60],opacity:1,label:"ctx-rh-S_cingulate-caudal_ACC"},2206:{color:[25,180,60],opacity:1,label:"ctx-rh-S_cingulate-rostral_ACC"},2207:{color:[25,210,60],opacity:1,label:"ctx-rh-S_cingulate-posterior"},2210:{color:[25,150,90],opacity:1,label:"ctx-rh-S_pericallosal-caudal"},2211:{color:[25,180,90],opacity:1,label:"ctx-rh-S_pericallosal-rostral"},2212:{color:[25,210,90],opacity:1,label:"ctx-rh-S_pericallosal-posterior"},3100:{color:[0,0,0],opacity:1,label:"wm-lh-Unknown"},3101:{color:[50,50,50],opacity:1,label:"wm-lh-Corpus_callosum"},3102:{color:[180,20,30],opacity:1,label:"wm-lh-G_and_S_Insula_ONLY_AVERAGE"},3103:{color:[60,25,25],opacity:1,label:"wm-lh-G_cingulate-Isthmus"},3104:{color:[25,60,60],opacity:1,label:"wm-lh-G_cingulate-Main_part"},3105:{color:[180,20,20],opacity:1,label:"wm-lh-G_cuneus"},3106:{color:[220,20,100],opacity:1,label:"wm-lh-G_frontal_inf-Opercular_part"},3107:{color:[140,60,60],opacity:1,label:"wm-lh-G_frontal_inf-Orbital_part"},3108:{color:[180,220,140],opacity:1,label:"wm-lh-G_frontal_inf-Triangular_part"},3109:{color:[140,100,180],opacity:1,label:"wm-lh-G_frontal_middle"},3110:{color:[180,20,140],opacity:1,label:"wm-lh-G_frontal_superior"},3111:{color:[140,20,140],opacity:1,label:"wm-lh-G_frontomarginal"},3112:{color:[21,10,10],opacity:1,label:"wm-lh-G_insular_long"},3113:{color:[225,140,140],opacity:1,label:"wm-lh-G_insular_short"},3114:{color:[23,60,180],opacity:1,label:"wm-lh-G_and_S_occipital_inferior"},3115:{color:[180,60,180],opacity:1,label:"wm-lh-G_occipital_middle"},3116:{color:[20,220,60],opacity:1,label:"wm-lh-G_occipital_superior"},3117:{color:[60,20,140],opacity:1,label:"wm-lh-G_occipit-temp_lat-Or_fusiform"},3118:{color:[220,180,140],opacity:1,label:"wm-lh-G_occipit-temp_med-Lingual_part"},3119:{color:[65,100,20],opacity:1,label:"wm-lh-G_occipit-temp_med-Parahippocampal_part"},3120:{color:[220,60,20],opacity:1,label:"wm-lh-G_orbital"},3121:{color:[60,100,60],opacity:1,label:"wm-lh-G_paracentral"},3122:{color:[20,60,220],opacity:1,label:"wm-lh-G_parietal_inferior-Angular_part"},3123:{color:[100,100,60],opacity:1,label:"wm-lh-G_parietal_inferior-Supramarginal_part"},3124:{color:[220,180,220],opacity:1,label:"wm-lh-G_parietal_superior"},3125:{color:[20,180,140],opacity:1,label:"wm-lh-G_postcentral"},3126:{color:[60,140,180],opacity:1,label:"wm-lh-G_precentral"},3127:{color:[25,20,140],opacity:1,label:"wm-lh-G_precuneus"},3128:{color:[20,60,100],opacity:1,label:"wm-lh-G_rectus"},3129:{color:[60,220,20],opacity:1,label:"wm-lh-G_subcallosal"},3130:{color:[60,20,220],opacity:1,label:"wm-lh-G_subcentral"},3131:{color:[220,220,100],opacity:1,label:"wm-lh-G_temporal_inferior"},3132:{color:[180,60,60],opacity:1,label:"wm-lh-G_temporal_middle"},3133:{color:[60,60,220],opacity:1,label:"wm-lh-G_temp_sup-G_temp_transv_and_interm_S"},3134:{color:[220,60,220],opacity:1,label:"wm-lh-G_temp_sup-Lateral_aspect"},3135:{color:[65,220,60],opacity:1,label:"wm-lh-G_temp_sup-Planum_polare"},3136:{color:[25,140,20],opacity:1,label:"wm-lh-G_temp_sup-Planum_tempolare"},3137:{color:[13,0,250],opacity:1,label:"wm-lh-G_and_S_transverse_frontopolar"},3138:{color:[61,20,220],opacity:1,label:"wm-lh-Lat_Fissure-ant_sgt-ramus_horizontal"},3139:{color:[61,20,60],opacity:1,label:"wm-lh-Lat_Fissure-ant_sgt-ramus_vertical"},3140:{color:[61,60,100],opacity:1,label:"wm-lh-Lat_Fissure-post_sgt"},3141:{color:[25,25,25],opacity:1,label:"wm-lh-Medial_wall"},3142:{color:[140,20,60],opacity:1,label:"wm-lh-Pole_occipital"},3143:{color:[220,180,20],opacity:1,label:"wm-lh-Pole_temporal"},3144:{color:[63,180,180],opacity:1,label:"wm-lh-S_calcarine"},3145:{color:[221,20,10],opacity:1,label:"wm-lh-S_central"},3146:{color:[21,220,20],opacity:1,label:"wm-lh-S_central_insula"},3147:{color:[183,100,20],opacity:1,label:"wm-lh-S_cingulate-Main_part_and_Intracingulate"},3148:{color:[221,20,100],opacity:1,label:"wm-lh-S_cingulate-Marginalis_part"},3149:{color:[221,60,140],opacity:1,label:"wm-lh-S_circular_insula_anterior"},3150:{color:[221,20,220],opacity:1,label:"wm-lh-S_circular_insula_inferior"},3151:{color:[61,220,220],opacity:1,label:"wm-lh-S_circular_insula_superior"},3152:{color:[100,200,200],opacity:1,label:"wm-lh-S_collateral_transverse_ant"},3153:{color:[10,200,200],opacity:1,label:"wm-lh-S_collateral_transverse_post"},3154:{color:[221,220,20],opacity:1,label:"wm-lh-S_frontal_inferior"},3155:{color:[141,20,100],opacity:1,label:"wm-lh-S_frontal_middle"},3156:{color:[61,220,100],opacity:1,label:"wm-lh-S_frontal_superior"},3157:{color:[21,220,60],opacity:1,label:"wm-lh-S_frontomarginal"},3158:{color:[141,60,20],opacity:1,label:"wm-lh-S_intermedius_primus-Jensen"},3159:{color:[143,20,220],opacity:1,label:"wm-lh-S_intraparietal-and_Parietal_transverse"},3160:{color:[61,20,180],opacity:1,label:"wm-lh-S_occipital_anterior"},3161:{color:[101,60,220],opacity:1,label:"wm-lh-S_occipital_middle_and_Lunatus"},3162:{color:[21,20,140],opacity:1,label:"wm-lh-S_occipital_superior_and_transversalis"},3163:{color:[221,140,20],opacity:1,label:"wm-lh-S_occipito-temporal_lateral"},3164:{color:[141,100,220],opacity:1,label:"wm-lh-S_occipito-temporal_medial_and_S_Lingual"},3165:{color:[101,20,20],opacity:1,label:"wm-lh-S_orbital-H_shapped"},3166:{color:[221,100,20],opacity:1,label:"wm-lh-S_orbital_lateral"},3167:{color:[181,200,20],opacity:1,label:"wm-lh-S_orbital_medial-Or_olfactory"},3168:{color:[21,180,140],opacity:1,label:"wm-lh-S_paracentral"},3169:{color:[101,100,180],opacity:1,label:"wm-lh-S_parieto_occipital"},3170:{color:[181,220,20],opacity:1,label:"wm-lh-S_pericallosal"},3171:{color:[21,140,200],opacity:1,label:"wm-lh-S_postcentral"},3172:{color:[21,20,240],opacity:1,label:"wm-lh-S_precentral-Inferior-part"},3173:{color:[21,20,200],opacity:1,label:"wm-lh-S_precentral-Superior-part"},3174:{color:[61,180,60],opacity:1,label:"wm-lh-S_subcentral_ant"},3175:{color:[61,180,250],opacity:1,label:"wm-lh-S_subcentral_post"},3176:{color:[21,20,60],opacity:1,label:"wm-lh-S_suborbital"},3177:{color:[101,60,60],opacity:1,label:"wm-lh-S_subparietal"},3178:{color:[21,220,220],opacity:1,label:"wm-lh-S_supracingulate"},3179:{color:[21,180,180],opacity:1,label:"wm-lh-S_temporal_inferior"},3180:{color:[223,220,60],opacity:1,label:"wm-lh-S_temporal_superior"},3181:{color:[221,60,60],opacity:1,label:"wm-lh-S_temporal_transverse"},4100:{color:[0,0,0],opacity:1,label:"wm-rh-Unknown"},4101:{color:[50,50,50],opacity:1,label:"wm-rh-Corpus_callosum"},4102:{color:[180,20,30],opacity:1,label:"wm-rh-G_and_S_Insula_ONLY_AVERAGE"},4103:{color:[60,25,25],opacity:1,label:"wm-rh-G_cingulate-Isthmus"},4104:{color:[25,60,60],opacity:1,label:"wm-rh-G_cingulate-Main_part"},4105:{color:[180,20,20],opacity:1,label:"wm-rh-G_cuneus"},4106:{color:[220,20,100],opacity:1,label:"wm-rh-G_frontal_inf-Opercular_part"},4107:{color:[140,60,60],opacity:1,label:"wm-rh-G_frontal_inf-Orbital_part"},4108:{color:[180,220,140],opacity:1,label:"wm-rh-G_frontal_inf-Triangular_part"},4109:{color:[140,100,180],opacity:1,label:"wm-rh-G_frontal_middle"},4110:{color:[180,20,140],opacity:1,label:"wm-rh-G_frontal_superior"},4111:{color:[140,20,140],opacity:1,label:"wm-rh-G_frontomarginal"},4112:{color:[21,10,10],opacity:1,label:"wm-rh-G_insular_long"},4113:{color:[225,140,140],opacity:1,label:"wm-rh-G_insular_short"},4114:{color:[23,60,180],opacity:1,label:"wm-rh-G_and_S_occipital_inferior"},4115:{color:[180,60,180],opacity:1,label:"wm-rh-G_occipital_middle"},4116:{color:[20,220,60],opacity:1,label:"wm-rh-G_occipital_superior"},4117:{color:[60,20,140],opacity:1,label:"wm-rh-G_occipit-temp_lat-Or_fusiform"},4118:{color:[220,180,140],opacity:1,label:"wm-rh-G_occipit-temp_med-Lingual_part"},4119:{color:[65,100,20],opacity:1,label:"wm-rh-G_occipit-temp_med-Parahippocampal_part"},4120:{color:[220,60,20],opacity:1,label:"wm-rh-G_orbital"},4121:{color:[60,100,60],opacity:1,label:"wm-rh-G_paracentral"},4122:{color:[20,60,220],opacity:1,label:"wm-rh-G_parietal_inferior-Angular_part"},4123:{color:[100,100,60],opacity:1,label:"wm-rh-G_parietal_inferior-Supramarginal_part"},4124:{color:[220,180,220],opacity:1,label:"wm-rh-G_parietal_superior"},4125:{color:[20,180,140],opacity:1,label:"wm-rh-G_postcentral"},4126:{color:[60,140,180],opacity:1,label:"wm-rh-G_precentral"},4127:{color:[25,20,140],opacity:1,label:"wm-rh-G_precuneus"},4128:{color:[20,60,100],opacity:1,label:"wm-rh-G_rectus"},4129:{color:[60,220,20],opacity:1,label:"wm-rh-G_subcallosal"},4130:{color:[60,20,220],opacity:1,label:"wm-rh-G_subcentral"},4131:{color:[220,220,100],opacity:1,label:"wm-rh-G_temporal_inferior"},4132:{color:[180,60,60],opacity:1,label:"wm-rh-G_temporal_middle"},4133:{color:[60,60,220],opacity:1,label:"wm-rh-G_temp_sup-G_temp_transv_and_interm_S"},4134:{color:[220,60,220],opacity:1,label:"wm-rh-G_temp_sup-Lateral_aspect"},4135:{color:[65,220,60],opacity:1,label:"wm-rh-G_temp_sup-Planum_polare"},4136:{color:[25,140,20],opacity:1,label:"wm-rh-G_temp_sup-Planum_tempolare"},4137:{color:[13,0,250],opacity:1,label:"wm-rh-G_and_S_transverse_frontopolar"},4138:{color:[61,20,220],opacity:1,label:"wm-rh-Lat_Fissure-ant_sgt-ramus_horizontal"},4139:{color:[61,20,60],opacity:1,label:"wm-rh-Lat_Fissure-ant_sgt-ramus_vertical"},4140:{color:[61,60,100],opacity:1,label:"wm-rh-Lat_Fissure-post_sgt"},4141:{color:[25,25,25],opacity:1,label:"wm-rh-Medial_wall"},4142:{color:[140,20,60],opacity:1,label:"wm-rh-Pole_occipital"},4143:{color:[220,180,20],opacity:1,label:"wm-rh-Pole_temporal"},4144:{color:[63,180,180],opacity:1,label:"wm-rh-S_calcarine"},4145:{color:[221,20,10],opacity:1,label:"wm-rh-S_central"},4146:{color:[21,220,20],opacity:1,label:"wm-rh-S_central_insula"},4147:{color:[183,100,20],opacity:1,label:"wm-rh-S_cingulate-Main_part_and_Intracingulate"},4148:{color:[221,20,100],opacity:1,label:"wm-rh-S_cingulate-Marginalis_part"},4149:{color:[221,60,140],opacity:1,label:"wm-rh-S_circular_insula_anterior"},4150:{color:[221,20,220],opacity:1,label:"wm-rh-S_circular_insula_inferior"},4151:{color:[61,220,220],opacity:1,label:"wm-rh-S_circular_insula_superior"},4152:{color:[100,200,200],opacity:1,label:"wm-rh-S_collateral_transverse_ant"},4153:{color:[10,200,200],opacity:1,label:"wm-rh-S_collateral_transverse_post"},4154:{color:[221,220,20],opacity:1,label:"wm-rh-S_frontal_inferior"},4155:{color:[141,20,100],opacity:1,label:"wm-rh-S_frontal_middle"},4156:{color:[61,220,100],opacity:1,label:"wm-rh-S_frontal_superior"},4157:{color:[21,220,60],opacity:1,label:"wm-rh-S_frontomarginal"},4158:{color:[141,60,20],opacity:1,label:"wm-rh-S_intermedius_primus-Jensen"},4159:{color:[143,20,220],opacity:1,label:"wm-rh-S_intraparietal-and_Parietal_transverse"},4160:{color:[61,20,180],opacity:1,label:"wm-rh-S_occipital_anterior"},4161:{color:[101,60,220],opacity:1,label:"wm-rh-S_occipital_middle_and_Lunatus"},4162:{color:[21,20,140],opacity:1,label:"wm-rh-S_occipital_superior_and_transversalis"},4163:{color:[221,140,20],opacity:1,label:"wm-rh-S_occipito-temporal_lateral"},4164:{color:[141,100,220],opacity:1,label:"wm-rh-S_occipito-temporal_medial_and_S_Lingual"},4165:{color:[101,20,20],opacity:1,label:"wm-rh-S_orbital-H_shapped"},4166:{color:[221,100,20],opacity:1,label:"wm-rh-S_orbital_lateral"},4167:{color:[181,200,20],opacity:1,label:"wm-rh-S_orbital_medial-Or_olfactory"},4168:{color:[21,180,140],opacity:1,label:"wm-rh-S_paracentral"},4169:{color:[101,100,180],opacity:1,label:"wm-rh-S_parieto_occipital"},4170:{color:[181,220,20],opacity:1,label:"wm-rh-S_pericallosal"},4171:{color:[21,140,200],opacity:1,label:"wm-rh-S_postcentral"},4172:{color:[21,20,240],opacity:1,label:"wm-rh-S_precentral-Inferior-part"},4173:{color:[21,20,200],opacity:1,label:"wm-rh-S_precentral-Superior-part"},4174:{color:[61,180,60],opacity:1,label:"wm-rh-S_subcentral_ant"},4175:{color:[61,180,250],opacity:1,label:"wm-rh-S_subcentral_post"},4176:{color:[21,20,60],opacity:1,label:"wm-rh-S_suborbital"},4177:{color:[101,60,60],opacity:1,label:"wm-rh-S_subparietal"},4178:{color:[21,220,220],opacity:1,label:"wm-rh-S_supracingulate"},4179:{color:[21,180,180],opacity:1,label:"wm-rh-S_temporal_inferior"},4180:{color:[223,220,60],opacity:1,label:"wm-rh-S_temporal_superior"},4181:{color:[221,60,60],opacity:1,label:"wm-rh-S_temporal_transverse"},5001:{color:[20,30,40],opacity:1,label:"Left-UnsegmentedWhiteMatter"},5002:{color:[20,30,40],opacity:1,label:"Right-UnsegmentedWhiteMatter"},5100:{color:[204,102,102],opacity:1,label:"fmajor"},5101:{color:[204,102,102],opacity:1,label:"fminor"},5102:{color:[255,255,102],opacity:1,label:"lh.atr"},5103:{color:[153,204,0],opacity:1,label:"lh.cab"},5104:{color:[0,153,153],opacity:1,label:"lh.ccg"},5105:{color:[204,153,255],opacity:1,label:"lh.cst"},5106:{color:[255,153,51],opacity:1,label:"lh.ilf"},5107:{color:[204,204,204],opacity:1,label:"lh.slfp"},5108:{color:[153,255,255],opacity:1,label:"lh.slft"},5109:{color:[102,153,255],opacity:1,label:"lh.unc"},5110:{color:[255,255,102],opacity:1,label:"rh.atr"},5111:{color:[153,204,0],opacity:1,label:"rh.cab"},5112:{color:[0,153,153],opacity:1,label:"rh.ccg"},5113:{color:[204,153,255],opacity:1,label:"rh.cst"},5114:{color:[255,153,51],opacity:1,label:"rh.ilf"},5115:{color:[204,204,204],opacity:1,label:"rh.slfp"},5116:{color:[153,255,255],opacity:1,label:"rh.slft"},5117:{color:[102,153,255],opacity:1,label:"rh.unc"},5200:{color:[204,102,102],opacity:1,label:"CC-ForcepsMajor"},5201:{color:[204,102,102],opacity:1,label:"CC-ForcepsMinor"},5202:{color:[255,255,102],opacity:1,label:"LAntThalRadiation"},5203:{color:[153,204,0],opacity:1,label:"LCingulumAngBundle"},5204:{color:[0,153,153],opacity:1,label:"LCingulumCingGyrus"},5205:{color:[204,153,255],opacity:1,label:"LCorticospinalTract"},5206:{color:[255,153,51],opacity:1,label:"LInfLongFas"},5207:{color:[204,204,204],opacity:1,label:"LSupLongFasParietal"},5208:{color:[153,255,255],opacity:1,label:"LSupLongFasTemporal"},5209:{color:[102,153,255],opacity:1,label:"LUncinateFas"},5210:{color:[255,255,102],opacity:1,label:"RAntThalRadiation"},5211:{color:[153,204,0],opacity:1,label:"RCingulumAngBundle"},5212:{color:[0,153,153],opacity:1,label:"RCingulumCingGyrus"},5213:{color:[204,153,255],opacity:1,label:"RCorticospinalTract"},5214:{color:[255,153,51],opacity:1,label:"RInfLongFas"},5215:{color:[204,204,204],opacity:1,label:"RSupLongFasParietal"},5216:{color:[153,255,255],opacity:1,label:"RSupLongFasTemporal"},5217:{color:[102,153,255],opacity:1,label:"RUncinateFas"},6e3:{color:[0,255,0],opacity:1,label:"CST-orig"},6001:{color:[255,255,0],opacity:1,label:"CST-hammer"},6002:{color:[0,255,255],opacity:1,label:"CST-CVS"},6003:{color:[0,0,255],opacity:1,label:"CST-flirt"},6010:{color:[236,16,231],opacity:1,label:"Left-SLF1"},6020:{color:[237,18,232],opacity:1,label:"Right-SLF1"},6030:{color:[236,13,227],opacity:1,label:"Left-SLF3"},6040:{color:[236,17,228],opacity:1,label:"Right-SLF3"},6050:{color:[1,255,1],opacity:1,label:"Left-CST"},6060:{color:[2,255,1],opacity:1,label:"Right-CST"},6070:{color:[236,14,230],opacity:1,label:"Left-SLF2"},6080:{color:[237,14,230],opacity:1,label:"Right-SLF2"},7001:{color:[72,132,181],opacity:1,label:"Lateral-nucleus"},7002:{color:[243,243,243],opacity:1,label:"Basolateral-nucleus"},7003:{color:[207,63,79],opacity:1,label:"Basal-nucleus"},7004:{color:[121,20,135],opacity:1,label:"Centromedial-nucleus"},7005:{color:[197,60,248],opacity:1,label:"Central-nucleus"},7006:{color:[2,149,2],opacity:1,label:"Medial-nucleus"},7007:{color:[221,249,166],opacity:1,label:"Cortical-nucleus"},7008:{color:[232,146,35],opacity:1,label:"Accessory-Basal-nucleus"},7009:{color:[20,60,120],opacity:1,label:"Corticoamygdaloid-transitio"},7010:{color:[250,250,0],opacity:1,label:"Anterior-amygdaloid-area-AAA"},7011:{color:[122,187,222],opacity:1,label:"Fusion-amygdala-HP-FAH"},7012:{color:[237,12,177],opacity:1,label:"Hippocampal-amygdala-transition-HATA"},7013:{color:[10,49,255],opacity:1,label:"Endopiriform-nucleus"},7014:{color:[205,184,144],opacity:1,label:"Lateral-nucleus-olfactory-tract"},7015:{color:[45,205,165],opacity:1,label:"Paralaminar-nucleus"},7016:{color:[117,160,175],opacity:1,label:"Intercalated-nucleus"},7017:{color:[221,217,21],opacity:1,label:"Prepiriform-cortex"},7018:{color:[20,60,120],opacity:1,label:"Periamygdaloid-cortex"},7019:{color:[141,21,100],opacity:1,label:"Envelope-Amygdala"},7020:{color:[225,140,141],opacity:1,label:"Extranuclear-Amydala"},7100:{color:[42,201,168],opacity:1,label:"Brainstem-inferior-colliculus"},7101:{color:[168,104,162],opacity:1,label:"Brainstem-cochlear-nucleus"},8001:{color:[74,130,181],opacity:1,label:"Thalamus-Anterior"},8002:{color:[242,241,240],opacity:1,label:"Thalamus-Ventral-anterior"},8003:{color:[206,65,78],opacity:1,label:"Thalamus-Lateral-dorsal"},8004:{color:[120,21,133],opacity:1,label:"Thalamus-Lateral-posterior"},8005:{color:[195,61,246],opacity:1,label:"Thalamus-Ventral-lateral"},8006:{color:[3,147,6],opacity:1,label:"Thalamus-Ventral-posterior-medial"},8007:{color:[220,251,163],opacity:1,label:"Thalamus-Ventral-posterior-lateral"},8008:{color:[232,146,33],opacity:1,label:"Thalamus-intralaminar"},8009:{color:[4,114,14],opacity:1,label:"Thalamus-centromedian"},8010:{color:[121,184,220],opacity:1,label:"Thalamus-mediodorsal"},8011:{color:[235,11,175],opacity:1,label:"Thalamus-medial"},8012:{color:[12,46,250],opacity:1,label:"Thalamus-pulvinar"},8013:{color:[203,182,143],opacity:1,label:"Thalamus-lateral-geniculate"},8014:{color:[42,204,167],opacity:1,label:"Thalamus-medial-geniculate"},9e3:{color:[50,100,30],opacity:1,label:"ctx-lh-prefrontal"},9001:{color:[30,100,45],opacity:1,label:"ctx-lh-primary-motor"},9002:{color:[130,100,165],opacity:1,label:"ctx-lh-premotor"},9003:{color:[105,25,5],opacity:1,label:"ctx-lh-temporal"},9004:{color:[125,70,55],opacity:1,label:"ctx-lh-posterior-parietal"},9005:{color:[225,20,105],opacity:1,label:"ctx-lh-prim-sec-somatosensory"},9006:{color:[225,20,15],opacity:1,label:"ctx-lh-occipital"},9500:{color:[50,200,30],opacity:1,label:"ctx-rh-prefrontal"},9501:{color:[30,150,45],opacity:1,label:"ctx-rh-primary-motor"},9502:{color:[130,150,165],opacity:1,label:"ctx-rh-premotor"},9503:{color:[105,75,5],opacity:1,label:"ctx-rh-temporal"},9504:{color:[125,120,55],opacity:1,label:"ctx-rh-posterior-parietal"},9505:{color:[225,70,105],opacity:1,label:"ctx-rh-prim-sec-somatosensory"},9506:{color:[225,70,15],opacity:1,label:"ctx-rh-occipital"},11100:{color:[0,0,0],opacity:1,label:"ctx_lh_Unknown"},11101:{color:[23,220,60],opacity:1,label:"ctx_lh_G_and_S_frontomargin"},11102:{color:[23,60,180],opacity:1,label:"ctx_lh_G_and_S_occipital_inf"},11103:{color:[63,100,60],opacity:1,label:"ctx_lh_G_and_S_paracentral"},11104:{color:[63,20,220],opacity:1,label:"ctx_lh_G_and_S_subcentral"},11105:{color:[13,0,250],opacity:1,label:"ctx_lh_G_and_S_transv_frontopol"},11106:{color:[26,60,0],opacity:1,label:"ctx_lh_G_and_S_cingul-Ant"},11107:{color:[26,60,75],opacity:1,label:"ctx_lh_G_and_S_cingul-Mid-Ant"},11108:{color:[26,60,150],opacity:1,label:"ctx_lh_G_and_S_cingul-Mid-Post"},11109:{color:[25,60,250],opacity:1,label:"ctx_lh_G_cingul-Post-dorsal"},11110:{color:[60,25,25],opacity:1,label:"ctx_lh_G_cingul-Post-ventral"},11111:{color:[180,20,20],opacity:1,label:"ctx_lh_G_cuneus"},11112:{color:[220,20,100],opacity:1,label:"ctx_lh_G_front_inf-Opercular"},11113:{color:[140,60,60],opacity:1,label:"ctx_lh_G_front_inf-Orbital"},11114:{color:[180,220,140],opacity:1,label:"ctx_lh_G_front_inf-Triangul"},11115:{color:[140,100,180],opacity:1,label:"ctx_lh_G_front_middle"},11116:{color:[180,20,140],opacity:1,label:"ctx_lh_G_front_sup"},11117:{color:[23,10,10],opacity:1,label:"ctx_lh_G_Ins_lg_and_S_cent_ins"},11118:{color:[225,140,140],opacity:1,label:"ctx_lh_G_insular_short"},11119:{color:[180,60,180],opacity:1,label:"ctx_lh_G_occipital_middle"},11120:{color:[20,220,60],opacity:1,label:"ctx_lh_G_occipital_sup"},11121:{color:[60,20,140],opacity:1,label:"ctx_lh_G_oc-temp_lat-fusifor"},11122:{color:[220,180,140],opacity:1,label:"ctx_lh_G_oc-temp_med-Lingual"},11123:{color:[65,100,20],opacity:1,label:"ctx_lh_G_oc-temp_med-Parahip"},11124:{color:[220,60,20],opacity:1,label:"ctx_lh_G_orbital"},11125:{color:[20,60,220],opacity:1,label:"ctx_lh_G_pariet_inf-Angular"},11126:{color:[100,100,60],opacity:1,label:"ctx_lh_G_pariet_inf-Supramar"},11127:{color:[220,180,220],opacity:1,label:"ctx_lh_G_parietal_sup"},11128:{color:[20,180,140],opacity:1,label:"ctx_lh_G_postcentral"},11129:{color:[60,140,180],opacity:1,label:"ctx_lh_G_precentral"},11130:{color:[25,20,140],opacity:1,label:"ctx_lh_G_precuneus"},11131:{color:[20,60,100],opacity:1,label:"ctx_lh_G_rectus"},11132:{color:[60,220,20],opacity:1,label:"ctx_lh_G_subcallosal"},11133:{color:[60,60,220],opacity:1,label:"ctx_lh_G_temp_sup-G_T_transv"},11134:{color:[220,60,220],opacity:1,label:"ctx_lh_G_temp_sup-Lateral"},11135:{color:[65,220,60],opacity:1,label:"ctx_lh_G_temp_sup-Plan_polar"},11136:{color:[25,140,20],opacity:1,label:"ctx_lh_G_temp_sup-Plan_tempo"},11137:{color:[220,220,100],opacity:1,label:"ctx_lh_G_temporal_inf"},11138:{color:[180,60,60],opacity:1,label:"ctx_lh_G_temporal_middle"},11139:{color:[61,20,220],opacity:1,label:"ctx_lh_Lat_Fis-ant-Horizont"},11140:{color:[61,20,60],opacity:1,label:"ctx_lh_Lat_Fis-ant-Vertical"},11141:{color:[61,60,100],opacity:1,label:"ctx_lh_Lat_Fis-post"},11142:{color:[25,25,25],opacity:1,label:"ctx_lh_Medial_wall"},11143:{color:[140,20,60],opacity:1,label:"ctx_lh_Pole_occipital"},11144:{color:[220,180,20],opacity:1,label:"ctx_lh_Pole_temporal"},11145:{color:[63,180,180],opacity:1,label:"ctx_lh_S_calcarine"},11146:{color:[221,20,10],opacity:1,label:"ctx_lh_S_central"},11147:{color:[221,20,100],opacity:1,label:"ctx_lh_S_cingul-Marginalis"},11148:{color:[221,60,140],opacity:1,label:"ctx_lh_S_circular_insula_ant"},11149:{color:[221,20,220],opacity:1,label:"ctx_lh_S_circular_insula_inf"},11150:{color:[61,220,220],opacity:1,label:"ctx_lh_S_circular_insula_sup"},11151:{color:[100,200,200],opacity:1,label:"ctx_lh_S_collat_transv_ant"},11152:{color:[10,200,200],opacity:1,label:"ctx_lh_S_collat_transv_post"},11153:{color:[221,220,20],opacity:1,label:"ctx_lh_S_front_inf"},11154:{color:[141,20,100],opacity:1,label:"ctx_lh_S_front_middle"},11155:{color:[61,220,100],opacity:1,label:"ctx_lh_S_front_sup"},11156:{color:[141,60,20],opacity:1,label:"ctx_lh_S_interm_prim-Jensen"},11157:{color:[143,20,220],opacity:1,label:"ctx_lh_S_intrapariet_and_P_trans"},11158:{color:[101,60,220],opacity:1,label:"ctx_lh_S_oc_middle_and_Lunatus"},11159:{color:[21,20,140],opacity:1,label:"ctx_lh_S_oc_sup_and_transversal"},11160:{color:[61,20,180],opacity:1,label:"ctx_lh_S_occipital_ant"},11161:{color:[221,140,20],opacity:1,label:"ctx_lh_S_oc-temp_lat"},11162:{color:[141,100,220],opacity:1,label:"ctx_lh_S_oc-temp_med_and_Lingual"},11163:{color:[221,100,20],opacity:1,label:"ctx_lh_S_orbital_lateral"},11164:{color:[181,200,20],opacity:1,label:"ctx_lh_S_orbital_med-olfact"},11165:{color:[101,20,20],opacity:1,label:"ctx_lh_S_orbital-H_Shaped"},11166:{color:[101,100,180],opacity:1,label:"ctx_lh_S_parieto_occipital"},11167:{color:[181,220,20],opacity:1,label:"ctx_lh_S_pericallosal"},11168:{color:[21,140,200],opacity:1,label:"ctx_lh_S_postcentral"},11169:{color:[21,20,240],opacity:1,label:"ctx_lh_S_precentral-inf-part"},11170:{color:[21,20,200],opacity:1,label:"ctx_lh_S_precentral-sup-part"},11171:{color:[21,20,60],opacity:1,label:"ctx_lh_S_suborbital"},11172:{color:[101,60,60],opacity:1,label:"ctx_lh_S_subparietal"},11173:{color:[21,180,180],opacity:1,label:"ctx_lh_S_temporal_inf"},11174:{color:[223,220,60],opacity:1,label:"ctx_lh_S_temporal_sup"},11175:{color:[221,60,60],opacity:1,label:"ctx_lh_S_temporal_transverse"},12100:{color:[0,0,0],opacity:1,label:"ctx_rh_Unknown"},12101:{color:[23,220,60],opacity:1,label:"ctx_rh_G_and_S_frontomargin"},12102:{color:[23,60,180],opacity:1,label:"ctx_rh_G_and_S_occipital_inf"},12103:{color:[63,100,60],opacity:1,label:"ctx_rh_G_and_S_paracentral"},12104:{color:[63,20,220],opacity:1,label:"ctx_rh_G_and_S_subcentral"},12105:{color:[13,0,250],opacity:1,label:"ctx_rh_G_and_S_transv_frontopol"},12106:{color:[26,60,0],opacity:1,label:"ctx_rh_G_and_S_cingul-Ant"},12107:{color:[26,60,75],opacity:1,label:"ctx_rh_G_and_S_cingul-Mid-Ant"},12108:{color:[26,60,150],opacity:1,label:"ctx_rh_G_and_S_cingul-Mid-Post"},12109:{color:[25,60,250],opacity:1,label:"ctx_rh_G_cingul-Post-dorsal"},12110:{color:[60,25,25],opacity:1,label:"ctx_rh_G_cingul-Post-ventral"},12111:{color:[180,20,20],opacity:1,label:"ctx_rh_G_cuneus"},12112:{color:[220,20,100],opacity:1,label:"ctx_rh_G_front_inf-Opercular"},12113:{color:[140,60,60],opacity:1,label:"ctx_rh_G_front_inf-Orbital"},12114:{color:[180,220,140],opacity:1,label:"ctx_rh_G_front_inf-Triangul"},12115:{color:[140,100,180],opacity:1,label:"ctx_rh_G_front_middle"},12116:{color:[180,20,140],opacity:1,label:"ctx_rh_G_front_sup"},12117:{color:[23,10,10],opacity:1,label:"ctx_rh_G_Ins_lg_and_S_cent_ins"},12118:{color:[225,140,140],opacity:1,label:"ctx_rh_G_insular_short"},12119:{color:[180,60,180],opacity:1,label:"ctx_rh_G_occipital_middle"},12120:{color:[20,220,60],opacity:1,label:"ctx_rh_G_occipital_sup"},12121:{color:[60,20,140],opacity:1,label:"ctx_rh_G_oc-temp_lat-fusifor"},12122:{color:[220,180,140],opacity:1,label:"ctx_rh_G_oc-temp_med-Lingual"},12123:{color:[65,100,20],opacity:1,label:"ctx_rh_G_oc-temp_med-Parahip"},12124:{color:[220,60,20],opacity:1,label:"ctx_rh_G_orbital"},12125:{color:[20,60,220],opacity:1,label:"ctx_rh_G_pariet_inf-Angular"},12126:{color:[100,100,60],opacity:1,label:"ctx_rh_G_pariet_inf-Supramar"},12127:{color:[220,180,220],opacity:1,label:"ctx_rh_G_parietal_sup"},12128:{color:[20,180,140],opacity:1,label:"ctx_rh_G_postcentral"},12129:{color:[60,140,180],opacity:1,label:"ctx_rh_G_precentral"},12130:{color:[25,20,140],opacity:1,label:"ctx_rh_G_precuneus"},12131:{color:[20,60,100],opacity:1,label:"ctx_rh_G_rectus"},12132:{color:[60,220,20],opacity:1,label:"ctx_rh_G_subcallosal"},12133:{color:[60,60,220],opacity:1,label:"ctx_rh_G_temp_sup-G_T_transv"},12134:{color:[220,60,220],opacity:1,label:"ctx_rh_G_temp_sup-Lateral"},12135:{color:[65,220,60],opacity:1,label:"ctx_rh_G_temp_sup-Plan_polar"},12136:{color:[25,140,20],opacity:1,label:"ctx_rh_G_temp_sup-Plan_tempo"},12137:{color:[220,220,100],opacity:1,label:"ctx_rh_G_temporal_inf"},12138:{color:[180,60,60],opacity:1,label:"ctx_rh_G_temporal_middle"},12139:{color:[61,20,220],opacity:1,label:"ctx_rh_Lat_Fis-ant-Horizont"},12140:{color:[61,20,60],opacity:1,label:"ctx_rh_Lat_Fis-ant-Vertical"},12141:{color:[61,60,100],opacity:1,label:"ctx_rh_Lat_Fis-post"},12142:{color:[25,25,25],opacity:1,label:"ctx_rh_Medial_wall"},12143:{color:[140,20,60],opacity:1,label:"ctx_rh_Pole_occipital"},12144:{color:[220,180,20],opacity:1,label:"ctx_rh_Pole_temporal"},12145:{color:[63,180,180],opacity:1,label:"ctx_rh_S_calcarine"},12146:{color:[221,20,10],opacity:1,label:"ctx_rh_S_central"},12147:{color:[221,20,100],opacity:1,label:"ctx_rh_S_cingul-Marginalis"},12148:{color:[221,60,140],opacity:1,label:"ctx_rh_S_circular_insula_ant"},12149:{color:[221,20,220],opacity:1,label:"ctx_rh_S_circular_insula_inf"},12150:{color:[61,220,220],opacity:1,label:"ctx_rh_S_circular_insula_sup"},12151:{color:[100,200,200],opacity:1,label:"ctx_rh_S_collat_transv_ant"},12152:{color:[10,200,200],opacity:1,label:"ctx_rh_S_collat_transv_post"},12153:{color:[221,220,20],opacity:1,label:"ctx_rh_S_front_inf"},12154:{color:[141,20,100],opacity:1,label:"ctx_rh_S_front_middle"},12155:{color:[61,220,100],opacity:1,label:"ctx_rh_S_front_sup"},12156:{color:[141,60,20],opacity:1,label:"ctx_rh_S_interm_prim-Jensen"},12157:{color:[143,20,220],opacity:1,label:"ctx_rh_S_intrapariet_and_P_trans"},12158:{color:[101,60,220],opacity:1,label:"ctx_rh_S_oc_middle_and_Lunatus"},12159:{color:[21,20,140],opacity:1,label:"ctx_rh_S_oc_sup_and_transversal"},12160:{color:[61,20,180],opacity:1,label:"ctx_rh_S_occipital_ant"},12161:{color:[221,140,20],opacity:1,label:"ctx_rh_S_oc-temp_lat"},12162:{color:[141,100,220],opacity:1,label:"ctx_rh_S_oc-temp_med_and_Lingual"},12163:{color:[221,100,20],opacity:1,label:"ctx_rh_S_orbital_lateral"},12164:{color:[181,200,20],opacity:1,label:"ctx_rh_S_orbital_med-olfact"},12165:{color:[101,20,20],opacity:1,label:"ctx_rh_S_orbital-H_Shaped"},12166:{color:[101,100,180],opacity:1,label:"ctx_rh_S_parieto_occipital"},12167:{color:[181,220,20],opacity:1,label:"ctx_rh_S_pericallosal"},12168:{color:[21,140,200],opacity:1,label:"ctx_rh_S_postcentral"},12169:{color:[21,20,240],opacity:1,label:"ctx_rh_S_precentral-inf-part"},12170:{color:[21,20,200],opacity:1,label:"ctx_rh_S_precentral-sup-part"},12171:{color:[21,20,60],opacity:1,label:"ctx_rh_S_suborbital"},12172:{color:[101,60,60],opacity:1,label:"ctx_rh_S_subparietal"},12173:{color:[21,180,180],opacity:1,label:"ctx_rh_S_temporal_inf"},12174:{color:[223,220,60],opacity:1,label:"ctx_rh_S_temporal_sup"},12175:{color:[221,60,60],opacity:1,label:"ctx_rh_S_temporal_transverse"},13100:{color:[0,0,0],opacity:1,label:"wm_lh_Unknown"},13101:{color:[23,220,60],opacity:1,label:"wm_lh_G_and_S_frontomargin"},13102:{color:[23,60,180],opacity:1,label:"wm_lh_G_and_S_occipital_inf"},13103:{color:[63,100,60],opacity:1,label:"wm_lh_G_and_S_paracentral"},13104:{color:[63,20,220],opacity:1,label:"wm_lh_G_and_S_subcentral"},13105:{color:[13,0,250],opacity:1,label:"wm_lh_G_and_S_transv_frontopol"},13106:{color:[26,60,0],opacity:1,label:"wm_lh_G_and_S_cingul-Ant"},13107:{color:[26,60,75],opacity:1,label:"wm_lh_G_and_S_cingul-Mid-Ant"},13108:{color:[26,60,150],opacity:1,label:"wm_lh_G_and_S_cingul-Mid-Post"},13109:{color:[25,60,250],opacity:1,label:"wm_lh_G_cingul-Post-dorsal"},13110:{color:[60,25,25],opacity:1,label:"wm_lh_G_cingul-Post-ventral"},13111:{color:[180,20,20],opacity:1,label:"wm_lh_G_cuneus"},13112:{color:[220,20,100],opacity:1,label:"wm_lh_G_front_inf-Opercular"},13113:{color:[140,60,60],opacity:1,label:"wm_lh_G_front_inf-Orbital"},13114:{color:[180,220,140],opacity:1,label:"wm_lh_G_front_inf-Triangul"},13115:{color:[140,100,180],opacity:1,label:"wm_lh_G_front_middle"},13116:{color:[180,20,140],opacity:1,label:"wm_lh_G_front_sup"},13117:{color:[23,10,10],opacity:1,label:"wm_lh_G_Ins_lg_and_S_cent_ins"},13118:{color:[225,140,140],opacity:1,label:"wm_lh_G_insular_short"},13119:{color:[180,60,180],opacity:1,label:"wm_lh_G_occipital_middle"},13120:{color:[20,220,60],opacity:1,label:"wm_lh_G_occipital_sup"},13121:{color:[60,20,140],opacity:1,label:"wm_lh_G_oc-temp_lat-fusifor"},13122:{color:[220,180,140],opacity:1,label:"wm_lh_G_oc-temp_med-Lingual"},13123:{color:[65,100,20],opacity:1,label:"wm_lh_G_oc-temp_med-Parahip"},13124:{color:[220,60,20],opacity:1,label:"wm_lh_G_orbital"},13125:{color:[20,60,220],opacity:1,label:"wm_lh_G_pariet_inf-Angular"},13126:{color:[100,100,60],opacity:1,label:"wm_lh_G_pariet_inf-Supramar"},13127:{color:[220,180,220],opacity:1,label:"wm_lh_G_parietal_sup"},13128:{color:[20,180,140],opacity:1,label:"wm_lh_G_postcentral"},13129:{color:[60,140,180],opacity:1,label:"wm_lh_G_precentral"},13130:{color:[25,20,140],opacity:1,label:"wm_lh_G_precuneus"},13131:{color:[20,60,100],opacity:1,label:"wm_lh_G_rectus"},13132:{color:[60,220,20],opacity:1,label:"wm_lh_G_subcallosal"},13133:{color:[60,60,220],opacity:1,label:"wm_lh_G_temp_sup-G_T_transv"},13134:{color:[220,60,220],opacity:1,label:"wm_lh_G_temp_sup-Lateral"},13135:{color:[65,220,60],opacity:1,label:"wm_lh_G_temp_sup-Plan_polar"},13136:{color:[25,140,20],opacity:1,label:"wm_lh_G_temp_sup-Plan_tempo"},13137:{color:[220,220,100],opacity:1,label:"wm_lh_G_temporal_inf"},13138:{color:[180,60,60],opacity:1,label:"wm_lh_G_temporal_middle"},13139:{color:[61,20,220],opacity:1,label:"wm_lh_Lat_Fis-ant-Horizont"},13140:{color:[61,20,60],opacity:1,label:"wm_lh_Lat_Fis-ant-Vertical"},13141:{color:[61,60,100],opacity:1,label:"wm_lh_Lat_Fis-post"},13142:{color:[25,25,25],opacity:1,label:"wm_lh_Medial_wall"},13143:{color:[140,20,60],opacity:1,label:"wm_lh_Pole_occipital"},13144:{color:[220,180,20],opacity:1,label:"wm_lh_Pole_temporal"},13145:{color:[63,180,180],opacity:1,label:"wm_lh_S_calcarine"},13146:{color:[221,20,10],opacity:1,label:"wm_lh_S_central"},13147:{color:[221,20,100],opacity:1,label:"wm_lh_S_cingul-Marginalis"},13148:{color:[221,60,140],opacity:1,label:"wm_lh_S_circular_insula_ant"},13149:{color:[221,20,220],opacity:1,label:"wm_lh_S_circular_insula_inf"},13150:{color:[61,220,220],opacity:1,label:"wm_lh_S_circular_insula_sup"},13151:{color:[100,200,200],opacity:1,label:"wm_lh_S_collat_transv_ant"},13152:{color:[10,200,200],opacity:1,label:"wm_lh_S_collat_transv_post"},13153:{color:[221,220,20],opacity:1,label:"wm_lh_S_front_inf"},13154:{color:[141,20,100],opacity:1,label:"wm_lh_S_front_middle"},13155:{color:[61,220,100],opacity:1,label:"wm_lh_S_front_sup"},13156:{color:[141,60,20],opacity:1,label:"wm_lh_S_interm_prim-Jensen"},13157:{color:[143,20,220],opacity:1,label:"wm_lh_S_intrapariet_and_P_trans"},13158:{color:[101,60,220],opacity:1,label:"wm_lh_S_oc_middle_and_Lunatus"},13159:{color:[21,20,140],opacity:1,label:"wm_lh_S_oc_sup_and_transversal"},13160:{color:[61,20,180],opacity:1,label:"wm_lh_S_occipital_ant"},13161:{color:[221,140,20],opacity:1,label:"wm_lh_S_oc-temp_lat"},13162:{color:[141,100,220],opacity:1,label:"wm_lh_S_oc-temp_med_and_Lingual"},13163:{color:[221,100,20],opacity:1,label:"wm_lh_S_orbital_lateral"},13164:{color:[181,200,20],opacity:1,label:"wm_lh_S_orbital_med-olfact"},13165:{color:[101,20,20],opacity:1,label:"wm_lh_S_orbital-H_Shaped"},13166:{color:[101,100,180],opacity:1,label:"wm_lh_S_parieto_occipital"},13167:{color:[181,220,20],opacity:1,label:"wm_lh_S_pericallosal"},13168:{color:[21,140,200],opacity:1,label:"wm_lh_S_postcentral"},13169:{color:[21,20,240],opacity:1,label:"wm_lh_S_precentral-inf-part"},13170:{color:[21,20,200],opacity:1,label:"wm_lh_S_precentral-sup-part"},13171:{color:[21,20,60],opacity:1,label:"wm_lh_S_suborbital"},13172:{color:[101,60,60],opacity:1,label:"wm_lh_S_subparietal"},13173:{color:[21,180,180],opacity:1,label:"wm_lh_S_temporal_inf"},13174:{color:[223,220,60],opacity:1,label:"wm_lh_S_temporal_sup"},13175:{color:[221,60,60],opacity:1,label:"wm_lh_S_temporal_transverse"},14100:{color:[0,0,0],opacity:1,label:"wm_rh_Unknown"},14101:{color:[23,220,60],opacity:1,label:"wm_rh_G_and_S_frontomargin"},14102:{color:[23,60,180],opacity:1,label:"wm_rh_G_and_S_occipital_inf"},14103:{color:[63,100,60],opacity:1,label:"wm_rh_G_and_S_paracentral"},14104:{color:[63,20,220],opacity:1,label:"wm_rh_G_and_S_subcentral"},14105:{color:[13,0,250],opacity:1,label:"wm_rh_G_and_S_transv_frontopol"},14106:{color:[26,60,0],opacity:1,label:"wm_rh_G_and_S_cingul-Ant"},14107:{color:[26,60,75],opacity:1,label:"wm_rh_G_and_S_cingul-Mid-Ant"},14108:{color:[26,60,150],opacity:1,label:"wm_rh_G_and_S_cingul-Mid-Post"},14109:{color:[25,60,250],opacity:1,label:"wm_rh_G_cingul-Post-dorsal"},14110:{color:[60,25,25],opacity:1,label:"wm_rh_G_cingul-Post-ventral"},14111:{color:[180,20,20],opacity:1,label:"wm_rh_G_cuneus"},14112:{color:[220,20,100],opacity:1,label:"wm_rh_G_front_inf-Opercular"},14113:{color:[140,60,60],opacity:1,label:"wm_rh_G_front_inf-Orbital"},14114:{color:[180,220,140],opacity:1,label:"wm_rh_G_front_inf-Triangul"},14115:{color:[140,100,180],opacity:1,label:"wm_rh_G_front_middle"},14116:{color:[180,20,140],opacity:1,label:"wm_rh_G_front_sup"},14117:{color:[23,10,10],opacity:1,label:"wm_rh_G_Ins_lg_and_S_cent_ins"},14118:{color:[225,140,140],opacity:1,label:"wm_rh_G_insular_short"},14119:{color:[180,60,180],opacity:1,label:"wm_rh_G_occipital_middle"},14120:{color:[20,220,60],opacity:1,label:"wm_rh_G_occipital_sup"},14121:{color:[60,20,140],opacity:1,label:"wm_rh_G_oc-temp_lat-fusifor"},14122:{color:[220,180,140],opacity:1,label:"wm_rh_G_oc-temp_med-Lingual"},14123:{color:[65,100,20],opacity:1,label:"wm_rh_G_oc-temp_med-Parahip"},14124:{color:[220,60,20],opacity:1,label:"wm_rh_G_orbital"},14125:{color:[20,60,220],opacity:1,label:"wm_rh_G_pariet_inf-Angular"},14126:{color:[100,100,60],opacity:1,label:"wm_rh_G_pariet_inf-Supramar"},14127:{color:[220,180,220],opacity:1,label:"wm_rh_G_parietal_sup"},14128:{color:[20,180,140],opacity:1,label:"wm_rh_G_postcentral"},14129:{color:[60,140,180],opacity:1,label:"wm_rh_G_precentral"},14130:{color:[25,20,140],opacity:1,label:"wm_rh_G_precuneus"},14131:{color:[20,60,100],opacity:1,label:"wm_rh_G_rectus"},14132:{color:[60,220,20],opacity:1,label:"wm_rh_G_subcallosal"},14133:{color:[60,60,220],opacity:1,label:"wm_rh_G_temp_sup-G_T_transv"},14134:{color:[220,60,220],opacity:1,label:"wm_rh_G_temp_sup-Lateral"},14135:{color:[65,220,60],opacity:1,label:"wm_rh_G_temp_sup-Plan_polar"},14136:{color:[25,140,20],opacity:1,label:"wm_rh_G_temp_sup-Plan_tempo"},14137:{color:[220,220,100],opacity:1,label:"wm_rh_G_temporal_inf"},14138:{color:[180,60,60],opacity:1,label:"wm_rh_G_temporal_middle"},14139:{color:[61,20,220],opacity:1,label:"wm_rh_Lat_Fis-ant-Horizont"},14140:{color:[61,20,60],opacity:1,label:"wm_rh_Lat_Fis-ant-Vertical"},14141:{color:[61,60,100],opacity:1,label:"wm_rh_Lat_Fis-post"},14142:{color:[25,25,25],opacity:1,label:"wm_rh_Medial_wall"},14143:{color:[140,20,60],opacity:1,label:"wm_rh_Pole_occipital"},14144:{color:[220,180,20],opacity:1,label:"wm_rh_Pole_temporal"},14145:{color:[63,180,180],opacity:1,label:"wm_rh_S_calcarine"},14146:{color:[221,20,10],opacity:1,label:"wm_rh_S_central"},14147:{color:[221,20,100],opacity:1,label:"wm_rh_S_cingul-Marginalis"},14148:{color:[221,60,140],opacity:1,label:"wm_rh_S_circular_insula_ant"},14149:{color:[221,20,220],opacity:1,label:"wm_rh_S_circular_insula_inf"},14150:{color:[61,220,220],opacity:1,label:"wm_rh_S_circular_insula_sup"},14151:{color:[100,200,200],opacity:1,label:"wm_rh_S_collat_transv_ant"},14152:{color:[10,200,200],opacity:1,label:"wm_rh_S_collat_transv_post"},14153:{color:[221,220,20],opacity:1,label:"wm_rh_S_front_inf"},14154:{color:[141,20,100],opacity:1,label:"wm_rh_S_front_middle"},14155:{color:[61,220,100],opacity:1,label:"wm_rh_S_front_sup"},14156:{color:[141,60,20],opacity:1,label:"wm_rh_S_interm_prim-Jensen"},14157:{color:[143,20,220],opacity:1,label:"wm_rh_S_intrapariet_and_P_trans"},14158:{color:[101,60,220],opacity:1,label:"wm_rh_S_oc_middle_and_Lunatus"},14159:{color:[21,20,140],opacity:1,label:"wm_rh_S_oc_sup_and_transversal"},14160:{color:[61,20,180],opacity:1,label:"wm_rh_S_occipital_ant"},14161:{color:[221,140,20],opacity:1,label:"wm_rh_S_oc-temp_lat"},14162:{color:[141,100,220],opacity:1,label:"wm_rh_S_oc-temp_med_and_Lingual"},14163:{color:[221,100,20],opacity:1,label:"wm_rh_S_orbital_lateral"},14164:{color:[181,200,20],opacity:1,label:"wm_rh_S_orbital_med-olfact"},14165:{color:[101,20,20],opacity:1,label:"wm_rh_S_orbital-H_Shaped"},14166:{color:[101,100,180],opacity:1,label:"wm_rh_S_parieto_occipital"},14167:{color:[181,220,20],opacity:1,label:"wm_rh_S_pericallosal"},14168:{color:[21,140,200],opacity:1,label:"wm_rh_S_postcentral"},14169:{color:[21,20,240],opacity:1,label:"wm_rh_S_precentral-inf-part"},14170:{color:[21,20,200],opacity:1,label:"wm_rh_S_precentral-sup-part"},14171:{color:[21,20,60],opacity:1,label:"wm_rh_S_suborbital"},14172:{color:[101,60,60],opacity:1,label:"wm_rh_S_subparietal"},14173:{color:[21,180,180],opacity:1,label:"wm_rh_S_temporal_inf"},14174:{color:[223,220,60],opacity:1,label:"wm_rh_S_temporal_sup"},14175:{color:[221,60,60],opacity:1,label:"wm_rh_S_temporal_transverse"}}},function(y,t,e){"use strict";var n=e(35),i=e(37),r=e(36),o=e(43),a=e(45),s=e(44),l=e(49),c=e(51),h=e(50),u=e(169),p=e(170),d=e(171),f=e(38),m=e(40),_=e(39);e.d(t,"b",function(){return n.a}),e.d(t,"a",function(){return i.a}),e.d(t,"c",function(){return r.a}),e.d(t,"e",function(){return o.a}),e.d(t,"d",function(){return a.a}),e.d(t,"f",function(){return s.a}),e.d(t,"n",function(){return l.a}),e.d(t,"m",function(){return c.a}),e.d(t,"o",function(){return h.a}),e.d(t,"h",function(){return u.a}),e.d(t,"g",function(){return p.a}),e.d(t,"i",function(){return d.a}),e.d(t,"k",function(){return f.a}),e.d(t,"j",function(){return m.a}),e.d(t,"l",function(){return _.a})},function(a,t,e){"use strict";function n(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}var i=e(0),r=function(){function e(){n(this,e)}return e.uniforms=function(){return{uTextureBackTest0:{type:"t",value:[],typeGLSL:"sampler2D"},uTextureBackTest1:{type:"t",value:[],typeGLSL:"sampler2D"},uOpacity0:{type:"f",value:1,typeGLSL:"float"},uOpacity1:{type:"f",value:1,typeGLSL:"float"},uType0:{type:"i",value:0,typeGLSL:"int"},uType1:{type:"i",value:1,typeGLSL:"int"},uTrackMouse:{type:"i",value:0,typeGLSL:"int"},uMouse:{type:"v2",value:new i.e,typeGLSL:"vec2"}}},e}();t.a=r},function(a,t){"use strict";function o(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}var e=function(){function a(t){o(this,a),this._uniforms=t,this._functions={},this._main=""}return a.prototype.functions=function(){""===this._main&&this.main();var a="";for(var t in this._functions)a+=this._functions[t]+"\n";return a},a.prototype.uniforms=function(){var a="";for(var t in this._uniforms){var e=this._uniforms[t];a+="uniform "+e.typeGLSL+" "+t,e&&e.length&&(a+="["+e.length+"]"),a+=";\n"}return a},a.prototype.main=function(){this._main="\nvoid main(void) {\n\n  vec2 texc = vec2(((vProjectedCoords.x / vProjectedCoords.w) + 1.0 ) / 2.0,\n                ((vProjectedCoords.y / vProjectedCoords.w) + 1.0 ) / 2.0 );\n\n  // just silence warning for\n  // vec4 dummy = vPos;\n\n  //The back position is the world space position stored in the texture.\n  vec4 baseColor0 = texture2D(uTextureBackTest0, texc);\n  vec4 baseColor1 = texture2D(uTextureBackTest1, texc);\n\n  if( uTrackMouse == 1 ){\n\n      if( vProjectedCoords.x < uMouse.x ){\n\n        gl_FragColor = baseColor0;\n\n      }\n      else{\n\n        gl_FragColor = mix( baseColor0, baseColor1, uOpacity1 );\n\n      }\n\n  }\n  else{\n\n    if( uType1 == 0 ){\n\n      //merge an image into\n      gl_FragColor = mix( baseColor0, baseColor1, uOpacity1 );\n\n    }\n    else{\n\n      float opacity = baseColor1.a;\n      gl_FragColor = mix( baseColor0, baseColor1, opacity * uOpacity1 );\n\n    }\n\n  }\n\n  return;\n}\n   "},a.prototype.compute=function(){return"\n// uniforms\n"+this.uniforms()+"\n\n// varying (should fetch it from vertex directly)\n// varying vec4      vPos;\nvarying vec4      vProjectedCoords;\n\n// tailored functions\n"+this.functions()+"\n\n// main loop\n"+this._main+"\n      "},a}();t.a=e},function(a,t){"use strict";function e(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function a(){e(this,a)}return a.prototype.compute=function(){return"\n// varying vec4 vPos;\nvarying vec4 vProjectedCoords;\n\n//\n// main\n//\nvoid main() {\n\n  vec4 vPos = modelMatrix * vec4(position, 1.0 );\n  vProjectedCoords =  projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0 );\n\n}\n        "},a}();t.a=o},function(c,t,e){"use strict";var n=e(173),i=e(174),r=e(13),o=e(175),a=e(176),s=e(177);e.d(t,"a",function(){return n.a}),e.d(t,"b",function(){return i.a}),e.d(t,"c",function(){return r.a}),e.d(t,"d",function(){return o.a}),e.d(t,"e",function(){return a.a}),e.d(t,"f",function(){return s.a})},function(d,t,e){"use strict";function m(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function i(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))||"function"==typeof o)?o:a}function r(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var o=e(8),_=e(13),s=e(0),a=function(){function a(a,o){for(var e=0,r;e<o.length;e++)r=o[e],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,r.key,r)}return function(t,e,o){return e&&a(t.prototype,e),o&&a(t,o),t}}(),n=function(l){function t(e,r,o,a){m(this,t);var n=i(this,l.call(this));n._targetMesh=e,n._controls=r,n._camera=o,n._container=a,n._active=!0,n._worldPosition=new s.f,null!==n._targetMesh&&(n._worldPosition=n._targetMesh.position),n._material=null,n._geometry=null,n._mesh=null,n._line=null,n._label=null,n._cone=null,n._labeltext=null,n._alreadycreated=null,n._movinglabel=null,n._labelmoved=!1,n._labelhovered=!1,n._domHovered=!1,n._hovered=!0,n._manuallabeldisplay=!1,n._labelpositionx=null,n._labelpositiony=null,n._differencemousecenterlabelx=0,n._differencemousecenterlabely=0,n._handles=[];var c=new _.a(n._targetMesh,n._controls,n._camera,n._container);c.worldPosition=n._worldPosition,c.hovered=!0,n.add(c),n._handles.push(c);var d=new _.a(n._targetMesh,n._controls,n._camera,n._container);return d.worldPosition=n._worldPosition,d.hovered=!0,d.active=!0,d.tracking=!0,n.add(d),n._handles.push(d),n.create(),n.onEnd=n.onEnd.bind(n),n.onMove=n.onMove.bind(n),n.onHoverlabel=n.onHoverlabel.bind(n),n.notonHoverlabel=n.notonHoverlabel.bind(n),n.changelabeltext=n.changelabeltext.bind(n),n.movelabel=n.movelabel.bind(n),n.notmovelabel=n.notmovelabel.bind(n),n.addEventListeners(),n}return r(t,l),t.prototype.addEventListeners=function(){this._label.addEventListener("mouseenter",this.onHoverlabel),this._label.addEventListener("mouseleave",this.notonHoverlabel),this._label.addEventListener("dblclick",this.changelabeltext),this._label.addEventListener("mousedown",this.movelabel),this._container.addEventListener("mouseup",this.notmovelabel),this._container.addEventListener("mousewheel",this.onMove),this._container.addEventListener("DOMMouseScroll",this.onMove)},t.prototype.movelabel=function(){if(this._labelhovered){this._movinglabel=!0,this._labelmoved=!0;var a=-(-event.clientY+this._container.offsetHeight),t=event.clientX;this._differencemousecenterlabelx=B(B(t)-B(this._labelpositionx)),this._differencemousecenterlabely=B(B(a)-B(this._labelpositiony))}},t.prototype.notmovelabel=function(){this._movinglabel=!1,this._handles[0]._controls.enabled=!0,this._handles[1]._controls.enabled=!0,this._differencemousecenterlabelx=0,this._differencemousecenterlabely=0},t.prototype.onHoverlabel=function(){this._labelhovered=!0},t.prototype.notonHoverlabel=function(){this._labelhovered=!1},t.prototype.onMove=function(e){this._movinglabel&&(this._handles[0]._controls.enabled=!1,this._handles[1]._controls.enabled=!1),this._dragged=!0,this._handles[0].onMove(e),this._handles[1].onMove(e),this._hovered=this._handles[0].hovered||this._handles[1].hovered||this._labelhovered,this.update()},t.prototype.onStart=function(e){this._dragged=!1,this._handles[0].onStart(e),this._handles[1].onStart(e),this._active=this._handles[0].active||this._handles[1].active,this.update()},t.prototype.setlabeltext=function(){this._labeltext=prompt("Please enter the name of the label",""),"string"==typeof this._labeltext&&(0<this._labeltext.length?(this._label.innerHTML=this._labeltext,this._label.style.display="",this._dashline.style.display=""):(this._label.innerHTML=this._labeltext,this._label.style.display="none",this._dashline.style.display="none"))},t.prototype.changelabeltext=function(){this._labeltext=prompt("Please enter new name of the label",this._label.innerHTML),"string"==typeof this._labeltext&&(0<this._labeltext.length?(this._label.innerHTML=this._labeltext,this._label.style.display="",this._dashline.style.display=""):(this._label.innerHTML=this._labeltext,this._label.style.display="none",this._dashline.style.display="none"))},t.prototype.displaylabel=function(){"string"==typeof this._labeltext&&(this._label.innerHTML=this._labeltext,this._label.style.display="",this._dashline.style.display="",this._label.style.transform="translate3D("+this._labelpositionx+"px,"+this._labelpositiony+"px, 0)")},t.prototype.onEnd=function(e){this._handles[0].onEnd(e),this._dragged||!this._handles[1].tracking?(this._handles[1].tracking=!1,this._handles[1].onEnd(e)):this._handles[1].tracking=!1,this._alreadycreated||(this.setlabeltext(),this._alreadycreated=!0),this._active=this._handles[0].active||this._handles[1].active,this.update()},t.prototype.create=function(){this.createMesh(),this.createDOM()},t.prototype.update=function(){this.updateColor(),this.updateMeshColor(),this.updateMeshPosition(),this.updateDOMPosition(),this.updateDOMColor()},t.prototype.createMesh=function(){this._geometry=new THREE.Geometry,this._geometry.vertices.push(this._handles[0].worldPosition),this._geometry.vertices.push(this._handles[1].worldPosition),this._material=new THREE.LineBasicMaterial,this.updateMeshColor(),this._meshline=new THREE.Line(this._geometry,this._material),this._meshline.visible=!0,this.add(this._meshline),this._conegeometry=new THREE.CylinderGeometry(0,2,10),this._conegeometry.translate(0,-5,0),this._conegeometry.rotateX(-Gn/2),this._cone=new THREE.Mesh(this._conegeometry,this._material),this._cone.visible=!0,this.add(this._cone)},t.prototype.updateMeshColor=function(){this._material&&this._material.color.set(this._color)},t.prototype.updateMeshPosition=function(){this._geometry&&(this._geometry.verticesNeedUpdate=!0)},t.prototype.createDOM=function(){this._line=document.createElement("div"),this._line.setAttribute("class","widgets handle line"),this._line.style.position="absolute",this._line.style.transformOrigin="0 100%",this._line.style.marginTop="-1px",this._line.style.height="2px",this._line.style.width="3px",this._container.appendChild(this._line),this._dashline=document.createElement("div"),this._dashline.setAttribute("class","widgets handle dashline"),this._dashline.style.position="absolute",this._dashline.style.border="none",this._dashline.style.borderTop="2.5px dashed #F9F9F9",this._dashline.style.transformOrigin="0 100%",this._dashline.style.height="1px",this._dashline.style.width="50%",this._dashline.style.display="none",this._container.appendChild(this._dashline),this._label=document.createElement("div"),this._label.setAttribute("id",this.uuid),this._label.setAttribute("class","widgets handle label"),this._label.style.border="2px solid #F9F9F9",this._label.style.backgroundColor="#F9F9F9",this._label.style.color="#353535",this._label.style.padding="4px",this._label.style.position="absolute",this._label.style.transformOrigin="0 100%",this._label.innerHTML="Hello, world!",this._label.style.display="none",this._container.appendChild(this._label),this.updateDOMColor()},t.prototype.updateDOMPosition=function(){var F=this._handles[0].screenPosition.x,t=this._handles[0].screenPosition.y,e=this._handles[1].screenPosition.x,n=this._handles[1].screenPosition.y,i=F+(e-F)/2,r=t+(n-t)/2,o=N((F-e)*(F-e)+(t-n)*(t-n)),a=180*D(n-t,e-F)/Gn,s="translate3D("+F+"px,"+(t-this._container.offsetHeight)+"px, 0)";s+=" rotate("+a+"deg)",this._line.style.transform=s,this._line.style.width=o+"px";var l=0,c=0,h;if(h=r-this._container.offsetHeight-this._label.offsetHeight/2,i-=this._label.offsetWidth/2,!this._labelmoved){var u="translate3D("+P(i)+"px,"+P(h)+"px, 0)";this._label.style.transform=u,this._labelpositionx=P(i),this._labelpositiony=P(h)}this._movinglabel&&(l=event.clientX,c=-(-event.clientY+this._container.offsetHeight),this._label.style.transform="translate3D("+(l-this._differencemousecenterlabelx)+"px,"+(c-this._differencemousecenterlabely)+"px, 0)",this._labelpositionx=l-this._differencemousecenterlabelx,this._labelpositiony=c-this._differencemousecenterlabely),this._manuallabeldisplay&&this.displaylabel();var p=this._handles[0].worldPosition,d=this._handles[1].worldPosition;this._cone.position.set(d.x,d.y,d.z),this._cone.lookAt(p),F=this._handles[0].screenPosition.x,t=this._handles[0].screenPosition.y,e=this._labelpositionx,n=this._labelpositiony+this._container.offsetHeight;var f=this._label.offsetHeight,m=this._label.offsetWidth,_=0,g=0;isFinite(m)&&isFinite(f)&&(_=m/2,g=f/2),e+=_,n+=g;var y=this._handles[0].screenPosition.x,v=this._handles[0].screenPosition.y,b=(this._handles[0].screenPosition.x+this._handles[1].screenPosition.x)/2,w=(this._handles[0].screenPosition.y+this._handles[1].screenPosition.y)/2,x=this._handles[1].screenPosition.x,S=this._handles[1].screenPosition.y,E=N((y-e)*(y-e)+(v-n)*(v-n)),M=N((b-e)*(b-e)+(w-n)*(w-n)),T=N((x-e)*(x-e)+(S-n)*(S-n)),A=U(E,M,T),I=[E,M,T].indexOf(A);0==I&&(F=y,t=v),1==I&&(F=b,t=w),2==I&&(F=x,t=S);var C=N((F-e)*(F-e)+(t-n)*(t-n)),L=180*D(n-t,e-F)/Gn,R="translate3D("+F+"px,"+(t-this._container.offsetHeight)+"px, 0)";R+=" rotate("+L+"deg)",this._dashline.style.transform=R,this._dashline.style.width=C+"px"},t.prototype.updateDOMColor=function(){this._line.style.backgroundColor=""+this._color,this._dashline.style.borderTop="2.5px dashed "+this._color,this._label.style.borderColor=""+this._color},t.prototype.hideDOM=function(){this._line.style.display="none",this._dashline.style.display="none",this._label.style.display="none"},t.prototype.showDOM=function(){this._line.style.display="",this._dashline.style.display="",this._label.style.display=""},t.prototype.hideMesh=function(){this.visible=!1},t.prototype.showMesh=function(){this.visible=!0},t.prototype.show=function(){this.showDOM(),this.showMesh()},t.prototype.hide=function(){this.hideDOM(),this.hideMesh()},a(t,[{key:"worldPosition",get:function(){return this._worldPosition},set:function(e){this._worldPosition=e,this._handles[0].worldPosition=this._worldPosition,this._handles[1].worldPosition=this._worldPosition,this.update()}}]),t}(o.a);t.a=n},function(d,t,e){"use strict";function m(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function i(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))||"function"==typeof o)?o:a}function r(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var o=e(8),_=e(13),s=e(0),a=function(){function a(a,o){for(var e=0,r;e<o.length;e++)r=o[e],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,r.key,r)}return function(t,e,o){return e&&a(t.prototype,e),o&&a(t,o),t}}(),n=function(l){function t(e,r,o,a){m(this,t);var n=i(this,l.call(this));n._targetMesh=e,n._controls=r,n._camera=o,n._container=a,n._active=!0,n._initOrtho=!1,n._worldPosition=new s.f,null!==n._targetMesh&&(n._worldPosition=n._targetMesh.position),n._material=null,n._geometry=null,n._mesh=null,n._line=null,n._distance=null,n._handles=[];var c=new _.a(n._targetMesh,n._controls,n._camera,n._container);c.worldPosition=n._worldPosition,c.hovered=!0,n.add(c),n._handles.push(c);var u=new _.a(n._targetMesh,n._controls,n._camera,n._container);u.worldPosition=n._worldPosition,u.hovered=!0,u.active=!0,u.tracking=!0,n.add(u),n._handles.push(u);var p=new _.a(n._targetMesh,n._controls,n._camera,n._container);p.worldPosition=n._worldPosition,p.hovered=!0,n.add(p),n._handles.push(p);var d=new _.a(n._targetMesh,n._controls,n._camera,n._container);return d.worldPosition=n._worldPosition,d.hovered=!0,n.add(d),n._handles.push(d),n.create(),n.onMove=n.onMove.bind(n),n.addEventListeners(),n._orientation=null,n._slice=null,n}return r(t,l),t.prototype.addEventListeners=function(){this._container.addEventListener("mousewheel",this.onMove),this._container.addEventListener("DOMMouseScroll",this.onMove)},t.prototype.onMove=function(e){this._dragged=!0,this._handles[0].onMove(e),this._handles[1].onMove(e),this._handles[2].onMove(e),this._handles[3].onMove(e),this._hovered=this._handles[0].hovered||this._handles[1].hovered||this._handles[2].hovered||this._handles[3].hovered,this.update()},t.prototype.onStart=function(e){this._dragged=!1,this._handles[0].onStart(e),this._handles[1].onStart(e),this._handles[2].onStart(e),this._handles[3].onStart(e),this._active=this._handles[0].active||this._handles[1].active||this._handles[2].active||this._handles[3].active,this.update()},t.prototype.onEnd=function(e){this._handles[0].onEnd(e),this._handles[2].onEnd(e),this._handles[3].onEnd(e),window.console.log(this),this._dragged||!this._handles[1].tracking?(this._handles[1].tracking=!1,this._handles[1].onEnd(e)):this._handles[1].tracking=!1,this._active=this._handles[0].active||this._handles[1].active||this._handles[2].active||this._handles[3].active,this.update()},t.prototype.create=function(){this.createMesh(),this.createDOM()},t.prototype.hideDOM=function(){for(var e in this._line.style.display="none",this._distance.style.display="none",this._line2.style.display="none",this._distance2.style.display="none",this._handles)this._handles[e].hideDOM();this._dashline.style.display="none"},t.prototype.showDOM=function(){for(var e in this._line.style.display="",this._distance.style.display="",this._line2.style.display="",this._distance2.style.display="",this._handles)this._handles[e].showDOM();this._dashline.style.display=""},t.prototype.hideMesh=function(){this._mesh.visible=!1,this._mesh2.visible=!1,this._handles[0].visible=!1,this._handles[1].visible=!1,this._handles[2].visible=!1,this._handles[3].visible=!1},t.prototype.showMesh=function(){this._mesh.visible=!0,this._mesh2.visible=!0,this._handles[0].visible=!0,this._handles[1].visible=!0,this._handles[2].visible=!0,this._handles[3].visible=!0},t.prototype.show=function(){this.showDOM(),this.showMesh()},t.prototype.hide=function(){this.hideDOM(),this.hideMesh()},t.prototype.update=function(){this.updateColor(),this.updateMeshColor(),this.updateMeshPosition(),this.updateDOMPosition(),this.updateDOMColor()},t.prototype.createMesh=function(){this._geometry=new THREE.Geometry,this._geometry.vertices.push(this._handles[0].worldPosition),this._geometry.vertices.push(this._handles[1].worldPosition),this._geometry2=new THREE.Geometry,this._geometry2.vertices.push(this._handles[2].worldPosition),this._geometry2.vertices.push(this._handles[3].worldPosition),this._material=new THREE.LineBasicMaterial,this._material2=new THREE.LineBasicMaterial,this.updateMeshColor(),this._mesh=new THREE.Line(this._geometry,this._material),this._mesh.visible=!0,this._mesh2=new THREE.Line(this._geometry2,this._material2),this._mesh2.visible=!0,this.add(this._mesh),this.add(this._mesh2)},t.prototype.updateMeshColor=function(){this._material&&this._material.color.set(this._color),this._material2&&this._material2.color.set(this._color)},t.prototype.updateMeshPosition=function(){this._geometry&&(this._geometry.verticesNeedUpdate=!0),this._geometry2&&(this._geometry2.verticesNeedUpdate=!0)},t.prototype.createDOM=function(){this._line=document.createElement("div"),this._line.setAttribute("class","widgets handle line"),this._line.style.position="absolute",this._line.style.transformOrigin="0 100%",this._line.style.marginTop="-1px",this._line.style.height="2px",this._line.style.width="3px",this._container.appendChild(this._line),this._distance=document.createElement("div"),this._distance.setAttribute("class","widgets handle distance"),this._distance.style.border="2px solid",this._distance.style.backgroundColor="#F9F9F9",this._distance.style.color="#353535",this._distance.style.padding="4px",this._distance.style.position="absolute",this._distance.style.transformOrigin="0 100%",this._distance.innerHTML="Hello, world!",this._container.appendChild(this._distance),this._line2=document.createElement("div"),this._line2.setAttribute("class","widgets handle line"),this._line2.style.position="absolute",this._line2.style.transformOrigin="0 100%",this._line2.style.marginTop="-1px",this._line2.style.height="2px",this._line2.style.width="3px",this._container.appendChild(this._line2),this._distance2=document.createElement("div"),this._distance2.setAttribute("class","widgets handle distance"),this._distance.style.border="2px solid",this._distance.style.backgroundColor="#F9F9F9",this._distance2.style.color="#353535",this._distance2.style.padding="4px",this._distance2.style.position="absolute",this._distance2.style.transformOrigin="0 100%",this._distance2.innerHTML="Hello, world!",this._container.appendChild(this._distance2),this._dashline=document.createElement("div"),this._dashline.setAttribute("class","widgets handle dashline"),this._dashline.style.position="absolute",this._dashline.style.border="none",this._dashline.style.borderTop="2.5px dashed #F9F9F9",this._dashline.style.transformOrigin="0 100%",this._dashline.style.height="1px",this._dashline.style.width="50%",this._container.appendChild(this._dashline),this.updateDOMColor()},t.prototype.updateDOMPosition=function(){var C=this._handles[0].screenPosition.x,t=this._handles[0].screenPosition.y,e=this._handles[1].screenPosition.x,n=this._handles[1].screenPosition.y,i=e,r=n;r=t>=n?n-30:n+30;var o=N((C-e)*(C-e)+(t-n)*(t-n)),a=180*D(n-t,e-C)/Gn,s=t-this._container.offsetHeight,l="translate3D("+C+"px,"+s+"px, 0)";l+=" rotate("+a+"deg)",this._line.style.transform=l,this._line.style.width=o+"px";var c=this._handles[0].worldPosition,h=this._handles[1].worldPosition;this._distance.innerHTML=N((c.x-h.x)*(c.x-h.x)+(c.y-h.y)*(c.y-h.y)+(c.z-h.z)*(c.z-h.z)).toFixed(2)+" mm",this._distanceValue=N((c.x-h.x)*(c.x-h.x)+(c.y-h.y)*(c.y-h.y)+(c.z-h.z)*(c.z-h.z)).toFixed(2);var u=r-this._container.offsetHeight-this._distance.offsetHeight/2;i-=this._distance.offsetWidth/2;var p="translate3D("+P(i)+"px,"+P(u)+"px, 0)";this._distance.style.transform=p;var d=this._handles[2].screenPosition.x,f=this._handles[2].screenPosition.y,m=this._handles[3].screenPosition.x,_=this._handles[3].screenPosition.y,g=m,y=_;y=f>=_?_-30:_+30,o=N((d-m)*(d-m)+(f-_)*(f-_)),a=180*D(_-f,m-d)/Gn,l="translate3D("+d+"px,"+(s=f-this._container.offsetHeight)+"px, 0)",l+=" rotate("+a+"deg)",this._line2.style.transform=l,this._line2.style.width=o+"px";var v=this._handles[2].worldPosition,b=this._handles[3].worldPosition;this._distance2.innerHTML=N((v.x-b.x)*(v.x-b.x)+(v.y-b.y)*(v.y-b.y)+(v.z-b.z)*(v.z-b.z)).toFixed(2)+" mm",this._distance2Value=N((v.x-b.x)*(v.x-b.x)+(v.y-b.y)*(v.y-b.y)+(v.z-b.z)*(v.z-b.z)).toFixed(2);var w=y-this._container.offsetHeight-this._distance2.offsetHeight/2;g-=this._distance2.offsetWidth/2,p="translate3D("+P(g)+"px,"+P(w)+"px, 0)",this._distance2.style.transform=p;var x=this.getPointInBetweenByPerc(this._handles[0].worldPosition,this._handles[1].worldPosition,.5),S=this.getPointInBetweenByPerc(this._handles[2].worldPosition,this._handles[3].worldPosition,.5),E=this._handles[0].worldToScreen(x,this._camera,this._container),M=this._handles[0].worldToScreen(S,this._camera,this._container);C=E.x,t=E.y,e=M.x,n=M.y,o=N((C-e)*(C-e)+(t-n)*(t-n)),a=180*D(n-t,e-C)/Gn,l="translate3D("+C+"px,"+(s=t-this._container.offsetHeight)+"px, 0)",l+=" rotate("+a+"deg)",this._dashline.style.transform=l,this._dashline.style.width=o+"px"},t.prototype.updateDOMColor=function(){this._line.style.backgroundColor=""+this._color,this._distance.style.borderColor=""+this._color,this._line2.style.backgroundColor=""+this._color,this._distance2.style.borderColor=""+this._color},t.prototype.getPointInBetweenByPerc=function(a,t,e){var o=t.clone().sub(a),n=o.length();return o=o.normalize().multiplyScalar(n*e),a.clone().add(o)},t.prototype.initOrtho=function(){this._initOrtho=!0;var e=this.getPointInBetweenByPerc(this._handles[0].worldPosition,this._handles[1].worldPosition,.5);this._handles[2].worldPosition=this.getPointInBetweenByPerc(this._handles[0].worldPosition,this._handles[1].worldPosition,.25),this._handles[3].worldPosition=this.getPointInBetweenByPerc(this._handles[0].worldPosition,this._handles[1].worldPosition,.75),this._handles[2].worldPosition.x=e.x-N((e.y-this._handles[2].worldPosition.y)*(e.y-this._handles[2].worldPosition.y)),this._handles[2].worldPosition.y=e.y+N((e.x-this._handles[2].worldPosition.x)*(e.x-this._handles[2].worldPosition.x)),this._handles[3].worldPosition.x=e.x+N((e.y-this._handles[2].worldPosition.y)*(e.y-this._handles[2].worldPosition.y)),this._handles[3].worldPosition.y=e.y-N((e.x-this._handles[2].worldPosition.x)*(e.x-this._handles[2].worldPosition.x))},a(t,[{key:"worldPosition",get:function(){return this._worldPosition},set:function(e){this._worldPosition=e,this._handles[0].worldPosition=this._worldPosition,this._handles[1].worldPosition=this._worldPosition,this._handles[2].worldPosition=this._worldPosition,this._handles[3].worldPosition=this._worldPosition,this.update()}},{key:"shotestDistance",get:function(){return this._distanceValue<this._distance2Value?this._distanceValue:this._distance2Value}},{key:"longestDistance",get:function(){return this._distanceValue>this._distance2Value?this._distanceValue:this._distance2Value}}]),t}(o.a);t.a=n},function(d,t,e){"use strict";function p(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function i(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))||"function"==typeof o)?o:a}function r(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var o=e(8),m=e(13),s=e(0),a=function(){function a(a,o){for(var e=0,r;e<o.length;e++)r=o[e],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,r.key,r)}return function(t,e,o){return e&&a(t.prototype,e),o&&a(t,o),t}}(),n=function(l){function t(e,r,o,a){p(this,t);var n=i(this,l.call(this));n._targetMesh=e,n._controls=r,n._camera=o,n._container=a,n._active=!0,n._init=!1,n._worldPosition=new s.f,null!==n._targetMesh&&(n._worldPosition=n._targetMesh.position),n._material=null,n._geometry=null,n._mesh=null,n._lines=[],n._area=null,n._handles=[];var c=new m.a(n._targetMesh,n._controls,n._camera,n._container);return c.worldPosition=n._worldPosition,c.hovered=!0,n.add(c),n._handles.push(c),n.create(),n.onMove=n.onMove.bind(n),n.addEventListeners(),n._orientation=null,n._slice=null,n}return r(t,l),t.prototype.addEventListeners=function(){this._container.addEventListener("mousewheel",this.onMove),this._container.addEventListener("DOMMouseScroll",this.onMove)},t.prototype.onMove=function(l){this._dragged=!0;var t=this._handles.length;if(this.active&&!this._init){var e=this._handles[t-1];e.hovered=!1,e.active=!1,e.tracking=!1;var n=new m.a(this._targetMesh,this._controls,this._camera,this._container);n.worldPosition=this._worldPosition,n.hovered=!0,n.active=!0,n.tracking=!0,this.add(n),this._handles.push(n);var i=document.createElement("div");i.setAttribute("class","widgets handle line"),i.style.position="absolute",i.style.transformOrigin="0 100%",i.style.marginTop="-1px",i.style.height="2px",i.style.width="3px",i.style.backgroundColor="#F9F9F9",this._lines.push(i),this._container.appendChild(i)}var r=!1;for(var o in this._handles)this._handles[o].onMove(l),r=r||this._handles[o].hovered;this._hovered=r,this.active&&2<t&&this.pushPopHandle(),this.update()},t.prototype.onStart=function(a){this._dragged=!1;var t=!1;for(var e in this._handles)this._handles[e].onStart(a),t=t||this._handles[e].active;this._active=t,this.update()},t.prototype.onEnd=function(a){var t=!1;for(var e in this._handles.slice(0,this._handles.length-2))this._handles[e].onEnd(a),t=t||this._handles[e].active;if(this._dragged||!this._handles[this._handles.length-1].tracking?(this._handles[this._handles.length-1].tracking=!1,this._handles[this._handles.length-1].onEnd(a)):this._handles[this._handles.length-1].tracking=!1,t=t||this._handles[this._handles.length-1].active,this._active=t,this._lines.length<this._handles.length){var o=document.createElement("div");o.setAttribute("class","widgets handle line"),o.style.position="absolute",o.style.transformOrigin="0 100%",o.style.marginTop="-1px",o.style.height="2px",o.style.width="3px",o.style.backgroundColor="#F9F9F9",this._lines.push(o),this._container.appendChild(o)}this._init=!0,this.update()},t.prototype.create=function(){this.createMesh(),this.createDOM()},t.prototype.hideDOM=function(){for(var a in this._handles)this._handles[a].hideDOM();for(var t in this._lines)this._lines[t].style.display="none"},t.prototype.showDOM=function(){for(var a in this._handles)this._handles[a].showDOM();for(var t in this._lines)this._lines[t].style.display=""},t.prototype.hideMesh=function(){this.visible=!1},t.prototype.showMesh=function(){this.visible=!0},t.prototype.show=function(){this.showDOM(),this.showMesh()},t.prototype.hide=function(){this.hideDOM(),this.hideMesh()},t.prototype.update=function(){for(var e in this.updateColor(),this._handles)this._handles[e].update();this.updateMeshColor(),this.updateMeshPosition(),this.updateDOMPosition(),this.updateDOMColor()},t.prototype.createMesh=function(){for(var e in this._geometry=new THREE.Geometry,this._handles)this._geometry.vertices.push(this._handles[e].worldPosition);this._material=new THREE.LineBasicMaterial,this.updateMeshColor(),this._mesh=new THREE.Line(this._geometry,this._material),this._mesh.visible=!0,this.add(this._mesh)},t.prototype.updateMeshColor=function(){this._material&&this._material.color.set(this._color)},t.prototype.updateMeshPosition=function(){this._geometry&&(this._geometry.verticesNeedUpdate=!0)},t.prototype.createDOM=function(){this._line=document.createElement("div"),this._line.setAttribute("class","widgets handle line"),this._line.style.position="absolute",this._line.style.transformOrigin="0 100%",this._line.style.marginTop="-1px",this._line.style.height="2px",this._line.style.width="3px",this._container.appendChild(this._line),this._distance=document.createElement("div"),this._distance.setAttribute("class","widgets handle distance"),this._distance.style.border="2px solid",this._distance.style.backgroundColor="#F9F9F9",this._distance.style.color="#353535",this._distance.style.padding="4px",this._distance.style.position="absolute",this._distance.style.transformOrigin="0 100%",this._distance.innerHTML="Hello, world!",this._container.appendChild(this._distance),this.updateDOMColor()},t.prototype.isPointOnLine=function(a,t,e){var o=new s.f;return o.crossVectors(a.clone().sub(e),t.clone().sub(e)),!o.length()},t.prototype.pushPopHandle=function(){var a=this._handles[this._handles.length-3],t=this._handles[this._handles.length-2],e=this._handles[this._handles.length-1],o=this.isPointOnLine(a.worldPosition,t.worldPosition,e.worldPosition);if(o){t._dom.style.display="none",this.remove(t),this._handles[this._handles.length-2]=e,this._handles.pop();var n=this._lines.pop();n.style.display="none",this._container.removeChild(n)}return o},t.prototype.updateLineDOM=function(d,t,e){var n=this._handles[t].screenPosition.x,i=this._handles[t].screenPosition.y,r=this._handles[e].screenPosition.x,o=this._handles[e].screenPosition.y,a=N((n-r)*(n-r)+(i-o)*(i-o)),s=180*D(o-i,r-n)/Gn,l="translate3D("+n+"px, "+(i-this._container.offsetHeight)+"px, 0)";l+=" rotate("+s+"deg)",this._lines[d].style.transform=l,this._lines[d].style.width=a},t.prototype.updateDOMPosition=function(){if(2<=this._handles.length)for(var e in this._lines)this.updateLineDOM(e,e,parseInt(e)+1==this._handles.length?0:parseInt(e)+1)},t.prototype.updateDOMColor=function(){this._line.style.backgroundColor=""+this._color,this._distance.style.borderColor=""+this._color},t.prototype.getPointInBetweenByPerc=function(a,t,e){var o=t.clone().sub(a),n=o.length();return o=o.normalize().multiplyScalar(n*e),a.clone().add(o)},a(t,[{key:"worldPosition",get:function(){return this._worldPosition},set:function(a){for(var t in this._worldPosition=a,this._handles)this._handles[t]._worldPosition=this._worldPosition;this.update()}}]),t}(o.a);t.a=n},function(d,t,e){"use strict";function m(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function i(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))||"function"==typeof o)?o:a}function r(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var o=e(8),_=e(13),s=e(0),a=function(){function a(a,o){for(var e=0,r;e<o.length;e++)r=o[e],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,r.key,r)}return function(t,e,o){return e&&a(t.prototype,e),o&&a(t,o),t}}(),n=function(l){function t(e,r,o,a){m(this,t);var n=i(this,l.call(this,a));n._targetMesh=e,n._controls=r,n._camera=o,n._active=!0,n._lastEvent=null,n._worldPosition=new s.f,null!==n._targetMesh&&(n._worldPosition=n._targetMesh.position),n._material=null,n._geometry=null,n._mesh=null,n._line=null,n._distance=null,n._handles=[];var c=new _.a(n._targetMesh,n._controls,n._camera,n._container);c.worldPosition=n._worldPosition,c.hovered=!0,n.add(c),n._handles.push(c);var d=new _.a(n._targetMesh,n._controls,n._camera,n._container);return d.worldPosition=n._worldPosition,d.hovered=!0,d.active=!0,d.tracking=!0,n.add(d),n._handles.push(d),n.create(),n.initOffsets(),n.onMove=n.onMove.bind(n),n.onEndControl=n.onEndControl.bind(n),n.addEventListeners(),n}return r(t,l),t.prototype.addEventListeners=function(){this._container.addEventListener("mousewheel",this.onMove),this._container.addEventListener("DOMMouseScroll",this.onMove),this._controls.addEventListener("end",this.onEndControl)},t.prototype.removeEventListeners=function(){this._container.removeEventListener("mousewheel",this.onMove),this._container.removeEventListener("DOMMouseScroll",this.onMove),this._controls.removeEventListener("end",this.onEndControl)},t.prototype.onMove=function(e){this._lastEvent=e,this._dragged=!0,this._handles[0].onMove(e),this._handles[1].onMove(e),this._hovered=this._handles[0].hovered||this._handles[1].hovered,this.update()},t.prototype.onStart=function(e){this._lastEvent=e,this._dragged=!1,this._handles[0].onStart(e),this._handles[1].onStart(e),this._active=this._handles[0].active||this._handles[1].active,this.update()},t.prototype.onEnd=function(e){this._lastEvent=e,this._handles[0].onEnd(e),this._dragged||!this._handles[1].tracking?(this._handles[1].tracking=!1,this._handles[1].onEnd(e)):this._handles[1].tracking=!1,this._active=this._handles[0].active||this._handles[1].active,this.update()},t.prototype.onEndControl=function(){var e=this;this._lastEvent&&window.requestAnimationFrame(function(){e.onMove(e._lastEvent)})},t.prototype.create=function(){this.createMesh(),this.createDOM()},t.prototype.hideDOM=function(){for(var e in this._line.style.display="none",this._distance.style.display="none",this._handles)this._handles[e].hideDOM()},t.prototype.showDOM=function(){for(var e in this._line.style.display="",this._distance.style.display="",this._handles)this._handles[e].showDOM()},t.prototype.hideMesh=function(){this.visible=!1},t.prototype.showMesh=function(){this.visible=!0},t.prototype.show=function(){this.showDOM(),this.showMesh()},t.prototype.hide=function(){this.hideDOM(),this.hideMesh()},t.prototype.update=function(){this.updateColor(),this._handles[0].update(),this._handles[1].update(),this.updateMeshColor(),this.updateMeshPosition(),this.updateDOMColor(),this.updateDOMPosition()},t.prototype.createMesh=function(){this._geometry=new THREE.Geometry,this._geometry.vertices.push(this._handles[0].worldPosition),this._geometry.vertices.push(this._handles[1].worldPosition),this._material=new THREE.LineBasicMaterial,this.updateMeshColor(),this._mesh=new THREE.Line(this._geometry,this._material),this._mesh.visible=!0,this.add(this._mesh)},t.prototype.updateMeshColor=function(){this._material&&this._material.color.set(this._color)},t.prototype.updateMeshPosition=function(){this._geometry&&(this._geometry.verticesNeedUpdate=!0)},t.prototype.createDOM=function(){this._line=document.createElement("div"),this._line.setAttribute("id",this.uuid),this._line.setAttribute("class","AMI Widget Ruler"),this._line.style.position="absolute",this._line.style.transformOrigin="0 100%",this._line.style.marginTop="-1px",this._line.style.height="2px",this._line.style.width="3px",this._container.appendChild(this._line),this._distance=document.createElement("div"),this._distance.setAttribute("class","widgets handle distance"),this._distance.style.border="2px solid",this._distance.style.backgroundColor="#F9F9F9",this._distance.style.color="#353535",this._distance.style.padding="4px",this._distance.style.position="absolute",this._distance.style.transformOrigin="0 100%",this._distance.innerHTML="Hello, world!",this._container.appendChild(this._distance),this.updateDOMColor()},t.prototype.updateDOMPosition=function(){var d=this._handles[0].screenPosition.x,t=this._handles[0].screenPosition.y,e=this._handles[1].screenPosition.x,n=this._handles[1].screenPosition.y,i=e,r=n;r=t>=n?n-30:n+30;var o=N((d-e)*(d-e)+(t-n)*(t-n)),a=180*D(n-t,e-d)/Gn,s="translate3D("+d+"px,"+(t-this._container.offsetHeight)+"px, 0)";s+=" rotate("+a+"deg)",this._line.style.transform=s,this._line.style.width=o+"px";var l=this._handles[0].worldPosition,c=this._handles[1].worldPosition;this._distance.innerHTML=N((l.x-c.x)*(l.x-c.x)+(l.y-c.y)*(l.y-c.y)+(l.z-c.z)*(l.z-c.z)).toFixed(2)+" mm";var m=r-this._container.offsetHeight-this._distance.offsetHeight/2;i-=this._distance.offsetWidth/2;var u="translate3D("+P(i)+"px,"+P(m)+"px, 0)";this._distance.style.transform=u},t.prototype.updateDOMColor=function(){this._line.style.backgroundColor=""+this._color,this._distance.style.borderColor=""+this._color},t.prototype.free=function(){this._container.removeEventListener("mousewheel",this.onMove),this._container.removeEventListener("DOMMouseScroll",this.onMove),this._handles.forEach(function(e){e.free()}),this._handles=[],this._container.removeChild(this._line),this._container.removeChild(this._distance),this.remove(this._mesh),l.prototype.free.call(this)},a(t,[{key:"worldPosition",get:function(){return this._worldPosition},set:function(e){this._worldPosition=e,this._handles[0].worldPosition=this._worldPosition,this._handles[1].worldPosition=this._worldPosition,this.update()}}]),t}(o.a);t.a=n},function(m,t,e){"use strict";function _(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function i(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==("undefined"===typeof o?"undefined":babelHelpers.typeof(o))||"function"==typeof o)?o:a}function r(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof o?"undefined":babelHelpers.typeof(o)));a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var o=e(8),a=e(32),n=e(23),l=e(82),s=e(9),h=e(0),c=function(){function a(a,o){for(var e=0,r;e<o.length;e++)r=o[e],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,r.key,r)}return function(t,e,o){return e&&a(t.prototype,e),o&&a(t,o),t}}(),p=function(d){function t(e,r,o,a,n){_(this,t);var l=i(this,d.call(this,n));return l._stack=e,l._targetMesh=r,l._controls=o,l._camera=a,l._plane={position:new h.f,direction:new h.f},l._offset=new h.f,l._raycaster=new THREE.Raycaster,l._tracking=!1,l._mouse=new h.e,l._lastEvent=null,l._worldPosition=new h.f,l._screenPosition=new h.e,l._material=null,l._geometry=null,l._mesh=null,l._meshDisplayed=!0,l._meshHovered=!1,l._meshStyle="sphere",l._dom=null,l._domDisplayed=!0,l._domHovered=!1,l._domStyle="circle",null!==l._targetMesh&&l._worldPosition.copy(l._targetMesh.position),l._screenPosition=l.worldToScreen(l._worldPosition,l._camera,l._container),l.create(),l.initOffsets(),l.onMove=l.onMove.bind(l),l.onHover=l.onHover.bind(l),l.onEndControl=l.onEndControl.bind(l),l.addEventListeners(),l}return r(t,d),t.prototype.addEventListeners=function(){this._dom.addEventListener("mouseenter",this.onHover),this._dom.addEventListener("mouseleave",this.onHover),this._container.addEventListener("mousewheel",this.onMove),this._container.addEventListener("DOMMouseScroll",this.onMove),this._controls.addEventListener("end",this.onEndControl)},t.prototype.removeEventListeners=function(){this._dom.removeEventListener("mouseenter",this.onHover),this._dom.removeEventListener("mouseleave",this.onHover),this._container.removeEventListener("mousewheel",this.onMove),this._container.removeEventListener("DOMMouseScroll",this.onMove),this._controls.removeEventListener("end",this.onEndControl)},t.prototype.onStart=function(a){this._lastEvent=a,a.preventDefault();var t=this.getMouseOffsets(a,this._container);if(this._mouse.set(t.x,t.y),this._raycaster.setFromCamera(this._mouse,this._camera),this._raycaster.ray.position=this._raycaster.ray.origin,this._hovered){if(this._active=!0,this._controls.enabled=!1,this._targetMesh){var e=this._raycaster.intersectObject(this._targetMesh);0<e.length&&this._offset.copy(e[0].point).sub(this._worldPosition)}else{this._plane.position.copy(this._worldPosition),this._plane.direction.copy(this._camera.getWorldDirection());var o=s.a.rayPlane(this._raycaster.ray,this._plane);null!==o&&this._offset.copy(o).sub(this._plane.position)}this.update()}},t.prototype.onEnd=function(e){this._lastEvent=e,e.preventDefault(),!0!==this._tracking&&(!this._dragged&&this._active&&(this._selected=!this._selected),this._active=!1,this._dragged=!1,this._controls.enabled=!0,this.update())},t.prototype.onEndControl=function(){var e=this;this._lastEvent&&window.requestAnimationFrame(function(){e.onMove(e._lastEvent)})},t.prototype.onMove=function(a){this._lastEvent=a,a.preventDefault();var t=this.getMouseOffsets(a,this._container);if(!(this._mouse.set(t.x,t.y),this._raycaster.setFromCamera(this._mouse,this._camera),this._raycaster.ray.position=this._raycaster.ray.origin,this._active))this.onHover(null);else if(this._dragged=!0,null!==this._targetMesh){var e=this._raycaster.intersectObject(this._targetMesh);0<e.length&&this._worldPosition.copy(e[0].point.sub(this._offset))}else{0===this._plane.direction.length()&&(this._plane.position.copy(this._worldPosition),this._plane.direction.copy(this._camera.getWorldDirection()));var o=s.a.rayPlane(this._raycaster.ray,this._plane);null!==o&&this._worldPosition.copy(o.sub(this._offset))}this.update()},t.prototype.onHover=function(e){e&&(this._lastEvent=e,e.preventDefault(),this.hoverDom(e)),this.hoverMesh(),this._hovered=this._meshHovered||this._domHovered,this._container.style.cursor=this._hovered?"pointer":"default"},t.prototype.hoverMesh=function(){var e=this._raycaster.intersectObject(this._mesh);this._meshHovered=0<e.length},t.prototype.hoverDom=function(e){this._domHovered="mouseenter"===e.type},t.prototype.worldToScreen=function(a,t,e){var o=a.clone();return o.project(t),o.x=P((o.x+1)*e.offsetWidth/2),o.y=P((1-o.y)*e.offsetHeight/2),o.z=0,o},t.prototype.create=function(){this.createVoxel(),this.createMesh(),this.createDOM()},t.prototype.createVoxel=function(){this._voxel=new l.a,this._voxel.id=this.id,this._voxel.worldCoordinates=this._worldCoordinates},t.prototype.createMesh=function(){var e=n.a.worldToData(this._stack,this._worldPosition);this._geometry=new a.a(e),this._material=new THREE.MeshBasicMaterial({wireframe:!0,wireframeLinewidth:1}),this._mesh=new THREE.Mesh(this._geometry,this._material),this._mesh.applyMatrix(this._stack.ijk2LPS),this._mesh.visible=!0,this.updateMeshColor(),this.add(this._mesh)},t.prototype.updateMeshColor=function(){this._material&&this._material.color.set(this._color)},t.prototype.createDOM=function(){this._dom=document.createElement("div"),this._dom.setAttribute("id",this.uuid),this._dom.setAttribute("class","AMI Widget VoxelProbe"),this._dom.style.border="2px solid #000",this._dom.style.backgroundColor="rgb(249, 249, 249)",this._dom.style.color="#212121",this._dom.style.position="absolute",this._dom.style.transformOrigin="0px 100% 0px";var a=document.createElement("div"),t=document.createElement("div");t.setAttribute("id","lpsPosition"),a.appendChild(t);var e=document.createElement("div");e.setAttribute("id","ijkPosition"),a.appendChild(e);var o=document.createElement("div");o.setAttribute("id","value"),a.appendChild(o),this.updateDOMColor(),this._dom.appendChild(a),this._container.appendChild(this._dom)},t.prototype.updateDOMContent=function(){this._dom.querySelector("#lpsPosition").innerHTML="LPS: \n      "+this._voxel.worldCoordinates.x.toFixed(2)+" :\n      "+this._voxel.worldCoordinates.y.toFixed(2)+" :\n      "+this._voxel.worldCoordinates.z.toFixed(2),this._dom.querySelector("#ijkPosition").innerHTML="IJK: \n      "+this._voxel.dataCoordinates.x+" :\n      "+this._voxel.dataCoordinates.y+" :\n      "+this._voxel.dataCoordinates.z,this._dom.querySelector("#value").innerHTML="Value: "+this._voxel.value},t.prototype.update=function(){this.updateColor(),this._screenPosition=this.worldToScreen(this._worldPosition,this._camera,this._container),this.updateVoxel(this._worldPosition),this.updateMeshColor(),this._mesh&&this._mesh.geometry&&(this._mesh.geometry.location=this._voxel.dataCoordinates,this._mesh.updateMatrix()),this.updateDOMContent(),this.updateDOMColor(),this.updateDOMPosition()},t.prototype.updateVoxel=function(a){this._voxel.worldCoordinates=a,this._voxel.dataCoordinates=n.a.worldToData(this._stack,this._voxel.worldCoordinates);var t=n.a.value(this._stack,this._voxel.dataCoordinates);this._voxel.value=n.a.valueRescaleSlopeIntercept(t,this._stack.rescaleSlope,this._stack.rescaleIntercept)},t.prototype.updateDOMPosition=function(){if(this._dom){var e=this._screenPosition.y-this._container.offsetHeight;this._dom.style.transform="translate3D("+this._screenPosition.x+"px, "+e+"px, 0)"}},t.prototype.updateDOMColor=function(){this._dom.style.borderColor=""+this._color},t.prototype.free=function(){this._container.removeEventListener("mouseup",this.onMouseUpHandler,!1),this._container.removeEventListener("mousemove",this.onMouseMoveHandler,!1),this._container.removeEventListener("mousewheel",this.onMouseMoveHandler,!1),this._container.removeEventListener("DOMMouseScroll",this.onMouseMoveHandler,!1),this._voxel.removeTest(),this.remove(this._voxel),this._voxel=null,d.prototype.free.call(this)},t.prototype.hoverVoxel=function(e){var t=e.screenX-this._voxel.voxel.screenCoordinates.x,a=e.screenY-this._voxel.voxel.screenCoordinates.y,o=N(t*t+a*a);this._voxel.distance=o,this._hover=0<=o&&10>o},t.prototype.hideDOM=function(){this._dom.style.display="none"},t.prototype.showDOM=function(){this._dom.style.display=""},t.prototype.hideMesh=function(){this.visible=!1},t.prototype.showMesh=function(){this.visible=!0},t.prototype.show=function(){this.showDOM(),this.showMesh()},t.prototype.hide=function(){this.hideDOM(),this.hideMesh()},c(t,[{key:"worldPosition",set:function(e){this._worldPosition.copy(e),this.update()}},{key:"defaultColor",set:function(e){this._defaultColor=e,this.update()},get:function(){return this._defaultColor}},{key:"activeColor",set:function(e){this._activeColor=e,this.update()},get:function(){return this._activeColor}},{key:"hoverColor",set:function(e){this._hoverColor=e,this.update()},get:function(){return this._hoverColor}},{key:"selectedColor",set:function(e){this._selectedColor=e,this.update()},get:function(){return this._selectedColor}},{key:"showVoxel",set:function(e){this._showVoxel=e,this.update()},get:function(){return this._showVoxel}},{key:"showDomSVG",set:function(e){this._showDomSVG=e,this.update()},get:function(){return this._showDomSVG}},{key:"showDomMeasurements",set:function(e){this._showDomMeasurements=e,this.update()},get:function(){return this._showDomMeasurements}}]),t}(o.a);t.a=p},function(e){e.exports={name:"ami.js",version:"0.0.23-dev",main:"build/ami.js",keywords:["ami","ami.js","three.js","webgl","dicom","nifti","awesome","medical","imaging","xtk","nrrd","vtk","stl","trk"],author:{name:"Nicolas Rannou",email:"nicolas@eunate.ch",url:"https://eunate.ch"},license:"Apache-2.0",repository:{type:"git",url:"https://fnndsc.github.io/ami"},config:{threeVersion:"87",amiCDN:"https://cdnjs.cloudflare.com/ajax/libs/ami.js",gaKey:"UA-39303022-3",babel:"--module-bind js=babel-loader --colors --display-error-details"},dependencies:{"dicom-parser":"1.7.3","image-JPEG2000":"OHIF/image-JPEG2000#master","jpeg-lossless-decoder-js":"1.2.3","math-float32-to-binary-string":"^1.0.0","nifti-reader-js":"v0.5.3","nrrd-js":"^0.2.1",pako:"1.0.1",three:"0.87.0"},scripts:{"build:ami":"webpack --config webpack.config.build.js","build:ami:prod":"cross-env NODE_ENV=production yarn build:ami","build:clean":"rimraf -rf build/*","build:clean:hot":"rimraf -rf build/*.hot-update.*","dev:ami":"webpack --config webpack.config.build.js --hot --watch --colors","dist:ami":"yarn build:clean && yarn build:ami && yarn build:ami:prod && yarn doc","dist:examples":"node ./scripts/buildDist.js && node ./scripts/router.js examples deploy","dist:clean":"rimraf -rf dist/*","analyze:ami":"cross-env NODE_WEBPACK_ANALYZE=true yarn build:ami","analyze:ami:prod":"cross-env NODE_WEBPACK_ANALYZE=true yarn build:ami:prod",clean:"yarn build:clean && yarn dist:clean",example:"node ./scripts/router.js examples",lesson:"node ./scripts/router.js lessons","gen:index:examples":"node ./scripts/genIndexFiles.js examples","gen:index:examples:ga":"cross-env NODE_GA=true node ./scripts/genIndexFiles.js examples","gen:index:lessons":"node ./scripts/genIndexFiles.js lessons","gen:index:lessons:cdn":"node ./scripts/genIndexFiles.js lessons cdn",test:"karma start",lint:"eslint src/**/*.js",doc:"jsdoc -p -r -R README.md -c jsdoc.json -d dist/doc src",ami:"yarn lint && yarn dist:ami && yarn test",deploy:"yarn dist:clean && yarn build:clean && yarn dist:ami && yarn dist:examples && gh-pages -d dist"},devDependencies:{"babel-cli":"latest","babel-core":"^6.26.0","babel-loader":"^7.1.2","babel-preset-env":"^1.6.0","babel-runtime":"^6.26.0","compression-webpack-plugin":"^1.0.1","cross-env":"^3.2.3",eslint:"latest","eslint-config-google":"latest","gh-pages":"latest",glslify:"5.1.0","jasmine-core":"latest",jsdoc:"jsdoc3/jsdoc#master",karma:"latest","karma-chrome-launcher":"^2.2.0","karma-jasmine":"latest","karma-sinon":"^1.0.5","karma-spec-reporter":"latest","karma-webpack":"^2.0.4","live-server":"^1.1.0",puppeteer:"^0.13.0",rimraf:"^2.6.1","rollup-plugin-node-builtins":"^2.1.2",shelljs:"latest",sinon:"^2.0.0","uglifyjs-webpack-plugin":"^1.0.0-beta.3",webpack:"^3.7.1","webpack-bundle-analyzer":"^2.9.0","webpack-dev-server":"^2.9.1","webpack-watch-livereload-plugin":"^0.0.1"},engines:{node:">=6.9.0"}}}])});</script><dom-module id="ami-viewer-2d" assetpath="elements/"><template><style>:host{display:block;position:relative;}#container{left:0;right:0;top:0;bottom:0;position:absolute;overflow:hidden;}#overlay{left:0;right:0;top:0;bottom:0;position:absolute;width:100%;height:100%;overflow:hidden;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;pointer-events:none;}#overlay > div{z-index:1;color:#fff;position:absolute;margin:4px;padding:2px 10px;}.direction{font-size:16px;text-transform:uppercase;}.information{font-size:14px;}.top{top:0;text-align:center;}.bottom{bottom:0;text-align:center;}.left{left:0;text-align:left;}.right{right:0;text-align:right;}</style><div id="overlay"><div id="top" class="top direction"></div><div id="bottom" class="bottom direction"></div><div id="left" class="left direction"></div><div id="right" class="right direction"></div></div><div id="container"></div></template><script>var AMIViewer2D=function(a){function b(){babelHelpers.classCallCheck(this,b);var a=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return a._onScrollBound=a._onScroll.bind(a),a._onMouseMoveBound=a._onMouseMove.bind(a),a._onDoubleClickBound=a._onDoubleClick.bind(a),a}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,null,[{key:'is',get:function(){return'ami-viewer-2d'}},{key:'properties',get:function(){return{showInformation:{type:Boolean,value:!1},animationFrameID:{type:Number,value:-1},stackHelper:{type:Object,value:{}},stackScene:{type:Object,value:{},observer:'_stackSceneChanged'},orientation:{type:String,value:'default',observer:'_orientationChanged'},stackOrientation:{type:Number,value:0,notify:!0},stackIndex:{type:Number,notify:!0,observer:'_onStackIndexChanged'},stackMaxIndex:{type:Number},stackWindowWidth:{type:Number,observer:'_stackWindowWidthChanged'},stackWindowCenter:{type:Number,observer:'_stackWindowCenterChanged'},sizeX:{type:Number},sizeY:{type:Number},mouseI:{type:Number},mouseJ:{type:Number},mouseK:{type:Number},mouseValue:{type:Number},contours:{type:Array,value:[]},clipPlane:{type:Object,value:{}},localizers:{type:Array,value:[],observer:'_localizersChanged'}}}}]),babelHelpers.createClass(b,[{key:'disconnectedCallback',value:function(){babelHelpers.get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),'disconnectedCallback',this).call(this),this._controls.removeEventListener('OnScroll',this._onScrollBound),this._container.removeEventListener('dblclick',this._onDoubleClickBound),this._container.removeEventListener('mousemove',this._onMouseMoveBound)}},{key:'connectedCallback',value:function(){babelHelpers.get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),'connectedCallback',this).call(this),void 0!==this._controls&&void 0!==this._container&&(this._controls.addEventListener('OnScroll',this._onScrollBound),this._container.addEventListener('dblclick',this._onDoubleClickBound),this._container.addEventListener('mousemove',this._onMouseMoveBound))}},{key:'ready',value:function(){babelHelpers.get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),'ready',this).call(this),this._initViewer()}},{key:'_initViewer',value:function(){this._container=this.$.container,this._slice=null,this._scene=null,this._clipPlane=null,this.stackHelper=null,this.orientation='default',this._changed=!0,this._initScene(),this._initCamera(),this._initControls(),this._initRenderer(),this._initLocalizers(),this._initContours(),this._controls.addEventListener('OnScroll',this._onScrollBound),this._container.addEventListener('dblclick',this._onDoubleClickBound),this._container.addEventListener('mousemove',this._onMouseMoveBound);var a=new THREE.BoxGeometry(200,200,200),b=new THREE.MeshBasicMaterial({color:16711680,wireframe:!0});this._mesh=new THREE.Mesh(a,b),this._scene.add(this._mesh)}},{key:'_initScene',value:function(){this._scene=new THREE.Scene}},{key:'_initCamera',value:function(){this._camera=new AMI.OrthographicCamera(this._container.clientWidth/-2,this._container.clientWidth/2,this._container.clientHeight/-2,this._container.clientHeight/2,1,1e3)}},{key:'_initControls',value:function(){var a=this;this._controls=new AMI.TrackballOrthoControl(this._camera,this._container),this._controls.staticMoving=!0,this._controls.noRotate=!0,this._controls.target.set(0,0,0),this._camera.controls=this._controls,this._controls.addEventListener('change',function(){a._changed=!0})}},{key:'_initRenderer',value:function(){this._renderer=new THREE.WebGLRenderer({antialias:!0}),this._renderer.autoClear=!1,this._renderer.updateStyle=!0,this._renderer.localClippingEnabled=!0,this._renderer.setClearColor(4342338),this._renderer.setSize(this._container.clientWidth,this._container.clientHeight),this._container.appendChild(this._renderer.domElement)}},{key:'_initLocalizers',value:function(){this.localizerHelper=null,this.localizerScene=new THREE.Scene}},{key:'_initContours',value:function(){this.clipPlane=new THREE.Plane(new THREE.Vector3(0,0,0),0),this._contourTextureTarget=new THREE.WebGLRenderTarget(this._container.clientWidth,this._container.clientHeight,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat});var a=AMI.ContourUniformShader.uniforms();a.uTextureFilled.value=this._contourTextureTarget.texture,a.uWidth.value=1,a.uCanvasWidth.value=this._contourTextureTarget.width,a.uCanvasHeight.value=this._contourTextureTarget.height;var b=new AMI.ContourFragmentShader(a),c=new AMI.ContourVertexShader;this._contourMaterial=new THREE.ShaderMaterial({side:THREE.DoubleSide,uniforms:a,vertexShader:c.compute(),fragmentShader:b.compute(),transparent:!0,extensions:{derivatives:!0}}),this._contourMesh=null,this._contourScene=new THREE.Scene}},{key:'startRenderingLoop',value:function(){this._animate()}},{key:'stopRenderingLoop',value:function(){window.cancelAnimationFrame(this.animationFrameID),this.animationFrameID=void 0}},{key:'_animate',value:function(){var a=this;this.animationFrameID=requestAnimationFrame(function(){a._animate()}),this._controls.update(),this._changed&&(this._renderer.clear(),this._renderer.render(this._scene,this._camera),this._renderer.clearDepth(),1<=this.contours.length&&this.stackHelper&&this.contours.forEach(function(b){b.materialFront.clippingPlanes=[a.clipPlane],b.materialBack.clippingPlanes=[a.clipPlane],a._renderer.render(b.scene,a._camera,a._contourTextureTarget,!0),a._renderer.clearDepth(),a._contourMaterial.uniforms.uWidth.value=b.selected?3:1,a._renderer.render(a._contourScene,a._camera)}),this._renderer.clearDepth(),this._renderer.render(this.localizerScene,this._camera),this._changed=!1)}},{key:'_onStackIndexChanged',value:function(a){this.stackHelper&&(this.stackHelper.index=a,this._updateContours(),this._updateClipPlane(),this._updateLocalizer())}},{key:'_localizersChanged',value:function(a){if(void 0!==a&&0!==a.length&&null!==this.localizerHelper)for(var b=0;b<a.length;b++)this.localizerHelper['plane'+(b+1)]=a[b].plane,this.localizerHelper['color'+(b+1)]=a[b].color}},{key:'_updateLocalizer',value:function(){if(null===this.localizerHelper){var a=this.stackHelper.stack,b=this.stackHelper.slice,c=b.cartesianEquation();this.localizerHelper=new AMI.LocalizerHelper(a,b.geometry,c),this.localizerHelper.canvasWidth=this._container.clientWidth,this.localizerHelper.canvasHeight=this._container.clientHeight,this.localizerScene.add(this.localizerHelper)}this.localizerHelper.referencePlane=this.stackHelper.slice.cartesianEquation(),this.localizerHelper.geometry=this.stackHelper.slice.geometry}},{key:'_updateContours',value:function(){this._contourMesh&&(this._contourScene.remove(this._contourMesh),this._contourMesh.material.dispose(),this._contourMesh.material=null,this._contourMesh.geometry.dispose(),this._contourMesh.geometry=null),this._contourMesh=new THREE.Mesh(this.stackHelper.slice.geometry,this._contourMaterial),this._contourMesh.applyMatrix(this.stackHelper.stack._ijk2LPS),this._contourScene.add(this._contourMesh)}},{key:'_updateClipPlane',value:function(){var a=this.stackHelper,b=this._camera,c=a.slice.geometry.vertices,d=new THREE.Vector3(c[0].x,c[0].y,c[0].z).applyMatrix4(a._stack.ijk2LPS),e=new THREE.Vector3(c[1].x,c[1].y,c[1].z).applyMatrix4(a._stack.ijk2LPS),f=new THREE.Vector3(c[2].x,c[2].y,c[2].z).applyMatrix4(a._stack.ijk2LPS);this.clipPlane.setFromCoplanarPoints(d,e,f);var g=new THREE.Vector3(1,1,1);g.applyQuaternion(b.quaternion),0<g.dot(this.clipPlane.normal)&&this.clipPlane.negate()}},{key:'_stackSceneChanged',value:function(a){void 0!==a&&null!==a&&a.children&&(this._scene=a,this.set('stackHelper',this._scene.children[0]),this.update())}},{key:'update',value:function(){if(this.stackHelper){var a=this.stackHelper.stack;this.stackHelper.slice.canvasWidth=this._container.clientWidth,this.stackHelper.slice.canvasHeight=this._container.clientHeight;var b=a.worldBoundingBox(),c=new THREE.Vector3((b[1]-b[0])/2,(b[3]-b[2])/2,(b[5]-b[4])/2),d={center:a.worldCenter().clone(),halfDimensions:new THREE.Vector3(c.x+10,c.y+10,c.z+10)},e={width:this._container.clientWidth,height:this._container.clientHeight};this._camera.directions=[a.xCosine,a.yCosine,a.zCosine],this._camera.box=d,this._camera.canvas=e,this._orientationChanged(this.orientation)}}},{key:'resize',value:function(){if(this.stackHelper){var a=this._container.clientHeight,b=this._container.clientWidth;this._camera.canvas={width:b,height:a},this._camera.fitBox(2,1),this._renderer.setSize(b,a),this.stackHelper.slice.canvasWidth=b,this.stackHelper.slice.canvasHeight=a,this._contourTextureTarget.setSize(b,a),this._contourMaterial.uniforms.uCanvasWidth.value=b,this._contourMaterial.uniforms.uCanvasHeight.value=a,this.localizerHelper.canvasWidth=b,this.localizerHelper.canvasHeight=a}}},{key:'_orientationChanged',value:function(a){void 0===a||''===a||this.stackHelper&&this.stackHelper.stack&&(this._camera.orientation=a,this._camera.update(),this._camera.fitBox(2,1),this.stackOrientation=this._camera.stackOrientation,this.stackHelper.orientation=this.stackOrientation,this.stackMaxIndex=this.stackHelper.orientationMaxIndex,this.stackIndex=Math.floor(this.stackMaxIndex/2),this.updateInformation(),this.updateLabels(this._camera.directionsLabel,this.stackHelper.stack.modality))}},{key:'updateLabels',value:function(a,b){'CR'===b||'DX'===b||(this.$.top.innerHTML=a[0],this.$.bottom.innerHTML=a[1],this.$.right.innerHTML=a[2],this.$.left.innerHTML=a[3])}},{key:'updateInformation',value:function(){var a=this.stackHelper.stack,b=this.stackHelper.orientation;this.sizeX=a._dimensionsIJK.getComponent((b+1)%2),this.sizeY=a._dimensionsIJK.getComponent((b+2)%2)}},{key:'_onDoubleClick',value:function(){var a=new CustomEvent('goto',{detail:new THREE.Vector3(this.mouseI,this.mouseJ,this.mouseK)});this.dispatchEvent(a)}},{key:'_onScroll',value:function(a){if(0<a.delta){if(this.stackHelper.index>=this.stackHelper.orientationMaxIndex-1)return!1;this.stackHelper.index+=1}else{if(0>=this.stackHelper.index)return!1;this.stackHelper.index-=1}this.stackIndex=this.stackHelper.index}},{key:'_stackWindowWidthChanged',value:function(a){this.set('stackHelper.slice.windowWidth',a),this._changed=!0}},{key:'_stackWindowCenterChanged',value:function(a){this.set('stackHelper.slice.windowCenter',a),this._changed=!0}},{key:'_onMouseMove',value:function(a){var b={x:2*((a.clientX-this._container.offsetParent.offsetLeft-this._container.offsetParent.offsetParent.offsetLeft-this._container.offsetParent.offsetParent.offsetParent.offsetLeft-this._container.offsetParent.offsetParent.offsetParent.offsetParent.offsetLeft)/this._container.clientWidth)-1,y:2*-((a.clientY-this._container.offsetParent.offsetTop-this._container.offsetParent.offsetParent.offsetTop-this._container.offsetParent.offsetParent.offsetParent.offsetTop-this._container.offsetParent.offsetParent.offsetParent.offsetParent.offsetTop)/this._container.clientHeight)+1},c=new THREE.Raycaster;c.setFromCamera(b,this._camera);var d=c.intersectObject(this._scene,!0);if(0<d.length){var e=AMI.StackModel.worldToData(this.stackHelper.stack,d[0].point);this.mouseI=e.x,this.mouseJ=e.y,this.mouseK=e.z,this.mouseValue=AMI.StackModel.value(this.stackHelper.stack,e)}}}]),b}(Polymer.Element);window.customElements.define(AMIViewer2D.is,AMIViewer2D);</script></dom-module></div><dom-module id="my-case"><template><style include="shared-styles">#codexpl th, #codexpl td{padding:0.8em;border:1px solid;}#codexpl th{background-color:#6699FF;font-weight:bold;}:host{display:block;}app-header{background-color:var(--dark-primary-color);color:var(--text-primary-color);}app-header paper-icon-button{--paper-icon-button-ink-color:white;}.content{display:-webkit-box;display:-ms-flexbox;display:flex;height:100%;background-color:#fff;}.answer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;min-width:256px;min-height:0;overflow-y:scroll;}.viewers{display:-webkit-box;display:-ms-flexbox;display:flex;width:100%;position:relative;}.viewer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-flex:1;-ms-flex:1;flex:1;width:0;}.loader{position:fixed;top:0;bottom:0;left:0;right:0;z-index:9;background-color:var(--dark-primary-color);display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;}.main, .small, .s2{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;overflow:hidden;position:relative;}.move{-webkit-box-flex:1;-ms-flex:1;flex:1;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;}.move paper-slider{background-color:var(--default-primary-color);width:100%;}.main{width:70%;}.small{width:30%;}.small > *{height:50%;}.v2{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-flex:1;-ms-flex:1;flex:1;}paper-radio-button{width:100%;-webkit-box-sizing:border-box;box-sizing:border-box;padding-left:16px;padding-right:16px;}.separator{padding:16px;font-size:14px;font-weight:lighter;color:#aaa;border-top:1px solid var(--divider-color);}.s2{border:1px solid #ffffff;}.main{border-top:1px solid #ffffff;border-bottom:1px solid #ffffff;}a{color:#fff;cursor:auto;text-decoration:none;}a paper-button{background-color:var(--default-primary-color);color:#fff;}.fulloff{height:24px;padding:0;font-size:12px;color:#d9d9d9;position:absolute;top:0;right:0;z-index:1;cursor:default;font-weight:lighter;}.advanced{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;height:auto;background-color:rgba(0, 0, 0, 0.8);margin-bottom:8px;}.controls{height:40px;border-bottom:1px solid var(--divider-color);text-align:right;padding:0 8px;}#collapse > div{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 8px;}#collapse > div:last-child{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;}.next-link{display:-webkit-box;display:-ms-flexbox;display:flex;}.next-button{-webkit-box-flex:1;-ms-flex:1;flex:1;}.cube-folding{width:50px;height:50px;display:inline-block;-moz-transform:rotate(45deg);-ms-transform:rotate(45deg);-webkit-transform:rotate(45deg);transform:rotate(45deg);font-size:0;}.cube-folding span{position:relative;width:25px;height:25px;-moz-transform:scale(1.1);-ms-transform:scale(1.1);-webkit-transform:scale(1.1);transform:scale(1.1);display:inline-block;}.cube-folding span::before{content:'';background-color:white;position:absolute;left:0;top:0;display:block;width:25px;height:25px;-moz-transform-origin:100% 100%;-ms-transform-origin:100% 100%;-webkit-transform-origin:100% 100%;transform-origin:100% 100%;-moz-animation:folding 2.5s infinite linear both;-webkit-animation:folding 2.5s infinite linear both;animation:folding 2.5s infinite linear both;}.cube-folding .leaf2{-moz-transform:rotateZ(90deg) scale(1.1);-ms-transform:rotateZ(90deg) scale(1.1);-webkit-transform:rotateZ(90deg) scale(1.1);transform:rotateZ(90deg) scale(1.1);}.cube-folding .leaf2::before{-moz-animation-delay:0.3s;-webkit-animation-delay:0.3s;animation-delay:0.3s;background-color:#f2f2f2;}.cube-folding .leaf3{-moz-transform:rotateZ(270deg) scale(1.1);-ms-transform:rotateZ(270deg) scale(1.1);-webkit-transform:rotateZ(270deg) scale(1.1);transform:rotateZ(270deg) scale(1.1);}.cube-folding .leaf3::before{-moz-animation-delay:0.9s;-webkit-animation-delay:0.9s;animation-delay:0.9s;background-color:#f2f2f2;}.cube-folding .leaf4{-moz-transform:rotateZ(180deg) scale(1.1);-ms-transform:rotateZ(180deg) scale(1.1);-webkit-transform:rotateZ(180deg) scale(1.1);transform:rotateZ(180deg) scale(1.1);}.cube-folding .leaf4::before{-moz-animation-delay:0.6s;-webkit-animation-delay:0.6s;animation-delay:0.6s;background-color:#e6e6e6;}@-moz-keyframes folding{0%, 10%{-moz-transform:perspective(140px) rotateX(-180deg);transform:perspective(140px) rotateX(-180deg);opacity:0;}25%, 75%{-moz-transform:perspective(140px) rotateX(0deg);transform:perspective(140px) rotateX(0deg);opacity:1;}90%, 100%{-moz-transform:perspective(140px) rotateY(180deg);transform:perspective(140px) rotateY(180deg);opacity:0;}}@-webkit-keyframes folding{0%, 10%{-webkit-transform:perspective(140px) rotateX(-180deg);transform:perspective(140px) rotateX(-180deg);opacity:0;}25%, 75%{-webkit-transform:perspective(140px) rotateX(0deg);transform:perspective(140px) rotateX(0deg);opacity:1;}90%, 100%{-webkit-transform:perspective(140px) rotateY(180deg);transform:perspective(140px) rotateY(180deg);opacity:0;}}@keyframes folding{0%, 10%{-moz-transform:perspective(140px) rotateX(-180deg);-ms-transform:perspective(140px) rotateX(-180deg);-webkit-transform:perspective(140px) rotateX(-180deg);transform:perspective(140px) rotateX(-180deg);opacity:0;}25%, 75%{-moz-transform:perspective(140px) rotateX(0deg);-ms-transform:perspective(140px) rotateX(0deg);-webkit-transform:perspective(140px) rotateX(0deg);transform:perspective(140px) rotateX(0deg);opacity:1;}90%, 100%{-moz-transform:perspective(140px) rotateY(180deg);-ms-transform:perspective(140px) rotateY(180deg);-webkit-transform:perspective(140px) rotateY(180deg);transform:perspective(140px) rotateY(180deg);opacity:0;}}.cube-wrapper{position:fixed;left:50%;top:50%;margin-top:-50px;margin-left:-50px;width:100px;height:100px;text-align:center;}.cube-wrapper:after{content:'';position:absolute;left:0;right:0;bottom:-20px;margin:auto;width:90px;height:6px;background-color:rgba(0, 0, 0, 0.1);-webkit-filter:blur(2px);filter:blur(2px);-moz-border-radius:100%;-webkit-border-radius:100%;border-radius:100%;z-index:1;-moz-animation:shadow 0.5s ease infinite alternate;-webkit-animation:shadow 0.5s ease infinite alternate;animation:shadow 0.5s ease infinite alternate;}.cube-wrapper .loading{font-size:12px;letter-spacing:0.1em;display:block;color:white;position:relative;top:25px;z-index:2;-moz-animation:text 0.5s ease infinite alternate;-webkit-animation:text 0.5s ease infinite alternate;animation:text 0.5s ease infinite alternate;}@-moz-keyframes text{100%{top:35px;}}@-webkit-keyframes text{100%{top:35px;}}@keyframes text{100%{top:35px;}}@-moz-keyframes shadow{100%{bottom:-18px;width:100px;}}@-webkit-keyframes shadow{100%{bottom:-18px;width:100px;}}@keyframes shadow{100%{bottom:-18px;width:100px;}}table,td,tr{border:1px solid black;border-collapse:collapse;text-align :center;}</style><firebase-auth id="FBAuth" user="{{user}}"></firebase-auth><firebase-query id="FBQuery" path="/cases" data="{{cases}}" equal-to="[[page]]"></firebase-query><firebase-query id="FBSave" path="/users/[[user.uid]]/cases"></firebase-query><app-header-layout fullbleed=""><app-header slot="header" fixed="" condenses="" effects="waterfall"><app-toolbar><div hidden="[[loadingData]]" main-title="">[[userCase.tags]] : [[userCase.title]]</div><a hidden="[[loadingData]]" name="view3" href="home/"><paper-icon-button icon="close"></paper-icon-button></a></app-toolbar></app-header><div class="content"><div class="answer"><div class="separator">Best PVT is:</div><paper-radio-group selected="{{contour}}"><paper-radio-button name="red">red</paper-radio-button><paper-radio-button name="green">green</paper-radio-button><paper-radio-button name="blue">blue</paper-radio-button><paper-radio-button name="none">none</paper-radio-button></paper-radio-group><div class="separator">Decision was:</div><paper-radio-group selected="{{choice}}"><paper-radio-button name="easy">easy</paper-radio-button><paper-radio-button name="average">average</paper-radio-button><paper-radio-button name="hard">hard</paper-radio-button><paper-radio-button name="veryhard">very hard</paper-radio-button></paper-radio-group><paper-button on-tap="_submitAnswer" disabled$="[[_selectionDone(contour, choice)]]">Submit answer</paper-button><div hidden$="[[!answered]]"><div class="separator"><div>Your answer has been registered.</div><p id="tab"></p></div><a class="next-link" hidden$="[[_done(todo)]]" name="view3" href="case/[[_next(todo)]]"><paper-button class="next-button">Next case</paper-button></a></div></div><div class="viewers"><template is="dom-if" if="[[loadingData]]"><div class="loader"><div><div class="cube-wrapper"><div class="cube-folding"><span class="leaf1"></span> <span class="leaf2"></span> <span class="leaf3"></span> <span class="leaf4"></span></div><span class="loading" data-name="Loading">Loading ([[fetchProgress]]%)</span></div></div></div></template><div id="mainmain" class="main"><div class="advanced fulloff"><div class="controls"><span class="label">Controls</span><paper-icon-button icon="my-icons:expand-more" target="p3p3" on-tap="toggle"></paper-icon-button></div><iron-collapse id="collapse" no-animation=""><div>Show/Hide contours</div><div><paper-checkbox checked="{{redShow}}">Red</paper-checkbox><paper-checkbox checked="{{greenShow}}">Green</paper-checkbox><paper-checkbox checked="{{blueShow}}">Blue</paper-checkbox></div><div>Win. Width:<paper-slider value="{{stackWindowWidth}}" immediate-value="{{stackWindowWidth}}" min="1" max="[[stackIntensityRange]]" secondary-progress="0"></paper-slider></div><div>Win. Level:<paper-slider value="{{stackWindowCenter}}" immediate-value="{{stackWindowCenter}}" min="[[stackIntensityMin]]" max="[[stackIntensityMax]]" secondary-progress="[[stackIntensityMin]]"></paper-slider></div><div><paper-button on-tap="_resetIntensity">Reset</paper-button></div></iron-collapse></div><div id="p1" class="move"><div class="v2"><ami-viewer-2d id="first" class="viewer" show-information="" stack-index="{{stackIndex0}}" stack-scene="[[stackScene0]]" stack-window-center="[[stackWindowCenter]]" stack-window-width="[[stackWindowWidth]]" contours="[[contours]]" on-goto="_handleGoto"></ami-viewer-2d></div><paper-slider min="0" max="[[v0max]]" value="{{stackIndex0}}" immediate-value="{{stackIndex0}}"></paper-slider></div></div><div class="small"><div id="p2p2" class="s2"><div class="fulloff"><span class="label">Fullscreen</span><paper-icon-button icon="fullscreen" target="p2p2" on-tap="switch"></paper-icon-button></div><div id="p2" class="move"><div class="v2"><ami-viewer-2d id="second" class="viewer" stack-index="{{stackIndex1}}" stack-scene="[[stackScene1]]" stack-window-center="[[stackWindowCenter]]" stack-window-width="[[stackWindowWidth]]" contours="[[contours]]" on-goto="_handleGoto"></ami-viewer-2d></div><paper-slider min="0" max="[[v1max]]" value="{{stackIndex1}}" immediate-value="{{stackIndex1}}"></paper-slider></div></div><div id="p3p3" class="s2"><div class="fulloff"><span class="label">Fullscreen</span><paper-icon-button icon="fullscreen" target="p3p3" on-tap="switch">Text</paper-icon-button></div><div id="p3" class="move"><div class="v2"><ami-viewer-2d id="third" class="viewer" stack-index="{{stackIndex2}}" stack-scene="[[stackScene2]]" stack-window-center="[[stackWindowCenter]]" stack-window-width="[[stackWindowWidth]]" contours="[[contours]]" on-goto="_handleGoto"></ami-viewer-2d></div><paper-slider min="0" max="[[v2max]]" value="{{stackIndex2}}" immediate-value="{{stackIndex2}}"></paper-slider></div></div></div></div></div></app-header-layout></template><script>var MyCase=function(a){function b(){babelHelpers.classCallCheck(this,b);var a=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return a._resizeListenerBound=a._resizeListener.bind(a),a}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,null,[{key:'is',get:function(){return'my-case'}},{key:'properties',get:function(){return{routeData:{type:Object,value:{}},page:{type:String,reflectToAttribute:!0},user:{type:Object,value:{}},cases:{type:Array},userCase:{type:Object,observer:'_userCaseChanged'},contour:{type:String,value:'',observer:'_contourChanged'},choice:{type:String,value:''},series:{type:Object,value:{}},stack:{type:Object,value:{}},stackWindowWidth:{type:Number,value:0},stackWindowCenter:{type:Number,value:0},stackIntensityMin:{type:Number,value:0},stackIntensityMax:{type:Number,value:0},stackIntensityRange:{type:Number,value:0},stackScene0:{type:Object,value:{}},stackIndex0:{type:Number,observer:'_stackIndexChanged'},v0max:{type:Number,value:0},stackScene1:{type:Object,value:{}},stackIndex1:{type:Number,observer:'_stackIndexChanged'},v1max:{type:Number,value:0},stackScene2:{type:Object,value:{}},stackIndex2:{type:Number,observer:'_stackIndexChanged'},v2max:{type:Number,value:0},contours:{type:Array,value:[]},loadingData:{type:Boolean,value:!0},fetchProgress:{type:Number,value:0},redShow:{type:Boolean,value:!0,observer:'_showChanged'},greenShow:{type:Boolean,value:!0,observer:'_showChanged'},blueShow:{type:Boolean,value:!0,observer:'_showChanged'},answered:{type:Boolean,value:!1},todo:{type:Array,value:[],observer:'_todoChanged'}}}},{key:'observers',get:function(){return['_routePageChanged(routeData.*)','_casesChanged(cases.splices)','_descriptionDisplay(userCase)']}}]),babelHelpers.createClass(b,[{key:'connectedCallback',value:function(){babelHelpers.get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),'connectedCallback',this).call(this),window.addEventListener('resize',this._resizeListenerBound)}},{key:'disconnectedCallback',value:function(){babelHelpers.get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),'disconnectedCallback',this).call(this),window.removeEventListener('resize',this._resizeListenerBound)}},{key:'ready',value:function(){babelHelpers.get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),'ready',this).call(this)}},{key:'_descriptionDisplay',value:function(a){var b=a?a.tab:'';this.$.tab.innerHTML=this._unescapeText(b)}},{key:'_unescapeText',value:function(a){var b=document.createElement('textarea');return b.innerHTML=a,b.textContent}},{key:'_routePageChanged',value:function(a){if(void 0!==a)return this.contour=null,this.choice=null,'case'===a.value.page?void(this.page=a.value.subpage,this.$.first.startRenderingLoop(),this.$.second.startRenderingLoop(),this.$.third.startRenderingLoop()):(this.$.first.stopRenderingLoop(),this.$.second.stopRenderingLoop(),void this.$.third.stopRenderingLoop())}},{key:'_casesChanged',value:function(a){void 0===a||1!==a.indexSplices[0].object.length||this.set('userCase',a.indexSplices[0].object[0])}},{key:'_contourChanged',value:function(a){for(var b=0;b<this.contours.length;b++)this.contours[b].selected=this.contours[b].label===a;this._updateRenderers()}},{key:'_userCaseChanged',value:function(a){var b=this;if(null!==a&&a.id){this._cleanup();var c=!1;this.loadingData=!0;var d,e=function(a){var d=new THREE.VTKLoader;d.load(a.location,function(d){a.scene=new THREE.Scene,a.materialFront=new THREE.MeshBasicMaterial({color:a.color,side:THREE.FrontSide,depthWrite:!0,opacity:0,transparent:!0,clippingPlanes:[]}),a.meshFront=new THREE.Mesh(d,a.materialFront),a.scene.add(a.meshFront),a.materialBack=new THREE.MeshBasicMaterial({color:a.color,side:THREE.BackSide,depthWrite:!0,opacity:1,transparent:!0,clippingPlanes:[]}),a.meshBack=new THREE.Mesh(d,a.materialBack),a.scene.add(a.meshBack),b.push('contours',a),3===b.contours.length&&c&&(b.loadingData=!1,b._updateRenderers())})},f=!0,g=!1;try{for(var h,i=a.models[Symbol.iterator]();!(f=(h=i.next()).done);f=!0){var j=h.value,k={};k.color=j.color,k.label=j.label,k.location=j.location,e(k)}}catch(a){g=!0,d=a}finally{try{!f&&i.return&&i.return()}finally{if(g)throw d}}var l=new AMI.VolumeLoader;l.on('fetch-start',function(){b.fetchProgress=1}),l.on('fetch-progress',function(a){b.fetchProgress=Math.round(100*a.loaded/event.total)}),l.on('fetch-end',function(){b.fetchProgress=100}),l.load([a.image.location]).then(function(a){var b=a[0].mergeSeries(a),c=b[0];return c}).then(function(a){var d=Math.floor;b.set('series',a);var e=a.stack[0],f=new AMI.StackHelper(e);f.slice.intensityAuto=!1,f.slice.windowWidth=b.userCase.image.windowWidth,f.slice.windowCenter=b.userCase.image.windowLevel;var g=new THREE.Scene;g.add(f);var h=new AMI.StackHelper(e);h.slice.intensityAuto=!1,h.slice.windowWidth=b.userCase.image.windowWidth,h.slice.windowCenter=b.userCase.image.windowLevel;var i=new THREE.Scene;i.add(h);var j=new AMI.StackHelper(e);j.slice.intensityAuto=!1,j.slice.windowWidth=b.userCase.image.windowWidth,j.slice.windowCenter=b.userCase.image.windowLevel;var k=new THREE.Scene;k.add(j),b.set('stackScene0',g),b.set('stackScene1',i),b.set('stackScene2',k),b.$.first.orientation='axial',b.$.first.resize(),b.$.second.orientation='coronal',b.$.second.resize(),b.$.third.orientation='sagittal',b.$.third.resize(),b.v0max=b.$.first.stackMaxIndex,b.stackIndex0=d(b.v0max/2),b.v1max=b.$.second.stackMaxIndex,b.stackIndex1=d(b.v1max/2),b.v2max=b.$.third.stackMaxIndex,b.stackIndex2=d(b.v2max/2),b._resetIntensity(),b.redShow=!0,b.greenShow=!0,b.blueShow=!0,c=!0,b.fetchProgress=0,b.answered=!1,3===b.contours.length&&c&&(b.loadingData=!1,b._updateRenderers())})}}},{key:'_resetIntensity',value:function(){var a=this.stackScene0.children[0].stack;this.stackIntensityMin=a.minMax[0],this.stackIntensityMax=a.minMax[1],this.stackIntensityRange=a.minMax[1]-a.minMax[0],this.stackWindowWidth=this.stackIntensityRange,this.stackWindowCenter=a.minMax[0]+this.stackIntensityRange/2}},{key:'_resizeListener',value:function(){this.$.first.resize(),this.$.second.resize(),this.$.third.resize(),this._updateRenderers()}},{key:'_submitAnswer',value:function(){this.$.FBSave.ref.push({id:this.userCase.id,contour:this.contour,choice:this.choice,date:Date.now()}),this.contour='',this.choice='',this.answered=!0}},{key:'_selectionDone',value:function(a,b){return null===a||''===a||null===b||''===b}},{key:'_handleGoto',value:function(a){var b=a.detail,c=this.stackScene0.children[0],d=this.stackScene1.children[0],e=this.stackScene2.children[0];this.$.first.stackIndex=b.getComponent((c.orientation+2)%3),this.$.second.stackIndex=b.getComponent((d.orientation+2)%3),this.$.third.stackIndex=b.getComponent((e.orientation+2)%3),this._updateLocalizers(),this._updateRenderers()}},{key:'_stackIndexChanged',value:function(a){void 0===a||(this._updateLocalizers(),this._updateRenderers())}},{key:'_updateLocalizers',value:function(){if(void 0!==this.stackScene0&&void 0!==this.stackScene0.children&&void 0!==this.stackScene1&&void 0!==this.stackScene1.children&&void 0!==this.stackScene2&&void 0!==this.stackScene2.children){var a=this.stackScene0.children[0],b=this.stackScene1.children[0],c=this.stackScene2.children[0],d=a.slice.cartesianEquation(),e=b.slice.cartesianEquation(),f=c.slice.cartesianEquation();this.$.first.localizers=[{plane:e,color:new THREE.Color('#607d8b')},{plane:f,color:new THREE.Color('#607d8b')}],this.$.second.localizers=[{plane:d,color:new THREE.Color('#607d8b')},{plane:f,color:new THREE.Color('#607d8b')}],this.$.third.localizers=[{plane:d,color:new THREE.Color('#607d8b')},{plane:e,color:new THREE.Color('#607d8b')}]}}},{key:'_cleanup',value:function(){if(null!==this.stackScene0&&this.stackScene0.children&&1<=this.stackScene0.children.length){var a=this.stackScene0.children[0];this.stackScene0.remove(a),a.dispose(),a=null,this.stackScene0={}}if(null!==this.stackScene1&&this.stackScene1.children&&1<=this.stackScene1.children.length){var b=this.stackScene1.children[0];this.stackScene1.remove(b),b.dispose(),b=null,this.stackScene1={}}if(null!==this.stackScene2&&this.stackScene2.children&&1<=this.stackScene2.children.length){var c=this.stackScene2.children[0];this.stackScene2.remove(c),c.dispose(),c=null,this.stackScene2={}}if(this.contours&&0<this.contours.length)for(var d=0;d<this.contours.length;d++)this.contours[d].scene.remove(this.contours[d].meshFront),this.contours[d].meshFront.geometry.dispose(),this.contours[d].meshFront.geometry=null,this.contours[d].meshFront.material.dispose(),this.contours[d].meshFront.material=null,this.contours[d].meshFront=null,this.contours[d].scene.remove(this.contours[d].meshBack),this.contours[d].meshBack.geometry.dispose(),this.contours[d].meshBack.geometry=null,this.contours[d].meshBack.material.dispose(),this.contours[d].meshBack.material=null,this.contours[d].meshBack=null,this.set('contours',[])}},{key:'switch',value:function(a){var b=a.currentTarget.getAttribute('target'),c=this.$.mainmain.children[1],d=this.$[b].children[1];this.$.mainmain.appendChild(d),this.$[b].appendChild(c),this._resizeListener()}},{key:'toggle',value:function(){this.$.collapse.toggle()}},{key:'_showChanged',value:function(){for(var a=0;a<this.contours.length;a++){var b=this.contours[a].label,c=this[b+'Show'];this.contours[a].meshBack.visible=c,this.contours[a].meshFront.visible=c}this._updateRenderers()}},{key:'_updateRenderers',value:function(){this.$.first._changed=!0,this.$.second._changed=!0,this.$.third._changed=!0}},{key:'_todoChanged',value:function(a){}},{key:'_done',value:function(a){return 0>=a.length}},{key:'_next',value:function(a){return void 0===a?void 0:0<a.length?a[0].id:void 0}}]),b}(Polymer.Element);window.customElements.define(MyCase.is,MyCase);</script></dom-module></body></html>